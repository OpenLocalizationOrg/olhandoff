{
  "nodes": [
    {
      "pos": [
        27,
        120
      ],
      "content": "Working with the Mobile Services managed client library (Windows | Xamarin) | Microsoft Azure"
    },
    {
      "pos": [
        139,
        226
      ],
      "content": "Learn how to use a .NET client for Azure Mobile Services with Windows and Xamarin apps."
    },
    {
      "pos": [
        549,
        612
      ],
      "content": "How to use the managed client library for Azure Mobile Services"
    },
    {
      "pos": [
        717,
        723
      ],
      "content": "&amp;nbsp;"
    },
    {
      "pos": [
        846,
        854
      ],
      "content": "Overview"
    },
    {
      "pos": [
        856,
        1302
      ],
      "content": "This guide shows you how to perform common scenarios using the managed client library for Azure Mobile Services in Windows and Xamarin apps. The scenarios covered include querying for data, inserting, updating, and deleting data, authenticating users, and handling errors. If you are new to Mobile Services, you should consider first completing the <bpt id=\"p1\">[</bpt>Mobile Services quickstart<ept id=\"p1\">](mobile-services-dotnet-backend-xamarin-ios-get-started.md)</ept><ph id=\"ph4\"/> tutorial.",
      "nodes": [
        {
          "content": "This guide shows you how to perform common scenarios using the managed client library for Azure Mobile Services in Windows and Xamarin apps.",
          "pos": [
            0,
            140
          ]
        },
        {
          "content": "The scenarios covered include querying for data, inserting, updating, and deleting data, authenticating users, and handling errors.",
          "pos": [
            141,
            272
          ]
        },
        {
          "content": "If you are new to Mobile Services, you should consider first completing the <bpt id=\"p1\">[</bpt>Mobile Services quickstart<ept id=\"p1\">](mobile-services-dotnet-backend-xamarin-ios-get-started.md)</ept><ph id=\"ph4\"/> tutorial.",
          "pos": [
            273,
            498
          ]
        }
      ]
    },
    {
      "pos": [
        1392,
        1394
      ],
      "content": "##"
    },
    {
      "pos": [
        1414,
        1437
      ],
      "content": "Setup and Prerequisites"
    },
    {
      "pos": [
        1439,
        1722
      ],
      "content": "We assume that you have created a mobile service and a table. For more information see <bpt id=\"p2\">[</bpt>Create a table<ept id=\"p2\">](http://go.microsoft.com/fwlink/?LinkId=298592)</ept>. In the code used in this topic, the table is named <ph id=\"ph6\">`TodoItem`</ph><ph id=\"ph7\"/> and it will have the following columns: <ph id=\"ph8\">`Id`</ph>, <ph id=\"ph9\">`Text`</ph>, and <ph id=\"ph10\">`Complete`</ph>.",
      "nodes": [
        {
          "content": "We assume that you have created a mobile service and a table.",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "For more information see <bpt id=\"p2\">[</bpt>Create a table<ept id=\"p2\">](http://go.microsoft.com/fwlink/?LinkId=298592)</ept>.",
          "pos": [
            62,
            189
          ]
        },
        {
          "content": "In the code used in this topic, the table is named <ph id=\"ph6\">`TodoItem`</ph><ph id=\"ph7\"/> and it will have the following columns: <ph id=\"ph8\">`Id`</ph>, <ph id=\"ph9\">`Text`</ph>, and <ph id=\"ph10\">`Complete`</ph>.",
          "pos": [
            190,
            408
          ]
        }
      ]
    },
    {
      "pos": [
        1724,
        1787
      ],
      "content": "The corresponding typed client-side .NET type is the following:"
    },
    {
      "pos": [
        2050,
        2286
      ],
      "content": "Note that the <bpt id=\"p3\">[</bpt>JsonPropertyAttribute<ept id=\"p3\">](http://www.newtonsoft.com/json/help/html/Properties_T_Newtonsoft_Json_JsonPropertyAttribute.htm)</ept><ph id=\"ph11\"/> is used to define the mapping between the PropertyName mapping between the client type and the table."
    },
    {
      "pos": [
        2288,
        2646
      ],
      "content": "When dynamic schema is enabled in a JavaScript backend mobile service, Azure Mobile Services automatically generates new columns based on the object in insert or update requests. For more information, see <bpt id=\"p4\">[</bpt>Dynamic schema<ept id=\"p4\">](http://go.microsoft.com/fwlink/?LinkId=296271)</ept>. In a .NET backend mobile service, the table is defined in the data model of the project.",
      "nodes": [
        {
          "content": "When dynamic schema is enabled in a JavaScript backend mobile service, Azure Mobile Services automatically generates new columns based on the object in insert or update requests.",
          "pos": [
            0,
            178
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p4\">[</bpt>Dynamic schema<ept id=\"p4\">](http://go.microsoft.com/fwlink/?LinkId=296271)</ept>.",
          "pos": [
            179,
            307
          ]
        },
        {
          "content": "In a .NET backend mobile service, the table is defined in the data model of the project.",
          "pos": [
            308,
            396
          ]
        }
      ]
    },
    {
      "pos": [
        2648,
        2650
      ],
      "content": "##"
    },
    {
      "pos": [
        2678,
        2719
      ],
      "content": "How to: Create the Mobile Services client"
    },
    {
      "pos": [
        2721,
        2824
      ],
      "content": "The following code creates the <ph id=\"ph12\">`MobileServiceClient`</ph><ph id=\"ph13\"/> object that is used to access your mobile service."
    },
    {
      "pos": [
        2928,
        3164
      ],
      "content": "In the code above, replace <ph id=\"ph14\">`AppUrl`</ph><ph id=\"ph15\"/> and <ph id=\"ph16\">`AppKey`</ph><ph id=\"ph17\"/> with the mobile service URL and application key, in that order. Both of these are available on the Azure classic portal, by selecting your mobile service and then clicking on \"Dashboard\".",
      "nodes": [
        {
          "content": "In the code above, replace <ph id=\"ph14\">`AppUrl`</ph><ph id=\"ph15\"/> and <ph id=\"ph16\">`AppKey`</ph><ph id=\"ph17\"/> with the mobile service URL and application key, in that order.",
          "pos": [
            0,
            180
          ]
        },
        {
          "content": "Both of these are available on the Azure classic portal, by selecting your mobile service and then clicking on \"Dashboard\".",
          "pos": [
            181,
            304
          ]
        }
      ]
    },
    {
      "pos": [
        3167,
        3559
      ],
      "content": "<ph id=\"ph18\">[AZURE.IMPORTANT]</ph>The application key is intended to filter-out random request against your mobile service, and it is distributed with the application. Because this key is not encrypted, it cannot be considered secure. To truly secure your mobile service data, you must instead authenticate users before allowing access. For more information, see <bpt id=\"p5\">[</bpt>How to: Authenticate users<ept id=\"p5\">](#authentication)</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph18\">[AZURE.IMPORTANT]</ph>The application key is intended to filter-out random request against your mobile service, and it is distributed with the application.",
          "pos": [
            0,
            169
          ]
        },
        {
          "content": "Because this key is not encrypted, it cannot be considered secure.",
          "pos": [
            170,
            236
          ]
        },
        {
          "content": "To truly secure your mobile service data, you must instead authenticate users before allowing access.",
          "pos": [
            237,
            338
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p5\">[</bpt>How to: Authenticate users<ept id=\"p5\">](#authentication)</ept>.",
          "pos": [
            339,
            449
          ]
        }
      ]
    },
    {
      "pos": [
        3561,
        3563
      ],
      "content": "##"
    },
    {
      "pos": [
        3591,
        3623
      ],
      "content": "How to: Create a table reference"
    },
    {
      "pos": [
        3625,
        3931
      ],
      "content": "All of the code that accesses or modifies data in the Mobile Services table calls functions on the <ph id=\"ph19\">`MobileServiceTable`</ph><ph id=\"ph20\"/> object. You get a reference to the table by calling the <bpt id=\"p6\">[</bpt>GetTable<ept id=\"p6\">](https://msdn.microsoft.com/library/azure/jj554275.aspx)</ept><ph id=\"ph21\"/> method on an instance of the <ph id=\"ph22\">`MobileServiceClient`</ph>, as follows:",
      "nodes": [
        {
          "content": "All of the code that accesses or modifies data in the Mobile Services table calls functions on the <ph id=\"ph19\">`MobileServiceTable`</ph><ph id=\"ph20\"/> object.",
          "pos": [
            0,
            161
          ]
        },
        {
          "content": "You get a reference to the table by calling the <bpt id=\"p6\">[</bpt>GetTable<ept id=\"p6\">](https://msdn.microsoft.com/library/azure/jj554275.aspx)</ept><ph id=\"ph21\"/> method on an instance of the <ph id=\"ph22\">`MobileServiceClient`</ph>, as follows:",
          "pos": [
            162,
            412
          ]
        }
      ]
    },
    {
      "pos": [
        4017,
        4128
      ],
      "content": "This is the typed serialization model; see the discussion of the <bpt id=\"p7\">[</bpt>untyped serialization model<ept id=\"p7\">](#untyped)</ept><ph id=\"ph23\"/> below."
    },
    {
      "pos": [
        4130,
        4132
      ],
      "content": "##"
    },
    {
      "pos": [
        4155,
        4195
      ],
      "content": "How to: Query data from a mobile service"
    },
    {
      "pos": [
        4197,
        4307
      ],
      "content": "This section describes how to issue queries to the mobile service, which includes the following functionality:"
    },
    {
      "pos": [
        4311,
        4333
      ],
      "content": "[Filter returned data]"
    },
    {
      "pos": [
        4336,
        4356
      ],
      "content": "[Sort returned data]"
    },
    {
      "pos": [
        4359,
        4381
      ],
      "content": "[Return data in pages]"
    },
    {
      "pos": [
        4384,
        4409
      ],
      "content": "[Select specific columns]"
    },
    {
      "pos": [
        4412,
        4432
      ],
      "content": "[Look up data by ID]"
    },
    {
      "pos": [
        4435,
        4705
      ],
      "content": "<ph id=\"ph24\">[AZURE.NOTE]</ph><ph id=\"ph25\"/> A server-driven page size is enforced to prevent all rows from being returned. This keeps default requests for large data sets from negatively impacting the service. To return more than 50 rows, use the <ph id=\"ph26\">`Take`</ph><ph id=\"ph27\"/> method, as described in [Return data in pages].",
      "nodes": [
        {
          "content": "<ph id=\"ph24\">[AZURE.NOTE]</ph><ph id=\"ph25\"/> A server-driven page size is enforced to prevent all rows from being returned.",
          "pos": [
            0,
            125
          ]
        },
        {
          "content": "This keeps default requests for large data sets from negatively impacting the service.",
          "pos": [
            126,
            212
          ]
        },
        {
          "content": "To return more than 50 rows, use the <ph id=\"ph26\">`Take`</ph><ph id=\"ph27\"/> method, as described in [Return data in pages].",
          "pos": [
            213,
            338
          ]
        }
      ]
    },
    {
      "pos": [
        4735,
        4763
      ],
      "content": "How to: Filter returned data"
    },
    {
      "pos": [
        4765,
        5028
      ],
      "content": "The following code illustrates how to filter data by including a <ph id=\"ph28\">`Where`</ph><ph id=\"ph29\"/> clause in a query. It returns all items from <ph id=\"ph30\">`todoTable`</ph><ph id=\"ph31\"/> whose <ph id=\"ph32\">`Complete`</ph><ph id=\"ph33\"/> property is equal to <ph id=\"ph34\">`false`</ph>. The <ph id=\"ph35\">`Where`</ph><ph id=\"ph36\"/> function applies a row filtering predicate to the query against the table.",
      "nodes": [
        {
          "content": "The following code illustrates how to filter data by including a <ph id=\"ph28\">`Where`</ph><ph id=\"ph29\"/> clause in a query.",
          "pos": [
            0,
            125
          ]
        },
        {
          "content": "It returns all items from <ph id=\"ph30\">`todoTable`</ph><ph id=\"ph31\"/> whose <ph id=\"ph32\">`Complete`</ph><ph id=\"ph33\"/> property is equal to <ph id=\"ph34\">`false`</ph>.",
          "pos": [
            126,
            297
          ]
        },
        {
          "content": "The <ph id=\"ph35\">`Where`</ph><ph id=\"ph36\"/> function applies a row filtering predicate to the query against the table.",
          "pos": [
            298,
            418
          ]
        }
      ]
    },
    {
      "pos": [
        5239,
        5478
      ],
      "content": "You can view the URI of the request sent to the mobile service by using message inspection software, such as browser developer tools or <bpt id=\"p8\">[</bpt><ept id=\"p8\">Fiddler]</ept>. If you look at the request URI below,  notice that we are modifying the query string itself:",
      "nodes": [
        {
          "content": "You can view the URI of the request sent to the mobile service by using message inspection software, such as browser developer tools or <bpt id=\"p8\">[</bpt><ept id=\"p8\">Fiddler]</ept>.",
          "pos": [
            0,
            184
          ]
        },
        {
          "content": "If you look at the request URI below,  notice that we are modifying the query string itself:",
          "pos": [
            185,
            277
          ]
        }
      ]
    },
    {
      "pos": [
        5542,
        5640
      ],
      "content": "This request would normally be translated roughly into the following SQL query on the server side:"
    },
    {
      "pos": [
        5708,
        5831
      ],
      "content": "The function which is passed to the <ph id=\"ph37\">`Where`</ph><ph id=\"ph38\"/> method can have an arbitrary number of conditions. For example, the line below:",
      "nodes": [
        {
          "content": "The function which is passed to the <ph id=\"ph37\">`Where`</ph><ph id=\"ph38\"/> method can have an arbitrary number of conditions.",
          "pos": [
            0,
            128
          ]
        },
        {
          "content": "For example, the line below:",
          "pos": [
            129,
            157
          ]
        }
      ]
    },
    {
      "pos": [
        6062,
        6128
      ],
      "content": "Would be roughly translated (for the same request shown before) as"
    },
    {
      "pos": [
        6230,
        6331
      ],
      "content": "The <ph id=\"ph39\">`where`</ph><ph id=\"ph40\"/> statement above will find items with <ph id=\"ph41\">`Complete`</ph><ph id=\"ph42\"/> status set to false with non-null <ph id=\"ph43\">`Text`</ph>."
    },
    {
      "pos": [
        6333,
        6391
      ],
      "content": "We also could have written that in multiple lines instead:"
    },
    {
      "pos": [
        6563,
        6734
      ],
      "content": "The two methods are equivalent and may be used interchangeably.  The former option -- of concatenating multiple predicates in one query -- is more compact and recommended.",
      "nodes": [
        {
          "content": "The two methods are equivalent and may be used interchangeably.",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "The former option -- of concatenating multiple predicates in one query -- is more compact and recommended.",
          "pos": [
            65,
            171
          ]
        }
      ]
    },
    {
      "pos": [
        6736,
        7182
      ],
      "content": "The <ph id=\"ph44\">`where`</ph><ph id=\"ph45\"/> clause supports operations that be translated into the Mobile Services OData subset. This includes relational operators (==, !=, &lt;, &lt;=, &gt;, &gt;=), arithmetic operators (+, -, /, *, %), number precision (Math.Floor, Math.Ceiling), string functions (Length, Substring, Replace, IndexOf, StartsWith, EndsWith), date properties (Year, Month, Day, Hour, Minute, Second), access properties of an object, and expressions combining all of these.",
      "nodes": [
        {
          "content": "The <ph id=\"ph44\">`where`</ph><ph id=\"ph45\"/> clause supports operations that be translated into the Mobile Services OData subset. This includ",
          "pos": [
            0,
            142
          ]
        },
        {
          "content": "es relational operators (==, !=, &lt;, &lt;=, &gt;, &gt;=), arithmetic operators (+, -, /, *, %), number precision (Math.Floor, Math.Ceiling), string functions (Length, Substring, Replace, IndexOf, StartsWith, EndsWith), date properties (Year, Month, Day, Hour, Minute, Second), access properties of an object, and expressions combining all of these.",
          "pos": [
            142,
            492
          ]
        }
      ]
    },
    {
      "pos": [
        7210,
        7236
      ],
      "content": "How to: Sort returned data"
    },
    {
      "pos": [
        7238,
        7429
      ],
      "content": "The following code illustrates how to sort data by including an <ph id=\"ph46\">`OrderBy`</ph><ph id=\"ph47\"/> or <ph id=\"ph48\">`OrderByDescending`</ph><ph id=\"ph49\"/> function in the query. It returns items from <ph id=\"ph50\">`todoTable`</ph><ph id=\"ph51\"/> sorted ascending by the <ph id=\"ph52\">`Text`</ph><ph id=\"ph53\"/> field.",
      "nodes": [
        {
          "content": "The following code illustrates how to sort data by including an <ph id=\"ph46\">`OrderBy`</ph><ph id=\"ph47\"/> or <ph id=\"ph48\">`OrderByDescending`</ph><ph id=\"ph49\"/> function in the query.",
          "pos": [
            0,
            187
          ]
        },
        {
          "content": "It returns items from <ph id=\"ph50\">`todoTable`</ph><ph id=\"ph51\"/> sorted ascending by the <ph id=\"ph52\">`Text`</ph><ph id=\"ph53\"/> field.",
          "pos": [
            188,
            327
          ]
        }
      ]
    },
    {
      "pos": [
        7903,
        7931
      ],
      "content": "How to: Return data in pages"
    },
    {
      "pos": [
        7933,
        8253
      ],
      "content": "By default, the server returns only the first 50 rows. You can increase the number of returned rows by calling the <bpt id=\"p9\">[</bpt><ept id=\"p9\">Take]</ept> method. Use <ph id=\"ph54\">`Take`</ph><ph id=\"ph55\"/> along with the <bpt id=\"p10\">[</bpt><ept id=\"p10\">Skip]</ept> method to request a specific \"page\" of the total dataset returned by the query. The following query, when executed, returns the top three items in the table.",
      "nodes": [
        {
          "content": "By default, the server returns only the first 50 rows.",
          "pos": [
            0,
            54
          ]
        },
        {
          "content": "You can increase the number of returned rows by calling the <bpt id=\"p9\">[</bpt><ept id=\"p9\">Take]</ept> method.",
          "pos": [
            55,
            167
          ]
        },
        {
          "content": "Use <ph id=\"ph54\">`Take`</ph><ph id=\"ph55\"/> along with the <bpt id=\"p10\">[</bpt><ept id=\"p10\">Skip]</ept> method to request a specific \"page\" of the total dataset returned by the query.",
          "pos": [
            168,
            354
          ]
        },
        {
          "content": "The following query, when executed, returns the top three items in the table.",
          "pos": [
            355,
            432
          ]
        }
      ]
    },
    {
      "pos": [
        8457,
        8636
      ],
      "content": "The following revised query skips the first three results and returns the next three after that. This is effectively the second \"page\" of data, where the page size is three items.",
      "nodes": [
        {
          "content": "The following revised query skips the first three results and returns the next three after that.",
          "pos": [
            0,
            96
          ]
        },
        {
          "content": "This is effectively the second \"page\" of data, where the page size is three items.",
          "pos": [
            97,
            179
          ]
        }
      ]
    },
    {
      "pos": [
        8896,
        9100
      ],
      "content": "You can also use the <bpt id=\"p11\">[</bpt><ept id=\"p11\">IncludeTotalCount]</ept> method to ensure that the query will get the total count for <ph id=\"ph56\">&lt;i&gt;</ph>all<ph id=\"ph57\">&lt;/i&gt;</ph><ph id=\"ph58\"/> the records that would have been returned, ignoring any take paging/limit clause specified:"
    },
    {
      "pos": [
        9142,
        9391
      ],
      "content": "This is a simplified scenario of passing hard-coded paging values to the <ph id=\"ph59\">`Take`</ph><ph id=\"ph60\"/> and <ph id=\"ph61\">`Skip`</ph><ph id=\"ph62\"/> methods. In a real-world app, you can use queries similar to the above with a pager control or comparable UI to let users navigate to previous and next pages.",
      "nodes": [
        {
          "content": "This is a simplified scenario of passing hard-coded paging values to the <ph id=\"ph59\">`Take`</ph><ph id=\"ph60\"/> and <ph id=\"ph61\">`Skip`</ph><ph id=\"ph62\"/> methods.",
          "pos": [
            0,
            167
          ]
        },
        {
          "content": "In a real-world app, you can use queries similar to the above with a pager control or comparable UI to let users navigate to previous and next pages.",
          "pos": [
            168,
            317
          ]
        }
      ]
    },
    {
      "pos": [
        9397,
        9452
      ],
      "content": "Paging considerations for a .NET backend mobile service"
    },
    {
      "pos": [
        9454,
        9787
      ],
      "content": "To override the 50 row limit in a .NET backend mobile service, you must also apply the <bpt id=\"p12\">[</bpt>EnableQueryAttribute<ept id=\"p12\">](https://msdn.microsoft.com/library/system.web.http.odata.enablequeryattribute.aspx)</ept><ph id=\"ph63\"/> to the public GET method and specify the paging behavior. When applied to the method, the following sets the maximum returned rows to 1000:",
      "nodes": [
        {
          "content": "To override the 50 row limit in a .NET backend mobile service, you must also apply the <bpt id=\"p12\">[</bpt>EnableQueryAttribute<ept id=\"p12\">](https://msdn.microsoft.com/library/system.web.http.odata.enablequeryattribute.aspx)</ept><ph id=\"ph63\"/> to the public GET method and specify the paging behavior.",
          "pos": [
            0,
            306
          ]
        },
        {
          "content": "When applied to the method, the following sets the maximum returned rows to 1000:",
          "pos": [
            307,
            388
          ]
        }
      ]
    },
    {
      "pos": [
        9850,
        9881
      ],
      "content": "How to: Select specific columns"
    },
    {
      "pos": [
        9883,
        10109
      ],
      "content": "You can specify which set of properties to include in the results by adding a <ph id=\"ph64\">`Select`</ph><ph id=\"ph65\"/> clause to your query. For example, the following code shows how to select just one field and also how to select and format multiple fields:",
      "nodes": [
        {
          "content": "You can specify which set of properties to include in the results by adding a <ph id=\"ph64\">`Select`</ph><ph id=\"ph65\"/> clause to your query.",
          "pos": [
            0,
            142
          ]
        },
        {
          "content": "For example, the following code shows how to select just one field and also how to select and format multiple fields:",
          "pos": [
            143,
            260
          ]
        }
      ]
    },
    {
      "pos": [
        10638,
        10783
      ],
      "content": "All the functions described so far are additive, so we can just keep calling them and we'll each time affect more of the query. One more example:",
      "nodes": [
        {
          "content": "All the functions described so far are additive, so we can just keep calling them and we'll each time affect more of the query.",
          "pos": [
            0,
            127
          ]
        },
        {
          "content": "One more example:",
          "pos": [
            128,
            145
          ]
        }
      ]
    },
    {
      "pos": [
        11104,
        11130
      ],
      "content": "How to: Look up data by ID"
    },
    {
      "pos": [
        11132,
        11229
      ],
      "content": "The <ph id=\"ph66\">`LookupAsync`</ph><ph id=\"ph67\"/> function can be used to look up objects from the database with a particular ID."
    },
    {
      "pos": [
        11412,
        11414
      ],
      "content": "##"
    },
    {
      "pos": [
        11438,
        11479
      ],
      "content": "How to: Insert data into a mobile service"
    },
    {
      "pos": [
        11483,
        11767
      ],
      "content": "<ph id=\"ph68\">[AZURE.NOTE]</ph><ph id=\"ph69\"/> If you want to perform insert, lookup, delete, or update operations on a type, then you need to create a member called <bpt id=\"p13\">**</bpt>Id<ept id=\"p13\">**</ept>. This is why the example class <bpt id=\"p14\">**</bpt>TodoItem<ept id=\"p14\">**</ept><ph id=\"ph70\"/> has a member of name <bpt id=\"p15\">**</bpt>Id<ept id=\"p15\">**</ept>. A valid id value must always be present in update and delete operations.",
      "nodes": [
        {
          "content": "<ph id=\"ph68\">[AZURE.NOTE]</ph><ph id=\"ph69\"/> If you want to perform insert, lookup, delete, or update operations on a type, then you need to create a member called <bpt id=\"p13\">**</bpt>Id<ept id=\"p13\">**</ept>.",
          "pos": [
            0,
            213
          ]
        },
        {
          "content": "This is why the example class <bpt id=\"p14\">**</bpt>TodoItem<ept id=\"p14\">**</ept><ph id=\"ph70\"/> has a member of name <bpt id=\"p15\">**</bpt>Id<ept id=\"p15\">**</ept>.",
          "pos": [
            214,
            380
          ]
        },
        {
          "content": "A valid id value must always be present in update and delete operations.",
          "pos": [
            381,
            453
          ]
        }
      ]
    },
    {
      "pos": [
        11769,
        11901
      ],
      "content": "The following code illustrates how to insert new rows into a table. The parameter contains the data to be inserted as a .NET object.",
      "nodes": [
        {
          "content": "The following code illustrates how to insert new rows into a table.",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "The parameter contains the data to be inserted as a .NET object.",
          "pos": [
            68,
            132
          ]
        }
      ]
    },
    {
      "pos": [
        11947,
        12154
      ],
      "content": "If a unique custom ID value is not included in the <ph id=\"ph71\">`todoItem`</ph><ph id=\"ph72\"/> passed to the <ph id=\"ph73\">`todoTable.InsertAsync`</ph><ph id=\"ph74\"/> call, a value for ID is generated by the server and is set in the <ph id=\"ph75\">`todoItem`</ph><ph id=\"ph76\"/> object returned to the client."
    },
    {
      "pos": [
        12156,
        12230
      ],
      "content": "To insert untyped data, you may take advantage of Json.NET as shown below."
    },
    {
      "pos": [
        12379,
        12443
      ],
      "content": "Here is an example using an email address as a unique string id."
    },
    {
      "pos": [
        12641,
        12663
      ],
      "content": "Working with ID values"
    },
    {
      "pos": [
        12665,
        12844
      ],
      "content": "Mobile Services supports unique custom string values for the table's <bpt id=\"p16\">**</bpt>id<ept id=\"p16\">**</ept><ph id=\"ph77\"/> column. This allows applications to use custom values such as email addresses or user names for the ID.",
      "nodes": [
        {
          "content": "Mobile Services supports unique custom string values for the table's <bpt id=\"p16\">**</bpt>id<ept id=\"p16\">**</ept><ph id=\"ph77\"/> column.",
          "pos": [
            0,
            138
          ]
        },
        {
          "content": "This allows applications to use custom values such as email addresses or user names for the ID.",
          "pos": [
            139,
            234
          ]
        }
      ]
    },
    {
      "pos": [
        12846,
        12897
      ],
      "content": "String IDs provide you with the following benefits:"
    },
    {
      "pos": [
        12901,
        12963
      ],
      "content": "IDs are generated without making a round-trip to the database."
    },
    {
      "pos": [
        12966,
        13029
      ],
      "content": "Records are easier to merge from different tables or databases."
    },
    {
      "pos": [
        13032,
        13092
      ],
      "content": "IDs values can integrate better with an application's logic."
    },
    {
      "pos": [
        13094,
        13512
      ],
      "content": "When a string ID value is not set on an inserted record, Mobile Services generates a unique value for the ID. You can use the <ph id=\"ph78\">`Guid.NewGuid()`</ph><ph id=\"ph79\"/> method To generate your own ID values, either on the client or in a .NET mobile backend service. To learn more about generating GUIDs in a JavaScript backend mobile service, see <bpt id=\"p17\">[</bpt>How to: Generate unique ID values<ept id=\"p17\">](mobile-services-how-to-use-server-scripts.md#generate-guids)</ept>.",
      "nodes": [
        {
          "content": "When a string ID value is not set on an inserted record, Mobile Services generates a unique value for the ID.",
          "pos": [
            0,
            109
          ]
        },
        {
          "content": "You can use the <ph id=\"ph78\">`Guid.NewGuid()`</ph><ph id=\"ph79\"/> method To generate your own ID values, either on the client or in a .NET mobile backend service.",
          "pos": [
            110,
            273
          ]
        },
        {
          "content": "To learn more about generating GUIDs in a JavaScript backend mobile service, see <bpt id=\"p17\">[</bpt>How to: Generate unique ID values<ept id=\"p17\">](mobile-services-how-to-use-server-scripts.md#generate-guids)</ept>.",
          "pos": [
            274,
            492
          ]
        }
      ]
    },
    {
      "pos": [
        13514,
        13889
      ],
      "content": "You can also use integer IDs for your tables. To use an integer ID, you must create your table with the <ph id=\"ph80\">`mobile table create`</ph><ph id=\"ph81\"/> command using the <ph id=\"ph82\">`--integerId`</ph><ph id=\"ph83\"/> option. This command is used with the Command-line Interface (CLI) for Azure. For more information on using the CLI, see <bpt id=\"p18\">[</bpt>CLI to manage Mobile Services tables<ept id=\"p18\">](../virtual-machines-command-line-tools.md#Mobile_Tables)</ept>.",
      "nodes": [
        {
          "content": "You can also use integer IDs for your tables.",
          "pos": [
            0,
            45
          ]
        },
        {
          "content": "To use an integer ID, you must create your table with the <ph id=\"ph80\">`mobile table create`</ph><ph id=\"ph81\"/> command using the <ph id=\"ph82\">`--integerId`</ph><ph id=\"ph83\"/> option.",
          "pos": [
            46,
            233
          ]
        },
        {
          "content": "This command is used with the Command-line Interface (CLI) for Azure.",
          "pos": [
            234,
            303
          ]
        },
        {
          "content": "For more information on using the CLI, see <bpt id=\"p18\">[</bpt>CLI to manage Mobile Services tables<ept id=\"p18\">](../virtual-machines-command-line-tools.md#Mobile_Tables)</ept>.",
          "pos": [
            304,
            483
          ]
        }
      ]
    },
    {
      "pos": [
        13891,
        13893
      ],
      "content": "##"
    },
    {
      "pos": [
        13917,
        13956
      ],
      "content": "How to: Modify data in a mobile service"
    },
    {
      "pos": [
        13958,
        14126
      ],
      "content": "The following code illustrates how to update an existing instance with the same ID with new information. The parameter contains the data to be updated as a .NET object.",
      "nodes": [
        {
          "content": "The following code illustrates how to update an existing instance with the same ID with new information.",
          "pos": [
            0,
            104
          ]
        },
        {
          "content": "The parameter contains the data to be updated as a .NET object.",
          "pos": [
            105,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        14173,
        14435
      ],
      "content": "To insert untyped data, you may take advantage of Json.NET like so. Note that when making an update, an ID must be specified, as that is how the mobile service identifies which instance to update. The ID can be obtained from the result of the <ph id=\"ph84\">`InsertAsync`</ph><ph id=\"ph85\"/> call.",
      "nodes": [
        {
          "content": "To insert untyped data, you may take advantage of Json.NET like so.",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "Note that when making an update, an ID must be specified, as that is how the mobile service identifies which instance to update.",
          "pos": [
            68,
            196
          ]
        },
        {
          "content": "The ID can be obtained from the result of the <ph id=\"ph84\">`InsertAsync`</ph><ph id=\"ph85\"/> call.",
          "pos": [
            197,
            296
          ]
        }
      ]
    },
    {
      "pos": [
        14642,
        14836
      ],
      "content": "If you attempt to update an item without providing the \"Id\" value, there is no way for the service to tell which instance to update, so the Mobile Services SDK will throw an <ph id=\"ph86\">`ArgumentException`</ph>."
    },
    {
      "pos": [
        14839,
        14841
      ],
      "content": "##"
    },
    {
      "pos": [
        14864,
        14903
      ],
      "content": "How to: Delete data in a mobile service"
    },
    {
      "pos": [
        14905,
        15039
      ],
      "content": "The following code illustrates how to delete an existing instance. The instance is identified by the \"Id\" field set on the <ph id=\"ph87\">`todoItem`</ph>.",
      "nodes": [
        {
          "content": "The following code illustrates how to delete an existing instance.",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "The instance is identified by the \"Id\" field set on the <ph id=\"ph87\">`todoItem`</ph>.",
          "pos": [
            67,
            153
          ]
        }
      ]
    },
    {
      "pos": [
        15085,
        15567
      ],
      "content": "To delete untyped data, you may take advantage of Json.NET like so. Note that when making a delete request, an ID must be specified, as that is how the mobile service identifies which instance to delete. A delete request needs only the ID; other properties are not passed to the service, and if any are passed, they are ignored at the service. The result of a <ph id=\"ph88\">`DeleteAsync`</ph><ph id=\"ph89\"/> call is usually <ph id=\"ph90\">`null`</ph><ph id=\"ph91\"/> as well. The ID to pass in can be obtained from the result of the <ph id=\"ph92\">`InsertAsync`</ph><ph id=\"ph93\"/> call.",
      "nodes": [
        {
          "content": "To delete untyped data, you may take advantage of Json.NET like so.",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "Note that when making a delete request, an ID must be specified, as that is how the mobile service identifies which instance to delete.",
          "pos": [
            68,
            203
          ]
        },
        {
          "content": "A delete request needs only the ID; other properties are not passed to the service, and if any are passed, they are ignored at the service.",
          "pos": [
            204,
            343
          ]
        },
        {
          "content": "The result of a <ph id=\"ph88\">`DeleteAsync`</ph><ph id=\"ph89\"/> call is usually <ph id=\"ph90\">`null`</ph><ph id=\"ph91\"/> as well.",
          "pos": [
            344,
            473
          ]
        },
        {
          "content": "The ID to pass in can be obtained from the result of the <ph id=\"ph92\">`InsertAsync`</ph><ph id=\"ph93\"/> call.",
          "pos": [
            474,
            584
          ]
        }
      ]
    },
    {
      "pos": [
        15693,
        16082
      ],
      "content": "If you attempt to delete an item without the \"Id\" field already set, there is no way for the service to tell which instance to delete, so you will get back a <ph id=\"ph94\">`MobileServiceInvalidOperationException`</ph><ph id=\"ph95\"/> from the service. Similarly, if you attempt to delete an untyped item without the \"Id\" field already set, you will again get back a <ph id=\"ph96\">`MobileServiceInvalidOperationException`</ph><ph id=\"ph97\"/> from the service.",
      "nodes": [
        {
          "content": "If you attempt to delete an item without the \"Id\" field already set, there is no way for the service to tell which instance to delete, so you will get back a <ph id=\"ph94\">`MobileServiceInvalidOperationException`</ph><ph id=\"ph95\"/> from the service.",
          "pos": [
            0,
            250
          ]
        },
        {
          "content": "Similarly, if you attempt to delete an untyped item without the \"Id\" field already set, you will again get back a <ph id=\"ph96\">`MobileServiceInvalidOperationException`</ph><ph id=\"ph97\"/> from the service.",
          "pos": [
            251,
            457
          ]
        }
      ]
    },
    {
      "pos": [
        16084,
        16086
      ],
      "content": "##"
    },
    {
      "pos": [
        16112,
        16137
      ],
      "content": "How to: Call a custom API"
    },
    {
      "pos": [
        16139,
        16624
      ],
      "content": "A custom API enables you to define custom endpoints that expose server functionality that does not map to an insert, update, delete, or read operation. By using a custom API, you can have more control over messaging, including reading and setting HTTP message headers and defining a message body format other than JSON. For an example of how to create a custom API in your mobile service, see <bpt id=\"p19\">[</bpt>How to: define a custom API endpoint<ept id=\"p19\">](mobile-services-dotnet-backend-define-custom-api.md)</ept>.",
      "nodes": [
        {
          "content": "A custom API enables you to define custom endpoints that expose server functionality that does not map to an insert, update, delete, or read operation.",
          "pos": [
            0,
            151
          ]
        },
        {
          "content": "By using a custom API, you can have more control over messaging, including reading and setting HTTP message headers and defining a message body format other than JSON.",
          "pos": [
            152,
            319
          ]
        },
        {
          "content": "For an example of how to create a custom API in your mobile service, see <bpt id=\"p19\">[</bpt>How to: define a custom API endpoint<ept id=\"p19\">](mobile-services-dotnet-backend-define-custom-api.md)</ept>.",
          "pos": [
            320,
            525
          ]
        }
      ]
    },
    {
      "pos": [
        16626,
        16829
      ],
      "content": "You call a custom API by calling one of the <bpt id=\"p20\">[</bpt><ept id=\"p20\">InvokeApiAsync]</ept> method overloads on the client. For example, the following line of code sends a POST request to the <bpt id=\"p21\">**</bpt>completeAll<ept id=\"p21\">**</ept><ph id=\"ph98\"/> API on the mobile service:",
      "nodes": [
        {
          "content": "You call a custom API by calling one of the <bpt id=\"p20\">[</bpt><ept id=\"p20\">InvokeApiAsync]</ept> method overloads on the client.",
          "pos": [
            0,
            132
          ]
        },
        {
          "content": "For example, the following line of code sends a POST request to the <bpt id=\"p21\">**</bpt>completeAll<ept id=\"p21\">**</ept><ph id=\"ph98\"/> API on the mobile service:",
          "pos": [
            133,
            298
          ]
        }
      ]
    },
    {
      "pos": [
        16975,
        17392
      ],
      "content": "Note that this a typed method call, which requires that the <bpt id=\"p22\">**</bpt>MarkAllResult<ept id=\"p22\">**</ept><ph id=\"ph99\"/> return type be defined. Both typed and untyped methods are supported. This is an almost trivial example as it is typed, sends no payload, has no query parameters, and doesn't change the request headers. For more realistic examples and a more a complete discussion of <bpt id=\"p23\">[</bpt><ept id=\"p23\">InvokeApiAsync]</ept>, see <bpt id=\"p24\">[</bpt><ept id=\"p24\">Custom API in Azure Mobile Services Client SDKs]</ept>.",
      "nodes": [
        {
          "content": "Note that this a typed method call, which requires that the <bpt id=\"p22\">**</bpt>MarkAllResult<ept id=\"p22\">**</ept><ph id=\"ph99\"/> return type be defined.",
          "pos": [
            0,
            156
          ]
        },
        {
          "content": "Both typed and untyped methods are supported.",
          "pos": [
            157,
            202
          ]
        },
        {
          "content": "This is an almost trivial example as it is typed, sends no payload, has no query parameters, and doesn't change the request headers.",
          "pos": [
            203,
            335
          ]
        },
        {
          "content": "For more realistic examples and a more a complete discussion of <bpt id=\"p23\">[</bpt><ept id=\"p23\">InvokeApiAsync]</ept>, see <bpt id=\"p24\">[</bpt><ept id=\"p24\">Custom API in Azure Mobile Services Client SDKs]</ept>.",
          "pos": [
            336,
            552
          ]
        }
      ]
    },
    {
      "pos": [
        17396,
        17435
      ],
      "content": "How to: Register for push notifications"
    },
    {
      "pos": [
        17437,
        17850
      ],
      "content": "The Mobile Services client enables you to register for push notifications with Azure Notification Hubs. When registering, you obtain a handle that you obtain from the platform-specific Push Notification Service (PNS). You then provide this value along with any tags when you create the registration. The following code registers your Windows app for push notifications with the Windows Notification Service (WNS):",
      "nodes": [
        {
          "content": "The Mobile Services client enables you to register for push notifications with Azure Notification Hubs.",
          "pos": [
            0,
            103
          ]
        },
        {
          "content": "When registering, you obtain a handle that you obtain from the platform-specific Push Notification Service (PNS).",
          "pos": [
            104,
            217
          ]
        },
        {
          "content": "You then provide this value along with any tags when you create the registration.",
          "pos": [
            218,
            299
          ]
        },
        {
          "content": "The following code registers your Windows app for push notifications with the Windows Notification Service (WNS):",
          "pos": [
            300,
            413
          ]
        }
      ]
    },
    {
      "pos": [
        18320,
        18548
      ],
      "content": "Note that in this example, two tags are included with the registration. For more information on Windows apps, see <bpt id=\"p25\">[</bpt>Add push notifications to your app<ept id=\"p25\">](mobile-services-dotnet-backend-windows-universal-dotnet-get-started-push.md)</ept>.",
      "nodes": [
        {
          "content": "Note that in this example, two tags are included with the registration.",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "For more information on Windows apps, see <bpt id=\"p25\">[</bpt>Add push notifications to your app<ept id=\"p25\">](mobile-services-dotnet-backend-windows-universal-dotnet-get-started-push.md)</ept>.",
          "pos": [
            72,
            268
          ]
        }
      ]
    },
    {
      "pos": [
        18550,
        19000
      ],
      "content": "Xamarin apps require some additional code to be able to register a Xamarin app running on iOS or Android app with the Apple Push Notification Service (APNS) and Google Cloud Messaging (GCM) services, respectively. For more information see <bpt id=\"p26\">**</bpt>Add push notifications to your app<ept id=\"p26\">**</ept><ph id=\"ph100\"/> (<bpt id=\"p27\">[</bpt>Xamarin.iOS<ept id=\"p27\">](partner-xamarin-mobile-services-ios-get-started-push.md#add-push)</ept><ph id=\"ph101\"/> | <bpt id=\"p28\">[</bpt>Xamarin.Android<ept id=\"p28\">](partner-xamarin-mobile-services-android-get-started-push.md#add-push)</ept>).",
      "nodes": [
        {
          "content": "Xamarin apps require some additional code to be able to register a Xamarin app running on iOS or Android app with the Apple Push Notification Service (APNS) and Google Cloud Messaging (GCM) services, respectively.",
          "pos": [
            0,
            213
          ]
        },
        {
          "content": "For more information see <bpt id=\"p26\">**</bpt>Add push notifications to your app<ept id=\"p26\">**</ept><ph id=\"ph100\"/> (<bpt id=\"p27\">[</bpt>Xamarin.iOS<ept id=\"p27\">](partner-xamarin-mobile-services-ios-get-started-push.md#add-push)</ept><ph id=\"ph101\"/> | <bpt id=\"p28\">[</bpt>Xamarin.Android<ept id=\"p28\">](partner-xamarin-mobile-services-android-get-started-push.md#add-push)</ept>).",
          "pos": [
            214,
            602
          ]
        }
      ]
    },
    {
      "pos": [
        19003,
        19489
      ],
      "content": "<ph id=\"ph102\">[AZURE.NOTE]</ph>When you need to send notifications to specific registered users, it is important to require authentication before registration, and then verify that the user is authorized to register with a specific tag. For example, you must check to make sure a user doesn't register with a tag that is someone else's user ID. For more information, see <bpt id=\"p29\">[</bpt>Send push notifications to authenticated users<ept id=\"p29\">](mobile-services-dotnet-backend-windows-store-dotnet-push-notifications-app-users.md)</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph102\">[AZURE.NOTE]</ph>When you need to send notifications to specific registered users, it is important to require authentication before registration, and then verify that the user is authorized to register with a specific tag.",
          "pos": [
            0,
            237
          ]
        },
        {
          "content": "For example, you must check to make sure a user doesn't register with a tag that is someone else's user ID.",
          "pos": [
            238,
            345
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p29\">[</bpt>Send push notifications to authenticated users<ept id=\"p29\">](mobile-services-dotnet-backend-windows-store-dotnet-push-notifications-app-users.md)</ept>.",
          "pos": [
            346,
            546
          ]
        }
      ]
    },
    {
      "pos": [
        19491,
        19493
      ],
      "content": "##"
    },
    {
      "pos": [
        19526,
        19577
      ],
      "content": "How to: Use periodic notifications in a Windows app"
    },
    {
      "pos": [
        19579,
        20076
      ],
      "content": "Windows supports period notifications (pull notifications) to update live tiles. With periodic notifications enabled, Windows will periodically access a custom API endpoint to update the app tile on the start menu. To use periodic notifications, you must <bpt id=\"p30\">[</bpt>define a custom API<ept id=\"p30\">](mobile-services-javascript-backend-define-custom-api.md)</ept><ph id=\"ph103\"/> that returns XML data in a tile-specific format. For more information, see <bpt id=\"p31\">[</bpt>Periodic notifications<ept id=\"p31\">](https://msdn.microsoft.com/library/windows/apps/hh761461.aspx)</ept>.",
      "nodes": [
        {
          "content": "Windows supports period notifications (pull notifications) to update live tiles.",
          "pos": [
            0,
            80
          ]
        },
        {
          "content": "With periodic notifications enabled, Windows will periodically access a custom API endpoint to update the app tile on the start menu.",
          "pos": [
            81,
            214
          ]
        },
        {
          "content": "To use periodic notifications, you must <bpt id=\"p30\">[</bpt>define a custom API<ept id=\"p30\">](mobile-services-javascript-backend-define-custom-api.md)</ept><ph id=\"ph103\"/> that returns XML data in a tile-specific format.",
          "pos": [
            215,
            438
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p31\">[</bpt>Periodic notifications<ept id=\"p31\">](https://msdn.microsoft.com/library/windows/apps/hh761461.aspx)</ept>.",
          "pos": [
            439,
            593
          ]
        }
      ]
    },
    {
      "pos": [
        20078,
        20191
      ],
      "content": "The following example turns on period notifications to request tile template data from a <bpt id=\"p32\">*</bpt>tiles<ept id=\"p32\">*</ept><ph id=\"ph104\"/> custom endpoint:"
    },
    {
      "pos": [
        20384,
        20582
      ],
      "content": "Select a <bpt id=\"p33\">[</bpt>PeriodicUpdateRecurrance<ept id=\"p33\">](https://msdn.microsoft.com/library/windows/apps/windows.ui.notifications.periodicupdaterecurrence.aspx)</ept><ph id=\"ph105\"/> value that best matches the update frequency of your data."
    },
    {
      "pos": [
        20584,
        20586
      ],
      "content": "##"
    },
    {
      "pos": [
        20622,
        20656
      ],
      "content": "How to: Use optimistic concurrency"
    },
    {
      "pos": [
        20658,
        21192
      ],
      "content": "Two or more clients may write changes to the same item, at the same time, in some scenarios. Without any conflict detection, the last write would overwrite any previous updates even if this was not the desired result. Optimistic Concurrency Control assumes that each transaction can commit and therefore does not use any resource locking. Before committing a transaction, optimistic concurrency control verifies that no other transaction has modified the data. If the data has been modified, the committing transaction is rolled back.",
      "nodes": [
        {
          "content": "Two or more clients may write changes to the same item, at the same time, in some scenarios.",
          "pos": [
            0,
            92
          ]
        },
        {
          "content": "Without any conflict detection, the last write would overwrite any previous updates even if this was not the desired result.",
          "pos": [
            93,
            217
          ]
        },
        {
          "content": "Optimistic Concurrency Control assumes that each transaction can commit and therefore does not use any resource locking.",
          "pos": [
            218,
            338
          ]
        },
        {
          "content": "Before committing a transaction, optimistic concurrency control verifies that no other transaction has modified the data.",
          "pos": [
            339,
            460
          ]
        },
        {
          "content": "If the data has been modified, the committing transaction is rolled back.",
          "pos": [
            461,
            534
          ]
        }
      ]
    },
    {
      "pos": [
        21194,
        22102
      ],
      "content": "Mobile Services supports optimistic concurrency control by tracking changes to each item using the <ph id=\"ph106\">`__version`</ph><ph id=\"ph107\"/> system property column that is defined for each table created by Mobile Services. Each time a record is updated, Mobile Services sets the <ph id=\"ph108\">`__version`</ph><ph id=\"ph109\"/> property for that record to a new value. During each update request, the <ph id=\"ph110\">`__version`</ph><ph id=\"ph111\"/> property of the record included with the request is compared to the same property for the record on the server. If the version passed with the request does not match the server, then the Mobile Services .NET client library throws a <ph id=\"ph112\">`MobileServicePreconditionFailedException&lt;T&gt;`</ph>. The type included with the exception is the record from the server containing the server's version of the record. The application can then use this information to decide whether to execute the update request again with the correct <ph id=\"ph113\">`__version`</ph><ph id=\"ph114\"/> value from the server to commit changes.",
      "nodes": [
        {
          "content": "Mobile Services supports optimistic concurrency control by tracking changes to each item using the <ph id=\"ph106\">`__version`</ph><ph id=\"ph107\"/> system property column that is defined for each table created by Mobile Services.",
          "pos": [
            0,
            228
          ]
        },
        {
          "content": "Each time a record is updated, Mobile Services sets the <ph id=\"ph108\">`__version`</ph><ph id=\"ph109\"/> property for that record to a new value.",
          "pos": [
            229,
            373
          ]
        },
        {
          "content": "During each update request, the <ph id=\"ph110\">`__version`</ph><ph id=\"ph111\"/> property of the record included with the request is compared to the same property for the record on the server.",
          "pos": [
            374,
            565
          ]
        },
        {
          "content": "If the version passed with the request does not match the server, then the Mobile Services .NET client library throws a <ph id=\"ph112\">`MobileServicePreconditionFailedException&lt;T&gt;`</ph>.",
          "pos": [
            566,
            758
          ]
        },
        {
          "content": "The type included with the exception is the record from the server containing the server's version of the record.",
          "pos": [
            759,
            872
          ]
        },
        {
          "content": "The application can then use this information to decide whether to execute the update request again with the correct <ph id=\"ph113\">`__version`</ph><ph id=\"ph114\"/> value from the server to commit changes.",
          "pos": [
            873,
            1078
          ]
        }
      ]
    },
    {
      "pos": [
        22104,
        22271
      ],
      "content": "To enable optimistic concurrency the application defines a column on the table class for the <ph id=\"ph115\">`__version`</ph><ph id=\"ph116\"/> system property. The following definition provides an example.",
      "nodes": [
        {
          "content": "To enable optimistic concurrency the application defines a column on the table class for the <ph id=\"ph115\">`__version`</ph><ph id=\"ph116\"/> system property.",
          "pos": [
            0,
            157
          ]
        },
        {
          "content": "The following definition provides an example.",
          "pos": [
            158,
            203
          ]
        }
      ]
    },
    {
      "pos": [
        22682,
        22826
      ],
      "content": "Applications using untyped tables enable optimistic concurrency by setting the <ph id=\"ph117\">`Version`</ph><ph id=\"ph118\"/> flag on the <ph id=\"ph119\">`SystemProperties`</ph><ph id=\"ph120\"/> of the table as follows."
    },
    {
      "pos": [
        22963,
        23133
      ],
      "content": "The following code shows how to resolve a write conflict once detected. The correct <ph id=\"ph121\">`__version`</ph><ph id=\"ph122\"/> value must be included in the <ph id=\"ph123\">`UpdateAsync()`</ph><ph id=\"ph124\"/> call to commit a resolution.",
      "nodes": [
        {
          "content": "The following code shows how to resolve a write conflict once detected.",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "The correct <ph id=\"ph121\">`__version`</ph><ph id=\"ph122\"/> value must be included in the <ph id=\"ph123\">`UpdateAsync()`</ph><ph id=\"ph124\"/> call to commit a resolution.",
          "pos": [
            72,
            242
          ]
        }
      ]
    },
    {
      "pos": [
        25112,
        25235
      ],
      "content": "For a more complete example of using optimistic concurrency for Mobile Services, see the [Optimistic Concurrency Tutorial]."
    },
    {
      "pos": [
        25238,
        25240
      ],
      "content": "##"
    },
    {
      "pos": [
        25262,
        25322
      ],
      "content": "How to: Bind mobile service data to a Windows user interface"
    },
    {
      "pos": [
        25324,
        25662
      ],
      "content": "This section shows how to display returned data objects using UI elements in a Windows app. To query incomplete items in <ph id=\"ph125\">`todoTable`</ph><ph id=\"ph126\"/> and display it in a very simple list, you can run the following example code to bind the source of the list with a query. Using <ph id=\"ph127\">`MobileServiceCollection`</ph><ph id=\"ph128\"/> creates a mobile services-aware binding collection.",
      "nodes": [
        {
          "content": "This section shows how to display returned data objects using UI elements in a Windows app.",
          "pos": [
            0,
            91
          ]
        },
        {
          "content": "To query incomplete items in <ph id=\"ph125\">`todoTable`</ph><ph id=\"ph126\"/> and display it in a very simple list, you can run the following example code to bind the source of the list with a query.",
          "pos": [
            92,
            290
          ]
        },
        {
          "content": "Using <ph id=\"ph127\">`MobileServiceCollection`</ph><ph id=\"ph128\"/> creates a mobile services-aware binding collection.",
          "pos": [
            291,
            410
          ]
        }
      ]
    },
    {
      "pos": [
        26083,
        26578
      ],
      "content": "Some controls in the managed runtime support an interface called <bpt id=\"p34\">[</bpt>ISupportIncrementalLoading<ept id=\"p34\">](http://msdn.microsoft.com/library/windows/apps/Hh701916)</ept>. This interface allows controls to request extra data when the user scrolls. There is built-in support for this interface for universal Windows 8.1 apps via <ph id=\"ph129\">`MobileServiceIncrementalLoadingCollection`</ph>, which automatically handles the calls from the controls. To use <ph id=\"ph130\">`MobileServiceIncrementalLoadingCollection`</ph><ph id=\"ph131\"/> in Windows apps, do the following:",
      "nodes": [
        {
          "content": "Some controls in the managed runtime support an interface called <bpt id=\"p34\">[</bpt>ISupportIncrementalLoading<ept id=\"p34\">](http://msdn.microsoft.com/library/windows/apps/Hh701916)</ept>.",
          "pos": [
            0,
            191
          ]
        },
        {
          "content": "This interface allows controls to request extra data when the user scrolls.",
          "pos": [
            192,
            267
          ]
        },
        {
          "content": "There is built-in support for this interface for universal Windows 8.1 apps via <ph id=\"ph129\">`MobileServiceIncrementalLoadingCollection`</ph>, which automatically handles the calls from the controls.",
          "pos": [
            268,
            469
          ]
        },
        {
          "content": "To use <ph id=\"ph130\">`MobileServiceIncrementalLoadingCollection`</ph><ph id=\"ph131\"/> in Windows apps, do the following:",
          "pos": [
            470,
            591
          ]
        }
      ]
    },
    {
      "pos": [
        26859,
        27083
      ],
      "content": "To use the new collection on Windows Phone 8 and \"Silverlight\" apps, use the <ph id=\"ph132\">`ToCollection`</ph><ph id=\"ph133\"/> extension methods on <ph id=\"ph134\">`IMobileServiceTableQuery&lt;T&gt;`</ph><ph id=\"ph135\"/> and <ph id=\"ph136\">`IMobileServiceTable&lt;T&gt;`</ph>. To actually load data, call <ph id=\"ph137\">`LoadMoreItemsAsync()`</ph>.",
      "nodes": [
        {
          "content": "To use the new collection on Windows Phone 8 and \"Silverlight\" apps, use the <ph id=\"ph132\">`ToCollection`</ph><ph id=\"ph133\"/> extension methods on <ph id=\"ph134\">`IMobileServiceTableQuery&lt;T&gt;`</ph><ph id=\"ph135\"/> and <ph id=\"ph136\">`IMobileServiceTable&lt;T&gt;`</ph>.",
          "pos": [
            0,
            276
          ]
        },
        {
          "content": "To actually load data, call <ph id=\"ph137\">`LoadMoreItemsAsync()`</ph>.",
          "pos": [
            277,
            348
          ]
        }
      ]
    },
    {
      "pos": [
        27250,
        27932
      ],
      "content": "When you use the collection created by calling <ph id=\"ph138\">`ToCollectionAsync`</ph><ph id=\"ph139\"/> or <ph id=\"ph140\">`ToCollection`</ph>, you get a collection which can be bound to UI controls. This collection is paging-aware, i.e., a control can ask the collection to \"load more items\", and the collection will do it for the control. At that point there is no user code involved, the control will start the flow. However, since the collection is loading data from the network, it's expected that some times this loading will fail. To handle such failures, you may override the <ph id=\"ph141\">`OnException`</ph><ph id=\"ph142\"/> method on <ph id=\"ph143\">`MobileServiceIncrementalLoadingCollection`</ph><ph id=\"ph144\"/> to handle exceptions resulting from calls to <ph id=\"ph145\">`LoadMoreItemsAsync`</ph><ph id=\"ph146\"/> performed by controls.",
      "nodes": [
        {
          "content": "When you use the collection created by calling <ph id=\"ph138\">`ToCollectionAsync`</ph><ph id=\"ph139\"/> or <ph id=\"ph140\">`ToCollection`</ph>, you get a collection which can be bound to UI controls.",
          "pos": [
            0,
            197
          ]
        },
        {
          "content": "This collection is paging-aware, i.e., a control can ask the collection to \"load more items\", and the collection will do it for the control.",
          "pos": [
            198,
            338
          ]
        },
        {
          "content": "At that point there is no user code involved, the control will start the flow.",
          "pos": [
            339,
            417
          ]
        },
        {
          "content": "However, since the collection is loading data from the network, it's expected that some times this loading will fail.",
          "pos": [
            418,
            535
          ]
        },
        {
          "content": "To handle such failures, you may override the <ph id=\"ph141\">`OnException`</ph><ph id=\"ph142\"/> method on <ph id=\"ph143\">`MobileServiceIncrementalLoadingCollection`</ph><ph id=\"ph144\"/> to handle exceptions resulting from calls to <ph id=\"ph145\">`LoadMoreItemsAsync`</ph><ph id=\"ph146\"/> performed by controls.",
          "pos": [
            536,
            846
          ]
        }
      ]
    },
    {
      "pos": [
        27934,
        28177
      ],
      "content": "Finally, imagine that your table has many fields, but you only want to display some of them in your control. You may use the guidance in the section \"<bpt id=\"p35\">[</bpt>Select specific columns<ept id=\"p35\">](#selecting)</ept>\" above to select specific columns to display in the UI.",
      "nodes": [
        {
          "content": "Finally, imagine that your table has many fields, but you only want to display some of them in your control.",
          "pos": [
            0,
            108
          ]
        },
        {
          "content": "You may use the guidance in the section \"<bpt id=\"p35\">[</bpt>Select specific columns<ept id=\"p35\">](#selecting)</ept>\" above to select specific columns to display in the UI.",
          "pos": [
            109,
            283
          ]
        }
      ]
    },
    {
      "pos": [
        28179,
        28181
      ],
      "content": "##"
    },
    {
      "pos": [
        28210,
        28236
      ],
      "content": "How to: Authenticate users"
    },
    {
      "pos": [
        28238,
        28709
      ],
      "content": "Mobile Services supports authenticating and authorizing app users using a variety of external identity providers: Facebook, Google, Microsoft Account, Twitter, and Azure Active Directory. You can set permissions on tables to restrict access for specific operations to only authenticated users. You can also use the identity of authenticated users to implement authorization rules in server scripts. For more information, see the tutorial [Add authentication to your app].",
      "nodes": [
        {
          "content": "Mobile Services supports authenticating and authorizing app users using a variety of external identity providers: Facebook, Google, Microsoft Account, Twitter, and Azure Active Directory.",
          "pos": [
            0,
            187
          ]
        },
        {
          "content": "You can set permissions on tables to restrict access for specific operations to only authenticated users.",
          "pos": [
            188,
            293
          ]
        },
        {
          "content": "You can also use the identity of authenticated users to implement authorization rules in server scripts.",
          "pos": [
            294,
            398
          ]
        },
        {
          "content": "For more information, see the tutorial [Add authentication to your app].",
          "pos": [
            399,
            471
          ]
        }
      ]
    },
    {
      "pos": [
        28711,
        29049
      ],
      "content": "Two authentication flows are supported: a <bpt id=\"p36\">_</bpt>server flow<ept id=\"p36\">_</ept><ph id=\"ph147\"/> and a <bpt id=\"p37\">_</bpt>client flow<ept id=\"p37\">_</ept>. The server flow provides the simplest authentication experience, as it relies on the provider's web authentication interface. The client flow allows for deeper integration with device-specific capabilities as it relies on provider-specific device-specific SDKs.",
      "nodes": [
        {
          "content": "Two authentication flows are supported: a <bpt id=\"p36\">_</bpt>server flow<ept id=\"p36\">_</ept><ph id=\"ph147\"/> and a <bpt id=\"p37\">_</bpt>client flow<ept id=\"p37\">_</ept>.",
          "pos": [
            0,
            172
          ]
        },
        {
          "content": "The server flow provides the simplest authentication experience, as it relies on the provider's web authentication interface.",
          "pos": [
            173,
            298
          ]
        },
        {
          "content": "The client flow allows for deeper integration with device-specific capabilities as it relies on provider-specific device-specific SDKs.",
          "pos": [
            299,
            434
          ]
        }
      ]
    },
    {
      "pos": [
        29054,
        29065
      ],
      "content": "Server flow"
    },
    {
      "pos": [
        29066,
        29145
      ],
      "content": "To have Mobile Services manage the authentication process in your Windows apps,"
    },
    {
      "pos": [
        29146,
        29382
      ],
      "content": "you must register your app with your identity provider. Then in your mobile service, you need to configure the application ID and secret provided by your provider. For more information, see the tutorial [Add authentication to your app].",
      "nodes": [
        {
          "content": "you must register your app with your identity provider.",
          "pos": [
            0,
            55
          ]
        },
        {
          "content": "Then in your mobile service, you need to configure the application ID and secret provided by your provider.",
          "pos": [
            56,
            163
          ]
        },
        {
          "content": "For more information, see the tutorial [Add authentication to your app].",
          "pos": [
            164,
            236
          ]
        }
      ]
    },
    {
      "pos": [
        29384,
        29622
      ],
      "content": "Once you have registered your identity provider, simply call the [LoginAsync method] with the [MobileServiceAuthenticationProvider] value of your provider. For example, the following code initiates a server flow sign-in by using Facebook.",
      "nodes": [
        {
          "content": "Once you have registered your identity provider, simply call the [LoginAsync method] with the [MobileServiceAuthenticationProvider] value of your provider.",
          "pos": [
            0,
            155
          ]
        },
        {
          "content": "For example, the following code initiates a server flow sign-in by using Facebook.",
          "pos": [
            156,
            238
          ]
        }
      ]
    },
    {
      "pos": [
        30356,
        30510
      ],
      "content": "If you are using an identity provider other than Facebook, change the value of [MobileServiceAuthenticationProvider] above to the value for your provider."
    },
    {
      "pos": [
        30512,
        31048
      ],
      "content": "In this case, Mobile Services manages the OAuth 2.0 authentication flow by displaying the sign-in page of the selected provider and generating a Mobile Services authentication token after successful sign-on with the identity provider. The [LoginAsync method] returns a [MobileServiceUser], which provides both the [userId] of the authenticated user and the [MobileServiceAuthenticationToken], as a JSON web token (JWT). This token can be cached and re-used until it expires. For more information, see [Caching the authentication token].",
      "nodes": [
        {
          "content": "In this case, Mobile Services manages the OAuth 2.0 authentication flow by displaying the sign-in page of the selected provider and generating a Mobile Services authentication token after successful sign-on with the identity provider.",
          "pos": [
            0,
            234
          ]
        },
        {
          "content": "The [LoginAsync method] returns a [MobileServiceUser], which provides both the [userId] of the authenticated user and the [MobileServiceAuthenticationToken], as a JSON web token (JWT).",
          "pos": [
            235,
            419
          ]
        },
        {
          "content": "This token can be cached and re-used until it expires.",
          "pos": [
            420,
            474
          ]
        },
        {
          "content": "For more information, see [Caching the authentication token].",
          "pos": [
            475,
            536
          ]
        }
      ]
    },
    {
      "pos": [
        31053,
        31064
      ],
      "content": "Client flow"
    },
    {
      "pos": [
        31066,
        31344
      ],
      "content": "Your app can also independently contact the identity provider and then provide the returned token to Mobile Services for authentication. This client flow enables you to provide a single sign-in experience for users or to retrieve additional user data from the identity provider.",
      "nodes": [
        {
          "content": "Your app can also independently contact the identity provider and then provide the returned token to Mobile Services for authentication.",
          "pos": [
            0,
            136
          ]
        },
        {
          "content": "This client flow enables you to provide a single sign-in experience for users or to retrieve additional user data from the identity provider.",
          "pos": [
            137,
            278
          ]
        }
      ]
    },
    {
      "pos": [
        31350,
        31402
      ],
      "content": "Single sign-in using a token from Facebook or Google"
    },
    {
      "pos": [
        31404,
        31509
      ],
      "content": "In the most simplified form, you can use the client flow as shown in this snippet for Facebook or Google."
    },
    {
      "pos": [
        32621,
        32677
      ],
      "content": "Single sign-in using Microsoft Account with the Live SDK"
    },
    {
      "pos": [
        32679,
        33193
      ],
      "content": "To be able to authenticate users, you must register your app at the Microsoft account Developer Center. You must then connect this registration with your mobile service. Complete the steps in <bpt id=\"p38\">[</bpt>Register your app to use a Microsoft account login<ept id=\"p38\">](mobile-services-how-to-register-microsoft-authentication.md)</ept><ph id=\"ph148\"/> to create a Microsoft account registration and connect it to your mobile service. If you have both Windows Store and Windows Phone 8/Silverlight versions of your app, register the Windows Store version first.",
      "nodes": [
        {
          "content": "To be able to authenticate users, you must register your app at the Microsoft account Developer Center.",
          "pos": [
            0,
            103
          ]
        },
        {
          "content": "You must then connect this registration with your mobile service.",
          "pos": [
            104,
            169
          ]
        },
        {
          "content": "Complete the steps in <bpt id=\"p38\">[</bpt>Register your app to use a Microsoft account login<ept id=\"p38\">](mobile-services-how-to-register-microsoft-authentication.md)</ept><ph id=\"ph148\"/> to create a Microsoft account registration and connect it to your mobile service.",
          "pos": [
            170,
            443
          ]
        },
        {
          "content": "If you have both Windows Store and Windows Phone 8/Silverlight versions of your app, register the Windows Store version first.",
          "pos": [
            444,
            570
          ]
        }
      ]
    },
    {
      "pos": [
        33195,
        33305
      ],
      "content": "The following code authenticates using Live SDK and uses the returned token to sign-in to your mobile service."
    },
    {
      "pos": [
        35514,
        35517
      ],
      "content": "###"
    },
    {
      "pos": [
        35539,
        35571
      ],
      "content": "Caching the authentication token"
    },
    {
      "pos": [
        35572,
        35965
      ],
      "content": "In some cases, the call to the login method can be avoided after the first time the user authenticates. You can use [PasswordVault] for Windows Store apps to cache the current user identity the first time they log in and every subsequent time you check whether you already have the user identity in our cache. When the cache is empty, you still need to send the user through the login process.",
      "nodes": [
        {
          "content": "In some cases, the call to the login method can be avoided after the first time the user authenticates.",
          "pos": [
            0,
            103
          ]
        },
        {
          "content": "You can use [PasswordVault] for Windows Store apps to cache the current user identity the first time they log in and every subsequent time you check whether you already have the user identity in our cache.",
          "pos": [
            104,
            309
          ]
        },
        {
          "content": "When the cache is empty, you still need to send the user through the login process.",
          "pos": [
            310,
            393
          ]
        }
      ]
    },
    {
      "pos": [
        36864,
        37003
      ],
      "content": "For Windows Phone apps, you may encrypt and cache data using the [ProtectedData] class and store sensitive information in isolated storage."
    },
    {
      "pos": [
        37005,
        37007
      ],
      "content": "##"
    },
    {
      "pos": [
        37028,
        37049
      ],
      "content": "How to: Handle errors"
    },
    {
      "pos": [
        37051,
        37140
      ],
      "content": "There are several ways to encounter, validate, and work around errors in Mobile Services."
    },
    {
      "pos": [
        37142,
        37429
      ],
      "content": "As an example, server scripts are registered in a mobile service and can be used to perform a wide range of operations on data being inserted and updated, including validation and data modification. Imagine defining and registering a server script that validate and modify data, like so:",
      "nodes": [
        {
          "content": "As an example, server scripts are registered in a mobile service and can be used to perform a wide range of operations on data being inserted and updated, including validation and data modification.",
          "pos": [
            0,
            198
          ]
        },
        {
          "content": "Imagine defining and registering a server script that validate and modify data, like so:",
          "pos": [
            199,
            287
          ]
        }
      ]
    },
    {
      "pos": [
        37674,
        37839
      ],
      "content": "This server-side script validates the length of string data sent to the mobile service and rejects strings that are too long, in this case longer than 10 characters."
    },
    {
      "pos": [
        37841,
        38018
      ],
      "content": "Now that the mobile service is validating data and sending error responses on the server-side, you can update your .NET app to be able to handle error responses from validation."
    },
    {
      "pos": [
        38494,
        38496
      ],
      "content": "##"
    },
    {
      "pos": [
        38518,
        38548
      ],
      "content": "How to: Work with untyped data"
    },
    {
      "pos": [
        38550,
        38835
      ],
      "content": "The .NET client is designed for strongly typed scenarios. However, sometimes, a more loosely typed experience is convenient; for example, this could be when dealing with objects with open schema. That scenario is enabled as follows. In queries, you forego LINQ and use the wire format.",
      "nodes": [
        {
          "content": "The .NET client is designed for strongly typed scenarios.",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "However, sometimes, a more loosely typed experience is convenient; for example, this could be when dealing with objects with open schema.",
          "pos": [
            58,
            195
          ]
        },
        {
          "content": "That scenario is enabled as follows.",
          "pos": [
            196,
            232
          ]
        },
        {
          "content": "In queries, you forego LINQ and use the wire format.",
          "pos": [
            233,
            285
          ]
        }
      ]
    },
    {
      "pos": [
        39087,
        39236
      ],
      "content": "You get back JSON values that you can use like a property bag. For more information on JToken and Json.NET, see <bpt id=\"p39\">[</bpt>Json.NET<ept id=\"p39\">](http://json.codeplex.com/)</ept>",
      "nodes": [
        {
          "content": "You get back JSON values that you can use like a property bag.",
          "pos": [
            0,
            62
          ]
        },
        {
          "content": "For more information on JToken and Json.NET, see <bpt id=\"p39\">[</bpt>Json.NET<ept id=\"p39\">](http://json.codeplex.com/)</ept>",
          "pos": [
            63,
            189
          ]
        }
      ]
    },
    {
      "pos": [
        39238,
        39240
      ],
      "content": "##"
    },
    {
      "pos": [
        39267,
        39292
      ],
      "content": "How to: Design unit tests"
    },
    {
      "pos": [
        39294,
        39538
      ],
      "content": "The value returned by <ph id=\"ph149\">`MobileServiceClient.GetTable`</ph><ph id=\"ph150\"/> and the queries are interfaces. That makes them easily \"mockable\" for testing purposes, so you could create a <ph id=\"ph151\">`MyMockTable : IMobileServiceTable&lt;TodoItem&gt;`</ph><ph id=\"ph152\"/> that implements your testing logic.",
      "nodes": [
        {
          "content": "The value returned by <ph id=\"ph149\">`MobileServiceClient.GetTable`</ph><ph id=\"ph150\"/> and the queries are interfaces.",
          "pos": [
            0,
            120
          ]
        },
        {
          "content": "That makes them easily \"mockable\" for testing purposes, so you could create a <ph id=\"ph151\">`MyMockTable : IMobileServiceTable&lt;TodoItem&gt;`</ph><ph id=\"ph152\"/> that implements your testing logic.",
          "pos": [
            121,
            322
          ]
        }
      ]
    },
    {
      "pos": [
        39540,
        39542
      ],
      "content": "##"
    },
    {
      "pos": [
        39568,
        39596
      ],
      "content": "How to: Customize the client"
    },
    {
      "pos": [
        39598,
        39733
      ],
      "content": "This section shows ways in which you can customize the request headers and customize the serialization of JSON objects in the response."
    },
    {
      "pos": [
        39761,
        39794
      ],
      "content": "How to: Customize request headers"
    },
    {
      "pos": [
        39796,
        40101
      ],
      "content": "To support your specific app scenario, you might need to customize communication with the mobile service. For example, you may want to add a custom header to every outgoing request or even change responses status codes. You can do this by providing a custom DelegatingHandler, as in the following example:",
      "nodes": [
        {
          "content": "To support your specific app scenario, you might need to customize communication with the mobile service.",
          "pos": [
            0,
            105
          ]
        },
        {
          "content": "For example, you may want to add a custom header to every outgoing request or even change responses status codes.",
          "pos": [
            106,
            219
          ]
        },
        {
          "content": "You can do this by providing a custom DelegatingHandler, as in the following example:",
          "pos": [
            220,
            305
          ]
        }
      ]
    },
    {
      "pos": [
        41076,
        41303
      ],
      "content": "This code adds a new <bpt id=\"p40\">**</bpt>x-my-header<ept id=\"p40\">**</ept><ph id=\"ph153\"/> header in the request and arbitrarily sets the response code to unavailable. In a real-world scenario, you would set the response status code based on some custom logic required by your app.",
      "nodes": [
        {
          "content": "This code adds a new <bpt id=\"p40\">**</bpt>x-my-header<ept id=\"p40\">**</ept><ph id=\"ph153\"/> header in the request and arbitrarily sets the response code to unavailable.",
          "pos": [
            0,
            169
          ]
        },
        {
          "content": "In a real-world scenario, you would set the response status code based on some custom logic required by your app.",
          "pos": [
            170,
            283
          ]
        }
      ]
    },
    {
      "pos": [
        41337,
        41368
      ],
      "content": "How to: Customize serialization"
    },
    {
      "pos": [
        41370,
        41884
      ],
      "content": "The Mobile Services client library uses Json.NET to convert a JSON response into .NET objects on the client. You can configure the behavior of this serialization between .NET types and JSON in the messages. The <bpt id=\"p41\">[</bpt>MobileServiceClient<ept id=\"p41\">](http://msdn.microsoft.com/library/microsoft.windowsazure.mobileservices.mobileserviceclient.aspx)</ept><ph id=\"ph154\"/> class exposes a <ph id=\"ph155\">`SerializerSettings`</ph><ph id=\"ph156\"/> property of type <bpt id=\"p42\">[</bpt>JsonSerializerSettings<ept id=\"p42\">](http://james.newtonking.com/projects/json/help/?topic=html/T_Newtonsoft_Json_JsonSerializerSettings.htm)</ept>",
      "nodes": [
        {
          "content": "The Mobile Services client library uses Json.NET to convert a JSON response into .NET objects on the client.",
          "pos": [
            0,
            108
          ]
        },
        {
          "content": "You can configure the behavior of this serialization between .NET types and JSON in the messages.",
          "pos": [
            109,
            206
          ]
        },
        {
          "content": "The <bpt id=\"p41\">[</bpt>MobileServiceClient<ept id=\"p41\">](http://msdn.microsoft.com/library/microsoft.windowsazure.mobileservices.mobileserviceclient.aspx)</ept><ph id=\"ph154\"/> class exposes a <ph id=\"ph155\">`SerializerSettings`</ph><ph id=\"ph156\"/> property of type <bpt id=\"p42\">[</bpt>JsonSerializerSettings<ept id=\"p42\">](http://james.newtonking.com/projects/json/help/?topic=html/T_Newtonsoft_Json_JsonSerializerSettings.htm)</ept>",
          "pos": [
            207,
            646
          ]
        }
      ]
    },
    {
      "pos": [
        41886,
        41978
      ],
      "content": "Using this property, you may set one of the many Json.NET properties, such as the following:"
    },
    {
      "pos": [
        42150,
        42223
      ],
      "content": "This property converts all properties to lower case during serialization."
    },
    {
      "pos": [
        42243,
        43381
      ],
      "content": "[What is Mobile Services]: #what-is\n[Concepts]: #concepts\n[How to: Create the Mobile Services client]: #create-client\n[How to: Create a table reference]: #instantiating\n[How to: Query data from a mobile service]: #querying\n[Filter returned data]: #filtering\n[Sort returned data]: #sorting\n[Return data in pages]: #paging\n[Select specific columns]: #selecting\n[Look up data by ID]: #lookingup\n[How to: Bind data to user interface in a mobile service]: #binding\n[How to: Insert data into a mobile service]: #inserting\n[How to: Modify data in a mobile service]: #modifying\n[How to: Delete data in a mobile service]: #deleting\n[How to: Use Optimistic Concurrency]: #optimisticconcurrency\n[How to: Authenticate users]: #authentication\n[How to: Handle errors]: #errors\n[How to: Design unit tests]: #unit-testing\n[How to: Query data from a mobile service]: #querying\n[How to: Customize the client]: #customizing\n[How to: Work with untyped data]: #untyped\n[Customize request headers]: #headers\n[Customize serialization]: #serialization\n[Next steps]: #nextsteps\n[Caching the authentication token]: #caching\n[How to: Call a custom API]: #custom-api"
    },
    {
      "pos": [
        43418,
        44940
      ],
      "content": "[Add authentication to your app]: mobile-services-dotnet-backend-windows-universal-dotnet-get-started-users.md\n[PasswordVault]: http://msdn.microsoft.com/library/windows/apps/windows.security.credentials.passwordvault.aspx\n[ProtectedData]: http://msdn.microsoft.com/library/system.security.cryptography.protecteddata%28VS.95%29.aspx\n[LoginAsync method]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceclientextensions.loginasync.aspx\n[MobileServiceAuthenticationProvider]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceauthenticationprovider.aspx\n[MobileServiceUser]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.aspx\n[UserID]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.userid.aspx\n[MobileServiceAuthenticationToken]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.mobileserviceauthenticationtoken.aspx\n[ASCII control codes C0 and C1]: http://en.wikipedia.org/wiki/Data_link_escape_character#C1_set\n[CLI to manage Mobile Services tables]: ../virtual-machines-command-line-tools.md/#Commands_to_manage_mobile_services\n[Optimistic Concurrency Tutorial]: mobile-services-windows-store-dotnet-handle-database-conflicts.md\n[MobileServiceClient]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.mobileservices.mobileserviceclient.aspx"
    }
  ],
  "content": "<properties\n    pageTitle=\"Working with the Mobile Services managed client library (Windows | Xamarin) | Microsoft Azure\"\n    description=\"Learn how to use a .NET client for Azure Mobile Services with Windows and Xamarin apps.\"\n    services=\"mobile-services\"\n    documentationCenter=\"\"\n    authors=\"ggailey777\"\n    manager=\"dwrede\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"mobile-services\"\n    ms.workload=\"mobile\"\n    ms.tgt_pltfrm=\"mobile-multiple\"\n    ms.devlang=\"dotnet\"\n    ms.topic=\"article\"\n    ms.date=\"01/28/2016\"\n    ms.author=\"glenga\"/>\n\n# How to use the managed client library for Azure Mobile Services\n\n[AZURE.INCLUDE [mobile-service-note-mobile-apps](../../includes/mobile-services-note-mobile-apps.md)]\n\n&nbsp;\n\n\n[AZURE.INCLUDE [mobile-services-selector-client-library](../../includes/mobile-services-selector-client-library.md)]\n\n##Overview\n\nThis guide shows you how to perform common scenarios using the managed client library for Azure Mobile Services in Windows and Xamarin apps. The scenarios covered include querying for data, inserting, updating, and deleting data, authenticating users, and handling errors. If you are new to Mobile Services, you should consider first completing the [Mobile Services quickstart](mobile-services-dotnet-backend-xamarin-ios-get-started.md) tutorial.\n\n[AZURE.INCLUDE [mobile-services-concepts](../../includes/mobile-services-concepts.md)]\n\n##<a name=\"setup\"></a>Setup and Prerequisites\n\nWe assume that you have created a mobile service and a table. For more information see [Create a table](http://go.microsoft.com/fwlink/?LinkId=298592). In the code used in this topic, the table is named `TodoItem` and it will have the following columns: `Id`, `Text`, and `Complete`.\n\nThe corresponding typed client-side .NET type is the following:\n\n\n    public class TodoItem\n    {\n        public string Id { get; set; }\n\n        [JsonProperty(PropertyName = \"text\")]\n        public string Text { get; set; }\n\n        [JsonProperty(PropertyName = \"complete\")]\n        public bool Complete { get; set; }\n    }\n\nNote that the [JsonPropertyAttribute](http://www.newtonsoft.com/json/help/html/Properties_T_Newtonsoft_Json_JsonPropertyAttribute.htm) is used to define the mapping between the PropertyName mapping between the client type and the table.\n\nWhen dynamic schema is enabled in a JavaScript backend mobile service, Azure Mobile Services automatically generates new columns based on the object in insert or update requests. For more information, see [Dynamic schema](http://go.microsoft.com/fwlink/?LinkId=296271). In a .NET backend mobile service, the table is defined in the data model of the project.\n\n##<a name=\"create-client\"></a>How to: Create the Mobile Services client\n\nThe following code creates the `MobileServiceClient` object that is used to access your mobile service.\n\n\n    MobileServiceClient client = new MobileServiceClient(\n        \"AppUrl\",\n        \"AppKey\"\n    );\n\nIn the code above, replace `AppUrl` and `AppKey` with the mobile service URL and application key, in that order. Both of these are available on the Azure classic portal, by selecting your mobile service and then clicking on \"Dashboard\".\n\n>[AZURE.IMPORTANT]The application key is intended to filter-out random request against your mobile service, and it is distributed with the application. Because this key is not encrypted, it cannot be considered secure. To truly secure your mobile service data, you must instead authenticate users before allowing access. For more information, see [How to: Authenticate users](#authentication).\n\n##<a name=\"instantiating\"></a>How to: Create a table reference\n\nAll of the code that accesses or modifies data in the Mobile Services table calls functions on the `MobileServiceTable` object. You get a reference to the table by calling the [GetTable](https://msdn.microsoft.com/library/azure/jj554275.aspx) method on an instance of the `MobileServiceClient`, as follows:\n\n    IMobileServiceTable<TodoItem> todoTable =\n        client.GetTable<TodoItem>();\n\nThis is the typed serialization model; see the discussion of the [untyped serialization model](#untyped) below.\n\n##<a name=\"querying\"></a>How to: Query data from a mobile service\n\nThis section describes how to issue queries to the mobile service, which includes the following functionality:\n\n- [Filter returned data]\n- [Sort returned data]\n- [Return data in pages]\n- [Select specific columns]\n- [Look up data by ID]\n\n>[AZURE.NOTE] A server-driven page size is enforced to prevent all rows from being returned. This keeps default requests for large data sets from negatively impacting the service. To return more than 50 rows, use the `Take` method, as described in [Return data in pages].\n\n### <a name=\"filtering\"></a>How to: Filter returned data\n\nThe following code illustrates how to filter data by including a `Where` clause in a query. It returns all items from `todoTable` whose `Complete` property is equal to `false`. The `Where` function applies a row filtering predicate to the query against the table.\n\n    // This query filters out completed TodoItems and\n    // items without a timestamp.\n    List<TodoItem> items = await todoTable\n       .Where(todoItem => todoItem.Complete == false)\n       .ToListAsync();\n\nYou can view the URI of the request sent to the mobile service by using message inspection software, such as browser developer tools or [Fiddler]. If you look at the request URI below,  notice that we are modifying the query string itself:\n\n    GET /tables/todoitem?$filter=(complete+eq+false) HTTP/1.1\nThis request would normally be translated roughly into the following SQL query on the server side:\n\n    SELECT *\n    FROM TodoItem\n    WHERE ISNULL(complete, 0) = 0\n\nThe function which is passed to the `Where` method can have an arbitrary number of conditions. For example, the line below:\n\n    // This query filters out completed TodoItems where Text isn't null\n    List<TodoItem> items = await todoTable\n       .Where(todoItem => todoItem.Complete == false\n           && todoItem.Text != null)\n       .ToListAsync();\n\nWould be roughly translated (for the same request shown before) as\n\n    SELECT *\n    FROM TodoItem\n    WHERE ISNULL(complete, 0) = 0\n          AND ISNULL(text, 0) = 0\n\nThe `where` statement above will find items with `Complete` status set to false with non-null `Text`.\n\nWe also could have written that in multiple lines instead:\n\n    List<TodoItem> items = await todoTable\n       .Where(todoItem => todoItem.Complete == false)\n       .Where(todoItem => todoItem.Text != null)\n       .ToListAsync();\n\nThe two methods are equivalent and may be used interchangeably.  The former option -- of concatenating multiple predicates in one query -- is more compact and recommended.\n\nThe `where` clause supports operations that be translated into the Mobile Services OData subset. This includes relational operators (==, !=, <, <=, >, >=), arithmetic operators (+, -, /, *, %), number precision (Math.Floor, Math.Ceiling), string functions (Length, Substring, Replace, IndexOf, StartsWith, EndsWith), date properties (Year, Month, Day, Hour, Minute, Second), access properties of an object, and expressions combining all of these.\n\n### <a name=\"sorting\"></a>How to: Sort returned data\n\nThe following code illustrates how to sort data by including an `OrderBy` or `OrderByDescending` function in the query. It returns items from `todoTable` sorted ascending by the `Text` field.\n\n    // Sort items in ascending order by Text field\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .OrderBy(todoItem => todoItem.Text)\n    List<TodoItem> items = await query.ToListAsync();\n\n    // Sort items in descending order by Text field\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .OrderByDescending(todoItem => todoItem.Text)\n    List<TodoItem> items = await query.ToListAsync();\n\n### <a name=\"paging\"></a>How to: Return data in pages\n\nBy default, the server returns only the first 50 rows. You can increase the number of returned rows by calling the [Take] method. Use `Take` along with the [Skip] method to request a specific \"page\" of the total dataset returned by the query. The following query, when executed, returns the top three items in the table.\n\n    // Define a filtered query that returns the top 3 items.\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Take(3);\n    List<TodoItem> items = await query.ToListAsync();\n\nThe following revised query skips the first three results and returns the next three after that. This is effectively the second \"page\" of data, where the page size is three items.\n\n    // Define a filtered query that skips the top 3 items and returns the next 3 items.\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Skip(3)\n                    .Take(3);\n    List<TodoItem> items = await query.ToListAsync();\n\nYou can also use the [IncludeTotalCount] method to ensure that the query will get the total count for <i>all</i> the records that would have been returned, ignoring any take paging/limit clause specified:\n\n    query = query.IncludeTotalCount();\n\nThis is a simplified scenario of passing hard-coded paging values to the `Take` and `Skip` methods. In a real-world app, you can use queries similar to the above with a pager control or comparable UI to let users navigate to previous and next pages.\n\n####Paging considerations for a .NET backend mobile service\n\nTo override the 50 row limit in a .NET backend mobile service, you must also apply the [EnableQueryAttribute](https://msdn.microsoft.com/library/system.web.http.odata.enablequeryattribute.aspx) to the public GET method and specify the paging behavior. When applied to the method, the following sets the maximum returned rows to 1000:\n\n    [EnableQuery(MaxTop=1000)]\n\n\n### <a name=\"selecting\"></a>How to: Select specific columns\n\nYou can specify which set of properties to include in the results by adding a `Select` clause to your query. For example, the following code shows how to select just one field and also how to select and format multiple fields:\n\n    // Select one field -- just the Text\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Select(todoItem => todoItem.Text);\n    List<string> items = await query.ToListAsync();\n\n    // Select multiple fields -- both Complete and Text info\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Select(todoItem => string.Format(\"{0} -- {1}\", todoItem.Text.PadRight(30), todoItem.Complete ? \"Now complete!\" : \"Incomplete!\"));\n    List<string> items = await query.ToListAsync();\n\nAll the functions described so far are additive, so we can just keep calling them and we'll each time affect more of the query. One more example:\n\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Where(todoItem => todoItem.Complete == false)\n                    .Select(todoItem => todoItem.Text)\n                    .Skip(3).\n                    .Take(3);\n    List<string> items = await query.ToListAsync();\n\n### <a name=\"lookingup\"></a>How to: Look up data by ID\n\nThe `LookupAsync` function can be used to look up objects from the database with a particular ID.\n\n    // This query filters out the item with the ID of 37BBF396-11F0-4B39-85C8-B319C729AF6D\n    TodoItem item = await todoTable.LookupAsync(\"37BBF396-11F0-4B39-85C8-B319C729AF6D\");\n\n##<a name=\"inserting\"></a>How to: Insert data into a mobile service\n\n> [AZURE.NOTE] If you want to perform insert, lookup, delete, or update operations on a type, then you need to create a member called **Id**. This is why the example class **TodoItem** has a member of name **Id**. A valid id value must always be present in update and delete operations.\n\nThe following code illustrates how to insert new rows into a table. The parameter contains the data to be inserted as a .NET object.\n\n    await todoTable.InsertAsync(todoItem);\n\nIf a unique custom ID value is not included in the `todoItem` passed to the `todoTable.InsertAsync` call, a value for ID is generated by the server and is set in the `todoItem` object returned to the client.\n\nTo insert untyped data, you may take advantage of Json.NET as shown below.\n\n    JObject jo = new JObject();\n    jo.Add(\"Text\", \"Hello World\");\n    jo.Add(\"Complete\", false);\n    var inserted = await table.InsertAsync(jo);\n\nHere is an example using an email address as a unique string id.\n\n    JObject jo = new JObject();\n    jo.Add(\"id\", \"myemail@emaildomain.com\");\n    jo.Add(\"Text\", \"Hello World\");\n    jo.Add(\"Complete\", false);\n    var inserted = await table.InsertAsync(jo);\n\n\n###Working with ID values\n\nMobile Services supports unique custom string values for the table's **id** column. This allows applications to use custom values such as email addresses or user names for the ID.\n\nString IDs provide you with the following benefits:\n\n+ IDs are generated without making a round-trip to the database.\n+ Records are easier to merge from different tables or databases.\n+ IDs values can integrate better with an application's logic.\n\nWhen a string ID value is not set on an inserted record, Mobile Services generates a unique value for the ID. You can use the `Guid.NewGuid()` method To generate your own ID values, either on the client or in a .NET mobile backend service. To learn more about generating GUIDs in a JavaScript backend mobile service, see [How to: Generate unique ID values](mobile-services-how-to-use-server-scripts.md#generate-guids).\n\nYou can also use integer IDs for your tables. To use an integer ID, you must create your table with the `mobile table create` command using the `--integerId` option. This command is used with the Command-line Interface (CLI) for Azure. For more information on using the CLI, see [CLI to manage Mobile Services tables](../virtual-machines-command-line-tools.md#Mobile_Tables).\n\n##<a name=\"modifying\"></a>How to: Modify data in a mobile service\n\nThe following code illustrates how to update an existing instance with the same ID with new information. The parameter contains the data to be updated as a .NET object.\n\n    await todoTable.UpdateAsync(todoItem);\n\n\nTo insert untyped data, you may take advantage of Json.NET like so. Note that when making an update, an ID must be specified, as that is how the mobile service identifies which instance to update. The ID can be obtained from the result of the `InsertAsync` call.\n\n    JObject jo = new JObject();\n    jo.Add(\"Id\", \"37BBF396-11F0-4B39-85C8-B319C729AF6D\");\n    jo.Add(\"Text\", \"Hello World\");\n    jo.Add(\"Complete\", false);\n    var inserted = await table.UpdateAsync(jo);\n\nIf you attempt to update an item without providing the \"Id\" value, there is no way for the service to tell which instance to update, so the Mobile Services SDK will throw an `ArgumentException`.\n\n\n##<a name=\"deleting\"></a>How to: Delete data in a mobile service\n\nThe following code illustrates how to delete an existing instance. The instance is identified by the \"Id\" field set on the `todoItem`.\n\n    await todoTable.DeleteAsync(todoItem);\n\nTo delete untyped data, you may take advantage of Json.NET like so. Note that when making a delete request, an ID must be specified, as that is how the mobile service identifies which instance to delete. A delete request needs only the ID; other properties are not passed to the service, and if any are passed, they are ignored at the service. The result of a `DeleteAsync` call is usually `null` as well. The ID to pass in can be obtained from the result of the `InsertAsync` call.\n\n    JObject jo = new JObject();\n    jo.Add(\"Id\", \"37BBF396-11F0-4B39-85C8-B319C729AF6D\");\n    await table.DeleteAsync(jo);\n\nIf you attempt to delete an item without the \"Id\" field already set, there is no way for the service to tell which instance to delete, so you will get back a `MobileServiceInvalidOperationException` from the service. Similarly, if you attempt to delete an untyped item without the \"Id\" field already set, you will again get back a `MobileServiceInvalidOperationException` from the service.\n\n##<a name=\"#custom-api\"></a>How to: Call a custom API\n\nA custom API enables you to define custom endpoints that expose server functionality that does not map to an insert, update, delete, or read operation. By using a custom API, you can have more control over messaging, including reading and setting HTTP message headers and defining a message body format other than JSON. For an example of how to create a custom API in your mobile service, see [How to: define a custom API endpoint](mobile-services-dotnet-backend-define-custom-api.md).\n\nYou call a custom API by calling one of the [InvokeApiAsync] method overloads on the client. For example, the following line of code sends a POST request to the **completeAll** API on the mobile service:\n\n    var result = await App.MobileService\n        .InvokeApiAsync<MarkAllResult>(\"completeAll\",\n        System.Net.Http.HttpMethod.Post, null);\n\nNote that this a typed method call, which requires that the **MarkAllResult** return type be defined. Both typed and untyped methods are supported. This is an almost trivial example as it is typed, sends no payload, has no query parameters, and doesn't change the request headers. For more realistic examples and a more a complete discussion of [InvokeApiAsync], see [Custom API in Azure Mobile Services Client SDKs].\n\n##How to: Register for push notifications\n\nThe Mobile Services client enables you to register for push notifications with Azure Notification Hubs. When registering, you obtain a handle that you obtain from the platform-specific Push Notification Service (PNS). You then provide this value along with any tags when you create the registration. The following code registers your Windows app for push notifications with the Windows Notification Service (WNS):\n\n    private async void InitNotificationsAsync()\n    {\n        // Request a push notification channel.\n        var channel =\n            await PushNotificationChannelManager\n                .CreatePushNotificationChannelForApplicationAsync();\n\n        // Register for notifications using the new channel and a tag collection.\n        var tags = new List<string>{ \"mytag1\", \"mytag2\"};\n        await MobileService.GetPush().RegisterNativeAsync(channel.Uri, tags);\n    }\n\nNote that in this example, two tags are included with the registration. For more information on Windows apps, see [Add push notifications to your app](mobile-services-dotnet-backend-windows-universal-dotnet-get-started-push.md).\n\nXamarin apps require some additional code to be able to register a Xamarin app running on iOS or Android app with the Apple Push Notification Service (APNS) and Google Cloud Messaging (GCM) services, respectively. For more information see **Add push notifications to your app** ([Xamarin.iOS](partner-xamarin-mobile-services-ios-get-started-push.md#add-push) | [Xamarin.Android](partner-xamarin-mobile-services-android-get-started-push.md#add-push)).\n\n>[AZURE.NOTE]When you need to send notifications to specific registered users, it is important to require authentication before registration, and then verify that the user is authorized to register with a specific tag. For example, you must check to make sure a user doesn't register with a tag that is someone else's user ID. For more information, see [Send push notifications to authenticated users](mobile-services-dotnet-backend-windows-store-dotnet-push-notifications-app-users.md).\n\n##<a name=\"pull-notifications\"></a>How to: Use periodic notifications in a Windows app\n\nWindows supports period notifications (pull notifications) to update live tiles. With periodic notifications enabled, Windows will periodically access a custom API endpoint to update the app tile on the start menu. To use periodic notifications, you must [define a custom API](mobile-services-javascript-backend-define-custom-api.md) that returns XML data in a tile-specific format. For more information, see [Periodic notifications](https://msdn.microsoft.com/library/windows/apps/hh761461.aspx).\n\nThe following example turns on period notifications to request tile template data from a *tiles* custom endpoint:\n\n    TileUpdateManager.CreateTileUpdaterForApplication().StartPeriodicUpdate(\n        new System.Uri(MobileService.ApplicationUri, \"/api/tiles\"),\n        PeriodicUpdateRecurrence.Hour\n    );\n\nSelect a [PeriodicUpdateRecurrance](https://msdn.microsoft.com/library/windows/apps/windows.ui.notifications.periodicupdaterecurrence.aspx) value that best matches the update frequency of your data.\n\n##<a name=\"optimisticconcurrency\"></a>How to: Use optimistic concurrency\n\nTwo or more clients may write changes to the same item, at the same time, in some scenarios. Without any conflict detection, the last write would overwrite any previous updates even if this was not the desired result. Optimistic Concurrency Control assumes that each transaction can commit and therefore does not use any resource locking. Before committing a transaction, optimistic concurrency control verifies that no other transaction has modified the data. If the data has been modified, the committing transaction is rolled back.\n\nMobile Services supports optimistic concurrency control by tracking changes to each item using the `__version` system property column that is defined for each table created by Mobile Services. Each time a record is updated, Mobile Services sets the `__version` property for that record to a new value. During each update request, the `__version` property of the record included with the request is compared to the same property for the record on the server. If the version passed with the request does not match the server, then the Mobile Services .NET client library throws a `MobileServicePreconditionFailedException<T>`. The type included with the exception is the record from the server containing the server's version of the record. The application can then use this information to decide whether to execute the update request again with the correct `__version` value from the server to commit changes.\n\nTo enable optimistic concurrency the application defines a column on the table class for the `__version` system property. The following definition provides an example.\n\n    public class TodoItem\n    {\n        public string Id { get; set; }\n\n        [JsonProperty(PropertyName = \"text\")]\n        public string Text { get; set; }\n\n        [JsonProperty(PropertyName = \"complete\")]\n        public bool Complete { get; set; }\n\n        // *** Enable Optimistic Concurrency *** //\n        [JsonProperty(PropertyName = \"__version\")]\n        public byte[] Version { set; get; }\n    }\n\n\nApplications using untyped tables enable optimistic concurrency by setting the `Version` flag on the `SystemProperties` of the table as follows.\n\n    //Enable optimistic concurrency by retrieving __version\n    todoTable.SystemProperties |= MobileServiceSystemProperties.Version;\n\n\nThe following code shows how to resolve a write conflict once detected. The correct `__version` value must be included in the `UpdateAsync()` call to commit a resolution.\n\n    private async void UpdateToDoItem(TodoItem item)\n    {\n        MobileServicePreconditionFailedException<TodoItem> exception = null;\n\n        try\n        {\n            //update at the remote table\n            await todoTable.UpdateAsync(item);\n        }\n        catch (MobileServicePreconditionFailedException<TodoItem> writeException)\n        {\n            exception = writeException;\n        }\n\n        if (exception != null)\n        {\n            // Conflict detected, the item has changed since the last query\n            // Resolve the conflict between the local and server item\n            await ResolveConflict(item, exception.Item);\n        }\n    }\n\n\n    private async Task ResolveConflict(TodoItem localItem, TodoItem serverItem)\n    {\n        //Ask user to choose the resoltion between versions\n        MessageDialog msgDialog = new MessageDialog(String.Format(\"Server Text: \\\"{0}\\\" \\nLocal Text: \\\"{1}\\\"\\n\",\n                                                    serverItem.Text, localItem.Text),\n                                                    \"CONFLICT DETECTED - Select a resolution:\");\n\n        UICommand localBtn = new UICommand(\"Commit Local Text\");\n        UICommand ServerBtn = new UICommand(\"Leave Server Text\");\n        msgDialog.Commands.Add(localBtn);\n        msgDialog.Commands.Add(ServerBtn);\n\n        localBtn.Invoked = async (IUICommand command) =>\n        {\n            // To resolve the conflict, update the version of the\n            // item being committed. Otherwise, you will keep\n            // catching a MobileServicePreConditionFailedException.\n            localItem.Version = serverItem.Version;\n\n            // Updating recursively here just in case another\n            // change happened while the user was making a decision\n            UpdateToDoItem(localItem);\n        };\n\n        ServerBtn.Invoked = async (IUICommand command) =>\n        {\n            RefreshTodoItems();\n        };\n\n        await msgDialog.ShowAsync();\n    }\n\n\nFor a more complete example of using optimistic concurrency for Mobile Services, see the [Optimistic Concurrency Tutorial].\n\n\n##<a name=\"binding\"></a>How to: Bind mobile service data to a Windows user interface\n\nThis section shows how to display returned data objects using UI elements in a Windows app. To query incomplete items in `todoTable` and display it in a very simple list, you can run the following example code to bind the source of the list with a query. Using `MobileServiceCollection` creates a mobile services-aware binding collection.\n\n    // This query filters out completed TodoItems.\n    MobileServiceCollection<TodoItem, TodoItem> items = await todoTable\n        .Where(todoItem => todoItem.Complete == false)\n        .ToCollectionAsync();\n\n    // itemsControl is an IEnumerable that could be bound to a UI list control\n    IEnumerable itemsControl  = items;\n\n    // Bind this to a ListBox\n    ListBox lb = new ListBox();\n    lb.ItemsSource = items;\n\nSome controls in the managed runtime support an interface called [ISupportIncrementalLoading](http://msdn.microsoft.com/library/windows/apps/Hh701916). This interface allows controls to request extra data when the user scrolls. There is built-in support for this interface for universal Windows 8.1 apps via `MobileServiceIncrementalLoadingCollection`, which automatically handles the calls from the controls. To use `MobileServiceIncrementalLoadingCollection` in Windows apps, do the following:\n\n            MobileServiceIncrementalLoadingCollection<TodoItem,TodoItem> items;\n        items =  todoTable.Where(todoItem => todoItem.Complete == false)\n                    .ToIncrementalLoadingCollection();\n\n        ListBox lb = new ListBox();\n        lb.ItemsSource = items;\n\n\nTo use the new collection on Windows Phone 8 and \"Silverlight\" apps, use the `ToCollection` extension methods on `IMobileServiceTableQuery<T>` and `IMobileServiceTable<T>`. To actually load data, call `LoadMoreItemsAsync()`.\n\n    MobileServiceCollection<TodoItem, TodoItem> items = todoTable.Where(todoItem => todoItem.Complete==false).ToCollection();\n    await items.LoadMoreItemsAsync();\n\nWhen you use the collection created by calling `ToCollectionAsync` or `ToCollection`, you get a collection which can be bound to UI controls. This collection is paging-aware, i.e., a control can ask the collection to \"load more items\", and the collection will do it for the control. At that point there is no user code involved, the control will start the flow. However, since the collection is loading data from the network, it's expected that some times this loading will fail. To handle such failures, you may override the `OnException` method on `MobileServiceIncrementalLoadingCollection` to handle exceptions resulting from calls to `LoadMoreItemsAsync` performed by controls.\n\nFinally, imagine that your table has many fields, but you only want to display some of them in your control. You may use the guidance in the section \"[Select specific columns](#selecting)\" above to select specific columns to display in the UI.\n\n##<a name=\"authentication\"></a>How to: Authenticate users\n\nMobile Services supports authenticating and authorizing app users using a variety of external identity providers: Facebook, Google, Microsoft Account, Twitter, and Azure Active Directory. You can set permissions on tables to restrict access for specific operations to only authenticated users. You can also use the identity of authenticated users to implement authorization rules in server scripts. For more information, see the tutorial [Add authentication to your app].\n\nTwo authentication flows are supported: a _server flow_ and a _client flow_. The server flow provides the simplest authentication experience, as it relies on the provider's web authentication interface. The client flow allows for deeper integration with device-specific capabilities as it relies on provider-specific device-specific SDKs.\n\n###Server flow\nTo have Mobile Services manage the authentication process in your Windows apps,\nyou must register your app with your identity provider. Then in your mobile service, you need to configure the application ID and secret provided by your provider. For more information, see the tutorial [Add authentication to your app].\n\nOnce you have registered your identity provider, simply call the [LoginAsync method] with the [MobileServiceAuthenticationProvider] value of your provider. For example, the following code initiates a server flow sign-in by using Facebook.\n\n    private MobileServiceUser user;\n    private async System.Threading.Tasks.Task Authenticate()\n    {\n        while (user == null)\n        {\n            string message;\n            try\n            {\n                user = await client\n                    .LoginAsync(MobileServiceAuthenticationProvider.Facebook);\n                message =\n                    string.Format(\"You are now logged in - {0}\", user.UserId);\n            }\n            catch (InvalidOperationException)\n            {\n                message = \"You must log in. Login Required\";\n            }\n\n            var dialog = new MessageDialog(message);\n            dialog.Commands.Add(new UICommand(\"OK\"));\n            await dialog.ShowAsync();\n        }\n    }\n\nIf you are using an identity provider other than Facebook, change the value of [MobileServiceAuthenticationProvider] above to the value for your provider.\n\nIn this case, Mobile Services manages the OAuth 2.0 authentication flow by displaying the sign-in page of the selected provider and generating a Mobile Services authentication token after successful sign-on with the identity provider. The [LoginAsync method] returns a [MobileServiceUser], which provides both the [userId] of the authenticated user and the [MobileServiceAuthenticationToken], as a JSON web token (JWT). This token can be cached and re-used until it expires. For more information, see [Caching the authentication token].\n\n###Client flow\n\nYour app can also independently contact the identity provider and then provide the returned token to Mobile Services for authentication. This client flow enables you to provide a single sign-in experience for users or to retrieve additional user data from the identity provider.\n\n####Single sign-in using a token from Facebook or Google\n\nIn the most simplified form, you can use the client flow as shown in this snippet for Facebook or Google.\n\n    var token = new JObject();\n    // Replace access_token_value with actual value of your access token obtained\n    // using the Facebook or Google SDK.\n    token.Add(\"access_token\", \"access_token_value\");\n\n    private MobileServiceUser user;\n    private async System.Threading.Tasks.Task Authenticate()\n    {\n        while (user == null)\n        {\n            string message;\n            try\n            {\n                // Change MobileServiceAuthenticationProvider.Facebook\n                // to MobileServiceAuthenticationProvider.Google if using Google auth.\n                user = await client\n                    .LoginAsync(MobileServiceAuthenticationProvider.Facebook, token);\n                message =\n                    string.Format(\"You are now logged in - {0}\", user.UserId);\n            }\n            catch (InvalidOperationException)\n            {\n                message = \"You must log in. Login Required\";\n            }\n\n            var dialog = new MessageDialog(message);\n            dialog.Commands.Add(new UICommand(\"OK\"));\n            await dialog.ShowAsync();\n        }\n    }\n\n\n####Single sign-in using Microsoft Account with the Live SDK\n\nTo be able to authenticate users, you must register your app at the Microsoft account Developer Center. You must then connect this registration with your mobile service. Complete the steps in [Register your app to use a Microsoft account login](mobile-services-how-to-register-microsoft-authentication.md) to create a Microsoft account registration and connect it to your mobile service. If you have both Windows Store and Windows Phone 8/Silverlight versions of your app, register the Windows Store version first.\n\nThe following code authenticates using Live SDK and uses the returned token to sign-in to your mobile service.\n\n    private LiveConnectSession session;\n    //private static string clientId = \"<microsoft-account-client-id>\";\n    private async System.Threading.Tasks.Task AuthenticateAsync()\n    {\n\n        // Get the URL the mobile service.\n        var serviceUrl = App.MobileService.ApplicationUri.AbsoluteUri;\n\n        // Create the authentication client for Windows Store using the mobile service URL.\n        LiveAuthClient liveIdClient = new LiveAuthClient(serviceUrl);\n        //// Create the authentication client for Windows Phone using the client ID of the registration.\n        //LiveAuthClient liveIdClient = new LiveAuthClient(clientId);\n\n        while (session == null)\n        {\n            // Request the authentication token from the Live authentication service.\n            // The wl.basic scope is requested.\n            LiveLoginResult result = await liveIdClient.LoginAsync(new string[] { \"wl.basic\" });\n            if (result.Status == LiveConnectSessionStatus.Connected)\n            {\n                session = result.Session;\n\n                // Get information about the logged-in user.\n                LiveConnectClient client = new LiveConnectClient(session);\n                LiveOperationResult meResult = await client.GetAsync(\"me\");\n\n                // Use the Microsoft account auth token to sign in to Mobile Services.\n                MobileServiceUser loginResult = await App.MobileService\n                    .LoginWithMicrosoftAccountAsync(result.Session.AuthenticationToken);\n\n                // Display a personalized sign-in greeting.\n                string title = string.Format(\"Welcome {0}!\", meResult.Result[\"first_name\"]);\n                var message = string.Format(\"You are now logged in - {0}\", loginResult.UserId);\n                var dialog = new MessageDialog(message, title);\n                dialog.Commands.Add(new UICommand(\"OK\"));\n                await dialog.ShowAsync();\n            }\n            else\n            {\n                session = null;\n                var dialog = new MessageDialog(\"You must log in.\", \"Login Required\");\n                dialog.Commands.Add(new UICommand(\"OK\"));\n                await dialog.ShowAsync();\n            }\n        }\n    }\n\n\n###<a name=\"caching\"></a>Caching the authentication token\nIn some cases, the call to the login method can be avoided after the first time the user authenticates. You can use [PasswordVault] for Windows Store apps to cache the current user identity the first time they log in and every subsequent time you check whether you already have the user identity in our cache. When the cache is empty, you still need to send the user through the login process.\n\n    // After logging in\n    PasswordVault vault = new PasswordVault();\n    vault.Add(new PasswordCredential(\"Facebook\", user.UserId, user.MobileServiceAuthenticationToken));\n\n    // Log in\n    var creds = vault.FindAllByResource(\"Facebook\").FirstOrDefault();\n    if (creds != null)\n    {\n        user = new MobileServiceUser(creds.UserName);\n        user.MobileServiceAuthenticationToken = vault.Retrieve(\"Facebook\", creds.UserName).Password;\n    }\n    else\n    {\n        // Regular login flow\n        user = new MobileServiceuser( await client\n            .LoginAsync(MobileServiceAuthenticationProvider.Facebook, token);\n        var token = new JObject();\n        // Replace access_token_value with actual value of your access token\n        token.Add(\"access_token\", \"access_token_value\");\n    }\n\n     // Log out\n    client.Logout();\n    vault.Remove(vault.Retrieve(\"Facebook\", user.UserId));\n\n\nFor Windows Phone apps, you may encrypt and cache data using the [ProtectedData] class and store sensitive information in isolated storage.\n\n##<a name=\"errors\"></a>How to: Handle errors\n\nThere are several ways to encounter, validate, and work around errors in Mobile Services.\n\nAs an example, server scripts are registered in a mobile service and can be used to perform a wide range of operations on data being inserted and updated, including validation and data modification. Imagine defining and registering a server script that validate and modify data, like so:\n\n    function insert(item, user, request)\n    {\n       if (item.text.length > 10) {\n          request.respond(statusCodes.BAD_REQUEST, { error: \"Text cannot exceed 10 characters\" });\n       } else {\n          request.execute();\n       }\n    }\n\nThis server-side script validates the length of string data sent to the mobile service and rejects strings that are too long, in this case longer than 10 characters.\n\nNow that the mobile service is validating data and sending error responses on the server-side, you can update your .NET app to be able to handle error responses from validation.\n\n    private async void InsertTodoItem(TodoItem todoItem)\n    {\n        // This code inserts a new TodoItem into the database. When the operation completes\n        // and Mobile Services has assigned an Id, the item is added to the CollectionView\n        try\n        {\n            await todoTable.InsertAsync(todoItem);\n            items.Add(todoItem);\n        }\n        catch (MobileServiceInvalidOperationException e)\n        {\n            // Handle error\n        }\n    }\n\n##<a name=\"untyped\"></a>How to: Work with untyped data\n\nThe .NET client is designed for strongly typed scenarios. However, sometimes, a more loosely typed experience is convenient; for example, this could be when dealing with objects with open schema. That scenario is enabled as follows. In queries, you forego LINQ and use the wire format.\n\n    // Get an untyped table reference\n    IMobileServiceTable untypedTodoTable = client.GetTable(\"TodoItem\");\n\n    // Lookup untyped data using OData\n    JToken untypedItems = await untypedTodoTable.ReadAsync(\"$filter=complete eq 0&$orderby=text\");\n\nYou get back JSON values that you can use like a property bag. For more information on JToken and Json.NET, see [Json.NET](http://json.codeplex.com/)\n\n##<a name=\"unit-testing\"></a>How to: Design unit tests\n\nThe value returned by `MobileServiceClient.GetTable` and the queries are interfaces. That makes them easily \"mockable\" for testing purposes, so you could create a `MyMockTable : IMobileServiceTable<TodoItem>` that implements your testing logic.\n\n##<a name=\"customizing\"></a>How to: Customize the client\n\nThis section shows ways in which you can customize the request headers and customize the serialization of JSON objects in the response.\n\n### <a name=\"headers\"></a>How to: Customize request headers\n\nTo support your specific app scenario, you might need to customize communication with the mobile service. For example, you may want to add a custom header to every outgoing request or even change responses status codes. You can do this by providing a custom DelegatingHandler, as in the following example:\n\n    public async Task CallClientWithHandler()\n    {\n        MobileServiceClient client = new MobileServiceClient(\n            \"AppUrl\",\n            \"AppKey\" ,\n            new MyHandler()\n            );\n        IMobileServiceTable<TodoItem> todoTable = client.GetTable<TodoItem>();\n        var newItem = new TodoItem { Text = \"Hello world\", Complete = false };\n        await table.InsertAsync(newItem);\n    }\n\n    public class MyHandler : DelegatingHandler\n    {\n        protected override async Task<HttpResponseMessage>\n            SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)\n        {\n            // Add a custom header to the request.\n            request.Headers.Add(\"x-my-header\", \"my value\");\n            var response = await base.SendAsync(request, cancellationToken);\n            // Set a differnt response status code.\n            response.StatusCode = HttpStatusCode.ServiceUnavailable;\n            return response;\n        }\n    }\n\nThis code adds a new **x-my-header** header in the request and arbitrarily sets the response code to unavailable. In a real-world scenario, you would set the response status code based on some custom logic required by your app.\n\n### <a name=\"serialization\"></a>How to: Customize serialization\n\nThe Mobile Services client library uses Json.NET to convert a JSON response into .NET objects on the client. You can configure the behavior of this serialization between .NET types and JSON in the messages. The [MobileServiceClient](http://msdn.microsoft.com/library/microsoft.windowsazure.mobileservices.mobileserviceclient.aspx) class exposes a `SerializerSettings` property of type [JsonSerializerSettings](http://james.newtonking.com/projects/json/help/?topic=html/T_Newtonsoft_Json_JsonSerializerSettings.htm)\n\nUsing this property, you may set one of the many Json.NET properties, such as the following:\n\n    var settings = new JsonSerializerSettings();\n    settings.ContractResolver = new CamelCasePropertyNamesContractResolver();\n    client.SerializerSettings = settings;\n\nThis property converts all properties to lower case during serialization.\n\n<!-- Anchors. -->\n[What is Mobile Services]: #what-is\n[Concepts]: #concepts\n[How to: Create the Mobile Services client]: #create-client\n[How to: Create a table reference]: #instantiating\n[How to: Query data from a mobile service]: #querying\n[Filter returned data]: #filtering\n[Sort returned data]: #sorting\n[Return data in pages]: #paging\n[Select specific columns]: #selecting\n[Look up data by ID]: #lookingup\n[How to: Bind data to user interface in a mobile service]: #binding\n[How to: Insert data into a mobile service]: #inserting\n[How to: Modify data in a mobile service]: #modifying\n[How to: Delete data in a mobile service]: #deleting\n[How to: Use Optimistic Concurrency]: #optimisticconcurrency\n[How to: Authenticate users]: #authentication\n[How to: Handle errors]: #errors\n[How to: Design unit tests]: #unit-testing\n[How to: Query data from a mobile service]: #querying\n[How to: Customize the client]: #customizing\n[How to: Work with untyped data]: #untyped\n[Customize request headers]: #headers\n[Customize serialization]: #serialization\n[Next steps]: #nextsteps\n[Caching the authentication token]: #caching\n[How to: Call a custom API]: #custom-api\n\n<!-- Images. -->\n\n\n\n<!-- URLs. -->\n[Add authentication to your app]: mobile-services-dotnet-backend-windows-universal-dotnet-get-started-users.md\n[PasswordVault]: http://msdn.microsoft.com/library/windows/apps/windows.security.credentials.passwordvault.aspx\n[ProtectedData]: http://msdn.microsoft.com/library/system.security.cryptography.protecteddata%28VS.95%29.aspx\n[LoginAsync method]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceclientextensions.loginasync.aspx\n[MobileServiceAuthenticationProvider]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceauthenticationprovider.aspx\n[MobileServiceUser]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.aspx\n[UserID]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.userid.aspx\n[MobileServiceAuthenticationToken]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.mobileserviceauthenticationtoken.aspx\n[ASCII control codes C0 and C1]: http://en.wikipedia.org/wiki/Data_link_escape_character#C1_set\n[CLI to manage Mobile Services tables]: ../virtual-machines-command-line-tools.md/#Commands_to_manage_mobile_services\n[Optimistic Concurrency Tutorial]: mobile-services-windows-store-dotnet-handle-database-conflicts.md\n[MobileServiceClient]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.mobileservices.mobileserviceclient.aspx\n\n[IncludeTotalCount]: http://msdn.microsoft.com/library/windowsazure/dn250560.aspx\n[Skip]: http://msdn.microsoft.com/library/windowsazure/dn250573.aspx\n[Take]: http://msdn.microsoft.com/library/windowsazure/dn250574.aspx\n[Fiddler]: http://www.telerik.com/fiddler\n[Custom API in Azure Mobile Services Client SDKs]: http://blogs.msdn.com/b/carlosfigueira/archive/2013/06/19/custom-api-in-azure-mobile-services-client-sdks.aspx\n[InvokeApiAsync]: http://msdn.microsoft.com/library/azure/microsoft.windowsazure.mobileservices.mobileserviceclient.invokeapiasync.aspx\n"
}