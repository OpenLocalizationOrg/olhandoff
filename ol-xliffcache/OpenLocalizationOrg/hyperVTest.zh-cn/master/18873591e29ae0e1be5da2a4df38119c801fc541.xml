{
  "nodes": [
    {
      "pos": [
        28,
        95
      ],
      "content": "Customize HDInsight Clusters using script actions | Microsoft Azure"
    },
    {
      "pos": [
        115,
        177
      ],
      "content": "Learn how to customize HDInsight clusters using Script Action."
    },
    {
      "pos": [
        495,
        543
      ],
      "content": "Customize HDInsight clusters using Script Action"
    },
    {
      "pos": [
        631,
        720
      ],
      "content": "<bpt id=\"p1\">[</bpt>Customize HDInsight clusters using Script Action<ept id=\"p1\">](hdinsight-hadoop-customize-cluster.md)</ept>"
    },
    {
      "pos": [
        722,
        1041
      ],
      "content": "HDInsight provides a configuration option called <bpt id=\"p2\">**</bpt>Script Action<ept id=\"p2\">**</ept><ph id=\"ph3\"/> that invokes custom scripts, which define the customization to be performed on the cluster during the provision process. These scripts can be used to install additional software on a cluster, or to change the configuration of applications on a cluster.",
      "nodes": [
        {
          "content": "HDInsight provides a configuration option called <bpt id=\"p2\">**</bpt>Script Action<ept id=\"p2\">**</ept><ph id=\"ph3\"/> that invokes custom scripts, which define the customization to be performed on the cluster during the provision process.",
          "pos": [
            0,
            239
          ]
        },
        {
          "content": "These scripts can be used to install additional software on a cluster, or to change the configuration of applications on a cluster.",
          "pos": [
            240,
            371
          ]
        }
      ]
    },
    {
      "pos": [
        1047,
        1291
      ],
      "content": "<ph id=\"ph4\">[AZURE.NOTE]</ph><ph id=\"ph5\"/> Script Action is only supported on HDInsight cluster version 3.1 or higher with the Windows operating system.  For more information on HDInsight cluster versions, see <bpt id=\"p3\">[</bpt>HDInsight cluster versions<ept id=\"p3\">](hdinsight-component-versioning.md)</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph4\">[AZURE.NOTE]</ph><ph id=\"ph5\"/> Script Action is only supported on HDInsight cluster version 3.1 or higher with the Windows operating system.",
          "pos": [
            0,
            154
          ]
        },
        {
          "content": "For more information on HDInsight cluster versions, see <bpt id=\"p3\">[</bpt>HDInsight cluster versions<ept id=\"p3\">](hdinsight-component-versioning.md)</ept>.",
          "pos": [
            156,
            314
          ]
        }
      ]
    },
    {
      "pos": [
        1297,
        1397
      ],
      "content": "Script Action is available as part of the standard Azure HDInsight subscriptions at no extra charge."
    },
    {
      "pos": [
        1399,
        1923
      ],
      "content": "HDInsight clusters can be customized in a variety of other ways as well, such as including additional Azure Storage accounts, changing the Hadoop configuration files (core-site.xml, hive-site.xml, etc.), or adding shared libraries (e.g., Hive, Oozie) into common locations in the cluster. These customizations can be done through Azure PowerShell, the Azure HDInsight .NET SDK, or the Azure Classic Portal. For more information, see <bpt id=\"p4\">[</bpt>Provision Hadoop clusters in HDInsight using custom options<ept id=\"p4\">][hdinsight-provision-cluster]</ept>.",
      "nodes": [
        {
          "content": "HDInsight clusters can be customized in a variety of other ways as well, such as including additional Azure Storage accounts, changing the Hadoop configuration files (core-site.xml, hive-site.xml, etc.), or adding shared libraries (e.g., Hive, Oozie) into common locations in the cluster.",
          "pos": [
            0,
            288
          ]
        },
        {
          "content": "These customizations can be done through Azure PowerShell, the Azure HDInsight .NET SDK, or the Azure Classic Portal.",
          "pos": [
            289,
            406
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p4\">[</bpt>Provision Hadoop clusters in HDInsight using custom options<ept id=\"p4\">][hdinsight-provision-cluster]</ept>.",
          "pos": [
            407,
            562
          ]
        }
      ]
    },
    {
      "pos": [
        1928,
        1974
      ],
      "content": "Script Action in the cluster provision process"
    },
    {
      "pos": [
        1976,
        2150
      ],
      "content": "Script Action is only used while a clusters is in the process of being created. The following diagram illustrates when Script Action is executed during the provision process:",
      "nodes": [
        {
          "content": "Script Action is only used while a clusters is in the process of being created.",
          "pos": [
            0,
            79
          ]
        },
        {
          "content": "The following diagram illustrates when Script Action is executed during the provision process:",
          "pos": [
            80,
            174
          ]
        }
      ]
    },
    {
      "pos": [
        2152,
        2249
      ],
      "content": "<ph id=\"ph6\">![</ph>HDInsight cluster customization and stages during cluster provisioning<ph id=\"ph7\">][img-hdi-cluster-states]</ph>"
    },
    {
      "pos": [
        2252,
        2503
      ],
      "content": "When the script is running, the cluster enters the <bpt id=\"p5\">**</bpt>ClusterCustomization<ept id=\"p5\">**</ept><ph id=\"ph8\"/> stage. At this stage, the script is run under the system admin account, in parallel on all the specified nodes in the cluster, and provides full admin privileges on the nodes.",
      "nodes": [
        {
          "content": "When the script is running, the cluster enters the <bpt id=\"p5\">**</bpt>ClusterCustomization<ept id=\"p5\">**</ept><ph id=\"ph8\"/> stage.",
          "pos": [
            0,
            134
          ]
        },
        {
          "content": "At this stage, the script is run under the system admin account, in parallel on all the specified nodes in the cluster, and provides full admin privileges on the nodes.",
          "pos": [
            135,
            303
          ]
        }
      ]
    },
    {
      "pos": [
        2508,
        3258
      ],
      "content": "<ph id=\"ph9\">[AZURE.NOTE]</ph><ph id=\"ph10\"/> Because you have admin privileges on the cluster nodes during the <bpt id=\"p6\">**</bpt>ClusterCustomization<ept id=\"p6\">**</ept><ph id=\"ph11\"/> stage, you can use the script to perform operations like stopping and starting services, including Hadoop-related services. So, as part of the script, you must ensure that the Ambari services and other Hadoop-related services are up and running before the script finishes running. These services are required to successfully ascertain the health and state of the cluster while it is being created. If you change any configuration on the cluster that affects these services, you must use the helper functions that are provided. For more information about helper functions, see <bpt id=\"p7\">[</bpt>Develop Script Action scripts for HDInsight<ept id=\"p7\">][hdinsight-write-script]</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph9\">[AZURE.NOTE]</ph><ph id=\"ph10\"/> Because you have admin privileges on the cluster nodes during the <bpt id=\"p6\">**</bpt>ClusterCustomization<ept id=\"p6\">**</ept><ph id=\"ph11\"/> stage, you can use the script to perform operations like stopping and starting services, including Hadoop-related services.",
          "pos": [
            0,
            313
          ]
        },
        {
          "content": "So, as part of the script, you must ensure that the Ambari services and other Hadoop-related services are up and running before the script finishes running.",
          "pos": [
            314,
            470
          ]
        },
        {
          "content": "These services are required to successfully ascertain the health and state of the cluster while it is being created.",
          "pos": [
            471,
            587
          ]
        },
        {
          "content": "If you change any configuration on the cluster that affects these services, you must use the helper functions that are provided.",
          "pos": [
            588,
            716
          ]
        },
        {
          "content": "For more information about helper functions, see <bpt id=\"p7\">[</bpt>Develop Script Action scripts for HDInsight<ept id=\"p7\">][hdinsight-write-script]</ept>.",
          "pos": [
            717,
            874
          ]
        }
      ]
    },
    {
      "pos": [
        3260,
        3581
      ],
      "content": "The output and the error logs for the script are stored in the default Storage account you specified for the cluster. The logs are stored in a table with the name <bpt id=\"p8\">**</bpt>u&lt;\\cluster-name-fragment&gt;&lt;\\time-stamp&gt;setuplog<ept id=\"p8\">**</ept>. These are aggregate logs from the script run on all the nodes (head node and worker nodes) in the cluster.",
      "nodes": [
        {
          "content": "The output and the error logs for the script are stored in the default Storage account you specified for the cluster.",
          "pos": [
            0,
            117
          ]
        },
        {
          "content": "The logs are stored in a table with the name <bpt id=\"p8\">**</bpt>u&lt;\\cluster-name-fragment&gt;&lt;\\time-stamp&gt;setuplog<ept id=\"p8\">**</ept>.",
          "pos": [
            118,
            264
          ]
        },
        {
          "content": "These are aggregate logs from the script run on all the nodes (head node and worker nodes) in the cluster.",
          "pos": [
            265,
            371
          ]
        }
      ]
    },
    {
      "pos": [
        3584,
        3755
      ],
      "content": "Each cluster can accept multiple script actions that are invoked in the order in which they are specified. A script can be ran on the head node, the worker nodes, or both.",
      "nodes": [
        {
          "content": "Each cluster can accept multiple script actions that are invoked in the order in which they are specified.",
          "pos": [
            0,
            106
          ]
        },
        {
          "content": "A script can be ran on the head node, the worker nodes, or both.",
          "pos": [
            107,
            171
          ]
        }
      ]
    },
    {
      "pos": [
        3761,
        3787
      ],
      "content": "Call Script Action scripts"
    },
    {
      "pos": [
        3789,
        3898
      ],
      "content": "Script Action scripts can be used from the Azure Classic Portal, Azure PowerShell, or the HDInsight .NET SDK."
    },
    {
      "pos": [
        3900,
        3993
      ],
      "content": "HDInsight provides several scripts to install the following components on HDInsight clusters:"
    },
    {
      "pos": [
        3995,
        3999
      ],
      "content": "Name"
    },
    {
      "pos": [
        4002,
        4008
      ],
      "content": "Script"
    },
    {
      "pos": [
        4023,
        4040
      ],
      "content": "<bpt id=\"p9\">**</bpt>Install Spark<ept id=\"p9\">**</ept>"
    },
    {
      "pos": [
        4043,
        4211
      ],
      "content": "https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1. See <bpt id=\"p10\">[</bpt>Install and use Spark on HDInsight clusters<ept id=\"p10\">][hdinsight-install-spark]</ept>.",
      "nodes": [
        {
          "content": "https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.",
          "pos": [
            0,
            92
          ]
        },
        {
          "content": "See <bpt id=\"p10\">[</bpt>Install and use Spark on HDInsight clusters<ept id=\"p10\">][hdinsight-install-spark]</ept>.",
          "pos": [
            93,
            208
          ]
        }
      ]
    },
    {
      "pos": [
        4212,
        4225
      ],
      "content": "<bpt id=\"p11\">**</bpt>Install R<ept id=\"p11\">**</ept>"
    },
    {
      "pos": [
        4228,
        4380
      ],
      "content": "https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1. See <bpt id=\"p12\">[</bpt>Install and use R on HDInsight clusters<ept id=\"p12\">][hdinsight-install-r]</ept>.",
      "nodes": [
        {
          "content": "https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.",
          "pos": [
            0,
            84
          ]
        },
        {
          "content": "See <bpt id=\"p12\">[</bpt>Install and use R on HDInsight clusters<ept id=\"p12\">][hdinsight-install-r]</ept>.",
          "pos": [
            85,
            192
          ]
        }
      ]
    },
    {
      "pos": [
        4381,
        4397
      ],
      "content": "<bpt id=\"p13\">**</bpt>Install Solr<ept id=\"p13\">**</ept>"
    },
    {
      "pos": [
        4400,
        4574
      ],
      "content": "https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1. See <bpt id=\"p14\">[</bpt>Install and use Solr on HDInsight clusters<ept id=\"p14\">](hdinsight-hadoop-solr-install.md)</ept>.",
      "nodes": [
        {
          "content": "https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.",
          "pos": [
            0,
            90
          ]
        },
        {
          "content": "See <bpt id=\"p14\">[</bpt>Install and use Solr on HDInsight clusters<ept id=\"p14\">](hdinsight-hadoop-solr-install.md)</ept>.",
          "pos": [
            91,
            214
          ]
        }
      ]
    },
    {
      "pos": [
        4575,
        4595
      ],
      "content": "- <bpt id=\"p15\">**</bpt>Install Giraph<ept id=\"p15\">**</ept>"
    },
    {
      "pos": [
        4598,
        4780
      ],
      "content": "https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1. See <bpt id=\"p16\">[</bpt>Install and use Giraph on HDInsight clusters<ept id=\"p16\">](hdinsight-hadoop-giraph-install.md)</ept>.",
      "nodes": [
        {
          "content": "https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.",
          "pos": [
            0,
            94
          ]
        },
        {
          "content": "See <bpt id=\"p16\">[</bpt>Install and use Giraph on HDInsight clusters<ept id=\"p16\">](hdinsight-hadoop-giraph-install.md)</ept>.",
          "pos": [
            95,
            222
          ]
        }
      ]
    },
    {
      "pos": [
        4784,
        4817
      ],
      "content": "<bpt id=\"p17\">**</bpt>From the Azure Classic Portal<ept id=\"p17\">**</ept>"
    },
    {
      "pos": [
        4822,
        4992
      ],
      "content": "Start provisioning a cluster by using the <bpt id=\"p18\">**</bpt>CUSTOM CREATE<ept id=\"p18\">**</ept><ph id=\"ph12\"/> option, as described at <bpt id=\"p19\">[</bpt>Provisioning a cluster using custom options<ept id=\"p19\">](hdinsight-provision-clusters.md#portal)</ept>."
    },
    {
      "pos": [
        4997,
        5130
      ],
      "content": "On the <bpt id=\"p20\">**</bpt>Script Actions<ept id=\"p20\">**</ept><ph id=\"ph13\"/> page of the wizard, click <bpt id=\"p21\">**</bpt>add script action<ept id=\"p21\">**</ept><ph id=\"ph14\"/> to provide details about the script action, as shown below:"
    },
    {
      "pos": [
        5136,
        5299
      ],
      "content": "<ph id=\"ph15\">![</ph>Use Script Action to customize a cluster<ph id=\"ph16\">](./media/hdinsight-hadoop-customize-cluster-v1/HDI.CustomProvision.Page6.png \"Use Script Action to customize a cluster\")</ph>"
    },
    {
      "pos": [
        5309,
        5913
      ],
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "content": "<ph id=\"ph17\">&lt;table border='1'&gt;</ph><ph id=\"ph18\">\n     &lt;tr&gt;</ph><ph id=\"ph19\">&lt;th&gt;</ph>Property<ph id=\"ph20\">&lt;/th&gt;</ph><ph id=\"ph21\">&lt;th&gt;</ph>Value<ph id=\"ph22\">&lt;/th&gt;</ph><ph id=\"ph23\">&lt;/tr&gt;</ph><ph id=\"ph24\">\n     &lt;tr&gt;</ph><ph id=\"ph25\">&lt;td&gt;</ph>Name<ph id=\"ph26\">&lt;/td&gt;</ph><ph id=\"ph27\">\n         &lt;td&gt;</ph>Specify a name for the script action.<ph id=\"ph28\">&lt;/td&gt;</ph><ph id=\"ph29\">&lt;/tr&gt;</ph><ph id=\"ph30\">\n     &lt;tr&gt;</ph><ph id=\"ph31\">&lt;td&gt;</ph>Script URI<ph id=\"ph32\">&lt;/td&gt;</ph><ph id=\"ph33\">\n         &lt;td&gt;</ph>Specify the URI to the script that is invoked to customize the cluster. s<ph id=\"ph34\">&lt;/td&gt;</ph><ph id=\"ph35\">&lt;/tr&gt;</ph><ph id=\"ph36\">\n     &lt;tr&gt;</ph><ph id=\"ph37\">&lt;td&gt;</ph>Node Type<ph id=\"ph38\">&lt;/td&gt;</ph><ph id=\"ph39\">\n         &lt;td&gt;</ph>Specify the nodes on which the customization script is run. You can choose <ph id=\"ph40\">&lt;b&gt;</ph>All Nodes<ph id=\"ph41\">&lt;/b&gt;</ph>, <ph id=\"ph42\">&lt;b&gt;</ph>Head nodes only<ph id=\"ph43\">&lt;/b&gt;</ph>, or <ph id=\"ph44\">&lt;b&gt;</ph>Worker nodes only<ph id=\"ph45\">&lt;/b&gt;</ph>.\n     <ph id=\"ph46\">&lt;tr&gt;</ph><ph id=\"ph47\">&lt;td&gt;</ph>Parameters<ph id=\"ph48\">&lt;/td&gt;</ph><ph id=\"ph49\">\n         &lt;td&gt;</ph>Specify the parameters, if required by the script.<ph id=\"ph50\">&lt;/td&gt;</ph><ph id=\"ph51\">&lt;/tr&gt;</ph><ph id=\"ph52\">\n &lt;/table&gt;</ph>",
      "nodes": [
        {
          "content": "<ph id=\"ph17\">&lt;table border='1'&gt;</ph><ph id=\"ph18\">\n     &lt;tr&gt;</ph><ph id=\"ph19\">&lt;th&gt;</ph>Property<ph id=\"ph20\">&lt;/th&gt;</ph><ph id=\"ph21\">&lt;th&gt;</ph>Value<ph id=\"ph22\">&lt;/th&gt;</ph><ph id=\"ph23\">&lt;/tr&gt;</ph><ph id=\"ph24\">\n     &lt;tr&gt;</ph><ph id=\"ph25\">&lt;td&gt;</ph>Name<ph id=\"ph26\">&lt;/td&gt;</ph><ph id=\"ph27\">\n         &lt;td&gt;</ph>Specify a name for the script action.<ph id=\"ph28\">&lt;/td&gt;</ph><ph id=\"ph29\">&lt;/tr&gt;</ph><ph id=\"ph30\">\n     &lt;tr&gt;</ph><ph id=\"ph31\">&lt;td&gt;</ph>Script URI<ph id=\"ph32\">&lt;/td&gt;</ph><ph id=\"ph33\">\n         &lt;td&gt;</ph>Specify the URI to the script that is invoked to customize the cluster.",
          "pos": [
            0,
            687
          ]
        },
        {
          "content": "s<ph id=\"ph34\">&lt;/td&gt;</ph><ph id=\"ph35\">&lt;/tr&gt;</ph><ph id=\"ph36\">\n     &lt;tr&gt;</ph><ph id=\"ph37\">&lt;td&gt;</ph>Node Type<ph id=\"ph38\">&lt;/td&gt;</ph><ph id=\"ph39\">\n         &lt;td&gt;</ph>Specify the nodes on which the customization script is run.",
          "pos": [
            688,
            950
          ]
        },
        {
          "content": "You can choose <ph id=\"ph40\">&lt;b&gt;</ph>All Nodes<ph id=\"ph41\">&lt;/b&gt;</ph>, <ph id=\"ph42\">&lt;b&gt;</ph>Head nodes only<ph id=\"ph43\">&lt;/b&gt;</ph>, or <ph id=\"ph44\">&lt;b&gt;</ph>Worker nodes only<ph id=\"ph45\">&lt;/b&gt;</ph>.",
          "pos": [
            951,
            1186
          ]
        },
        {
          "content": "<ph id=\"ph46\">&lt;tr&gt;</ph><ph id=\"ph47\">&lt;td&gt;</ph>Parameters<ph id=\"ph48\">&lt;/td&gt;</ph><ph id=\"ph49\">\n         &lt;td&gt;</ph>Specify the parameters, if required by the script.<ph id=\"ph50\">&lt;/td&gt;</ph><ph id=\"ph51\">&lt;/tr&gt;</ph><ph id=\"ph52\">\n &lt;/table&gt;</ph>",
          "pos": [
            1192,
            1474
          ]
        }
      ]
    },
    {
      "pos": [
        5919,
        6005
      ],
      "content": "You can add more than one script action to install multiple components on the cluster."
    },
    {
      "pos": [
        6011,
        6065
      ],
      "content": "Click the checkmark to start provisioning the cluster."
    },
    {
      "pos": [
        6070,
        6103
      ],
      "content": "<bpt id=\"p22\">**</bpt>From Azure PowerShell cmdlets<ept id=\"p22\">**</ept>"
    },
    {
      "pos": [
        6105,
        6617
      ],
      "content": "Use Azure PowerShell commands for HDInsight to run a single script action or multiple script actions. You can use the <bpt id=\"p23\">**</bpt><ph id=\"ph53\">&lt;a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\"&gt;</ph>Add-AzureHDInsightScriptAction<ph id=\"ph54\">&lt;/a&gt;</ph><ept id=\"p23\">**</ept><ph id=\"ph55\"/> cmdlet to invoke custom scripts. To use these cmdlets, you must have Azure PowerShell installed and configured. For information on configuring a workstation to run Azure PowerShell cmdlets for HDInsight, see <bpt id=\"p24\">[</bpt>Install and configure Azure PowerShell<ept id=\"p24\">][powershell-install-configure]</ept>.",
      "nodes": [
        {
          "content": "Use Azure PowerShell commands for HDInsight to run a single script action or multiple script actions.",
          "pos": [
            0,
            101
          ]
        },
        {
          "content": "You can use the <bpt id=\"p23\">**</bpt><ph id=\"ph53\">&lt;a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\"&gt;</ph>Add-AzureHDInsightScriptAction<ph id=\"ph54\">&lt;/a&gt;</ph><ept id=\"p23\">**</ept><ph id=\"ph55\"/> cmdlet to invoke custom scripts.",
          "pos": [
            102,
            370
          ]
        },
        {
          "content": "To use these cmdlets, you must have Azure PowerShell installed and configured.",
          "pos": [
            371,
            449
          ]
        },
        {
          "content": "For information on configuring a workstation to run Azure PowerShell cmdlets for HDInsight, see <bpt id=\"p24\">[</bpt>Install and configure Azure PowerShell<ept id=\"p24\">][powershell-install-configure]</ept>.",
          "pos": [
            450,
            657
          ]
        }
      ]
    },
    {
      "pos": [
        6619,
        6729
      ],
      "content": "Use the following Azure PowerShell commands to run a single script action when deploying an HDInsight cluster:"
    },
    {
      "pos": [
        7047,
        7158
      ],
      "content": "Use the following Azure PowerShell commands to run multiple script actions when deploying an HDInsight cluster:"
    },
    {
      "pos": [
        7662,
        7693
      ],
      "content": "<bpt id=\"p25\">**</bpt>From the HDInsight .NET SDK<ept id=\"p25\">**</ept>"
    },
    {
      "pos": [
        7695,
        7728
      ],
      "content": "The HDInsight .NET SDK provides a"
    },
    {
      "pos": [
        7876,
        7888
      ],
      "content": "ScriptAction"
    },
    {
      "pos": [
        7893,
        7955
      ],
      "content": "class to invoke custom scripts. To use the HDInsight .NET SDK:",
      "nodes": [
        {
          "content": "class to invoke custom scripts.",
          "pos": [
            0,
            31
          ]
        },
        {
          "content": "To use the HDInsight .NET SDK:",
          "pos": [
            32,
            62
          ]
        }
      ]
    },
    {
      "pos": [
        7960,
        8199
      ],
      "content": "Create a Visual Studio application, and then install the SDK from NuGet. From the <bpt id=\"p26\">**</bpt>Tools<ept id=\"p26\">**</ept><ph id=\"ph56\"/> menu, click <bpt id=\"p27\">**</bpt>Nuget Package Manager<ept id=\"p27\">**</ept>, and then click <bpt id=\"p28\">**</bpt>Package Manager Console<ept id=\"p28\">**</ept>. Run the following command in the console to install the package:",
      "nodes": [
        {
          "content": "Create a Visual Studio application, and then install the SDK from NuGet.",
          "pos": [
            0,
            72
          ]
        },
        {
          "content": "From the <bpt id=\"p26\">**</bpt>Tools<ept id=\"p26\">**</ept><ph id=\"ph56\"/> menu, click <bpt id=\"p27\">**</bpt>Nuget Package Manager<ept id=\"p27\">**</ept>, and then click <bpt id=\"p28\">**</bpt>Package Manager Console<ept id=\"p28\">**</ept>.",
          "pos": [
            73,
            309
          ]
        },
        {
          "content": "Run the following command in the console to install the package:",
          "pos": [
            310,
            374
          ]
        }
      ]
    },
    {
      "pos": [
        8273,
        8412
      ],
      "content": "Create a cluster by using the SDK. For instructions, see <bpt id=\"p29\">[</bpt>Provision HDInsight cluster using .NET SDK<ept id=\"p29\">](hdinsight-provision-clusters.md#sdk)</ept>.",
      "nodes": [
        {
          "content": "Create a cluster by using the SDK.",
          "pos": [
            0,
            34
          ]
        },
        {
          "content": "For instructions, see <bpt id=\"p29\">[</bpt>Provision HDInsight cluster using .NET SDK<ept id=\"p29\">](hdinsight-provision-clusters.md#sdk)</ept>.",
          "pos": [
            35,
            179
          ]
        }
      ]
    },
    {
      "pos": [
        8417,
        8489
      ],
      "content": "Use the <bpt id=\"p30\">**</bpt>ScriptAction<ept id=\"p30\">**</ept><ph id=\"ph57\"/> class to invoke a custom script as shown below:"
    },
    {
      "pos": [
        9252,
        9311
      ],
      "content": "Support for open-source software used on HDInsight clusters"
    },
    {
      "pos": [
        9312,
        9847
      ],
      "content": "The Microsoft Azure HDInsight service is a flexible platform that enables you to build big-data applications in the cloud by using an ecosystem of open-source technologies formed around Hadoop. Microsoft Azure provides a general level of support for open-source technologies, as discussed in the <bpt id=\"p31\">**</bpt>Support Scope<ept id=\"p31\">**</ept><ph id=\"ph58\"/> section of the <ph id=\"ph59\">&lt;a href=\"http://azure.microsoft.com/support/faq/\" target=\"_blank\"&gt;</ph>Azure Support FAQ website<ph id=\"ph60\">&lt;/a&gt;</ph>. The HDInsight service provides an additional level of support for some of the components, as described below.",
      "nodes": [
        {
          "content": "The Microsoft Azure HDInsight service is a flexible platform that enables you to build big-data applications in the cloud by using an ecosystem of open-source technologies formed around Hadoop.",
          "pos": [
            0,
            193
          ]
        },
        {
          "content": "Microsoft Azure provides a general level of support for open-source technologies, as discussed in the <bpt id=\"p31\">**</bpt>Support Scope<ept id=\"p31\">**</ept><ph id=\"ph58\"/> section of the <ph id=\"ph59\">&lt;a href=\"http://azure.microsoft.com/support/faq/\" target=\"_blank\"&gt;</ph>Azure Support FAQ website<ph id=\"ph60\">&lt;/a&gt;</ph>.",
          "pos": [
            194,
            530
          ]
        },
        {
          "content": "The HDInsight service provides an additional level of support for some of the components, as described below.",
          "pos": [
            531,
            640
          ]
        }
      ]
    },
    {
      "pos": [
        9849,
        9939
      ],
      "content": "There are two types of open-source components that are available in the HDInsight service:"
    },
    {
      "pos": [
        9943,
        10342
      ],
      "content": "<bpt id=\"p32\">**</bpt>Built-in components<ept id=\"p32\">**</ept><ph id=\"ph61\"/> - These components are pre-installed on HDInsight clusters and provide core functionality of the cluster. For example, YARN ResourceManager, the Hive query language (HiveQL), and the Mahout library belong to this category. A full list of cluster components is available in <bpt id=\"p33\">[</bpt>What's new in the Hadoop cluster versions provided by HDInsight?<ept id=\"p33\">](hdinsight-component-versioning.md)</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p32\">**</bpt>Built-in components<ept id=\"p32\">**</ept><ph id=\"ph61\"/> - These components are pre-installed on HDInsight clusters and provide core functionality of the cluster.",
          "pos": [
            0,
            184
          ]
        },
        {
          "content": "For example, YARN ResourceManager, the Hive query language (HiveQL), and the Mahout library belong to this category.",
          "pos": [
            185,
            301
          ]
        },
        {
          "content": "A full list of cluster components is available in <bpt id=\"p33\">[</bpt>What's new in the Hadoop cluster versions provided by HDInsight?<ept id=\"p33\">](hdinsight-component-versioning.md)</ept>.",
          "pos": [
            302,
            494
          ]
        }
      ]
    },
    {
      "pos": [
        10345,
        10495
      ],
      "content": "<bpt id=\"p34\">**</bpt>Custom components<ept id=\"p34\">**</ept><ph id=\"ph62\"/> - You, as a user of the cluster, can install or use in your workload any component available in the community or created by you."
    },
    {
      "pos": [
        10497,
        10628
      ],
      "content": "Built-in components are fully supported, and Microsoft Support will help to isolate and resolve issues related to these components."
    },
    {
      "pos": [
        10630,
        10970
      ],
      "content": "Custom components receive commercially reasonable support to help you to further troubleshoot the issue. This might result in resolving the issue or asking you to engage available channels for the open-source technologies where deep expertise for that technology is found. For example, there are many community sites that can be used, like:",
      "nodes": [
        {
          "content": "Custom components receive commercially reasonable support to help you to further troubleshoot the issue.",
          "pos": [
            0,
            104
          ]
        },
        {
          "content": "This might result in resolving the issue or asking you to engage available channels for the open-source technologies where deep expertise for that technology is found.",
          "pos": [
            105,
            272
          ]
        },
        {
          "content": "For example, there are many community sites that can be used, like:",
          "pos": [
            273,
            340
          ]
        }
      ]
    },
    {
      "pos": [
        11066,
        11090
      ],
      "content": "MSDN forum for HDInsight"
    },
    {
      "pos": [
        11095,
        11098
      ],
      "content": "and"
    },
    {
      "pos": [
        11150,
        11164
      ],
      "content": "Stack Overflow"
    },
    {
      "pos": [
        11168,
        11213
      ],
      "content": ". Also, Apache projects have project sites on",
      "nodes": [
        {
          "content": ".",
          "pos": [
            0,
            1
          ]
        },
        {
          "content": "Also, Apache projects have project sites on",
          "pos": [
            2,
            45
          ]
        }
      ]
    },
    {
      "pos": [
        11258,
        11268
      ],
      "content": "Apache.org"
    },
    {
      "pos": [
        11272,
        11286
      ],
      "content": "; for example,"
    },
    {
      "pos": [
        11339,
        11345
      ],
      "content": "Hadoop"
    },
    {
      "pos": [
        11350,
        11353
      ],
      "content": "and"
    },
    {
      "pos": [
        11405,
        11410
      ],
      "content": "Spark"
    },
    {
      "pos": [
        11414,
        11415
      ],
      "content": "."
    },
    {
      "pos": [
        11417,
        11686
      ],
      "content": "The HDInsight service provides several ways to use custom components. Regardless of how a component is used or installed on the cluster, the same level of support applies. Below is a list of the most common ways that custom components can be used on HDInsight clusters:",
      "nodes": [
        {
          "content": "The HDInsight service provides several ways to use custom components.",
          "pos": [
            0,
            69
          ]
        },
        {
          "content": "Regardless of how a component is used or installed on the cluster, the same level of support applies.",
          "pos": [
            70,
            171
          ]
        },
        {
          "content": "Below is a list of the most common ways that custom components can be used on HDInsight clusters:",
          "pos": [
            172,
            269
          ]
        }
      ]
    },
    {
      "pos": [
        11691,
        11808
      ],
      "content": "Job submission - Hadoop or other types of jobs that execute or use custom components can be submitted to the cluster."
    },
    {
      "pos": [
        11812,
        11963
      ],
      "content": "Cluster customization - During cluster creation, you can specify additional settings and custom components that will be installed on the cluster nodes."
    },
    {
      "pos": [
        11967,
        12155
      ],
      "content": "Samples - For popular custom components, Microsoft and others may provide samples of how these components can be used on the HDInsight clusters. These samples are provided without support.",
      "nodes": [
        {
          "content": "Samples - For popular custom components, Microsoft and others may provide samples of how these components can be used on the HDInsight clusters.",
          "pos": [
            0,
            144
          ]
        },
        {
          "content": "These samples are provided without support.",
          "pos": [
            145,
            188
          ]
        }
      ]
    },
    {
      "pos": [
        12160,
        12189
      ],
      "content": "Develop Script Action scripts"
    },
    {
      "pos": [
        12191,
        12265
      ],
      "content": "See <bpt id=\"p35\">[</bpt>Develop Script Action scripts for HDInsight<ept id=\"p35\">][hdinsight-write-script]</ept>."
    },
    {
      "pos": [
        12272,
        12280
      ],
      "content": "See also"
    },
    {
      "pos": [
        12284,
        12468
      ],
      "content": "<bpt id=\"p36\">[</bpt>Provision Hadoop clusters in HDInsight using custom options<ept id=\"p36\">][hdinsight-provision-cluster]</ept><ph id=\"ph63\"/> provides instructions on how to provision an HDInsight cluster by using other custom options."
    },
    {
      "pos": [
        12471,
        12540
      ],
      "content": "<bpt id=\"p37\">[</bpt>Develop Script Action scripts for HDInsight<ept id=\"p37\">][hdinsight-write-script]</ept>"
    },
    {
      "pos": [
        12543,
        12613
      ],
      "content": "<bpt id=\"p38\">[</bpt>Install and use Spark on HDInsight clusters<ept id=\"p38\">][hdinsight-install-spark]</ept>"
    },
    {
      "pos": [
        12616,
        12678
      ],
      "content": "<bpt id=\"p39\">[</bpt>Install and use R on HDInsight clusters<ept id=\"p39\">][hdinsight-install-r]</ept>"
    },
    {
      "pos": [
        12681,
        12760
      ],
      "content": "<bpt id=\"p40\">[</bpt>Install and use Solr on HDInsight clusters<ept id=\"p40\">](hdinsight-hadoop-solr-install.md)</ept>."
    },
    {
      "pos": [
        12763,
        12846
      ],
      "content": "<bpt id=\"p41\">[</bpt>Install and use Giraph on HDInsight clusters<ept id=\"p41\">](hdinsight-hadoop-giraph-install.md)</ept>."
    }
  ],
  "content": "<properties \n    pageTitle=\"Customize HDInsight Clusters using script actions | Microsoft Azure\" \n    description=\"Learn how to customize HDInsight clusters using Script Action.\" \n    services=\"hdinsight\" \n    documentationCenter=\"\" \n    authors=\"nitinme\" \n    manager=\"paulettm\" \n    editor=\"cgronlun\"/> \n\n<tags \n    ms.service=\"hdinsight\" \n    ms.workload=\"big-data\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"11/29/2015\" \n    ms.author=\"nitinme\"/> \n\n# Customize HDInsight clusters using Script Action\n\n[AZURE.INCLUDE [hdinsight-azure-portal](../../includes/hdinsight-azure-portal.md)]\n\n* [Customize HDInsight clusters using Script Action](hdinsight-hadoop-customize-cluster.md)\n\nHDInsight provides a configuration option called **Script Action** that invokes custom scripts, which define the customization to be performed on the cluster during the provision process. These scripts can be used to install additional software on a cluster, or to change the configuration of applications on a cluster. \n\n\n> [AZURE.NOTE] Script Action is only supported on HDInsight cluster version 3.1 or higher with the Windows operating system.  For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).\n> \n> Script Action is available as part of the standard Azure HDInsight subscriptions at no extra charge.\n\nHDInsight clusters can be customized in a variety of other ways as well, such as including additional Azure Storage accounts, changing the Hadoop configuration files (core-site.xml, hive-site.xml, etc.), or adding shared libraries (e.g., Hive, Oozie) into common locations in the cluster. These customizations can be done through Azure PowerShell, the Azure HDInsight .NET SDK, or the Azure Classic Portal. For more information, see [Provision Hadoop clusters in HDInsight using custom options][hdinsight-provision-cluster].\n\n## Script Action in the cluster provision process\n\nScript Action is only used while a clusters is in the process of being created. The following diagram illustrates when Script Action is executed during the provision process:\n\n![HDInsight cluster customization and stages during cluster provisioning][img-hdi-cluster-states] \n\nWhen the script is running, the cluster enters the **ClusterCustomization** stage. At this stage, the script is run under the system admin account, in parallel on all the specified nodes in the cluster, and provides full admin privileges on the nodes. \n\n> [AZURE.NOTE] Because you have admin privileges on the cluster nodes during the **ClusterCustomization** stage, you can use the script to perform operations like stopping and starting services, including Hadoop-related services. So, as part of the script, you must ensure that the Ambari services and other Hadoop-related services are up and running before the script finishes running. These services are required to successfully ascertain the health and state of the cluster while it is being created. If you change any configuration on the cluster that affects these services, you must use the helper functions that are provided. For more information about helper functions, see [Develop Script Action scripts for HDInsight][hdinsight-write-script].\n\nThe output and the error logs for the script are stored in the default Storage account you specified for the cluster. The logs are stored in a table with the name **u<\\cluster-name-fragment><\\time-stamp>setuplog**. These are aggregate logs from the script run on all the nodes (head node and worker nodes) in the cluster.\n\n\nEach cluster can accept multiple script actions that are invoked in the order in which they are specified. A script can be ran on the head node, the worker nodes, or both. \n\n## Call Script Action scripts\n\nScript Action scripts can be used from the Azure Classic Portal, Azure PowerShell, or the HDInsight .NET SDK.\n\nHDInsight provides several scripts to install the following components on HDInsight clusters:\n\nName | Script\n----- | -----\n**Install Spark** | https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1. See [Install and use Spark on HDInsight clusters][hdinsight-install-spark].\n**Install R** | https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1. See [Install and use R on HDInsight clusters][hdinsight-install-r].\n**Install Solr** | https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1. See [Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).\n- **Install Giraph** | https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1. See [Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).\n\n\n\n**From the Azure Classic Portal**\n\n1. Start provisioning a cluster by using the **CUSTOM CREATE** option, as described at [Provisioning a cluster using custom options](hdinsight-provision-clusters.md#portal). \n2. On the **Script Actions** page of the wizard, click **add script action** to provide details about the script action, as shown below:\n\n    ![Use Script Action to customize a cluster](./media/hdinsight-hadoop-customize-cluster-v1/HDI.CustomProvision.Page6.png \"Use Script Action to customize a cluster\")\n    \n    <table border='1'>\n        <tr><th>Property</th><th>Value</th></tr>\n        <tr><td>Name</td>\n            <td>Specify a name for the script action.</td></tr>\n        <tr><td>Script URI</td>\n            <td>Specify the URI to the script that is invoked to customize the cluster. s</td></tr>\n        <tr><td>Node Type</td>\n            <td>Specify the nodes on which the customization script is run. You can choose <b>All Nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.\n        <tr><td>Parameters</td>\n            <td>Specify the parameters, if required by the script.</td></tr>\n    </table>\n\n    You can add more than one script action to install multiple components on the cluster. \n\n3. Click the checkmark to start provisioning the cluster. \n  \n**From Azure PowerShell cmdlets**\n\nUse Azure PowerShell commands for HDInsight to run a single script action or multiple script actions. You can use the **<a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\">Add-AzureHDInsightScriptAction</a>** cmdlet to invoke custom scripts. To use these cmdlets, you must have Azure PowerShell installed and configured. For information on configuring a workstation to run Azure PowerShell cmdlets for HDInsight, see [Install and configure Azure PowerShell][powershell-install-configure].\n\nUse the following Azure PowerShell commands to run a single script action when deploying an HDInsight cluster:\n\n    $config = New-AzureHDInsightClusterConfig –ClusterSizeInNodes 4\n\n    $config = Add-AzureHDInsightScriptAction -Config $config –Name MyScriptActionName –Uri http://uri.to/scriptaction.ps1 –Parameters MyScriptActionParameter -ClusterRoleCollection HeadNode,DataNode\n\n    New-AzureHDInsightCluster -Config $config\n\nUse the following Azure PowerShell commands to run multiple script actions when deploying an HDInsight cluster:\n\n    $config = New-AzureHDInsightClusterConfig –ClusterSizeInNodes 4\n\n    $config = Add-AzureHDInsightScriptAction -Config $config –Name MyScriptActionName1 –Uri http://uri.to/scriptaction1.ps1 –Parameters MyScriptAction1Parameters -ClusterRoleCollection HeadNode,DataNode | Add-AzureHDInsightScriptAction -Config $config –Name MyScriptActionName2 –Uri http://uri.to/scriptaction2.ps1 -Parameters MyScriptAction2Parameters -ClusterRoleCollection HeadNode\n\n    New-AzureHDInsightCluster -Config $config\n\n**From the HDInsight .NET SDK**\n\nThe HDInsight .NET SDK provides a <a href=\"http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx\" target=\"_blank\">ScriptAction</a> class to invoke custom scripts. To use the HDInsight .NET SDK:\n\n1. Create a Visual Studio application, and then install the SDK from NuGet. From the **Tools** menu, click **Nuget Package Manager**, and then click **Package Manager Console**. Run the following command in the console to install the package:\n\n        Install-Package Microsoft.WindowsAzure.Management.HDInsight\n\n2. Create a cluster by using the SDK. For instructions, see [Provision HDInsight cluster using .NET SDK](hdinsight-provision-clusters.md#sdk).\n\n3. Use the **ScriptAction** class to invoke a custom script as shown below:\n\n        \n        var clusterInfo = new ClusterCreateParameters()\n        {\n            // Provide the cluster information, like\n            // name, Storage account, credentials,\n            // cluster size, and version            \n            ...\n            ...\n        };\n\n        // Add the script action to install Spark\n        clusterInfo.ConfigActions.Add(new ScriptAction(\n            \"MyScriptActionName\", // Name of the config action\n            new ClusterNodeType[] { ClusterNodeType.HeadNode }, // List of nodes to install the component on\n            new Uri(\"http://uri.to/scriptaction.ps1\"), // Location of the script to install the component\n            \"MyScriptActionParameter\" //Parameters, if any, required by the script\n        ));\n\n\n\n## Support for open-source software used on HDInsight clusters\nThe Microsoft Azure HDInsight service is a flexible platform that enables you to build big-data applications in the cloud by using an ecosystem of open-source technologies formed around Hadoop. Microsoft Azure provides a general level of support for open-source technologies, as discussed in the **Support Scope** section of the <a href=\"http://azure.microsoft.com/support/faq/\" target=\"_blank\">Azure Support FAQ website</a>. The HDInsight service provides an additional level of support for some of the components, as described below.\n\nThere are two types of open-source components that are available in the HDInsight service:\n\n- **Built-in components** - These components are pre-installed on HDInsight clusters and provide core functionality of the cluster. For example, YARN ResourceManager, the Hive query language (HiveQL), and the Mahout library belong to this category. A full list of cluster components is available in [What's new in the Hadoop cluster versions provided by HDInsight?](hdinsight-component-versioning.md).\n- **Custom components** - You, as a user of the cluster, can install or use in your workload any component available in the community or created by you.\n\nBuilt-in components are fully supported, and Microsoft Support will help to isolate and resolve issues related to these components.\n\nCustom components receive commercially reasonable support to help you to further troubleshoot the issue. This might result in resolving the issue or asking you to engage available channels for the open-source technologies where deep expertise for that technology is found. For example, there are many community sites that can be used, like: <a href =\"https://social.msdn.microsoft.com/Forums/azure/home?forum=hdinsight\" target=\"_blank\">MSDN forum for HDInsight</a> and <a href=\"http://stackoverflow.com\" target=\"_blank\">Stack Overflow</a>. Also, Apache projects have project sites on <a href=\"http://apache.org\" target=\"_blank\">Apache.org</a>; for example, <a href=\"http://hadoop.apache.org/\" target=\"_blank\">Hadoop</a> and <a href=\"http://spark.apache.org/\" target=\"_blank\">Spark</a>.\n\nThe HDInsight service provides several ways to use custom components. Regardless of how a component is used or installed on the cluster, the same level of support applies. Below is a list of the most common ways that custom components can be used on HDInsight clusters:\n\n1. Job submission - Hadoop or other types of jobs that execute or use custom components can be submitted to the cluster.\n2. Cluster customization - During cluster creation, you can specify additional settings and custom components that will be installed on the cluster nodes.\n3. Samples - For popular custom components, Microsoft and others may provide samples of how these components can be used on the HDInsight clusters. These samples are provided without support.\n\n## Develop Script Action scripts\n\nSee [Develop Script Action scripts for HDInsight][hdinsight-write-script]. \n\n\n## See also\n\n- [Provision Hadoop clusters in HDInsight using custom options][hdinsight-provision-cluster] provides instructions on how to provision an HDInsight cluster by using other custom options.\n- [Develop Script Action scripts for HDInsight][hdinsight-write-script]\n- [Install and use Spark on HDInsight clusters][hdinsight-install-spark]\n- [Install and use R on HDInsight clusters][hdinsight-install-r]\n- [Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).\n- [Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).\n\n[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md\n[hdinsight-install-r]: hdinsight-hadoop-r-scripts.md\n[hdinsight-write-script]: hdinsight-hadoop-script-actions.md\n[hdinsight-provision-cluster]: hdinsight-provision-clusters.md\n[powershell-install-configure]: powershell-install-configure.md\n\n\n[img-hdi-cluster-states]: ./media/hdinsight-hadoop-customize-cluster-v1/HDI-Cluster-state.png \"Stages during cluster provisioning\"\n "
}