{
  "nodes": [
    {
      "pos": [
        26,
        108
      ],
      "content": "Create Windows-based Hadoop clusters in HDInsight using .NET SDK | Microsoft Azure"
    },
    {
      "pos": [
        127,
        201
      ],
      "content": "Learn how to create HDInsight clusters for Azure HDInsight using .NET SDK."
    },
    {
      "pos": [
        512,
        576
      ],
      "content": "Create Windows-based Hadoop clusters in HDInsight using .NET SDK"
    },
    {
      "pos": [
        668,
        906
      ],
      "content": "Learn how to create HDInsight clusters using .NET SDK. For other cluster creation tools and features click the tab select on the top of this page or see <bpt id=\"p1\">[</bpt>Cluster creation methods<ept id=\"p1\">](hdinsight-provision-clusters.md#cluster-creation-methods)</ept>.",
      "nodes": [
        {
          "content": "Learn how to create HDInsight clusters using .NET SDK.",
          "pos": [
            0,
            54
          ]
        },
        {
          "content": "For other cluster creation tools and features click the tab select on the top of this page or see <bpt id=\"p1\">[</bpt>Cluster creation methods<ept id=\"p1\">](hdinsight-provision-clusters.md#cluster-creation-methods)</ept>.",
          "pos": [
            55,
            276
          ]
        }
      ]
    },
    {
      "pos": [
        912,
        926
      ],
      "content": "Prerequisites:"
    },
    {
      "pos": [
        928,
        1007
      ],
      "content": "Before you begin the instructions in this article, you must have the following:"
    },
    {
      "pos": [
        1011,
        1165
      ],
      "content": "An Azure subscription. See <bpt id=\"p2\">[</bpt>Get Azure free trial<ept id=\"p2\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
      "nodes": [
        {
          "content": "An Azure subscription.",
          "pos": [
            0,
            22
          ]
        },
        {
          "content": "See <bpt id=\"p2\">[</bpt>Get Azure free trial<ept id=\"p2\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
          "pos": [
            23,
            192
          ]
        }
      ]
    },
    {
      "pos": [
        1168,
        1195
      ],
      "content": "Visual Studio 2013 or 2015."
    },
    {
      "pos": [
        1200,
        1215
      ],
      "content": "Create clusters"
    },
    {
      "pos": [
        1216,
        1466
      ],
      "content": "The HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application. Follow the instructions below to create a Visual Studio console application and paste the code for creating a cluster.",
      "nodes": [
        {
          "content": "The HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application.",
          "pos": [
            0,
            131
          ]
        },
        {
          "content": "Follow the instructions below to create a Visual Studio console application and paste the code for creating a cluster.",
          "pos": [
            132,
            250
          ]
        }
      ]
    },
    {
      "pos": [
        1468,
        1670
      ],
      "content": "The application requires an Azure resource group, and the default storage account.  The <bpt id=\"p3\">[</bpt>Appendix A<ept id=\"p3\">](#appx-a-create-dependent-components)</ept><ph id=\"ph3\"/> provices a PowerShell script to create the dependent components.",
      "nodes": [
        {
          "content": "The application requires an Azure resource group, and the default storage account.",
          "pos": [
            0,
            82
          ]
        },
        {
          "content": "The <bpt id=\"p3\">[</bpt>Appendix A<ept id=\"p3\">](#appx-a-create-dependent-components)</ept><ph id=\"ph3\"/> provices a PowerShell script to create the dependent components.",
          "pos": [
            84,
            254
          ]
        }
      ]
    },
    {
      "pos": [
        1672,
        1721
      ],
      "content": "<bpt id=\"p4\">**</bpt>To create a Visual Studio console application<ept id=\"p4\">**</ept>"
    },
    {
      "pos": [
        1726,
        1779
      ],
      "content": "Create a new C# console application in Visual Studio."
    },
    {
      "pos": [
        1783,
        1855
      ],
      "content": "Run the following Nuget command in the Nuget Package Management console."
    },
    {
      "pos": [
        1994,
        2121
      ],
      "content": "From Solution Explorer, double-click <bpt id=\"p5\">**</bpt>Program.cs<ept id=\"p5\">**</ept><ph id=\"ph4\"/> to open it, paste the following code, and provide values for the variables:"
    },
    {
      "pos": [
        6430,
        6665
      ],
      "content": "Press <bpt id=\"p6\">**</bpt>F5<ept id=\"p6\">**</ept><ph id=\"ph5\"/> to run the application. A console window should open and display the status of the application. You will also be prompted to enter your Azure account credentials. It can take several minutes to create an HDInsight cluster.",
      "nodes": [
        {
          "content": "Press <bpt id=\"p6\">**</bpt>F5<ept id=\"p6\">**</ept><ph id=\"ph5\"/> to run the application.",
          "pos": [
            0,
            88
          ]
        },
        {
          "content": "A console window should open and display the status of the application.",
          "pos": [
            89,
            160
          ]
        },
        {
          "content": "You will also be prompted to enter your Azure account credentials.",
          "pos": [
            161,
            227
          ]
        },
        {
          "content": "It can take several minutes to create an HDInsight cluster.",
          "pos": [
            228,
            287
          ]
        }
      ]
    },
    {
      "pos": [
        6671,
        6681
      ],
      "content": "Next steps"
    },
    {
      "pos": [
        6682,
        6803
      ],
      "content": "In this article, you have learned several ways to create an HDInsight cluster. To learn more, see the following articles:",
      "nodes": [
        {
          "content": "In this article, you have learned several ways to create an HDInsight cluster.",
          "pos": [
            0,
            78
          ]
        },
        {
          "content": "To learn more, see the following articles:",
          "pos": [
            79,
            121
          ]
        }
      ]
    },
    {
      "pos": [
        6807,
        6946
      ],
      "content": "<bpt id=\"p7\">[</bpt>Get started with Azure HDInsight<ept id=\"p7\">](hdinsight-hadoop-linux-tutorial-get-started.md)</ept><ph id=\"ph6\"/> - Learn how to start working with your HDInsight cluster"
    },
    {
      "pos": [
        6949,
        7093
      ],
      "content": "<bpt id=\"p8\">[</bpt>Submit Hadoop jobs programmatically<ept id=\"p8\">](hdinsight-submit-hadoop-jobs-programmatically.md)</ept><ph id=\"ph7\"/> - Learn how to programmatically submit jobs to HDInsight"
    },
    {
      "pos": [
        7096,
        7190
      ],
      "content": "<bpt id=\"p9\">[</bpt>Azure HDInsight SDK documentation<ept id=\"p9\">] [hdinsight-sdk-documentation]</ept><ph id=\"ph8\"/> - Discover the HDInsight SDK"
    },
    {
      "pos": [
        7643,
        7677
      ],
      "content": "Appx-A Create dependent components"
    },
    {
      "pos": [
        7679,
        7811
      ],
      "content": "The following Azure PowerShell script can be use to create the dependent components needed by the .NET application in this tutorial."
    }
  ],
  "content": "<properties\n   pageTitle=\"Create Windows-based Hadoop clusters in HDInsight using .NET SDK | Microsoft Azure\"\n    description=\"Learn how to create HDInsight clusters for Azure HDInsight using .NET SDK.\"\n   services=\"hdinsight\"\n   documentationCenter=\"\"\n   tags=\"azure-portal\"\n   authors=\"mumian\"\n   manager=\"paulettm\"\n   editor=\"cgronlun\"/>\n\n<tags\n   ms.service=\"hdinsight\"\n   ms.devlang=\"na\"\n   ms.topic=\"article\"\n   ms.tgt_pltfrm=\"na\"\n   ms.workload=\"big-data\"\n   ms.date=\"01/13/2016\"\n   ms.author=\"jgao\"/>\n\n# Create Windows-based Hadoop clusters in HDInsight using .NET SDK\n\n[AZURE.INCLUDE [selector](../../includes/hdinsight-create-windows-cluster-selector.md)]\n\n\nLearn how to create HDInsight clusters using .NET SDK. For other cluster creation tools and features click the tab select on the top of this page or see [Cluster creation methods](hdinsight-provision-clusters.md#cluster-creation-methods).\n\n\n###Prerequisites:\n\nBefore you begin the instructions in this article, you must have the following:\n\n- An Azure subscription. See [Get Azure free trial](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).\n- Visual Studio 2013 or 2015.\n\n## Create clusters\nThe HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application. Follow the instructions below to create a Visual Studio console application and paste the code for creating a cluster.\n\nThe application requires an Azure resource group, and the default storage account.  The [Appendix A](#appx-a-create-dependent-components) provices a PowerShell script to create the dependent components.\n\n**To create a Visual Studio console application**\n\n1. Create a new C# console application in Visual Studio.\n2. Run the following Nuget command in the Nuget Package Management console.\n\n        Install-Package Microsoft.Azure.Common.Authentication -pre\n        Install-Package Microsoft.Azure.Management.HDInsight -Pre\n\n6. From Solution Explorer, double-click **Program.cs** to open it, paste the following code, and provide values for the variables:\n\n        using System;\n        using System.Security;\n        using Microsoft.Azure;\n        using Microsoft.Azure.Common.Authentication;\n        using Microsoft.Azure.Common.Authentication.Factories;\n        using Microsoft.Azure.Common.Authentication.Models;\n        using Microsoft.Azure.Management.HDInsight;\n        using Microsoft.Azure.Management.HDInsight.Models;\n        \n        namespace CreateHDInsightCluster\n        {\n            class Program\n            {\n                private static HDInsightManagementClient _hdiManagementClient;\n        \n                private static Guid SubscriptionId = new Guid(\"<Azure Subscription ID>\");\n                private const string ExistingResourceGroupName = \"<Azure Resource Group Name>\";\n                private const string ExistingStorageName = \"<Default Storage Account Name>.blob.core.windows.net\";\n                private const string ExistingStorageKey = \"<Default Storage Account Key>\";\n                private const string ExistingBlobContainer = \"<Default Blob Container Name>\";\n                private const string NewClusterName = \"<HDInsight Cluster Name>\";\n                private const int NewClusterNumNodes = 1;\n                private const string NewClusterLocation = \"EAST US 2\";     // Must be the same as the default Storage account\n                private const OSType NewClusterOsType = OSType.Windows;\n                private const HDInsightClusterType NewClusterType = HDInsightClusterType.Hadoop;\n                private const string NewClusterVersion = \"3.2\";\n                private const string NewClusterUsername = \"admin\";\n                private const string NewClusterPassword = \"<HTTP User password>\";\n        \n                static void Main(string[] args)\n                {\n                    System.Console.WriteLine(\"Creating a cluster.  The process takes 10 to 20 minutes ...\");\n        \n                    var tokenCreds = GetTokenCloudCredentials();\n                    var subCloudCredentials = GetSubscriptionCloudCredentials(tokenCreds, SubscriptionId);\n        \n                    _hdiManagementClient = new HDInsightManagementClient(subCloudCredentials);\n                \n                    var parameters = new ClusterCreateParameters\n                    {\n                        ClusterSizeInNodes = NewClusterNumNodes,\n                        UserName = NewClusterUsername,\n                        Password = NewClusterPassword,\n                        Location = NewClusterLocation,\n                        DefaultStorageAccountName = ExistingStorageName,\n                        DefaultStorageAccountKey = ExistingStorageKey,\n                        DefaultStorageContainer = ExistingBlobContainer,\n                        ClusterType = NewClusterType,\n                        OSType = NewClusterOsType\n                    };\n        \n                    _hdiManagementClient.Clusters.Create(ExistingResourceGroupName, NewClusterName, parameters);\n\n                    System.Console.WriteLine(\"The cluster has been created. Press ENTER to continue ...\");\n                    System.Console.ReadLine();\n                    \n                }\n\n                public static TokenCloudCredentials GetTokenCloudCredentials(string username = null, SecureString password = null)\n                {\n                    var authFactory = new AuthenticationFactory();\n        \n                    var account = new AzureAccount { Type = AzureAccount.AccountType.User };\n        \n                    if (username != null && password != null)\n                        account.Id = username;\n        \n                    var env = AzureEnvironment.PublicEnvironments[EnvironmentName.AzureCloud];\n        \n                    var accessToken =\n                        authFactory.Authenticate(account, env, AuthenticationFactory.CommonAdTenant, password, ShowDialog.Auto)\n                            .AccessToken;\n        \n                    return new TokenCloudCredentials(accessToken);\n                }\n        \n                public static SubscriptionCloudCredentials GetSubscriptionCloudCredentials(TokenCloudCredentials creds, Guid subId)\n                {\n                    return new TokenCloudCredentials(subId.ToString(), creds.Token);\n        \n                }\n            }\n        }\n\n7. Press **F5** to run the application. A console window should open and display the status of the application. You will also be prompted to enter your Azure account credentials. It can take several minutes to create an HDInsight cluster.\n\n\n\n##Next steps\nIn this article, you have learned several ways to create an HDInsight cluster. To learn more, see the following articles:\n\n* [Get started with Azure HDInsight](hdinsight-hadoop-linux-tutorial-get-started.md) - Learn how to start working with your HDInsight cluster\n* [Submit Hadoop jobs programmatically](hdinsight-submit-hadoop-jobs-programmatically.md) - Learn how to programmatically submit jobs to HDInsight\n* [Azure HDInsight SDK documentation] [hdinsight-sdk-documentation] - Discover the HDInsight SDK\n\n\n[hdinsight-sdk-documentation]: http://msdn.microsoft.com/library/dn479185.aspx\n[azure-preview-portal]: https://manage.windowsazure.com\n[connectionmanager]: http://msdn.microsoft.com/library/mt146773(v=sql.120).aspx\n[ssispack]: http://msdn.microsoft.com/library/mt146770(v=sql.120).aspx\n[ssisclustercreate]: http://msdn.microsoft.com/library/mt146774(v=sql.120).aspx\n[ssisclusterdelete]: http://msdn.microsoft.com/library/mt146778(v=sql.120).aspx\n\n\n##Appx-A Create dependent components\n\nThe following Azure PowerShell script can be use to create the dependent components needed by the .NET application in this tutorial.\n\n    ####################################\n    # Set these variables\n    ####################################\n    #region - used for creating Azure service names\n    $nameToken = \"<Enter an Alias>\" \n    #endregion\n\n    ####################################\n    # Service names and varialbes\n    ####################################\n    #region - service names\n    $namePrefix = $nameToken.ToLower() + (Get-Date -Format \"MMdd\")\n\n    $resourceGroupName = $namePrefix + \"rg\"\n    $hdinsightClusterName = $namePrefix + \"hdi\"\n    $defaultStorageAccountName = $namePrefix + \"store\"\n    $defaultBlobContainerName = $hdinsightClusterName\n\n    $location = \"East US 2\"\n    #endregion\n\n    # Treat all errors as terminating\n    $ErrorActionPreference = \"Stop\"\n\n    ####################################\n    # Connect to Azure\n    ####################################\n    #region - Connect to Azure subscription\n    Write-Host \"`nConnecting to your Azure subscription ...\" -ForegroundColor Green\n    try{Get-AzureRmContext}\n    catch{Login-AzureRmAccount}\n    #endregion\n\n    #region - Create an HDInsight cluster\n    ####################################\n    # Create dependent components\n    ####################################\n    Write-Host \"Creating a resource group ...\" -ForegroundColor Green\n    New-AzureRmResourceGroup `\n        -Name  $resourceGroupName `\n        -Location $location\n\n    Write-Host \"Creating the default storage account and default blob container ...\"  -ForegroundColor Green\n    New-AzureRmStorageAccount `\n        -ResourceGroupName $resourceGroupName `\n        -Name $defaultStorageAccountName `\n        -Location $location `\n        -Type Standard_GRS\n\n    $defaultStorageAccountKey = Get-AzureRmStorageAccountKey `\n                                    -ResourceGroupName $resourceGroupName `\n                                    -Name $defaultStorageAccountName |  %{ $_.Key1 }\n    $defaultStorageContext = New-AzureStorageContext `\n                                    -StorageAccountName $defaultStorageAccountName `\n                                    -StorageAccountKey $defaultStorageAccountKey\n    New-AzureStorageContainer `\n        -Name $defaultBlobContainerName `\n        -Context $defaultStorageContext #use the cluster name as the container name\n\n    Write-Host \"Use the following names in your .NET application\" -ForegroundColor Green\n    Write-host \"Resource Group Name: $resourceGroupName\"\n    Write-host \"Default Storage Account Name: $defaultStorageAccountName\"\n    Write-host \"Default Storage Account Key: $defaultStorageAccountKey\"\n    Write-host \"Default Blob Container Name: $defaultBlobContainerName\"\n"
}