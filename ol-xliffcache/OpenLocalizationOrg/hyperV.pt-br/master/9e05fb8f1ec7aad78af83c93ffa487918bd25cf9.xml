{
  "nodes": [
    {
      "content": "How to use Access Control (.NET) | Microsoft Azure",
      "pos": [
        27,
        77
      ]
    },
    {
      "content": "Learn how to use Access Control Service (ACS) in your Azure application to authenticate users when they try to gain access to a web app.",
      "pos": [
        96,
        232
      ]
    },
    {
      "content": "How to Authenticate Web Users with Azure Active Directory Access Control",
      "pos": [
        558,
        630
      ]
    },
    {
      "content": "This guide shows you how to use Azure Active Directory Access Control (also known as Access Control Service or ACS) to authenticate users from identity providers such as Microsoft, Google, Yahoo, and Facebook when they try to gain access to a web application.",
      "pos": [
        633,
        892
      ]
    },
    {
      "content": "What is ACS?",
      "pos": [
        898,
        910
      ]
    },
    {
      "content": "Most developers are not identity experts and do not want to spend time developing authentication and authorization mechanisms for their applications and services.",
      "pos": [
        912,
        1074
      ]
    },
    {
      "content": "ACS is an Azure service that provides an easy way for you to authenticate users to access your web applications and services without having to add complex authentication logic to your code.",
      "pos": [
        1075,
        1264
      ]
    },
    {
      "content": "The following features are available in ACS:",
      "pos": [
        1266,
        1310
      ]
    },
    {
      "content": "Integration with Windows Identity Foundation (WIF).",
      "pos": [
        1316,
        1367
      ]
    },
    {
      "content": "Support for popular web identity providers (IPs) including Microsoft accounts (formerly known as Windows Live ID), Google, Yahoo, and Facebook.",
      "pos": [
        1372,
        1515
      ]
    },
    {
      "content": "Support for Active Directory Federation Services (AD FS) 2.0.",
      "pos": [
        1520,
        1581
      ]
    },
    {
      "pos": [
        1586,
        1695
      ],
      "content": "An Open Data Protocol (OData)-based management service that provides\nprogrammatic access to ACS settings.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "An Open Data Protocol (OData)-based management service that provides",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "programmatic access to ACS settings.",
          "pos": [
            69,
            105
          ]
        }
      ]
    },
    {
      "pos": [
        1700,
        1778
      ],
      "content": "A Management Portal that allows administrative access to the ACS\nsettings.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "A Management Portal that allows administrative access to the ACS",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "settings.",
          "pos": [
            65,
            74
          ]
        }
      ]
    },
    {
      "pos": [
        1780,
        1847
      ],
      "content": "For more information about ACS, see <bpt id=\"p1\">[</bpt>Access Control Service 2.0<ept id=\"p1\">][]</ept>."
    },
    {
      "content": "Concepts",
      "pos": [
        1852,
        1860
      ]
    },
    {
      "content": "ACS is built on the principles of claims-based identity -- a consistent approach to creating authentication mechanisms for applications running on-premises or in the cloud.",
      "pos": [
        1862,
        2034
      ]
    },
    {
      "content": "Claims-based identity provides a common way for applications and services to get the identity information they need about users inside their organization, in other organizations, and on the Internet.",
      "pos": [
        2035,
        2234
      ]
    },
    {
      "content": "To complete the tasks in this guide, you should understand the following terms and concepts are used in this guide:",
      "pos": [
        2236,
        2351
      ]
    },
    {
      "pos": [
        2354,
        2435
      ],
      "content": "<bpt id=\"p1\">**</bpt>Client<ept id=\"p1\">**</ept> - A browser that is attempting to gain access to your web application."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Relying party (RP) application<ept id=\"p1\">**</ept> - Your web app.",
      "pos": [
        2437,
        2487
      ]
    },
    {
      "content": "An RP application is a website or service that outsources authentication to one external authority.",
      "pos": [
        2488,
        2587
      ]
    },
    {
      "content": "In identity jargon, we say that the RP trusts that authority.",
      "pos": [
        2588,
        2649
      ]
    },
    {
      "content": "This guide explains how to configure your application to trust ACS.",
      "pos": [
        2650,
        2717
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Token<ept id=\"p1\">**</ept> - A user gains access to an RP application by presenting a valid token that was issued by an authority that the RP application trusts.",
      "pos": [
        2719,
        2863
      ]
    },
    {
      "content": "A collection of security data that is issued when a client is authenticated.",
      "pos": [
        2864,
        2940
      ]
    },
    {
      "content": "It contains a set of claims, which are attributes of the authenticated user, such as a user's name or age, or an identifier for a user role.",
      "pos": [
        2941,
        3081
      ]
    },
    {
      "content": "A token is digitally signed so its issuer can be identified and its content cannot be changed.",
      "pos": [
        3082,
        3176
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Identity Provider (IP)<ept id=\"p1\">**</ept> - An  authority that authenticates user identities and issues security tokens, such as Microsoft account (Windows Live ID), Facebook,  Google, Twitter, and Active Directory.",
      "pos": [
        3178,
        3378
      ]
    },
    {
      "content": "When ACS is configured to trust an IP, it accepts and validates the tokens that the IP issues.",
      "pos": [
        3379,
        3473
      ]
    },
    {
      "content": "Because ACS can trust multiple IPs at the same time, when your application trusts ACS, you can  your application can offer users the option to be authenticated by any of the IPs that ACS trusts on your behalf.",
      "pos": [
        3474,
        3683
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Federation Provider (FP)<ept id=\"p1\">**</ept> - Identity providers (IPs) have direct knowledge of users, authenticate users by using their credentials, and issue claims about users.",
      "pos": [
        3685,
        3849
      ]
    },
    {
      "content": "A Federation Provider (FP) is a different kind of authority.",
      "pos": [
        3850,
        3910
      ]
    },
    {
      "content": "Instead of authenticating users directly, the FP brokers authentication.",
      "pos": [
        3911,
        3983
      ]
    },
    {
      "content": "It acts as an intermediary between a relying party application and one or more IPs.",
      "pos": [
        3984,
        4067
      ]
    },
    {
      "content": "ACS is a federation provider (FP).",
      "pos": [
        4068,
        4102
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>ACS Rule Engine<ept id=\"p1\">**</ept> - Claims transformation rules convert the claims in tokens from trusted IPs so they can be used by an RP.",
      "pos": [
        4104,
        4229
      ]
    },
    {
      "content": "ACS includes a rule engine that  applies the claims transformation rules that you specify for your RP.",
      "pos": [
        4230,
        4332
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Access Control Namespace<ept id=\"p1\">**</ept> - Provides a unique scope for addressing ACS resources within your application.",
      "pos": [
        4334,
        4442
      ]
    },
    {
      "content": "The namespace contains your settings, such as the IPs you trust, the RP applications you want to serve, the rules that you apply to incoming tokens, and it displays the endpoints that the application and the developer use to communicate with ACS.",
      "pos": [
        4443,
        4689
      ]
    },
    {
      "content": "The following figure shows how ACS authentication works with a web application:",
      "pos": [
        4691,
        4770
      ]
    },
    {
      "content": "The client (in this case, a browser) requests a page from the RP.",
      "pos": [
        4784,
        4849
      ]
    },
    {
      "pos": [
        4854,
        5101
      ],
      "content": "Since the request is not yet authenticated, the RP redirects the\nuser to the authority that it trusts, which is ACS. The ACS presents\nthe user with the choice of IPs that were specified for this RP. The\nuser selects the appropriate IP.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Since the request is not yet authenticated, the RP redirects the",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "user to the authority that it trusts, which is ACS. The ACS presents",
          "pos": [
            65,
            133
          ],
          "nodes": [
            {
              "content": "user to the authority that it trusts, which is ACS.",
              "pos": [
                0,
                51
              ]
            },
            {
              "content": "The ACS presents",
              "pos": [
                52,
                68
              ]
            }
          ]
        },
        {
          "content": "the user with the choice of IPs that were specified for this RP. The",
          "pos": [
            134,
            202
          ],
          "nodes": [
            {
              "content": "the user with the choice of IPs that were specified for this RP.",
              "pos": [
                0,
                64
              ]
            },
            {
              "content": "The",
              "pos": [
                65,
                68
              ]
            }
          ]
        },
        {
          "content": "user selects the appropriate IP.",
          "pos": [
            203,
            235
          ]
        }
      ]
    },
    {
      "pos": [
        5106,
        5193
      ],
      "content": "The client browses to the IP's authentication page, and prompts the\nuser to log on.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "The client browses to the IP's authentication page, and prompts the",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "user to log on.",
          "pos": [
            68,
            83
          ]
        }
      ]
    },
    {
      "pos": [
        5198,
        5320
      ],
      "content": "After the client is authenticated (for example, the identity\ncredentials are entered), the IP issues a security token.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "After the client is authenticated (for example, the identity",
          "pos": [
            0,
            60
          ]
        },
        {
          "content": "credentials are entered), the IP issues a security token.",
          "pos": [
            61,
            118
          ]
        }
      ]
    },
    {
      "content": "After issuing a security token, the IP directs the client to send the security token that the IP issued to ACS.",
      "pos": [
        5325,
        5436
      ]
    },
    {
      "pos": [
        5441,
        5677
      ],
      "content": "ACS validates the security token issued by the IP, inputs the\nidentity claims in this token into the ACS rules engine, calculates\nthe output identity claims, and issues a new security token that\ncontains these output claims.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "ACS validates the security token issued by the IP, inputs the",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "identity claims in this token into the ACS rules engine, calculates",
          "pos": [
            62,
            129
          ]
        },
        {
          "content": "the output identity claims, and issues a new security token that",
          "pos": [
            130,
            194
          ]
        },
        {
          "content": "contains these output claims.",
          "pos": [
            195,
            224
          ]
        }
      ]
    },
    {
      "content": "ACS directs the client to send the security token that ACS issued to the RP.",
      "pos": [
        5682,
        5758
      ]
    },
    {
      "content": "The RP validates the signature on the security token, extracts claims for use by the application business logic, and returns the page that was originally requested.",
      "pos": [
        5759,
        5923
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        5928,
        5941
      ]
    },
    {
      "content": "To complete the tasks in this guide, you will need the following:",
      "pos": [
        5944,
        6009
      ]
    },
    {
      "content": "Azure subscription",
      "pos": [
        6015,
        6033
      ]
    },
    {
      "content": "Microsoft Visual Studio 2012",
      "pos": [
        6038,
        6066
      ]
    },
    {
      "pos": [
        6071,
        6166
      ],
      "content": "Identity and Access Tool for Visual Studio 2012 (To download, see <bpt id=\"p1\">[</bpt>Identity and Access Tool<ept id=\"p1\">][]</ept>)"
    },
    {
      "content": "Create an Access Control Namespace",
      "pos": [
        6172,
        6206
      ]
    },
    {
      "content": "To use Active Directory Access Control in Azure, create an Access Control namespace.",
      "pos": [
        6208,
        6292
      ]
    },
    {
      "content": "The namespace provides a unique scope for",
      "pos": [
        6293,
        6334
      ]
    },
    {
      "content": "addressing ACS resources within your application.",
      "pos": [
        6335,
        6384
      ]
    },
    {
      "pos": [
        6390,
        6465
      ],
      "content": "Log into the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">][]</ept> (https://manage.WindowsAzure.com)."
    },
    {
      "pos": [
        6471,
        6498
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Active Directory<ept id=\"p1\">**</ept>."
    },
    {
      "content": "To create a new Access Control namespace, click <bpt id=\"p1\">**</bpt>New<ept id=\"p1\">**</ept>.",
      "pos": [
        6518,
        6574
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>App Services<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Access Control<ept id=\"p2\">**</ept> will be selected.",
      "pos": [
        6575,
        6632
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Quick Create<ept id=\"p1\">**</ept>.",
      "pos": [
        6633,
        6656
      ]
    },
    {
      "content": "Enter a name for the namespace.",
      "pos": [
        6674,
        6705
      ]
    },
    {
      "content": "Azure verifies that the name is unique.",
      "pos": [
        6706,
        6745
      ]
    },
    {
      "content": "Select the region in which the namespace is used.",
      "pos": [
        6751,
        6800
      ]
    },
    {
      "content": "For best performance, use the region in which you are deploying your application, and then click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>.",
      "pos": [
        6801,
        6909
      ]
    },
    {
      "content": "Azure creates and activates the namespace.",
      "pos": [
        6911,
        6953
      ]
    },
    {
      "content": "Create an ASP.NET MVC Application",
      "pos": [
        6958,
        6991
      ]
    },
    {
      "content": "In this step, you create a ASP.NET MVC application.",
      "pos": [
        6993,
        7044
      ]
    },
    {
      "content": "In later steps, we'll integrate this simple web forms application with ACS.",
      "pos": [
        7045,
        7120
      ]
    },
    {
      "content": "Start Visual Studio 2012 or Visual Studio Express for Web 2012 (Previous versions of Visual Studio will not work with this tutorial).",
      "pos": [
        7126,
        7259
      ]
    },
    {
      "pos": [
        7264,
        7311
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>New Project<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        7316,
        7401
      ],
      "content": "Select the Visual C#/Web template, and then select <bpt id=\"p1\">**</bpt>ASP.NET MVC 4 Web Application<ept id=\"p1\">**</ept>."
    },
    {
      "content": "We'll use a MVC application for this guide, but you can use any web application type for this task.",
      "pos": [
        7407,
        7506
      ]
    },
    {
      "pos": [
        7523,
        7575
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>, type <bpt id=\"p2\">**</bpt>MvcACS<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        7579,
        7654
      ],
      "content": "In the next dialog, select <bpt id=\"p1\">**</bpt>Internet Application<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        7658,
        7757
      ],
      "content": "Edit the <bpt id=\"p1\">*</bpt>Views\\Shared\\_LoginPartial.cshtml<ept id=\"p1\">*</ept> file and replace the contents with the following code:"
    },
    {
      "content": "Currently, ACS doesn't set User.Identity.Name, so we need to make the above change.",
      "pos": [
        8818,
        8901
      ]
    },
    {
      "content": "Press F5 to run the application.",
      "pos": [
        8906,
        8938
      ]
    },
    {
      "content": "The default ASP.NET MVC application appears in your web browser.",
      "pos": [
        8939,
        9003
      ]
    },
    {
      "content": "Integrate your Web Application with ACS",
      "pos": [
        9008,
        9047
      ]
    },
    {
      "content": "In this task, you will integrate your ASP.NET web application with ACS.",
      "pos": [
        9049,
        9120
      ]
    },
    {
      "pos": [
        9126,
        9220
      ],
      "content": "In Solution Explorer, right-click the MvcACS project, and then select <bpt id=\"p1\">**</bpt>Identity and Access<ept id=\"p1\">**</ept>."
    },
    {
      "content": "If the <bpt id=\"p1\">**</bpt>Identity and Access<ept id=\"p1\">**</ept> option does not appear on the context menu, install the Identity and Access Tool.",
      "pos": [
        9226,
        9338
      ]
    },
    {
      "content": "For information, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Identity and Access Tool]</ept>.",
      "pos": [
        9339,
        9387
      ]
    },
    {
      "pos": [
        9405,
        9479
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Providers<ept id=\"p1\">**</ept> tab, select <bpt id=\"p2\">**</bpt>Use the Azure Access Control Service<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9498,
        9527
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Configure<ept id=\"p1\">**</ept> link."
    },
    {
      "content": "Visual Studio requests information about the Access Control namespace.",
      "pos": [
        9547,
        9617
      ]
    },
    {
      "content": "Enter the namespace name you created earlier (Test in this images above, but you will have a different namespace).",
      "pos": [
        9618,
        9732
      ]
    },
    {
      "content": "Switch back to the Azure Management Portal to get the symmetric key.",
      "pos": [
        9733,
        9801
      ]
    },
    {
      "pos": [
        9820,
        9913
      ],
      "content": "In the Azure Management Portal, click the Access Control namespace and then click <bpt id=\"p1\">**</bpt>Manage<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9931,
        9997
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Management Service<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Management Client<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Symmetric Key<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Show Key<ept id=\"p2\">**</ept>, and copy the key value.",
      "pos": [
        10016,
        10084
      ]
    },
    {
      "content": "Then, click <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> to exit the Edit Management Client page without making changes.",
      "pos": [
        10085,
        10171
      ]
    },
    {
      "pos": [
        10190,
        10339
      ],
      "content": "In Visual Studio, paste the key in the <bpt id=\"p1\">**</bpt>Enter the Management Key for the namespace<ept id=\"p1\">**</ept> field and click <bpt id=\"p2\">**</bpt>Save management key<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Visual Studio uses the information about the namespace to connect to the ACS Management Portal and get the settings for your namespace, including the identity providers, realm, and return URL.",
      "pos": [
        10358,
        10550
      ]
    },
    {
      "pos": [
        10556,
        10616
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Windows Live ID<ept id=\"p1\">**</ept> (Microsoft account) and click OK."
    },
    {
      "content": "Test the Integration with ACS",
      "pos": [
        10633,
        10662
      ]
    },
    {
      "content": "This task explains how to test the integration of your RP application and ACS.",
      "pos": [
        10664,
        10742
      ]
    },
    {
      "content": "Press F5 in Visual Studio to run the app.",
      "pos": [
        10748,
        10789
      ]
    },
    {
      "content": "When your application is integrated with ACS and you have selected Windows Live ID (Microsoft account), instead of opening the default ASP.NET Web Forms application, your browser is redirected to the sign-in page for Microsoft accounts.",
      "pos": [
        10791,
        11027
      ]
    },
    {
      "content": "When you sign in with a valid user name a password, you are then redirected to the  MvcACS application.",
      "pos": [
        11028,
        11131
      ]
    },
    {
      "content": "Congratulations!",
      "pos": [
        11141,
        11157
      ]
    },
    {
      "content": "You have successfully integrated ACS with your ASP.NET web application.",
      "pos": [
        11158,
        11229
      ]
    },
    {
      "content": "ACS is now handling the authentication of users using their Microsoft account credentials.",
      "pos": [
        11230,
        11320
      ]
    },
    {
      "content": "View Claims Sent By ACS",
      "pos": [
        11325,
        11348
      ]
    },
    {
      "content": "In this section we will modify the application to view the claims sent by ACS.",
      "pos": [
        11350,
        11428
      ]
    },
    {
      "content": "The Identity and Access tool has created a rule group that passes through all claims from the IP to your application.",
      "pos": [
        11430,
        11547
      ]
    },
    {
      "content": "Note that different identity providers send different claims.",
      "pos": [
        11549,
        11610
      ]
    },
    {
      "content": "Open the <bpt id=\"p1\">*</bpt>Controllers\\HomeController.cs<ept id=\"p1\">*</ept> file.",
      "pos": [
        11615,
        11661
      ]
    },
    {
      "content": "Add a <bpt id=\"p1\">**</bpt>using<ept id=\"p1\">**</ept> statement for <bpt id=\"p2\">**</bpt>System.Threading<ept id=\"p2\">**</ept>:",
      "pos": [
        11662,
        11713
      ]
    },
    {
      "content": "using System.Threading;",
      "pos": [
        11719,
        11742
      ]
    },
    {
      "pos": [
        11747,
        11799
      ],
      "content": "In the HomeController class add the <bpt id=\"p1\">*</bpt>Claims<ept id=\"p1\">*</ept> method:"
    },
    {
      "pos": [
        11805,
        11886
      ],
      "content": "public ActionResult Claims()\n {\n     ViewBag.Message = \"Your claims page.\";",
      "leadings": [
        "",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "public ActionResult Claims()",
          "pos": [
            0,
            28
          ]
        },
        {
          "content": "{",
          "pos": [
            30,
            31
          ]
        },
        {
          "content": "ViewBag.Message = \"Your claims page.\";",
          "pos": [
            37,
            75
          ]
        }
      ]
    },
    {
      "content": "}",
      "pos": [
        11983,
        11984
      ]
    },
    {
      "pos": [
        11989,
        12048
      ],
      "content": "Right click on the <bpt id=\"p1\">*</bpt>Claims<ept id=\"p1\">*</ept> method and select <bpt id=\"p2\">**</bpt>Add View<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        12062,
        12076
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        12081,
        12165
      ],
      "content": "Replace the contents of the <bpt id=\"p1\">*</bpt>Views\\Home\\Claims.cshtml<ept id=\"p1\">*</ept> file with the following code:"
    },
    {
      "pos": [
        13394,
        13450
      ],
      "content": "Run the application and navigate to the <bpt id=\"p1\">*</bpt>Claims<ept id=\"p1\">*</ept> method:"
    },
    {
      "pos": [
        13462,
        13615
      ],
      "content": "For more information on using claims in your application, see the <bpt id=\"p1\">[</bpt>Windows Identity Foundation library<ept id=\"p1\">](http://msdn.microsoft.com/library/hh377151.aspx)</ept>."
    },
    {
      "content": "View the App in the ACS Management Portal",
      "pos": [
        13620,
        13661
      ]
    },
    {
      "content": "The Identity and Access Tool in Visual Studio automatically integrates your application with ACS.",
      "pos": [
        13663,
        13760
      ]
    },
    {
      "content": "When you select the Use Azure Access Control option and then run your application, the Identity and Access Tool adds your application as a relying party, configures it to use the selected identity providers, and generates and selects the default claims transformation rules for the application.",
      "pos": [
        13762,
        14056
      ]
    },
    {
      "content": "You can review and change these configuration settings in the ACS Management Portal.",
      "pos": [
        14058,
        14142
      ]
    },
    {
      "content": "Use the following steps to review the changes in the portal.",
      "pos": [
        14143,
        14203
      ]
    },
    {
      "pos": [
        14209,
        14288
      ],
      "content": "Log into the Windows <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://manage.WindowsAzure.com)</ept>."
    },
    {
      "pos": [
        14294,
        14321
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Active Directory<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Select an Access Control namespace and then click <bpt id=\"p1\">**</bpt>Manage<ept id=\"p1\">**</ept>.",
      "pos": [
        14339,
        14400
      ]
    },
    {
      "content": "This action opens the ACS Management Portal.",
      "pos": [
        14401,
        14445
      ]
    },
    {
      "pos": [
        14464,
        14501
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Relying party applications<ept id=\"p1\">**</ept>."
    },
    {
      "content": "The new MvcACS application appears in the list of relying party applications.",
      "pos": [
        14507,
        14584
      ]
    },
    {
      "content": "The realm is automatically set to the application main page.",
      "pos": [
        14585,
        14645
      ]
    },
    {
      "pos": [
        14665,
        14682
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>MvcACS<ept id=\"p1\">**</ept>."
    },
    {
      "content": "The Edit Relying Party Application page contains configuration settings for the MvcACS web application.",
      "pos": [
        14688,
        14791
      ]
    },
    {
      "content": "When you change the settings on this page and save them, the changes are immediately applied to the application.",
      "pos": [
        14792,
        14904
      ]
    },
    {
      "content": "Scroll down the page to see the remaining configuration settings for the MvcACS application, including the identity providers and claims transformation rules.",
      "pos": [
        14923,
        15081
      ]
    },
    {
      "content": "In the next section, we'll use the features of the ACS Management Portal to make a change to the web application -- just to show how easy it is to do.",
      "pos": [
        15096,
        15246
      ]
    },
    {
      "content": "Add an Identity Provider",
      "pos": [
        15251,
        15275
      ]
    },
    {
      "content": "Let's use the ACS Management Portal to change the authentication of our MvcACS application.",
      "pos": [
        15277,
        15368
      ]
    },
    {
      "content": "In this example, we'll add Google as an identity provider for MvcACS.",
      "pos": [
        15369,
        15438
      ]
    },
    {
      "pos": [
        15444,
        15521
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Identity providers<ept id=\"p1\">**</ept> (in the navigation menu) and then click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Google<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.",
      "pos": [
        15540,
        15581
      ]
    },
    {
      "content": "The MvcACS app checkbox is selected by default.",
      "pos": [
        15582,
        15629
      ]
    },
    {
      "content": "Click Save.",
      "pos": [
        15647,
        15658
      ]
    },
    {
      "content": "Done!",
      "pos": [
        15674,
        15679
      ]
    },
    {
      "content": "If you go back to Visual Studio, open the project for the MvcACS app, and click <bpt id=\"p1\">**</bpt>Identity and Access<ept id=\"p1\">**</ept>, the tool lists both the Windows Live ID and Google identity providers.",
      "pos": [
        15680,
        15855
      ]
    },
    {
      "content": "And, when you run your application, you'll see the effect.",
      "pos": [
        15868,
        15926
      ]
    },
    {
      "content": "When an application supports more than one identity provider, the user's browser is first directed to a page hosted by ACS that prompts the user to choose an identity provider.",
      "pos": [
        15927,
        16103
      ]
    },
    {
      "content": "After the user selects an identity provider, the browser goes to the identity provider sign-in page.",
      "pos": [
        16113,
        16213
      ]
    },
    {
      "content": "What's Next",
      "pos": [
        16218,
        16229
      ]
    },
    {
      "content": "You have created a web application that is integrated with ACS.",
      "pos": [
        16231,
        16294
      ]
    },
    {
      "content": "But, this is just the beginning!",
      "pos": [
        16295,
        16327
      ]
    },
    {
      "content": "You can expand on this scenario.",
      "pos": [
        16328,
        16360
      ]
    },
    {
      "content": "For example, you can add more identity providers for this RP or allow users registered in enterprise directories, such as Active Directory Domain Services, to log on to the web application.",
      "pos": [
        16362,
        16551
      ]
    },
    {
      "content": "You can also add rules to your namespace that determine which claims are sent to an application for processing in the application business logic.",
      "pos": [
        16553,
        16698
      ]
    },
    {
      "pos": [
        16700,
        16809
      ],
      "content": "To further explore ACS functionality and to experiment with more scenarios, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Access Control Service 2.0]</ept>."
    }
  ],
  "content": "<properties\n    pageTitle=\"How to use Access Control (.NET) | Microsoft Azure\"\n    description=\"Learn how to use Access Control Service (ACS) in your Azure application to authenticate users when they try to gain access to a web app.\"\n    services=\"active-directory\"\n    documentationCenter=\".net\"\n    authors=\"msmbaldwin\"\n    manager=\"mbaldwin\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"active-directory\"\n    ms.workload=\"identity\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"dotnet\"\n    ms.topic=\"article\"\n    ms.date=\"12/05/2015\" \n    ms.author=\"mbaldwin\"/>\n\n\n\n\n# How to Authenticate Web Users with Azure Active Directory Access Control\n\n\nThis guide shows you how to use Azure Active Directory Access Control (also known as Access Control Service or ACS) to authenticate users from identity providers such as Microsoft, Google, Yahoo, and Facebook when they try to gain access to a web application.\n\n\n## What is ACS?\n\nMost developers are not identity experts and do not want to spend time developing authentication and authorization mechanisms for their applications and services. ACS is an Azure service that provides an easy way for you to authenticate users to access your web applications and services without having to add complex authentication logic to your code.\n\nThe following features are available in ACS:\n\n-   Integration with Windows Identity Foundation (WIF).\n-   Support for popular web identity providers (IPs) including Microsoft accounts (formerly known as Windows Live ID), Google, Yahoo, and Facebook.\n-   Support for Active Directory Federation Services (AD FS) 2.0.\n-   An Open Data Protocol (OData)-based management service that provides\n    programmatic access to ACS settings.\n-   A Management Portal that allows administrative access to the ACS\n    settings.\n\nFor more information about ACS, see [Access Control Service 2.0][].\n\n## Concepts\n\nACS is built on the principles of claims-based identity -- a consistent approach to creating authentication mechanisms for applications running on-premises or in the cloud. Claims-based identity provides a common way for applications and services to get the identity information they need about users inside their organization, in other organizations, and on the Internet.\n\nTo complete the tasks in this guide, you should understand the following terms and concepts are used in this guide:\n\n\n**Client** - A browser that is attempting to gain access to your web application.\n\n**Relying party (RP) application** - Your web app. An RP application is a website or service that outsources authentication to one external authority. In identity jargon, we say that the RP trusts that authority. This guide explains how to configure your application to trust ACS.\n\n**Token** - A user gains access to an RP application by presenting a valid token that was issued by an authority that the RP application trusts. A collection of security data that is issued when a client is authenticated. It contains a set of claims, which are attributes of the authenticated user, such as a user's name or age, or an identifier for a user role. A token is digitally signed so its issuer can be identified and its content cannot be changed.\n\n**Identity Provider (IP)** - An  authority that authenticates user identities and issues security tokens, such as Microsoft account (Windows Live ID), Facebook,  Google, Twitter, and Active Directory. When ACS is configured to trust an IP, it accepts and validates the tokens that the IP issues. Because ACS can trust multiple IPs at the same time, when your application trusts ACS, you can  your application can offer users the option to be authenticated by any of the IPs that ACS trusts on your behalf.\n\n**Federation Provider (FP)** - Identity providers (IPs) have direct knowledge of users, authenticate users by using their credentials, and issue claims about users. A Federation Provider (FP) is a different kind of authority. Instead of authenticating users directly, the FP brokers authentication. It acts as an intermediary between a relying party application and one or more IPs. ACS is a federation provider (FP).\n\n**ACS Rule Engine** - Claims transformation rules convert the claims in tokens from trusted IPs so they can be used by an RP. ACS includes a rule engine that  applies the claims transformation rules that you specify for your RP.\n\n**Access Control Namespace** - Provides a unique scope for addressing ACS resources within your application. The namespace contains your settings, such as the IPs you trust, the RP applications you want to serve, the rules that you apply to incoming tokens, and it displays the endpoints that the application and the developer use to communicate with ACS.\n\nThe following figure shows how ACS authentication works with a web application:\n\n![][0]\n\n1.  The client (in this case, a browser) requests a page from the RP.\n2.  Since the request is not yet authenticated, the RP redirects the\n    user to the authority that it trusts, which is ACS. The ACS presents\n    the user with the choice of IPs that were specified for this RP. The\n    user selects the appropriate IP.\n3.  The client browses to the IP's authentication page, and prompts the\n    user to log on.\n4.  After the client is authenticated (for example, the identity\n    credentials are entered), the IP issues a security token.\n5.  After issuing a security token, the IP directs the client to send the security token that the IP issued to ACS.\n6.  ACS validates the security token issued by the IP, inputs the\n    identity claims in this token into the ACS rules engine, calculates\n    the output identity claims, and issues a new security token that\n    contains these output claims.\n7.  ACS directs the client to send the security token that ACS issued to the RP. The RP validates the signature on the security token, extracts claims for use by the application business logic, and returns the page that was originally requested.\n\n## Prerequisites\n\n\nTo complete the tasks in this guide, you will need the following:\n\n-   Azure subscription\n-   Microsoft Visual Studio 2012\n-   Identity and Access Tool for Visual Studio 2012 (To download, see [Identity and Access Tool][])\n\n\n## Create an Access Control Namespace\n\nTo use Active Directory Access Control in Azure, create an Access Control namespace. The namespace provides a unique scope for\naddressing ACS resources within your application.\n\n1.  Log into the [Azure Management Portal][] (https://manage.WindowsAzure.com).\n\n2.  Click **Active Directory**.  \n\n    ![][1]\n\n3.  To create a new Access Control namespace, click **New**. **App Services** and **Access Control** will be selected. Click **Quick Create**.\n\n    ![][2]\n\n4.  Enter a name for the namespace. Azure verifies that the name is unique.\n\n5.  Select the region in which the namespace is used. For best performance, use the region in which you are deploying your application, and then click **Create**.\n\nAzure creates and activates the namespace.\n\n## Create an ASP.NET MVC Application\n\nIn this step, you create a ASP.NET MVC application. In later steps, we'll integrate this simple web forms application with ACS.\n\n1.  Start Visual Studio 2012 or Visual Studio Express for Web 2012 (Previous versions of Visual Studio will not work with this tutorial).\n1.  Click **File**, and then click **New Project**.\n1.  Select the Visual C#/Web template, and then select **ASP.NET MVC 4 Web Application**.\n\n    We'll use a MVC application for this guide, but you can use any web application type for this task.\n\n    ![][3]\n\n1. In **Name**, type **MvcACS**, and then click **OK**.\n1. In the next dialog, select **Internet Application**, and then click **OK**.\n1. Edit the *Views\\Shared\\_LoginPartial.cshtml* file and replace the contents with the following code:\n\n        @if (Request.IsAuthenticated)\n        {\n            string name = \"Null ID\";\n            if (!String.IsNullOrEmpty(User.Identity.Name))\n            {\n                name = User.Identity.Name;\n            }\n            <text>\n            Hello, @Html.ActionLink(name, \"Manage\", \"Account\", routeValues: null, htmlAttributes: new { @class = \"username\", title = \"Manage\" })!\n                    @using (Html.BeginForm(\"LogOff\", \"Account\", FormMethod.Post, new { id = \"logoutForm\" }))\n                    {\n                        @Html.AntiForgeryToken()\n                        <a href=\"javascript:document.getElementById('logoutForm').submit()\">Log off</a>\n                    }\n            </text>\n        }\n        else\n        {\n            <ul>\n                <li>@Html.ActionLink(\"Register\", \"Register\", \"Account\", routeValues: null, htmlAttributes: new { id = \"registerLink\" })</li>\n                <li>@Html.ActionLink(\"Log in\", \"Login\", \"Account\", routeValues: null, htmlAttributes: new { id = \"loginLink\" })</li>\n            </ul>\n        }\n\nCurrently, ACS doesn't set User.Identity.Name, so we need to make the above change.\n\n1. Press F5 to run the application. The default ASP.NET MVC application appears in your web browser.\n\n## Integrate your Web Application with ACS\n\nIn this task, you will integrate your ASP.NET web application with ACS.\n\n1.  In Solution Explorer, right-click the MvcACS project, and then select **Identity and Access**.\n\n    If the **Identity and Access** option does not appear on the context menu, install the Identity and Access Tool. For information, see [Identity and Access Tool].\n\n    ![][4]\n\n2.  On the **Providers** tab, select **Use the Azure Access Control Service**.\n\n    ![][44]\n\n3.  Click the **Configure** link.\n\n    ![][444]\n\n    Visual Studio requests information about the Access Control namespace. Enter the namespace name you created earlier (Test in this images above, but you will have a different namespace). Switch back to the Azure Management Portal to get the symmetric key.\n\n    ![][17]\n\n4.  In the Azure Management Portal, click the Access Control namespace and then click **Manage**.\n\n    ![][8]\n\n5.  Click **Management Service** and then click **Management Client**.\n\n    ![][18]\n\n6.  Click **Symmetric Key**, click **Show Key**, and copy the key value. Then, click **Cancel** to exit the Edit Management Client page without making changes.\n\n    ![][19]\n\n7.  In Visual Studio, paste the key in the **Enter the Management Key for the namespace** field and click **Save management key**, and then click **OK**.\n\n    ![][20]\n\n    Visual Studio uses the information about the namespace to connect to the ACS Management Portal and get the settings for your namespace, including the identity providers, realm, and return URL.\n\n8.  Select **Windows Live ID** (Microsoft account) and click OK.\n\n    ![][5]\n\n## Test the Integration with ACS\n\nThis task explains how to test the integration of your RP application and ACS.\n\n-   Press F5 in Visual Studio to run the app.\n\nWhen your application is integrated with ACS and you have selected Windows Live ID (Microsoft account), instead of opening the default ASP.NET Web Forms application, your browser is redirected to the sign-in page for Microsoft accounts. When you sign in with a valid user name a password, you are then redirected to the  MvcACS application.\n\n![][6]\n\nCongratulations! You have successfully integrated ACS with your ASP.NET web application. ACS is now handling the authentication of users using their Microsoft account credentials.\n\n## View Claims Sent By ACS\n\nIn this section we will modify the application to view the claims sent by ACS.  The Identity and Access tool has created a rule group that passes through all claims from the IP to your application.  Note that different identity providers send different claims.\n\n1. Open the *Controllers\\HomeController.cs* file. Add a **using** statement for **System.Threading**:\n\n    using System.Threading;\n\n1. In the HomeController class add the *Claims* method:\n\n    public ActionResult Claims()\n    {\n        ViewBag.Message = \"Your claims page.\";\n\n        ViewBag.ClaimsIdentity = Thread.CurrentPrincipal.Identity;\n\n        return View();\n    }\n\n1. Right click on the *Claims* method and select **Add View**.\n\n![][66]\n\n1. Click **Add**.\n\n1. Replace the contents of the *Views\\Home\\Claims.cshtml* file with the following code:\n\n        @{\n            ViewBag.Title = \"Claims\";\n        }\n        <hgroup class=\"title\">\n            <h1>@ViewBag.Title.</h1>\n            <h2>@ViewBag.Message</h2>\n        </hgroup>\n        <h3>Values from Identity</h3>\n        <table>\n            <tr>\n                <td>\n                    IsAuthenticated:\n                </td>\n                <td>\n                    @ViewBag.ClaimsIdentity.IsAuthenticated\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    Name:\n                </td>\n                <td>\n                    @ViewBag.ClaimsIdentity.Name\n                </td>\n            </tr>\n        </table>\n        <h3>Claims from ClaimsIdentity</h3>\n        <table>\n            <tr>\n                <th>\n                    Claim Type\n                </th>\n                <th>\n                    Claim Value\n                </th>\n            </tr>\n                @foreach (System.Security.Claims.Claim claim in ViewBag.ClaimsIdentity.Claims ) {\n            <tr>\n                <td>\n                    @claim.Type\n                </td>\n                <td>\n                    @claim.Value\n                </td>\n            </tr>\n        }\n        </table>\n\n1. Run the application and navigate to the *Claims* method:\n\n![][666]\n\nFor more information on using claims in your application, see the [Windows Identity Foundation library](http://msdn.microsoft.com/library/hh377151.aspx).\n\n## View the App in the ACS Management Portal\n\nThe Identity and Access Tool in Visual Studio automatically integrates your application with ACS.\n\nWhen you select the Use Azure Access Control option and then run your application, the Identity and Access Tool adds your application as a relying party, configures it to use the selected identity providers, and generates and selects the default claims transformation rules for the application.\n\nYou can review and change these configuration settings in the ACS Management Portal. Use the following steps to review the changes in the portal.\n\n1.  Log into the Windows [Azure Management Portal](http://manage.WindowsAzure.com).\n\n2.  Click **Active Directory**.\n\n    ![][8]\n\n3.  Select an Access Control namespace and then click **Manage**. This action opens the ACS Management Portal.\n\n    ![][9]\n\n\n4.  Click **Relying party applications**.\n\n    The new MvcACS application appears in the list of relying party applications. The realm is automatically set to the application main page.\n\n    ![][10]\n\n\n5.  Click **MvcACS**.\n\n    The Edit Relying Party Application page contains configuration settings for the MvcACS web application. When you change the settings on this page and save them, the changes are immediately applied to the application.\n\n    ![][11]\n\n6.  Scroll down the page to see the remaining configuration settings for the MvcACS application, including the identity providers and claims transformation rules.\n\n    ![][12]\n\nIn the next section, we'll use the features of the ACS Management Portal to make a change to the web application -- just to show how easy it is to do.\n\n## Add an Identity Provider\n\nLet's use the ACS Management Portal to change the authentication of our MvcACS application. In this example, we'll add Google as an identity provider for MvcACS.\n\n1.  Click **Identity providers** (in the navigation menu) and then click **Add**.\n\n    ![][13]\n\n2.  Click **Google** and then click **Next**. The MvcACS app checkbox is selected by default.\n\n    ![][14]\n\n3. Click Save.\n\n    ![][15]\n\n\nDone! If you go back to Visual Studio, open the project for the MvcACS app, and click **Identity and Access**, the tool lists both the Windows Live ID and Google identity providers.  \n\n![][16]\n\nAnd, when you run your application, you'll see the effect. When an application supports more than one identity provider, the user's browser is first directed to a page hosted by ACS that prompts the user to choose an identity provider.\n\n![][7]\n\nAfter the user selects an identity provider, the browser goes to the identity provider sign-in page.\n\n## What's Next\n\nYou have created a web application that is integrated with ACS. But, this is just the beginning! You can expand on this scenario.\n\nFor example, you can add more identity providers for this RP or allow users registered in enterprise directories, such as Active Directory Domain Services, to log on to the web application.\n\nYou can also add rules to your namespace that determine which claims are sent to an application for processing in the application business logic.\n\nTo further explore ACS functionality and to experiment with more scenarios, see [Access Control Service 2.0].\n\n\n\n  [What is ACS?]: #what-is\n  [Concepts]: #concepts\n  [Prerequisites]: #pre\n  [Create an ASP.NET MVC Application]: #create-web-app\n  [Create an Access Control Namespace]: #create-namespace\n  [Integrate your Web Application with ACS]: #Identity-Access\n  [Test the Integration with ACS]: #Test-ACS\n  [View the Application in the ACS Management Portal]: acs-portal\n  [Add an Identity Provider]: #add-IP\n  [What's Next]: #whats-next\n  [vcsb]: #bkmk_viewClaims\n  [vpp]: #bkmk_VP\n\n  [Access Control Service 2.0]: http://go.microsoft.com/fwlink/?LinkID=212360\n  [Identity and Access Tool]: http://go.microsoft.com/fwlink/?LinkID=245849\n  [Azure Management Portal]: http://manage.WindowsAzure.com\n\n  [0]: ./media/active-directory-dotnet-how-to-use-access-control/acs-01.png\n  [1]: ./media/active-directory-dotnet-how-to-use-access-control/acsCreateNamespace.png\n  [2]: ./media/active-directory-dotnet-how-to-use-access-control/acsQuickCreate.png\n  [3]: ./media/active-directory-dotnet-how-to-use-access-control/rzMvc.png\n  [4]: ./media/active-directory-dotnet-how-to-use-access-control/rzIA.png\n[44]: ./media/active-directory-dotnet-how-to-use-access-control/rzPT.png\n [444]: ./media/active-directory-dotnet-how-to-use-access-control/rzC.png\n  [5]: ./media/active-directory-dotnet-how-to-use-access-control/acsIdAndAccess1.png\n  [6]: ./media/active-directory-dotnet-how-to-use-access-control/acsMSFTAcct.png\n  [66]: ./media/active-directory-dotnet-how-to-use-access-control/rzAv.png\n  [666]: ./media/active-directory-dotnet-how-to-use-access-control/rzCl.png\n  [7]: ./media/active-directory-dotnet-how-to-use-access-control/acsSignIn.png\n  [8]: ./media/active-directory-dotnet-how-to-use-access-control/acsClickManage.png\n  [9]: ./media/active-directory-dotnet-how-to-use-access-control/acsACSPortal.png\n  [10]: ./media/active-directory-dotnet-how-to-use-access-control/acsRPPage.png\n  [11]: ./media/active-directory-dotnet-how-to-use-access-control/acsEdit-RP.png\n  [12]: ./media/active-directory-dotnet-how-to-use-access-control/acsEdit-RP2.png\n  [13]: ./media/active-directory-dotnet-how-to-use-access-control/acsAdd-Idp.png\n  [14]: ./media/active-directory-dotnet-how-to-use-access-control/acsAdd-Google.png\n  [15]: ./media/active-directory-dotnet-how-to-use-access-control/acsSave-Google.png\n  [16]: ./media/active-directory-dotnet-how-to-use-access-control/acsIdAndA-after.png\n  [17]: ./media/active-directory-dotnet-how-to-use-access-control/acsConfigAcsNamespace.png\n  [18]: ./media/active-directory-dotnet-how-to-use-access-control/acsManagementService.png\n  [19]: ./media/active-directory-dotnet-how-to-use-access-control/acsShowKey.png\n  [20]: ./media/active-directory-dotnet-how-to-use-access-control/acsConfigAcsNamespace2.png\n\n\n"
}