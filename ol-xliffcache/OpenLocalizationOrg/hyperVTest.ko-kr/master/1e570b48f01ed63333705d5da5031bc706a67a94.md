ms입니다. ContentId: 8DE9250B-556B-47BC-AD9A-8992B3D3D0F9
제목: PowerShell 조각

#PowerShell 조각

호, HB 프로세스 테스트를 위해이 문장을 추가 합니다.
PowerShell는 awesome, 자동화 및 관리 도구에 대 한 스크립트 Hyper-v입니다.  다음은 작업을 수행할 수는 멋진 기능 중 일부를 확인해 보기에 대 한 도구 상자가입니다!

모든 Hyper-v 관리는 관리자는 모든 스크립트에 따라서 것으로 가정 하 고 Hyper-v 관리자 계정에서 코드 조각을 관리자 권한으로 실행 되어야 합니다 실행을 해야 합니다.

적절 한 사용 권한이 있는지 확실 하지 않은 경우 입력 `Get VM` 및 이동 준비가 오류 없이 실행 되는 경우.


##PowerShell 직접 도구

모든 스크립트 및 코드 조각이이 섹션에는 다음과 같은 기본 사항에 의존 합니다.

**요구 사항을** :
*  PowerShell 직접입니다.
   Windows 10 게스트와 호스트 운영 체제입니다.

**일반적인 변수** :  
`$VMName` -VMName로 문자열입니다.
참조 된 사용 가능한 Vm의 목록이 `Get VM`  
`$cred` -게스트 OS에 대 한 자격 증명입니다.
사용 하 여 채울 수 `$cred Get-credential =`

###게스트 부팅 된 경우를 확인 하십시오.

Hyper-v 관리자 종종 하기 어려우며, 게스트 운영 체제 부팅 된 여부를 알고 있는 게스트 운영 체제에 대 한 가시성을 제공 하지 않습니다.

이 명령을 사용 하 여 게스트 부팅 된 여부를 확인 합니다.

``` PowerShell
if((Invoke-Command -VMName $VMName -Credential $cred {"Test"}) -ne "Test"){Write-Host "Not Booted"} else {Write-Host "Booted"}
```

**결과**  
게스트 OS의 상태를 선언 하는 친숙 한 메시지를 인쇄 합니다.


###게스트 부팅 된 때까지 잠금 스크립트

다음 함수 (대부분의 서비스를 실행 하 고 OS 부팅 된 의미) 게스트에서 사용할 수 있는 PowerShell 때까지 대기 하는 동일한 원칙을 사용 하 여 다음을 반환 합니다.

``` PowerShell
function waitForPSDirect([string]$VMName, $cred){
   Write-Output "[$($VMName)]:: Waiting for PowerShell Direct (using $($cred.username))"
   while ((Invoke-Command -VMName $VMName -Credential $cred {"Test"} -ea SilentlyContinue) -ne "Test") {Sleep -Seconds 1}}
```

**결과**  
VM에 대 한 연결이 성공할 때까지 잠금 및 친숙 한 메시지를 인쇄 합니다.
자동으로 성공합니다.

###게스트는 네트워크에 있을 때까지 잠금 스크립트

PowerShell 직접 가상 컴퓨터 하기 전에 가상 컴퓨터 내 PowerShell 세션에 연결할 수 있는 IP 주소를 수신 했습니다.

``` PowerShell
# Wait for DHCP
while ((Get-NetIPAddress | ? AddressFamily -eq IPv4 | ? IPAddress -ne 127.0.0.1).SuffixOrigin -ne "Dhcp") {sleep -Milliseconds 10}
```

** 결과 **
DHCP 임대를 받을 때까지 잠급니다.
이 스크립트는 원하지 특정 서브넷 또는 IP 주소에 대 한 어떤 네트워크 구성에 관계 없이 작동 하므로 사용 중인.
자동으로 성공합니다.

##PowerShell 사용한 자격 증명 관리

Hyper-v 스크립트는 하나 이상의 가상 컴퓨터, Hyper-v 호스트 또는 둘 모두에 대 한 자격 증명을 처리 자주 필요 합니다.

여러 가지 방법으로 PowerShell 직접 또는 표준 PowerShell 원격으로 작업할 때이 수행할 수 있습니다.

1. 첫번째 (및 가장 간단한) 방법은 호스트와 게스트 또는 로컬 및 원격 호스트에서 유효 동일한 사용자 자격 증명을가지고 하는 것입니다.
   -Microsoft 계정으로 기록 하는 경우 또는 도메인 환경에 있는 경우 꽤 쉽습니다.
   이 시나리오에서는 실행 하기만 하면 `Invoke-command-VMName "test" {get 프로세스}`.
   
2. PowerShell 자격 증명을 묻는 메시지를 사용 합니다.  
자격 증명 일치 하지 않는 경우 가상 컴퓨터에 대 한 적절 한 자격 증명을 제공할 수 있도록 자격 증명 프롬프트를 자동으로 얻을 수 있습니다.
   
3. 자격 증명을 다시 사용할 수 있도록 변수에 저장 합니다.
   다음과 같은 간단한 명령 실행:
  ``` PowerShell
  $localCred = Get-Credential
  ```
그런 다음이 같은 코드를 실행 하 고합니다.
  ``` PowerShell
  Invoke-Command -VMName "test" -Credential $localCred  {get-process} 
  ```
만 메시지가 나타나면 자격 증명에 대 한 스크립트/PowerShell 세션 마다 한번씩 의미 합니다.

4. 스크립트에 자격 증명을 코드입니다.
   **모든 실제 작업 부하 또는 시스템에 대해이 수행 하지 마십시오**
   > 경고: (_d) 이렇게 하지 프로덕션 시스템에서.
   > 이렇게 하지 않으면 실제 암호로. _
   
   전달할 수 있는 다음과 같은 일부 코드를 사용 하 여 PSCredential 개체를 만들:
  ``` PowerShell
  $localCred = New-Object -typename System.Management.Automation.PSCredential -argumentlist "Administrator", (ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force) 
  ```
안전 하지 않은 시 키 지 못하는-하지만 테스트할 때 유용 합니다.
이제이 세션에서는 전혀에서는 프롬프트 없이 얻을 있습니다.





