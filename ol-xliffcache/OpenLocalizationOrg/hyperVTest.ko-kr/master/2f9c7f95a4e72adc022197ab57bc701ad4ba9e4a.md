ms입니다. ContentId: d0a07897-5fd2-41a5-856d-dc8b499c6783
제목: PowerShell 사용한 Windows Server 컨테이너 관리

#빠른 시작: Windows Server 컨테이너 및 PowerShell

이 문서 PowerShell 사용한 Windows Server 컨테이너 관리의 기초를 살펴봅니다.
Windows Server 컨테이너 및 Windows Server 컨테이너 이미지 만들기, Windows Server 컨테이너 및 컨테이너 이미지 제거 및 마지막으로 Windows 서버 컨테이너에 응용 프로그램을 배포 대상 항목이 포함 됩니다.
이 연습에서는 교훈을 PowerShell을 사용 하 여 Windows Server 컨테이너의 배포 및 관리를 살펴볼 때 처음 수 있어야 합니다.

궁금한 점이 있으십니까?
노라는 [Windows 컨테이너 포럼](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).

> **참고:** PowerShell을 사용 하 여 만든 Windows Server 컨테이너 하지 현재으로 관리할 수 있는 Docker 및 visa 반대의 경우도 마찬가지입니다.
> 대신 Docker와 컨테이너를 만들려면, 참조 [빠른 시작: Windows Server 컨테이너 및 Docker](./manage_docker.md).
> <br /><br /> 더 알고 싶은 경우 [FAQ를 읽으십시오.](../about/faq.md#WhydoIhavetopickbetweenDockerandPowerShellforWindowsServerContainermanagement).

##필수 구성 요소

이 연습을 완료 하기 위해 다음과 같은 항목이 마련 되어 필요 합니다.

- Windows Server 2016 TP3 또는 나중에 Windows Server 컨테이너 기능으로 구성 합니다.
   설치 가이드를 완료 한 경우 Azure 또는 Hyper-v에서 만든 VM입니다.
- 이 시스템 네트워크에 연결 되어 있고 인터넷에 액세스할 수 있어야 합니다.

컨테이너 기능을 구성 하려면 다음 가이드를 참조: [Azure에서 컨테이너 설치](./azure_setup.md) 또는 [Hyper-v에서 컨테이너 설치](./container_setup.md).

##PowerShell 사용한 기본 컨테이너 관리

이 첫번째 예제에서는 생성 및 Windows Server 컨테이너 및 PowerShell 사용 하 여 Windows Server 컨테이너 이미지를 제거 하는 기본 방법을 설명 합니다.

Windows Server 컨테이너 호스트 시스템에 로그 통해 워크를 시작 하려면 Windows 명령 프롬프트를 보게될 것입니다.

![](media/cmd.png)

입력 하 여 PowerShell 세션을 시작 `powershell`.
프롬프트에서 변경 되는 경우 PowerShell 세션에 있는지 알 수 `C:\directory >` 를 `PS C:\directory >`.

```
C:\> powershell
Windows PowerShell
Copyright (C) 2015 Microsoft Corporation. All rights reserved.

PS C:\>
```

사용 하 여 `Get-command` 컨테이너 모듈에서 사용할 수 있는 명령을 보려면

```
PS C:\> Get-Command -Module containers

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Function        Install-ContainerOSImage                           1.0.0.0    Containers
Function        Uninstall-ContainerOSImage                         1.0.0.0    Containers
Cmdlet          Add-ContainerNetworkAdapter                        1.0.0.0    Containers
Cmdlet          Connect-ContainerNetworkAdapter                    1.0.0.0    Containers
Cmdlet          Disconnect-ContainerNetworkAdapter                 1.0.0.0    Containers
Cmdlet          Export-ContainerImage                              1.0.0.0    Containers
Cmdlet          Get-Container                                      1.0.0.0    Containers
Cmdlet          Get-ContainerHost                                  1.0.0.0    Containers
Cmdlet          Get-ContainerImage                                 1.0.0.0    Containers
Cmdlet          Get-ContainerNetworkAdapter                        1.0.0.0    Containers
Cmdlet          Import-ContainerImage                              1.0.0.0    Containers
Cmdlet          Move-ContainerImageRepository                      1.0.0.0    Containers
Cmdlet          New-Container                                      1.0.0.0    Containers
Cmdlet          New-ContainerImage                                 1.0.0.0    Containers
Cmdlet          Remove-Container                                   1.0.0.0    Containers
Cmdlet          Remove-ContainerImage                              1.0.0.0    Containers
Cmdlet          Remove-ContainerNetworkAdapter                     1.0.0.0    Containers
Cmdlet          Set-ContainerNetworkAdapter                        1.0.0.0    Containers
Cmdlet          Start-Container                                    1.0.0.0    Containers
Cmdlet          Stop-Container                                     1.0.0.0    Containers
Cmdlet          Test-ContainerImage                                1.0.0.0    Containers
```


그런 다음 시스템 사용 하 여 유효한 IP 주소에 있는지를 확인 `ipconfig` 및 나중에 사용할 수 있는이 주소를 기록해둡니다.

```
ipconfig

Ethernet adapter Ethernet 3:

   Connection-specific DNS Suffix  . :
   IPv6 Address. . . . . . . . . . . : 2601:600:8f01:84eb::e
   IPv6 Address. . . . . . . . . . . : 2601:600:8f01:84eb:a8c1:a3e:96b7:ffcb
   Link-local IPv6 Address . . . . . : fe80::a8c1:a3e:96b7:ffcb%5
   IPv4 Address. . . . . . . . . . . : 192.168.1.25
```

사용 하는 대신 Azure VM에서 작업 하는 경우 `ipconfig` Azure 가상 컴퓨터의 공용 IP 주소를 가져올 해야 합니다.

![](media/newazure9.png)

###1 단계-새 컨테이너 만들기

Windows 서버 컨테이너를 만들기 전에 컨테이너 이미지의 이름 및 새 컨테이너에 연결 될 수 있는 가상 스위치의 이름이 필요 합니다.

사용 하는 `Get ContainerImage` 컨테이너 이미지 목록을 반환 하려면 명령을 호스트에 로드 합니다.
컨테이너를 만들려면 사용할 이미지 이름을 기록해둡니다.
``` PowerShell
Get-ContainerImage

Name              Publisher    Version      IsOSImage
----              ---------    -------      ---------
WindowsServerCore CN=Microsoft 10.0.10514.0 True
```

사용 하는 `Get-vmswitch` 호스트에서 사용할 수 있는 스위치의 목록을 반환 하는 명령입니다.
컨테이너와 사용 될 스위치 이름을 기록해둡니다.

``` PowerShell
Get-VMSwitch

Name           SwitchType NetAdapterInterfaceDescription
----           ---------- ------------------------------
Virtual Switch NAT
```

컨테이너를 만들려면 다음 명령을 실행 합니다.
실행할 때 `새 컨테이너` 컨테이너의 이름을, 컨테이너 이미지를 지정 및 컨테이너와 사용 하 여 네트워크 스위치를 선택 합니다.
출력 변수 $container에에서 배치 하는이 예제에서 알 수 있습니다.
이 연습에서는 나중에 도움이 됩니다.

``` PowerShell
$container = New-Container -Name "MyContainer" -ContainerImageName WindowsServerCore -SwitchName "Virtual Switch"
```

호스트에서 한 컨테이너 목록을 참조 하 고 컨테이너 만들어졌는지 확인 하려면 사용 된 `Get 컨테이너` 명령 합니다.
시작 되지 않지만 컨테이너 MyContainer의 이름으로 만들어졌는지 확인 합니다.

``` PowerShell
Get-Container

Name        State Uptime   ParentImageName
----        ----- ------   ---------------
MyContainer Off   00:00:00 WindowsServerCore
```

사용 하 여 컨테이너를 시작 하려면 `시작 컨테이너` proivding 컨테이너의 이름입니다.

``` PowerShell
Start-Container -Name "MyContainer"
```

컨테이너와 같은 PowerShell 원격 명령을 사용 하 여 작업할 수 있습니다 `Invoke-command`, 또는 `Enter-pssession`.
아래 예제에서는 원격 PowerShell 세션을 사용 하 여 컨테이너에 만듭니다는 `Enter-pssession` 명령 합니다.
이 명령은 원격 세션을 만들 컨테이너 id이 필요 합니다.
컨테이너 id에 저장 된는 `$container` 컨테이너를 만들 때 변수입니다.

원격 세션을 만든 후 명령 프롬프트를 컨테이너 id의 처음 11 문자를 포함 하도록 변경 됩니다 `[2446380e 629]`.

``` PowerShell
Enter-PSSession -ContainerId $container.ContainerId -RunAsAdministrator

[2446380e-629]: PS C:\Windows\system32>
```

컨테이너는 물리적 컴퓨터 또는 가상 컴퓨터와 같은 가장 중요 하 게 관리할 수 있습니다.
와 같은 명령 `ipconfig` 컨테이너의 IP 주소를 반환 `mkdir` 컨테이너와 같은 PowerShell 명령에는 디렉터리를 만들지 `Get-childitem` 모든 작업입니다.
계속 해 서 하 고 파일 또는 폴더 만들기와 같은 컨테이너를 변경 합니다.
예를들어, 다음 명령은 컨테이너에 대 한 네트워크 구성 데이터를 포함 하는 파일을 만들어집니다.

``` PowerShell
ipconfig > c:\ipconfig.txt
```

명령이 성공적으로 완료 되도록 파일의 내용을 읽을 수 있습니다.
텍스트 파일에 포함 된 IP 주소는 컨테이너와 일치 하는지 확인 합니다.

``` PowerShell
type c:\ipconfig.txt

Ethernet adapter vEthernet (Virtual Switch-E0D87408-325B-4818-ADB2-2EC7A2005739-0):

   Connection-specific DNS Suffix  . : corp.microsoft.com
   Link-local IPv6 Address . . . . . : fe80::400e:1e0e:591c:beef%18
   IPv4 Address. . . . . . . . . . . : 172.16.0.2
   Subnet Mask . . . . . . . . . . . : 255.240.0.0
   Default Gateway . . . . . . . . . : 172.16.0.1
```

컨테이너가 수정 했으므로 원격 PowerShell 세션을 종료 합니다.

``` PowerShell
exit
```

컨테이너에 컨테이너 이름을 제공 하 여 중지는 `중지 컨테이너` 명령 합니다.
이 명령을 완료 되 면 컨테이너 호스트의 컨트롤에서 다시 됩니다.

``` PowerShell
Stop-Container -Name "MyContainer"
```

###2 단계-새 컨테이너 이미지 만들기

이미지는 이제이 컨테이너에서 수행할 수 있습니다.
이 이미지는 컨테이너의 스냅숏을 처럼 동작 수 있으며 다시 배포 된 여러 번 합니다.

명명 된 'newimage' 사용 새 이미지를 만들려면는 `새로 ContainerImage` 명령 합니다.
이 명령을 사용 하는 경우에 컨테이너를 캡처, 새 이미지 및 추가 메타 데이터 보듯이 아래에 대 한 이름을 지정 합니다.

``` PowerShell
$newimage = New-ContainerImage -ContainerName MyContainer -Publisher Demo -Name newimage -Version 1.0
```

사용 하 여 `Get ContainerImage` 컨테이너 이미지의 목록을 반환 합니다.
'Newimage' 라는 이름의 새 이미지가 만들어졌는지 확인 합니다.

``` PowerShell
Get-ContainerImage

Name              Publisher    Version      IsOSImage
----              ---------    -------      ---------
newimage          CN=Demo      1.0.0.0      False
WindowsServerCore CN=Microsoft 10.0.10254.0 True
```

###3 단계-이미지에서 새 컨테이너 만들기

사용자 지정 된 컨테이너 이미지를 만든 했으므로 계속 진행 하 고이 이미지에서 새 컨테이너를 배포 합니다.

'$Newcontainer' 라는 변수에 결과 출력, 'newimage' 라는 컨테이너 이미지에서 ' newcontainer' 라는 컨테이너를 만듭니다.

``` PowerShell
$newcontainer = New-Container -Name "newcontainer" -ContainerImageName newimage -SwitchName "Virtual Switch"
```

새 컨테이너를 시작 합니다.
``` PowerShell
Start-Container $newcontainer
```

컨테이너와 원격 PowerShell 세션을 만듭니다.
``` PowerShell
Enter-PSSession -ContainerId $newcontainer.ContainerId -RunAsAdministrator
```

마지막으로이 연습 앞부분에서 만든 ipconfig.txt 파일이 새 컨테이너에 포함 되어있는지 확인 합니다.

``` PowerShell
type c:\ipconfig.txt

Ethernet adapter vEthernet (Virtual Switch-E0D87408-325B-4818-ADB2-2EC7A2005739-0):

   Connection-specific DNS Suffix  . : corp.microsoft.com
   Link-local IPv6 Address . . . . . : fe80::400e:1e0e:591c:beef%18
   IPv4 Address. . . . . . . . . . . : 172.16.0.2
   Subnet Mask . . . . . . . . . . . : 255.240.0.0
   Default Gateway . . . . . . . . . : 172.16.0.1
```

작업이 완료 되 면 원격 PowerShell 세션을 종료이 컨테이너를 사용 합니다.

``` PowerShell
exit
```

이 연습에 수정 된 컨테이너에서 가져온 이미지 모든 수정 내용이 포함 되도록 표시 됩니다.
다음 예제에서는 간단한 파일 수정 하는 동안 웹 서버와 같은 컨테이너에 소프트웨어를 설치 하는 경우 적용 됩니다 동일 합니다.
이러한 메서드를 사용 하 여 사용자 지정 이미지를 만들 수 있는 준비 컨테이너 응용 프로그램을 배포 합니다.

###4 단계-제거 컨테이너 및 컨테이너 이미지

중지 하려면 아래 명령을 실행 하는 모든 실행 중인 컨테이너입니다.
모든 컨테이너 중지 된 상태에 있으면이 명령을 실행할 때 정상입니다. 경고를 수신 합니다.

``` PowerShell
Get-Container | Stop-Container
```
모든 컨테이너를 제거 하려면 다음을 실행 합니다.

``` PowerShell
Get-Container | Remove-Container -Force
```
'Newimage' 라는 컨테이너 이미지를 제거 하려면 다음을 실행 합니다.

``` PowerShell
Get-ContainerImage -Name newimage | Remove-ContainerImage -Force
```

##컨테이너에는 웹 서버 호스트

다음 예제에서는 Windows Server 컨테이너에 대 한 보다 효과적인 사용 사례를 설명 합니다.
이 연습에서는 포함 된 단계는 Windows 서버 컨테이너 내부에서 호스팅되는 웹 응용 프로그램 배포에 대해 사용할 수 있는 웹 서버 컨테이너 이미지를 생성 하는 과정을 안내 있습니다.

###1 단계-Windows Server Core 운영 체제 이미지에서 컨테이너 만들기

웹 서버 컨테이너 이미지를 만들려면 먼저 배포 하 고 Windows Server Core 운영 체제 이미지에서 컨테이너를 시작 해야 합니다.
``` PowerShell
$container = New-Container -Name webbase -ContainerImageName WindowsServerCore -SwitchName "Virtual Switch"
```

컨테이너를 시작 합니다.
``` PowerShell
Start-Container $container
```

컨테이너가 위쪽에 있는 경우 컨테이너와 원격 PowerShell 세션을 만듭니다.
``` PowerShell
Enter-PSSession -ContainerId $container.ContainerId -RunAsAdministrator
```

###단계 2-웹 서버 소프트웨어 설치

다음 단계는 웹 서버 소프트웨어를 설치 하는 것입니다.
이 예에서는 Windows 용 nginx를 사용 합니다.
자동으로 다운로드 하 여 nginx 소프트웨어 c:\nginx-1.9.3 추출 하려면 다음 명령을 사용 합니다.
**참고** 이 단계는 인터넷에 연결 되어 컨테이너 호스트를 필요 합니다.
이 단계에서 생성 되는 경우 연결 또는 이름 확인 오류 컨테이너 호스트의 네트워크 구성을 확인 합니다.

Nginx 소프트웨어를 다운로드 합니다.
``` PowerShell
wget -uri 'http://nginx.org/download/nginx-1.9.3.zip' -OutFile "c:\nginx-1.9.3.zip"
```

Nginx 소프트웨어를 추출 합니다.
``` PowerShell
Expand-Archive -Path C:\nginx-1.9.3.zip -DestinationPath c:\ -Force
```
이 것뿐입니다 nginx 소프트웨어 설치에 대 한 완료 해야 합니다.

원격 PowerShell 세션을 종료 합니다.
``` PowerShell
exit
```

다음 명령을 사용 하 여 컨테이너를 중지 합니다.
``` PowerShell
Stop-Container $container
```
###3 단계-웹 서버 컨테이너에서 이미지 만들기

Nginx 웹 서버 소프트웨어를 포함 하도록 수정 하는 컨테이너와이 컨테이너에서 이제 이미지를 만들 수 있습니다.
이렇게 하려면 다음 명령을 입력 합니다.
``` PowerShell
$webserverimage = New-ContainerImage -Container $container -Publisher Demo -Name nginxwindows -Version 1.0
```
완료 되 면 사용 하는 `Get ContainerImage` 이미지가 만들어졌는지 확인 하려면 명령 합니다.

``` PowerShell
Get-ContainerImage

Name              Publisher    Version      IsOSImage
----              ---------    -------      ---------
nginxwindows      CN=Demo      1.0.0.0      False
WindowsServerCore CN=Microsoft 10.0.10254.0 True
```

###4 단계-웹 서버 준비 컨테이너를 배포 합니다.

'Nginxwindows' 이미지를 기반으로 Windows 서버 컨테이너를 배포 하려면 사용 된 `새 컨테이너` PowerShell 명령 합니다.

``` PowerShell
$webservercontainer = New-Container -Name webserver1 -ContainerImageName nginxwindows -SwitchName "Virtual Switch"
```

컨테이너를 시작 합니다.
``` PowerShell
Start-Container $webservercontainer
```

새 컨테이너와 원격 PowerShell 세션을 만듭니다.
``` PowerShell
Enter-PSSession -ContainerId $webservercontainer.ContainerId -RunAsAdministrator
```

Nginx 웹 서버를 시작할 수는 컨테이너 내에서 작업, 일단 및 웹 콘텐츠를 준비 합니다.
Nginx 웹 서버를 시작 하려면 nginx 설치 디렉터리로 변경 합니다.
``` PowerShell
cd c:\nginx-1.9.3\
```

Nginx 웹 서버를 시작 합니다.
``` PowerShell
start nginx
```

고이 PS 세션을 종료 합니다.
웹 서버는 계속 실행 됩니다.
``` PowerShell
exit
```

###5 단계-컨테이너 네트워킹 구성

컨테이너 호스트와 네트워크의 구성에 따라 컨테이너 하거나 받습니다 IP 주소는 DHCP 서버 또는 컨테이너 호스트에서 네트워크 주소 변환 (NAT)를 사용 하 여 자체입니다.
과정을 따라 하면서가 안내가 제공 되는 NAT를 사용 하도록 구성 된
이 구성에서 컨테이너 내에서 포트를 포트 컨테이너 호스트에 매핑됩니다.
컨테이너에서 호스팅되는 응용 프로그램은 다음 IP 주소를 통해 액세스 / 컨테이너 호스트의 이름입니다.
예를들어 응용 프로그램에는 일반적인 http 요청 포트 80에서 컨테이너를 포트 55534 컨테이너 호스트에 매핑된 경우이 http://contianerhost:55534 같습니다.
따라서 많은 컨테이너를 실행 하 고 동일한 포트를 사용 하 여 요청에 응답 하도록 이러한 컨테이너에 응용 프로그램을 허용 하는 컨테이너 호스트를 수 있습니다.

이 실습이 포트 매핑을 만들 해야 합니다.
에서는 이렇게 하기 위해 컨테이너 내부 (응용 프로그램) 및 구성 될 외부 (호스트 컨테이너) 포트의 IP 주소를 알고 있어야 합니다.
이 예제에 대 한 단순하게 유지 하 고 포트 80 컨테이너에서 호스트의 포트 80 매핑할 보겠습니다.
사용 하는 `추가 NetNatStaticMapping` 명령에는 `– InternalIPAddress` 있어야 하 고이 연습에 대 한 '172.16.0.2' 컨테이너의 IP 주소가 됩니다.

``` PowerShell
Add-NetNatStaticMapping -NatName "ContainerNat" -Protocol TCP -ExternalIPAddress 0.0.0.0 -InternalIPAddress 172.16.0.2 -InternalPort 80 -ExternalPort 80
```
포트 매핑 만들어지면에 구성된 된 포트에 대 한 인바운드 방화벽 규칙을 구성 해야 합니다.
포트 80에서 다음 명령을 실행 이렇게 합니다.
이 스크립트는 VM에 복사할 수 있습니다.

``` PowerShell
if (!(Get-NetFirewallRule | where {$_.Name -eq "TCP80"})) {
    New-NetFirewallRule -Name "TCP80" -DisplayName "HTTP on TCP/80" -Protocol tcp -LocalPort 80 -Action Allow -Enabled True
}
```

그런 다음 Azure에서 작업 하 고 가상 컴퓨터 끝점을 아직 만들지 않은 경우 지금 만듭니다 해야 합니다.
Azure VM 끝점에 대 한 자세한 내용은이 문서를 참조 하십시오: [Azure VM 끝점을 설정](https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-set-up-endpoints/).

###6 단계 – 컨테이너 호스팅된 웹사이트에 액세스

웹 서버에 만든 컨테이너와 이제 체크아웃 컨테이너에서 호스팅되는 응용 프로그램에 지정할 수 있습니다.
이렇게 하려면 다른 컴퓨터에서 브라우저를 열고 입력 `http://containerhost-ipaddress`.
컨테이너 호스트와 컨테이너 자체의 IP 주소를 검색 합니다 있습니다 여기를 확인 합니다.
작업 하는 경우 Azure 가상 컴퓨터에서이 됩니다 공용 IP 주소 또는 클라우드 서비스 이름입니다.

모든 항목이 올바르게 구성 되었는지, nginx 시작 페이지를 표시 됩니다.

![](media/nginx.png)

이 시점에 자유롭게 웹사이트를 업데이트 합니다.
자신의 샘플 웹사이트에서 복사 하거나 작성 된 간단한 ' Hello World' 샘플 사이트를 사용 하 여이 데모에 대 한.
예제를 사용 하려면 먼저 컨테이너와 원격 PS 세션을 다시 설정 해야 합니다.

먼저 컨테이너와 원격 PS 세션을 다시 만들 해야 합니다.
``` PowerShell
Enter-PSSession -ContainerId $webservercontainer.ContainerId -RunAsAdministrator
```
다운로드 하 고 index.html 파일을 대체 하려면 다음 명령을 실행 합니다.

``` powershell
wget -uri 'https://raw.githubusercontent.com/Microsoft/Virtualization-Documentation/master/doc-site/virtualization/windowscontainers/quick_start/SampleFiles/index.html' -OutFile "C:\nginx-1.9.3\html\index.html"
```

웹사이트를 업데이트 한 후에 다시 이동 `http://containerhost-ipaddress`.

![](media/hello.png)

##연습 동영상을 보려면

<iframe src="https://channel9.msdn.com/Blogs/containers/Quick-Start-Deploying-and-Managing-Windows-Server-Containers-with-PowerShell/player" width="800" height="450" allowFullScreen="true" frameBorder="0" scrolling="no"></iframe>


##다음 단계

컨테이너를 설정 및 도구에 대 한 소개가 했으므로 색인화 앱 빌드를 이동 합니다.

다음 보다 완전은 [PowerShell 참조](../reference/powershell_overview.md).

이 **미리 보기** 버그 있으며 진행 중인 작업의 많은 합니다.
[이 페이지](../about/work_in_progress.md) 우리의 알려진 문제의 대부분을 포함 합니다.

모니터링 하는 우리는 또한는 [포럼](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers) 매우 밀접 하 게 합니다.

에 미리 만들어 놓은 샘플도 있습니다 [GitHub](https://github.com/Microsoft/Virtualization-Documentation/tree/master/windows-server-container-samples).

-----------------------------------

[컨테이너 홈으로 돌아가기](../containers_welcome.md)   
[현재 릴리스의 알려진된 문제](../about/work_in_progress.md)




