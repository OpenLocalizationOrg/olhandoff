{
  "nodes": [
    {
      "content": "Add push notifications to your Xamarin.Forms app with Azure App Service",
      "pos": [
        28,
        99
      ]
    },
    {
      "content": "Learn how to use Azure App Service to send push notifications to your Xamarin.Forms app",
      "pos": [
        119,
        206
      ]
    },
    {
      "content": "Add push notifications to your Xamarin.Forms app",
      "pos": [
        549,
        597
      ]
    },
    {
      "content": "&amp;nbsp;",
      "pos": [
        726,
        732
      ]
    },
    {
      "content": "Overview",
      "pos": [
        855,
        863
      ]
    },
    {
      "content": "This tutorial is based on the <bpt id=\"p1\">[</bpt>Xamarin.Forms quickstart tutorial<ept id=\"p1\">](app-service-mobile-xamarin-forms-get-started.md)</ept>, which you must complete first.",
      "pos": [
        865,
        1011
      ]
    },
    {
      "content": "You will add push notifications support for each project that your want to support in the the Xamarin.Forms quick start project.",
      "pos": [
        1012,
        1140
      ]
    },
    {
      "content": "Every time a record is inserted, a push notification will be sent.",
      "pos": [
        1141,
        1207
      ]
    },
    {
      "content": "If you do not use the downloaded quick start server project, you must add the push notification extension package to your project.",
      "pos": [
        1210,
        1340
      ]
    },
    {
      "content": "For more information about server extension packages, see <bpt id=\"p1\">[</bpt>Work with the .NET backend server SDK for Azure Mobile Apps<ept id=\"p1\">](app-service-mobile-dotnet-backend-how-to-use-server-sdk.md)</ept>.",
      "pos": [
        1341,
        1521
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>iOS simulator does not support push notifications<ept id=\"p1\">](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/iOS_Simulator_Guide/TestingontheiOSSimulator.html)</ept>, so you must use a physical iOS device.",
      "pos": [
        1524,
        1740
      ]
    },
    {
      "content": "You'll also need to sign up for an <bpt id=\"p1\">[</bpt>Apple Developer Program membership<ept id=\"p1\">](https://developer.apple.com/programs/ios/)</ept>.",
      "pos": [
        1741,
        1856
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        1860,
        1873
      ]
    },
    {
      "content": "To complete this tutorial, you need the following:",
      "pos": [
        1875,
        1925
      ]
    },
    {
      "content": "An active Azure account.",
      "pos": [
        1929,
        1953
      ]
    },
    {
      "content": "If you don't have an account yet, sign up for an Azure trial and get up to 10 free mobile apps.",
      "pos": [
        1956,
        2051
      ]
    },
    {
      "content": "You can keep using them even after your trial ends.",
      "pos": [
        2052,
        2103
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Azure Free Trial<ept id=\"p1\">](http://azure.microsoft.com/pricing/free-trial/)</ept>.",
      "pos": [
        2104,
        2175
      ]
    },
    {
      "content": "A Mac with <bpt id=\"p1\">[</bpt><ept id=\"p1\">Xamarin Studio]</ept> and <bpt id=\"p2\">[</bpt><ept id=\"p2\">Xcode]</ept> v4.4 or later installed it.",
      "pos": [
        2179,
        2246
      ]
    },
    {
      "content": "You can run the Xamarin.Forms app using Visual Studio on a Windows computer if you want, but it's a bit more complicated because you have to connect to a networked Mac running the Xamarin.iOS Build Host.",
      "pos": [
        2247,
        2450
      ]
    },
    {
      "content": "If you're interested in doing that, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Installing Xamarin.iOS on Windows]</ept>.",
      "pos": [
        2451,
        2527
      ]
    },
    {
      "content": "A physical iOS device.",
      "pos": [
        2531,
        2553
      ]
    },
    {
      "content": "Push notifications are not supported by the iOS simulator.",
      "pos": [
        2554,
        2612
      ]
    },
    {
      "pos": [
        2616,
        2714
      ],
      "content": "Complete the <bpt id=\"p1\">[</bpt>Xamarin.Forms quickstart tutorial<ept id=\"p1\">](app-service-mobile-xamarin-forms-get-started.md)</ept>."
    },
    {
      "content": "Create a Notification Hub for your Mobile App",
      "pos": [
        2718,
        2763
      ]
    },
    {
      "content": "To configure your app to send notifications, create a new notification hub and configure it for the platform notification services that you will use.",
      "pos": [
        2765,
        2914
      ]
    },
    {
      "content": "These steps walk you through creating a new notification hub.",
      "pos": [
        2917,
        2978
      ]
    },
    {
      "content": "If you already have one created, you can just select it.",
      "pos": [
        2979,
        3035
      ]
    },
    {
      "content": "Log into the <bpt id=\"p1\">[</bpt>Azure portal<ept id=\"p1\">](https://portal.azure.com/)</ept>.",
      "pos": [
        3040,
        3095
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Mobile Apps<ept id=\"p2\">**</ept> &gt; your backend &gt; <bpt id=\"p3\">**</bpt>Settings<ept id=\"p3\">**</ept> &gt; <bpt id=\"p4\">**</bpt>Mobile<ept id=\"p4\">**</ept> &gt; <bpt id=\"p5\">**</bpt>Push<ept id=\"p5\">**</ept> &gt; <bpt id=\"p6\">**</bpt>Notification Hub<ept id=\"p6\">**</ept> &gt; <bpt id=\"p7\">**</bpt>+ Notification Hub<ept id=\"p7\">**</ept>, and provide a name and namespace for a new notification hub, and then click the <bpt id=\"p8\">**</bpt>OK<ept id=\"p8\">**</ept> button.",
      "pos": [
        3096,
        3328
      ]
    },
    {
      "pos": [
        3441,
        3496
      ],
      "content": "In the Create Notification Hub blade, click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Update the server project to send push notifications",
      "pos": [
        3501,
        3553
      ]
    },
    {
      "content": "Deploy the updated server project to Azure",
      "pos": [
        3713,
        3755
      ]
    },
    {
      "content": "(Optional) Configure and run the Android project",
      "pos": [
        3898,
        3946
      ]
    },
    {
      "content": "This section is for running the Xamarin droid project for Android.",
      "pos": [
        3948,
        4014
      ]
    },
    {
      "content": "You can skip this section if you are not working with Android devices.",
      "pos": [
        4015,
        4085
      ]
    },
    {
      "content": "Enable Google Cloud Messaging (GCM)",
      "pos": [
        4092,
        4127
      ]
    },
    {
      "content": "Configure the notification hub for GCM",
      "pos": [
        4265,
        4303
      ]
    },
    {
      "content": "Log into the <bpt id=\"p1\">[</bpt>Azure portal<ept id=\"p1\">](https://portal.azure.com/)</ept>.",
      "pos": [
        4308,
        4363
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Mobile Apps<ept id=\"p2\">**</ept> &gt; your Mobile App &gt; <bpt id=\"p3\">**</bpt>Settings<ept id=\"p3\">**</ept> &gt; <bpt id=\"p4\">**</bpt>Push<ept id=\"p4\">**</ept> &gt; <bpt id=\"p5\">**</bpt>Google (GCM)<ept id=\"p5\">**</ept>.",
      "pos": [
        4364,
        4462
      ]
    },
    {
      "content": "Paste in the server api key you created earlier and click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>.",
      "pos": [
        4463,
        4530
      ]
    },
    {
      "content": "Your service is now configured to work with push notifications for Android.",
      "pos": [
        4531,
        4606
      ]
    },
    {
      "content": "Add push notifications to the droid project",
      "pos": [
        4713,
        4756
      ]
    },
    {
      "content": "Right-click the Components folder, click Get More Components..., search for the <bpt id=\"p1\">**</bpt>Google Cloud Messaging Client<ept id=\"p1\">**</ept> component and add it to the project.",
      "pos": [
        4761,
        4911
      ]
    },
    {
      "content": "This component helps simplify working with push notifications with a Xamarrin Android project.",
      "pos": [
        4912,
        5006
      ]
    },
    {
      "content": "Open the MainActivity.cs project file and add the following using statement at the top of the file:",
      "pos": [
        5011,
        5110
      ]
    },
    {
      "pos": [
        5142,
        5226
      ],
      "content": "Add the following code to the <ph id=\"ph1\">`OnCreate`</ph> method after the call to <ph id=\"ph2\">`LoadApplication`</ph>."
    },
    {
      "pos": [
        5878,
        5945
      ],
      "content": "Add the following code for the <ph id=\"ph1\">`CreateAndShowDialog`</ph> helper method."
    },
    {
      "pos": [
        6236,
        6373
      ],
      "content": "In the <ph id=\"ph1\">`MainActivity`</ph> class, add the following code to expose the current <ph id=\"ph2\">`MainActivity`</ph> so we can execute some UI on the main UI thread:"
    },
    {
      "pos": [
        6696,
        6787
      ],
      "content": "Initialize the <ph id=\"ph1\">`instance`</ph>, variable at the beginning of the <ph id=\"ph2\">`MainActivity.OnCreate`</ph> method."
    },
    {
      "content": "Add a new class file to the <bpt id=\"p1\">**</bpt>Droid<ept id=\"p1\">**</ept> project.",
      "pos": [
        6873,
        6919
      ]
    },
    {
      "content": "Name the new class file <bpt id=\"p1\">**</bpt>GcmService<ept id=\"p1\">**</ept>.",
      "pos": [
        6921,
        6960
      ]
    },
    {
      "pos": [
        6965,
        7044
      ],
      "content": "Make sure the following <ph id=\"ph1\">`using`</ph> statements are included at the top of the file."
    },
    {
      "pos": [
        7381,
        7510
      ],
      "content": "Add the following permission requests at the top of the file, after the <ph id=\"ph1\">`using`</ph> statments and before the <ph id=\"ph2\">`namespace`</ph> declaration."
    },
    {
      "content": "Add the following class definition to the namespace.",
      "pos": [
        8075,
        8127
      ]
    },
    {
      "content": "Replace <bpt id=\"p1\">**</bpt>&lt;PROJECT_NUMBER&gt;<ept id=\"p1\">**</ept> with your project number you noted earlier.",
      "pos": [
        8128,
        8200
      ]
    },
    {
      "pos": [
        8929,
        8994
      ],
      "content": "Update your <ph id=\"ph1\">`GcmService`</ph> class to use the new broadcast receiver."
    },
    {
      "pos": [
        9273,
        9401
      ],
      "content": "Add the following code to the GcmService class that overrides the OnRegistered event handler and implements a <ph id=\"ph1\">`Register`</ph> method."
    },
    {
      "content": "This code will register a template body to receive template notifications using the <ph id=\"ph1\">`messageParam`</ph> parameter.",
      "pos": [
        9407,
        9516
      ]
    },
    {
      "content": "Template notifications allow you to send notifications cross platform.",
      "pos": [
        9517,
        9587
      ]
    },
    {
      "content": "For more information see, <bpt id=\"p1\">[</bpt>Templates<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn530748.aspx)</ept>.",
      "pos": [
        9588,
        9682
      ]
    },
    {
      "content": "You must implement <ph id=\"ph1\">`OnMessage`</ph> to handle an incoming push notification.",
      "pos": [
        11036,
        11107
      ]
    },
    {
      "content": "In this code we will handle the notification and send it to the notification manager.",
      "pos": [
        11108,
        11193
      ]
    },
    {
      "pos": [
        13529,
        13610
      ],
      "content": "You must also implement <ph id=\"ph1\">`OnUnRegistered`</ph> and <ph id=\"ph2\">`OnError`</ph> handlers for the receiver."
    },
    {
      "content": "Test push notifications in your Android app",
      "pos": [
        14007,
        14050
      ]
    },
    {
      "pos": [
        14055,
        14162
      ],
      "content": "In Visual Studio or Xamarin Studio, right click the <bpt id=\"p1\">**</bpt>droid<ept id=\"p1\">**</ept> project and click <bpt id=\"p2\">**</bpt>Set as startup project<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        14168,
        14305
      ],
      "content": "Press the <bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept> button to build the project and start the app in an iOS capable device, then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept> to accept push notifications."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You must explicitly accept push notifications from your app.",
      "pos": [
        14317,
        14390
      ]
    },
    {
      "content": "This request only occurs the first time that the app runs.",
      "pos": [
        14391,
        14449
      ]
    },
    {
      "pos": [
        14454,
        14516
      ],
      "content": "In the app, type a task, and then click the plus (<bpt id=\"p1\">**</bpt>+<ept id=\"p1\">**</ept>) icon."
    },
    {
      "pos": [
        14521,
        14607
      ],
      "content": "Verify that a notification is received, then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to dismiss the notification."
    },
    {
      "content": "(Optional) Configure and run the iOS project",
      "pos": [
        14615,
        14659
      ]
    },
    {
      "content": "This section is for running the Xamarin iOS project for iOS devices.",
      "pos": [
        14661,
        14729
      ]
    },
    {
      "content": "You can skip this section if you are not working with iOS devices.",
      "pos": [
        14730,
        14796
      ]
    },
    {
      "content": "Configure the notification hub for APNS",
      "pos": [
        14957,
        14996
      ]
    },
    {
      "content": "Log into the <bpt id=\"p1\">[</bpt>Azure portal<ept id=\"p1\">](https://portal.azure.com/)</ept>.",
      "pos": [
        15001,
        15056
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Mobile Apps<ept id=\"p2\">**</ept> &gt; your Mobile App &gt; <bpt id=\"p3\">**</bpt>Settings<ept id=\"p3\">**</ept> &gt; <bpt id=\"p4\">**</bpt>Push<ept id=\"p4\">**</ept> &gt; <bpt id=\"p5\">**</bpt>Apple (APNS)<ept id=\"p5\">**</ept> &gt; <bpt id=\"p6\">**</bpt>Upload Certificate<ept id=\"p6\">**</ept>.",
      "pos": [
        15057,
        15180
      ]
    },
    {
      "content": "Upload the .p12 push certificate file you exported earlier.",
      "pos": [
        15181,
        15240
      ]
    },
    {
      "content": "Make sure to select <bpt id=\"p1\">**</bpt>Sandbox<ept id=\"p1\">**</ept> if you created a development push certificate for development and testing.",
      "pos": [
        15242,
        15348
      ]
    },
    {
      "content": "Otherwise, choose <bpt id=\"p1\">**</bpt>Production<ept id=\"p1\">**</ept>.",
      "pos": [
        15350,
        15383
      ]
    },
    {
      "content": "Your service is now configured to work with push notifications for iOS.",
      "pos": [
        15384,
        15455
      ]
    },
    {
      "content": "Add push notifications to your iOS app",
      "pos": [
        15786,
        15824
      ]
    },
    {
      "pos": [
        15829,
        15907
      ],
      "content": "Add the following <ph id=\"ph1\">`using`</ph> statement to the top of the <bpt id=\"p1\">**</bpt>AppDelegate.cs<ept id=\"p1\">**</ept> file."
    },
    {
      "pos": [
        16003,
        16116
      ],
      "content": "In the iOS project, open AppDelegate.cs and update<ph id=\"ph1\">`FinishedLaunching`</ph> to support remote notifications as follows."
    },
    {
      "pos": [
        17139,
        17260
      ],
      "content": "In AppDelegate.cs, also add an override for the <bpt id=\"p1\">**</bpt>RegisteredForRemoteNotifications<ept id=\"p1\">**</ept> event to register for notifications:"
    },
    {
      "pos": [
        17859,
        18004
      ],
      "content": "In AppDelegate.cs also add an override for the <bpt id=\"p1\">**</bpt>DidReceivedRemoteNotification<ept id=\"p1\">**</ept> event to handle incoming notifications while the app is running:"
    },
    {
      "content": "Your app is now updated to support push notifications.",
      "pos": [
        18680,
        18734
      ]
    },
    {
      "content": "Test push notifications in your iOS app",
      "pos": [
        18740,
        18779
      ]
    },
    {
      "pos": [
        18784,
        18850
      ],
      "content": "Right click the iOS project, and click <bpt id=\"p1\">**</bpt>Set as StartPp Project<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18855,
        19019
      ],
      "content": "Press the <bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept> button or <bpt id=\"p2\">**</bpt>F5<ept id=\"p2\">**</ept> in Visual Studio to build the project and start the app in an iOS capable device, then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept> to accept push notifications."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You must explicitly accept push notifications from your app.",
      "pos": [
        19031,
        19104
      ]
    },
    {
      "content": "This request only occurs the first time that the app runs.",
      "pos": [
        19105,
        19163
      ]
    },
    {
      "pos": [
        19168,
        19230
      ],
      "content": "In the app, type a task, and then click the plus (<bpt id=\"p1\">**</bpt>+<ept id=\"p1\">**</ept>) icon."
    },
    {
      "pos": [
        19235,
        19321
      ],
      "content": "Verify that a notification is received, then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to dismiss the notification."
    },
    {
      "content": "(Optional) Configure and run the Windows project",
      "pos": [
        19328,
        19376
      ]
    },
    {
      "content": "This section is for running the Xamarin WinApp project for Windows devices.",
      "pos": [
        19378,
        19453
      ]
    },
    {
      "content": "You can skip this section if you are not working with Windows devices.",
      "pos": [
        19454,
        19524
      ]
    },
    {
      "content": "Register your Windows app for push notifications with WNS",
      "pos": [
        19531,
        19588
      ]
    },
    {
      "content": "Configure the notification hub for WNS",
      "pos": [
        19697,
        19735
      ]
    },
    {
      "content": "Add push notifications to your Windows app",
      "pos": [
        19846,
        19888
      ]
    },
    {
      "content": "In Visual Studio, open <bpt id=\"p1\">**</bpt>App.xaml.cs<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>WinApp<ept id=\"p2\">**</ept> project.",
      "pos": [
        19893,
        19958
      ]
    },
    {
      "content": "Add the following <ph id=\"ph1\">`using`</ph> statements.",
      "pos": [
        19960,
        19997
      ]
    },
    {
      "content": "In App.xaml.cs add the following <ph id=\"ph1\">`InitNotificationsAsync`</ph> method.",
      "pos": [
        20218,
        20283
      ]
    },
    {
      "content": "This method gets the push notification channel and registers a template to receive template notifications from notification hub.",
      "pos": [
        20284,
        20412
      ]
    },
    {
      "content": "A template notification that supports <ph id=\"ph1\">`messageParam`</ph> will be delivered to this client.",
      "pos": [
        20413,
        20499
      ]
    },
    {
      "pos": [
        21331,
        21444
      ],
      "content": "In App.xaml.cs update the <ph id=\"ph1\">`OnLaunched`</ph> event handler with the <ph id=\"ph2\">`async`</ph> attribute and call <ph id=\"ph3\">`InitNotificationsAsync`</ph>"
    },
    {
      "pos": [
        22992,
        23132
      ],
      "content": "In Solution Explorer for Visual Studio, open the <bpt id=\"p1\">**</bpt>Package.appxmanifest<ept id=\"p1\">**</ept> file and set <bpt id=\"p2\">**</bpt>Toast Capable<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Yes<ept id=\"p3\">**</ept> under <bpt id=\"p4\">**</bpt>Notifications<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Build the app and verify you have no errors.",
      "pos": [
        23137,
        23181
      ]
    },
    {
      "content": "You client app should now register for the template notifications from the Mobile App backend.",
      "pos": [
        23183,
        23277
      ]
    },
    {
      "content": "Test push notifications in your Windows app",
      "pos": [
        23284,
        23327
      ]
    },
    {
      "pos": [
        23332,
        23422
      ],
      "content": "In Visual Studio, right click the <bpt id=\"p1\">**</bpt>WinApp<ept id=\"p1\">**</ept> project and click <bpt id=\"p2\">**</bpt>Set as startup project<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        23428,
        23565
      ],
      "content": "Press the <bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept> button to build the project and start the app in an iOS capable device, then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept> to accept push notifications."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You must explicitly accept push notifications from your app.",
      "pos": [
        23577,
        23650
      ]
    },
    {
      "content": "This request only occurs the first time that the app runs.",
      "pos": [
        23651,
        23709
      ]
    },
    {
      "pos": [
        23714,
        23776
      ],
      "content": "In the app, type a task, and then click the plus (<bpt id=\"p1\">**</bpt>+<ept id=\"p1\">**</ept>) icon."
    },
    {
      "pos": [
        23781,
        23867
      ],
      "content": "Verify that a notification is received, then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to dismiss the notification."
    }
  ],
  "content": "<properties \n    pageTitle=\"Add push notifications to your Xamarin.Forms app with Azure App Service\" \n    description=\"Learn how to use Azure App Service to send push notifications to your Xamarin.Forms app\" \n    services=\"app-service\\mobile\" \n    documentationCenter=\"xamarin\" \n    authors=\"wesmc7777\"\n    manager=\"dwrede\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"app-service-mobile\" \n    ms.workload=\"mobile\" \n    ms.tgt_pltfrm=\"mobile-xamarin\" \n    ms.devlang=\"dotnet\" \n    ms.topic=\"article\"\n    ms.date=\"11/25/2015\" \n    ms.author=\"wesmc\"/>\n\n# Add push notifications to your Xamarin.Forms app\n\n[AZURE.INCLUDE [app-service-mobile-selector-get-started-push](../../includes/app-service-mobile-selector-get-started-push.md)]\n&nbsp;  \n[AZURE.INCLUDE [app-service-mobile-note-mobile-services](../../includes/app-service-mobile-note-mobile-services.md)]\n\n##Overview\n\nThis tutorial is based on the [Xamarin.Forms quickstart tutorial](app-service-mobile-xamarin-forms-get-started.md), which you must complete first. You will add push notifications support for each project that your want to support in the the Xamarin.Forms quick start project. Every time a record is inserted, a push notification will be sent. \n\nIf you do not use the downloaded quick start server project, you must add the push notification extension package to your project. For more information about server extension packages, see [Work with the .NET backend server SDK for Azure Mobile Apps](app-service-mobile-dotnet-backend-how-to-use-server-sdk.md). \n\nThe [iOS simulator does not support push notifications](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/iOS_Simulator_Guide/TestingontheiOSSimulator.html), so you must use a physical iOS device. You'll also need to sign up for an [Apple Developer Program membership](https://developer.apple.com/programs/ios/).\n\n##Prerequisites\n\nTo complete this tutorial, you need the following:\n\n* An active Azure account.  \nIf you don't have an account yet, sign up for an Azure trial and get up to 10 free mobile apps. You can keep using them even after your trial ends. See [Azure Free Trial](http://azure.microsoft.com/pricing/free-trial/).\n\n* A Mac with [Xamarin Studio] and [Xcode] v4.4 or later installed it. You can run the Xamarin.Forms app using Visual Studio on a Windows computer if you want, but it's a bit more complicated because you have to connect to a networked Mac running the Xamarin.iOS Build Host. If you're interested in doing that, see [Installing Xamarin.iOS on Windows].\n\n* A physical iOS device. Push notifications are not supported by the iOS simulator.\n\n* Complete the [Xamarin.Forms quickstart tutorial](app-service-mobile-xamarin-forms-get-started.md).\n\n##Create a Notification Hub for your Mobile App\n\nTo configure your app to send notifications, create a new notification hub and configure it for the platform notification services that you will use. \n\nThese steps walk you through creating a new notification hub. If you already have one created, you can just select it.\n\n1. Log into the [Azure portal](https://portal.azure.com/). Click **Browse** > **Mobile Apps** > your backend > **Settings** > **Mobile** > **Push** > **Notification Hub** > **+ Notification Hub**, and provide a name and namespace for a new notification hub, and then click the **OK** button.\n\n    ![](./media/app-service-mobile-xamarin-ios-get-started-push/mobile-app-configure-notification-hub.png)\n\n2. In the Create Notification Hub blade, click **Create**.\n\n\n##Update the server project to send push notifications\n\n[AZURE.INCLUDE [app-service-mobile-update-server-project-for-push-template](../../includes/app-service-mobile-update-server-project-for-push-template.md)]\n\n##Deploy the updated server project to Azure\n\n[AZURE.INCLUDE [app-service-mobile-dotnet-backend-publish-service](../../includes/app-service-mobile-dotnet-backend-publish-service.md)]\n\n\n##(Optional) Configure and run the Android project\n\nThis section is for running the Xamarin droid project for Android. You can skip this section if you are not working with Android devices.\n\n\n####Enable Google Cloud Messaging (GCM)\n\n\n[AZURE.INCLUDE [mobile-services-enable-google-cloud-messaging](../../includes/mobile-services-enable-google-cloud-messaging.md)]\n\n\n####Configure the notification hub for GCM\n\n1. Log into the [Azure portal](https://portal.azure.com/). Click **Browse** > **Mobile Apps** > your Mobile App > **Settings** > **Push** > **Google (GCM)**. Paste in the server api key you created earlier and click **Save**. Your service is now configured to work with push notifications for Android.\n\n    ![](./media/app-service-mobile-xamarin-forms-get-started-push/mobile-app-save-gcm-api-key.png)\n\n\n####Add push notifications to the droid project\n\n1. Right-click the Components folder, click Get More Components..., search for the **Google Cloud Messaging Client** component and add it to the project. This component helps simplify working with push notifications with a Xamarrin Android project.\n\n2. Open the MainActivity.cs project file and add the following using statement at the top of the file:\n\n        using Gcm.Client;\n\n3. Add the following code to the `OnCreate` method after the call to `LoadApplication`.\n\n        try\n        {\n            // Check to ensure everything's setup right\n            GcmClient.CheckDevice(this);\n            GcmClient.CheckManifest(this);\n    \n            // Register for push notifications\n            System.Diagnostics.Debug.WriteLine(\"Registering...\");\n            GcmClient.Register(this, PushHandlerBroadcastReceiver.SENDER_IDS);\n        }\n        catch (Java.Net.MalformedURLException)\n        {\n            CreateAndShowDialog(\"There was an error creating the Mobile Service. Verify the URL\", \"Error\");\n        }\n        catch (Exception e)\n        {\n            CreateAndShowDialog(e.Message, \"Error\");\n        }\n\n\n4. Add the following code for the `CreateAndShowDialog` helper method.\n\n        private void CreateAndShowDialog(String message, String title) \n        {\n            AlertDialog.Builder builder = new AlertDialog.Builder(this);\n\n            builder.SetMessage (message);\n            builder.SetTitle (title);\n            builder.Create().Show ();\n        }\n\n\n5. In the `MainActivity` class, add the following code to expose the current `MainActivity` so we can execute some UI on the main UI thread:\n        \n        // Create a new instance field for this activity.\n        static MainActivity instance = null;\n        \n        // Return the current activity instance.\n        public static MainActivity CurrentActivity\n        {\n            get\n            {\n                return instance;\n            }\n        }\n\n6. Initialize the `instance`, variable at the beginning of the `MainActivity.OnCreate` method.  \n\n        // Set the current instance of MainActivity.\n        instance = this;\n\n7. Add a new class file to the **Droid** project.  Name the new class file **GcmService**.\n\n8. Make sure the following `using` statements are included at the top of the file.\n\n        using Gcm.Client;\n        using Microsoft.WindowsAzure.MobileServices;\n        using Android.App;\n        using Android.Content;\n        using System.Collections.Generic;\n        using System.Diagnostics;\n        using Android.Util;\n        using Newtonsoft.Json.Linq;\n        using System.Text;\n        using System.Linq;\n\n9. Add the following permission requests at the top of the file, after the `using` statments and before the `namespace` declaration.\n\n        [assembly: Permission(Name = \"@PACKAGE_NAME@.permission.C2D_MESSAGE\")]\n        [assembly: UsesPermission(Name = \"@PACKAGE_NAME@.permission.C2D_MESSAGE\")]\n        [assembly: UsesPermission(Name = \"com.google.android.c2dm.permission.RECEIVE\")]\n        \n        //GET_ACCOUNTS is only needed for android versions 4.0.3 and below\n        [assembly: UsesPermission(Name = \"android.permission.GET_ACCOUNTS\")]\n        [assembly: UsesPermission(Name = \"android.permission.INTERNET\")]\n        [assembly: UsesPermission(Name = \"android.permission.WAKE_LOCK\")]\n\n10. Add the following class definition to the namespace. Replace **<PROJECT_NUMBER>** with your project number you noted earlier.\n\n        [BroadcastReceiver(Permission = Gcm.Client.Constants.PERMISSION_GCM_INTENTS)]\n        [IntentFilter(new string[] { Gcm.Client.Constants.INTENT_FROM_GCM_MESSAGE }, Categories = new string[] { \"@PACKAGE_NAME@\" })]\n        [IntentFilter(new string[] { Gcm.Client.Constants.INTENT_FROM_GCM_REGISTRATION_CALLBACK }, Categories = new string[] { \"@PACKAGE_NAME@\" })]\n        [IntentFilter(new string[] { Gcm.Client.Constants.INTENT_FROM_GCM_LIBRARY_RETRY }, Categories = new string[] { \"@PACKAGE_NAME@\" })]     \n        public class PushHandlerBroadcastReceiver : GcmBroadcastReceiverBase<GcmService>\n        {       \n            public static string[] SENDER_IDS = new string[] { \"<PROJECT_NUMBER>\" };        \n        }\n\n11. Update your `GcmService` class to use the new broadcast receiver.\n\n         [Service]\n         public class GcmService : GcmServiceBase\n         {\n             public static string RegistrationID { get; private set; }\n        \n             public GcmService()\n                 : base(PushHandlerBroadcastReceiver.SENDER_IDS){}\n         }\n\n\n12. Add the following code to the GcmService class that overrides the OnRegistered event handler and implements a `Register` method.\n\n    This code will register a template body to receive template notifications using the `messageParam` parameter. Template notifications allow you to send notifications cross platform. For more information see, [Templates](https://msdn.microsoft.com/library/azure/dn530748.aspx).\n        \n        protected override void OnRegistered(Context context, string registrationId)\n        {\n            Log.Verbose(\"PushHandlerBroadcastReceiver\", \"GCM Registered: \" + registrationId);\n            RegistrationID = registrationId;\n        \n            createNotification(\"GcmService Registered...\", \"The device has been Registered, Tap to View!\");\n        \n            var push = TodoItemManager.DefaultManager.CurrentClient.GetPush();\n        \n            MainActivity.CurrentActivity.RunOnUiThread(() => Register(push, null));\n        \n        }\n\n        public async void Register(Microsoft.WindowsAzure.MobileServices.Push push, IEnumerable<string> tags)\n        {\n            try\n            {\n                const string templateBodyGCM = \"{\\\"data\\\":{\\\"message\\\":\\\"$(messageParam)\\\"}}\";\n\n                JObject templates = new JObject();\n                templates[\"genericMessage\"] = new JObject\n                {\n                  {\"body\", templateBodyGCM}\n                };\n                \n                await push.RegisterAsync(RegistrationID, templates);\n                Log.Info(\"Push Installation Id\", push.InstallationId.ToString());\n            }\n            catch (Exception ex)\n            {\n                System.Diagnostics.Debug.WriteLine(ex.Message);\n                Debugger.Break();\n            }\n        }\n\n13. You must implement `OnMessage` to handle an incoming push notification. In this code we will handle the notification and send it to the notification manager.\n\n        protected override void OnMessage(Context context, Intent intent)\n        {\n            Log.Info(\"PushHandlerBroadcastReceiver\", \"GCM Message Received!\");\n        \n            var msg = new StringBuilder();\n        \n            if (intent != null && intent.Extras != null)\n            {\n                foreach (var key in intent.Extras.KeySet())\n                    msg.AppendLine(key + \"=\" + intent.Extras.Get(key).ToString());\n            }\n        \n            //Store the message\n            var prefs = GetSharedPreferences(context.PackageName, FileCreationMode.Private);\n            var edit = prefs.Edit();\n            edit.PutString(\"last_msg\", msg.ToString());\n            edit.Commit();\n        \n            string message = intent.Extras.GetString(\"message\");\n            if (!string.IsNullOrEmpty(message))\n            {\n                createNotification(\"New todo item!\", \"Todo item: \" + message);\n                return;\n            }\n        \n            string msg2 = intent.Extras.GetString(\"msg\");\n            if (!string.IsNullOrEmpty(msg2))\n            {\n                createNotification(\"New hub message!\", msg2);\n                return;\n            }\n        \n            createNotification(\"Unknown message details\", msg.ToString());\n        }\n        \n        void createNotification(string title, string desc)\n        {\n            //Create notification\n            var notificationManager = GetSystemService(Context.NotificationService) as NotificationManager;\n        \n            //Create an intent to show ui\n            var uiIntent = new Intent(this, typeof(MainActivity));\n        \n            //Create the notification\n            var notification = new Notification(Android.Resource.Drawable.SymActionEmail, title);\n        \n            //Auto cancel will remove the notification once the user touches it\n            notification.Flags = NotificationFlags.AutoCancel;\n        \n            //Set the notification info\n            //we use the pending intent, passing our ui intent over which will get called\n            //when the notification is tapped.\n            notification.SetLatestEventInfo(this, title, desc, PendingIntent.GetActivity(this, 0, uiIntent, 0));\n        \n            //Show the notification\n            notificationManager.Notify(1, notification);\n        }\n    \n14. You must also implement `OnUnRegistered` and `OnError` handlers for the receiver.\n\n        protected override void OnUnRegistered(Context context, string registrationId)\n        {\n            Log.Error(\"PushHandlerBroadcastReceiver\", \"Unregistered RegisterationId : \" + registrationId);\n        }\n\n        protected override void OnError(Context context, string errorId)\n        {\n            Log.Error(\"PushHandlerBroadcastReceiver\", \"GCM Error: \" + errorId);\n        }\n\n\n\n####Test push notifications in your Android app\n\n1. In Visual Studio or Xamarin Studio, right click the **droid** project and click **Set as startup project**.\n \n2. Press the **Run** button to build the project and start the app in an iOS capable device, then click **OK** to accept push notifications.\n    \n    > [AZURE.NOTE] You must explicitly accept push notifications from your app. This request only occurs the first time that the app runs.\n\n2. In the app, type a task, and then click the plus (**+**) icon.\n\n3. Verify that a notification is received, then click **OK** to dismiss the notification.\n\n\n\n\n\n##(Optional) Configure and run the iOS project\n\nThis section is for running the Xamarin iOS project for iOS devices. You can skip this section if you are not working with iOS devices.\n\n[AZURE.INCLUDE [Notification Hubs Xamarin Enable Apple Push Notifications](../../includes/notification-hubs-xamarin-enable-apple-push-notifications.md)]\n\n\n####Configure the notification hub for APNS\n\n1. Log into the [Azure portal](https://portal.azure.com/). Click **Browse** > **Mobile Apps** > your Mobile App > **Settings** > **Push** > **Apple (APNS)** > **Upload Certificate**. Upload the .p12 push certificate file you exported earlier.  Make sure to select **Sandbox** if you created a development push certificate for development and testing.  Otherwise, choose **Production**. Your service is now configured to work with push notifications for iOS.\n\n    ![](./media/app-service-mobile-xamarin-ios-get-started-push/mobile-app-upload-apns-cert.png)\n\n\n    Next you will configure the iOS project setting in Xamarin Studio or Visual Studio.\n\n[AZURE.INCLUDE [app-service-mobile-xamarin-ios-configure-project](../../includes/app-service-mobile-xamarin-ios-configure-project.md)]\n\n\n####Add push notifications to your iOS app\n\n1. Add the following `using` statement to the top of the **AppDelegate.cs** file.\n\n        using Microsoft.WindowsAzure.MobileServices;\n        using Newtonsoft.Json.Linq;\n\n\n2. In the iOS project, open AppDelegate.cs and update`FinishedLaunching` to support remote notifications as follows.\n\n        public override bool FinishedLaunching (UIApplication app, NSDictionary options)\n        {\n            global::Xamarin.Forms.Forms.Init ();\n\n            Microsoft.WindowsAzure.MobileServices.CurrentPlatform.Init();\n\n            // IMPORTANT: uncomment this code to enable sync on Xamarin.iOS\n            // For more information, see: http://go.microsoft.com/fwlink/?LinkId=620342\n            //SQLitePCL.CurrentPlatform.Init();\n            \n            // registers for push for iOS8\n            var settings = UIUserNotificationSettings.GetSettingsForTypes(\n                UIUserNotificationType.Alert\n                | UIUserNotificationType.Badge\n                | UIUserNotificationType.Sound,\n                new NSSet());\n\n            UIApplication.SharedApplication.RegisterUserNotificationSettings(settings);\n            UIApplication.SharedApplication.RegisterForRemoteNotifications();\n\n            LoadApplication (new App ());\n\n            return base.FinishedLaunching (app, options);\n        }\n\n\n4. In AppDelegate.cs, also add an override for the **RegisteredForRemoteNotifications** event to register for notifications:\n\n        public override void RegisteredForRemoteNotifications(UIApplication application, NSData deviceToken)\n        {\n            const string templateBodyAPNS = \"{\\\"aps\\\":{\\\"alert\\\":\\\"$(messageParam)\\\"}}\";\n\n            JObject templates = new JObject();\n            templates[\"genericMessage\"] = new JObject\n                {\n                  {\"body\", templateBodyAPNS}\n                };\n\n            // Register for push with your mobile app\n            Push push = TodoItemManager.DefaultManager.CurrentClient.GetPush();\n            push.RegisterAsync(deviceToken, templates);\n        }\n\n5. In AppDelegate.cs also add an override for the **DidReceivedRemoteNotification** event to handle incoming notifications while the app is running:\n\n        public override void DidReceiveRemoteNotification(UIApplication application, NSDictionary userInfo, Action<UIBackgroundFetchResult> completionHandler)\n        {\n            NSDictionary aps = userInfo.ObjectForKey(new NSString(\"aps\")) as NSDictionary;\n\n            string alert = string.Empty;\n            if (aps.ContainsKey(new NSString(\"alert\")))\n                alert = (aps[new NSString(\"alert\")] as NSString).ToString();\n\n            //show alert\n            if (!string.IsNullOrEmpty(alert))\n            {\n                UIAlertView avAlert = new UIAlertView(\"Notification\", alert, null, \"OK\", null);\n                avAlert.Show();\n            }\n        }\n\nYour app is now updated to support push notifications.\n\n####Test push notifications in your iOS app\n\n1. Right click the iOS project, and click **Set as StartPp Project**.\n\n2. Press the **Run** button or **F5** in Visual Studio to build the project and start the app in an iOS capable device, then click **OK** to accept push notifications.\n    \n    > [AZURE.NOTE] You must explicitly accept push notifications from your app. This request only occurs the first time that the app runs.\n\n3. In the app, type a task, and then click the plus (**+**) icon.\n\n4. Verify that a notification is received, then click **OK** to dismiss the notification.\n\n\n\n\n##(Optional) Configure and run the Windows project\n\nThis section is for running the Xamarin WinApp project for Windows devices. You can skip this section if you are not working with Windows devices.\n\n\n####Register your Windows app for push notifications with WNS\n\n[AZURE.INCLUDE [app-service-mobile-register-wns](../../includes/app-service-mobile-register-wns.md)]\n\n\n####Configure the notification hub for WNS\n\n[AZURE.INCLUDE [app-service-mobile-configure-wns](../../includes/app-service-mobile-configure-wns.md)]\n\n\n####Add push notifications to your Windows app\n\n1. In Visual Studio, open **App.xaml.cs** in the **WinApp** project.  Add the following `using` statements.\n\n        using System.Threading.Tasks;\n        using Windows.Networking.PushNotifications;\n        using WesmcMobileAppGaTest;\n        using Microsoft.WindowsAzure.MobileServices;\n        using Newtonsoft.Json.Linq;\n\n2. In App.xaml.cs add the following `InitNotificationsAsync` method. This method gets the push notification channel and registers a template to receive template notifications from notification hub. A template notification that supports `messageParam` will be delivered to this client.\n\n        private async Task InitNotificationsAsync()\n        {\n            var channel = await PushNotificationChannelManager\n                .CreatePushNotificationChannelForApplicationAsync();\n\n            const string templateBodyWNS = \"<toast><visual><binding template=\\\"ToastText01\\\"><text id=\\\"1\\\">$(messageParam)</text></binding></visual></toast>\";\n\n            JObject headers = new JObject();\n            headers[\"X-WNS-Type\"] = \"wns/toast\";\n\n            JObject templates = new JObject();\n            templates[\"genericMessage\"] = new JObject\n                {\n                  {\"body\", templateBodyWNS},\n                  {\"headers\", headers} // Only needed for WNS & MPNS\n                };\n\n            await TodoItemManager.DefaultManager.CurrentClient.GetPush().RegisterAsync(channel.Uri, templates);\n        }\n\n3. In App.xaml.cs update the `OnLaunched` event handler with the `async` attribute and call `InitNotificationsAsync`\n\n        protected async override void OnLaunched(LaunchActivatedEventArgs e)\n        {\n            Frame rootFrame = Window.Current.Content as Frame;\n\n            // Do not repeat app initialization when the Window already has content,\n            // just ensure that the window is active\n            if (rootFrame == null)\n            {\n                // Create a Frame to act as the navigation context and navigate to the first page\n                rootFrame = new Frame();\n                // Set the default language\n                rootFrame.Language = Windows.Globalization.ApplicationLanguages.Languages[0];\n                rootFrame.NavigationFailed += OnNavigationFailed;\n                Xamarin.Forms.Forms.Init(e); \n                if (e.PreviousExecutionState == ApplicationExecutionState.Terminated)\n                {\n                    //TODO: Load state from previously suspended application\n                }\n                // Place the frame in the current Window\n                Window.Current.Content = rootFrame;\n            }\n\n            if (rootFrame.Content == null)\n            {\n                // When the navigation stack isn't restored navigate to the first page,\n                // configuring the new page by passing required information as a navigation\n                // parameter\n                rootFrame.Navigate(typeof(MainPage), e.Arguments);\n            }\n            // Ensure the current window is active\n            Window.Current.Activate();\n\n            await InitNotificationsAsync();\n        }\n\n4. In Solution Explorer for Visual Studio, open the **Package.appxmanifest** file and set **Toast Capable** to **Yes** under **Notifications**.\n\n5. Build the app and verify you have no errors.  You client app should now register for the template notifications from the Mobile App backend.\n\n\n####Test push notifications in your Windows app\n\n1. In Visual Studio, right click the **WinApp** project and click **Set as startup project**.\n\n\n2. Press the **Run** button to build the project and start the app in an iOS capable device, then click **OK** to accept push notifications.\n    \n    > [AZURE.NOTE] You must explicitly accept push notifications from your app. This request only occurs the first time that the app runs.\n\n3. In the app, type a task, and then click the plus (**+**) icon.\n\n4. Verify that a notification is received, then click **OK** to dismiss the notification.\n\n\n\n<!-- Images. -->\n\n<!-- URLs. -->\n[Xamarin Studio]: http://xamarin.com/platform\n[Install Xcode]: https://go.microsoft.com/fwLink/p/?LinkID=266532\n[Xcode]: https://go.microsoft.com/fwLink/?LinkID=266532\n[Installing Xamarin.iOS on Windows]: http://developer.xamarin.com/guides/ios/getting_started/installation/windows/\n[apns object]: http://go.microsoft.com/fwlink/p/?LinkId=272333\n\n\n\n"
}