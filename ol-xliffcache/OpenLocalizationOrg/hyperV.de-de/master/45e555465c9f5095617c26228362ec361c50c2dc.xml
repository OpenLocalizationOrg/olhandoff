{
  "nodes": [
    {
      "content": "App Model v2.0 OAuth Protocol | Microsoft Azure",
      "pos": [
        28,
        75
      ]
    },
    {
      "content": "Building web applications using Azure AD's implementation of the OAuth 2.0 authentication protocol.",
      "pos": [
        94,
        193
      ]
    },
    {
      "content": "App model v2.0 preview: Protocols - OAuth 2.0 Authorization Code Flow",
      "pos": [
        508,
        577
      ]
    },
    {
      "content": "The OAuth 2.0 authorization code grant can be used in apps that are installed on a device to gain access to protected resources, such as web APIs.",
      "pos": [
        579,
        725
      ]
    },
    {
      "content": "Using the app model v2.0's implementation of OAuth 2.0, you can add sign in and API access to your mobile and desktop apps.",
      "pos": [
        727,
        850
      ]
    },
    {
      "content": "This guide is language-independent, and describes how to send and receive HTTP messages without using any of our open-source libraries.",
      "pos": [
        852,
        987
      ]
    },
    {
      "content": "This information applies to the v2.0 app model public preview.",
      "pos": [
        1050,
        1112
      ]
    },
    {
      "content": "For instructions on how to integrate with the generally available Azure AD service, please refer to the <bpt id=\"p1\">[</bpt>Azure Active Directory Developer Guide<ept id=\"p1\">](active-directory-developers-guide.md)</ept>.",
      "pos": [
        1114,
        1297
      ]
    },
    {
      "content": "The OAuth 2.0 authorization code flow is described in in <bpt id=\"p1\">[</bpt>section 4.1 of the OAuth 2.0 specification<ept id=\"p1\">](http://tools.ietf.org/html/rfc6749)</ept>.",
      "pos": [
        1299,
        1437
      ]
    },
    {
      "content": "It is used to perform authentication and authorization in the majority of app types, including <bpt id=\"p1\">[</bpt>web apps<ept id=\"p1\">](active-directory-v2-flows.md#web-apps)</ept> and <bpt id=\"p2\">[</bpt>natively installed  apps<ept id=\"p2\">](active-directory-v2-flows.md#mobile-and-native-apps)</ept>.",
      "pos": [
        1439,
        1668
      ]
    },
    {
      "content": "It enables apps to securely acquire access_tokens which can be used to access resources that are secured using the v2.0 app model.",
      "pos": [
        1670,
        1800
      ]
    },
    {
      "content": "Request an Authorization Code",
      "pos": [
        1809,
        1838
      ]
    },
    {
      "content": "The authorization code flow begins with the client directing the user to the <ph id=\"ph1\">`/authorize`</ph> endpoint.",
      "pos": [
        1839,
        1938
      ]
    },
    {
      "content": "In this request, the client indicates the permissions it needs to acquire from the user:",
      "pos": [
        1940,
        2028
      ]
    },
    {
      "content": "Parameter",
      "pos": [
        2738,
        2747
      ]
    },
    {
      "content": "Description",
      "pos": [
        2752,
        2763
      ]
    },
    {
      "content": "client_id",
      "pos": [
        2856,
        2865
      ]
    },
    {
      "content": "required",
      "pos": [
        2868,
        2876
      ]
    },
    {
      "pos": [
        2879,
        3004
      ],
      "content": "The Application Id that the registration portal (<bpt id=\"p1\">[</bpt>apps.dev.microsoft.com<ept id=\"p1\">](https://apps.dev.microsoft.com)</ept>) assigned your app."
    },
    {
      "content": "response_type",
      "pos": [
        3009,
        3022
      ]
    },
    {
      "content": "required",
      "pos": [
        3025,
        3033
      ]
    },
    {
      "pos": [
        3036,
        3088
      ],
      "content": "Must include <ph id=\"ph1\">`code`</ph> for the authorization code flow."
    },
    {
      "content": "redirect_uri",
      "pos": [
        3093,
        3105
      ]
    },
    {
      "content": "required",
      "pos": [
        3108,
        3116
      ]
    },
    {
      "content": "The redirect_uri of your app, where authentication responses can be sent and receieved by your app.",
      "pos": [
        3119,
        3218
      ]
    },
    {
      "content": "It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.",
      "pos": [
        3220,
        3327
      ]
    },
    {
      "content": "scope",
      "pos": [
        3332,
        3337
      ]
    },
    {
      "content": "required",
      "pos": [
        3340,
        3348
      ]
    },
    {
      "content": "A space-separated list of scopes.",
      "pos": [
        3351,
        3384
      ]
    },
    {
      "content": "A single scope value indicates to the v2.0 endpoint both the resource and the permissions to that resource being requested.",
      "pos": [
        3386,
        3509
      ]
    },
    {
      "content": "Scopes take the form <ph id=\"ph1\">`&lt;app identifier URI&gt;/&lt;scope value&gt;`</ph>.",
      "pos": [
        3511,
        3569
      ]
    },
    {
      "content": "In the example above, the app identifier for the Azure AD Graph API is used, <ph id=\"ph1\">`https://graph.windows.net`</ph>, and two permissions are requested: <ph id=\"ph2\">`directory.read`</ph> and <ph id=\"ph3\">`directory.write`</ph>.",
      "pos": [
        3571,
        3751
      ]
    },
    {
      "content": "For a more detailed explanation of scopes, refer to the <bpt id=\"p1\">[</bpt>app model v2.0 scope reference<ept id=\"p1\">](active-directory-v2-scopes.md)</ept>.",
      "pos": [
        3753,
        3873
      ]
    },
    {
      "content": "response_mode",
      "pos": [
        3879,
        3892
      ]
    },
    {
      "content": "recommended",
      "pos": [
        3895,
        3906
      ]
    },
    {
      "content": "Specifies the method that should be used to send the resulting authorization_code back to your app.",
      "pos": [
        3909,
        4008
      ]
    },
    {
      "content": "Can be one of 'query', 'form_post', or 'fragment'.",
      "pos": [
        4010,
        4060
      ]
    },
    {
      "content": "state",
      "pos": [
        4063,
        4068
      ]
    },
    {
      "content": "recommended",
      "pos": [
        4071,
        4082
      ]
    },
    {
      "content": "A value included in the request that will also be returned in the token response.",
      "pos": [
        4085,
        4166
      ]
    },
    {
      "content": "It can be a string of any content that you wish.",
      "pos": [
        4168,
        4216
      ]
    },
    {
      "content": "A randomly generated unique value is typically used for preventing cross-site request forgery attacks.",
      "pos": [
        4218,
        4320
      ]
    },
    {
      "content": "The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.",
      "pos": [
        4322,
        4483
      ]
    },
    {
      "content": "prompt",
      "pos": [
        4488,
        4494
      ]
    },
    {
      "content": "optional",
      "pos": [
        4497,
        4505
      ]
    },
    {
      "content": "Indicates the type of user interaction that is required.",
      "pos": [
        4508,
        4564
      ]
    },
    {
      "content": "The only valid values at this time are 'login', 'none', and 'consent'.",
      "pos": [
        4566,
        4636
      ]
    },
    {
      "content": "<ph id=\"ph1\">`prompt=login`</ph> will force the user to enter their credentials on that request, negating single-sign on.",
      "pos": [
        4638,
        4741
      ]
    },
    {
      "content": "<ph id=\"ph1\">`prompt=none`</ph> is the opposite - it will ensure that the user is not presented with any interactive prompt whatsoever.",
      "pos": [
        4743,
        4860
      ]
    },
    {
      "content": "If the request cannot be completed silently via single-sign on, the v2.0 endpoint will return an error.",
      "pos": [
        4862,
        4965
      ]
    },
    {
      "content": "<ph id=\"ph1\">`prompt=consent`</ph> will trigger the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.",
      "pos": [
        4967,
        5095
      ]
    },
    {
      "content": "login_hint",
      "pos": [
        5100,
        5110
      ]
    },
    {
      "content": "optional",
      "pos": [
        5113,
        5121
      ]
    },
    {
      "content": "Can be used to pre-fill the username/email address field of the sign in page for the user.",
      "pos": [
        5124,
        5214
      ]
    },
    {
      "content": "At this point, the user will be asked to enter their credentials and complete the authentication.",
      "pos": [
        5218,
        5315
      ]
    },
    {
      "content": "The v2.0 endpoint will also ensure that the user has consented to the permissions indicated in the <ph id=\"ph1\">`scope`</ph> query parameter.",
      "pos": [
        5317,
        5440
      ]
    },
    {
      "content": "If the user has not consented to any of those permissions, it will ask the user to consent to the required permissions.",
      "pos": [
        5442,
        5561
      ]
    },
    {
      "content": "Details of <bpt id=\"p1\">[</bpt>permissions, consent, and multi-tenant apps are provided here<ept id=\"p1\">](active-directory-v2-scopes.md)</ept>.",
      "pos": [
        5563,
        5669
      ]
    },
    {
      "pos": [
        5671,
        5865
      ],
      "content": "Once the user authenticates and grants consent, the v2.0 endpoint will return a response to your app at the indicated <ph id=\"ph1\">`redirect_uri`</ph>, using the method specified in the <ph id=\"ph2\">`response_mode`</ph> parameter."
    },
    {
      "pos": [
        5867,
        5928
      ],
      "content": "A successful response using <ph id=\"ph1\">`response_mode=query`</ph> looks like:"
    },
    {
      "content": "Parameter",
      "pos": [
        6281,
        6290
      ]
    },
    {
      "content": "Description",
      "pos": [
        6293,
        6304
      ]
    },
    {
      "content": "code",
      "pos": [
        6371,
        6375
      ]
    },
    {
      "content": "The authorization_code that the  app requested.",
      "pos": [
        6378,
        6425
      ]
    },
    {
      "content": "The  app can use the authorization code to request an access token for the target resource.",
      "pos": [
        6426,
        6517
      ]
    },
    {
      "content": "Authorization_codes are very short lived, typically they expire after about 10 minutes.",
      "pos": [
        6519,
        6606
      ]
    },
    {
      "content": "session_state",
      "pos": [
        6611,
        6624
      ]
    },
    {
      "content": "A unique value that identifies the current user session.",
      "pos": [
        6627,
        6683
      ]
    },
    {
      "content": "This value is a GUID, but should be treated as an opaque value that is passed without examination.",
      "pos": [
        6684,
        6782
      ]
    },
    {
      "content": "state",
      "pos": [
        6787,
        6792
      ]
    },
    {
      "content": "If a state parameter is included in the request, the same value should appear in the response.",
      "pos": [
        6795,
        6889
      ]
    },
    {
      "content": "The  app should verify that the state values in the request and response are identical.",
      "pos": [
        6890,
        6977
      ]
    },
    {
      "pos": [
        6981,
        7077
      ],
      "content": "Error responses may also be sent to the <ph id=\"ph1\">`redirect_uri`</ph> so the app can handle them appropriately:"
    },
    {
      "content": "Parameter",
      "pos": [
        7197,
        7206
      ]
    },
    {
      "content": "Description",
      "pos": [
        7209,
        7220
      ]
    },
    {
      "content": "error",
      "pos": [
        7287,
        7292
      ]
    },
    {
      "content": "An error code string that can be used to classify types of errors that occur, and can be used to react to errors.",
      "pos": [
        7295,
        7408
      ]
    },
    {
      "content": "error_description",
      "pos": [
        7413,
        7430
      ]
    },
    {
      "content": "A specific error message that can help a developer identify the root cause of an authentication error.",
      "pos": [
        7433,
        7535
      ]
    },
    {
      "content": "Request an Access Token",
      "pos": [
        7543,
        7566
      ]
    },
    {
      "pos": [
        7567,
        7786
      ],
      "content": "Now that you've acquired an authorization_code and have been granted permission by the user, you can redeem the <ph id=\"ph1\">`code`</ph> for an <ph id=\"ph2\">`access_token`</ph> to the desired resource, by sending a <ph id=\"ph3\">`POST`</ph> request to the <ph id=\"ph4\">`/token`</ph> endpoint:"
    },
    {
      "content": "Parameter",
      "pos": [
        8265,
        8274
      ]
    },
    {
      "content": "Description",
      "pos": [
        8279,
        8290
      ]
    },
    {
      "content": "client_id",
      "pos": [
        8381,
        8390
      ]
    },
    {
      "content": "required",
      "pos": [
        8393,
        8401
      ]
    },
    {
      "pos": [
        8404,
        8529
      ],
      "content": "The Application Id that the registration portal (<bpt id=\"p1\">[</bpt>apps.dev.microsoft.com<ept id=\"p1\">](https://apps.dev.microsoft.com)</ept>) assigned your app."
    },
    {
      "content": "grant_type",
      "pos": [
        8534,
        8544
      ]
    },
    {
      "content": "required",
      "pos": [
        8547,
        8555
      ]
    },
    {
      "pos": [
        8558,
        8619
      ],
      "content": "Must be <ph id=\"ph1\">`authorization_code`</ph> for the authorization code flow."
    },
    {
      "content": "scope",
      "pos": [
        8624,
        8629
      ]
    },
    {
      "content": "required",
      "pos": [
        8632,
        8640
      ]
    },
    {
      "content": "A space-separated list of scopes.",
      "pos": [
        8643,
        8676
      ]
    },
    {
      "content": "The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the first leg.",
      "pos": [
        8678,
        8786
      ]
    },
    {
      "content": "If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.",
      "pos": [
        8788,
        8949
      ]
    },
    {
      "content": "For a more detailed explanation of scopes, refer to <bpt id=\"p1\">[</bpt>permissions, consent, and scopes<ept id=\"p1\">](active-directory-v2-scopes.md)</ept>.",
      "pos": [
        8951,
        9069
      ]
    },
    {
      "content": "code",
      "pos": [
        9075,
        9079
      ]
    },
    {
      "content": "required",
      "pos": [
        9082,
        9090
      ]
    },
    {
      "content": "The authorization_code that you acquired in the first leg of the flow.",
      "pos": [
        9093,
        9163
      ]
    },
    {
      "content": "client_secret",
      "pos": [
        9170,
        9183
      ]
    },
    {
      "content": "required for web apps",
      "pos": [
        9186,
        9207
      ]
    },
    {
      "content": "The application secret that you created in the app registration portal for your app.",
      "pos": [
        9210,
        9294
      ]
    },
    {
      "content": "It should not be used in a native  app, because client_secrets cannot be reliably stored on devices.",
      "pos": [
        9296,
        9396
      ]
    },
    {
      "content": "It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.",
      "pos": [
        9398,
        9518
      ]
    },
    {
      "content": "A successful token response will look like:",
      "pos": [
        9522,
        9565
      ]
    },
    {
      "content": "Parameter",
      "pos": [
        10028,
        10037
      ]
    },
    {
      "content": "Description",
      "pos": [
        10040,
        10051
      ]
    },
    {
      "content": "access_token",
      "pos": [
        10118,
        10130
      ]
    },
    {
      "content": "The requested access token.",
      "pos": [
        10133,
        10160
      ]
    },
    {
      "content": "The  app can use this token to authenticate to the secured resource, such as a web API.",
      "pos": [
        10161,
        10248
      ]
    },
    {
      "content": "token_type",
      "pos": [
        10253,
        10263
      ]
    },
    {
      "content": "Indicates the token type value.",
      "pos": [
        10266,
        10297
      ]
    },
    {
      "content": "The only type that Azure AD supports is Bearer",
      "pos": [
        10298,
        10344
      ]
    },
    {
      "content": "expires_in",
      "pos": [
        10350,
        10360
      ]
    },
    {
      "content": "How long the access token is valid (in seconds).",
      "pos": [
        10363,
        10411
      ]
    },
    {
      "content": "scope",
      "pos": [
        10416,
        10421
      ]
    },
    {
      "content": "The scopes that the access_token is valid for.",
      "pos": [
        10424,
        10470
      ]
    },
    {
      "content": "refresh_token",
      "pos": [
        10475,
        10488
      ]
    },
    {
      "content": "An OAuth 2.0 refresh token.",
      "pos": [
        10492,
        10519
      ]
    },
    {
      "content": "The  app can use this token acquire additional access tokens after the current access token expires.",
      "pos": [
        10520,
        10620
      ]
    },
    {
      "content": "Refresh_tokens are long-lived, and can be used to retain access to resources for extended periods of time.",
      "pos": [
        10622,
        10728
      ]
    },
    {
      "content": "For more detail, refer to the <bpt id=\"p1\">[</bpt>v2.0 token reference<ept id=\"p1\">](active-directory-v2-tokens.md)</ept>.",
      "pos": [
        10730,
        10814
      ]
    },
    {
      "content": "id_token",
      "pos": [
        10820,
        10828
      ]
    },
    {
      "content": "An unsigned JSON Web Token (JWT).",
      "pos": [
        10831,
        10864
      ]
    },
    {
      "content": "The  app can base64Url decode the segments of this token to request information about the user who signed in.",
      "pos": [
        10865,
        10974
      ]
    },
    {
      "content": "The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.",
      "pos": [
        10975,
        11099
      ]
    },
    {
      "content": "For more information about id_tokens see the <bpt id=\"p1\">[</bpt>v2.0 app model token reference<ept id=\"p1\">](active-directory-v2-tokens.md)</ept>.",
      "pos": [
        11101,
        11210
      ]
    },
    {
      "content": "id_token_expires_in",
      "pos": [
        11215,
        11234
      ]
    },
    {
      "content": "How long the id token is valid (in seconds).",
      "pos": [
        11237,
        11281
      ]
    },
    {
      "content": "Error responses will look like:",
      "pos": [
        11286,
        11317
      ]
    },
    {
      "content": "Parameter",
      "pos": [
        11428,
        11437
      ]
    },
    {
      "content": "Description",
      "pos": [
        11440,
        11451
      ]
    },
    {
      "content": "error",
      "pos": [
        11518,
        11523
      ]
    },
    {
      "content": "An error code string that can be used to classify types of errors that occur, and can be used to react to errors.",
      "pos": [
        11526,
        11639
      ]
    },
    {
      "content": "error_description",
      "pos": [
        11644,
        11661
      ]
    },
    {
      "content": "A specific error message that can help a developer identify the root cause of an authentication error.",
      "pos": [
        11664,
        11766
      ]
    },
    {
      "content": "Use the Access Token",
      "pos": [
        11774,
        11794
      ]
    },
    {
      "pos": [
        11795,
        11944
      ],
      "content": "Now that you've successfully acquired an <ph id=\"ph1\">`access_token`</ph>, you can use the token in requests to Web APIs by including it in the <ph id=\"ph2\">`Authorization`</ph> header:"
    },
    {
      "content": "Refresh the Access Token",
      "pos": [
        12116,
        12140
      ]
    },
    {
      "content": "Access_tokens are short lived, and you must refresh them after they expire to continue accessing resources.",
      "pos": [
        12141,
        12248
      ]
    },
    {
      "content": "You can do so by submitting another <ph id=\"ph1\">`POST`</ph> request to the <ph id=\"ph2\">`/token`</ph> endpoint, this time providing the <ph id=\"ph3\">`refresh_token`</ph> instead of the <ph id=\"ph4\">`code`</ph>:",
      "pos": [
        12250,
        12389
      ]
    },
    {
      "content": "Parameter",
      "pos": [
        12873,
        12882
      ]
    },
    {
      "content": "Description",
      "pos": [
        12887,
        12898
      ]
    },
    {
      "content": "client_id",
      "pos": [
        12976,
        12985
      ]
    },
    {
      "content": "required",
      "pos": [
        12988,
        12996
      ]
    },
    {
      "pos": [
        12999,
        13124
      ],
      "content": "The Application Id that the registration portal (<bpt id=\"p1\">[</bpt>apps.dev.microsoft.com<ept id=\"p1\">](https://apps.dev.microsoft.com)</ept>) assigned your app."
    },
    {
      "content": "grant_type",
      "pos": [
        13129,
        13139
      ]
    },
    {
      "content": "required",
      "pos": [
        13142,
        13150
      ]
    },
    {
      "pos": [
        13153,
        13221
      ],
      "content": "Must be <ph id=\"ph1\">`refresh_token`</ph> for this leg of the authorization code flow."
    },
    {
      "content": "scope",
      "pos": [
        13226,
        13231
      ]
    },
    {
      "content": "required",
      "pos": [
        13234,
        13242
      ]
    },
    {
      "content": "A space-separated list of scopes.",
      "pos": [
        13245,
        13278
      ]
    },
    {
      "content": "The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the original authorization_code request leg.",
      "pos": [
        13280,
        13418
      ]
    },
    {
      "content": "If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.",
      "pos": [
        13420,
        13581
      ]
    },
    {
      "content": "For a more detailed explanation of scopes, refer to <bpt id=\"p1\">[</bpt>permissions, consent, and scopes<ept id=\"p1\">](active-directory-v2-scopes.md)</ept>.",
      "pos": [
        13583,
        13701
      ]
    },
    {
      "content": "refresh_token",
      "pos": [
        13707,
        13720
      ]
    },
    {
      "content": "required",
      "pos": [
        13723,
        13731
      ]
    },
    {
      "content": "The refresh_token that you acquired in the second leg of the flow.",
      "pos": [
        13734,
        13800
      ]
    },
    {
      "content": "client_secret",
      "pos": [
        13807,
        13820
      ]
    },
    {
      "content": "required for web apps",
      "pos": [
        13823,
        13844
      ]
    },
    {
      "content": "The application secret that you created in the app registration portal for your app.",
      "pos": [
        13847,
        13931
      ]
    },
    {
      "content": "It should not be used in a native  app, because client_secrets cannot be reliably stored on devices.",
      "pos": [
        13933,
        14033
      ]
    },
    {
      "content": "It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.",
      "pos": [
        14035,
        14155
      ]
    },
    {
      "content": "A successful token response will look like:",
      "pos": [
        14159,
        14202
      ]
    },
    {
      "content": "Parameter",
      "pos": [
        14665,
        14674
      ]
    },
    {
      "content": "Description",
      "pos": [
        14677,
        14688
      ]
    },
    {
      "content": "access_token",
      "pos": [
        14755,
        14767
      ]
    },
    {
      "content": "The requested access token.",
      "pos": [
        14770,
        14797
      ]
    },
    {
      "content": "The  app can use this token to authenticate to the secured resource, such as a web API.",
      "pos": [
        14798,
        14885
      ]
    },
    {
      "content": "token_type",
      "pos": [
        14890,
        14900
      ]
    },
    {
      "content": "Indicates the token type value.",
      "pos": [
        14903,
        14934
      ]
    },
    {
      "content": "The only type that Azure AD supports is Bearer",
      "pos": [
        14935,
        14981
      ]
    },
    {
      "content": "expires_in",
      "pos": [
        14987,
        14997
      ]
    },
    {
      "content": "How long the access token is valid (in seconds).",
      "pos": [
        15000,
        15048
      ]
    },
    {
      "content": "scope",
      "pos": [
        15053,
        15058
      ]
    },
    {
      "content": "The scopes that the access_token is valid for.",
      "pos": [
        15061,
        15107
      ]
    },
    {
      "content": "refresh_token",
      "pos": [
        15112,
        15125
      ]
    },
    {
      "content": "A new OAuth 2.0 refresh token.",
      "pos": [
        15129,
        15159
      ]
    },
    {
      "content": "You should replace the old refresh token with this newly acquired refresh token to ensure your refresh tokens remain valid for as long as possible.",
      "pos": [
        15160,
        15307
      ]
    },
    {
      "content": "id_token",
      "pos": [
        15313,
        15321
      ]
    },
    {
      "content": "An unsigned JSON Web Token (JWT).",
      "pos": [
        15324,
        15357
      ]
    },
    {
      "content": "The  app can base64Url decode the segments of this token to request information about the user who signed in.",
      "pos": [
        15358,
        15467
      ]
    },
    {
      "content": "The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.",
      "pos": [
        15468,
        15592
      ]
    },
    {
      "content": "For more information about id_tokens see the <bpt id=\"p1\">[</bpt>v2.0 app model token reference<ept id=\"p1\">](active-directory-v2-tokens.md)</ept>.",
      "pos": [
        15594,
        15703
      ]
    },
    {
      "content": "id_token_expires_in",
      "pos": [
        15708,
        15727
      ]
    },
    {
      "content": "How long the id token is valid (in seconds).",
      "pos": [
        15730,
        15774
      ]
    },
    {
      "content": "Error responses will look like:",
      "pos": [
        15778,
        15809
      ]
    },
    {
      "content": "Parameter",
      "pos": [
        15920,
        15929
      ]
    },
    {
      "content": "Description",
      "pos": [
        15932,
        15943
      ]
    },
    {
      "content": "error",
      "pos": [
        16010,
        16015
      ]
    },
    {
      "content": "An error code string that can be used to classify types of errors that occur, and can be used to react to errors.",
      "pos": [
        16018,
        16131
      ]
    },
    {
      "content": "error_description",
      "pos": [
        16136,
        16153
      ]
    },
    {
      "content": "A specific error message that can help a developer identify the root cause of an authentication error.",
      "pos": [
        16156,
        16258
      ]
    },
    {
      "content": "Summary",
      "pos": [
        16266,
        16273
      ]
    },
    {
      "content": "At a high level, the entire authentication flow for a native/mobile application looks a bit like this:",
      "pos": [
        16274,
        16376
      ]
    },
    {
      "content": "OAuth Auth Code Flow",
      "pos": [
        16380,
        16400
      ]
    }
  ],
  "content": "\n<properties\n    pageTitle=\"App Model v2.0 OAuth Protocol | Microsoft Azure\"\n    description=\"Building web applications using Azure AD's implementation of the OAuth 2.0 authentication protocol.\"\n    services=\"active-directory\"\n    documentationCenter=\"\"\n    authors=\"dstrockis\"\n    manager=\"msmbaldwin\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"active-directory\"\n    ms.workload=\"identity\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"12/09/2015\"\n    ms.author=\"dastrock\"/>\n\n# App model v2.0 preview: Protocols - OAuth 2.0 Authorization Code Flow\n\nThe OAuth 2.0 authorization code grant can be used in apps that are installed on a device to gain access to protected resources, such as web APIs.  Using the app model v2.0's implementation of OAuth 2.0, you can add sign in and API access to your mobile and desktop apps.  This guide is language-independent, and describes how to send and receive HTTP messages without using any of our open-source libraries.\n\n<!-- TODO: Need link to libraries -->   \n\n> [AZURE.NOTE]\n    This information applies to the v2.0 app model public preview.  For instructions on how to integrate with the generally available Azure AD service, please refer to the [Azure Active Directory Developer Guide](active-directory-developers-guide.md).\n\nThe OAuth 2.0 authorization code flow is described in in [section 4.1 of the OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).  It is used to perform authentication and authorization in the majority of app types, including [web apps](active-directory-v2-flows.md#web-apps) and [natively installed  apps](active-directory-v2-flows.md#mobile-and-native-apps).  It enables apps to securely acquire access_tokens which can be used to access resources that are secured using the v2.0 app model.  \n\n\n\n## Request an Authorization Code\nThe authorization code flow begins with the client directing the user to the `/authorize` endpoint.  In this request, the client indicates the permissions it needs to acquire from the user:\n\n```\n// Line breaks for legibility only\n\nGET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?\nclient_id=2d4d11a2-f814-46a7-890a-274a72a7309e        // Your registered Application Id\n&response_type=code\n&redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob     // Your registered Redirect Uri, url encoded\n&response_mode=query                                    // 'query', 'form_post', or 'fragment'\n&scope=                                              // See table below\nopenid%20\noffline_access%20\nhttps%3A%2F%2Fgraph.windows.net%2Fdirectory.read%20\nhttps%3A%2F%2Fgraph.windows.net%2Fdirectory.write\n&state=12345                                           // Any value provided by your app\n```\n\n| Parameter | | Description |\n| ----------------------- | ------------------------------- | ----------------------- |\n| client_id | required | The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com)) assigned your app. |\n| response_type | required | Must include `code` for the authorization code flow. |\n| redirect_uri | required | The redirect_uri of your app, where authentication responses can be sent and receieved by your app.  It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded. |\n| scope | required | A space-separated list of scopes.  A single scope value indicates to the v2.0 endpoint both the resource and the permissions to that resource being requested.  Scopes take the form `<app identifier URI>/<scope value>`.  In the example above, the app identifier for the Azure AD Graph API is used, `https://graph.windows.net`, and two permissions are requested: `directory.read` and `directory.write`.  For a more detailed explanation of scopes, refer to the [app model v2.0 scope reference](active-directory-v2-scopes.md).  |\n| response_mode | recommended | Specifies the method that should be used to send the resulting authorization_code back to your app.  Can be one of 'query', 'form_post', or 'fragment'.\n| state | recommended | A value included in the request that will also be returned in the token response.  It can be a string of any content that you wish.  A randomly generated unique value is typically used for preventing cross-site request forgery attacks.  The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on. |\n| prompt | optional | Indicates the type of user interaction that is required.  The only valid values at this time are 'login', 'none', and 'consent'.  `prompt=login` will force the user to enter their credentials on that request, negating single-sign on.  `prompt=none` is the opposite - it will ensure that the user is not presented with any interactive prompt whatsoever.  If the request cannot be completed silently via single-sign on, the v2.0 endpoint will return an error.  `prompt=consent` will trigger the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app. |\n| login_hint | optional | Can be used to pre-fill the username/email address field of the sign in page for the user. |\n\nAt this point, the user will be asked to enter their credentials and complete the authentication.  The v2.0 endpoint will also ensure that the user has consented to the permissions indicated in the `scope` query parameter.  If the user has not consented to any of those permissions, it will ask the user to consent to the required permissions.  Details of [permissions, consent, and multi-tenant apps are provided here](active-directory-v2-scopes.md).\n\nOnce the user authenticates and grants consent, the v2.0 endpoint will return a response to your app at the indicated `redirect_uri`, using the method specified in the `response_mode` parameter.\n\nA successful response using `response_mode=query` looks like:\n\n```\nGET urn:ietf:wg:oauth:2.0:oob?\ncode=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...   // the authorization_code, truncated\n&session_state=7B29111D-C220-4263-99AB-6F6E135D75EF            // a value generated by the v2.0 endpoint\n&state=12345                                                      // the value provided in the request\n```\n\n| Parameter | Description |\n| ----------------------- | ------------------------------- |\n| code | The authorization_code that the  app requested. The  app can use the authorization code to request an access token for the target resource.  Authorization_codes are very short lived, typically they expire after about 10 minutes. |\n| session_state | A unique value that identifies the current user session. This value is a GUID, but should be treated as an opaque value that is passed without examination. |\n| state | If a state parameter is included in the request, the same value should appear in the response. The  app should verify that the state values in the request and response are identical. |\n\nError responses may also be sent to the `redirect_uri` so the app can handle them appropriately:\n\n```\nGET urn:ietf:wg:oauth:2.0:oob?\nerror=access_denied\n&error_description=the+user+canceled+the+authentication\n```\n\n| Parameter | Description |\n| ----------------------- | ------------------------------- |\n| error | An error code string that can be used to classify types of errors that occur, and can be used to react to errors. |\n| error_description | A specific error message that can help a developer identify the root cause of an authentication error.  |\n\n## Request an Access Token\nNow that you've acquired an authorization_code and have been granted permission by the user, you can redeem the `code` for an `access_token` to the desired resource, by sending a `POST` request to the `/token` endpoint:\n\n```\nPOST common/v2.0/oauth2/token HTTP/1.1\nHost: https://login.microsoftonline.com\nContent-Type: application/json\n\n{\n    \"grant_type\": \"authorization_code\",\n    \"client_id\": \"2d4d11a2-f814-46a7-890a-274a72a7309e\",\n    \"scope\": \"https://graph.windows.net/directory.read https://graph.windows.net/directory.write\",\n    \"code\": \"AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...\"\n    \"client_secret\": \"zc53fwe80980293klaj9823\"  // NOTE: Only required for web apps\n}\n```\n\n| Parameter | | Description |\n| ----------------------- | ------------------------------- | --------------------- |\n| client_id | required | The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com)) assigned your app. |\n| grant_type | required | Must be `authorization_code` for the authorization code flow. |\n| scope | required | A space-separated list of scopes.  The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the first leg.  If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.  For a more detailed explanation of scopes, refer to [permissions, consent, and scopes](active-directory-v2-scopes.md).  |\n| code | required | The authorization_code that you acquired in the first leg of the flow.   |\n| client_secret | required for web apps | The application secret that you created in the app registration portal for your app.  It should not be used in a native  app, because client_secrets cannot be reliably stored on devices.  It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side. |\n\nA successful token response will look like:\n\n```\n{\n    \"access_token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...\",\n    \"token_type\": \"Bearer\",\n    \"expires_in\": \"3600\",\n    \"scope\": \"https://graph.windows.net/directory.read https://graph.windows.net/directory.write\",\n    \"refresh_token\": \"AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...\",\n    \"id_token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...\",\n    \"id_token_expires_in\": \"3599\"\n}\n```\n| Parameter | Description |\n| ----------------------- | ------------------------------- |\n| access_token | The requested access token. The  app can use this token to authenticate to the secured resource, such as a web API. |\n| token_type | Indicates the token type value. The only type that Azure AD supports is Bearer  |\n| expires_in | How long the access token is valid (in seconds). |\n| scope | The scopes that the access_token is valid for. |\n| refresh_token |  An OAuth 2.0 refresh token. The  app can use this token acquire additional access tokens after the current access token expires.  Refresh_tokens are long-lived, and can be used to retain access to resources for extended periods of time.  For more detail, refer to the [v2.0 token reference](active-directory-v2-tokens.md).  |\n| id_token | An unsigned JSON Web Token (JWT). The  app can base64Url decode the segments of this token to request information about the user who signed in. The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.  For more information about id_tokens see the [v2.0 app model token reference](active-directory-v2-tokens.md). |\n| id_token_expires_in | How long the id token is valid (in seconds). |\n\n\nError responses will look like:\n\n```\n{\n    \"error\": \"access_denied\",\n    \"error_description\": \"The user revoked access to the app.\",\n}\n```\n\n| Parameter | Description |\n| ----------------------- | ------------------------------- |\n| error | An error code string that can be used to classify types of errors that occur, and can be used to react to errors. |\n| error_description | A specific error message that can help a developer identify the root cause of an authentication error.  |\n\n## Use the Access Token\nNow that you've successfully acquired an `access_token`, you can use the token in requests to Web APIs by including it in the `Authorization` header:\n\n```\nGET /contoso.onmicrosoft.com/users\nHost: https://graph.windows.net\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...\n```\n\n## Refresh the Access Token\nAccess_tokens are short lived, and you must refresh them after they expire to continue accessing resources.  You can do so by submitting another `POST` request to the `/token` endpoint, this time providing the `refresh_token` instead of the `code`:\n\n```\nPOST common/v2.0/oauth2/token HTTP/1.1\nHost: https://login.microsoftonline.com\nContent-Type: application/json\n\n{\n    \"grant_type\": \"refresh_token\",\n    \"client_id\": \"2d4d11a2-f814-46a7-890a-274a72a7309e\",\n    \"scope\": \"https://graph.windows.net/directory.read https://graph.windows.net/directory.write\",\n    \"refresh_token\": \"AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...\",\n    \"client_secret\": \"zc53fwe80980293klaj9823\"  // NOTE: Only required for web apps\n}\n```\n\n| Parameter | | Description |\n| ----------------------- | ------------------------------- | -------- |\n| client_id | required | The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com)) assigned your app. |\n| grant_type | required | Must be `refresh_token` for this leg of the authorization code flow. |\n| scope | required | A space-separated list of scopes.  The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the original authorization_code request leg.  If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.  For a more detailed explanation of scopes, refer to [permissions, consent, and scopes](active-directory-v2-scopes.md).  |\n| refresh_token | required | The refresh_token that you acquired in the second leg of the flow.   |\n| client_secret | required for web apps | The application secret that you created in the app registration portal for your app.  It should not be used in a native  app, because client_secrets cannot be reliably stored on devices.  It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side. |\n\nA successful token response will look like:\n\n```\n{\n    \"access_token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...\",\n    \"token_type\": \"Bearer\",\n    \"expires_in\": \"3600\",\n    \"scope\": \"https://graph.windows.net/directory.read https://graph.windows.net/directory.write\",\n    \"refresh_token\": \"AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...\",\n    \"id_token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...\",\n    \"id_token_expires_in\": \"3599\"\n}\n```\n| Parameter | Description |\n| ----------------------- | ------------------------------- |\n| access_token | The requested access token. The  app can use this token to authenticate to the secured resource, such as a web API. |\n| token_type | Indicates the token type value. The only type that Azure AD supports is Bearer  |\n| expires_in | How long the access token is valid (in seconds). |\n| scope | The scopes that the access_token is valid for. |\n| refresh_token |  A new OAuth 2.0 refresh token. You should replace the old refresh token with this newly acquired refresh token to ensure your refresh tokens remain valid for as long as possible.  |\n| id_token | An unsigned JSON Web Token (JWT). The  app can base64Url decode the segments of this token to request information about the user who signed in. The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.  For more information about id_tokens see the [v2.0 app model token reference](active-directory-v2-tokens.md). |\n| id_token_expires_in | How long the id token is valid (in seconds). |\n\nError responses will look like:\n\n```\n{\n    \"error\": \"access_denied\",\n    \"error_description\": \"The user revoked access to the app.\",\n}\n```\n\n| Parameter | Description |\n| ----------------------- | ------------------------------- |\n| error | An error code string that can be used to classify types of errors that occur, and can be used to react to errors. |\n| error_description | A specific error message that can help a developer identify the root cause of an authentication error.  |\n\n## Summary\nAt a high level, the entire authentication flow for a native/mobile application looks a bit like this:\n\n![OAuth Auth Code Flow](../media/active-directory-v2-flows/convergence_scenarios_native.png)\n\n"
}