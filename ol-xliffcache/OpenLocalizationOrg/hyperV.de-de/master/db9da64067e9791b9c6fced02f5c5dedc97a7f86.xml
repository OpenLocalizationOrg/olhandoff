{
  "nodes": [
    {
      "content": "Quick-create a virtual machine in Azure",
      "pos": [
        4,
        43
      ]
    },
    {
      "content": "Deploy a virtual machine in Azure from a template",
      "pos": [
        77,
        126
      ]
    },
    {
      "content": "Create a virtual machine from a custom image",
      "pos": [
        170,
        214
      ]
    },
    {
      "content": "Deploy a virtual machine that uses a virtual network and a load balancer",
      "pos": [
        246,
        318
      ]
    },
    {
      "content": "Remove a resource group",
      "pos": [
        413,
        436
      ]
    },
    {
      "content": "Show the log for a resource group deployment",
      "pos": [
        467,
        511
      ]
    },
    {
      "content": "Display information about a virtual machine",
      "pos": [
        563,
        606
      ]
    },
    {
      "content": "Connect to a Linux-based virtual machine",
      "pos": [
        657,
        697
      ]
    },
    {
      "content": "Stop a virtual machine",
      "pos": [
        744,
        766
      ]
    },
    {
      "content": "Start a virtual machine",
      "pos": [
        796,
        819
      ]
    },
    {
      "content": "Attach a data disk",
      "pos": [
        850,
        868
      ]
    },
    {
      "content": "Getting ready",
      "pos": [
        895,
        908
      ]
    },
    {
      "content": "Before you can use the Azure CLI with Azure resource groups, you need to have the right Azure CLI version and an Azure account.",
      "pos": [
        910,
        1037
      ]
    },
    {
      "content": "If you don't have the Azure CLI, <bpt id=\"p1\">[</bpt>install it<ept id=\"p1\">](../articles/xplat-cli-install.md)</ept>.",
      "pos": [
        1038,
        1118
      ]
    },
    {
      "content": "Update your Azure CLI version to 0.9.0 or later",
      "pos": [
        1124,
        1171
      ]
    },
    {
      "pos": [
        1173,
        1261
      ],
      "content": "Type <ph id=\"ph1\">`azure --version`</ph> to see whether you have already installed version 0.9.0 or later."
    },
    {
      "pos": [
        1311,
        1465
      ],
      "content": "If your version is not 0.9.0 or later, you need to update it by using one of the native installers or through <bpt id=\"p1\">**</bpt>npm<ept id=\"p1\">**</ept> by typing <ph id=\"ph1\">`npm update -g azure-cli`</ph>."
    },
    {
      "content": "You can also run Azure CLI as a Docker container by using the following <bpt id=\"p1\">[</bpt>Docker image<ept id=\"p1\">](https://registry.hub.docker.com/u/microsoft/azure-cli/)</ept>.",
      "pos": [
        1467,
        1610
      ]
    },
    {
      "content": "From a Docker host, run the following command:",
      "pos": [
        1611,
        1657
      ]
    },
    {
      "content": "Set your Azure account and subscription",
      "pos": [
        1703,
        1742
      ]
    },
    {
      "content": "If you don't already have an Azure subscription but you do have an MSDN subscription, you can activate your <bpt id=\"p1\">[</bpt>MSDN subscriber benefits<ept id=\"p1\">](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/)</ept>.",
      "pos": [
        1744,
        1953
      ]
    },
    {
      "content": "Or you can sign up for a <bpt id=\"p1\">[</bpt>free trial<ept id=\"p1\">](https://azure.microsoft.com/pricing/free-trial/)</ept>.",
      "pos": [
        1954,
        2041
      ]
    },
    {
      "pos": [
        2043,
        2256
      ],
      "content": "Now <bpt id=\"p1\">[</bpt>log in to your Azure account interactively<ept id=\"p1\">](../articles/xplat-cli-connect.md#use-the-log-in-method)</ept> by typing <ph id=\"ph1\">`azure login`</ph> and following the prompts for an interactive login experience to your Azure account."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you have a work or school ID and you know you do not have two-factor authentication enabled, you can <bpt id=\"p1\">**</bpt>also<ept id=\"p1\">**</ept> use <ph id=\"ph2\">`azure login -u`</ph> along with the work or school ID to log in <bpt id=\"p2\">*</bpt>without<ept id=\"p2\">*</ept> an interactive session.",
      "pos": [
        2261,
        2484
      ]
    },
    {
      "content": "If you don't have a work or school ID, you can <bpt id=\"p1\">[</bpt>create a work or school id from your personal Microsoft account<ept id=\"p1\">](../articles/virtual-machines/virtual-machines-windows-create-aad-work-id.md)</ept> to log in the same way.",
      "pos": [
        2485,
        2698
      ]
    },
    {
      "content": "Your account may have more than one subscription.",
      "pos": [
        2700,
        2749
      ]
    },
    {
      "content": "You can list your subscriptions by typing <ph id=\"ph1\">`azure account list`</ph>, which might look something like this:",
      "pos": [
        2750,
        2851
      ]
    },
    {
      "content": "You can set the current Azure subscription by typing the following.",
      "pos": [
        3703,
        3770
      ]
    },
    {
      "content": "Use the subscription name or the ID that has the resources you want to manage.",
      "pos": [
        3771,
        3849
      ]
    },
    {
      "content": "Switch to the Azure CLI resource group mode",
      "pos": [
        3911,
        3954
      ]
    },
    {
      "content": "By default, the Azure CLI starts in the service management mode (<bpt id=\"p1\">**</bpt>asm<ept id=\"p1\">**</ept> mode).",
      "pos": [
        3956,
        4035
      ]
    },
    {
      "content": "Type the following to switch to resource group mode.",
      "pos": [
        4036,
        4088
      ]
    },
    {
      "content": "Understanding Azure resource templates and resource groups",
      "pos": [
        4120,
        4178
      ]
    },
    {
      "content": "Most applications are built from a combination of different resource types (such as one or more VMs and storage accounts, a SQL database, a virtual network, or a content delivery network).",
      "pos": [
        4180,
        4368
      ]
    },
    {
      "content": "The default Azure service management API and the Azure classic portal represented these items by using a service-by-service approach.",
      "pos": [
        4369,
        4502
      ]
    },
    {
      "content": "This approach requires you to deploy and manage the individual services individually (or find other tools that do so), and not as a single logical unit of deployment.",
      "pos": [
        4503,
        4669
      ]
    },
    {
      "content": "<bpt id=\"p1\">*</bpt>Azure Resource Manager templates<ept id=\"p1\">*</ept>, however, make it possible for you to deploy and manage these different resources as one logical deployment unit in a declarative fashion.",
      "pos": [
        4671,
        4844
      ]
    },
    {
      "content": "Instead of imperatively telling Azure what to deploy one command after another, you describe your entire deployment in a JSON file -- all of the resources and associated configuration and deployment parameters -- and tell Azure to deploy those resources as one group.",
      "pos": [
        4845,
        5112
      ]
    },
    {
      "content": "You can then manage the overall life cycle of the group's resources by using Azure CLI resource management commands to:",
      "pos": [
        5114,
        5233
      ]
    },
    {
      "content": "Stop, start, or delete all of the resources within the group at once.",
      "pos": [
        5237,
        5306
      ]
    },
    {
      "content": "Apply Role-Based Access Control (RBAC) rules to lock down security permissions on them.",
      "pos": [
        5309,
        5396
      ]
    },
    {
      "content": "Audit operations.",
      "pos": [
        5399,
        5416
      ]
    },
    {
      "content": "Tag resources with additional metadata for better tracking.",
      "pos": [
        5419,
        5478
      ]
    },
    {
      "content": "You can learn lots more about Azure resource groups and what they can do for you in the <bpt id=\"p1\">[</bpt>Azure Resource Manager overview<ept id=\"p1\">](../articles/resource-group-overview.md)</ept>.",
      "pos": [
        5480,
        5642
      ]
    },
    {
      "content": "If you're interested in authoring templates, see <bpt id=\"p1\">[</bpt>Authoring Azure Resource Manager templates<ept id=\"p1\">](../articles/resource-group-authoring-templates.md)</ept>.",
      "pos": [
        5643,
        5788
      ]
    },
    {
      "pos": [
        5793,
        5864
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"quick-create-a-vm-in-azure\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Quick-create a VM in Azure"
    },
    {
      "content": "Sometimes you know what image you need, and you need a VM from that image right now and you don't care too much about the infrastructure -- maybe you have to test something on a clean VM.",
      "pos": [
        5866,
        6053
      ]
    },
    {
      "content": "That's when you want to use the <ph id=\"ph1\">`azure vm quick-create`</ph> command, and pass the arguments necessary to create a VM and its infrastructure.",
      "pos": [
        6054,
        6190
      ]
    },
    {
      "content": "First, create your resource group.",
      "pos": [
        6192,
        6226
      ]
    },
    {
      "content": "Second, you'll need an image.",
      "pos": [
        6763,
        6792
      ]
    },
    {
      "content": "To find an image with the Azure CLI, see <bpt id=\"p1\">[</bpt>Navigating and selecting Azure virtual machine images with PowerShell and the Azure CLI<ept id=\"p1\">](../articles/virtual-machines/virtual-machines-linux-cli-ps-findimage.md)</ept>.",
      "pos": [
        6793,
        6997
      ]
    },
    {
      "content": "But for this article, here's a short list of popular images.",
      "pos": [
        6998,
        7058
      ]
    },
    {
      "content": "We'll use CoreOS's Stable image for this quick-create.",
      "pos": [
        7059,
        7113
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> For ComputeImageVersion, you can also simply supply 'latest' as the parameter in both the template language and in the Azure CLI.",
      "pos": [
        7117,
        7259
      ]
    },
    {
      "content": "This will allow you to always use the latest and patched version of the image without having to modify your scripts or templates.",
      "pos": [
        7260,
        7389
      ]
    },
    {
      "content": "This is shown below.",
      "pos": [
        7390,
        7410
      ]
    },
    {
      "content": "PublisherName",
      "pos": [
        7414,
        7427
      ]
    },
    {
      "content": "Offer",
      "pos": [
        7453,
        7458
      ]
    },
    {
      "content": "Sku",
      "pos": [
        7493,
        7496
      ]
    },
    {
      "content": "Version",
      "pos": [
        7523,
        7530
      ]
    },
    {
      "content": "OpenLogic",
      "pos": [
        7674,
        7683
      ]
    },
    {
      "content": "CentOS",
      "pos": [
        7709,
        7715
      ]
    },
    {
      "content": "7",
      "pos": [
        7754,
        7755
      ]
    },
    {
      "content": "7.0.201503",
      "pos": [
        7789,
        7799
      ]
    },
    {
      "content": "OpenLogic",
      "pos": [
        7813,
        7822
      ]
    },
    {
      "content": "CentOS",
      "pos": [
        7848,
        7854
      ]
    },
    {
      "content": "7.1",
      "pos": [
        7893,
        7896
      ]
    },
    {
      "content": "7.1.201504",
      "pos": [
        7928,
        7938
      ]
    },
    {
      "content": "CoreOS",
      "pos": [
        7952,
        7958
      ]
    },
    {
      "content": "CoreOS",
      "pos": [
        7987,
        7993
      ]
    },
    {
      "content": "Beta",
      "pos": [
        8032,
        8036
      ]
    },
    {
      "content": "647.0.0",
      "pos": [
        8067,
        8074
      ]
    },
    {
      "content": "CoreOS",
      "pos": [
        8091,
        8097
      ]
    },
    {
      "content": "CoreOS",
      "pos": [
        8126,
        8132
      ]
    },
    {
      "content": "Stable",
      "pos": [
        8171,
        8177
      ]
    },
    {
      "content": "633.1.0",
      "pos": [
        8206,
        8213
      ]
    },
    {
      "content": "MicrosoftDynamicsNAV",
      "pos": [
        8230,
        8250
      ]
    },
    {
      "content": "DynamicsNAV",
      "pos": [
        8265,
        8276
      ]
    },
    {
      "content": "2015",
      "pos": [
        8310,
        8314
      ]
    },
    {
      "content": "8.0.40459",
      "pos": [
        8345,
        8354
      ]
    },
    {
      "content": "MicrosoftSharePoint",
      "pos": [
        8369,
        8388
      ]
    },
    {
      "content": "MicrosoftSharePointServer",
      "pos": [
        8404,
        8429
      ]
    },
    {
      "content": "2013",
      "pos": [
        8449,
        8453
      ]
    },
    {
      "content": "1.0.0",
      "pos": [
        8484,
        8489
      ]
    },
    {
      "content": "msopentech",
      "pos": [
        8508,
        8518
      ]
    },
    {
      "content": "Oracle-Database-12c-Weblogic-Server-12c",
      "pos": [
        8543,
        8582
      ]
    },
    {
      "content": "Standard",
      "pos": [
        8588,
        8596
      ]
    },
    {
      "content": "1.0.0",
      "pos": [
        8623,
        8628
      ]
    },
    {
      "content": "msopentech",
      "pos": [
        8647,
        8657
      ]
    },
    {
      "content": "Oracle-Database-12c-Weblogic-Server-12c",
      "pos": [
        8682,
        8721
      ]
    },
    {
      "content": "Enterprise",
      "pos": [
        8727,
        8737
      ]
    },
    {
      "content": "1.0.0",
      "pos": [
        8762,
        8767
      ]
    },
    {
      "content": "MicrosoftSQLServer",
      "pos": [
        8786,
        8804
      ]
    },
    {
      "content": "SQL2014-WS2012R2",
      "pos": [
        8821,
        8837
      ]
    },
    {
      "content": "Enterprise-Optimized-for-DW",
      "pos": [
        8866,
        8893
      ]
    },
    {
      "content": "12.0.2430",
      "pos": [
        8901,
        8910
      ]
    },
    {
      "content": "MicrosoftSQLServer",
      "pos": [
        8925,
        8943
      ]
    },
    {
      "content": "SQL2014-WS2012R2",
      "pos": [
        8960,
        8976
      ]
    },
    {
      "content": "Enterprise-Optimized-for-OLTP",
      "pos": [
        9005,
        9034
      ]
    },
    {
      "content": "12.0.2430",
      "pos": [
        9040,
        9049
      ]
    },
    {
      "content": "Canonical",
      "pos": [
        9064,
        9073
      ]
    },
    {
      "content": "UbuntuServer",
      "pos": [
        9099,
        9111
      ]
    },
    {
      "content": "12.04.5-LTS",
      "pos": [
        9144,
        9155
      ]
    },
    {
      "content": "12.04.201504230",
      "pos": [
        9179,
        9194
      ]
    },
    {
      "content": "Canonical",
      "pos": [
        9203,
        9212
      ]
    },
    {
      "content": "UbuntuServer",
      "pos": [
        9238,
        9250
      ]
    },
    {
      "content": "14.04.2-LTS",
      "pos": [
        9283,
        9294
      ]
    },
    {
      "content": "14.04.201503090",
      "pos": [
        9318,
        9333
      ]
    },
    {
      "content": "MicrosoftWindowsServer",
      "pos": [
        9342,
        9364
      ]
    },
    {
      "content": "WindowsServer",
      "pos": [
        9377,
        9390
      ]
    },
    {
      "content": "2012-Datacenter",
      "pos": [
        9422,
        9437
      ]
    },
    {
      "content": "3.0.201503",
      "pos": [
        9457,
        9467
      ]
    },
    {
      "content": "MicrosoftWindowsServer",
      "pos": [
        9481,
        9503
      ]
    },
    {
      "content": "WindowsServer",
      "pos": [
        9516,
        9529
      ]
    },
    {
      "content": "2012-R2-Datacenter",
      "pos": [
        9561,
        9579
      ]
    },
    {
      "content": "4.0.201503",
      "pos": [
        9596,
        9606
      ]
    },
    {
      "content": "MicrosoftWindowsServer",
      "pos": [
        9620,
        9642
      ]
    },
    {
      "content": "WindowsServer",
      "pos": [
        9655,
        9668
      ]
    },
    {
      "content": "Windows-Server-Technical-Preview",
      "pos": [
        9700,
        9732
      ]
    },
    {
      "content": "5.0.201504",
      "pos": [
        9735,
        9745
      ]
    },
    {
      "content": "MicrosoftWindowsServerEssentials",
      "pos": [
        9759,
        9791
      ]
    },
    {
      "content": "WindowsServerEssentials",
      "pos": [
        9794,
        9817
      ]
    },
    {
      "content": "WindowsServerEssentials",
      "pos": [
        9839,
        9862
      ]
    },
    {
      "content": "1.0.141204",
      "pos": [
        9874,
        9884
      ]
    },
    {
      "content": "MicrosoftWindowsServerHPCPack",
      "pos": [
        9898,
        9927
      ]
    },
    {
      "content": "WindowsServerHPCPack",
      "pos": [
        9933,
        9953
      ]
    },
    {
      "content": "2012R2",
      "pos": [
        9978,
        9984
      ]
    },
    {
      "content": "4.3.4665",
      "pos": [
        10013,
        10021
      ]
    },
    {
      "content": "Just create your VM by entering the <ph id=\"ph1\">`azure vm quick-create`</ph> command and being ready for the prompts.",
      "pos": [
        10036,
        10136
      ]
    },
    {
      "content": "It should look something like this:",
      "pos": [
        10137,
        10172
      ]
    },
    {
      "content": "And away you go with your new VM.",
      "pos": [
        14791,
        14824
      ]
    },
    {
      "pos": [
        14829,
        14920
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"deploy-a-vm-in-azure-from-a-template\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Deploy a VM in Azure from a template"
    },
    {
      "content": "Use the instructions in these sections to deploy a new Azure VM by using a template with the Azure CLI.",
      "pos": [
        14922,
        15025
      ]
    },
    {
      "content": "This template creates a single virtual machine in a new virtual network with a single subnet, and unlike <ph id=\"ph1\">`azure vm quick-create`</ph>, enables you to describe what you want precisely and repeat it without errors.",
      "pos": [
        15026,
        15233
      ]
    },
    {
      "content": "Here's what this template creates:",
      "pos": [
        15234,
        15268
      ]
    },
    {
      "content": "Step 1: Examine the JSON file for the template parameters",
      "pos": [
        15344,
        15401
      ]
    },
    {
      "content": "Here are the contents of the JSON file for the template.",
      "pos": [
        15403,
        15459
      ]
    },
    {
      "content": "(The template is also located in <bpt id=\"p1\">[</bpt>GitHub<ept id=\"p1\">](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-simple-linux/azuredeploy.json)</ept>.)",
      "pos": [
        15460,
        15615
      ]
    },
    {
      "content": "Templates are flexible, so the designer may have chosen to give you lots of parameters or chosen to offer only a few by creating a template that is more fixed.",
      "pos": [
        15617,
        15776
      ]
    },
    {
      "content": "In order to collect the information you need to pass the template as parameters, open the template file (this topic has a template inline, below) and examine the <bpt id=\"p1\">**</bpt>parameters<ept id=\"p1\">**</ept> values.",
      "pos": [
        15777,
        15961
      ]
    },
    {
      "content": "In this case, the template below will ask for:",
      "pos": [
        15963,
        16009
      ]
    },
    {
      "content": "A unique storage account name.",
      "pos": [
        16013,
        16043
      ]
    },
    {
      "content": "An admin user name for the VM.",
      "pos": [
        16046,
        16076
      ]
    },
    {
      "content": "A password.",
      "pos": [
        16079,
        16090
      ]
    },
    {
      "content": "A domain name for the outside world to use.",
      "pos": [
        16093,
        16136
      ]
    },
    {
      "content": "An Ubuntu Server version number -- but it will accept only one of a list.",
      "pos": [
        16139,
        16212
      ]
    },
    {
      "content": "Once you decide on these values, you're ready to create a group for and deploy this template into your Azure subscription.",
      "pos": [
        16214,
        16336
      ]
    },
    {
      "content": "Step 2: Create the virtual machine by using the template",
      "pos": [
        22540,
        22596
      ]
    },
    {
      "content": "Once you have your parameter values ready, you must create a resource group for your template deployment and then deploy the template.",
      "pos": [
        22598,
        22732
      ]
    },
    {
      "content": "To create the resource group, type <ph id=\"ph1\">`azure group create &lt;group name&gt; &lt;location&gt;`</ph> with the name of the group you want and the datacenter location into which you want to deploy.",
      "pos": [
        22734,
        22908
      ]
    },
    {
      "content": "This happens quickly:",
      "pos": [
        22909,
        22930
      ]
    },
    {
      "pos": [
        23485,
        23561
      ],
      "content": "Now to create the deployment, call <ph id=\"ph1\">`azure group deployment create`</ph> and pass:"
    },
    {
      "content": "The template file (if you saved the above JSON template to a local file).",
      "pos": [
        23565,
        23638
      ]
    },
    {
      "content": "A template URI (if you want to point at the file in GitHub or some other web address).",
      "pos": [
        23641,
        23727
      ]
    },
    {
      "content": "The resource group into which you want to deploy.",
      "pos": [
        23730,
        23779
      ]
    },
    {
      "content": "An optional deployment name.",
      "pos": [
        23782,
        23810
      ]
    },
    {
      "content": "You will be prompted to supply the values of parameters in the \"parameters\" section of the JSON file.",
      "pos": [
        23812,
        23913
      ]
    },
    {
      "content": "When you have specified all the parameter values, your deployment will begin.",
      "pos": [
        23914,
        23991
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        23993,
        24012
      ]
    },
    {
      "content": "You will receive the following type of information:",
      "pos": [
        24449,
        24500
      ]
    },
    {
      "pos": [
        25785,
        25852
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"create-a-custom-vm-image\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Create a custom VM image"
    },
    {
      "content": "You've seen the basic usage of templates above, so now we can use similar instructions to create a custom VM from a specific .vhd file in Azure by using a template via the Azure CLI.",
      "pos": [
        25854,
        26036
      ]
    },
    {
      "content": "The difference here is that this template creates a single virtual machine from a specified virtual hard disk (VHD).",
      "pos": [
        26037,
        26153
      ]
    },
    {
      "content": "Step 1: Examine the JSON file for the template",
      "pos": [
        26159,
        26205
      ]
    },
    {
      "content": "Here are the contents of the JSON file for the template that this section uses as an example.",
      "pos": [
        26207,
        26300
      ]
    },
    {
      "content": "(The template is also located in <bpt id=\"p1\">[</bpt>GitHub<ept id=\"p1\">](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-from-user-image/azuredeploy.json)</ept>.)",
      "pos": [
        26301,
        26459
      ]
    },
    {
      "content": "Again, you will need to find the values you want to enter for the parameters that do not have default values.",
      "pos": [
        26461,
        26570
      ]
    },
    {
      "content": "When you run the <ph id=\"ph1\">`azure group deployment create`</ph> command, the Azure CLI will prompt you to enter those values.",
      "pos": [
        26571,
        26681
      ]
    },
    {
      "content": "Step 2: Obtain the VHD",
      "pos": [
        33586,
        33608
      ]
    },
    {
      "content": "Obviously, you'll need a .vhd for this.",
      "pos": [
        33610,
        33649
      ]
    },
    {
      "content": "You can use one you already have in Azure, or you can upload one.",
      "pos": [
        33650,
        33715
      ]
    },
    {
      "pos": [
        33717,
        33891
      ],
      "content": "For a Windows-based virtual machine, see <bpt id=\"p1\">[</bpt>Create and upload a Windows Server VHD to Azure<ept id=\"p1\">](../articles/virtual-machines/virtual-machines-windows-classic-createupload-vhd.md)</ept>."
    },
    {
      "pos": [
        33893,
        34100
      ],
      "content": "For a Linux-based virtual machine, see <bpt id=\"p1\">[</bpt>Creating and uploading a virtual hard disk that contains the Linux operating system<ept id=\"p1\">](../articles/virtual-machines/virtual-machines-linux-classic-create-upload-vhd.md)</ept>."
    },
    {
      "content": "Step 3: Create the virtual machine by using the template",
      "pos": [
        34106,
        34162
      ]
    },
    {
      "content": "Now you're ready to create a new virtual machine based on the .vhd.",
      "pos": [
        34164,
        34231
      ]
    },
    {
      "content": "Create a group to deploy into, by using <ph id=\"ph1\">`azure group create &lt;location&gt;`</ph>:",
      "pos": [
        34232,
        34304
      ]
    },
    {
      "content": "Then create the deployment by using the <ph id=\"ph1\">`--template-uri`</ph> option to call in the template directly (or you can use the <ph id=\"ph2\">`--template-file`</ph> option to use a file that you have saved locally).",
      "pos": [
        34882,
        35067
      ]
    },
    {
      "content": "Note that because the template has defaults specified, you are prompted for only a few things.",
      "pos": [
        35068,
        35162
      ]
    },
    {
      "content": "If you deploy the template in different places, you may find that some naming collisions occur with the default values (particularly the DNS name you create).",
      "pos": [
        35163,
        35321
      ]
    },
    {
      "content": "Output looks something like the following:",
      "pos": [
        35784,
        35826
      ]
    },
    {
      "pos": [
        37893,
        38086
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"deploy-a-multi-vm-application-that-uses-a-virtual-network-and-an-external-load-balancer\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Deploy a multi-VM application that uses a virtual network and an external load balancer"
    },
    {
      "content": "This template allows you to create two virtual machines under a load balancer and configure a load-balancing rule on Port 80.",
      "pos": [
        38088,
        38213
      ]
    },
    {
      "content": "This template also deploys a storage account, virtual network, public IP address, availability set, and network interfaces.",
      "pos": [
        38214,
        38337
      ]
    },
    {
      "content": "Follow these steps to deploy a multi-VM application that uses a virtual network and a load balancer by using a Resource Manager template in the GitHub template repository via Azure PowerShell commands.",
      "pos": [
        38415,
        38616
      ]
    },
    {
      "content": "Step 1: Examine the JSON file for the template",
      "pos": [
        38622,
        38668
      ]
    },
    {
      "content": "Here are the contents of the JSON file for the template.",
      "pos": [
        38670,
        38726
      ]
    },
    {
      "content": "If you want the most recent version, it's located <bpt id=\"p1\">[</bpt>at the Github repository for templates<ept id=\"p1\">](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-2-vms-loadbalancer-lbrules/azuredeploy.json)</ept>.",
      "pos": [
        38727,
        38941
      ]
    },
    {
      "content": "This topic uses the <ph id=\"ph1\">`--template-uri`</ph> switch to call in the template, but you can also use the <ph id=\"ph2\">`--template-file`</ph> switch to pass a local version.",
      "pos": [
        38942,
        39085
      ]
    },
    {
      "content": "Step 2: Create the deployment by using the template",
      "pos": [
        53251,
        53302
      ]
    },
    {
      "content": "Create a resource group for the template by using <ph id=\"ph1\">`azure group create &lt;location&gt;`</ph>.",
      "pos": [
        53304,
        53386
      ]
    },
    {
      "content": "Then, create a deployment into that resource group by using <ph id=\"ph1\">`azure group deployment create`</ph> and passing the resource group, passing a deployment name, and answering the prompts for parameters in the template that did not have default values.",
      "pos": [
        53387,
        53628
      ]
    },
    {
      "content": "Now use the <ph id=\"ph1\">`azure group deployment create`</ph> command and the <ph id=\"ph2\">`--template-uri`</ph> option to deploy the template.",
      "pos": [
        54136,
        54243
      ]
    },
    {
      "content": "Be ready with your parameter values when it prompts you, as shown below.",
      "pos": [
        54244,
        54316
      ]
    },
    {
      "content": "Note that this template deploys a Windows Server image; however, it could easily be replaced by any Linux image.",
      "pos": [
        56678,
        56790
      ]
    },
    {
      "content": "Want to create a Docker cluster with multiple swarm managers?",
      "pos": [
        56791,
        56852
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>You can do it<ept id=\"p1\">](https://azure.microsoft.com/documentation/templates/docker-swarm-cluster/)</ept>.",
      "pos": [
        56853,
        56944
      ]
    },
    {
      "pos": [
        56949,
        57014
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"remove-a-resource-group\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Remove a resource group"
    },
    {
      "pos": [
        57016,
        57159
      ],
      "content": "Remember that you can redeploy to a resource group, but if you are done with one, you can delete it by using <ph id=\"ph1\">`azure group delete &lt;group name&gt;`</ph>."
    },
    {
      "pos": [
        57382,
        57489
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"show-the-log-for-a-resource-group-deployment\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Show the log for a resource group deployment"
    },
    {
      "content": "This one is common while you're creating or using templates.",
      "pos": [
        57491,
        57551
      ]
    },
    {
      "content": "The call to display the deployment logs for a group is <ph id=\"ph1\">`azure group log show &lt;groupname&gt;`</ph>, which displays quite a bit of information that's useful for understanding why something happened -- or didn't.",
      "pos": [
        57552,
        57753
      ]
    },
    {
      "content": "(For more information on troubleshooting your deployments, as well as other information about issues, see <bpt id=\"p1\">[</bpt>Troubleshooting resource group deployments in Azure<ept id=\"p1\">](../articles/resource-manager-troubleshoot-deployments-cli.md)</ept>.)",
      "pos": [
        57754,
        57977
      ]
    },
    {
      "content": "To target specific failures, for example, you might use tools like <bpt id=\"p1\">**</bpt>jq<ept id=\"p1\">**</ept> to query things a bit more precisely, such as which individual failures you need to correct.",
      "pos": [
        57979,
        58145
      ]
    },
    {
      "content": "The following example uses <bpt id=\"p1\">**</bpt>jq<ept id=\"p1\">**</ept> to parse a deployment log for <bpt id=\"p2\">**</bpt>lbgroup<ept id=\"p2\">**</ept>, looking for failures.",
      "pos": [
        58146,
        58244
      ]
    },
    {
      "content": "You can discover very quickly what went wrong, fix, and retry.",
      "pos": [
        58351,
        58413
      ]
    },
    {
      "content": "In the following case, the template had been creating two VMs at the same time, which created a lock on the .vhd.",
      "pos": [
        58414,
        58527
      ]
    },
    {
      "content": "(After we modified the template, the deployment succeeded quickly.)",
      "pos": [
        58528,
        58595
      ]
    },
    {
      "pos": [
        59033,
        59138
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"display-information-about-a-virtual-machine\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Display information about a virtual machine"
    },
    {
      "content": "You can see information about specific VMs in your resource group by using the <ph id=\"ph1\">`azure vm show &lt;groupname&gt; &lt;vmname&gt;`</ph> command.",
      "pos": [
        59140,
        59264
      ]
    },
    {
      "content": "If you have more than one VM in your group, you might first need to list the VMs in a group by using <ph id=\"ph1\">`azure vm list &lt;groupname&gt;`</ph>.",
      "pos": [
        59265,
        59394
      ]
    },
    {
      "content": "And then, looking up myVM1:",
      "pos": [
        59726,
        59753
      ]
    },
    {
      "pos": [
        62217,
        62506
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to programmatically store and manipulate the output of your console commands, you may want to use a JSON parsing tool such as <bpt id=\"p1\">**</bpt><bpt id=\"p2\">[</bpt>jq<ept id=\"p2\">](https://github.com/stedolan/jq)</ept><ept id=\"p1\">**</ept> or <bpt id=\"p3\">**</bpt><bpt id=\"p4\">[</bpt>jsawk<ept id=\"p4\">](https://github.com/micha/jsawk)</ept><ept id=\"p3\">**</ept>, or language libraries that are good for the task."
    },
    {
      "pos": [
        62511,
        62608
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"log-on-to-a-linux-based-virtual-machine\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Log on to a Linux-based virtual machine"
    },
    {
      "content": "Typically Linux machines are connected to through SSH.",
      "pos": [
        62610,
        62664
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>How to use SSH with Linux on Azure<ept id=\"p1\">](../articles/virtual-machines/virtual-machines-linux-ssh-from-linux.md)</ept>.",
      "pos": [
        62665,
        62799
      ]
    },
    {
      "pos": [
        62804,
        62854
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"stop-a-virtual-machine\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Stop a VM"
    },
    {
      "content": "Run this command:",
      "pos": [
        62856,
        62873
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> Use this parameter to keep the virtual IP (VIP) of the vnet in case it's the last VM in that vnet.",
      "pos": [
        62931,
        63047
      ]
    },
    {
      "content": "If you use the <ph id=\"ph1\">`StayProvisioned`</ph> parameter, you'll still be billed for the VM.",
      "pos": [
        63057,
        63135
      ]
    },
    {
      "pos": [
        63140,
        63192
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"start-a-virtual-machine\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Start a VM"
    },
    {
      "content": "Run this command:",
      "pos": [
        63194,
        63211
      ]
    },
    {
      "pos": [
        63272,
        63327
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"attach-a-data-disk\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Task: Attach a data disk"
    },
    {
      "content": "You'll also need to decide whether to attach a new disk or one that contains data.",
      "pos": [
        63329,
        63411
      ]
    },
    {
      "content": "For a new disk, the command creates the .vhd file and attaches it in the same command.",
      "pos": [
        63412,
        63498
      ]
    },
    {
      "content": "To attach a new disk, run this command:",
      "pos": [
        63500,
        63539
      ]
    },
    {
      "content": "To attach an existing data disk, run this command:",
      "pos": [
        63612,
        63662
      ]
    },
    {
      "content": "Then you'll need to mount the disk, as you normally would in Linux.",
      "pos": [
        63727,
        63794
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        63800,
        63810
      ]
    },
    {
      "content": "For far more examples of Azure CLI usage with the <bpt id=\"p1\">**</bpt>arm<ept id=\"p1\">**</ept> mode, see <bpt id=\"p2\">[</bpt>Using the Azure CLI for Mac, Linux, and Windows with Azure Resource Manager<ept id=\"p2\">](../articles/xplat-cli-azure-resource-manager.md)</ept>.",
      "pos": [
        63812,
        64007
      ]
    },
    {
      "content": "To learn more about Azure resources and their concepts, see <bpt id=\"p1\">[</bpt>Azure Resource Manager overview<ept id=\"p1\">](../articles/resource-group-overview.md)</ept>.",
      "pos": [
        64008,
        64142
      ]
    },
    {
      "pos": [
        64145,
        64380
      ],
      "content": "For more templates you can use, see <bpt id=\"p1\">[</bpt>Azure Quickstart templates<ept id=\"p1\">](https://azure.microsoft.com/documentation/templates/)</ept> and <bpt id=\"p2\">[</bpt>Application frameworks using templates<ept id=\"p2\">](../articles/virtual-machines/virtual-machines-linux-app-frameworks.md)</ept>."
    }
  ],
  "content": "\n- [Quick-create a virtual machine in Azure](#quick-create-a-vm-in-azure)\n- [Deploy a virtual machine in Azure from a template](#deploy-a-vm-in-azure-from-a-template)\n- [Create a virtual machine from a custom image](#create-a-custom-vm-image)\n- [Deploy a virtual machine that uses a virtual network and a load balancer](#deploy-a-multi-vm-application-that-uses-a-virtual-network-and-an-external-load-balancer)\n- [Remove a resource group](#remove-a-resource-group)\n- [Show the log for a resource group deployment](#show-the-log-for-a-resource-group-deployment)\n- [Display information about a virtual machine](#display-information-about-a-virtual-machine)\n- [Connect to a Linux-based virtual machine](#log-on-to-a-linux-based-virtual-machine)\n- [Stop a virtual machine](#stop-a-virtual-machine)\n- [Start a virtual machine](#start-a-virtual-machine)\n- [Attach a data disk](#attach-a-data-disk)\n\n## Getting ready\n\nBefore you can use the Azure CLI with Azure resource groups, you need to have the right Azure CLI version and an Azure account. If you don't have the Azure CLI, [install it](../articles/xplat-cli-install.md).\n\n### Update your Azure CLI version to 0.9.0 or later\n\nType `azure --version` to see whether you have already installed version 0.9.0 or later. \n\n    azure --version\n    0.9.0 (node: 0.10.25)\n\nIf your version is not 0.9.0 or later, you need to update it by using one of the native installers or through **npm** by typing `npm update -g azure-cli`.\n\nYou can also run Azure CLI as a Docker container by using the following [Docker image](https://registry.hub.docker.com/u/microsoft/azure-cli/). From a Docker host, run the following command:\n\n    docker run -it microsoft/azure-cli\n\n### Set your Azure account and subscription\n\nIf you don't already have an Azure subscription but you do have an MSDN subscription, you can activate your [MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/). Or you can sign up for a [free trial](https://azure.microsoft.com/pricing/free-trial/).\n\nNow [log in to your Azure account interactively](../articles/xplat-cli-connect.md#use-the-log-in-method) by typing `azure login` and following the prompts for an interactive login experience to your Azure account. \n\n> [AZURE.NOTE] If you have a work or school ID and you know you do not have two-factor authentication enabled, you can **also** use `azure login -u` along with the work or school ID to log in *without* an interactive session. If you don't have a work or school ID, you can [create a work or school id from your personal Microsoft account](../articles/virtual-machines/virtual-machines-windows-create-aad-work-id.md) to log in the same way.\n\nYour account may have more than one subscription. You can list your subscriptions by typing `azure account list`, which might look something like this:\n\n    azure account list\n    info:    Executing command account list\n    data:    Name                              Id                                    Tenant Id                            Current\n    data:    --------------------------------  ------------------------------------  ------------------------------------  -------\n    data:    Contoso Admin                     xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  true\n    data:    Fabrikam dev                      xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  false  \n    data:    Fabrikam test                     xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  false  \n    data:    Contoso production                xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  false  \n\nYou can set the current Azure subscription by typing the following. Use the subscription name or the ID that has the resources you want to manage.\n\n    azure account set <subscription name or ID> true\n\n\n\n### Switch to the Azure CLI resource group mode\n\nBy default, the Azure CLI starts in the service management mode (**asm** mode). Type the following to switch to resource group mode.\n\n    azure config mode arm\n\n## Understanding Azure resource templates and resource groups\n\nMost applications are built from a combination of different resource types (such as one or more VMs and storage accounts, a SQL database, a virtual network, or a content delivery network). The default Azure service management API and the Azure classic portal represented these items by using a service-by-service approach. This approach requires you to deploy and manage the individual services individually (or find other tools that do so), and not as a single logical unit of deployment.\n\n*Azure Resource Manager templates*, however, make it possible for you to deploy and manage these different resources as one logical deployment unit in a declarative fashion. Instead of imperatively telling Azure what to deploy one command after another, you describe your entire deployment in a JSON file -- all of the resources and associated configuration and deployment parameters -- and tell Azure to deploy those resources as one group.\n\nYou can then manage the overall life cycle of the group's resources by using Azure CLI resource management commands to:\n\n- Stop, start, or delete all of the resources within the group at once.\n- Apply Role-Based Access Control (RBAC) rules to lock down security permissions on them.\n- Audit operations.\n- Tag resources with additional metadata for better tracking.\n\nYou can learn lots more about Azure resource groups and what they can do for you in the [Azure Resource Manager overview](../articles/resource-group-overview.md). If you're interested in authoring templates, see [Authoring Azure Resource Manager templates](../articles/resource-group-authoring-templates.md).\n\n## <a id=\"quick-create-a-vm-in-azure\"></a>Task: Quick-create a VM in Azure\n\nSometimes you know what image you need, and you need a VM from that image right now and you don't care too much about the infrastructure -- maybe you have to test something on a clean VM. That's when you want to use the `azure vm quick-create` command, and pass the arguments necessary to create a VM and its infrastructure.\n\nFirst, create your resource group.\n\n    azure group create coreos-quick westus\n    info:    Executing command group create\n    + Getting resource group coreos-quick\n    + Creating resource group coreos-quick\n    info:    Created resource group coreos-quick\n    data:    Id:                  /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/coreos-quick\n    data:    Name:                coreos-quick\n    data:    Location:            westus\n    data:    Provisioning State:  Succeeded\n    data:    Tags:\n    data:\n    info:    group create command OK\n\n\nSecond, you'll need an image. To find an image with the Azure CLI, see [Navigating and selecting Azure virtual machine images with PowerShell and the Azure CLI](../articles/virtual-machines/virtual-machines-linux-cli-ps-findimage.md). But for this article, here's a short list of popular images. We'll use CoreOS's Stable image for this quick-create.\n\n> [AZURE.NOTE] For ComputeImageVersion, you can also simply supply 'latest' as the parameter in both the template language and in the Azure CLI. This will allow you to always use the latest and patched version of the image without having to modify your scripts or templates. This is shown below.\n\n| PublisherName                        | Offer                                 | Sku                         | Version |\n|:---------------------------------|:-------------------------------------------|:---------------------------------|:--------------------|\n| OpenLogic                        | CentOS                                     | 7                                | 7.0.201503          |\n| OpenLogic                        | CentOS                                     | 7.1                              | 7.1.201504          |\n| CoreOS                           | CoreOS                                     | Beta                             | 647.0.0             |\n| CoreOS                           | CoreOS                                     | Stable                           | 633.1.0             |\n| MicrosoftDynamicsNAV             | DynamicsNAV                                | 2015                             | 8.0.40459           |\n| MicrosoftSharePoint              | MicrosoftSharePointServer                  | 2013                             | 1.0.0               |\n| msopentech                       | Oracle-Database-12c-Weblogic-Server-12c    | Standard                         | 1.0.0               |\n| msopentech                       | Oracle-Database-12c-Weblogic-Server-12c    | Enterprise                       | 1.0.0               |\n| MicrosoftSQLServer               | SQL2014-WS2012R2                           | Enterprise-Optimized-for-DW      | 12.0.2430           |\n| MicrosoftSQLServer               | SQL2014-WS2012R2                           | Enterprise-Optimized-for-OLTP    | 12.0.2430           |\n| Canonical                        | UbuntuServer                               | 12.04.5-LTS                      | 12.04.201504230     |\n| Canonical                        | UbuntuServer                               | 14.04.2-LTS                      | 14.04.201503090     |\n| MicrosoftWindowsServer           | WindowsServer                              | 2012-Datacenter                  | 3.0.201503          |\n| MicrosoftWindowsServer           | WindowsServer                              | 2012-R2-Datacenter               | 4.0.201503          |\n| MicrosoftWindowsServer           | WindowsServer                              | Windows-Server-Technical-Preview | 5.0.201504          |\n| MicrosoftWindowsServerEssentials | WindowsServerEssentials                    | WindowsServerEssentials          | 1.0.141204          |\n| MicrosoftWindowsServerHPCPack    | WindowsServerHPCPack                       | 2012R2                           | 4.3.4665            |\n\nJust create your VM by entering the `azure vm quick-create` command and being ready for the prompts. It should look something like this:\n\n    azure vm quick-create\n    info:    Executing command vm quick-create\n    Resource group name: coreos-quick\n    Virtual machine name: coreos\n    Location name: westus\n    Operating system Type [Windows, Linux]: linux\n    ImageURN (format: \"publisherName:offer:skus:version\"): coreos:coreos:stable:latest\n    User name: ops\n    Password: *********\n    Confirm password: *********\n    + Looking up the VM \"coreos\"\n    info:    Using the VM Size \"Standard_A1\"\n    info:    The [OS, Data] Disk or image configuration requires storage account\n    + Retrieving storage accounts\n    info:    Could not find any storage accounts in the region \"westus\", trying to create new one\n    + Creating storage account \"cli9fd3fce49e9a9b3d14302\" in \"westus\"\n    + Looking up the storage account cli9fd3fce49e9a9b3d14302\n    + Looking up the NIC \"coreo-westu-1430261891570-nic\"\n    info:    An nic with given name \"coreo-westu-1430261891570-nic\" not found, creating a new one\n    + Looking up the virtual network \"coreo-westu-1430261891570-vnet\"\n    info:    Preparing to create new virtual network and subnet\n    / Creating a new virtual network \"coreo-westu-1430261891570-vnet\" [address prefix: \"10.0.0.0/16\"] with subnet \"coreo-westu-1430261891570-sne+\" [address prefix: \"10.0.1.0/24\"]\n    + Looking up the virtual network \"coreo-westu-1430261891570-vnet\"\n    + Looking up the subnet \"coreo-westu-1430261891570-snet\" under the virtual network \"coreo-westu-1430261891570-vnet\"\n    info:    Found public ip parameters, trying to setup PublicIP profile\n    + Looking up the public ip \"coreo-westu-1430261891570-pip\"\n    info:    PublicIP with given name \"coreo-westu-1430261891570-pip\" not found, creating a new one\n    + Creating public ip \"coreo-westu-1430261891570-pip\"\n    + Looking up the public ip \"coreo-westu-1430261891570-pip\"\n    + Creating NIC \"coreo-westu-1430261891570-nic\"\n    + Looking up the NIC \"coreo-westu-1430261891570-nic\"\n    + Creating VM \"coreos\"\n    + Looking up the VM \"coreos\"\n    + Looking up the NIC \"coreo-westu-1430261891570-nic\"\n    + Looking up the public ip \"coreo-westu-1430261891570-pip\"\n    data:    Id                              :/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/coreos-quick/providers/Microsoft.Compute/virtualMachines/coreos\n    data:    ProvisioningState               :Succeeded\n    data:    Name                            :coreos\n    data:    Location                        :westus\n    data:    FQDN                            :coreo-westu-1430261891570-pip.westus.cloudapp.azure.com\n    data:    Type                            :Microsoft.Compute/virtualMachines\n    data:\n    data:    Hardware Profile:\n    data:      Size                          :Standard_A1\n    data:\n    data:    Storage Profile:\n    data:      Image reference:\n    data:        Publisher                   :coreos\n    data:        Offer                       :coreos\n    data:        Sku                         :stable\n    data:        Version                     :633.1.0\n    data:\n    data:      OS Disk:\n    data:        OSType                      :Linux\n    data:        Name                        :cli9fd3fce49e9a9b3d-os-1430261892283\n    data:        Caching                     :ReadWrite\n    data:        CreateOption                :FromImage\n    data:        Vhd:\n    data:          Uri                       :https://cli9fd3fce49e9a9b3d14302.blob.core.windows.net/vhds/cli9fd3fce49e9a9b3d-os-1430261892283.vhd\n    data:\n    data:    OS Profile:\n    data:      Computer Name                 :coreos\n    data:      User Name                     :ops\n    data:      Linux Configuration:\n    data:        Disable Password Auth       :false\n    data:\n    data:    Network Profile:\n    data:      Network Interfaces:\n    data:        Network Interface #1:\n    data:          Id                        :/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/coreos-quick/providers/Microsoft.Network/networkInterfaces/coreo-westu-1430261891570-nic\n    data:          Primary                   :true\n    data:          MAC Address               :00-0D-3A-30-72-E3\n    data:          Provisioning State        :Succeeded\n    data:          Name                      :coreo-westu-1430261891570-nic\n    data:          Location                  :westus\n    data:            Private IP alloc-method :Dynamic\n    data:            Private IP address      :10.0.1.4\n    data:            Public IP address       :104.40.24.124\n    data:            FQDN                    :coreo-westu-1430261891570-pip.westus.cloudapp.azure.com\n    info:    vm quick-create command OK\n\nAnd away you go with your new VM.\n\n## <a id=\"deploy-a-vm-in-azure-from-a-template\"></a>Task: Deploy a VM in Azure from a template\n\nUse the instructions in these sections to deploy a new Azure VM by using a template with the Azure CLI. This template creates a single virtual machine in a new virtual network with a single subnet, and unlike `azure vm quick-create`, enables you to describe what you want precisely and repeat it without errors. Here's what this template creates:\n\n![](./media/virtual-machines-common-cli-deploy-templates/new-vm.png)\n\n### Step 1: Examine the JSON file for the template parameters\n\nHere are the contents of the JSON file for the template. (The template is also located in [GitHub](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-simple-linux/azuredeploy.json).)\n\nTemplates are flexible, so the designer may have chosen to give you lots of parameters or chosen to offer only a few by creating a template that is more fixed. In order to collect the information you need to pass the template as parameters, open the template file (this topic has a template inline, below) and examine the **parameters** values.\n\nIn this case, the template below will ask for:\n\n- A unique storage account name.\n- An admin user name for the VM.\n- A password.\n- A domain name for the outside world to use.\n- An Ubuntu Server version number -- but it will accept only one of a list.\n\nOnce you decide on these values, you're ready to create a group for and deploy this template into your Azure subscription.\n\n    {\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"newStorageAccountName\": {\n        \"type\": \"string\",\n        \"metadata\": {\n            \"description\": \"Unique DNS name for the storage account where the virtual machine's disks will be placed.\"\n        }\n        },\n        \"adminUsername\": {\n        \"type\": \"string\",\n        \"metadata\": {\n            \"description\": \"User name for the virtual machine.\"\n        }\n        },\n        \"adminPassword\": {\n        \"type\": \"securestring\",\n        \"metadata\": {\n            \"description\": \"Password for the virtual machine.\"\n        }\n        },\n        \"dnsNameForPublicIP\": {\n        \"type\": \"string\",\n        \"metadata\": {\n            \"description\": \"Unique DNS name for the public IP used to access the virtual machine.\"\n        }\n        },\n        \"ubuntuOSVersion\": {\n        \"type\": \"string\",\n        \"defaultValue\": \"14.04.2-LTS\",\n        \"allowedValues\": [\n            \"12.04.5-LTS\",\n            \"14.04.2-LTS\",\n            \"15.04\"\n        ],\n        \"metadata\": {\n            \"description\": \"The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values: 12.04.5-LTS, 14.04.2-LTS, 15.04.\"\n        }\n        }\n    },\n    \"variables\": {\n        \"location\": \"West US\",\n        \"imagePublisher\": \"Canonical\",\n        \"imageOffer\": \"UbuntuServer\",\n        \"OSDiskName\": \"osdiskforlinuxsimple\",\n        \"nicName\": \"myVMNic\",\n        \"addressPrefix\": \"10.0.0.0/16\",\n        \"subnetName\": \"Subnet\",\n        \"subnetPrefix\": \"10.0.0.0/24\",\n        \"storageAccountType\": \"Standard_LRS\",\n        \"publicIPAddressName\": \"myPublicIP\",\n        \"publicIPAddressType\": \"Dynamic\",\n        \"vmStorageAccountContainerName\": \"vhds\",\n        \"vmName\": \"MyUbuntuVM\",\n        \"vmSize\": \"Standard_D1\",\n        \"virtualNetworkName\": \"MyVNET\",\n        \"vnetID\": \"[resourceId('Microsoft.Network/virtualNetworks',variables('virtualNetworkName'))]\",\n        \"subnetRef\": \"[concat(variables('vnetID'),'/subnets/',variables('subnetName'))]\"\n    },\n    \"resources\": [\n        {\n        \"type\": \"Microsoft.Storage/storageAccounts\",\n        \"name\": \"[parameters('newStorageAccountName')]\",\n        \"apiVersion\": \"2015-05-01-preview\",\n        \"location\": \"[variables('location')]\",\n        \"properties\": {\n            \"accountType\": \"[variables('storageAccountType')]\"\n        }\n        },\n        {\n        \"apiVersion\": \"2015-05-01-preview\",\n        \"type\": \"Microsoft.Network/publicIPAddresses\",\n        \"name\": \"[variables('publicIPAddressName')]\",\n        \"location\": \"[variables('location')]\",\n        \"properties\": {\n            \"publicIPAllocationMethod\": \"[variables('publicIPAddressType')]\",\n            \"dnsSettings\": {\n            \"domainNameLabel\": \"[parameters('dnsNameForPublicIP')]\"\n            }\n        }\n        },\n        {\n        \"apiVersion\": \"2015-05-01-preview\",\n        \"type\": \"Microsoft.Network/virtualNetworks\",\n        \"name\": \"[variables('virtualNetworkName')]\",\n        \"location\": \"[variables('location')]\",\n        \"properties\": {\n            \"addressSpace\": {\n            \"addressPrefixes\": [\n                \"[variables('addressPrefix')]\"\n            ]\n            },\n            \"subnets\": [\n            {\n                \"name\": \"[variables('subnetName')]\",\n                \"properties\": {\n                \"addressPrefix\": \"[variables('subnetPrefix')]\"\n                }\n            }\n            ]\n        }\n        },\n        {\n        \"apiVersion\": \"2015-05-01-preview\",\n        \"type\": \"Microsoft.Network/networkInterfaces\",\n        \"name\": \"[variables('nicName')]\",\n        \"location\": \"[variables('location')]\",\n        \"dependsOn\": [\n            \"[concat('Microsoft.Network/publicIPAddresses/', variables('publicIPAddressName'))]\",\n            \"[concat('Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'))]\"\n        ],\n        \"properties\": {\n            \"ipConfigurations\": [\n            {\n                \"name\": \"ipconfig1\",\n                \"properties\": {\n                \"privateIPAllocationMethod\": \"Dynamic\",\n                \"publicIPAddress\": {\n                    \"id\": \"[resourceId('Microsoft.Network/publicIPAddresses',variables('publicIPAddressName'))]\"\n                },\n                \"subnet\": {\n                    \"id\": \"[variables('subnetRef')]\"\n                }\n                }\n            }\n            ]\n        }\n        },\n        {\n        \"apiVersion\": \"2015-05-01-preview\",\n        \"type\": \"Microsoft.Compute/virtualMachines\",\n        \"name\": \"[variables('vmName')]\",\n        \"location\": \"[variables('location')]\",\n        \"dependsOn\": [\n            \"[concat('Microsoft.Storage/storageAccounts/', parameters('newStorageAccountName'))]\",\n            \"[concat('Microsoft.Network/networkInterfaces/', variables('nicName'))]\"\n        ],\n        \"properties\": {\n            \"hardwareProfile\": {\n            \"vmSize\": \"[variables('vmSize')]\"\n            },\n            \"osProfile\": {\n            \"computername\": \"[variables('vmName')]\",\n            \"adminUsername\": \"[parameters('adminUsername')]\",\n            \"adminPassword\": \"[parameters('adminPassword')]\"\n            },\n            \"storageProfile\": {\n            \"imageReference\": {\n                \"publisher\": \"[variables('imagePublisher')]\",\n                \"offer\": \"[variables('imageOffer')]\",\n                \"sku\": \"[parameters('ubuntuOSVersion')]\",\n                \"version\": \"latest\"\n            },\n            \"osDisk\": {\n                \"name\": \"osdisk\",\n                \"vhd\": {\n                \"uri\": \"[concat('http://',parameters('newStorageAccountName'),'.blob.core.windows.net/',variables('vmStorageAccountContainerName'),'/',variables('OSDiskName'),'.vhd')]\"\n                },\n                \"caching\": \"ReadWrite\",\n                \"createOption\": \"FromImage\"\n            }\n            },\n            \"networkProfile\": {\n            \"networkInterfaces\": [\n                {\n                \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',variables('nicName'))]\"\n                }\n            ]\n            }\n        }\n        }\n    ]\n    }\n\n\n### Step 2: Create the virtual machine by using the template\n\nOnce you have your parameter values ready, you must create a resource group for your template deployment and then deploy the template.\n\nTo create the resource group, type `azure group create <group name> <location>` with the name of the group you want and the datacenter location into which you want to deploy. This happens quickly:\n\n    azure group create myResourceGroup westus\n    info:    Executing command group create\n    + Getting resource group myResourceGroup\n    + Creating resource group myResourceGroup\n    info:    Created resource group myResourceGroup\n    data:    Id:                  /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/myResourceGroup\n    data:    Name:                myResourceGroup\n    data:    Location:            westus\n    data:    Provisioning State:  Succeeded\n    data:    Tags:\n    data:\n    info:    group create command OK\n\n\nNow to create the deployment, call `azure group deployment create` and pass:\n\n- The template file (if you saved the above JSON template to a local file).\n- A template URI (if you want to point at the file in GitHub or some other web address).\n- The resource group into which you want to deploy.\n- An optional deployment name.\n\nYou will be prompted to supply the values of parameters in the \"parameters\" section of the JSON file. When you have specified all the parameter values, your deployment will begin.\n\nHere is an example:\n\n    azure group deployment create --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-simple-linux/azuredeploy.json myResourceGroup firstDeployment\n    info:    Executing command group deployment create\n    info:    Supply values for the following parameters\n    newStorageAccountName: storageaccount\n    adminUsername: ops\n    adminPassword: password\n    dnsNameForPublicIP: newdomainname\n\nYou will receive the following type of information:\n\n    + Initializing template configurations and parameters\n    + Creating a deployment\n    info:    Created template deployment \"firstDeployment\"\n    + Registering providers\n    info:    Registering provider microsoft.storage\n    info:    Registering provider microsoft.network\n    info:    Registering provider microsoft.compute\n    + Waiting for deployment to complete\n    data:    DeploymentName     : firstDeployment\n    data:    ResourceGroupName  : myResourceGroup\n    data:    ProvisioningState  : Succeeded\n    data:    Timestamp          : 2015-04-28T07:53:55.1828878Z\n    data:    Mode               : Incremental\n    data:    TemplateLink       : https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-simple-linux-vm/azuredeploy.json\n    data:    ContentVersion     : 1.0.0.0\n    data:    Name                   Type          Value\n    data:    ---------------------  ------------  -------------\n    data:    newStorageAccountName  String        storageaccount\n    data:    adminUsername          String        ops\n    data:    adminPassword          SecureString  undefined\n    data:    dnsNameForPublicIP     String        newdomainname\n    data:    ubuntuOSVersion        String        14.10\n    info:    group deployment create command OK\n\n\n\n## <a id=\"create-a-custom-vm-image\"></a>Task: Create a custom VM image\n\nYou've seen the basic usage of templates above, so now we can use similar instructions to create a custom VM from a specific .vhd file in Azure by using a template via the Azure CLI. The difference here is that this template creates a single virtual machine from a specified virtual hard disk (VHD).\n\n### Step 1: Examine the JSON file for the template\n\nHere are the contents of the JSON file for the template that this section uses as an example. (The template is also located in [GitHub](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-from-user-image/azuredeploy.json).)\n\nAgain, you will need to find the values you want to enter for the parameters that do not have default values. When you run the `azure group deployment create` command, the Azure CLI will prompt you to enter those values.\n\n    {\n        \"$schema\": \"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json\",\n        \"contentVersion\": \"1.0.0.0\",\n        \"parameters\" : {\n            \"userImageStorageAccountName\": {\n                \"type\": \"string\",\n                \"defaultValue\" : \"userImageStorageAccountName\"\n            },\n            \"userImageStorageContainerName\" : {\n                \"type\" : \"string\",\n                \"defaultValue\" : \"userImageStorageContainerName\"\n            },\n            \"userImageVhdName\" : {\n                \"type\" : \"string\",\n                \"defaultValue\" : \"userImageVhdName\"\n            },\n            \"dnsNameForPublicIP\" : {\n                \"type\" : \"string\",\n                \"defaultValue\": \"uniqueDnsNameForPublicIP\"\n            },\n            \"adminUserName\": {\n                \"type\": \"string\"\n            },\n            \"adminPassword\": {\n                \"type\": \"securestring\"\n            },\n            \"osType\" : {\n                \"type\" : \"string\",\n                \"allowedValues\" : [\n                    \"windows\",\n                    \"linux\"\n                ]\n            },\n            \"subscriptionId\":{\n                \"type\" : \"string\"\n            },\n            \"location\": {\n                \"type\": \"String\",\n                \"defaultValue\" : \"West US\"\n            },\n            \"vmSize\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"Standard_A2\"\n            },\n            \"publicIPAddressName\": {\n                \"type\": \"string\",\n                \"defaultValue\" : \"myPublicIP\"\n            },\n            \"vmName\": {\n                \"type\": \"string\",\n                \"defaultValue\" : \"myVM\"\n            },\n            \"virtualNetworkName\":{\n                \"type\" : \"string\",\n                \"defaultValue\" : \"myVNET\"\n            },\n            \"nicName\":{\n                \"type\" : \"string\",\n                \"defaultValue\":\"myNIC\"\n            }\n        },\n        \"variables\": {\n            \"addressPrefix\":\"10.0.0.0/16\",\n            \"subnet1Name\": \"Subnet-1\",\n            \"subnet2Name\": \"Subnet-2\",\n            \"subnet1Prefix\" : \"10.0.0.0/24\",\n            \"subnet2Prefix\" : \"10.0.1.0/24\",\n            \"publicIPAddressType\" : \"Dynamic\",\n            \"vnetID\":\"[resourceId('Microsoft.Network/virtualNetworks',parameters('virtualNetworkName'))]\",\n            \"subnet1Ref\" : \"[concat(variables('vnetID'),'/subnets/',variables('subnet1Name'))]\",\n            \"userImageName\" : \"[concat('http://',parameters('userImageStorageAccountName'),'.blob.core.windows.net/',parameters('userImageStorageContainerName'),'/',parameters('userImageVhdName'))]\",\n            \"osDiskVhdName\" : \"[concat('http://',parameters('userImageStorageAccountName'),'.blob.core.windows.net/',parameters('userImageStorageContainerName'),'/',parameters('vmName'),'osDisk.vhd')]\"\n        },\n        \"resources\": [\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Network/publicIPAddresses\",\n            \"name\": \"[parameters('publicIPAddressName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"publicIPAllocationMethod\": \"[variables('publicIPAddressType')]\",\n                \"dnsSettings\": {\n                    \"domainNameLabel\": \"[parameters('dnsNameForPublicIP')]\"\n                }\n            }\n        },\n        {\n          \"apiVersion\": \"2014-12-01-preview\",\n          \"type\": \"Microsoft.Network/virtualNetworks\",\n          \"name\": \"[parameters('virtualNetworkName')]\",\n          \"location\": \"[parameters('location')]\",\n          \"properties\": {\n            \"addressSpace\": {\n              \"addressPrefixes\": [\n                \"[variables('addressPrefix')]\"\n              ]\n            },\n            \"subnets\": [\n              {\n                \"name\": \"[variables('subnet1Name')]\",\n                \"properties\" : {\n                    \"addressPrefix\": \"[variables('subnet1Prefix')]\"\n                }\n              },\n              {\n                \"name\": \"[variables('subnet2Name')]\",\n                \"properties\" : {\n                    \"addressPrefix\": \"[variables('subnet2Prefix')]\"\n                }\n              }\n            ]\n          }\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Network/networkInterfaces\",\n            \"name\": \"[parameters('nicName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIPAddressName'))]\",\n                \"[concat('Microsoft.Network/virtualNetworks/', parameters('virtualNetworkName'))]\"\n            ],\n            \"properties\": {\n                \"ipConfigurations\": [\n                {\n                    \"name\": \"ipconfig1\",\n                    \"properties\": {\n                        \"privateIPAllocationMethod\": \"Dynamic\",\n                        \"publicIPAddress\": {\n                            \"id\": \"[resourceId('Microsoft.Network/publicIPAddresses',parameters('publicIPAddressName'))]\"\n                        },\n                        \"subnet\": {\n                            \"id\": \"[variables('subnet1Ref')]\"\n                        }\n                    }\n                }\n                ]\n            }\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Compute/virtualMachines\",\n            \"name\": \"[parameters('vmName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Network/networkInterfaces/', parameters('nicName'))]\"\n            ],\n            \"properties\": {\n                \"hardwareProfile\": {\n                    \"vmSize\": \"[parameters('vmSize')]\"\n                },\n                \"osProfile\": {\n                    \"computername\": \"[parameters('vmName')]\",\n                    \"adminUsername\": \"[parameters('adminUsername')]\",\n                    \"adminPassword\": \"[parameters('adminPassword')]\"\n                },\n                \"storageProfile\": {\n                    \"osDisk\" : {\n                        \"name\" : \"[concat(parameters('vmName'),'-osDisk')]\",\n                        \"osType\" : \"[parameters('osType')]\",\n                        \"caching\" : \"ReadWrite\",\n                        \"image\" : {\n                            \"uri\" : \"[variables('userImageName')]\"\n                        },\n                        \"vhd\" : {\n                            \"uri\" : \"[variables('osDiskVhdName')]\"\n                        }\n                    }\n                },\n                \"networkProfile\": {\n                    \"networkInterfaces\" : [\n                    {\n                        \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',parameters('nicName'))]\"\n                    }\n                    ]\n                }\n            }\n        }\n        ]\n    }\n\n### Step 2: Obtain the VHD\n\nObviously, you'll need a .vhd for this. You can use one you already have in Azure, or you can upload one.\n\nFor a Windows-based virtual machine, see [Create and upload a Windows Server VHD to Azure](../articles/virtual-machines/virtual-machines-windows-classic-createupload-vhd.md).\n\nFor a Linux-based virtual machine, see [Creating and uploading a virtual hard disk that contains the Linux operating system](../articles/virtual-machines/virtual-machines-linux-classic-create-upload-vhd.md).\n\n### Step 3: Create the virtual machine by using the template\n\nNow you're ready to create a new virtual machine based on the .vhd. Create a group to deploy into, by using `azure group create <location>`:\n\n    azure group create myResourceGroupUser eastus\n    info:    Executing command group create\n    + Getting resource group myResourceGroupUser\n    + Creating resource group myResourceGroupUser\n    info:    Created resource group myResourceGroupUser\n    data:    Id:                  /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/myResourceGroupUser\n    data:    Name:                myResourceGroupUser\n    data:    Location:            eastus\n    data:    Provisioning State:  Succeeded\n    data:    Tags:\n    data:\n    info:    group create command OK\n\nThen create the deployment by using the `--template-uri` option to call in the template directly (or you can use the `--template-file` option to use a file that you have saved locally). Note that because the template has defaults specified, you are prompted for only a few things. If you deploy the template in different places, you may find that some naming collisions occur with the default values (particularly the DNS name you create).\n\n    azure group deployment create \\\n    > --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-from-user-image/azuredeploy.json \\\n    > myResourceGroup \\\n    > customVhdDeployment\n    info:    Executing command group deployment create\n    info:    Supply values for the following parameters\n    adminUserName: ops\n    adminPassword: password\n    osType: linux\n    subscriptionId: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n\nOutput looks something like the following:\n\n    + Initializing template configurations and parameters\n    + Creating a deployment\n    info:    Created template deployment \"customVhdDeployment\"\n    + Registering providers\n    info:    Registering provider microsoft.network\n    info:    Registering provider microsoft.compute\n    + Waiting for deployment to complete\n    error:   Deployment provisioning state was not successful\n    data:    DeploymentName     : customVhdDeployment\n    data:    ResourceGroupName  : myResourceGroupUser\n    data:    ProvisioningState  : Succeeded\n    data:    Timestamp          : 2015-04-28T14:55:48.0963829Z\n    data:    Mode               : Incremental\n    data:    TemplateLink       : https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-from-user-image/azuredeploy.json\n    data:    ContentVersion     : 1.0.0.0\n    data:    Name                           Type          Value\n    data:    -----------------------------  ------------  ------------------------------------\n    data:    userImageStorageAccountName    String        userImageStorageAccountName\n    data:    userImageStorageContainerName  String        userImageStorageContainerName\n    data:    userImageVhdName               String        userImageVhdName\n    data:    dnsNameForPublicIP             String        uniqueDnsNameForPublicIP\n    data:    adminUserName                  String        ops\n    data:    adminPassword                  SecureString  undefined\n    data:    osType                         String        linux\n    data:    subscriptionId                 String        xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n    data:    location                       String        West US\n    data:    vmSize                         String        Standard_A2\n    data:    publicIPAddressName            String        myPublicIP\n    data:    vmName                         String        myVM\n    data:    virtualNetworkName             String        myVNET\n    data:    nicName                        String        myNIC\n    info:    group deployment create command OK\n\n\n## <a id=\"deploy-a-multi-vm-application-that-uses-a-virtual-network-and-an-external-load-balancer\"></a>Task: Deploy a multi-VM application that uses a virtual network and an external load balancer\n\nThis template allows you to create two virtual machines under a load balancer and configure a load-balancing rule on Port 80. This template also deploys a storage account, virtual network, public IP address, availability set, and network interfaces.\n\n![](./media/virtual-machines-common-cli-deploy-templates/multivmextlb.png)\n\nFollow these steps to deploy a multi-VM application that uses a virtual network and a load balancer by using a Resource Manager template in the GitHub template repository via Azure PowerShell commands.\n\n### Step 1: Examine the JSON file for the template\n\nHere are the contents of the JSON file for the template. If you want the most recent version, it's located [at the Github repository for templates](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-2-vms-loadbalancer-lbrules/azuredeploy.json). This topic uses the `--template-uri` switch to call in the template, but you can also use the `--template-file` switch to pass a local version.\n\n\n    {\n        \"$schema\": \"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json\",\n        \"contentVersion\": \"1.0.0.0\",\n        \"parameters\": {\n            \"location\": {\n                \"type\": \"string\",\n                \"metadata\": {\n                  \"description\": \"Location of resources\"\n                }\n            },\n            \"storageAccountName\": {\n                \"type\": \"string\",\n                \"metadata\": {\n                  \"description\": \"Name of storage account\"\n                }\n            },\n            \"adminUsername\": {\n                \"type\": \"string\",\n                \"metadata\": {\n                  \"description\": \"Admin user name\"\n                }\n            },\n            \"adminPassword\": {\n                \"type\": \"securestring\",\n                \"metadata\": {\n                  \"description\": \"Admin password\"\n                }\n            },\n            \"dnsNameforLBIP\": {\n                \"type\": \"string\",\n                \"metadata\": {\n                  \"description\": \"DNS for load balancer IP\"\n                }\n            },\n            \"backendPort\": {\n                \"type\": \"int\",\n                \"defaultValue\": 3389,\n                \"metadata\": {\n                  \"description\": \"Back-end port\"\n                }\n            },\n            \"vmNamePrefix\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"myVM\",\n                \"metadata\": {\n                  \"description\": \"Prefix to use for VM names\"\n                }\n            },\n            \"vmSourceImageName\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201412.01-en.us-127GB.vhd\"\n            },\n            \"lbName\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"myLB\",\n                \"metadata\": {\n                  \"description\": \"Load balancer name\"\n                }\n            },\n            \"nicNamePrefix\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"nic\",\n                \"metadata\": {\n                  \"description\": \"Network interface name prefix\"\n                }\n            },\n            \"publicIPAddressName\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"myPublicIP\",\n                \"metadata\": {\n                  \"description\": \"Public IP name\"\n                }\n            },\n            \"vnetName\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"myVNET\",\n                \"metadata\": {\n                  \"description\": \"Virtual network name\"\n                }\n            },\n            \"vmSize\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"Standard_A1\",\n                \"metadata\": {\n                  \"description\": \"Size of the VM\"\n                }\n            }\n        },\n        \"variables\": {\n            \"storageAccountType\": \"Standard_LRS\",\n            \"vmStorageAccountContainerName\": \"vhds\",\n            \"availabilitySetName\": \"myAvSet\",\n            \"addressPrefix\": \"10.0.0.0/16\",\n            \"subnetName\": \"Subnet-1\",\n            \"subnetPrefix\": \"10.0.0.0/24\",\n            \"publicIPAddressType\": \"Dynamic\",\n            \"vnetID\": \"[resourceId('Microsoft.Network/virtualNetworks',parameters('vnetName'))]\",\n            \"subnetRef\": \"[concat(variables('vnetID'),'/subnets/',variables ('subnetName'))]\",\n            \"publicIPAddressID\": \"[resourceId('Microsoft.Network/publicIPAddresses',parameters('publicIPAddressName'))]\",\n            \"lbID\": \"[resourceId('Microsoft.Network/loadBalancers',parameters('lbName'))]\",\n            \"numberOfInstances\": 2,\n            \"nicId1\": \"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'), 0))]\",\n            \"nicId2\": \"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'), 1))]\",\n            \"frontEndIPConfigID\": \"[concat(variables('lbID'),'/frontendIPConfigurations/LBFE')]\",\n            \"backEndIPConfigID1\": \"[concat(variables('nicId1'),'/ipConfigurations/ipconfig1')]\",\n            \"backEndIPConfigID2\": \"[concat(variables('nicId2'),'/ipConfigurations/ipconfig1')]\",\n            \"sourceImageName\": \"[concat('/', subscription().subscriptionId,'/services/images/',parameters('vmSourceImageName'))]\",\n            \"lbPoolID\": \"[concat(variables('lbID'),'/backendAddressPools/LBBE')]\",\n            \"lbProbeID\": \"[concat(variables('lbID'),'/probes/tcpProbe')]\"\n        },\n        \"resources\": [\n            {\n                \"type\": \"Microsoft.Storage/storageAccounts\",\n                \"name\": \"[parameters('storageAccountName')]\",\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"location\": \"[parameters('location')]\",\n                \"properties\": {\n                    \"accountType\": \"[variables('storageAccountType')]\"\n                }\n            },\n            {\n                \"type\": \"Microsoft.Compute/availabilitySets\",\n                \"name\": \"[variables('availabilitySetName')]\",\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"location\": \"[parameters('location')]\",\n                \"properties\": { }\n            },\n            {\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"type\": \"Microsoft.Network/publicIPAddresses\",\n                \"name\": \"[parameters('publicIPAddressName')]\",\n                \"location\": \"[parameters('location')]\",\n                \"properties\": {\n                    \"publicIPAllocationMethod\": \"[variables('publicIPAddressType')]\",\n                    \"dnsSettings\": {\n                        \"domainNameLabel\": \"[parameters('dnsNameforLBIP')]\"\n                    }\n                }\n            },\n            {\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"type\": \"Microsoft.Network/virtualNetworks\",\n                \"name\": \"[parameters('vnetName')]\",\n                \"location\": \"[parameters('location')]\",\n                \"properties\": {\n                    \"addressSpace\": {\n                        \"addressPrefixes\": [\n                            \"[variables('addressPrefix')]\"\n                        ]\n                    },\n                    \"subnets\": [\n                        {\n                            \"name\": \"[variables('subnetName')]\",\n                            \"properties\": {\n                                \"addressPrefix\": \"[variables('subnetPrefix')]\"\n                            }\n                        }\n                    ]\n                }\n            },\n            {\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"type\": \"Microsoft.Network/networkInterfaces\",\n                \"name\": \"[concat(parameters('nicNamePrefix'), copyindex())]\",\n                \"location\": \"[parameters('location')]\",\n                \"copy\": {\n                    \"name\": \"nicLoop\",\n                    \"count\": \"[variables('numberOfInstances')]\"\n                },\n                \"dependsOn\": [\n                    \"[concat('Microsoft.Network/virtualNetworks/', parameters('vnetName'))]\"\n                ],\n                \"properties\": {\n                    \"ipConfigurations\": [\n                        {\n                            \"name\": \"ipconfig1\",\n                            \"properties\": {\n                                \"privateIPAllocationMethod\": \"Dynamic\",\n                                \"subnet\": {\n                                    \"id\": \"[variables('subnetRef')]\"\n                                }\n                            },\n                            \"loadBalancerBackendAddressPools\": [\n                                {\n                                    \"id\": \"[concat('Microsoft.Network/loadBalancers/',parameters('lbName'),'/backendAddressPools/LBBE')]\"\n                                }\n                            ],\n                            \"loadBalancerInboundNatRules\": [\n                                {\n                                    \"id\": \"[concat('Microsoft.Network/loadBalancers/',parameters('lbName'),'/inboundNatRule/RDP-VM', copyindex())]\"\n                                }\n                            ]\n\n\n                        }\n                    ]\n\n                }\n            },\n            {\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"name\": \"[parameters('lbName')]\",\n                \"type\": \"Microsoft.Network/loadBalancers\",\n                \"location\": \"[parameters('location')]\",\n                \"dependsOn\": [\n                    \"nicLoop\",\n                    \"[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIPAddressName'))]\"\n                ],\n                \"properties\": {\n                    \"frontendIPConfigurations\": [\n                        {\n                            \"name\": \"LBFE\",\n                            \"properties\": {\n                                \"publicIPAddress\": {\n                                    \"id\": \"[variables('publicIPAddressID')]\"\n                                }\n                            }\n                        }\n                    ],\n                    \"backendAddressPools\": [\n                        {\n                            \"name\": \"LBBE\"\n\n                        }\n                    ],\n                    \"inboundNatRules\": [\n                        {\n                            \"name\": \"RDP-VM1\",\n                            \"properties\": {\n                                \"frontendIPConfiguration\":\n                                    {\n                                        \"id\": \"[variables('frontEndIPConfigID')]\"\n                                    },\n                                \"protocol\": \"tcp\",\n                                \"frontendPort\": 50001,\n                                \"backendPort\": 3389,\n                                \"enableFloatingIP\": false\n                            }\n                        },\n                        {\n                            \"name\": \"RDP-VM2\",\n                            \"properties\": {\n                                \"frontendIPConfiguration\":\n                                    {\n                                        \"id\": \"[variables('frontEndIPConfigID')]\"\n                                    },\n                                \"protocol\": \"tcp\",\n                                \"frontendPort\": 50002,\n                                \"backendPort\": 3389,\n                                \"enableFloatingIP\": false\n                            }\n                        }\n                    ],\n                    \"loadBalancingRules\": [\n                        {\n                            \"name\": \"LBRule\",\n                            \"properties\": {\n                                \"frontendIPConfiguration\": {\n                                    \"id\": \"[variables('frontEndIPConfigID')]\"\n                                },\n                                \"backendAddressPool\": {\n                                    \"id\": \"[variables('lbPoolID')]\"\n                                },\n                                \"protocol\": \"tcp\",\n                                \"frontendPort\": 80,\n                                \"backendPort\": 80,\n                                \"enableFloatingIP\": false,\n                                \"idleTimeoutInMinutes\": 5,\n                                \"probe\": {\n                                    \"id\": \"[variables('lbProbeID')]\"\n                                }\n                            }\n                        }\n                    ],\n                    \"probes\": [\n                        {\n                            \"name\": \"tcpProbe\",\n                            \"properties\": {\n                                \"protocol\": \"tcp\",\n                                \"port\": 80,\n                                \"intervalInSeconds\": \"5\",\n                                \"numberOfProbes\": \"2\"\n                            }\n                        }\n                    ]\n                }\n            },\n            {\n                \"apiVersion\": \"2015-05-01-preview\",\n                \"type\": \"Microsoft.Compute/virtualMachines\",\n                \"name\": \"[concat(parameters('vmNamePrefix'), copyindex())]\",\n                \"copy\": {\n                    \"name\": \"virtualMachineLoop\",\n                    \"count\": \"[variables('numberOfInstances')]\"\n                },\n                \"location\": \"[parameters('location')]\",\n                \"dependsOn\": [\n                    \"[concat('Microsoft.Storage/storageAccounts/', parameters('storageAccountName'))]\",\n                    \"[concat('Microsoft.Network/networkInterfaces/', parameters('nicNamePrefix'), copyindex())]\",\n                    \"[concat('Microsoft.Compute/availabilitySets/', variables('availabilitySetName'))]\"\n                ],\n                \"properties\": {\n                    \"availabilitySet\": {\n                        \"id\": \"[resourceId('Microsoft.Compute/availabilitySets',variables('availabilitySetName'))]\"\n                    },\n                    \"hardwareProfile\": {\n                        \"vmSize\": \"[parameters('vmSize')]\"\n                    },\n                    \"osProfile\": {\n                        \"computername\": \"[concat(parameters('vmNamePrefix'), copyIndex())]\",\n                        \"adminUsername\": \"[parameters('adminUsername')]\",\n                        \"adminPassword\": \"[parameters('adminPassword')]\"\n                    },\n                    \"storageProfile\": {\n                        \"sourceImage\": {\n                            \"id\": \"[variables('sourceImageName')]\"\n                        },\n                        \"destinationVhdsContainer\": \"[concat('http://',parameters('storageAccountName'),'.blob.core.windows.net/',variables('vmStorageAccountContainerName'),'/')]\"\n                    },\n                    \"networkProfile\": {\n                        \"networkInterfaces\": [\n                            {\n                                \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'),copyindex()))]\"\n                            }\n                        ]\n                    }\n                }\n            }\n        ]\n    }\n\n### Step 2: Create the deployment by using the template\n\nCreate a resource group for the template by using `azure group create <location>`. Then, create a deployment into that resource group by using `azure group deployment create` and passing the resource group, passing a deployment name, and answering the prompts for parameters in the template that did not have default values.\n\n\n    azure group create lbgroup westus\n    info:    Executing command group create\n    + Getting resource group lbgroup\n    + Creating resource group lbgroup\n    info:    Created resource group lbgroup\n    data:    Id:                  /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/lbgroup\n    data:    Name:                lbgroup\n    data:    Location:            westus\n    data:    Provisioning State:  Succeeded\n    data:    Tags:\n    data:\n    info:    group create command OK\n\n\nNow use the `azure group deployment create` command and the `--template-uri` option to deploy the template. Be ready with your parameter values when it prompts you, as shown below.\n\n    azure group deployment create \\\n    > --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-2-vms-loadbalancer-lbrules/azuredeploy.json \\\n    > lbgroup \\\n    > newdeployment\n    info:    Executing command group deployment create\n    info:    Supply values for the following parameters\n    location: westus\n    newStorageAccountName: storagename\n    adminUsername: ops\n    adminPassword: password\n    dnsNameforLBIP: lbdomainname\n    + Initializing template configurations and parameters\n    + Creating a deployment\n    info:    Created template deployment \"newdeployment\"\n    + Registering providers\n    info:    Registering provider microsoft.storage\n    info:    Registering provider microsoft.compute\n    info:    Registering provider microsoft.network\n    + Waiting for deployment to complete\n    data:    DeploymentName     : newdeployment\n    data:    ResourceGroupName  : lbgroup\n    data:    ProvisioningState  : Succeeded\n    data:    Timestamp          : 2015-04-28T20:58:40.1678876Z\n    data:    Mode               : Incremental\n    data:    TemplateLink       : https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-2-vms-loadbalancer-lbrules/azuredeploy.json\n    data:    ContentVersion     : 1.0.0.0\n    data:    Name                   Type          Value\n    data:    ---------------------  ------------  ----------------------\n    data:    location               String        westus\n    data:    newStorageAccountName  String        storagename\n    data:    adminUsername          String        ops\n    data:    adminPassword          SecureString  undefined\n    data:    dnsNameforLBIP         String        lbdomainname\n    data:    backendPort            Int           3389\n    data:    vmNamePrefix           String        myVM\n    data:    imagePublisher         String        MicrosoftWindowsServer\n    data:    imageOffer             String        WindowsServer\n    data:    imageSKU               String        2012-R2-Datacenter\n    data:    lbName                 String        myLB\n    data:    nicNamePrefix          String        nic\n    data:    publicIPAddressName    String        myPublicIP\n    data:    vnetName               String        myVNET\n    data:    vmSize                 String        Standard_A1\n    info:    group deployment create command OK\n\nNote that this template deploys a Windows Server image; however, it could easily be replaced by any Linux image. Want to create a Docker cluster with multiple swarm managers? [You can do it](https://azure.microsoft.com/documentation/templates/docker-swarm-cluster/).\n\n## <a id=\"remove-a-resource-group\"></a>Task: Remove a resource group\n\nRemember that you can redeploy to a resource group, but if you are done with one, you can delete it by using `azure group delete <group name>`.\n\n    azure group delete myResourceGroup\n    info:    Executing command group delete\n    Delete resource group myResourceGroup? [y/n] y\n    + Deleting resource group myResourceGroup\n    info:    group delete command OK\n\n## <a id=\"show-the-log-for-a-resource-group-deployment\"></a>Task: Show the log for a resource group deployment\n\nThis one is common while you're creating or using templates. The call to display the deployment logs for a group is `azure group log show <groupname>`, which displays quite a bit of information that's useful for understanding why something happened -- or didn't. (For more information on troubleshooting your deployments, as well as other information about issues, see [Troubleshooting resource group deployments in Azure](../articles/resource-manager-troubleshoot-deployments-cli.md).)\n\nTo target specific failures, for example, you might use tools like **jq** to query things a bit more precisely, such as which individual failures you need to correct. The following example uses **jq** to parse a deployment log for **lbgroup**, looking for failures.\n\n    azure group log show lbgroup -l --json | jq '.[] | select(.status.value == \"Failed\") | .properties'\n\nYou can discover very quickly what went wrong, fix, and retry. In the following case, the template had been creating two VMs at the same time, which created a lock on the .vhd. (After we modified the template, the deployment succeeded quickly.)\n\n    {\n      \"statusCode\": \"Conflict\",\n      \"statusMessage\": \"{\\\"status\\\":\\\"Failed\\\",\\\"error\\\":{\\\"code\\\":\\\"ResourceDeploymentFailure\\\",\\\"message\\\":\\\"The resource operation completed with terminal provisioning state 'Failed'.\\\",\\\"details\\\":[{\\\"code\\\":\\\"AcquireDiskLeaseFailed\\\",\\\"message\\\":\\\"Failed to acquire lease while creating disk 'osdisk' using blob with URI http://storage.blob.core.windows.net/vhds/osdisk.vhd.\\\"}]}}\"\n    }\n\n\n## <a id=\"display-information-about-a-virtual-machine\"></a>Task: Display information about a virtual machine\n\nYou can see information about specific VMs in your resource group by using the `azure vm show <groupname> <vmname>` command. If you have more than one VM in your group, you might first need to list the VMs in a group by using `azure vm list <groupname>`.\n\n    azure vm list zoo\n    info:    Executing command vm list\n    + Getting virtual machines\n    data:    Name   ProvisioningState  Location  Size\n    data:    -----  -----------------  --------  -----------\n    data:    myVM0  Succeeded          westus    Standard_A1\n    data:    myVM1  Failed             westus    Standard_A1\n\nAnd then, looking up myVM1:\n\n    azure vm show zoo myVM1\n    info:    Executing command vm show\n    + Looking up the VM \"myVM1\"\n    + Looking up the NIC \"nic1\"\n    data:    Id                              :/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zoo/providers/Microsoft.Compute/virtualMachines/myVM1\n    data:    ProvisioningState               :Failed\n    data:    Name                            :myVM1\n    data:    Location                        :westus\n    data:    Type                            :Microsoft.Compute/virtualMachines\n    data:\n    data:    Hardware Profile:\n    data:      Size                          :Standard_A1\n    data:\n    data:    Storage Profile:\n    data:      Image reference:\n    data:        Publisher                   :MicrosoftWindowsServer\n    data:        Offer                       :WindowsServer\n    data:        Sku                         :2012-R2-Datacenter\n    data:        Version                     :latest\n    data:\n    data:      OS Disk:\n    data:        OSType                      :Windows\n    data:        Name                        :osdisk\n    data:        Caching                     :ReadWrite\n    data:        CreateOption                :FromImage\n    data:        Vhd:\n    data:          Uri                       :http://zoostorageralph.blob.core.windows.net/vhds/osdisk.vhd\n    data:\n    data:    OS Profile:\n    data:      Computer Name                 :myVM1\n    data:      User Name                     :ops\n    data:      Windows Configuration:\n    data:        Provision VM Agent          :true\n    data:        Enable automatic updates    :true\n    data:\n    data:    Network Profile:\n    data:      Network Interfaces:\n    data:        Network Interface #1:\n    data:          Id                        :/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zoo/providers/Microsoft.Network/networkInterfaces/nic1\n    data:          Primary                   :false\n    data:          Provisioning State        :Succeeded\n    data:          Name                      :nic1\n    data:          Location                  :westus\n    data:            Private IP alloc-method :Dynamic\n    data:            Private IP address      :10.0.0.5\n    data:\n    data:    AvailabilitySet:\n    data:      Id                            :/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zoo/providers/Microsoft.Compute/availabilitySets/MYAVSET\n    info:    vm show command OK\n\n\n> [AZURE.NOTE] If you want to programmatically store and manipulate the output of your console commands, you may want to use a JSON parsing tool such as **[jq](https://github.com/stedolan/jq)** or **[jsawk](https://github.com/micha/jsawk)**, or language libraries that are good for the task.\n\n## <a id=\"log-on-to-a-linux-based-virtual-machine\"></a>Task: Log on to a Linux-based virtual machine\n\nTypically Linux machines are connected to through SSH. For more information, see [How to use SSH with Linux on Azure](../articles/virtual-machines/virtual-machines-linux-ssh-from-linux.md).\n\n## <a id=\"stop-a-virtual-machine\"></a>Task: Stop a VM\n\nRun this command:\n\n    azure vm stop <group name> <virtual machine name>\n\n>[AZURE.IMPORTANT] Use this parameter to keep the virtual IP (VIP) of the vnet in case it's the last VM in that vnet. <br><br> If you use the `StayProvisioned` parameter, you'll still be billed for the VM.\n\n## <a id=\"start-a-virtual-machine\"></a>Task: Start a VM\n\nRun this command:\n\n    azure vm start <group name> <virtual machine name>\n\n## <a id=\"attach-a-data-disk\"></a>Task: Attach a data disk\n\nYou'll also need to decide whether to attach a new disk or one that contains data. For a new disk, the command creates the .vhd file and attaches it in the same command.\n\nTo attach a new disk, run this command:\n\n     azure vm disk attach-new <resource-group> <vm-name> <size-in-gb>\n\nTo attach an existing data disk, run this command:\n\n    azure vm disk attach <resource-group> <vm-name> [vhd-url]\n\nThen you'll need to mount the disk, as you normally would in Linux.\n\n\n## Next steps\n\nFor far more examples of Azure CLI usage with the **arm** mode, see [Using the Azure CLI for Mac, Linux, and Windows with Azure Resource Manager](../articles/xplat-cli-azure-resource-manager.md). To learn more about Azure resources and their concepts, see [Azure Resource Manager overview](../articles/resource-group-overview.md).\n\n\nFor more templates you can use, see [Azure Quickstart templates](https://azure.microsoft.com/documentation/templates/) and [Application frameworks using templates](../articles/virtual-machines/virtual-machines-linux-app-frameworks.md).\n\n"
}