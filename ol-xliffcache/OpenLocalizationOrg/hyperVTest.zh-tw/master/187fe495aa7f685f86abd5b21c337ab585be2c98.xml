{
  "nodes": [
    {
      "pos": [
        23,
        129
      ],
      "content": "Use SSH Tunneling to access Ambari web UI, ResourceManager, JobHistory, NameNode, Oozie and other web UI's"
    },
    {
      "pos": [
        144,
        251
      ],
      "content": "Learn how to use an SSH tunnel to securely browse web resources hosted on your Linux-based HDInsight nodes."
    },
    {
      "pos": [
        508,
        615
      ],
      "content": "Use SSH Tunneling to access Ambari web UI, ResourceManager, JobHistory, NameNode, Oozie, and other web UI's"
    },
    {
      "pos": [
        617,
        905
      ],
      "content": "Linux-based HDInsight clusters provide access to Ambari web UI over the Internet, but some features of the UI are not. For example, the web UI for other services that are surfaced through Ambari. For full functionality of the Ambari web UI, you must use an SSH tunnel to the cluster head.",
      "nodes": [
        {
          "content": "Linux-based HDInsight clusters provide access to Ambari web UI over the Internet, but some features of the UI are not.",
          "pos": [
            0,
            118
          ]
        },
        {
          "content": "For example, the web UI for other services that are surfaced through Ambari.",
          "pos": [
            119,
            195
          ]
        },
        {
          "content": "For full functionality of the Ambari web UI, you must use an SSH tunnel to the cluster head.",
          "pos": [
            196,
            288
          ]
        }
      ]
    },
    {
      "pos": [
        909,
        937
      ],
      "content": "What requires an SSH tunnel?"
    },
    {
      "pos": [
        939,
        1301
      ],
      "content": "Several of the menus in Ambari will not fully populate without an SSH tunnel, as they rely on web sites and services exposed by other Hadoop services running on the cluster. Often, these web sites are not secured, so it is not safe to directly expose them on the internet. Sometimes the service runs the web site on another cluster node such as a Zookeeper node.",
      "nodes": [
        {
          "content": "Several of the menus in Ambari will not fully populate without an SSH tunnel, as they rely on web sites and services exposed by other Hadoop services running on the cluster.",
          "pos": [
            0,
            173
          ]
        },
        {
          "content": "Often, these web sites are not secured, so it is not safe to directly expose them on the internet.",
          "pos": [
            174,
            272
          ]
        },
        {
          "content": "Sometimes the service runs the web site on another cluster node such as a Zookeeper node.",
          "pos": [
            273,
            362
          ]
        }
      ]
    },
    {
      "pos": [
        1303,
        1401
      ],
      "content": "The following are services that Ambari web UI uses, that cannot be accessed without an SSH tunnel:"
    },
    {
      "pos": [
        1405,
        1421
      ],
      "content": "ResourceManager,"
    },
    {
      "pos": [
        1424,
        1435
      ],
      "content": "JobHistory,"
    },
    {
      "pos": [
        1438,
        1447
      ],
      "content": "NameNode,"
    },
    {
      "pos": [
        1450,
        1464
      ],
      "content": "Thread Stacks,"
    },
    {
      "pos": [
        1467,
        1479
      ],
      "content": "Oozie web UI"
    },
    {
      "pos": [
        1482,
        1506
      ],
      "content": "HBase Master and Logs UI"
    },
    {
      "pos": [
        1508,
        1760
      ],
      "content": "If you use Script Actions to customize your cluster, any services or utilities that you install that expose a web UI will require an SSH tunnel. For example, if you install Hue using a Script Action, you must use an SSH tunnel to access the Hue web UI.",
      "nodes": [
        {
          "content": "If you use Script Actions to customize your cluster, any services or utilities that you install that expose a web UI will require an SSH tunnel.",
          "pos": [
            0,
            144
          ]
        },
        {
          "content": "For example, if you install Hue using a Script Action, you must use an SSH tunnel to access the Hue web UI.",
          "pos": [
            145,
            252
          ]
        }
      ]
    },
    {
      "pos": [
        1764,
        1786
      ],
      "content": "What is an SSH tunnel?"
    },
    {
      "pos": [
        1788,
        2157
      ],
      "content": "<bpt id=\"p1\">[</bpt>Secure Shell (SSH) tunneling<ept id=\"p1\">](https://en.wikipedia.org/wiki/Tunneling_protocol#Secure_Shell_tunneling)</ept><ph id=\"ph2\"/> routes traffic sent to a port on your local workstation, through an SSH connection to your HDInsight cluster head node, where the request is then resolved as if it originated on the head node. The response is then routed back through the tunnel to your workstation.",
      "nodes": [
        {
          "content": "<bpt id=\"p1\">[</bpt>Secure Shell (SSH) tunneling<ept id=\"p1\">](https://en.wikipedia.org/wiki/Tunneling_protocol#Secure_Shell_tunneling)</ept><ph id=\"ph2\"/> routes traffic sent to a port on your local workstation, through an SSH connection to your HDInsight cluster head node, where the request is then resolved as if it originated on the head node.",
          "pos": [
            0,
            348
          ]
        },
        {
          "content": "The response is then routed back through the tunnel to your workstation.",
          "pos": [
            349,
            421
          ]
        }
      ]
    },
    {
      "pos": [
        2161,
        2174
      ],
      "content": "Prerequisites"
    },
    {
      "pos": [
        2176,
        2246
      ],
      "content": "When using an SSH tunnel for web traffic, you must have the following:"
    },
    {
      "pos": [
        2250,
        2472
      ],
      "content": "An SSH client. For Linux and Unix distributions or Macintosh OS X, the <ph id=\"ph3\">`ssh`</ph><ph id=\"ph4\"/> command is provided with the operating system. For Windows, we recommend <bpt id=\"p2\">[</bpt>PuTTY<ept id=\"p2\">](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)</ept>",
      "nodes": [
        {
          "content": "An SSH client.",
          "pos": [
            0,
            14
          ]
        },
        {
          "content": "For Linux and Unix distributions or Macintosh OS X, the <ph id=\"ph3\">`ssh`</ph><ph id=\"ph4\"/> command is provided with the operating system.",
          "pos": [
            15,
            155
          ]
        },
        {
          "content": "For Windows, we recommend <bpt id=\"p2\">[</bpt>PuTTY<ept id=\"p2\">](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)</ept>",
          "pos": [
            156,
            292
          ]
        }
      ]
    },
    {
      "pos": [
        2480,
        2636
      ],
      "content": "<ph id=\"ph5\">[AZURE.NOTE]</ph><ph id=\"ph6\"/> If you want to use an SSH client other than <ph id=\"ph7\">`ssh`</ph><ph id=\"ph8\"/> or PuTTY, please consult the documentation for your client on how to establish an SSH tunnel."
    },
    {
      "pos": [
        2640,
        2697
      ],
      "content": "A web browser that can be configured to use a SOCKS proxy"
    },
    {
      "pos": [
        2701,
        2847
      ],
      "content": "<bpt id=\"p3\">__</bpt>(optional)<ept id=\"p3\">__</ept>: A plugin such as <bpt id=\"p4\">[</bpt>FoxyProxy<ept id=\"p4\">](http://getfoxyproxy.org/,)</ept><ph id=\"ph9\"/> that can apply rules that only route specific requests through the tunnel."
    },
    {
      "pos": [
        2855,
        3042
      ],
      "content": "<ph id=\"ph10\">[AZURE.WARNING]</ph><ph id=\"ph11\"/> Without a plugin such as FoxyProxy, all requests made through the browser may be routed through the tunnel. This can result in slower loading of web pages in your browser.",
      "nodes": [
        {
          "content": "<ph id=\"ph10\">[AZURE.WARNING]</ph><ph id=\"ph11\"/> Without a plugin such as FoxyProxy, all requests made through the browser may be routed through the tunnel.",
          "pos": [
            0,
            157
          ]
        },
        {
          "content": "This can result in slower loading of web pages in your browser.",
          "pos": [
            158,
            221
          ]
        }
      ]
    },
    {
      "pos": [
        3044,
        3046
      ],
      "content": "##"
    },
    {
      "pos": [
        3067,
        3104
      ],
      "content": "Create a tunnel using the SSH command"
    },
    {
      "pos": [
        3106,
        3314
      ],
      "content": "Use the following command to create an SSH tunnel using the <ph id=\"ph12\">`ssh`</ph><ph id=\"ph13\"/> command. Replace <bpt id=\"p5\">__</bpt>USERNAME<ept id=\"p5\">__</ept><ph id=\"ph14\"/> with an SSH user for your HDInsight cluster, and replace <bpt id=\"p6\">__</bpt>CLUSTERNAME<ept id=\"p6\">__</ept><ph id=\"ph15\"/> with the name of your HDInsight cluster",
      "nodes": [
        {
          "content": "Use the following command to create an SSH tunnel using the <ph id=\"ph12\">`ssh`</ph><ph id=\"ph13\"/> command.",
          "pos": [
            0,
            108
          ]
        },
        {
          "content": "Replace <bpt id=\"p5\">__</bpt>USERNAME<ept id=\"p5\">__</ept><ph id=\"ph14\"/> with an SSH user for your HDInsight cluster, and replace <bpt id=\"p6\">__</bpt>CLUSTERNAME<ept id=\"p6\">__</ept><ph id=\"ph15\"/> with the name of your HDInsight cluster",
          "pos": [
            109,
            348
          ]
        }
      ]
    },
    {
      "pos": [
        3386,
        3492
      ],
      "content": "This creates a connection that routes traffic to local port 9876 to the cluster over SSH. The options are:",
      "nodes": [
        {
          "content": "This creates a connection that routes traffic to local port 9876 to the cluster over SSH.",
          "pos": [
            0,
            89
          ]
        },
        {
          "content": "The options are:",
          "pos": [
            90,
            106
          ]
        }
      ]
    },
    {
      "pos": [
        3496,
        3567
      ],
      "content": "<bpt id=\"p7\">**</bpt>D 9876<ept id=\"p7\">**</ept><ph id=\"ph16\"/> - The local port that will route traffic through the tunnel."
    },
    {
      "pos": [
        3571,
        3633
      ],
      "content": "<bpt id=\"p8\">**</bpt>C<ept id=\"p8\">**</ept><ph id=\"ph17\"/> - Compress all data, because web traffic is mostly text."
    },
    {
      "pos": [
        3637,
        3686
      ],
      "content": "<bpt id=\"p9\">**</bpt>2<ept id=\"p9\">**</ept><ph id=\"ph18\"/> - Force SSH to try protocol version 2 only."
    },
    {
      "pos": [
        3690,
        3709
      ],
      "content": "<bpt id=\"p10\">**</bpt>q<ept id=\"p10\">**</ept><ph id=\"ph19\"/> - Quiet mode."
    },
    {
      "pos": [
        3713,
        3788
      ],
      "content": "<bpt id=\"p11\">**</bpt>T<ept id=\"p11\">**</ept><ph id=\"ph20\"/> - Disable pseudo-tty allocation, since we are just forwarding a port."
    },
    {
      "pos": [
        3792,
        3862
      ],
      "content": "<bpt id=\"p12\">**</bpt>n<ept id=\"p12\">**</ept><ph id=\"ph21\"/> - Prevent reading of STDIN, since we are just forwarding a port."
    },
    {
      "pos": [
        3866,
        3943
      ],
      "content": "<bpt id=\"p13\">**</bpt>N<ept id=\"p13\">**</ept><ph id=\"ph22\"/> - Do not execute a remote command, since we are just forwarding a port."
    },
    {
      "pos": [
        3947,
        3977
      ],
      "content": "<bpt id=\"p14\">**</bpt>f<ept id=\"p14\">**</ept><ph id=\"ph23\"/> - Run in the background."
    },
    {
      "pos": [
        3979,
        4106
      ],
      "content": "If you configured the cluster with an SSH key, you may need use the <ph id=\"ph24\">`-i`</ph><ph id=\"ph25\"/> parameter and specify the path to the private SSH key."
    },
    {
      "pos": [
        4108,
        4285
      ],
      "content": "Once the command finishes, traffic sent to port 9876 on the local computer will be routed over Secure Sockets Layer (SSL) to the cluster head node and appear to originate there."
    },
    {
      "pos": [
        4287,
        4289
      ],
      "content": "##"
    },
    {
      "pos": [
        4312,
        4339
      ],
      "content": "Create a tunnel using PuTTY"
    },
    {
      "pos": [
        4341,
        4401
      ],
      "content": "Use the following steps to create an SSH tunnel using PuTTY."
    },
    {
      "pos": [
        4406,
        4648
      ],
      "content": "Open PuTTY, and enter your connection information. If you are not familiar with PuTTY, see <bpt id=\"p15\">[</bpt>Use SSH with Linux-based Hadoop on HDInsight from Windows<ept id=\"p15\">](hdinsight-hadoop-linux-use-ssh-windows.md)</ept><ph id=\"ph26\"/> for information on how to use it with HDInsight.",
      "nodes": [
        {
          "content": "Open PuTTY, and enter your connection information.",
          "pos": [
            0,
            50
          ]
        },
        {
          "content": "If you are not familiar with PuTTY, see <bpt id=\"p15\">[</bpt>Use SSH with Linux-based Hadoop on HDInsight from Windows<ept id=\"p15\">](hdinsight-hadoop-linux-use-ssh-windows.md)</ept><ph id=\"ph26\"/> for information on how to use it with HDInsight.",
          "pos": [
            51,
            297
          ]
        }
      ]
    },
    {
      "pos": [
        4653,
        4775
      ],
      "content": "In the <bpt id=\"p16\">**</bpt>Category<ept id=\"p16\">**</ept><ph id=\"ph27\"/> section to the left of the dialog, expand <bpt id=\"p17\">**</bpt>Connection<ept id=\"p17\">**</ept>, expand <bpt id=\"p18\">**</bpt>SSH<ept id=\"p18\">**</ept>, and then select <bpt id=\"p19\">**</bpt>Tunnels<ept id=\"p19\">**</ept>."
    },
    {
      "pos": [
        4780,
        4870
      ],
      "content": "Provide the following information on the <bpt id=\"p20\">**</bpt>Options controlling SSH port forwarding<ept id=\"p20\">**</ept><ph id=\"ph28\"/> form:"
    },
    {
      "pos": [
        4878,
        4967
      ],
      "content": "<bpt id=\"p21\">**</bpt>Source port<ept id=\"p21\">**</ept><ph id=\"ph29\"/> - The port on the client that you wish to forward. For example, <bpt id=\"p22\">**</bpt>9876<ept id=\"p22\">**</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p21\">**</bpt>Source port<ept id=\"p21\">**</ept><ph id=\"ph29\"/> - The port on the client that you wish to forward.",
          "pos": [
            0,
            121
          ]
        },
        {
          "content": "For example, <bpt id=\"p22\">**</bpt>9876<ept id=\"p22\">**</ept>.",
          "pos": [
            122,
            184
          ]
        }
      ]
    },
    {
      "pos": [
        4975,
        5098
      ],
      "content": "<bpt id=\"p23\">**</bpt>Destination<ept id=\"p23\">**</ept><ph id=\"ph30\"/> - The SSH address for the Linux-based HDInsight cluster. For example, <bpt id=\"p24\">**</bpt>mycluster-ssh.azurehdinsight.net<ept id=\"p24\">**</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p23\">**</bpt>Destination<ept id=\"p23\">**</ept><ph id=\"ph30\"/> - The SSH address for the Linux-based HDInsight cluster.",
          "pos": [
            0,
            127
          ]
        },
        {
          "content": "For example, <bpt id=\"p24\">**</bpt>mycluster-ssh.azurehdinsight.net<ept id=\"p24\">**</ept>.",
          "pos": [
            128,
            218
          ]
        }
      ]
    },
    {
      "pos": [
        5106,
        5156
      ],
      "content": "<bpt id=\"p25\">**</bpt>Dynamic<ept id=\"p25\">**</ept><ph id=\"ph31\"/> - Enables dynamic SOCKS proxy routing."
    },
    {
      "pos": [
        5162,
        5250
      ],
      "content": "<ph id=\"ph32\">![</ph>image of tunneling options<ph id=\"ph33\">](./media/hdinsight-linux-ambari-ssh-tunnel/puttytunnel.png)</ph>"
    },
    {
      "pos": [
        5255,
        5340
      ],
      "content": "Click <bpt id=\"p26\">**</bpt>Add<ept id=\"p26\">**</ept><ph id=\"ph34\"/> to add the settings, and then click <bpt id=\"p27\">**</bpt>Open<ept id=\"p27\">**</ept><ph id=\"ph35\"/> to open an SSH connection."
    },
    {
      "pos": [
        5345,
        5439
      ],
      "content": "When prompted, log in to the server. This will establish an SSH session and enable the tunnel.",
      "nodes": [
        {
          "content": "When prompted, log in to the server.",
          "pos": [
            0,
            36
          ]
        },
        {
          "content": "This will establish an SSH session and enable the tunnel.",
          "pos": [
            37,
            94
          ]
        }
      ]
    },
    {
      "pos": [
        5443,
        5475
      ],
      "content": "Use the tunnel from your browser"
    },
    {
      "pos": [
        5479,
        5807
      ],
      "content": "<ph id=\"ph36\">[AZURE.NOTE]</ph><ph id=\"ph37\"/> The steps in this section use the FireFox browser, as it is freely available for Linux, Unix, Macintosh OS X and Windows systems. Other modern browsers such as Google Chrome, Microsoft Edge, or Apple Safari should work as well; however, the FoxyProxy plugin used in some steps may not be available for all browsers.",
      "nodes": [
        {
          "content": "<ph id=\"ph36\">[AZURE.NOTE]</ph><ph id=\"ph37\"/> The steps in this section use the FireFox browser, as it is freely available for Linux, Unix, Macintosh OS X and Windows systems.",
          "pos": [
            0,
            176
          ]
        },
        {
          "content": "Other modern browsers such as Google Chrome, Microsoft Edge, or Apple Safari should work as well; however, the FoxyProxy plugin used in some steps may not be available for all browsers.",
          "pos": [
            177,
            362
          ]
        }
      ]
    },
    {
      "pos": [
        5812,
        6005
      ],
      "content": "Configure the browser to use <bpt id=\"p28\">**</bpt>localhost:9876<ept id=\"p28\">**</ept><ph id=\"ph38\"/> as a <bpt id=\"p29\">**</bpt>SOCKS v5<ept id=\"p29\">**</ept><ph id=\"ph39\"/> proxy. Here's what the Firefox settings look like. If you used a different port than 9876, change the port to the one you used:",
      "nodes": [
        {
          "content": "Configure the browser to use <bpt id=\"p28\">**</bpt>localhost:9876<ept id=\"p28\">**</ept><ph id=\"ph38\"/> as a <bpt id=\"p29\">**</bpt>SOCKS v5<ept id=\"p29\">**</ept><ph id=\"ph39\"/> proxy.",
          "pos": [
            0,
            182
          ]
        },
        {
          "content": "Here's what the Firefox settings look like.",
          "pos": [
            183,
            226
          ]
        },
        {
          "content": "If you used a different port than 9876, change the port to the one you used:",
          "pos": [
            227,
            303
          ]
        }
      ]
    },
    {
      "pos": [
        6011,
        6092
      ],
      "content": "<ph id=\"ph40\">![</ph>image of Firefox settings<ph id=\"ph41\">](./media/hdinsight-linux-ambari-ssh-tunnel/socks.png)</ph>"
    },
    {
      "pos": [
        6100,
        6269
      ],
      "content": "<ph id=\"ph42\">[AZURE.NOTE]</ph><ph id=\"ph43\"/> Selecting <bpt id=\"p30\">**</bpt>Remote DNS<ept id=\"p30\">**</ept><ph id=\"ph44\"/> will resolve Domain Name System (DNS) requests by using the HDInsight cluster. If this is unselected, DNS will be resolved locally.",
      "nodes": [
        {
          "content": "<ph id=\"ph42\">[AZURE.NOTE]</ph><ph id=\"ph43\"/> Selecting <bpt id=\"p30\">**</bpt>Remote DNS<ept id=\"p30\">**</ept><ph id=\"ph44\"/> will resolve Domain Name System (DNS) requests by using the HDInsight cluster.",
          "pos": [
            0,
            205
          ]
        },
        {
          "content": "If this is unselected, DNS will be resolved locally.",
          "pos": [
            206,
            258
          ]
        }
      ]
    },
    {
      "pos": [
        6274,
        6571
      ],
      "content": "Verify that traffic is being routed through the tunnel by vising a site such as <bpt id=\"p31\">[</bpt>http://www.whatismyip.com/<ept id=\"p31\">](http://www.whatismyip.com/)</ept><ph id=\"ph45\"/> with the proxy settings enabled and disabled in Firefox. While the settings are enabled, the IP address will be for a machine in the Microsoft Azure datacenter.",
      "nodes": [
        {
          "content": "Verify that traffic is being routed through the tunnel by vising a site such as <bpt id=\"p31\">[</bpt>http://www.whatismyip.com/<ept id=\"p31\">](http://www.whatismyip.com/)</ept><ph id=\"ph45\"/> with the proxy settings enabled and disabled in Firefox.",
          "pos": [
            0,
            248
          ]
        },
        {
          "content": "While the settings are enabled, the IP address will be for a machine in the Microsoft Azure datacenter.",
          "pos": [
            249,
            352
          ]
        }
      ]
    },
    {
      "pos": [
        6576,
        6594
      ],
      "content": "Browser extensions"
    },
    {
      "pos": [
        6596,
        6923
      ],
      "content": "While configuring the browser to use the tunnel works, you don't usually want to route all traffic over the tunnel. Browser extensions such as <bpt id=\"p32\">[</bpt>FoxyProxy<ept id=\"p32\">](http://getfoxyproxy.org/)</ept><ph id=\"ph46\"/> support pattern matching for URL requests (FoxyProxy Standard or Plus only), so that only requests for specific URLs will be sent over the tunnel.",
      "nodes": [
        {
          "content": "While configuring the browser to use the tunnel works, you don't usually want to route all traffic over the tunnel.",
          "pos": [
            0,
            115
          ]
        },
        {
          "content": "Browser extensions such as <bpt id=\"p32\">[</bpt>FoxyProxy<ept id=\"p32\">](http://getfoxyproxy.org/)</ept><ph id=\"ph46\"/> support pattern matching for URL requests (FoxyProxy Standard or Plus only), so that only requests for specific URLs will be sent over the tunnel.",
          "pos": [
            116,
            382
          ]
        }
      ]
    },
    {
      "pos": [
        6925,
        7061
      ],
      "content": "If you have installed FoxyProxy Standard, use the following steps to configure it to only forward traffic for HDInsight over the tunnel."
    },
    {
      "pos": [
        7066,
        7189
      ],
      "content": "Open the FoxyProxy extension in your browser. For example, in Firefox, select the FoxyProxy icon next to the address field.",
      "nodes": [
        {
          "content": "Open the FoxyProxy extension in your browser.",
          "pos": [
            0,
            45
          ]
        },
        {
          "content": "For example, in Firefox, select the FoxyProxy icon next to the address field.",
          "pos": [
            46,
            123
          ]
        }
      ]
    },
    {
      "pos": [
        7195,
        7269
      ],
      "content": "<ph id=\"ph47\">![</ph>foxyproxy icon<ph id=\"ph48\">](./media/hdinsight-linux-ambari-ssh-tunnel/foxyproxy.png)</ph>"
    },
    {
      "pos": [
        7274,
        7378
      ],
      "content": "Select <bpt id=\"p33\">**</bpt>Add New Proxy<ept id=\"p33\">**</ept>, select the <bpt id=\"p34\">**</bpt>General<ept id=\"p34\">**</ept><ph id=\"ph49\"/> tab, and then enter a proxy name of <bpt id=\"p35\">**</bpt>HDInsightProxy<ept id=\"p35\">**</ept>."
    },
    {
      "pos": [
        7384,
        7463
      ],
      "content": "<ph id=\"ph50\">![</ph>foxyproxy general<ph id=\"ph51\">](./media/hdinsight-linux-ambari-ssh-tunnel/foxygeneral.png)</ph>"
    },
    {
      "pos": [
        7468,
        7535
      ],
      "content": "Select the <bpt id=\"p36\">**</bpt>Proxy Details<ept id=\"p36\">**</ept><ph id=\"ph52\"/> tab and populate the following fields:"
    },
    {
      "pos": [
        7543,
        7641
      ],
      "content": "<bpt id=\"p37\">**</bpt>Host or IP Address<ept id=\"p37\">**</ept><ph id=\"ph53\"/> - This is localhost, since we are using an SSH tunnel on the local machine."
    },
    {
      "pos": [
        7649,
        7705
      ],
      "content": "<bpt id=\"p38\">**</bpt>Port<ept id=\"p38\">**</ept><ph id=\"ph54\"/> - This is the port you used for the SSH tunnel."
    },
    {
      "pos": [
        7713,
        7794
      ],
      "content": "<bpt id=\"p39\">**</bpt>SOCKS proxy<ept id=\"p39\">**</ept><ph id=\"ph55\"/> - Select this to enable the browser to use the tunnel as a proxy."
    },
    {
      "pos": [
        7802,
        7871
      ],
      "content": "<bpt id=\"p40\">**</bpt>SOCKS v5<ept id=\"p40\">**</ept><ph id=\"ph56\"/> - Select this to set the required version for the proxy."
    },
    {
      "pos": [
        7877,
        7957
      ],
      "content": "<ph id=\"ph57\">![</ph>foxyproxy proxy<ph id=\"ph58\">](./media/hdinsight-linux-ambari-ssh-tunnel/foxyproxyproxy.png)</ph>"
    },
    {
      "pos": [
        7962,
        8095
      ],
      "content": "Select the <bpt id=\"p41\">**</bpt>URL Patterns<ept id=\"p41\">**</ept><ph id=\"ph59\"/> tab, and then select <bpt id=\"p42\">**</bpt>Add New Pattern<ept id=\"p42\">**</ept>. Use the following to define the pattern, and then click <bpt id=\"p43\">**</bpt>OK<ept id=\"p43\">**</ept>:",
      "nodes": [
        {
          "content": "Select the <bpt id=\"p41\">**</bpt>URL Patterns<ept id=\"p41\">**</ept><ph id=\"ph59\"/> tab, and then select <bpt id=\"p42\">**</bpt>Add New Pattern<ept id=\"p42\">**</ept>.",
          "pos": [
            0,
            164
          ]
        },
        {
          "content": "Use the following to define the pattern, and then click <bpt id=\"p43\">**</bpt>OK<ept id=\"p43\">**</ept>:",
          "pos": [
            165,
            268
          ]
        }
      ]
    },
    {
      "pos": [
        8103,
        8186
      ],
      "content": "<bpt id=\"p44\">**</bpt>Pattern Name<ept id=\"p44\">**</ept><ph id=\"ph60\"/> - <bpt id=\"p45\">**</bpt>clusternodes<ept id=\"p45\">**</ept><ph id=\"ph61\"/> - This is just a friendly name for the pattern."
    },
    {
      "pos": [
        8194,
        8342
      ],
      "content": "<bpt id=\"p46\">**</bpt>URL pattern<ept id=\"p46\">**</ept><ph id=\"ph62\"/> - <bpt id=\"p47\">**</bpt>\\*internal.cloudapp.net\\*<ept id=\"p47\">**</ept><ph id=\"ph63\"/> - This defines a pattern that matches the internal fully qualified domain name of the cluster nodes."
    },
    {
      "pos": [
        8348,
        8427
      ],
      "content": "<ph id=\"ph64\">![</ph>foxyproxy pattern<ph id=\"ph65\">](./media/hdinsight-linux-ambari-ssh-tunnel/foxypattern.png)</ph>"
    },
    {
      "pos": [
        8432,
        8491
      ],
      "content": "Click <bpt id=\"p48\">**</bpt>OK<ept id=\"p48\">**</ept><ph id=\"ph66\"/> to add the proxy and close <bpt id=\"p49\">**</bpt>Proxy Settings<ept id=\"p49\">**</ept>."
    },
    {
      "pos": [
        8496,
        8651
      ],
      "content": "At the top of the FoxyProxy dialog, change <bpt id=\"p50\">**</bpt>Select Mode<ept id=\"p50\">**</ept><ph id=\"ph67\"/> to <bpt id=\"p51\">**</bpt>Use proxies based on their pre-defined patterns and priorities<ept id=\"p51\">**</ept>, and then click <bpt id=\"p52\">**</bpt>Close<ept id=\"p52\">**</ept>."
    },
    {
      "pos": [
        8657,
        8739
      ],
      "content": "<ph id=\"ph68\">![</ph>foxyproxy select mode<ph id=\"ph69\">](./media/hdinsight-linux-ambari-ssh-tunnel/selectmode.png)</ph>"
    },
    {
      "pos": [
        8741,
        8878
      ],
      "content": "After following these steps, only requests for URLs that contain the string <bpt id=\"p53\">__</bpt>internal.cloudapp.net<ept id=\"p53\">__</ept><ph id=\"ph70\"/> will be routed over the SSL tunnel."
    },
    {
      "pos": [
        8882,
        8907
      ],
      "content": "Verify with Ambari web UI"
    },
    {
      "pos": [
        8909,
        9038
      ],
      "content": "Once the cluster has been established, use the following steps to verify that you can access service web UIs from the Ambari Web:"
    },
    {
      "pos": [
        9043,
        9162
      ],
      "content": "In your browser, go to https://CLUSTERNAME.azurehdinsight.net, where CLUSTERNAME is the name of your HDInsight cluster."
    },
    {
      "pos": [
        9168,
        9336
      ],
      "content": "When prompted, enter the admin user name (admin) and password for your cluster. You may be prompted a second time by the Ambari web UI. If so, re-enter the information.",
      "nodes": [
        {
          "content": "When prompted, enter the admin user name (admin) and password for your cluster.",
          "pos": [
            0,
            79
          ]
        },
        {
          "content": "You may be prompted a second time by the Ambari web UI.",
          "pos": [
            80,
            135
          ]
        },
        {
          "content": "If so, re-enter the information.",
          "pos": [
            136,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        9341,
        9415
      ],
      "content": "From the Ambari Web UI, select YARN from the list on the left of the page."
    },
    {
      "pos": [
        9421,
        9507
      ],
      "content": "<ph id=\"ph71\">![</ph>Image with YARN selected<ph id=\"ph72\">](./media/hdinsight-linux-ambari-ssh-tunnel/yarnservice.png)</ph>"
    },
    {
      "pos": [
        9512,
        9699
      ],
      "content": "When the YARN service information is displayed, select <bpt id=\"p54\">__</bpt>Quick Links<ept id=\"p54\">__</ept>. A list of the cluster head nodes will appear. Select one of the head nodes, and then select <bpt id=\"p55\">__</bpt>ResourceManager UI<ept id=\"p55\">__</ept>.",
      "nodes": [
        {
          "content": "When the YARN service information is displayed, select <bpt id=\"p54\">__</bpt>Quick Links<ept id=\"p54\">__</ept>.",
          "pos": [
            0,
            111
          ]
        },
        {
          "content": "A list of the cluster head nodes will appear.",
          "pos": [
            112,
            157
          ]
        },
        {
          "content": "Select one of the head nodes, and then select <bpt id=\"p55\">__</bpt>ResourceManager UI<ept id=\"p55\">__</ept>.",
          "pos": [
            158,
            267
          ]
        }
      ]
    },
    {
      "pos": [
        9705,
        9809
      ],
      "content": "<ph id=\"ph73\">![</ph>Image with the QuickLinks menu expanded<ph id=\"ph74\">](./media/hdinsight-linux-ambari-ssh-tunnel/yarnquicklinks.png)</ph>"
    },
    {
      "pos": [
        9817,
        10078
      ],
      "content": "<ph id=\"ph75\">[AZURE.NOTE]</ph><ph id=\"ph76\"/> If you have a slow internet connection, or the head node is very busy, you may get a wait indicator instead of a menu when you select <bpt id=\"p56\">__</bpt>Quick Links<ept id=\"p56\">__</ept>. If so, wait a minute or two for the data to be received from the server, then try the list again.",
      "nodes": [
        {
          "content": "<ph id=\"ph75\">[AZURE.NOTE]</ph><ph id=\"ph76\"/> If you have a slow internet connection, or the head node is very busy, you may get a wait indicator instead of a menu when you select <bpt id=\"p56\">__</bpt>Quick Links<ept id=\"p56\">__</ept>.",
          "pos": [
            0,
            237
          ]
        },
        {
          "content": "If so, wait a minute or two for the data to be received from the server, then try the list again.",
          "pos": [
            238,
            335
          ]
        }
      ]
    },
    {
      "pos": [
        10406,
        10452
      ],
      "content": "A page similar to the following should appear:"
    },
    {
      "pos": [
        10458,
        10564
      ],
      "content": "<ph id=\"ph77\">![</ph>Image of the YARN ResourceManager UI<ph id=\"ph78\">](./media/hdinsight-linux-ambari-ssh-tunnel/yarnresourcemanager.png)</ph>"
    },
    {
      "pos": [
        10572,
        10846
      ],
      "content": "<ph id=\"ph79\">[AZURE.TIP]</ph><ph id=\"ph80\"/> Notice the URL for this page; it should be similar to <bpt id=\"p57\">__</bpt>http://hn1-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8088/cluster<ept id=\"p57\">__</ept>. This is using the internal fully qualified domain name (FQDN) of the node, and is not accessible without using an SSH tunnel.",
      "nodes": [
        {
          "content": "<ph id=\"ph79\">[AZURE.TIP]</ph><ph id=\"ph80\"/> Notice the URL for this page; it should be similar to <bpt id=\"p57\">__</bpt>http://hn1-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8088/cluster<ept id=\"p57\">__</ept>.",
          "pos": [
            0,
            222
          ]
        },
        {
          "content": "This is using the internal fully qualified domain name (FQDN) of the node, and is not accessible without using an SSH tunnel.",
          "pos": [
            223,
            348
          ]
        }
      ]
    },
    {
      "pos": [
        10850,
        10860
      ],
      "content": "Next steps"
    },
    {
      "pos": [
        10862,
        11012
      ],
      "content": "Now that you have learned how to create and use an SSH tunnel, see the following for information on monitoring and managing your cluster using Ambari:"
    },
    {
      "pos": [
        11016,
        11094
      ],
      "content": "<bpt id=\"p58\">[</bpt>Manage HDInsight clusters by using Ambari<ept id=\"p58\">](hdinsight-hadoop-manage-ambari.md)</ept>"
    },
    {
      "pos": [
        11096,
        11164
      ],
      "content": "For more information on using SSH with HDInsight, see the following:"
    },
    {
      "pos": [
        11168,
        11280
      ],
      "content": "<bpt id=\"p59\">[</bpt>Use SSH with Linux-based Hadoop on HDInsight from Linux, Unix, or OS X<ept id=\"p59\">](hdinsight-hadoop-linux-use-ssh-unix.md)</ept>"
    },
    {
      "pos": [
        11284,
        11386
      ],
      "content": "<bpt id=\"p60\">[</bpt>Use SSH with Linux-based Hadoop on HDInsight from Windows<ept id=\"p60\">](hdinsight-hadoop-linux-use-ssh-windows.md)</ept>"
    }
  ],
  "content": "<properties\npageTitle=\"Use SSH Tunneling to access Ambari web UI, ResourceManager, JobHistory, NameNode, Oozie and other web UI's\"\ndescription=\"Learn how to use an SSH tunnel to securely browse web resources hosted on your Linux-based HDInsight nodes.\"\nservices=\"hdinsight\"\ndocumentationCenter=\"\"\nauthors=\"Blackmist\"\nmanager=\"paulettm\"\neditor=\"cgronlun\"/>\n\n<tags\nms.service=\"hdinsight\"\nms.devlang=\"na\"\nms.topic=\"article\"\nms.tgt_pltfrm=\"na\"\nms.workload=\"big-data\"\nms.date=\"01/12/2016\"\nms.author=\"larryfr\"/>\n\n#Use SSH Tunneling to access Ambari web UI, ResourceManager, JobHistory, NameNode, Oozie, and other web UI's\n\nLinux-based HDInsight clusters provide access to Ambari web UI over the Internet, but some features of the UI are not. For example, the web UI for other services that are surfaced through Ambari. For full functionality of the Ambari web UI, you must use an SSH tunnel to the cluster head.\n\n##What requires an SSH tunnel?\n\nSeveral of the menus in Ambari will not fully populate without an SSH tunnel, as they rely on web sites and services exposed by other Hadoop services running on the cluster. Often, these web sites are not secured, so it is not safe to directly expose them on the internet. Sometimes the service runs the web site on another cluster node such as a Zookeeper node.\n\nThe following are services that Ambari web UI uses, that cannot be accessed without an SSH tunnel:\n\n* ResourceManager,\n* JobHistory,\n* NameNode,\n* Thread Stacks,\n* Oozie web UI\n* HBase Master and Logs UI\n\nIf you use Script Actions to customize your cluster, any services or utilities that you install that expose a web UI will require an SSH tunnel. For example, if you install Hue using a Script Action, you must use an SSH tunnel to access the Hue web UI.\n\n##What is an SSH tunnel?\n\n[Secure Shell (SSH) tunneling](https://en.wikipedia.org/wiki/Tunneling_protocol#Secure_Shell_tunneling) routes traffic sent to a port on your local workstation, through an SSH connection to your HDInsight cluster head node, where the request is then resolved as if it originated on the head node. The response is then routed back through the tunnel to your workstation.\n\n##Prerequisites\n\nWhen using an SSH tunnel for web traffic, you must have the following:\n\n* An SSH client. For Linux and Unix distributions or Macintosh OS X, the `ssh` command is provided with the operating system. For Windows, we recommend [PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)\n\n    > [AZURE.NOTE] If you want to use an SSH client other than `ssh` or PuTTY, please consult the documentation for your client on how to establish an SSH tunnel.\n\n* A web browser that can be configured to use a SOCKS proxy\n\n* __(optional)__: A plugin such as [FoxyProxy](http://getfoxyproxy.org/,) that can apply rules that only route specific requests through the tunnel.\n\n    > [AZURE.WARNING] Without a plugin such as FoxyProxy, all requests made through the browser may be routed through the tunnel. This can result in slower loading of web pages in your browser.\n\n##<a name=\"usessh\"></a>Create a tunnel using the SSH command\n\nUse the following command to create an SSH tunnel using the `ssh` command. Replace __USERNAME__ with an SSH user for your HDInsight cluster, and replace __CLUSTERNAME__ with the name of your HDInsight cluster\n\n    ssh -C2qTnNf -D 9876 USERNAME@CLUSTERNAME-ssh.azurehdinsight.net\n\nThis creates a connection that routes traffic to local port 9876 to the cluster over SSH. The options are:\n\n* **D 9876** - The local port that will route traffic through the tunnel.\n\n* **C** - Compress all data, because web traffic is mostly text.\n\n* **2** - Force SSH to try protocol version 2 only.\n\n* **q** - Quiet mode.\n\n* **T** - Disable pseudo-tty allocation, since we are just forwarding a port.\n\n* **n** - Prevent reading of STDIN, since we are just forwarding a port.\n\n* **N** - Do not execute a remote command, since we are just forwarding a port.\n\n* **f** - Run in the background.\n\nIf you configured the cluster with an SSH key, you may need use the `-i` parameter and specify the path to the private SSH key.\n\nOnce the command finishes, traffic sent to port 9876 on the local computer will be routed over Secure Sockets Layer (SSL) to the cluster head node and appear to originate there.\n\n##<a name=\"useputty\"></a>Create a tunnel using PuTTY\n\nUse the following steps to create an SSH tunnel using PuTTY.\n\n1. Open PuTTY, and enter your connection information. If you are not familiar with PuTTY, see [Use SSH with Linux-based Hadoop on HDInsight from Windows](hdinsight-hadoop-linux-use-ssh-windows.md) for information on how to use it with HDInsight.\n\n2. In the **Category** section to the left of the dialog, expand **Connection**, expand **SSH**, and then select **Tunnels**.\n\n3. Provide the following information on the **Options controlling SSH port forwarding** form:\n\n    * **Source port** - The port on the client that you wish to forward. For example, **9876**.\n\n    * **Destination** - The SSH address for the Linux-based HDInsight cluster. For example, **mycluster-ssh.azurehdinsight.net**.\n\n    * **Dynamic** - Enables dynamic SOCKS proxy routing.\n\n    ![image of tunneling options](./media/hdinsight-linux-ambari-ssh-tunnel/puttytunnel.png)\n\n4. Click **Add** to add the settings, and then click **Open** to open an SSH connection.\n\n5. When prompted, log in to the server. This will establish an SSH session and enable the tunnel.\n\n##Use the tunnel from your browser\n\n> [AZURE.NOTE] The steps in this section use the FireFox browser, as it is freely available for Linux, Unix, Macintosh OS X and Windows systems. Other modern browsers such as Google Chrome, Microsoft Edge, or Apple Safari should work as well; however, the FoxyProxy plugin used in some steps may not be available for all browsers.\n\n1. Configure the browser to use **localhost:9876** as a **SOCKS v5** proxy. Here's what the Firefox settings look like. If you used a different port than 9876, change the port to the one you used:\n\n    ![image of Firefox settings](./media/hdinsight-linux-ambari-ssh-tunnel/socks.png)\n\n    > [AZURE.NOTE] Selecting **Remote DNS** will resolve Domain Name System (DNS) requests by using the HDInsight cluster. If this is unselected, DNS will be resolved locally.\n\n2. Verify that traffic is being routed through the tunnel by vising a site such as [http://www.whatismyip.com/](http://www.whatismyip.com/) with the proxy settings enabled and disabled in Firefox. While the settings are enabled, the IP address will be for a machine in the Microsoft Azure datacenter.\n\n###Browser extensions\n\nWhile configuring the browser to use the tunnel works, you don't usually want to route all traffic over the tunnel. Browser extensions such as [FoxyProxy](http://getfoxyproxy.org/) support pattern matching for URL requests (FoxyProxy Standard or Plus only), so that only requests for specific URLs will be sent over the tunnel.\n\nIf you have installed FoxyProxy Standard, use the following steps to configure it to only forward traffic for HDInsight over the tunnel.\n\n1. Open the FoxyProxy extension in your browser. For example, in Firefox, select the FoxyProxy icon next to the address field.\n\n    ![foxyproxy icon](./media/hdinsight-linux-ambari-ssh-tunnel/foxyproxy.png)\n\n2. Select **Add New Proxy**, select the **General** tab, and then enter a proxy name of **HDInsightProxy**.\n\n    ![foxyproxy general](./media/hdinsight-linux-ambari-ssh-tunnel/foxygeneral.png)\n\n3. Select the **Proxy Details** tab and populate the following fields:\n\n    * **Host or IP Address** - This is localhost, since we are using an SSH tunnel on the local machine.\n\n    * **Port** - This is the port you used for the SSH tunnel.\n\n    * **SOCKS proxy** - Select this to enable the browser to use the tunnel as a proxy.\n\n    * **SOCKS v5** - Select this to set the required version for the proxy.\n\n    ![foxyproxy proxy](./media/hdinsight-linux-ambari-ssh-tunnel/foxyproxyproxy.png)\n\n4. Select the **URL Patterns** tab, and then select **Add New Pattern**. Use the following to define the pattern, and then click **OK**:\n\n    * **Pattern Name** - **clusternodes** - This is just a friendly name for the pattern.\n\n    * **URL pattern** - **\\*internal.cloudapp.net\\*** - This defines a pattern that matches the internal fully qualified domain name of the cluster nodes.\n\n    ![foxyproxy pattern](./media/hdinsight-linux-ambari-ssh-tunnel/foxypattern.png)\n\n4. Click **OK** to add the proxy and close **Proxy Settings**.\n\n5. At the top of the FoxyProxy dialog, change **Select Mode** to **Use proxies based on their pre-defined patterns and priorities**, and then click **Close**.\n\n    ![foxyproxy select mode](./media/hdinsight-linux-ambari-ssh-tunnel/selectmode.png)\n\nAfter following these steps, only requests for URLs that contain the string __internal.cloudapp.net__ will be routed over the SSL tunnel.\n\n##Verify with Ambari web UI\n\nOnce the cluster has been established, use the following steps to verify that you can access service web UIs from the Ambari Web:\n\n1. In your browser, go to https://CLUSTERNAME.azurehdinsight.net, where CLUSTERNAME is the name of your HDInsight cluster.\n\n    When prompted, enter the admin user name (admin) and password for your cluster. You may be prompted a second time by the Ambari web UI. If so, re-enter the information.\n\n2. From the Ambari Web UI, select YARN from the list on the left of the page.\n\n    ![Image with YARN selected](./media/hdinsight-linux-ambari-ssh-tunnel/yarnservice.png)\n\n3. When the YARN service information is displayed, select __Quick Links__. A list of the cluster head nodes will appear. Select one of the head nodes, and then select __ResourceManager UI__.\n\n    ![Image with the QuickLinks menu expanded](./media/hdinsight-linux-ambari-ssh-tunnel/yarnquicklinks.png)\n\n    > [AZURE.NOTE] If you have a slow internet connection, or the head node is very busy, you may get a wait indicator instead of a menu when you select __Quick Links__. If so, wait a minute or two for the data to be received from the server, then try the list again.\n\n\n    > [AZURE.TIP] If you have a lower resolution monitor, or your browser window is not maximized, some entries in the __Quick Links__ menu may be cut off by the right side of the screen. If so, expand the menu using your mouse, then use the right arrow key to scroll the screen to the right to see the rest of the menu.\n\n4. A page similar to the following should appear:\n\n    ![Image of the YARN ResourceManager UI](./media/hdinsight-linux-ambari-ssh-tunnel/yarnresourcemanager.png)\n\n    > [AZURE.TIP] Notice the URL for this page; it should be similar to __http://hn1-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8088/cluster__. This is using the internal fully qualified domain name (FQDN) of the node, and is not accessible without using an SSH tunnel.\n\n##Next steps\n\nNow that you have learned how to create and use an SSH tunnel, see the following for information on monitoring and managing your cluster using Ambari:\n\n* [Manage HDInsight clusters by using Ambari](hdinsight-hadoop-manage-ambari.md)\n\nFor more information on using SSH with HDInsight, see the following:\n\n* [Use SSH with Linux-based Hadoop on HDInsight from Linux, Unix, or OS X](hdinsight-hadoop-linux-use-ssh-unix.md)\n\n* [Use SSH with Linux-based Hadoop on HDInsight from Windows](hdinsight-hadoop-linux-use-ssh-windows.md)\n"
}