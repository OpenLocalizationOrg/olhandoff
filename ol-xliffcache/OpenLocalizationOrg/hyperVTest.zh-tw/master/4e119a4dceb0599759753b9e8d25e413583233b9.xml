{
  "nodes": [
    {
      "pos": [
        27,
        90
      ],
      "content": "Provision HBase clusters on a Virtual Network | Microsoft Azure"
    },
    {
      "pos": [
        109,
        223
      ],
      "content": "Get started using HBase in Azure HDInsight. Learn how to create HDInsight HBase clusters on Azure Virtual Network.",
      "nodes": [
        {
          "content": "Get started using HBase in Azure HDInsight.",
          "pos": [
            0,
            43
          ]
        },
        {
          "content": "Learn how to create HDInsight HBase clusters on Azure Virtual Network.",
          "pos": [
            44,
            114
          ]
        }
      ]
    },
    {
      "pos": [
        548,
        594
      ],
      "content": "Create HBase clusters on Azure Virtual Network"
    },
    {
      "pos": [
        597,
        681
      ],
      "content": "Learn how to create Azure HDInsight HBase clusters on an <bpt id=\"p1\">[</bpt>Azure Virtual Network<ept id=\"p1\">][1]</ept>."
    },
    {
      "pos": [
        683,
        876
      ],
      "content": "With virtual network integration, HBase clusters can be deployed to the same virtual network as your applications so that applications can communicate with HBase directly. The benefits include:",
      "nodes": [
        {
          "content": "With virtual network integration, HBase clusters can be deployed to the same virtual network as your applications so that applications can communicate with HBase directly.",
          "pos": [
            0,
            171
          ]
        },
        {
          "content": "The benefits include:",
          "pos": [
            172,
            193
          ]
        }
      ]
    },
    {
      "pos": [
        880,
        1034
      ],
      "content": "Direct connectivity of the web application to the nodes of the HBase cluster, which enables communication via HBase Java remote procedure call (RPC) APIs."
    },
    {
      "pos": [
        1037,
        1130
      ],
      "content": "Improved performance by not having your traffic go over multiple gateways and load-balancers."
    },
    {
      "pos": [
        1133,
        1237
      ],
      "content": "The ability to process sensitive information in a more secure manner without exposing a public endpoint."
    },
    {
      "pos": [
        1242,
        1255
      ],
      "content": "Prerequisites"
    },
    {
      "pos": [
        1256,
        1316
      ],
      "content": "Before you begin this tutorial, you must have the following:"
    },
    {
      "pos": [
        1320,
        1478
      ],
      "content": "<bpt id=\"p2\">**</bpt>An Azure subscription<ept id=\"p2\">**</ept>. See <bpt id=\"p3\">[</bpt>Get Azure free trial<ept id=\"p3\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p2\">**</bpt>An Azure subscription<ept id=\"p2\">**</ept>.",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "See <bpt id=\"p3\">[</bpt>Get Azure free trial<ept id=\"p3\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
          "pos": [
            65,
            234
          ]
        }
      ]
    },
    {
      "pos": [
        1482,
        1646
      ],
      "content": "<bpt id=\"p4\">**</bpt>A workstation with Azure PowerShell<ept id=\"p4\">**</ept>. See <bpt id=\"p5\">[</bpt>Install and use Azure PowerShell<ept id=\"p5\">](https://azure.microsoft.com/documentation/videos/install-and-use-azure-powershell/)</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p4\">**</bpt>A workstation with Azure PowerShell<ept id=\"p4\">**</ept>.",
          "pos": [
            0,
            78
          ]
        },
        {
          "content": "See <bpt id=\"p5\">[</bpt>Install and use Azure PowerShell<ept id=\"p5\">](https://azure.microsoft.com/documentation/videos/install-and-use-azure-powershell/)</ept>.",
          "pos": [
            79,
            240
          ]
        }
      ]
    },
    {
      "pos": [
        1652,
        1693
      ],
      "content": "Create HBase cluster into virtual network"
    },
    {
      "pos": [
        1695,
        2266
      ],
      "content": "In this section, you will create a Linux-based HBase cluster in HDInsight using <bpt id=\"p6\">[</bpt>Azure ARM template<ept id=\"p6\">](../resource-group-template-deploy.md)</ept>. The Azure ARM template experience is not required for following this tutorial. For other cluster creation methods and understanding the settings, see <bpt id=\"p7\">[</bpt>Create HDInsight clusters<ept id=\"p7\">](hdinsight-hadoop-provision-linux-clusters.md)</ept>. For more information about using ARM template to create Hadoop clusters in HDInsight, see <bpt id=\"p8\">[</bpt>Create Hadoop clusters in HDInsight using ARM templates<ept id=\"p8\">](hdinsight-hadoop-create-windows-clusters-arm-templates.md)</ept>",
      "nodes": [
        {
          "content": "In this section, you will create a Linux-based HBase cluster in HDInsight using <bpt id=\"p6\">[</bpt>Azure ARM template<ept id=\"p6\">](../resource-group-template-deploy.md)</ept>.",
          "pos": [
            0,
            177
          ]
        },
        {
          "content": "The Azure ARM template experience is not required for following this tutorial.",
          "pos": [
            178,
            256
          ]
        },
        {
          "content": "For other cluster creation methods and understanding the settings, see <bpt id=\"p7\">[</bpt>Create HDInsight clusters<ept id=\"p7\">](hdinsight-hadoop-provision-linux-clusters.md)</ept>.",
          "pos": [
            257,
            440
          ]
        },
        {
          "content": "For more information about using ARM template to create Hadoop clusters in HDInsight, see <bpt id=\"p8\">[</bpt>Create Hadoop clusters in HDInsight using ARM templates<ept id=\"p8\">](hdinsight-hadoop-create-windows-clusters-arm-templates.md)</ept>",
          "pos": [
            441,
            685
          ]
        }
      ]
    },
    {
      "pos": [
        2271,
        2397
      ],
      "content": "Click the following image to open an ARM template in the Azure Portal. The ARM template is located in a public blob container.",
      "nodes": [
        {
          "content": "Click the following image to open an ARM template in the Azure Portal.",
          "pos": [
            0,
            70
          ]
        },
        {
          "content": "The ARM template is located in a public blob container.",
          "pos": [
            71,
            126
          ]
        }
      ]
    },
    {
      "pos": [
        2849,
        2900
      ],
      "content": "From the <bpt id=\"p9\">**</bpt>Parameters<ept id=\"p9\">**</ept><ph id=\"ph5\"/> blade, enter the following:"
    },
    {
      "pos": [
        2908,
        2982
      ],
      "content": "<bpt id=\"p10\">**</bpt>ClusterName<ept id=\"p10\">**</ept>: Enter a name for the Hadoop cluster that you will create."
    },
    {
      "pos": [
        2989,
        3062
      ],
      "content": "<bpt id=\"p11\">**</bpt>Cluster login name and password<ept id=\"p11\">**</ept>: The default login name is <bpt id=\"p12\">**</bpt>admin<ept id=\"p12\">**</ept>."
    },
    {
      "pos": [
        3069,
        3156
      ],
      "content": "<bpt id=\"p13\">**</bpt>SSH username and password<ept id=\"p13\">**</ept>: The default username is <bpt id=\"p14\">**</bpt>sshuser<ept id=\"p14\">**</ept>.  You can rename it.",
      "nodes": [
        {
          "content": "<bpt id=\"p13\">**</bpt>SSH username and password<ept id=\"p13\">**</ept>: The default username is <bpt id=\"p14\">**</bpt>sshuser<ept id=\"p14\">**</ept>.",
          "pos": [
            0,
            147
          ]
        },
        {
          "content": "You can rename it.",
          "pos": [
            149,
            167
          ]
        }
      ]
    },
    {
      "pos": [
        3163,
        3235
      ],
      "content": "A lot of properties have been hard-coded into the template. For example:",
      "nodes": [
        {
          "content": "A lot of properties have been hard-coded into the template.",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "For example:",
          "pos": [
            60,
            72
          ]
        }
      ]
    },
    {
      "pos": [
        3247,
        3264
      ],
      "content": "Location: East US"
    },
    {
      "pos": [
        3271,
        3299
      ],
      "content": "Cluster worker node count: 4"
    },
    {
      "pos": [
        3306,
        3350
      ],
      "content": "Default storage account: <ph id=\"ph6\">&lt;Cluster Name&gt;</ph>store"
    },
    {
      "pos": [
        3357,
        3398
      ],
      "content": "Virtual network name: <ph id=\"ph7\">&lt;Cluster Name&gt;</ph>-vnet"
    },
    {
      "pos": [
        3405,
        3447
      ],
      "content": "Virtual network address space: 10.0.0.0/16"
    },
    {
      "pos": [
        3454,
        3474
      ],
      "content": "Subnet name: default"
    },
    {
      "pos": [
        3481,
        3514
      ],
      "content": "Subnet address range: 10.0.0.0/24"
    },
    {
      "pos": [
        3519,
        3555
      ],
      "content": "Click <bpt id=\"p15\">**</bpt>OK<ept id=\"p15\">**</ept><ph id=\"ph8\"/> to save the parameters."
    },
    {
      "pos": [
        3559,
        3807
      ],
      "content": "From the <bpt id=\"p16\">**</bpt>Custom deployment<ept id=\"p16\">**</ept><ph id=\"ph9\"/> blade, click <bpt id=\"p17\">**</bpt>Resource group<ept id=\"p17\">**</ept><ph id=\"ph10\"/> dropdown box, and then click <bpt id=\"p18\">**</bpt>New<ept id=\"p18\">**</ept><ph id=\"ph11\"/> to create a new resource group.  The resource group is a container that groups the cluster, the dependent storage account and other linked resource.",
      "nodes": [
        {
          "content": "From the <bpt id=\"p16\">**</bpt>Custom deployment<ept id=\"p16\">**</ept><ph id=\"ph9\"/> blade, click <bpt id=\"p17\">**</bpt>Resource group<ept id=\"p17\">**</ept><ph id=\"ph10\"/> dropdown box, and then click <bpt id=\"p18\">**</bpt>New<ept id=\"p18\">**</ept><ph id=\"ph11\"/> to create a new resource group.",
          "pos": [
            0,
            295
          ]
        },
        {
          "content": "The resource group is a container that groups the cluster, the dependent storage account and other linked resource.",
          "pos": [
            297,
            412
          ]
        }
      ]
    },
    {
      "pos": [
        3811,
        3860
      ],
      "content": "Click <bpt id=\"p19\">**</bpt>Legal terms<ept id=\"p19\">**</ept>, and then click <bpt id=\"p20\">**</bpt>Create<ept id=\"p20\">**</ept>."
    },
    {
      "pos": [
        3864,
        4104
      ],
      "content": "Click <bpt id=\"p21\">**</bpt>Create<ept id=\"p21\">**</ept>. You will see a new tile titled <bpt id=\"p22\">**</bpt>Submitting deployment for Template deployment<ept id=\"p22\">**</ept>. It takes about around 20 minutes to create a cluster. Once the cluster is created, you can click the cluster blade in the portal to open it.",
      "nodes": [
        {
          "content": "Click <bpt id=\"p21\">**</bpt>Create<ept id=\"p21\">**</ept>.",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "You will see a new tile titled <bpt id=\"p22\">**</bpt>Submitting deployment for Template deployment<ept id=\"p22\">**</ept>.",
          "pos": [
            58,
            179
          ]
        },
        {
          "content": "It takes about around 20 minutes to create a cluster.",
          "pos": [
            180,
            233
          ]
        },
        {
          "content": "Once the cluster is created, you can click the cluster blade in the portal to open it.",
          "pos": [
            234,
            320
          ]
        }
      ]
    },
    {
      "pos": [
        4106,
        4692
      ],
      "content": "After you complete the tutorial, you might want to delete the cluster. With HDInsight, your data is stored in Azure Storage, so you can safely delete a cluster when it is not in use. You are also charged for an HDInsight cluster, even when it is not in use. Since the charges for the cluster are many times more than the charges for storage, it makes economic sense to delete clusters when they are not in use. For the instructions of deleting a cluster, see <bpt id=\"p23\">[</bpt>Manage Hadoop clusters in HDInsight by using the Azure Portal<ept id=\"p23\">](hdinsight-administer-use-management-portal.md#delete-clusters)</ept>.",
      "nodes": [
        {
          "content": "After you complete the tutorial, you might want to delete the cluster.",
          "pos": [
            0,
            70
          ]
        },
        {
          "content": "With HDInsight, your data is stored in Azure Storage, so you can safely delete a cluster when it is not in use.",
          "pos": [
            71,
            182
          ]
        },
        {
          "content": "You are also charged for an HDInsight cluster, even when it is not in use.",
          "pos": [
            183,
            257
          ]
        },
        {
          "content": "Since the charges for the cluster are many times more than the charges for storage, it makes economic sense to delete clusters when they are not in use.",
          "pos": [
            258,
            410
          ]
        },
        {
          "content": "For the instructions of deleting a cluster, see <bpt id=\"p23\">[</bpt>Manage Hadoop clusters in HDInsight by using the Azure Portal<ept id=\"p23\">](hdinsight-administer-use-management-portal.md#delete-clusters)</ept>.",
          "pos": [
            411,
            626
          ]
        }
      ]
    },
    {
      "pos": [
        4694,
        4868
      ],
      "content": "To begin working with your new HBase cluster, you can use the procedures found in <bpt id=\"p24\">[</bpt>Get started using HBase with Hadoop in HDInsight<ept id=\"p24\">](hdinsight-hbase-tutorial-get-started.md)</ept>."
    },
    {
      "pos": [
        4872,
        4926
      ],
      "content": "Connect to the HBase cluster using HBase Java RPC APIs"
    },
    {
      "pos": [
        4932,
        5471
      ],
      "content": "Create an infrastructure as a service (IaaS) virtual machine into the same Azure virtual network and the same subnet. So both the virtual machine and the HBase cluster use the same internal DNS server to resolve host names. To do so, you must choose the <bpt id=\"p25\">**</bpt>From Gallery<ept id=\"p25\">**</ept><ph id=\"ph12\"/> option, and select the virtual network instead of a data center. For instructions, see <bpt id=\"p26\">[</bpt>Create a Virtual Machine Running Windows Server<ept id=\"p26\">](../virtual-machines/virtual-machines-windows-tutorial.md)</ept>. A standard Windows Server 2012 image with a small VM size is sufficient.",
      "nodes": [
        {
          "content": "Create an infrastructure as a service (IaaS) virtual machine into the same Azure virtual network and the same subnet.",
          "pos": [
            0,
            117
          ]
        },
        {
          "content": "So both the virtual machine and the HBase cluster use the same internal DNS server to resolve host names.",
          "pos": [
            118,
            223
          ]
        },
        {
          "content": "To do so, you must choose the <bpt id=\"p25\">**</bpt>From Gallery<ept id=\"p25\">**</ept><ph id=\"ph12\"/> option, and select the virtual network instead of a data center.",
          "pos": [
            224,
            390
          ]
        },
        {
          "content": "For instructions, see <bpt id=\"p26\">[</bpt>Create a Virtual Machine Running Windows Server<ept id=\"p26\">](../virtual-machines/virtual-machines-windows-tutorial.md)</ept>.",
          "pos": [
            391,
            561
          ]
        },
        {
          "content": "A standard Windows Server 2012 image with a small VM size is sufficient.",
          "pos": [
            562,
            634
          ]
        }
      ]
    },
    {
      "pos": [
        5477,
        5765
      ],
      "content": "When using a Java application to connect to HBase remotely, you must use the fully qualified domain name (FQDN). To determine this, you must get the connection-specific DNS suffix of the HBase cluster. To do that, use Curl to query Ambari, or use Remote Desktop to connect to the cluster.",
      "nodes": [
        {
          "content": "When using a Java application to connect to HBase remotely, you must use the fully qualified domain name (FQDN).",
          "pos": [
            0,
            112
          ]
        },
        {
          "content": "To determine this, you must get the connection-specific DNS suffix of the HBase cluster.",
          "pos": [
            113,
            201
          ]
        },
        {
          "content": "To do that, use Curl to query Ambari, or use Remote Desktop to connect to the cluster.",
          "pos": [
            202,
            288
          ]
        }
      ]
    },
    {
      "pos": [
        5773,
        5810
      ],
      "content": "<bpt id=\"p27\">**</bpt>Curl<ept id=\"p27\">**</ept><ph id=\"ph13\"/> - Use the following command:"
    },
    {
      "pos": [
        5996,
        6149
      ],
      "content": "In the JavaScript Object Notation (JSON) data returned, find the \"host_name\" entry. This will contain the FQDN for the nodes in the cluster. For example:",
      "nodes": [
        {
          "content": "In the JavaScript Object Notation (JSON) data returned, find the \"host_name\" entry.",
          "pos": [
            0,
            83
          ]
        },
        {
          "content": "This will contain the FQDN for the nodes in the cluster.",
          "pos": [
            84,
            140
          ]
        },
        {
          "content": "For example:",
          "pos": [
            141,
            153
          ]
        }
      ]
    },
    {
      "pos": [
        6261,
        6382
      ],
      "content": "The portion of the domain name beginning with the cluster name is the DNS suffix. For example, mycluster.b1.cloudapp.net.",
      "nodes": [
        {
          "content": "The portion of the domain name beginning with the cluster name is the DNS suffix.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "For example, mycluster.b1.cloudapp.net.",
          "pos": [
            82,
            121
          ]
        }
      ]
    },
    {
      "pos": [
        6390,
        6546
      ],
      "content": "<bpt id=\"p28\">**</bpt>Azure PowerShell<ept id=\"p28\">**</ept><ph id=\"ph14\"/> - Use the following Azure PowerShell script to register the <bpt id=\"p29\">**</bpt>Get-ClusterDetail<ept id=\"p29\">**</ept><ph id=\"ph15\"/> function, which can be used to return the DNS suffix:"
    },
    {
      "pos": [
        11932,
        12169
      ],
      "content": "After running the Azure PowerShell script, use the following command to return the DNS suffix by using the <bpt id=\"p30\">**</bpt>Get-ClusterDetail<ept id=\"p30\">**</ept><ph id=\"ph16\"/> function. Specify your HDInsight HBase cluster name, admin name, and admin password when using this command.",
      "nodes": [
        {
          "content": "After running the Azure PowerShell script, use the following command to return the DNS suffix by using the <bpt id=\"p30\">**</bpt>Get-ClusterDetail<ept id=\"p30\">**</ept><ph id=\"ph16\"/> function.",
          "pos": [
            0,
            193
          ]
        },
        {
          "content": "Specify your HDInsight HBase cluster name, admin name, and admin password when using this command.",
          "pos": [
            194,
            292
          ]
        }
      ]
    },
    {
      "pos": [
        12327,
        12418
      ],
      "content": "This will return the DNS suffix. For example, <bpt id=\"p31\">**</bpt>yourclustername.b4.internal.cloudapp.net<ept id=\"p31\">**</ept>.",
      "nodes": [
        {
          "content": "This will return the DNS suffix.",
          "pos": [
            0,
            32
          ]
        },
        {
          "content": "For example, <bpt id=\"p31\">**</bpt>yourclustername.b4.internal.cloudapp.net<ept id=\"p31\">**</ept>.",
          "pos": [
            33,
            131
          ]
        }
      ]
    },
    {
      "pos": [
        12426,
        12805
      ],
      "content": "<ph id=\"ph17\">[AZURE.NOTE]</ph><ph id=\"ph18\"/> You can also use Remote Desktop to connect to the HBase cluster (you will be connected to the head node) and run <bpt id=\"p32\">**</bpt>ipconfig<ept id=\"p32\">**</ept><ph id=\"ph19\"/> from a command prompt to obtain the DNS suffix. For instructions on enabling Remote Desktop Protocol (RDP) and connecting to the cluster by using RDP, see <bpt id=\"p33\">[</bpt>Manage Hadoop clusters in HDInsight using the Azure portal<ept id=\"p33\">][hdinsight-admin-portal]</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph17\">[AZURE.NOTE]</ph><ph id=\"ph18\"/> You can also use Remote Desktop to connect to the HBase cluster (you will be connected to the head node) and run <bpt id=\"p32\">**</bpt>ipconfig<ept id=\"p32\">**</ept><ph id=\"ph19\"/> from a command prompt to obtain the DNS suffix.",
          "pos": [
            0,
            275
          ]
        },
        {
          "content": "For instructions on enabling Remote Desktop Protocol (RDP) and connecting to the cluster by using RDP, see <bpt id=\"p33\">[</bpt>Manage Hadoop clusters in HDInsight using the Azure portal<ept id=\"p33\">][hdinsight-admin-portal]</ept>.",
          "pos": [
            276,
            508
          ]
        }
      ]
    },
    {
      "pos": [
        12818,
        12865
      ],
      "content": "<ph id=\"ph20\">![</ph>hdinsight.hbase.dns.surffix<ph id=\"ph21\">][img-dns-surffix]</ph>"
    },
    {
      "pos": [
        13662,
        13665
      ],
      "content": "--&gt;"
    },
    {
      "pos": [
        13667,
        13868
      ],
      "content": "To verify that the virtual machine can communicate with the HBase cluster, use the command <ph id=\"ph23\">`ping headnode0.&lt;dns suffix&gt;`</ph><ph id=\"ph24\"/> from the virtual machine. For example, ping headnode0.mycluster.b1.cloudapp.net.",
      "nodes": [
        {
          "content": "To verify that the virtual machine can communicate with the HBase cluster, use the command <ph id=\"ph23\">`ping headnode0.&lt;dns suffix&gt;`</ph><ph id=\"ph24\"/> from the virtual machine.",
          "pos": [
            0,
            186
          ]
        },
        {
          "content": "For example, ping headnode0.mycluster.b1.cloudapp.net.",
          "pos": [
            187,
            241
          ]
        }
      ]
    },
    {
      "pos": [
        13870,
        14238
      ],
      "content": "To use this information in a Java application, you can follow the steps in <bpt id=\"p34\">[</bpt>Use Maven to build Java applications that use HBase with HDInsight (Hadoop)<ept id=\"p34\">](hdinsight-hbase-build-java-maven.md)</ept><ph id=\"ph25\"/> to create an application. To have the application connect to a remote HBase server, modify the <bpt id=\"p35\">**</bpt>hbase-site.xml<ept id=\"p35\">**</ept><ph id=\"ph26\"/> file in this example to use the FQDN for Zookeeper. For example:",
      "nodes": [
        {
          "content": "To use this information in a Java application, you can follow the steps in <bpt id=\"p34\">[</bpt>Use Maven to build Java applications that use HBase with HDInsight (Hadoop)<ept id=\"p34\">](hdinsight-hbase-build-java-maven.md)</ept><ph id=\"ph25\"/> to create an application.",
          "pos": [
            0,
            270
          ]
        },
        {
          "content": "To have the application connect to a remote HBase server, modify the <bpt id=\"p35\">**</bpt>hbase-site.xml<ept id=\"p35\">**</ept><ph id=\"ph26\"/> file in this example to use the FQDN for Zookeeper.",
          "pos": [
            271,
            465
          ]
        },
        {
          "content": "For example:",
          "pos": [
            466,
            478
          ]
        }
      ]
    },
    {
      "pos": [
        14413,
        14646
      ],
      "content": "<ph id=\"ph27\">[AZURE.NOTE]</ph><ph id=\"ph28\"/> For more information on name resolution in Azure virtual networks, including how to use your own DNS server, see <bpt id=\"p36\">[</bpt>Name Resolution (DNS)<ept id=\"p36\">](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md)</ept>."
    },
    {
      "pos": [
        14650,
        14660
      ],
      "content": "Next steps"
    },
    {
      "pos": [
        14662,
        14742
      ],
      "content": "In this tutorial you learned how to create an HBase cluster. To learn more, see:",
      "nodes": [
        {
          "content": "In this tutorial you learned how to create an HBase cluster.",
          "pos": [
            0,
            60
          ]
        },
        {
          "content": "To learn more, see:",
          "pos": [
            61,
            80
          ]
        }
      ]
    },
    {
      "pos": [
        14746,
        14822
      ],
      "content": "<bpt id=\"p37\">[</bpt>Get started with HDInsight<ept id=\"p37\">](hdinsight-hadoop-linux-tutorial-get-started.md)</ept>"
    },
    {
      "pos": [
        14825,
        14903
      ],
      "content": "<bpt id=\"p38\">[</bpt>Configure HBase replication in HDInsight<ept id=\"p38\">](hdinsight-hbase-geo-replication.md)</ept>"
    },
    {
      "pos": [
        14906,
        14976
      ],
      "content": "<bpt id=\"p39\">[</bpt>Create Hadoop clusters in HDInsight<ept id=\"p39\">](hdinsight-provision-clusters.md)</ept>"
    },
    {
      "pos": [
        14979,
        15070
      ],
      "content": "<bpt id=\"p40\">[</bpt>Get started using HBase with Hadoop in HDInsight<ept id=\"p40\">](hdinsight-hbase-tutorial-get-started.md)</ept>"
    },
    {
      "pos": [
        15073,
        15170
      ],
      "content": "<bpt id=\"p41\">[</bpt>Analyze Twitter sentiment with HBase in HDInsight<ept id=\"p41\">](hdinsight-hbase-analyze-twitter-sentiment.md)</ept>"
    },
    {
      "pos": [
        15173,
        15214
      ],
      "content": "<bpt id=\"p42\">[</bpt>Virtual Network Overview<ept id=\"p42\">][vnet-overview]</ept>"
    }
  ],
  "content": "<properties\n    pageTitle=\"Provision HBase clusters on a Virtual Network | Microsoft Azure\"\n    description=\"Get started using HBase in Azure HDInsight. Learn how to create HDInsight HBase clusters on Azure Virtual Network.\"\n    keywords=\"\"\n    services=\"hdinsight,virtual-network\"\n    documentationCenter=\"\"\n    authors=\"mumian\"\n    manager=\"paulettm\"\n    editor=\"cgronlun\"/>\n\n<tags\n   ms.service=\"hdinsight\"\n   ms.devlang=\"na\"\n   ms.topic=\"article\"\n   ms.tgt_pltfrm=\"na\"\n   ms.workload=\"big-data\"\n   ms.date=\"02/17/2016\"\n   ms.author=\"jgao\"/>\n\n# Create HBase clusters on Azure Virtual Network \n\nLearn how to create Azure HDInsight HBase clusters on an [Azure Virtual Network][1].\n\nWith virtual network integration, HBase clusters can be deployed to the same virtual network as your applications so that applications can communicate with HBase directly. The benefits include:\n\n- Direct connectivity of the web application to the nodes of the HBase cluster, which enables communication via HBase Java remote procedure call (RPC) APIs.\n- Improved performance by not having your traffic go over multiple gateways and load-balancers.\n- The ability to process sensitive information in a more secure manner without exposing a public endpoint.\n\n###Prerequisites\nBefore you begin this tutorial, you must have the following:\n\n- **An Azure subscription**. See [Get Azure free trial](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).\n\n- **A workstation with Azure PowerShell**. See [Install and use Azure PowerShell](https://azure.microsoft.com/documentation/videos/install-and-use-azure-powershell/). \n\n## Create HBase cluster into virtual network\n\nIn this section, you will create a Linux-based HBase cluster in HDInsight using [Azure ARM template](../resource-group-template-deploy.md). The Azure ARM template experience is not required for following this tutorial. For other cluster creation methods and understanding the settings, see [Create HDInsight clusters](hdinsight-hadoop-provision-linux-clusters.md). For more information about using ARM template to create Hadoop clusters in HDInsight, see [Create Hadoop clusters in HDInsight using ARM templates](hdinsight-hadoop-create-windows-clusters-arm-templates.md)\n\n1. Click the following image to open an ARM template in the Azure Portal. The ARM template is located in a public blob container. \n\n    <a href=\"https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fhditutorialdata.blob.core.windows.net%2Farmtemplates%2Fcreate-linux-based-hbase-cluster-in-vnet.json\" target=\"_blank\"><img src=\"https://acom.azurecomcdn.net/80C57D/cdn/mediahandler/docarticles/dpsmedia-prod/azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-tutorial-get-started-linux/20160201111850/deploy-to-azure.png\" alt=\"Deploy to Azure\"></a>\n\n2. From the **Parameters** blade, enter the following:\n\n    - **ClusterName**: Enter a name for the Hadoop cluster that you will create.\n    - **Cluster login name and password**: The default login name is **admin**.\n    - **SSH username and password**: The default username is **sshuser**.  You can rename it. \n\n    A lot of properties have been hard-coded into the template. For example:\n    \n    - Location: East US\n    - Cluster worker node count: 4\n    - Default storage account: <Cluster Name>store\n    - Virtual network name: <Cluster Name>-vnet\n    - Virtual network address space: 10.0.0.0/16\n    - Subnet name: default\n    - Subnet address range: 10.0.0.0/24\n\n3. Click **OK** to save the parameters.\n4. From the **Custom deployment** blade, click **Resource group** dropdown box, and then click **New** to create a new resource group.  The resource group is a container that groups the cluster, the dependent storage account and other linked resource.\n5. Click **Legal terms**, and then click **Create**.\n6. Click **Create**. You will see a new tile titled **Submitting deployment for Template deployment**. It takes about around 20 minutes to create a cluster. Once the cluster is created, you can click the cluster blade in the portal to open it.\n\nAfter you complete the tutorial, you might want to delete the cluster. With HDInsight, your data is stored in Azure Storage, so you can safely delete a cluster when it is not in use. You are also charged for an HDInsight cluster, even when it is not in use. Since the charges for the cluster are many times more than the charges for storage, it makes economic sense to delete clusters when they are not in use. For the instructions of deleting a cluster, see [Manage Hadoop clusters in HDInsight by using the Azure Portal](hdinsight-administer-use-management-portal.md#delete-clusters).\n\nTo begin working with your new HBase cluster, you can use the procedures found in [Get started using HBase with Hadoop in HDInsight](hdinsight-hbase-tutorial-get-started.md).\n\n##Connect to the HBase cluster using HBase Java RPC APIs\n\n1.  Create an infrastructure as a service (IaaS) virtual machine into the same Azure virtual network and the same subnet. So both the virtual machine and the HBase cluster use the same internal DNS server to resolve host names. To do so, you must choose the **From Gallery** option, and select the virtual network instead of a data center. For instructions, see [Create a Virtual Machine Running Windows Server](../virtual-machines/virtual-machines-windows-tutorial.md). A standard Windows Server 2012 image with a small VM size is sufficient.\n\n2.  When using a Java application to connect to HBase remotely, you must use the fully qualified domain name (FQDN). To determine this, you must get the connection-specific DNS suffix of the HBase cluster. To do that, use Curl to query Ambari, or use Remote Desktop to connect to the cluster.\n\n    * **Curl** - Use the following command:\n\n            curl -u <username>:<password> -k https://<clustername>.azurehdinsight.net/ambari/api/v1/clusters/<clustername>.azurehdinsight.net/services/hbase/components/hbrest\n\n        In the JavaScript Object Notation (JSON) data returned, find the \"host_name\" entry. This will contain the FQDN for the nodes in the cluster. For example:\n\n            ...\n            \"host_name\": \"wordkernode0.<clustername>.b1.cloudapp.net\n            ...\n\n        The portion of the domain name beginning with the cluster name is the DNS suffix. For example, mycluster.b1.cloudapp.net.\n\n    * **Azure PowerShell** - Use the following Azure PowerShell script to register the **Get-ClusterDetail** function, which can be used to return the DNS suffix:\n\n            function Get-ClusterDetail(\n                [String]\n                [Parameter( Position=0, Mandatory=$true )]\n                $ClusterDnsName,\n                [String]\n                [Parameter( Position=1, Mandatory=$true )]\n                $Username,\n                [String]\n                [Parameter( Position=2, Mandatory=$true )]\n                $Password,\n                [String]\n                [Parameter( Position=3, Mandatory=$true )]\n                $PropertyName\n                )\n            {\n            <#\n                .SYNOPSIS\n                 Displays information to facilitate an HDInsight cluster-to-cluster scenario within the same virtual network.\n                .Description\n                 This command shows the following 4 properties of an HDInsight cluster:\n                 1. ZookeeperQuorum (supports only HBase type cluster)\n                    Shows the value of HBase property \"hbase.zookeeper.quorum\".\n                 2. ZookeeperClientPort (supports only HBase type cluster)\n                    Shows the value of HBase property \"hbase.zookeeper.property.clientPort\".\n                 3. HBaseRestServers (supports only HBase type cluster)\n                    Shows a list of host FQDNs that run the HBase REST server.\n                 4. FQDNSuffix (supports all cluster types)\n                    Shows the FQDN suffix of hosts in the cluster.\n                .EXAMPLE\n                 Get-ClusterDetail -ClusterDnsName {clusterDnsName} -Username {username} -Password {password} -PropertyName ZookeeperQuorum\n                 This command shows the value of HBase property \"hbase.zookeeper.quorum\".\n                .EXAMPLE\n                 Get-ClusterDetail -ClusterDnsName {clusterDnsName} -Username {username} -Password {password} -PropertyName ZookeeperClientPort\n                 This command shows the value of HBase property \"hbase.zookeeper.property.clientPort\".\n                .EXAMPLE\n                 Get-ClusterDetail -ClusterDnsName {clusterDnsName} -Username {username} -Password {password} -PropertyName HBaseRestServers\n                 This command shows a list of host FQDNs that run the HBase REST server.\n                .EXAMPLE\n                 Get-ClusterDetail -ClusterDnsName {clusterDnsName} -Username {username} -Password {password} -PropertyName FQDNSuffix\n                 This command shows the FQDN suffix of hosts in the cluster.\n            #>\n\n                $DnsSuffix = \".azurehdinsight.net\"\n\n                $ClusterFQDN = $ClusterDnsName + $DnsSuffix\n                $webclient = new-object System.Net.WebClient\n                $webclient.Credentials = new-object System.Net.NetworkCredential($Username, $Password)\n\n                if($PropertyName -eq \"ZookeeperQuorum\")\n                {\n                    $Url = \"https://\" + $ClusterFQDN + \"/ambari/api/v1/clusters/\" + $ClusterFQDN + \"/configurations?type=hbase-site&tag=default&fields=items/properties/hbase.zookeeper.quorum\"\n                    $Response = $webclient.DownloadString($Url)\n                    $JsonObject = $Response | ConvertFrom-Json\n                    Write-host $JsonObject.items[0].properties.'hbase.zookeeper.quorum'\n                }\n                if($PropertyName -eq \"ZookeeperClientPort\")\n                {\n                    $Url = \"https://\" + $ClusterFQDN + \"/ambari/api/v1/clusters/\" + $ClusterFQDN + \"/configurations?type=hbase-site&tag=default&fields=items/properties/hbase.zookeeper.property.clientPort\"\n                    $Response = $webclient.DownloadString($Url)\n                    $JsonObject = $Response | ConvertFrom-Json\n                    Write-host $JsonObject.items[0].properties.'hbase.zookeeper.property.clientPort'\n                }\n                if($PropertyName -eq \"HBaseRestServers\")\n                {\n                    $Url1 = \"https://\" + $ClusterFQDN + \"/ambari/api/v1/clusters/\" + $ClusterFQDN + \"/configurations?type=hbase-site&tag=default&fields=items/properties/hbase.rest.port\"\n                    $Response1 = $webclient.DownloadString($Url1)\n                    $JsonObject1 = $Response1 | ConvertFrom-Json\n                    $PortNumber = $JsonObject1.items[0].properties.'hbase.rest.port'\n\n                    $Url2 = \"https://\" + $ClusterFQDN + \"/ambari/api/v1/clusters/\" + $ClusterFQDN + \"/services/hbase/components/hbrest\"\n                    $Response2 = $webclient.DownloadString($Url2)\n                    $JsonObject2 = $Response2 | ConvertFrom-Json\n                    foreach ($host_component in $JsonObject2.host_components)\n                    {\n                        $ConnectionString = $host_component.HostRoles.host_name + \":\" + $PortNumber\n                        Write-host $ConnectionString\n                    }\n                }\n                if($PropertyName -eq \"FQDNSuffix\")\n                {\n                    $Url = \"https://\" + $ClusterFQDN + \"/ambari/api/v1/clusters/\" + $ClusterFQDN + \"/services/yarn/components/resourcemanager\"\n                    $Response = $webclient.DownloadString($Url)\n                    $JsonObject = $Response | ConvertFrom-Json\n                    $FQDN = $JsonObject.host_components[0].HostRoles.host_name\n                    $pos = $FQDN.IndexOf(\".\")\n                    $Suffix = $FQDN.Substring($pos + 1)\n                    Write-host $Suffix\n                }\n            }\n\n        After running the Azure PowerShell script, use the following command to return the DNS suffix by using the **Get-ClusterDetail** function. Specify your HDInsight HBase cluster name, admin name, and admin password when using this command.\n\n            Get-ClusterDetail -ClusterDnsName <yourclustername> -PropertyName FQDNSuffix -Username <clusteradmin> -Password <clusteradminpassword>\n\n        This will return the DNS suffix. For example, **yourclustername.b4.internal.cloudapp.net**.\n\n    > [AZURE.NOTE] You can also use Remote Desktop to connect to the HBase cluster (you will be connected to the head node) and run **ipconfig** from a command prompt to obtain the DNS suffix. For instructions on enabling Remote Desktop Protocol (RDP) and connecting to the cluster by using RDP, see [Manage Hadoop clusters in HDInsight using the Azure portal][hdinsight-admin-portal].\n    >\n    > ![hdinsight.hbase.dns.surffix][img-dns-surffix]\n\n\n<!--\n3.  Change the primary DNS suffix configuration of the virtual machine. This enables the virtual machine to automatically resolve the host name of the HBase cluster without explicit specification of the suffix. For example, the *workernode0* host name will be correctly resolved to workernode0 of the HBase cluster.\n\n    To make the configuration change:\n\n    1. RDP into the virtual machine.\n    2. Open **Local Group Policy Editor**. The executable is gpedit.msc.\n    3. Expand **Computer Configuration**, expand **Administrative Templates**, expand **Network**, and then click **DNS Client**.\n    - Set **Primary DNS Suffix** to the value obtained in step 2:\n\n        ![hdinsight.hbase.primary.dns.suffix][img-primary-dns-suffix]\n    4. Click **OK**.\n    5. Reboot the virtual machine.\n-->\n\nTo verify that the virtual machine can communicate with the HBase cluster, use the command `ping headnode0.<dns suffix>` from the virtual machine. For example, ping headnode0.mycluster.b1.cloudapp.net.\n\nTo use this information in a Java application, you can follow the steps in [Use Maven to build Java applications that use HBase with HDInsight (Hadoop)](hdinsight-hbase-build-java-maven.md) to create an application. To have the application connect to a remote HBase server, modify the **hbase-site.xml** file in this example to use the FQDN for Zookeeper. For example:\n\n    <property>\n        <name>hbase.zookeeper.quorum</name>\n        <value>zookeeper0.<dns suffix>,zookeeper1.<dns suffix>,zookeeper2.<dns suffix></value>\n    </property>\n\n> [AZURE.NOTE] For more information on name resolution in Azure virtual networks, including how to use your own DNS server, see [Name Resolution (DNS)](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md).\n\n##Next steps\n\nIn this tutorial you learned how to create an HBase cluster. To learn more, see:\n\n- [Get started with HDInsight](hdinsight-hadoop-linux-tutorial-get-started.md)\n- [Configure HBase replication in HDInsight](hdinsight-hbase-geo-replication.md)\n- [Create Hadoop clusters in HDInsight](hdinsight-provision-clusters.md)\n- [Get started using HBase with Hadoop in HDInsight](hdinsight-hbase-tutorial-get-started.md)\n- [Analyze Twitter sentiment with HBase in HDInsight](hdinsight-hbase-analyze-twitter-sentiment.md)\n- [Virtual Network Overview][vnet-overview]\n\n\n[1]: http://azure.microsoft.com/services/virtual-network/\n[2]: http://technet.microsoft.com/library/ee176961.aspx\n[3]: http://technet.microsoft.com/library/hh847889.aspx\n\n[hbase-get-started]: hdinsight-hbase-tutorial-get-started.md\n[hbase-twitter-sentiment]: hdinsight-hbase-analyze-twitter-sentiment.md\n[vnet-overview]: ../virtual-network/virtual-networks-overview.md\n[vm-create]: ../virtual-machines/virtual-machines-windows-tutorial.md\n\n[azure-portal]: https://portal.azure.com\n[azure-create-storageaccount]: ../storage-create-storage-account.md\n[azure-purchase-options]: http://azure.microsoft.com/pricing/purchase-options/\n[azure-member-offers]: http://azure.microsoft.com/pricing/member-offers/\n[azure-free-trial]: http://azure.microsoft.com/pricing/free-trial/\n\n[hdinsight-admin-powershell]: hdinsight-administer-use-powershell.md\n[hdinsight-admin-portal]: hdinsight-administer-use-management-portal.md#rdp\n\n[hdinsight-powershell-reference]: https://msdn.microsoft.com/library/dn858087.aspx\n\n\n[twitter-streaming-api]: https://dev.twitter.com/docs/streaming-apis\n[twitter-statuses-filter]: https://dev.twitter.com/docs/api/1.1/post/statuses/filter\n\n\n[powershell-install]: powershell-install-configure.md\n\n\n[hdinsight-customize-cluster]: hdinsight-hadoop-customize-cluster.md\n[hdinsight-provision]: hdinsight-provision-clusters.md\n[hdinsight-get-started]: hdinsight-hadoop-linux-tutorial-get-started.md\n[hdinsight-storage-powershell]: ../hdinsight-hadoop-use-blob-storage.md#powershell\n[hdinsight-analyze-flight-delay-data]: hdinsight-analyze-flight-delay-data.md\n[hdinsight-storage]: ../hdinsight-hadoop-use-blob-storage.md\n[hdinsight-use-sqoop]: hdinsight-use-sqoop.md\n[hdinsight-power-query]: hdinsight-connect-excel-power-query.md\n[hdinsight-hive-odbc]: hdinsight-connect-excel-hive-ODBC-driver.md\n[hdinsight-hbase-replication-dns]: hdinsight-hbase-geo-replication-configure-DNS.md\n\n[img-dns-surffix]: ./media/hdinsight-hbase-provision-vnet/DNSSuffix.png\n[img-primary-dns-suffix]: ./media/hdinsight-hbase-provision-vnet/PrimaryDNSSuffix.png\n[img-provision-cluster-page1]: ./media/hdinsight-hbase-provision-vnet/hbasewizard1.png \"Provision details for the new HBase cluster\"\n[img-provision-cluster-page5]: ./media/hdinsight-hbase-provision-vnet/hbasewizard5.png \"Use Script Action to customize an HBase cluster\"\n\n[azure-preview-portal]: https://portal.azure.com\n"
}