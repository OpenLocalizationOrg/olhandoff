#DSC для Linux nxFile ресурсов

**NxFile** ресурсов в PowerShell требуемой состояние конфигурации (DSC) предоставляет механизм для управления файлами и каталогами на узел Linux.

##Синтаксис

```
nxFile <string> #ResourceName
{
    DestinationPath = <string>
    [ SourcePath = <string> ]
    [ Ensure = <string> { Absent | Present }  ]
    [ Type = <string> { directory | file | link } ]
    [ Contents = <string> ]
    [ Checksum = <string> { ctime | mtime | md5 }  ]
    [ Recurse = <bool> ]
    [ Force = <bool> ]
    [ Links = <string> { follow | manage } ]
    [ Group = <string> ]
    [ Mode = <string> ]
    [ Owner = <string> ]
    [ DependsOn = <string[]> ]

}
```

##Свойства

| Свойство| Описание|
|---|---|
| DestinationPath| Указывает расположение, где требуется обеспечить состояние файла или каталога.|
| SourcePath| Указывает путь, из которого необходимо скопировать файл или папку ресурсов.Этот путь может быть локальным путем или `http, https и ftp` URL-адрес.Удаленный `http, https и ftp` URL-адреса являются только поддерживается, если значение **тип** свойство является файл.|
| Убедитесь| Определяет, следует проверить, существует ли файл.Установите это свойство для «Отсутствует», чтобы убедиться, что файл существует.Задайте для него значение «Отсутствует», чтобы убедиться, что файл не существует.Значение по умолчанию — «Отсутствует».|
| Type| Указывает, является ли ресурс выполняется настройка каталога или файла.Установите это свойство «каталог», чтобы указать, что ресурс является каталог.Задайте как «файл» означает файл ресурса.Значение по умолчанию — «файла»|
| Содержимое| Задает содержимое файла, например определенной строки.|
| Контрольная сумма| Определяет тип для определения того, совпадают ли два файла.Если **контрольной суммы** не указан, только имя файла или каталога, используемого для сравнения.Значения: «ctime», «mtime» или «md5».|
| Recurse| Указывает, включены ли вложенные папки.Присвойте этому свойству значение **$true** чтобы указать, что вложенные папки должны быть включены.Значение по умолчанию — **$false**.**Примечание:** данное свойство допустимо только тогда, когда **тип** свойству каталога.|
| Force| Определенных операций с файлами (перезаписи файла или при удалении каталога, который не является пустым) приведет к ошибке.С помощью **принудительно** такие ошибки переопределения свойств.Значение по умолчанию — **$false**.|
| Ссылки| Задает желаемое поведение для символических ссылок.Установите это свойство для «отслеживание» выполните символических ссылок и отреагировать на цель ссылки (например,Скопируйте файл вместо ссылки).Установите это свойство для «управление» (например, действующие как ссылкуСкопируйте сама ссылка).Свойство «игнорировать», чтобы игнорировать символических ссылок.|
| Группы| Имя **группы** владельца файла или каталога.|
| Режим| Указывает нужные разрешения для ресурса, в восьмеричной или символьные нотации.(например, 777 или rwxrwxrwx).Если символьные нотации, не обеспечивают первый символ, который указывает каталог или файл.|
| DependsOn| Указывает, что конфигурация другого ресурса должна выполняться перед настройкой этого ресурса.Например если **идентификатор** ресурса блок скрипта конфигурации, необходимо запустить сначала — **ResourceName** и его тип является **типа ресурса**, синтаксис для использования этого свойства `DependsOn = "[типа ресурса] ResourceName"`.|

##Дополнительные сведения

Linux и Windows использовать символы разрыва строки в другой в текстовых файлов по умолчанию, и это может привести к непредвиденным результатам при настройке некоторых файлов на компьютере Linux с __nxFile__. Для управления содержимым файла Linux избегая проблем, вызванных символы разрыва строки непредвиденные несколькими способами:

Шаг 1: Скопируйте файл из удаленного источника (http, https или ftp): создайте файл на Linux на нужное содержимое и размещения на сервере веб- или ftp доступен узлы, необходимо настроить. Определение __SourcePath__ свойства __nxFile__ ресурсов на веб- или ftp URL-адрес к файлу.

```
Import-DSCResource -Module nx
Node $Node
{
nxFile resolvConf
{
    SourcePath = "http://10.185.85.11/conf/resolv.conf"
    DestinationPath = "/etc/resolv.conf"
    Mode = "644"        
    Type = "file"

}

}
```


Шаг 2: Чтение содержимого файла сценария PowerShell с [Get-Content](https://technet.microsoft.com/en-us/library/hh849787.aspx) после установки __$OFS__ свойство для использования символа новой строки Linux.


```
Import-DSCResource -Module nx
Node $Node
{
$OFS = "`n"
$Contents = Get-Content C:\temp\resolv.conf

nxFile resolvConf
{
    DestinationPath = "/etc/resolv.conf"
    Mode = "644"        
    Type = "file"
    Contents = "$Contents"
}

}
```


Шаг 3: PowerShell функция позволяет заменить символы разрыва строки Linux разрывы строк Windows.

```
Function LinuxString($inputStr){
    $outputStr = $inputStr.Replace("`r`n","`n")
    $ouputStr += "`n"
    Return $outputStr
}

Import-DSCResource -Module nx
Node $Node
{

$Contents = @'
search contoso.com
domain contoso.com
nameserver 10.185.85.11
'@

$Contents = LinuxString $Contents

nxFile resolvConf
{
    DestinationPath = "/etc/resolv.conf"
    Mode = "644"        
    Type = "file"
    Contents = $Contents

}
}
```

##Пример

Следующий пример проверяет, что каталог `/opt/mydir` существует, и что этот каталог существует файл с указанным содержимым.

```
Import-DSCResource -Module nx 

Node $node {
nxFile DirectoryExample
{
   Ensure = "Present"
   DestinationPath = "/opt/mydir"
   Type = "Directory"
}

nxFile FileExample
{
    Ensure = "Present"
    Destinationpath = "/opt/mydir/myfile"
    Contents=@"
#!/bin/bash`necho "hello world"`n
"@ 
    Mode = “755”
    DependsOn = "[nxFile]DirectoryExample"
} 
}
```





