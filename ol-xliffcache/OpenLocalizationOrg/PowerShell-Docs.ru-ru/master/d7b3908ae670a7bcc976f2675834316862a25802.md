#Настройка локальных Configuration Manager

> Область применения: Windows PowerShell 5.0

Локальный диспетчер конфигурации (НОК) — это подсистема обработки из Windows PowerShell требуемой состояние конфигурации (DSC). НОК выполняется на каждом конечном узле, а также отвечает за синтаксический анализ и введение в действие конфигурации, которые передаются на узел. Он также отвечает за ряд других аспектов DSC, включая следующие.

* Определение режима обновления (Принудительная или по запросу).
* Указание частоты узел извлекает и вводит в действие конфигурации.
* Связывание узла с серверов по запросу.
* Определение разделяемого конфигураций.

Настройка НОК для указания поведения используйте специальный тип конфигурации. Настройка НОК в следующих разделах.

> **Примечание**: этот раздел относится к НОК, появившихся в Windows PowerShell 5.0. Сведения о настройке НОК в Windows PowerShell 4.0 Windows PowerShell 4.0 требуемой состояние конфигурации локальной Configuration Manager см.

##Написание и введение в действие конфигурации НОК

Настройка НОК, создайте и запустите это специальный тип конфигурации. Чтобы указать НОК конфигурации, используется атрибут DscLocalConfigurationManager. Ниже приведен простой конфигурации, присваивает НОК режим push.

```powershell
[DSCLocalConfigurationManager()]
configuration LCMConfig
{
    Node localhost
    {
        Settings
        {
            RefreshMode = 'Push'
        }
    }
} 
```

Вызов и запуск средства настройки для создания конфигурации MOF, так же, как и обычные конфигурации (Дополнительные сведения о создании конфигурации MOF см. Приступая к работе с требуемой конфигурации состояния Windows PowerShell). В отличие от обычных конфигураций не внедрения НОК конфигурации путем вызова [начала DscConfiguration](https://technet.microsoft.com/en-us/library/dn521623.aspx) командлета. Вместо этого вызовите командлет Set-DscLocalConfigurationManager, указав путь к MOF в качестве параметра конфигурации. После вы применения конфигурации, можно просмотреть свойства НОК путем вызова [Get DscLocalConfigurationManager](https://technet.microsoft.com/en-us/library/dn407378.aspx) командлета.

НОК конфигурации может содержать блоки только для ограниченного набора ресурсов. В предыдущем примере, является единственным ресурсу с именем **Параметры**. Ниже перечислены доступные ресурсы

* **ConfigurationRepositoryWeb**: Определяет сервер по запросу HTTP для конфигураций.
* **ConfigurationRepositoryShare**: Определяет сервер по запросу SMB для конфигураций.
* **ResourceRepositoryWeb**: Определяет сервер по запросу HTTP для модулей.
* **ResourceRepositoryShare**: Определяет сервер по запросу SMB для модулей.
* **ReportServerWeb**: Определяет сервер по запросу HTTP, на который отправляются отчеты.
* **PartialConfiguration**: задает частичного конфигураций.

##Основные параметры

Кроме указания серверов по запросу и частичные конфигураций, все свойства НОК настраиваются в **Параметры** блока. Следующие свойства доступны в **Параметры** блока.

| Свойство| Type| Описание|
|--- |--- |---|
| ConfigurationModeFrequencyMins| UInt32| Как часто в минутах, в текущей конфигурации установлен и применяется.Это свойство игнорируется, если свойство ConfigurationMode имеет значение ApplyOnly.Значение по умолчанию — 15.__Примечание__: значение этого свойства должно быть кратно значение __RefreshFrequencyMins__ свойство или значение __RefreshFrequencyMins__ свойство должно быть кратно значение этого свойства.|
| RebootNodeIfNeeded| bool| Задайте для этого __$true__ автоматически перезагрузить узел после конфигурацию, которая требует перезагрузки применяется.В противном случае необходимо вручную перезагрузите узел для любой конфигурации, требующей.Значение по умолчанию — __$false__.|
| ConfigurationMode| строка| Указывает, как НОК фактически применяет конфигурацию целевые узлы.Он может принимать следующие значения: __«ApplyOnly»__: DSC применяет конфигурацию и не выполняет никаких действий дальнейшей Если новая конфигурация не помещается в целевой узел или новую конфигурацию извлекается с сервера.После начального приложения новой конфигурации DSC не проверяет наличие смещения из ранее настроенного состояния.__«ApplyAndMonitor»__: значение по умолчанию.НОК применяет любые новые конфигурации.После начального приложения новой конфигурации, если целевой узел drifts из требуемое состояние DSC сообщает несоответствие в журналах __«ApplyAndAutoCorrect»__: DSC применяет все новые параметры конфигурации.После начального приложения новой конфигурации Если целевой узел drifts из требуемое состояние DSC сообщает несоответствие в журналах и повторное применение текущей конфигурации.|
| ActionAfterReboot| строка| Указывает, что происходит во время применения конфигурации после перезагрузки.Возможными значениями являются следующие: __"ContuinueConfiguration"__: продолжить применение текущей конфигурации.__" StopConfiguraiton»__: Остановка текущей конфигурации.|
| Значение параметра RefreshMode| строка| Указывает, каким образом НОК Возвращает конфигурации.Возможными значениями являются следующие: __«Disabled»__: конфигураций DSC отключены для этого узла.__«Push»__: конфигураций инициируются путем вызова командлет Start-DscConfiguration.Конфигурация сразу же применяется к узлу.Это значение по умолчанию.__По запросу:__ узел настроен для регулярной проверки конфигурации с сервера по запросу.Если это свойство имеет значение по запросу, необходимо указать сервер по запросу в __ConfigurationRepositoryWeb__ или __ConfigurationRepositoryShare__ блока.Дополнительные сведения о серверах по запросу см. в разделе [настройки сервера по запросу DSC](pullServer.md).|
| Ид_сертификата| строка| Идентификатор GUID, который указывает сертификат, используемый для защиты учетных данных для доступа к конфигурации.Дополнительные сведения см. [необходимо обеспечить безопасность учетных данных в требуемой конфигурации состояния Windows PowerShell](http://blogs.msdn.com/b/powershell/archive/2014/01/31/want-to-secure-credentials-in-windows-powershell-desired-state-configuration.aspx)?.|
| ConfigurationID| строка| Идентификатор GUID, определяющий файл конфигурации для получения с сервера по запросу в режиме по запросу.Узел будет извлекать sever конфигураций в по запросу, если имя конфигурации MOF называется ConfigurationID.mof.__Примечание:__ Если это свойство задано, регистрации узла с сервером по запросу с помощью __RegistryKeys__ и не работает.Дополнительные сведения см. в разделе [установке клиента по запросу с именами конфигурации](pullClientConfigNames.md).|
| RefreshFrequencyMins| Uint32| Интервал времени в минутах, в которых НОК проверяет сервер по запросу для получения обновленной конфигурации.Это значение игнорируется, если НОК не настроен в режиме по запросу.Значение по умолчанию — 30.__Примечание:__  значение этого свойства должно быть кратно значение __ConfigurationModeFrequencyMins__ свойство или значение __ConfigurationModeFrequencyMins__ свойство должно быть кратно значение этого свойства.|
| AllowModlueOverwrite| bool| __$TRUE__ Если новые конфигурации, загруженного из конфигурации сервера разрешается перезапись старых на целевом узле.В противном случае — значение $FALSE.|
| DebugMode| bool| Если значение __$TRUE__, даже если они были предварительно кэшированы результате НОК перезагрузить все ресурсы DSC.Значение $FALSE, чтобы использовать кэшированные ресурсы.Обычно это свойство задается __$TRUE__ во время отладки ресурса, а также __$FALSE__ для рабочей среды.Значение по умолчанию — __$FALSE__.|
| ConfigurationDownloadManagers| Объект CimInstance]| Устаревшие.Используйте __ConfigurationRepositoryWeb__ и __ConfigurationRepositoryShare__ блоков для определения конфигурации серверов по запросу.|
| ResourceModuleManagers| Объект CimInstance]| Устаревшие.Используйте __ResourceRepositoryWeb__ и __ResourceRepositoryShare__ блоков для определения ресурсов по запросу серверов.|
| ReportManagers| Объект CimInstance]| Устаревшие.Используйте __ReportServerWeb__ блоков для определения отчета по запросу серверов.|
| PartialConfigurations| Объект CimInstance| Не реализовано.Не следует использовать.|
| StatusRetentionTimeInDays| UInt32| Число дней, на которое НОК отслеживает состояние текущей конфигурации.|

##Серверы по запросу

Сервер по запросу — OData веб-службы или к общему ресурсу SMB, который используется в качестве центрального расположения для файлов DSC. НОК конфигурации поддерживает определение следующие типы серверов по запросу:

* **Конфигурации сервера**: репозитория для конфигураций DSC. Определение конфигурации серверами с помощью **ConfigurationRepositoryWeb** (для веб-серверов) и **ConfigurationRepositoryShare** (для серверов на основе SMB) блоков.
* Сервер ресурсов — репозиторий для ресурсов DSC, представлена в виде модули PowerShell. Определение ресурсов серверами с помощью **ResourceRepositoryWeb** (для веб-серверов) и **ResourceRepositoryShare** (для серверов на основе SMB) блоков.
* Сервер отчетов — DSC отправление данных отчета. Определение серверов отчетов с помощью **ReportServerWeb** блоков. Сервер отчетов должен быть веб-службы.

Сведения о настройке и использовании серверов по запросу см. [настройки сервера по запросу DSC](pullServer.md).

##Блоки конфигурации сервера

Чтобы определить конфигурацию веб-сервере, можно создать **ConfigurationRepositoryWeb** блока. Объект **ConfigurationRepositoryWeb** определяет следующие свойства.

| Свойство| Type| Описание|
|---|---|---|
| AllowUnsecureConnection| bool| Значение **$TRUE** для подключений с узла на сервер без проверки подлинности.Значение **$FALSE** требуется проверка подлинности.|
| Ид_сертификата| строка| Идентификатор GUID, представляющий сертификат, используемый для проверки подлинности на сервере.|
| ConfigurationNames| String[]| Массив имен конфигураций опрашиваемых по целевой узел.Они используются только в том случае, если узел зарегистрирован на сервере по запросу с использованием **RegistrationKey**.Дополнительные сведения см. в разделе [установке клиента по запросу с именами конфигурации](pullClientConfigNames.md).|
| RegistrationKey| строка| Идентификатор GUID, который регистрирует узел с сервером по запросу.Дополнительные сведения см. в разделе [установке клиента по запросу с именами конфигурации](pullClientConfigNames.md).|
| ServerURL| строка| URL-адрес сервера конфигурации.|

Чтобы определить сервер конфигурации на основе SMB, создать **ConfigurationRepositoryShare** блока. Объект **ConfigurationRepositoryShare** определяет следующие свойства.

| Свойство| Type| Описание|
|---|---|---|
| Учетные данные| MSFT_Credential| Учетные данные, используемые для проверки подлинности к общей папке SMB.|
| SourcePath| строка| Путь к общему ресурсу SMB.|

##Блоки ресурсов сервера

Для определения ресурса веб-сервере, можно создать **ResourceRepositoryWeb** блока. Объект **ResourceRepositoryWeb** определяет следующие свойства.

| Свойство| Type| Описание|
|---|---|---|
| AllowUnsecureConnection| bool| Значение **$TRUE** для подключений с узла на сервер без проверки подлинности.Значение **$FALSE** требуется проверка подлинности.|
| Ид_сертификата| строка| Идентификатор GUID, представляющий сертификат, используемый для проверки подлинности на сервере.|
| RegistrationKey| строка| Идентификатор GUID, который определяет узел к серверу по запросу.Дополнительные сведения см. в разделе как зарегистрировать узел с сервером по запросу DSC.|
| ServerURL| строка| URL-адрес сервера конфигурации.|

Определение ресурсов на основе SMB сервера, создание **ResourceRepositoryShare** блока. **ResourceRepositoryShare** определяет следующие свойства.

| Свойство| Type| Описание|
|---|---|---|
| Учетные данные| MSFT_Credential| Учетные данные, используемые для проверки подлинности к общей папке SMB.|
| SourcePath| строка| Путь к общему ресурсу SMB.|

##Блоки сервера отчетов

Сервер отчетов должен быть веб-службы с OData. Чтобы определить сервер отчетов, следует создать **ReportServerWeb** блока. **ReportServerWeb** определяет следующие свойства.

| Свойство| Type| Описание|
|---|---|---|
| AllowUnsecureConnection| bool| Значение **$TRUE** для подключений с узла на сервер без проверки подлинности.Значение **$FALSE** требуется проверка подлинности.|
| Ид_сертификата| строка| Идентификатор GUID, представляющий сертификат, используемый для проверки подлинности на сервере.|
| RegistrationKey| строка| Идентификатор GUID, который определяет узел к серверу по запросу.Дополнительные сведения см. в разделе как зарегистрировать узел с сервером по запросу DSC.|
| ServerURL| строка| URL-адрес сервера конфигурации.|

##Частичное конфигураций

Чтобы определить частичной конфигурации, следует создать **PartialConfiguration** блока. Дополнительные сведения о частичной конфигурации в разделе [конфигурации частичного DSC](partialConfigs.md). **PartialConfiguration** определяет следующие свойства.

| Свойство| Type| Описание|
|---|---|---|
| ConfigurationSource| string[]| Массив имен серверов конфигурации, определенных ранее в **ConfiguratoinRepositoryWeb** и **ConfigurationRepositoryShare** блоки, где изымается из частичной конфигурации.|
| DependsOn| Строка {}| Список имен других конфигураций, которые должны быть завершены перед применением этой частичной конфигурации.|
| Описание| строка| Текст, используемый для описания частичной конфигурации.|
| ExclusiveResources| string[]| Массив исключительно для этой конфигурации частичного ресурсы.|
| Значение параметра RefreshMode| строка| Указывает, как контроллеры домена получает конфигурацию частичного...Возможными значениями являются следующие: **Отключено**: Эта конфигурация частичного отключена.**Push**: частичной конфигурации помещается на узел путем вызова [публикации DscConfiguration](https://technet.microsoft.com/en-us/library/mt517875.aspx) командлета.Запускается после все частичные конфигурации узла отправлена или полученных с сервера, конфигурации путем вызова `DscConfiguration начала — UseExisting`.Это значение по умолчанию.**По запросу**: узел настроен для регулярной проверки частичной конфигурации с сервера по запросу.Если это свойство имеет значение «По запросу», необходимо указать сервер по запросу, задав **ConfigurationSource** свойства.Дополнительные сведения о серверах по запросу см. в разделе [настройки сервера по запросу DSC](pullServer.md).|
| ResourceModlueSource| string[]| Массив имен серверов ресурсов, из которой следует загрузить необходимые ресурсы для этой конфигурации частичного.Эти имена должны ссылаться на серверах ресурсов, определенных ранее в **ResourceRepositoryWeb** и **ResourceRepositoryShare** блоков.|

##См. также

###Основные понятия

Приступая к работе с Windows PowerShell нужное состояние конфигурации 
[Настройка сервера DSC по запросу](pullServer.md) 
[Windows PowerShell 4.0 требуемой состояния конфигурации локальной Configuration Manager](metaConfig4.md)

###Другие ресурсы

[Набор DscLocalConfigurationManager](https://technet.microsoft.com/en-us/library/dn521621.aspx) 
[Настройка клиента по запросу с именами конфигурации](pullClientConfigNames.md)




