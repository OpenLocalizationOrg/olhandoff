{
  "nodes": [
    {
      "content": "Manage and monitor Azure virtual machine backups | Microsoft Azure",
      "pos": [
        28,
        94
      ]
    },
    {
      "content": "Learn how to manage and monitor an Azure virtual machine backups",
      "pos": [
        113,
        177
      ]
    },
    {
      "content": "Manage and monitor Azure virtual machine backups",
      "pos": [
        503,
        551
      ]
    },
    {
      "content": "Manage protected virtual machines",
      "pos": [
        556,
        589
      ]
    },
    {
      "content": "To manage protected virtual machines:",
      "pos": [
        591,
        628
      ]
    },
    {
      "pos": [
        633,
        724
      ],
      "content": "To view and manage backup settings for a virtual machine click the <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> tab."
    },
    {
      "pos": [
        729,
        852
      ],
      "content": "Click on the name of a protected item to see the <bpt id=\"p1\">**</bpt>Backup Details<ept id=\"p1\">**</ept> tab, which shows you information about the last backup."
    },
    {
      "content": "Virtual machine backup",
      "pos": [
        860,
        882
      ]
    },
    {
      "pos": [
        942,
        1033
      ],
      "content": "To view and manage backup policy settings for a virtual machine click the <bpt id=\"p1\">**</bpt>Policies<ept id=\"p1\">**</ept> tab."
    },
    {
      "content": "Virtual machine policy",
      "pos": [
        1041,
        1063
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Backup Policies<ept id=\"p1\">**</ept> tab shows you the existing policy.",
      "pos": [
        1130,
        1188
      ]
    },
    {
      "content": "You can modify as needed.",
      "pos": [
        1189,
        1214
      ]
    },
    {
      "content": "If you need to create a new policy click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>Policies<ept id=\"p2\">**</ept> page.",
      "pos": [
        1215,
        1292
      ]
    },
    {
      "content": "Note that if you want to remove a policy it shouldn't have any virtual machines associated with it.",
      "pos": [
        1293,
        1392
      ]
    },
    {
      "content": "Virtual machine policy",
      "pos": [
        1400,
        1422
      ]
    },
    {
      "content": "You can get more information about actions or status for a virtual machine on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> page.",
      "pos": [
        1481,
        1577
      ]
    },
    {
      "content": "Click a job in the list to get more details, or filter jobs for a specific virtual machine.",
      "pos": [
        1578,
        1669
      ]
    },
    {
      "content": "Jobs",
      "pos": [
        1677,
        1681
      ]
    },
    {
      "content": "On-demand backup of a virtual machine",
      "pos": [
        1735,
        1772
      ]
    },
    {
      "content": "You can take an on-demand backup of a virtual machine once it is configured for protection.",
      "pos": [
        1773,
        1864
      ]
    },
    {
      "content": "If the initial backup is pending for the virtual machine, on-demand backup will create a full copy of the virtual machine in Azure backup vault.",
      "pos": [
        1865,
        2009
      ]
    },
    {
      "content": "If first backup is completed, on-demand backup will only send changes from previous backup to Azure backup vault.",
      "pos": [
        2010,
        2123
      ]
    },
    {
      "content": "To take an on-demand backup of a virtual machine:",
      "pos": [
        2125,
        2174
      ]
    },
    {
      "pos": [
        2179,
        2326
      ],
      "content": "Navigate to the <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> page and select <bpt id=\"p2\">**</bpt>Azure Virtual Machine<ept id=\"p2\">**</ept> as <bpt id=\"p3\">**</bpt>Type<ept id=\"p3\">**</ept> (if not already selected) and click on <bpt id=\"p4\">**</bpt>Select<ept id=\"p4\">**</ept> button."
    },
    {
      "content": "VM Type",
      "pos": [
        2334,
        2341
      ]
    },
    {
      "pos": [
        2392,
        2526
      ],
      "content": "Select the virtual machine on which you want to take an on-demand backup and click on <bpt id=\"p1\">**</bpt>Backup Now<ept id=\"p1\">**</ept> button at the bottom of the page."
    },
    {
      "content": "Back up now",
      "pos": [
        2534,
        2545
      ]
    },
    {
      "content": "This will create a backup job on the selected virtual machine.",
      "pos": [
        2600,
        2662
      ]
    },
    {
      "content": "Retention range of recovery point created through this job will be same as that specified in the policy associated with the virtual machine.",
      "pos": [
        2663,
        2803
      ]
    },
    {
      "content": "Creating backup job",
      "pos": [
        2811,
        2830
      ]
    },
    {
      "pos": [
        2888,
        3047
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> To view the policy associated with a virtual machine, drill down into virtual machine in the <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> page and go to backup policy tab."
    },
    {
      "pos": [
        3052,
        3177
      ],
      "content": "Once the job is created, you can click on <bpt id=\"p1\">**</bpt>View job<ept id=\"p1\">**</ept> button in the toast bar to see the corresponding job in the jobs page."
    },
    {
      "content": "Backup job created",
      "pos": [
        3185,
        3203
      ]
    },
    {
      "content": "After successful completion of the job, a recovery point will be created which you can use to restore the virtual machine.",
      "pos": [
        3258,
        3380
      ]
    },
    {
      "content": "This will also increment the recovery point column value by 1 in <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> page.",
      "pos": [
        3381,
        3471
      ]
    },
    {
      "content": "Stop protecting virtual machines",
      "pos": [
        3476,
        3508
      ]
    },
    {
      "content": "You can choose to stop the future backups of a virtual machine with the following options:",
      "pos": [
        3509,
        3599
      ]
    },
    {
      "content": "Retain backup data associated with virtual machine in Azure Backup vault",
      "pos": [
        3603,
        3675
      ]
    },
    {
      "content": "Delete backup data associated with virtual machine",
      "pos": [
        3678,
        3728
      ]
    },
    {
      "content": "If you have selected to retain backup data associated with virtual machine, you can use the backup data to restore the virtual machine.",
      "pos": [
        3730,
        3865
      ]
    },
    {
      "content": "For pricing details for such virtual machines, click <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](https://azure.microsoft.com/pricing/details/backup/)</ept>.",
      "pos": [
        3866,
        3979
      ]
    },
    {
      "content": "To Stop protection for a virtual machine:",
      "pos": [
        3981,
        4022
      ]
    },
    {
      "pos": [
        4027,
        4177
      ],
      "content": "Navigate to <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> page and select <bpt id=\"p2\">**</bpt>Azure virtual machine<ept id=\"p2\">**</ept> as the filter type (if not already selected) and click on <bpt id=\"p3\">**</bpt>Select<ept id=\"p3\">**</ept> button."
    },
    {
      "content": "VM Type",
      "pos": [
        4185,
        4192
      ]
    },
    {
      "pos": [
        4243,
        4329
      ],
      "content": "Select the virtual machine and click on <bpt id=\"p1\">**</bpt>Stop Protection<ept id=\"p1\">**</ept> at the bottom of the page."
    },
    {
      "content": "Stop protection",
      "pos": [
        4337,
        4352
      ]
    },
    {
      "content": "By default, Azure Backup doesn’t delete the backup data associated with the Virtual machine.",
      "pos": [
        4411,
        4503
      ]
    },
    {
      "content": "Confirm stop protection",
      "pos": [
        4511,
        4534
      ]
    },
    {
      "content": "If you want to delete backup data, select the check box.",
      "pos": [
        4602,
        4658
      ]
    },
    {
      "content": "Checkbox",
      "pos": [
        4666,
        4674
      ]
    },
    {
      "content": "Please select a reason for stopping the backup.",
      "pos": [
        4727,
        4774
      ]
    },
    {
      "content": "While this is optional, providing a reason will help Azure Backup to work on the feedback and prioritize the customer scenarios.",
      "pos": [
        4775,
        4903
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>Submit<ept id=\"p1\">**</ept> button to submit the <bpt id=\"p2\">**</bpt>Stop protection<ept id=\"p2\">**</ept> job.",
      "pos": [
        4908,
        4973
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>View Job<ept id=\"p1\">**</ept> to see the corresponding the job in <bpt id=\"p2\">**</bpt>Jobs<ept id=\"p2\">**</ept> page.",
      "pos": [
        4974,
        5046
      ]
    },
    {
      "content": "Stop protection",
      "pos": [
        5054,
        5069
      ]
    },
    {
      "content": "If you have not selected <bpt id=\"p1\">**</bpt>Delete associated backup data<ept id=\"p1\">**</ept> option during <bpt id=\"p2\">**</bpt>Stop Protection<ept id=\"p2\">**</ept> wizard, then post job completion, protection status changes to <bpt id=\"p3\">**</bpt>Protection Stopped<ept id=\"p3\">**</ept>.",
      "pos": [
        5134,
        5313
      ]
    },
    {
      "content": "The data remains with Azure Backup until it is explicitly deleted.",
      "pos": [
        5314,
        5380
      ]
    },
    {
      "content": "You can always delete the data by selecting the virtual machine in the <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> page and clicking <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>.",
      "pos": [
        5381,
        5501
      ]
    },
    {
      "content": "Stopped protection",
      "pos": [
        5509,
        5527
      ]
    },
    {
      "pos": [
        5597,
        5730
      ],
      "content": "If you have selected the <bpt id=\"p1\">**</bpt>Delete associated backup data<ept id=\"p1\">**</ept> option, the virtual machine won’t be part of the <bpt id=\"p2\">**</bpt>Protected Items<ept id=\"p2\">**</ept> page."
    },
    {
      "content": "Re-protect Virtual machine",
      "pos": [
        5735,
        5761
      ]
    },
    {
      "content": "If you have not selected the <bpt id=\"p1\">**</bpt>Delete associate backup data<ept id=\"p1\">**</ept> option in <bpt id=\"p2\">**</bpt>Stop Protection<ept id=\"p2\">**</ept>, you can re-protect the virtual machine by following the steps similar to backing up registered virtual machines.",
      "pos": [
        5762,
        5967
      ]
    },
    {
      "content": "Once protected, this virtual machine will have backup data retained prior to stop protection and recovery points created after re-protect.",
      "pos": [
        5968,
        6106
      ]
    },
    {
      "pos": [
        6108,
        6257
      ],
      "content": "After re-protect, the virtual machine’s protection status will be changed to <bpt id=\"p1\">**</bpt>Protected<ept id=\"p1\">**</ept> if there are recovery points prior to <bpt id=\"p2\">**</bpt>Stop Protection<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Reprotected VM",
      "pos": [
        6263,
        6277
      ]
    },
    {
      "pos": [
        6337,
        6491
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> When re-protecting the virtual machine, you can choose a different policy than the policy with which virtual machine was protected initially."
    },
    {
      "content": "Unregister virtual machines",
      "pos": [
        6496,
        6523
      ]
    },
    {
      "content": "If you want to remove the virtual machine from the backup vault:",
      "pos": [
        6525,
        6589
      ]
    },
    {
      "pos": [
        6594,
        6655
      ],
      "content": "Click on the <bpt id=\"p1\">**</bpt>UNREGISTER<ept id=\"p1\">**</ept> button at the bottom of the page."
    },
    {
      "content": "Disable protection",
      "pos": [
        6663,
        6681
      ]
    },
    {
      "content": "A toast notification will appear at the bottom of the screen requesting confirmation.",
      "pos": [
        6743,
        6828
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>YES<ept id=\"p1\">**</ept> to continue.",
      "pos": [
        6829,
        6855
      ]
    },
    {
      "content": "Disable protection",
      "pos": [
        6863,
        6881
      ]
    },
    {
      "content": "Delete Backup data",
      "pos": [
        6943,
        6961
      ]
    },
    {
      "content": "You can delete the backup data associated with a virtual machine, either:",
      "pos": [
        6962,
        7035
      ]
    },
    {
      "content": "During Stop Protection Job",
      "pos": [
        7039,
        7065
      ]
    },
    {
      "content": "After a stop protection job is completed on a virtual machine",
      "pos": [
        7068,
        7129
      ]
    },
    {
      "pos": [
        7131,
        7270
      ],
      "content": "To delete backup data on a virtual machine, which is in the <bpt id=\"p1\">*</bpt>Protection Stopped<ept id=\"p1\">*</ept> state post successful completion of a <bpt id=\"p2\">**</bpt>Stop Backup<ept id=\"p2\">**</ept> job:"
    },
    {
      "pos": [
        7275,
        7395
      ],
      "content": "Navigate to the <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> page and select <bpt id=\"p2\">**</bpt>Azure Virtual Machine<ept id=\"p2\">**</ept> as <bpt id=\"p3\">*</bpt>type<ept id=\"p3\">*</ept> and click the <bpt id=\"p4\">**</bpt>Select<ept id=\"p4\">**</ept> button."
    },
    {
      "content": "VM Type",
      "pos": [
        7403,
        7410
      ]
    },
    {
      "content": "Select the virtual machine.",
      "pos": [
        7461,
        7488
      ]
    },
    {
      "content": "The virtual machine will be in <bpt id=\"p1\">**</bpt>Protection Stopped<ept id=\"p1\">**</ept> state.",
      "pos": [
        7489,
        7549
      ]
    },
    {
      "content": "Protection stopped",
      "pos": [
        7557,
        7575
      ]
    },
    {
      "pos": [
        7639,
        7693
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>DELETE<ept id=\"p1\">**</ept> button at the bottom of the page."
    },
    {
      "content": "Delete backup",
      "pos": [
        7701,
        7714
      ]
    },
    {
      "pos": [
        7771,
        7892
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Delete backup data<ept id=\"p1\">**</ept> wizard, select a reason for deleting backup data (highly recommended) and click <bpt id=\"p2\">**</bpt>Submit<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Delete backup data",
      "pos": [
        7900,
        7918
      ]
    },
    {
      "content": "This will create a job to delete backup data of selected virtual machine.",
      "pos": [
        7980,
        8053
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>View job<ept id=\"p1\">**</ept> to see corresponding job in Jobs page.",
      "pos": [
        8054,
        8111
      ]
    },
    {
      "content": "Data deletion successful",
      "pos": [
        8119,
        8143
      ]
    },
    {
      "pos": [
        8207,
        8327
      ],
      "content": "Once the job is completed, the entry corresponding to the virtual machine will be removed from <bpt id=\"p1\">**</bpt>Protected items<ept id=\"p1\">**</ept> page."
    },
    {
      "content": "Dashboard",
      "pos": [
        8332,
        8341
      ]
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Dashboard<ept id=\"p1\">**</ept> page you can review information about Azure virtual machines, their storage, and jobs associated with them in the last 24 hours.",
      "pos": [
        8342,
        8491
      ]
    },
    {
      "content": "You can view backup status and any associated backup errors.",
      "pos": [
        8492,
        8552
      ]
    },
    {
      "content": "Dashboard",
      "pos": [
        8556,
        8565
      ]
    },
    {
      "pos": [
        8629,
        8700
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Values in the dashboard are refreshed once every 24 hours."
    },
    {
      "content": "Auditing Operations",
      "pos": [
        8705,
        8724
      ]
    },
    {
      "content": "Azure backup provides review of the \"operation logs\" of backup operations triggered by the customer making it easy to see exactly what management operations were performed on the backup vault.",
      "pos": [
        8725,
        8917
      ]
    },
    {
      "content": "Operations logs enable great post-mortem and audit support for the backup operations.",
      "pos": [
        8918,
        9003
      ]
    },
    {
      "content": "The following operations are logged in Operation logs:",
      "pos": [
        9005,
        9059
      ]
    },
    {
      "content": "Register",
      "pos": [
        9063,
        9071
      ]
    },
    {
      "content": "Unregister",
      "pos": [
        9074,
        9084
      ]
    },
    {
      "content": "Configure protection",
      "pos": [
        9087,
        9107
      ]
    },
    {
      "content": "Backup ( Both scheduled as well as on-demand backup through BackupNow)",
      "pos": [
        9110,
        9180
      ]
    },
    {
      "content": "Restore",
      "pos": [
        9183,
        9190
      ]
    },
    {
      "content": "Stop protection",
      "pos": [
        9193,
        9208
      ]
    },
    {
      "content": "Delete backup data",
      "pos": [
        9211,
        9229
      ]
    },
    {
      "content": "Add policy",
      "pos": [
        9232,
        9242
      ]
    },
    {
      "content": "Delete policy",
      "pos": [
        9245,
        9258
      ]
    },
    {
      "content": "Update policy",
      "pos": [
        9261,
        9274
      ]
    },
    {
      "content": "Cancel job",
      "pos": [
        9277,
        9287
      ]
    },
    {
      "content": "To view operation logs corresponding to a backup vault:",
      "pos": [
        9289,
        9344
      ]
    },
    {
      "pos": [
        9349,
        9444
      ],
      "content": "Navigate to <bpt id=\"p1\">**</bpt>Management services<ept id=\"p1\">**</ept> in Azure portal, and then click the <bpt id=\"p2\">**</bpt>Operation Logs<ept id=\"p2\">**</ept> tab."
    },
    {
      "content": "Operation Logs",
      "pos": [
        9452,
        9466
      ]
    },
    {
      "pos": [
        9518,
        9638
      ],
      "content": "In the filters, select <bpt id=\"p1\">**</bpt>Backup<ept id=\"p1\">**</ept> as <bpt id=\"p2\">*</bpt>Type<ept id=\"p2\">*</ept> and specify the backup vault name in <bpt id=\"p3\">*</bpt>service name<ept id=\"p3\">*</ept> and click on <bpt id=\"p4\">**</bpt>Submit<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Operation Logs Filter",
      "pos": [
        9646,
        9667
      ]
    },
    {
      "pos": [
        9726,
        9839
      ],
      "content": "In the operations logs, select any operation and click  <bpt id=\"p1\">**</bpt>Details<ept id=\"p1\">**</ept> to see details corresponding to an operation."
    },
    {
      "content": "Operation Logs-Fetching details",
      "pos": [
        9847,
        9878
      ]
    },
    {
      "pos": [
        9939,
        10101
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Details wizard<ept id=\"p1\">**</ept> contains information about the operation triggered, job Id, resource on which this operation is triggered, and start time of the operation."
    },
    {
      "content": "Operation Details",
      "pos": [
        10109,
        10126
      ]
    },
    {
      "content": "Alert notifications",
      "pos": [
        10193,
        10212
      ]
    },
    {
      "content": "You can get custom alert notifications for the jobs in portal.",
      "pos": [
        10213,
        10275
      ]
    },
    {
      "content": "This is achieved by defining PowerShell based alert rules on operational logs events.",
      "pos": [
        10276,
        10361
      ]
    },
    {
      "content": "Event based alerts work in Azure resource mode.",
      "pos": [
        10363,
        10410
      ]
    },
    {
      "content": "Switch to Azure Resource mode by executing following cmdlet in elevated command mode:",
      "pos": [
        10411,
        10496
      ]
    },
    {
      "content": "To define a custom notification to alert for backup failures, a sample command will look like:",
      "pos": [
        10553,
        10647
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>ResourceId<ept id=\"p1\">**</ept>: You can get this from Operations Logs popup as described in above section.",
      "pos": [
        11397,
        11487
      ]
    },
    {
      "content": "ResourceUri in details popup window of an operation is the ResourceId to besupplied for this cmdlet.",
      "pos": [
        11488,
        11588
      ]
    },
    {
      "pos": [
        11590,
        11813
      ],
      "content": "<bpt id=\"p1\">**</bpt>EventName<ept id=\"p1\">**</ept>: For alerts on IaaS VM backup, supported values are - Register,Unregister,ConfigureProtection,Backup,Restore,StopProtection,DeleteBackupData,CreateProtectionPolicy,DeleteProtectionPolicy,UpdateProtectionPolicy"
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Level<ept id=\"p1\">**</ept>: Supported values are - Informational, Error.",
      "pos": [
        11815,
        11870
      ]
    },
    {
      "content": "For alerts on failed action use Error and for alerts on successful jobs use Informational.",
      "pos": [
        11871,
        11961
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>OperationName<ept id=\"p1\">**</ept>: This will be of the format \"Microsoft.Backup/backupvault/",
      "pos": [
        11963,
        12039
      ]
    },
    {
      "content": "\" where EventName is as described above.",
      "pos": [
        12050,
        12090
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Status<ept id=\"p1\">**</ept>: Supported values are- Started, Succeeded and Failed.",
      "pos": [
        12092,
        12156
      ]
    },
    {
      "content": "It is advisable to keep Informational as level for Succeeded status.",
      "pos": [
        12157,
        12225
      ]
    },
    {
      "pos": [
        12227,
        12278
      ],
      "content": "<bpt id=\"p1\">**</bpt>SubStatus<ept id=\"p1\">**</ept>: Same as status for backup operations"
    },
    {
      "pos": [
        12280,
        12350
      ],
      "content": "<bpt id=\"p1\">**</bpt>RuleType<ept id=\"p1\">**</ept>: Keep it as <bpt id=\"p2\">*</bpt>Event<ept id=\"p2\">*</ept> as backup alerts are based on events."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>ResourceGroup<ept id=\"p1\">**</ept>:ResourceGroup of the resource on which operation is triggered.",
      "pos": [
        12352,
        12432
      ]
    },
    {
      "content": "You can obtain this from ResourceId value.",
      "pos": [
        12433,
        12475
      ]
    },
    {
      "content": "Value between fields <bpt id=\"p1\">*</bpt>/resourceGroups/<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>/providers/<ept id=\"p2\">*</ept> in ResourceId value is the value for ResourceGroup.",
      "pos": [
        12476,
        12585
      ]
    },
    {
      "pos": [
        12587,
        12620
      ],
      "content": "<bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>: Name of the Alert Rule."
    },
    {
      "pos": [
        12622,
        12669
      ],
      "content": "<bpt id=\"p1\">**</bpt>Description<ept id=\"p1\">**</ept>: Description of the alert rule."
    },
    {
      "pos": [
        12671,
        12766
      ],
      "content": "<bpt id=\"p1\">**</bpt>CustomEmails<ept id=\"p1\">**</ept>: Specify the custom email address to which you want to send alert notification"
    },
    {
      "pos": [
        12768,
        12894
      ],
      "content": "<bpt id=\"p1\">**</bpt>SendToServiceOwners<ept id=\"p1\">**</ept>: This option sends alert notification to all administrators and co-administrators of the subscription."
    },
    {
      "content": "A sample alert mail looks similar to this:",
      "pos": [
        12896,
        12938
      ]
    },
    {
      "content": "Sample Header:",
      "pos": [
        12940,
        12954
      ]
    },
    {
      "content": "Alert Header",
      "pos": [
        12958,
        12970
      ]
    },
    {
      "content": "Sample body of the alert mail:",
      "pos": [
        13023,
        13053
      ]
    },
    {
      "content": "Alert Body",
      "pos": [
        13057,
        13067
      ]
    },
    {
      "content": "Limitations on Alerts",
      "pos": [
        13122,
        13143
      ]
    },
    {
      "content": "Event based alerts are subjected to following limitations:",
      "pos": [
        13144,
        13202
      ]
    },
    {
      "content": "Alerts are triggered on all Virtual machines in the backup vault.",
      "pos": [
        13207,
        13272
      ]
    },
    {
      "content": "You cannot customize it to get alerts for specific set of virtual machines in a backup vault.",
      "pos": [
        13273,
        13366
      ]
    },
    {
      "content": "Alerts are auto resolved if there is no alert matching event triggered in next alert duration.",
      "pos": [
        13370,
        13464
      ]
    },
    {
      "content": "Use <bpt id=\"p1\">*</bpt>WindowSize<ept id=\"p1\">*</ept> parameter in Add-AlertRule cmdlet to set alert triggering duration.",
      "pos": [
        13465,
        13549
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        13554,
        13564
      ]
    },
    {
      "content": "Restore Azure VMs",
      "pos": [
        13569,
        13586
      ]
    }
  ],
  "content": "\n<properties\n    pageTitle=\"Manage and monitor Azure virtual machine backups | Microsoft Azure\"\n    description=\"Learn how to manage and monitor an Azure virtual machine backups\"\n    services=\"backup\"\n    documentationCenter=\"\"\n    authors=\"trinadhk\"\n    manager=\"shreeshd\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"backup\"\n    ms.workload=\"storage-backup-recovery\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"01/25/2016\"\n    ms.author=\"trinadhk; jimpark; markgal;\"/>\n\n# Manage and monitor Azure virtual machine backups\n\n## Manage protected virtual machines\n\nTo manage protected virtual machines:\n\n1. To view and manage backup settings for a virtual machine click the **Protected Items** tab.\n\n2. Click on the name of a protected item to see the **Backup Details** tab, which shows you information about the last backup.\n\n    ![Virtual machine backup](./media/backup-azure-manage-vms/backup-vmdetails.png)\n\n3. To view and manage backup policy settings for a virtual machine click the **Policies** tab.\n\n    ![Virtual machine policy](./media/backup-azure-manage-vms/manage-policy-settings.png)\n\n    The **Backup Policies** tab shows you the existing policy. You can modify as needed. If you need to create a new policy click **Create** on the **Policies** page. Note that if you want to remove a policy it shouldn't have any virtual machines associated with it.\n\n    ![Virtual machine policy](./media/backup-azure-manage-vms/backup-vmpolicy.png)\n\n4. You can get more information about actions or status for a virtual machine on the **Jobs** page. Click a job in the list to get more details, or filter jobs for a specific virtual machine.\n\n    ![Jobs](./media/backup-azure-manage-vms/backup-job.png)\n\n## On-demand backup of a virtual machine\nYou can take an on-demand backup of a virtual machine once it is configured for protection. If the initial backup is pending for the virtual machine, on-demand backup will create a full copy of the virtual machine in Azure backup vault. If first backup is completed, on-demand backup will only send changes from previous backup to Azure backup vault.\n\nTo take an on-demand backup of a virtual machine:\n\n1. Navigate to the **Protected Items** page and select **Azure Virtual Machine** as **Type** (if not already selected) and click on **Select** button.\n\n    ![VM Type](./media/backup-azure-manage-vms/vm-type.png)\n\n2. Select the virtual machine on which you want to take an on-demand backup and click on **Backup Now** button at the bottom of the page.\n\n    ![Back up now](./media/backup-azure-manage-vms/backup-now.png)\n\n    This will create a backup job on the selected virtual machine. Retention range of recovery point created through this job will be same as that specified in the policy associated with the virtual machine.\n\n    ![Creating backup job](./media/backup-azure-manage-vms/creating-job.png)\n\n    >[AZURE.NOTE] To view the policy associated with a virtual machine, drill down into virtual machine in the **Protected Items** page and go to backup policy tab.\n\n3. Once the job is created, you can click on **View job** button in the toast bar to see the corresponding job in the jobs page.\n\n    ![Backup job created](./media/backup-azure-manage-vms/created-job.png)\n\n4. After successful completion of the job, a recovery point will be created which you can use to restore the virtual machine. This will also increment the recovery point column value by 1 in **Protected Items** page.\n\n## Stop protecting virtual machines\nYou can choose to stop the future backups of a virtual machine with the following options:\n\n- Retain backup data associated with virtual machine in Azure Backup vault\n- Delete backup data associated with virtual machine\n\nIf you have selected to retain backup data associated with virtual machine, you can use the backup data to restore the virtual machine. For pricing details for such virtual machines, click [here](https://azure.microsoft.com/pricing/details/backup/).\n\nTo Stop protection for a virtual machine:\n\n1. Navigate to **Protected Items** page and select **Azure virtual machine** as the filter type (if not already selected) and click on **Select** button.\n\n    ![VM Type](./media/backup-azure-manage-vms/vm-type.png)\n\n2. Select the virtual machine and click on **Stop Protection** at the bottom of the page.\n\n    ![Stop protection](./media/backup-azure-manage-vms/stop-protection.png)\n\n3. By default, Azure Backup doesn’t delete the backup data associated with the Virtual machine.\n\n    ![Confirm stop protection](./media/backup-azure-manage-vms/confirm-stop-protection.png)\n\n    If you want to delete backup data, select the check box.\n\n    ![Checkbox](./media/backup-azure-manage-vms/checkbox.png)\n\n    Please select a reason for stopping the backup. While this is optional, providing a reason will help Azure Backup to work on the feedback and prioritize the customer scenarios.\n\n4. Click on **Submit** button to submit the **Stop protection** job. Click on **View Job** to see the corresponding the job in **Jobs** page.\n\n    ![Stop protection](./media/backup-azure-manage-vms/stop-protect-success.png)\n\n    If you have not selected **Delete associated backup data** option during **Stop Protection** wizard, then post job completion, protection status changes to **Protection Stopped**. The data remains with Azure Backup until it is explicitly deleted. You can always delete the data by selecting the virtual machine in the **Protected Items** page and clicking **Delete**.\n\n    ![Stopped protection](./media/backup-azure-manage-vms/protection-stopped-status.png)\n\n    If you have selected the **Delete associated backup data** option, the virtual machine won’t be part of the **Protected Items** page.\n\n## Re-protect Virtual machine\nIf you have not selected the **Delete associate backup data** option in **Stop Protection**, you can re-protect the virtual machine by following the steps similar to backing up registered virtual machines. Once protected, this virtual machine will have backup data retained prior to stop protection and recovery points created after re-protect.\n\nAfter re-protect, the virtual machine’s protection status will be changed to **Protected** if there are recovery points prior to **Stop Protection**.\n\n  ![Reprotected VM](./media/backup-azure-manage-vms/reprotected-status.png)\n\n>[AZURE.NOTE] When re-protecting the virtual machine, you can choose a different policy than the policy with which virtual machine was protected initially.\n\n## Unregister virtual machines\n\nIf you want to remove the virtual machine from the backup vault:\n\n1. Click on the **UNREGISTER** button at the bottom of the page.\n\n    ![Disable protection](./media/backup-azure-manage-vms/unregister-button.png)\n\n    A toast notification will appear at the bottom of the screen requesting confirmation. Click **YES** to continue.\n\n    ![Disable protection](./media/backup-azure-manage-vms/confirm-unregister.png)\n\n## Delete Backup data\nYou can delete the backup data associated with a virtual machine, either:\n\n- During Stop Protection Job\n- After a stop protection job is completed on a virtual machine\n\nTo delete backup data on a virtual machine, which is in the *Protection Stopped* state post successful completion of a **Stop Backup** job:\n\n1. Navigate to the **Protected Items** page and select **Azure Virtual Machine** as *type* and click the **Select** button.\n\n    ![VM Type](./media/backup-azure-manage-vms/vm-type.png)\n\n2. Select the virtual machine. The virtual machine will be in **Protection Stopped** state.\n\n    ![Protection stopped](./media/backup-azure-manage-vms/protection-stopped-b.png)\n\n3. Click the **DELETE** button at the bottom of the page.\n\n    ![Delete backup](./media/backup-azure-manage-vms/delete-backup.png)\n\n4. In the **Delete backup data** wizard, select a reason for deleting backup data (highly recommended) and click **Submit**.\n\n    ![Delete backup data](./media/backup-azure-manage-vms/delete-backup-data.png)\n\n5. This will create a job to delete backup data of selected virtual machine. Click **View job** to see corresponding job in Jobs page.\n\n    ![Data deletion successful](./media/backup-azure-manage-vms/delete-data-success.png)\n\n    Once the job is completed, the entry corresponding to the virtual machine will be removed from **Protected items** page.\n\n## Dashboard\nOn the **Dashboard** page you can review information about Azure virtual machines, their storage, and jobs associated with them in the last 24 hours. You can view backup status and any associated backup errors.\n\n![Dashboard](./media/backup-azure-manage-vms/dashboard-protectedvms.png)\n\n>[AZURE.NOTE] Values in the dashboard are refreshed once every 24 hours.\n\n## Auditing Operations\nAzure backup provides review of the \"operation logs\" of backup operations triggered by the customer making it easy to see exactly what management operations were performed on the backup vault. Operations logs enable great post-mortem and audit support for the backup operations.\n\nThe following operations are logged in Operation logs:\n\n- Register\n- Unregister\n- Configure protection\n- Backup ( Both scheduled as well as on-demand backup through BackupNow)\n- Restore\n- Stop protection\n- Delete backup data\n- Add policy\n- Delete policy\n- Update policy\n- Cancel job\n\nTo view operation logs corresponding to a backup vault:\n\n1. Navigate to **Management services** in Azure portal, and then click the **Operation Logs** tab.\n\n    ![Operation Logs](./media/backup-azure-manage-vms/ops-logs.png)\n\n2. In the filters, select **Backup** as *Type* and specify the backup vault name in *service name* and click on **Submit**.\n\n    ![Operation Logs Filter](./media/backup-azure-manage-vms/ops-logs-filter.png)\n\n3. In the operations logs, select any operation and click  **Details** to see details corresponding to an operation.\n\n    ![Operation Logs-Fetching details](./media/backup-azure-manage-vms/ops-logs-details.png)\n\n    The **Details wizard** contains information about the operation triggered, job Id, resource on which this operation is triggered, and start time of the operation.\n\n    ![Operation Details](./media/backup-azure-manage-vms/ops-logs-details-window.png)\n\n## Alert notifications\nYou can get custom alert notifications for the jobs in portal. This is achieved by defining PowerShell based alert rules on operational logs events.\n\nEvent based alerts work in Azure resource mode. Switch to Azure Resource mode by executing following cmdlet in elevated command mode:\n\n```\nPS C:\\> Switch-AzureMode AzureResourceManager\n```\n\nTo define a custom notification to alert for backup failures, a sample command will look like:\n\n```\nPS C:\\> Add-AlertRule -Operator GreaterThanOrEqual -Threshold 1 -ResourceId '/subscriptions/86eeac34-eth9a-4de3-84db-7a27d121967e/resourceGroups/RecoveryServices-DP2RCXUGWS3MLJF4LKPI3A3OMJ2DI4SRJK6HIJH22HFIHZVVELRQ-East-US/providers/microsoft.backupbvtd2/BackupVault/trinadhVault' -EventName Backup  -EventSource Administrative -Level Error -OperationName 'Microsoft.Backup/backupVault/Backup' -ResourceProvider Microsoft.Backup -Status Failed  -SubStatus Failed -RuleType Event -Location eastus -ResourceGroup RecoveryServices-DP2RCXUGWS3MLJF4LKPI3A3OMJ2DI4SRJK6HIJH22HFIHZVVELRQ-East-US -Name Backup-Failed -Description 'Backup failed for one of the VMs in vault trinadhkVault' -CustomEmails 'contoso@microsoft.com' -SendToServiceOwners\n```\n\n**ResourceId**: You can get this from Operations Logs popup as described in above section. ResourceUri in details popup window of an operation is the ResourceId to besupplied for this cmdlet.\n\n**EventName**: For alerts on IaaS VM backup, supported values are - Register,Unregister,ConfigureProtection,Backup,Restore,StopProtection,DeleteBackupData,CreateProtectionPolicy,DeleteProtectionPolicy,UpdateProtectionPolicy\n\n**Level**: Supported values are - Informational, Error. For alerts on failed action use Error and for alerts on successful jobs use Informational.\n\n**OperationName**: This will be of the format \"Microsoft.Backup/backupvault/<EventName>\" where EventName is as described above.\n\n**Status**: Supported values are- Started, Succeeded and Failed. It is advisable to keep Informational as level for Succeeded status.\n\n**SubStatus**: Same as status for backup operations\n\n**RuleType**: Keep it as *Event* as backup alerts are based on events.\n\n**ResourceGroup**:ResourceGroup of the resource on which operation is triggered. You can obtain this from ResourceId value. Value between fields */resourceGroups/* and */providers/* in ResourceId value is the value for ResourceGroup.\n\n**Name**: Name of the Alert Rule.\n\n**Description**: Description of the alert rule.\n\n**CustomEmails**: Specify the custom email address to which you want to send alert notification\n\n**SendToServiceOwners**: This option sends alert notification to all administrators and co-administrators of the subscription.\n\nA sample alert mail looks similar to this:\n\nSample Header:\n\n![Alert Header](./media/backup-azure-manage-vms/alert-header.png)\n\nSample body of the alert mail:\n\n![Alert Body](./media/backup-azure-manage-vms/alert-body.png)\n\n### Limitations on Alerts\nEvent based alerts are subjected to following limitations:\n\n1. Alerts are triggered on all Virtual machines in the backup vault. You cannot customize it to get alerts for specific set of virtual machines in a backup vault.\n2. Alerts are auto resolved if there is no alert matching event triggered in next alert duration. Use *WindowSize* parameter in Add-AlertRule cmdlet to set alert triggering duration.\n\n## Next steps\n\n- [Restore Azure VMs](backup-azure-restore-vms.md)\n"
}