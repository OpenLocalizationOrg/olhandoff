{
  "nodes": [
    {
      "pos": [
        27,
        76
      ],
      "content": "Submit Hadoop jobs in HDInsight | Microsoft Azure"
    },
    {
      "pos": [
        95,
        153
      ],
      "content": "Learn how to submit Hadoop jobs to Azure HDInsight Hadoop."
    },
    {
      "pos": [
        477,
        508
      ],
      "content": "Submit Hadoop jobs in HDInsight"
    },
    {
      "pos": [
        510,
        670
      ],
      "content": "Learn how to use Azure PowerShell to submit MapReduce and Hive jobs, and how to use the HDInsight .NET SDK to submit MapReduce, Hadoop streaming, and Hive jobs."
    },
    {
      "pos": [
        674,
        947
      ],
      "content": "<ph id=\"ph2\">[AZURE.NOTE]</ph><ph id=\"ph3\"/> The steps in this article must be performed from a Windows client. For information on using a Linux, OS X, or Unix client to work with MapReduce, Hive, or Pig on HDInsight, see the following articles and select either the <bpt id=\"p1\">**</bpt>SSH<ept id=\"p1\">**</ept><ph id=\"ph4\"/> or <bpt id=\"p2\">**</bpt>Curl<ept id=\"p2\">**</ept><ph id=\"ph5\"/> links within each:",
      "nodes": [
        {
          "content": "<ph id=\"ph2\">[AZURE.NOTE]</ph><ph id=\"ph3\"/> The steps in this article must be performed from a Windows client.",
          "pos": [
            0,
            111
          ]
        },
        {
          "content": "For information on using a Linux, OS X, or Unix client to work with MapReduce, Hive, or Pig on HDInsight, see the following articles and select either the <bpt id=\"p1\">**</bpt>SSH<ept id=\"p1\">**</ept><ph id=\"ph4\"/> or <bpt id=\"p2\">**</bpt>Curl<ept id=\"p2\">**</ept><ph id=\"ph5\"/> links within each:",
          "pos": [
            112,
            409
          ]
        }
      ]
    },
    {
      "pos": [
        954,
        1002
      ],
      "content": "<bpt id=\"p3\">[</bpt>Use Hive with HDInsight<ept id=\"p3\">](hdinsight-use-hive.md)</ept>"
    },
    {
      "pos": [
        1007,
        1053
      ],
      "content": "<bpt id=\"p4\">[</bpt>Use Pig with HDInsight<ept id=\"p4\">](hdinsight-use-pig.md)</ept>"
    },
    {
      "pos": [
        1058,
        1116
      ],
      "content": "<bpt id=\"p5\">[</bpt>Use MapReduce with HDInsight<ept id=\"p5\">](hdinsight-use-mapreduce.md)</ept>"
    },
    {
      "pos": [
        1121,
        1134
      ],
      "content": "Prerequisites"
    },
    {
      "pos": [
        1136,
        1195
      ],
      "content": "Before you begin this article, you must have the following:"
    },
    {
      "pos": [
        1199,
        1367
      ],
      "content": "<bpt id=\"p6\">**</bpt>An Azure HDInsight cluster<ept id=\"p6\">**</ept>. For instructions, see <bpt id=\"p7\">[</bpt>Get started with HDInsight<ept id=\"p7\">][hdinsight-get-started]</ept><ph id=\"ph6\"/> or <bpt id=\"p8\">[</bpt>Create Hadoop clusters in HDInsight<ept id=\"p8\">][hdinsight-provision]</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p6\">**</bpt>An Azure HDInsight cluster<ept id=\"p6\">**</ept>.",
          "pos": [
            0,
            69
          ]
        },
        {
          "content": "For instructions, see <bpt id=\"p7\">[</bpt>Get started with HDInsight<ept id=\"p7\">][hdinsight-get-started]</ept><ph id=\"ph6\"/> or <bpt id=\"p8\">[</bpt>Create Hadoop clusters in HDInsight<ept id=\"p8\">][hdinsight-provision]</ept>.",
          "pos": [
            70,
            296
          ]
        }
      ]
    },
    {
      "pos": [
        1370,
        1538
      ],
      "content": "<bpt id=\"p9\">**</bpt>A workstation with Azure PowerShell<ept id=\"p9\">**</ept>. See <bpt id=\"p10\">[</bpt>Install Azure PowerShell 1.0 and greater<ept id=\"p10\">](hdinsight-administer-use-powershell.md#install-azure-powershell-10-and-greater)</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p9\">**</bpt>A workstation with Azure PowerShell<ept id=\"p9\">**</ept>.",
          "pos": [
            0,
            78
          ]
        },
        {
          "content": "See <bpt id=\"p10\">[</bpt>Install Azure PowerShell 1.0 and greater<ept id=\"p10\">](hdinsight-administer-use-powershell.md#install-azure-powershell-10-and-greater)</ept>.",
          "pos": [
            79,
            246
          ]
        }
      ]
    },
    {
      "pos": [
        1542,
        1580
      ],
      "content": "Submit MapReduce jobs using PowerShell"
    },
    {
      "pos": [
        1582,
        1670
      ],
      "content": "See <bpt id=\"p11\">[</bpt>Run Hadoop MapReduce samples in Windows-based HDInsight<ept id=\"p11\">](hdinsight-run-samples.md)</ept>."
    },
    {
      "pos": [
        1674,
        1708
      ],
      "content": "Submit Hive jobs using  PowerShell"
    },
    {
      "pos": [
        1710,
        1790
      ],
      "content": "See <bpt id=\"p12\">[</bpt>Run Hive queries using PowerShell<ept id=\"p12\">](hdinsight-hadoop-use-hive-powershell.md)</ept>"
    },
    {
      "pos": [
        1795,
        1831
      ],
      "content": "Submit Hive jobs using Visual Studio"
    },
    {
      "pos": [
        1833,
        1929
      ],
      "content": "See <bpt id=\"p13\">[</bpt>Get started using HDInsight Hadoop Tools for Visual Studio<ept id=\"p13\">][hdinsight-visual-studio-tools]</ept>."
    },
    {
      "pos": [
        1933,
        1967
      ],
      "content": "Submit Sqoop jobs using PowerShell"
    },
    {
      "pos": [
        1969,
        2021
      ],
      "content": "See <bpt id=\"p14\">[</bpt>Use Sqoop with HDInsight<ept id=\"p14\">][hdinsight-use-sqoop]</ept>."
    },
    {
      "pos": [
        2025,
        2076
      ],
      "content": "Submit Hive/Pig/Sqoop jobs using HDInsight .NET SDK"
    },
    {
      "pos": [
        2077,
        2196
      ],
      "content": "The HDInsight .NET SDK provides .NET client libraries, which makes it easier to work with HDInsight clusters from .NET."
    },
    {
      "pos": [
        2199,
        2217
      ],
      "content": "<bpt id=\"p15\">**</bpt>To Submit jobs<ept id=\"p15\">**</ept>"
    },
    {
      "pos": [
        2222,
        2271
      ],
      "content": "Create a C# console application in Visual Studio."
    },
    {
      "pos": [
        2275,
        2341
      ],
      "content": "From the Nuget Package Manager Console, run the following command."
    },
    {
      "pos": [
        2549,
        2572
      ],
      "content": "Use the following code:"
    },
    {
      "pos": [
        11493,
        11529
      ],
      "content": "Press <bpt id=\"p16\">**</bpt>F5<ept id=\"p16\">**</ept><ph id=\"ph7\"/> to run the application."
    },
    {
      "pos": [
        11533,
        11588
      ],
      "content": "Submit jobs using the HDInsight Tools for Visual Studio"
    },
    {
      "pos": [
        11590,
        11795
      ],
      "content": "Using the HDInsight Tools for Visual Studio, you can run Hive queries and Pig scripts. See <bpt id=\"p17\">[</bpt>Get started using Visual Studio Hadoop tools for HDInsight<ept id=\"p17\">](hdinsight-hadoop-visual-studio-tools-get-started.md)</ept>.",
      "nodes": [
        {
          "content": "Using the HDInsight Tools for Visual Studio, you can run Hive queries and Pig scripts.",
          "pos": [
            0,
            86
          ]
        },
        {
          "content": "See <bpt id=\"p17\">[</bpt>Get started using Visual Studio Hadoop tools for HDInsight<ept id=\"p17\">](hdinsight-hadoop-visual-studio-tools-get-started.md)</ept>.",
          "pos": [
            87,
            245
          ]
        }
      ]
    },
    {
      "pos": [
        11799,
        11809
      ],
      "content": "Next steps"
    },
    {
      "pos": [
        11810,
        11931
      ],
      "content": "In this article, you have learned several ways to create an HDInsight cluster. To learn more, see the following articles:",
      "nodes": [
        {
          "content": "In this article, you have learned several ways to create an HDInsight cluster.",
          "pos": [
            0,
            78
          ]
        },
        {
          "content": "To learn more, see the following articles:",
          "pos": [
            79,
            121
          ]
        }
      ]
    },
    {
      "pos": [
        11935,
        11992
      ],
      "content": "<bpt id=\"p18\">[</bpt>Get started with Azure HDInsight<ept id=\"p18\">][hdinsight-get-started]</ept>"
    },
    {
      "pos": [
        11995,
        12053
      ],
      "content": "<bpt id=\"p19\">[</bpt>Create Hadoop clusters in HDInsight<ept id=\"p19\">][hdinsight-provision]</ept>"
    },
    {
      "pos": [
        12056,
        12122
      ],
      "content": "<bpt id=\"p20\">[</bpt>Manage HDInsight by using PowerShell<ept id=\"p20\">][hdinsight-admin-powershell]</ept>"
    },
    {
      "pos": [
        12125,
        12199
      ],
      "content": "<bpt id=\"p21\">[</bpt>HDInsight Cmdlet Reference Documentation<ept id=\"p21\">][hdinsight-powershell-reference]</ept>"
    },
    {
      "pos": [
        12202,
        12247
      ],
      "content": "<bpt id=\"p22\">[</bpt>Use Hive with HDInsight<ept id=\"p22\">][hdinsight-use-hive]</ept>"
    },
    {
      "pos": [
        12250,
        12293
      ],
      "content": "<bpt id=\"p23\">[</bpt>Use Pig with HDInsight<ept id=\"p23\">][hdinsight-use-pig]</ept>"
    }
  ],
  "content": "<properties\n    pageTitle=\"Submit Hadoop jobs in HDInsight | Microsoft Azure\"\n    description=\"Learn how to submit Hadoop jobs to Azure HDInsight Hadoop.\"\n    editor=\"cgronlun\"\n    manager=\"paulettm\"\n    services=\"hdinsight\"\n    documentationCenter=\"\"\n    tags=\"azure-portal\"\n    authors=\"mumian\"/>\n\n<tags\n    ms.service=\"hdinsight\"\n    ms.workload=\"big-data\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"02/04/2016\"\n    ms.author=\"jgao\"/>\n\n# Submit Hadoop jobs in HDInsight\n\nLearn how to use Azure PowerShell to submit MapReduce and Hive jobs, and how to use the HDInsight .NET SDK to submit MapReduce, Hadoop streaming, and Hive jobs.\n\n> [AZURE.NOTE] The steps in this article must be performed from a Windows client. For information on using a Linux, OS X, or Unix client to work with MapReduce, Hive, or Pig on HDInsight, see the following articles and select either the **SSH** or **Curl** links within each:\n>\n> - [Use Hive with HDInsight](hdinsight-use-hive.md)\n> - [Use Pig with HDInsight](hdinsight-use-pig.md)\n> - [Use MapReduce with HDInsight](hdinsight-use-mapreduce.md)\n\n###Prerequisites\n\nBefore you begin this article, you must have the following:\n\n- **An Azure HDInsight cluster**. For instructions, see [Get started with HDInsight][hdinsight-get-started] or [Create Hadoop clusters in HDInsight][hdinsight-provision].\n- **A workstation with Azure PowerShell**. See [Install Azure PowerShell 1.0 and greater](hdinsight-administer-use-powershell.md#install-azure-powershell-10-and-greater).\n\n##Submit MapReduce jobs using PowerShell\n\nSee [Run Hadoop MapReduce samples in Windows-based HDInsight](hdinsight-run-samples.md).\n\n##Submit Hive jobs using  PowerShell\n\nSee [Run Hive queries using PowerShell](hdinsight-hadoop-use-hive-powershell.md)\n\n## Submit Hive jobs using Visual Studio\n\nSee [Get started using HDInsight Hadoop Tools for Visual Studio][hdinsight-visual-studio-tools].\n\n##Submit Sqoop jobs using PowerShell\n\nSee [Use Sqoop with HDInsight][hdinsight-use-sqoop].\n\n##Submit Hive/Pig/Sqoop jobs using HDInsight .NET SDK\nThe HDInsight .NET SDK provides .NET client libraries, which makes it easier to work with HDInsight clusters from .NET. \n\n**To Submit jobs**\n\n1. Create a C# console application in Visual Studio.\n2. From the Nuget Package Manager Console, run the following command.\n\n        Install-Package Microsoft.Azure.Common.Authentication -pre\n        Install-Package Microsoft.Azure.Management.HDInsight -Pre\n        Install-Package Microsoft.Azure.Management.HDInsight.Job -Pre\n2. Use the following code:\n\n        using System;\n        using System.Collections.Generic;\n        using System.Linq;\n        using System.Security;\n        \n        using Microsoft.Azure;\n        using Microsoft.Azure.Common.Authentication;\n        using Microsoft.Azure.Common.Authentication.Factories;\n        using Microsoft.Azure.Common.Authentication.Models;\n        using Microsoft.Azure.Management.HDInsight;\n        using Microsoft.Azure.Management.HDInsight.Job;\n        using Microsoft.Azure.Management.HDInsight.Job.Models;\n        using Hyak.Common;\n        \n        namespace SubmitHDInsightJobDotNet\n        {\n            class Program\n            {\n                private static HDInsightManagementClient _hdiManagementClient;\n                private static HDInsightJobManagementClient _hdiJobManagementClient;\n        \n                private static Guid SubscriptionId = new Guid(\"<Your Subscription ID>\");\n                private const string ResourceGroupName = \"<Your Resource Group Name>\";\n        \n                private const string ExistingClusterName = \"<Your HDInsight Cluster Name>\";\n                private const string ExistingClusterUri = ExistingClusterName + \".azurehdinsight.net\";\n                private const string ExistingClusterUsername = \"admin\";\n                private const string ExistingClusterPassword = \"**********\";\n        \n                static void Main(string[] args)\n                {\n                    System.Console.WriteLine(\"Running\");\n        \n                    var tokenCreds = GetTokenCloudCredentials();\n                    var subCloudCredentials = GetSubscriptionCloudCredentials(tokenCreds, SubscriptionId);\n        \n                    _hdiManagementClient = new HDInsightManagementClient(subCloudCredentials);\n        \n                    var clusterCredentials = new BasicAuthenticationCloudCredentials { Username = ExistingClusterUsername, Password = ExistingClusterPassword };\n                    _hdiJobManagementClient = new HDInsightJobManagementClient(ExistingClusterUri, clusterCredentials);\n        \n                    SubmitHiveJob();\n                    SubmitPigJob();\n                    SubmitSqoopJob();\n                }\n        \n                public static TokenCloudCredentials GetTokenCloudCredentials(string username = null, SecureString password = null)\n                {\n                    var authFactory = new AuthenticationFactory();\n        \n                    var account = new AzureAccount { Type = AzureAccount.AccountType.User };\n        \n                    if (username != null && password != null)\n                        account.Id = username;\n        \n                    var env = AzureEnvironment.PublicEnvironments[EnvironmentName.AzureCloud];\n        \n                    var accessToken =\n                        authFactory.Authenticate(account, env, AuthenticationFactory.CommonAdTenant, password, ShowDialog.Auto)\n                            .AccessToken;\n        \n                    return new TokenCloudCredentials(accessToken);\n                }\n        \n                public static SubscriptionCloudCredentials GetSubscriptionCloudCredentials(TokenCloudCredentials creds, Guid subId)\n                {\n                    return new TokenCloudCredentials(subId.ToString(), creds.Token);\n                }\n        \n                private static void SubmitPigJob()\n                {\n                    var parameters = new PigJobSubmissionParameters\n                    {\n                        UserName = ExistingClusterUsername,\n                        Query = @\"LOGS = LOAD 'wasb:///example/data/sample.log';\n                            LEVELS = foreach LOGS generate REGEX_EXTRACT($0, '(TRACE|DEBUG|INFO|WARN|ERROR|FATAL)', 1)  as LOGLEVEL;\n                            FILTEREDLEVELS = FILTER LEVELS by LOGLEVEL is not null;\n                            GROUPEDLEVELS = GROUP FILTEREDLEVELS by LOGLEVEL;\n                            FREQUENCIES = foreach GROUPEDLEVELS generate group as LOGLEVEL, COUNT(FILTEREDLEVELS.LOGLEVEL) as COUNT;\n                            RESULT = order FREQUENCIES by COUNT desc;\n                            DUMP RESULT;\"\n                    };\n        \n                    System.Console.WriteLine(\"Submitting the Pig job to the cluster...\");\n                    var response = _hdiJobManagementClient.JobManagement.SubmitPigJob(parameters);\n                    System.Console.WriteLine(\"Validating that the response is as expected...\");\n                    System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\n                    System.Console.WriteLine(\"Validating the response object...\");\n                    System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\n                }\n        \n                private static void SubmitHiveJob()\n                {\n                    Dictionary<string, string> defines = new Dictionary<string, string> { { \"hive.execution.engine\", \"ravi\" }, { \"hive.exec.reducers.max\", \"1\" } };\n                    List<string> args = new List<string> { { \"argA\" }, { \"argB\" } };\n                    var parameters = new HiveJobSubmissionParameters\n                    {\n                        UserName = ExistingClusterUsername,\n                        Query = \"SHOW TABLES\",\n                        Defines = ConvertDefinesToString(defines),\n                        Arguments = ConvertArgsToString(args)\n                    };\n        \n                    System.Console.WriteLine(\"Submitting the Hive job to the cluster...\");\n                    var response = _hdiJobManagementClient.JobManagement.SubmitHiveJob(parameters);\n                    System.Console.WriteLine(\"Validating that the response is as expected...\");\n                    System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\n                    System.Console.WriteLine(\"Validating the response object...\");\n                    System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\n                }\n        \n                private static void SubmitSqoopJob()\n                {\n                    var sqlDatabaseServerName = \"<SQLDatabaseServerName>\";\n                    var sqlDatabaseLogin = \"<SQLDatabaseLogin>\";\n                    var sqlDatabaseLoginPassword = \"<SQLDatabaseLoginPassword>\";\n                    var sqlDatabaseDatabaseName = \"hdisqoop\";\n        \n                    var tableName = \"log4jlogs\";\n                    var exportDir = \"/tutorials/usesqoop/data\";\n        \n                    // Connection string for using Azure SQL Database.\n                    // Comment if using SQL Server\n                    var connectionString = \"jdbc:sqlserver://\" + sqlDatabaseServerName + \".database.windows.net;user=\" + sqlDatabaseLogin + \"@\" + sqlDatabaseServerName + \";password=\" + sqlDatabaseLoginPassword + \";database=\" + sqlDatabaseDatabaseName;\n                    // Connection string for using SQL Server.\n                    // Uncomment if using SQL Server\n                    //var connectionString = \"jdbc:sqlserver://\" + sqlDatabaseServerName + \";user=\" + sqlDatabaseLogin + \";password=\" + sqlDatabaseLoginPassword + \";database=\" + sqlDatabaseDatabaseName;\n        \n                    var parameters = new SqoopJobSubmissionParameters\n                    {\n                        UserName = ExistingClusterUsername,\n                        Command = \"export --connect \" + connectionString + \" --table \" + tableName + \"_mobile --export-dir \" + exportDir + \"_mobile --fields-terminated-by \\\\t -m 1\"\n                    };\n        \n                    System.Console.WriteLine(\"Submitting the Sqoop job to the cluster...\");\n                    var response = _hdiJobManagementClient.JobManagement.SubmitSqoopJob(parameters);\n                    System.Console.WriteLine(\"Validating that the response is as expected...\");\n                    System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\n                    System.Console.WriteLine(\"Validating the response object...\");\n                    System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\n                }\n        \n                private static string ConvertDefinesToString(Dictionary<string, string> defines)\n                {\n                    if (defines.Count == 0)\n                    {\n                        return null;\n                    }\n        \n                    return \"&define=\" + string.Join(\"&define=\", defines.Select(x => x.Key + \"%3D\" + x.Value).ToArray());\n                }\n                private static string ConvertArgsToString(List<string> args)\n                {\n                    if (args.Count == 0)\n                    {\n                        return null;\n                    }\n        \n                    return string.Join(\"&arg=\", args.ToArray());\n                }\n            }\n        }\n\n5. Press **F5** to run the application.\n\n##Submit jobs using the HDInsight Tools for Visual Studio\n\nUsing the HDInsight Tools for Visual Studio, you can run Hive queries and Pig scripts. See [Get started using Visual Studio Hadoop tools for HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md).\n\n##Next steps\nIn this article, you have learned several ways to create an HDInsight cluster. To learn more, see the following articles:\n\n* [Get started with Azure HDInsight][hdinsight-get-started]\n* [Create Hadoop clusters in HDInsight][hdinsight-provision]\n* [Manage HDInsight by using PowerShell][hdinsight-admin-powershell]\n* [HDInsight Cmdlet Reference Documentation][hdinsight-powershell-reference]\n* [Use Hive with HDInsight][hdinsight-use-hive]\n* [Use Pig with HDInsight][hdinsight-use-pig]\n\n\n[azure-certificate]: http://msdn.microsoft.com/library/windowsazure/gg551722.aspx\n[azure-management-portal]: https://portal.azure.com/\n\n[hdinsight-visual-studio-tools]: ../HDInsight/hdinsight-hadoop-visual-studio-tools-get-started.md\n[hdinsight-use-sqoop]: hdinsight-use-sqoop.md\n[hdinsight-provision]: hdinsight-provision-clusters.md\n[hdinsight-use-mapreduce]: hdinsight-use-mapreduce.md\n[hdinsight-use-hive]: hdinsight-use-hive.md\n[hdinsight-use-pig]: hdinsight-use-pig.md\n[hdinsight-get-started]: hdinsight-hadoop-linux-tutorial-get-started.md\n[hdinsight-storage]: ../hdinsight-hadoop-use-blob-storage.md\n[hdinsight-admin-powershell]: hdinsight-administer-use-powershell.md\n[hdinsight-develop-streaming-jobs]: hdinsight-hadoop-develop-deploy-streaming-jobs.md\n\n[hdinsight-powershell-reference]: https://msdn.microsoft.com/library/dn858087.aspx\n\n[powershell-install-configure]: powershell-install-configure.md\n\n[image-hdi-gettingstarted-runmrjob]: ./media/hdinsight-submit-hadoop-jobs-programmatically/HDI.GettingStarted.RunMRJob.png\n[image-hdi-gettingstarted-mrjoboutput]: ./media/hdinsight-submit-hadoop-jobs-programmatically/HDI.GettingStarted.MRJobOutput.png\n\n[apache-hive]: http://hive.apache.org/\n"
}