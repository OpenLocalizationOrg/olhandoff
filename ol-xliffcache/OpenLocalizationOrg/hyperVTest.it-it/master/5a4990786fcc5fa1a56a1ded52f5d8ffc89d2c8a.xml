{
  "nodes": [
    {
      "pos": [
        28,
        73
      ],
      "content": "Work with a JavaScript backend mobile service"
    },
    {
      "pos": [
        93,
        187
      ],
      "content": "Provides examples on how to define, register, and use server scripts in Azure Mobile Services."
    },
    {
      "pos": [
        521,
        566
      ],
      "content": "Work with a JavaScript backend mobile service"
    },
    {
      "pos": [
        568,
        696
      ],
      "content": "This article provides detailed information about and examples of how to work with a JavaScript backend in Azure Mobile Services."
    },
    {
      "pos": [
        699,
        701
      ],
      "content": "##"
    },
    {
      "pos": [
        721,
        733
      ],
      "content": "Introduction"
    },
    {
      "pos": [
        735,
        950
      ],
      "content": "In a JavaScript backend mobile service, you can define custom business logic as JavaScript code that's stored and executed on the server. This server script code is assigned to one of the following server functions:",
      "nodes": [
        {
          "content": "In a JavaScript backend mobile service, you can define custom business logic as JavaScript code that's stored and executed on the server.",
          "pos": [
            0,
            137
          ]
        },
        {
          "content": "This server script code is assigned to one of the following server functions:",
          "pos": [
            138,
            215
          ]
        }
      ]
    },
    {
      "pos": [
        954,
        1034
      ],
      "content": "[Insert, read, update, or delete operations on a given table][Table operations]."
    },
    {
      "pos": [
        1037,
        1069
      ],
      "content": "[Scheduled jobs][Job Scheduler]."
    },
    {
      "pos": [
        1072,
        1130
      ],
      "content": "[HTTP methods defined in a custom API][Custom API anchor]."
    },
    {
      "pos": [
        1133,
        1442
      ],
      "content": "The signature of the main function in the server script depends on the context of where the script is used. You can also define common script code as nodes.js modules that are shared across scripts. For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
      "nodes": [
        {
          "content": "The signature of the main function in the server script depends on the context of where the script is used.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "You can also define common script code as nodes.js modules that are shared across scripts.",
          "pos": [
            108,
            198
          ]
        },
        {
          "content": "For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
          "pos": [
            199,
            309
          ]
        }
      ]
    },
    {
      "pos": [
        1444,
        1558
      ],
      "content": "For descriptions of individual server script objects and functions, see [Mobile Services server script reference]."
    },
    {
      "pos": [
        1562,
        1564
      ],
      "content": "##"
    },
    {
      "pos": [
        1592,
        1608
      ],
      "content": "Table operations"
    },
    {
      "pos": [
        1610,
        1867
      ],
      "content": "A table operation script is a server script that is registered to an operation on a table&amp;mdash;insert, read, update, or delete (<bpt id=\"p1\">*</bpt>del<ept id=\"p1\">*</ept>). This section describes how to work with table operations in a JavaScript backend, which includes the following sections:",
      "nodes": [
        {
          "content": "A table operation script is a server script that is registered to an operation on a table&amp;mdash;insert, read, update, or delete (<bpt id=\"p1\">*</bpt>del<ept id=\"p1\">*</ept>).",
          "pos": [
            0,
            178
          ]
        },
        {
          "content": "This section describes how to work with table operations in a JavaScript backend, which includes the following sections:",
          "pos": [
            179,
            299
          ]
        }
      ]
    },
    {
      "pos": [
        1871,
        1925
      ],
      "content": "[Overview of table operations][Basic table operations]"
    },
    {
      "pos": [
        1928,
        1967
      ],
      "content": "[How to: Register for table operations]"
    },
    {
      "pos": [
        1970,
        2009
      ],
      "content": "[How to: Override the default response]"
    },
    {
      "pos": [
        2012,
        2046
      ],
      "content": "[How to: Override execute success]"
    },
    {
      "pos": [
        2049,
        2090
      ],
      "content": "[How to: Override default error handling]"
    },
    {
      "pos": [
        2093,
        2145
      ],
      "content": "<bpt id=\"p2\">[</bpt>How to: Generate unique ID values<ept id=\"p2\">](#generate-guids)</ept>"
    },
    {
      "pos": [
        2148,
        2179
      ],
      "content": "[How to: Add custom parameters]"
    },
    {
      "pos": [
        2182,
        2238
      ],
      "content": "[How to: Work with table users][How to: Work with users]"
    },
    {
      "pos": [
        2240,
        2243
      ],
      "content": "###"
    },
    {
      "pos": [
        2273,
        2301
      ],
      "content": "Overview of table operations"
    },
    {
      "pos": [
        2303,
        3034
      ],
      "content": "The name of the script must match the kind of operation for which it is registered. Only one script can be registered for a given table operation. The script is executed every time that the given operation is invoked by a REST request&amp;mdash;for example, when a POST request is received to insert an item into the table. Mobile Services does not preserve state between script executions. Because a new global context is created every time a script is run, any state variables that are defined in the script are reinitialized. If you want to store state from one request to another, create a table in your mobile service, and then read and write the state to the table. For more information, see [How to: Access tables from scripts].",
      "nodes": [
        {
          "content": "The name of the script must match the kind of operation for which it is registered. Onl",
          "pos": [
            0,
            87
          ]
        },
        {
          "content": "y one script can be registered for a given table operation. The",
          "pos": [
            87,
            150
          ]
        },
        {
          "content": "script is executed every time that the given operation is invoked by a REST request&amp;mdash;for example, when a POST request is received to insert an item into the table.",
          "pos": [
            151,
            323
          ]
        },
        {
          "content": "Mobile Services does not preserve state between script executions.",
          "pos": [
            324,
            390
          ]
        },
        {
          "content": "Because a new global context is created every time a script is run, any state variables that are defined in the script are reinitialized.",
          "pos": [
            391,
            528
          ]
        },
        {
          "content": "If you want to store state from one request to another, create a table in your mobile service, and then read and write the state to the table.",
          "pos": [
            529,
            671
          ]
        },
        {
          "content": "For more information, see [How to: Access tables from scripts].",
          "pos": [
            672,
            735
          ]
        }
      ]
    },
    {
      "pos": [
        3036,
        3286
      ],
      "content": "You write table operation scripts if you need to enforce customized business logic when the operation is executed. For example, the following script rejects insert operations where the string length of the <ph id=\"ph2\">`text`</ph><ph id=\"ph3\"/> field is greater than ten characters:",
      "nodes": [
        {
          "content": "You write table operation scripts if you need to enforce customized business logic when the operation is executed.",
          "pos": [
            0,
            114
          ]
        },
        {
          "content": "For example, the following script rejects insert operations where the string length of the <ph id=\"ph2\">`text`</ph><ph id=\"ph3\"/> field is greater than ten characters:",
          "pos": [
            115,
            282
          ]
        }
      ]
    },
    {
      "pos": [
        3552,
        3605
      ],
      "content": "A table script function always takes three arguments."
    },
    {
      "pos": [
        3609,
        3668
      ],
      "content": "The first argument varies depending on the table operation."
    },
    {
      "pos": [
        3677,
        3940
      ],
      "content": "For inserts and updates, it is an <bpt id=\"p3\">**</bpt>item<ept id=\"p3\">**</ept><ph id=\"ph4\"/> object, which is a JSON representation of the row being affected by the operation. This allows you to access column values by name, for example, <bpt id=\"p4\">*</bpt>item.Owner<ept id=\"p4\">*</ept>, where <bpt id=\"p5\">*</bpt>Owner<ept id=\"p5\">*</ept><ph id=\"ph5\"/> is one of the names in the JSON representation.",
      "nodes": [
        {
          "content": "For inserts and updates, it is an <bpt id=\"p3\">**</bpt>item<ept id=\"p3\">**</ept><ph id=\"ph4\"/> object, which is a JSON representation of the row being affected by the operation.",
          "pos": [
            0,
            177
          ]
        },
        {
          "content": "This allows you to access column values by name, for example, <bpt id=\"p4\">*</bpt>item.Owner<ept id=\"p4\">*</ept>, where <bpt id=\"p5\">*</bpt>Owner<ept id=\"p5\">*</ept><ph id=\"ph5\"/> is one of the names in the JSON representation.",
          "pos": [
            178,
            405
          ]
        }
      ]
    },
    {
      "pos": [
        3947,
        3998
      ],
      "content": "For a delete, it is the ID of the record to delete."
    },
    {
      "pos": [
        4006,
        4081
      ],
      "content": "And for a read, it is a [query object] that specifies the rowset to return."
    },
    {
      "pos": [
        4085,
        4196
      ],
      "content": "The second argument is always a [user object][User object] that represents the user that submitted the request."
    },
    {
      "pos": [
        4201,
        4371
      ],
      "content": "The third argument is always a [request object][request object], by which you can control execution of the requested operation and the response that's sent to the client."
    },
    {
      "pos": [
        4373,
        4446
      ],
      "content": "Here are the canonical main-function signatures for the table operations:"
    },
    {
      "pos": [
        4451,
        4525
      ],
      "content": "[Insert][insert function]: <ph id=\"ph6\">`function insert (item, user, request) { ... }`</ph>"
    },
    {
      "pos": [
        4528,
        4602
      ],
      "content": "[Update][update function]: <ph id=\"ph7\">`function update (item, user, request) { ... }`</ph>"
    },
    {
      "pos": [
        4605,
        4674
      ],
      "content": "[Delete][delete function]: <ph id=\"ph8\">`function del (id, user, request) { ... }`</ph>"
    },
    {
      "pos": [
        4677,
        4746
      ],
      "content": "[Read][read function]: <ph id=\"ph9\">`function read (query, user, request) { ... }`</ph>"
    },
    {
      "pos": [
        4749,
        4885
      ],
      "content": "<ph id=\"ph10\">[AZURE.NOTE]</ph>A function that's registered to the delete operation must be named <bpt id=\"p6\">_</bpt>del<ept id=\"p6\">_</ept><ph id=\"ph11\"/> because delete is a reserved keyword in JavaScript."
    },
    {
      "pos": [
        4888,
        5291
      ],
      "content": "Every server script has a main function, and may have optional helper functions. Even though a server script may have been created for a specific table, it can also reference other tables in the same database. You can also define common functions as modules that can be shared across scripts. For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
      "nodes": [
        {
          "content": "Every server script has a main function, and may have optional helper functions.",
          "pos": [
            0,
            80
          ]
        },
        {
          "content": "Even though a server script may have been created for a specific table, it can also reference other tables in the same database.",
          "pos": [
            81,
            209
          ]
        },
        {
          "content": "You can also define common functions as modules that can be shared across scripts.",
          "pos": [
            210,
            292
          ]
        },
        {
          "content": "For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
          "pos": [
            293,
            403
          ]
        }
      ]
    },
    {
      "pos": [
        5293,
        5296
      ],
      "content": "###"
    },
    {
      "pos": [
        5333,
        5363
      ],
      "content": "How to: Register table scripts"
    },
    {
      "pos": [
        5365,
        5465
      ],
      "content": "You can define server scripts that are registered to a table operation in one of the following ways:"
    },
    {
      "pos": [
        5469,
        5742
      ],
      "content": "In the [Azure classic portal]. Scripts for table operations are accessed in the <bpt id=\"p7\">**</bpt>Scripts<ept id=\"p7\">**</ept><ph id=\"ph12\"/> tab for a given table. The following shows the default code registered to the insert script for the <ph id=\"ph13\">`TodoItem`</ph><ph id=\"ph14\"/> table. You can override this code with your own custom business logic.",
      "nodes": [
        {
          "content": "In the [Azure classic portal].",
          "pos": [
            0,
            30
          ]
        },
        {
          "content": "Scripts for table operations are accessed in the <bpt id=\"p7\">**</bpt>Scripts<ept id=\"p7\">**</ept><ph id=\"ph12\"/> tab for a given table.",
          "pos": [
            31,
            167
          ]
        },
        {
          "content": "The following shows the default code registered to the insert script for the <ph id=\"ph13\">`TodoItem`</ph><ph id=\"ph14\"/> table.",
          "pos": [
            168,
            296
          ]
        },
        {
          "content": "You can override this code with your own custom business logic.",
          "pos": [
            297,
            360
          ]
        }
      ]
    },
    {
      "pos": [
        5748,
        5755
      ],
      "content": "<ph id=\"ph15\">![</ph>1<ph id=\"ph16\">][1]</ph>"
    },
    {
      "pos": [
        5765,
        5864
      ],
      "content": "To learn how to do this, see [Validate and modify data in Mobile Services by using server scripts]."
    },
    {
      "pos": [
        5870,
        6290
      ],
      "content": "By using source control. When you have source control enabled, simply create a file named <ph id=\"ph17\">&lt;em&gt;</ph><ph id=\"ph18\">`&lt;table&gt;`</ph><ph id=\"ph19\">&lt;/em&gt;</ph>.<ph id=\"ph20\">&lt;em&gt;</ph><ph id=\"ph21\">`&lt;operation&gt;`</ph><ph id=\"ph22\">&lt;/em&gt;</ph>.js in the .\\service\\table subfolder in your git repository, where <ph id=\"ph23\">&lt;em&gt;</ph><ph id=\"ph24\">`&lt;table&gt;`</ph><ph id=\"ph25\">&lt;/em&gt;</ph><ph id=\"ph26\"/> is the name of the table and <ph id=\"ph27\">&lt;em&gt;</ph><ph id=\"ph28\">`&lt;operation&gt;`</ph><ph id=\"ph29\">&lt;/em&gt;</ph><ph id=\"ph30\"/> is the table operation being registered. For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
      "nodes": [
        {
          "content": "By using source control.",
          "pos": [
            0,
            24
          ]
        },
        {
          "content": "When you have source control enabled, simply create a file named <ph id=\"ph17\">&lt;em&gt;</ph><ph id=\"ph18\">`&lt;table&gt;`</ph><ph id=\"ph19\">&lt;/em&gt;</ph>.<ph id=\"ph20\">&lt;em&gt;</ph><ph id=\"ph21\">`&lt;operation&gt;`</ph><ph id=\"ph22\">&lt;/em&gt;</ph>.js in the .\\service\\table subfolder in your git repository, where <ph id=\"ph23\">&lt;em&gt;</ph><ph id=\"ph24\">`&lt;table&gt;`</ph><ph id=\"ph25\">&lt;/em&gt;</ph><ph id=\"ph26\"/> is the name of the table and <ph id=\"ph27\">&lt;em&gt;</ph><ph id=\"ph28\">`&lt;operation&gt;`</ph><ph id=\"ph29\">&lt;/em&gt;</ph><ph id=\"ph30\"/> is the table operation being registered.",
          "pos": [
            25,
            639
          ]
        },
        {
          "content": "For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
          "pos": [
            640,
            750
          ]
        }
      ]
    },
    {
      "pos": [
        6294,
        6412
      ],
      "content": "From the command prompt by using the Azure command line tool. For more information, see [Using the command line tool].",
      "nodes": [
        {
          "content": "From the command prompt by using the Azure command line tool.",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "For more information, see [Using the command line tool].",
          "pos": [
            62,
            118
          ]
        }
      ]
    },
    {
      "pos": [
        6415,
        6563
      ],
      "content": "A table operation script must call at least one of the following functions of the [request object] to make sure that the client receives a response."
    },
    {
      "pos": [
        6569,
        6669
      ],
      "content": "<bpt id=\"p8\">**</bpt>execute function<ept id=\"p8\">**</ept>: The operation is completed as requested and the standard response is returned."
    },
    {
      "pos": [
        6674,
        6726
      ],
      "content": "<bpt id=\"p9\">**</bpt>respond function<ept id=\"p9\">**</ept>: A custom response is returned."
    },
    {
      "pos": [
        6730,
        6873
      ],
      "content": "<ph id=\"ph31\">[AZURE.IMPORTANT]</ph><ph id=\"ph32\"/> When a script has a code path in which neither <bpt id=\"p10\">**</bpt>execute<ept id=\"p10\">**</ept><ph id=\"ph33\"/> nor <bpt id=\"p11\">**</bpt>respond<ept id=\"p11\">**</ept><ph id=\"ph34\"/> is invoked, the operation may become unresponsive."
    },
    {
      "pos": [
        6875,
        6982
      ],
      "content": "The following script calls the <bpt id=\"p12\">**</bpt>execute<ept id=\"p12\">**</ept><ph id=\"ph35\"/> function to complete the data operation requested by the client:"
    },
    {
      "pos": [
        7064,
        7176
      ],
      "content": "In this example, the item is inserted into the database and the appropriate status code is returned to the user."
    },
    {
      "pos": [
        7179,
        7469
      ],
      "content": "When the <bpt id=\"p13\">**</bpt>execute<ept id=\"p13\">**</ept><ph id=\"ph36\"/> function is called, the <ph id=\"ph37\">`item`</ph>, [query][query object], or <ph id=\"ph38\">`id`</ph><ph id=\"ph39\"/> value that was passed as the first argument into the script function is used to perform the operation. For an insert, update or query operation, you can modify the item or query before you call <bpt id=\"p14\">**</bpt>execute<ept id=\"p14\">**</ept>:",
      "nodes": [
        {
          "content": "When the <bpt id=\"p13\">**</bpt>execute<ept id=\"p13\">**</ept><ph id=\"ph36\"/> function is called, the <ph id=\"ph37\">`item`</ph>, [query][query object], or <ph id=\"ph38\">`id`</ph><ph id=\"ph39\"/> value that was passed as the first argument into the script function is used to perform the operation.",
          "pos": [
            0,
            294
          ]
        },
        {
          "content": "For an insert, update or query operation, you can modify the item or query before you call <bpt id=\"p14\">**</bpt>execute<ept id=\"p14\">**</ept>:",
          "pos": [
            295,
            438
          ]
        }
      ]
    },
    {
      "pos": [
        8033,
        8158
      ],
      "content": "<ph id=\"ph40\">[AZURE.NOTE]</ph>In a delete script, changing the value of the supplied userId variable does not affect which record gets deleted."
    },
    {
      "pos": [
        8160,
        8247
      ],
      "content": "For more examples, see [Read and write data], [Modify the request] and [Validate data]."
    },
    {
      "pos": [
        8250,
        8253
      ],
      "content": "###"
    },
    {
      "pos": [
        8285,
        8322
      ],
      "content": "How to: Override the default response"
    },
    {
      "pos": [
        8324,
        8558
      ],
      "content": "You can also use a script to implement validation logic that can override the default response behavior. If validation fails, just call the <bpt id=\"p15\">**</bpt>respond<ept id=\"p15\">**</ept><ph id=\"ph41\"/> function instead of the <bpt id=\"p16\">**</bpt>execute<ept id=\"p16\">**</ept><ph id=\"ph42\"/> function and write the response to the client:",
      "nodes": [
        {
          "content": "You can also use a script to implement validation logic that can override the default response behavior.",
          "pos": [
            0,
            104
          ]
        },
        {
          "content": "If validation fails, just call the <bpt id=\"p15\">**</bpt>respond<ept id=\"p15\">**</ept><ph id=\"ph41\"/> function instead of the <bpt id=\"p16\">**</bpt>execute<ept id=\"p16\">**</ept><ph id=\"ph42\"/> function and write the response to the client:",
          "pos": [
            105,
            344
          ]
        }
      ]
    },
    {
      "pos": [
        8826,
        9225
      ],
      "content": "In this example, the request is rejected when the inserted item does not have a <ph id=\"ph43\">`userId`</ph><ph id=\"ph44\"/> property that matches the <ph id=\"ph45\">`userId`</ph><ph id=\"ph46\"/> of the [user object] that's supplied for the authenticated client. In this case, a database operation (<bpt id=\"p17\">*</bpt>insert<ept id=\"p17\">*</ept>) does not occur, and a response that has a 403 HTTP status code and a custom error message is returned to the client. For more examples, see [Modify the response].",
      "nodes": [
        {
          "content": "In this example, the request is rejected when the inserted item does not have a <ph id=\"ph43\">`userId`</ph><ph id=\"ph44\"/> property that matches the <ph id=\"ph45\">`userId`</ph><ph id=\"ph46\"/> of the [user object] that's supplied for the authenticated client.",
          "pos": [
            0,
            258
          ]
        },
        {
          "content": "In this case, a database operation (<bpt id=\"p17\">*</bpt>insert<ept id=\"p17\">*</ept>) does not occur, and a response that has a 403 HTTP status code and a custom error message is returned to the client.",
          "pos": [
            259,
            461
          ]
        },
        {
          "content": "For more examples, see [Modify the response].",
          "pos": [
            462,
            507
          ]
        }
      ]
    },
    {
      "pos": [
        9227,
        9230
      ],
      "content": "###"
    },
    {
      "pos": [
        9261,
        9293
      ],
      "content": "How to: Override execute success"
    },
    {
      "pos": [
        9295,
        9509
      ],
      "content": "By default in a table operation, the <bpt id=\"p18\">**</bpt>execute<ept id=\"p18\">**</ept><ph id=\"ph47\"/> function writes responses automatically. However, you can pass two optional parameters to the execute function that override its behavior on success and/or on error.",
      "nodes": [
        {
          "content": "By default in a table operation, the <bpt id=\"p18\">**</bpt>execute<ept id=\"p18\">**</ept><ph id=\"ph47\"/> function writes responses automatically.",
          "pos": [
            0,
            144
          ]
        },
        {
          "content": "However, you can pass two optional parameters to the execute function that override its behavior on success and/or on error.",
          "pos": [
            145,
            269
          ]
        }
      ]
    },
    {
      "pos": [
        9511,
        9822
      ],
      "content": "By passing in a <bpt id=\"p19\">**</bpt>success<ept id=\"p19\">**</ept><ph id=\"ph48\"/> handler when you call execute, you can modify the results of a query before you write them to the response. The following example calls <ph id=\"ph49\">`execute({ success: function(results) { ... })`</ph><ph id=\"ph50\"/> to perform additional work after data is read from the database but before the response is written:",
      "nodes": [
        {
          "content": "By passing in a <bpt id=\"p19\">**</bpt>success<ept id=\"p19\">**</ept><ph id=\"ph48\"/> handler when you call execute, you can modify the results of a query before you write them to the response.",
          "pos": [
            0,
            190
          ]
        },
        {
          "content": "The following example calls <ph id=\"ph49\">`execute({ success: function(results) { ... })`</ph><ph id=\"ph50\"/> to perform additional work after data is read from the database but before the response is written:",
          "pos": [
            191,
            400
          ]
        }
      ]
    },
    {
      "pos": [
        10184,
        10527
      ],
      "content": "When you provide a <bpt id=\"p20\">**</bpt>success<ept id=\"p20\">**</ept><ph id=\"ph51\"/> handler to the <bpt id=\"p21\">**</bpt>execute<ept id=\"p21\">**</ept><ph id=\"ph52\"/> function, you must also call the <bpt id=\"p22\">**</bpt>respond<ept id=\"p22\">**</ept><ph id=\"ph53\"/> function as part of the <bpt id=\"p23\">**</bpt>success<ept id=\"p23\">**</ept><ph id=\"ph54\"/> handler so that the runtime knows that the script has completed and that a response can be written. When you call <bpt id=\"p24\">**</bpt>respond<ept id=\"p24\">**</ept><ph id=\"ph55\"/> without passing any arguments, Mobile Services generates the default response.",
      "nodes": [
        {
          "content": "When you provide a <bpt id=\"p20\">**</bpt>success<ept id=\"p20\">**</ept><ph id=\"ph51\"/> handler to the <bpt id=\"p21\">**</bpt>execute<ept id=\"p21\">**</ept><ph id=\"ph52\"/> function, you must also call the <bpt id=\"p22\">**</bpt>respond<ept id=\"p22\">**</ept><ph id=\"ph53\"/> function as part of the <bpt id=\"p23\">**</bpt>success<ept id=\"p23\">**</ept><ph id=\"ph54\"/> handler so that the runtime knows that the script has completed and that a response can be written.",
          "pos": [
            0,
            458
          ]
        },
        {
          "content": "When you call <bpt id=\"p24\">**</bpt>respond<ept id=\"p24\">**</ept><ph id=\"ph55\"/> without passing any arguments, Mobile Services generates the default response.",
          "pos": [
            459,
            618
          ]
        }
      ]
    },
    {
      "pos": [
        10531,
        10668
      ],
      "content": "<ph id=\"ph56\">[AZURE.NOTE]</ph>You can call <bpt id=\"p25\">**</bpt>respond<ept id=\"p25\">**</ept><ph id=\"ph57\"/> without arguments to invoke the default response only after you first call the <bpt id=\"p26\">**</bpt>execute<ept id=\"p26\">**</ept><ph id=\"ph58\"/> function."
    },
    {
      "pos": [
        10671,
        10674
      ],
      "content": "###"
    },
    {
      "pos": [
        10703,
        10742
      ],
      "content": "How to: Override default error handling"
    },
    {
      "pos": [
        10744,
        11096
      ],
      "content": "The <bpt id=\"p27\">**</bpt>execute<ept id=\"p27\">**</ept><ph id=\"ph59\"/> function can fail if there is a loss of connectivity to the database, an invalid object, or an incorrect query. By default when an error occurs, server scripts log the error and write an error result to the response. Because Mobile Services provides default error handling, you don't have to handle errors that may occur in the service.",
      "nodes": [
        {
          "content": "The <bpt id=\"p27\">**</bpt>execute<ept id=\"p27\">**</ept><ph id=\"ph59\"/> function can fail if there is a loss of connectivity to the database, an invalid object, or an incorrect query.",
          "pos": [
            0,
            182
          ]
        },
        {
          "content": "By default when an error occurs, server scripts log the error and write an error result to the response.",
          "pos": [
            183,
            287
          ]
        },
        {
          "content": "Because Mobile Services provides default error handling, you don't have to handle errors that may occur in the service.",
          "pos": [
            288,
            407
          ]
        }
      ]
    },
    {
      "pos": [
        11099,
        11395
      ],
      "content": "You can override the default error handling by implementing explicit error handling if you want a particular compensating action or when you want to use the global console object to write more detailed information to the log. Do this by supplying an <bpt id=\"p28\">**</bpt>error<ept id=\"p28\">**</ept><ph id=\"ph60\"/> handler to the <bpt id=\"p29\">**</bpt>execute<ept id=\"p29\">**</ept><ph id=\"ph61\"/> function:",
      "nodes": [
        {
          "content": "You can override the default error handling by implementing explicit error handling if you want a particular compensating action or when you want to use the global console object to write more detailed information to the log.",
          "pos": [
            0,
            225
          ]
        },
        {
          "content": "Do this by supplying an <bpt id=\"p28\">**</bpt>error<ept id=\"p28\">**</ept><ph id=\"ph60\"/> handler to the <bpt id=\"p29\">**</bpt>execute<ept id=\"p29\">**</ept><ph id=\"ph61\"/> function:",
          "pos": [
            226,
            406
          ]
        }
      ]
    },
    {
      "pos": [
        11616,
        11732
      ],
      "content": "When you provide an error handler, Mobile Services returns an error result to the client when <bpt id=\"p30\">**</bpt>respond<ept id=\"p30\">**</ept><ph id=\"ph62\"/> is called."
    },
    {
      "pos": [
        11734,
        11811
      ],
      "content": "You can also provide both a <bpt id=\"p31\">**</bpt>success<ept id=\"p31\">**</ept><ph id=\"ph63\"/> and an <bpt id=\"p32\">**</bpt>error<ept id=\"p32\">**</ept><ph id=\"ph64\"/> handler if you wish."
    },
    {
      "pos": [
        11813,
        11816
      ],
      "content": "###"
    },
    {
      "pos": [
        11845,
        11878
      ],
      "content": "How to: Generate unique ID values"
    },
    {
      "pos": [
        11880,
        12059
      ],
      "content": "Mobile Services supports unique custom string values for the table's <bpt id=\"p33\">**</bpt>id<ept id=\"p33\">**</ept><ph id=\"ph65\"/> column. This allows applications to use custom values such as email addresses or user names for the ID.",
      "nodes": [
        {
          "content": "Mobile Services supports unique custom string values for the table's <bpt id=\"p33\">**</bpt>id<ept id=\"p33\">**</ept><ph id=\"ph65\"/> column.",
          "pos": [
            0,
            138
          ]
        },
        {
          "content": "This allows applications to use custom values such as email addresses or user names for the ID.",
          "pos": [
            139,
            234
          ]
        }
      ]
    },
    {
      "pos": [
        12062,
        12113
      ],
      "content": "String IDs provide you with the following benefits:"
    },
    {
      "pos": [
        12117,
        12179
      ],
      "content": "IDs are generated without making a round-trip to the database."
    },
    {
      "pos": [
        12182,
        12245
      ],
      "content": "Records are easier to merge from different tables or databases."
    },
    {
      "pos": [
        12248,
        12308
      ],
      "content": "IDs values can integrate better with an application's logic."
    },
    {
      "pos": [
        12310,
        12685
      ],
      "content": "When a string ID value is not set on an inserted records, Mobile Services generates a unique value for the ID. You can generate your own unique ID values in server scripts. The script example below generates a custom GUID and assigns it to a new record's ID. This is similar to the id value that Mobile Services would generate if you didn't pass in a value for a record's ID.",
      "nodes": [
        {
          "content": "When a string ID value is not set on an inserted records, Mobile Services generates a unique value for the ID.",
          "pos": [
            0,
            110
          ]
        },
        {
          "content": "You can generate your own unique ID values in server scripts.",
          "pos": [
            111,
            172
          ]
        },
        {
          "content": "The script example below generates a custom GUID and assigns it to a new record's ID.",
          "pos": [
            173,
            258
          ]
        },
        {
          "content": "This is similar to the id value that Mobile Services would generate if you didn't pass in a value for a record's ID.",
          "pos": [
            259,
            375
          ]
        }
      ]
    },
    {
      "pos": [
        13216,
        13384
      ],
      "content": "When an application provides a value for an ID, Mobile Services stores it as-is. This includes leading or trailing white spaces. White space are not trimmed from value.",
      "nodes": [
        {
          "content": "When an application provides a value for an ID, Mobile Services stores it as-is.",
          "pos": [
            0,
            80
          ]
        },
        {
          "content": "This includes leading or trailing white spaces.",
          "pos": [
            81,
            128
          ]
        },
        {
          "content": "White space are not trimmed from value.",
          "pos": [
            129,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        13386,
        13483
      ],
      "content": "The value for the <ph id=\"ph66\">`id`</ph><ph id=\"ph67\"/> must be unique and it must not include characters from the following sets:"
    },
    {
      "pos": [
        13487,
        13666
      ],
      "content": "Control characters: [0x0000-0x001F] and [0x007F-0x009F]. For more information, see <bpt id=\"p34\">[</bpt>ASCII control codes C0 and C1<ept id=\"p34\">](http://en.wikipedia.org/wiki/Data_link_escape_character#C1_set)</ept>.",
      "nodes": [
        {
          "content": "Control characters: [0x0000-0x001F] and [0x007F-0x009F].",
          "pos": [
            0,
            56
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p34\">[</bpt>ASCII control codes C0 and C1<ept id=\"p34\">](http://en.wikipedia.org/wiki/Data_link_escape_character#C1_set)</ept>.",
          "pos": [
            57,
            219
          ]
        }
      ]
    },
    {
      "pos": [
        13670,
        13787
      ],
      "content": "Printable characters: <bpt id=\"p35\">**</bpt>\"<ept id=\"p35\">**</ept>(0x0022), <bpt id=\"p36\">**</bpt>\\+<ept id=\"p36\">**</ept><ph id=\"ph68\"/> (0x002B), <bpt id=\"p37\">**</bpt>/<ept id=\"p37\">**</ept><ph id=\"ph69\"/> (0x002F), <bpt id=\"p38\">**</bpt>?<ept id=\"p38\">**</ept><ph id=\"ph70\"/> (0x003F), <bpt id=\"p39\">**</bpt>\\\\<ept id=\"p39\">**</ept><ph id=\"ph71\"/> (0x005C), <bpt id=\"p40\">**</bpt>`<ept id=\"p40\">**</ept><ph id=\"ph72\"/> (0x0060)"
    },
    {
      "pos": [
        13791,
        13811
      ],
      "content": "The ids \".\" and \"..\""
    },
    {
      "pos": [
        13813,
        14188
      ],
      "content": "You can also use integer IDs for your tables. To use an integer ID, you must create your table with the <ph id=\"ph73\">`mobile table create`</ph><ph id=\"ph74\"/> command using the <ph id=\"ph75\">`--integerId`</ph><ph id=\"ph76\"/> option. This command is used with the Command-line Interface (CLI) for Azure. For more information on using the CLI, see <bpt id=\"p41\">[</bpt>CLI to manage Mobile Services tables<ept id=\"p41\">](../virtual-machines-command-line-tools.md#Mobile_Tables)</ept>.",
      "nodes": [
        {
          "content": "You can also use integer IDs for your tables.",
          "pos": [
            0,
            45
          ]
        },
        {
          "content": "To use an integer ID, you must create your table with the <ph id=\"ph73\">`mobile table create`</ph><ph id=\"ph74\"/> command using the <ph id=\"ph75\">`--integerId`</ph><ph id=\"ph76\"/> option.",
          "pos": [
            46,
            233
          ]
        },
        {
          "content": "This command is used with the Command-line Interface (CLI) for Azure.",
          "pos": [
            234,
            303
          ]
        },
        {
          "content": "For more information on using the CLI, see <bpt id=\"p41\">[</bpt>CLI to manage Mobile Services tables<ept id=\"p41\">](../virtual-machines-command-line-tools.md#Mobile_Tables)</ept>.",
          "pos": [
            304,
            483
          ]
        }
      ]
    },
    {
      "pos": [
        14191,
        14194
      ],
      "content": "###"
    },
    {
      "pos": [
        14223,
        14255
      ],
      "content": "How to: Access custom parameters"
    },
    {
      "pos": [
        14257,
        14524
      ],
      "content": "When you send a request to your mobile service, you can include custom parameters in the URI of the request to instruct your table operation scripts how to process a given request. You then modify your script to inspect the parameter to determine the processing path.",
      "nodes": [
        {
          "content": "When you send a request to your mobile service, you can include custom parameters in the URI of the request to instruct your table operation scripts how to process a given request.",
          "pos": [
            0,
            180
          ]
        },
        {
          "content": "You then modify your script to inspect the parameter to determine the processing path.",
          "pos": [
            181,
            267
          ]
        }
      ]
    },
    {
      "pos": [
        14526,
        14671
      ],
      "content": "For example, the following URI for a POST request tells the service to not permit the insertion of a new <bpt id=\"p42\">*</bpt>TodoItem<ept id=\"p42\">*</ept><ph id=\"ph77\"/> that has the same text value:"
    },
    {
      "pos": [
        14752,
        15109
      ],
      "content": "These custom query parameters are accessed as JSON values from the <bpt id=\"p43\">**</bpt>parameters<ept id=\"p43\">**</ept><ph id=\"ph78\"/> property of the [request object]. The <bpt id=\"p44\">**</bpt>request<ept id=\"p44\">**</ept><ph id=\"ph79\"/> object is supplied by Mobile Services to any function registered to a table operation. The following server script for the insert operation checks the value of the <ph id=\"ph80\">`duplicateText`</ph><ph id=\"ph81\"/> parameter before the insert operation is run:",
      "nodes": [
        {
          "content": "These custom query parameters are accessed as JSON values from the <bpt id=\"p43\">**</bpt>parameters<ept id=\"p43\">**</ept><ph id=\"ph78\"/> property of the [request object].",
          "pos": [
            0,
            170
          ]
        },
        {
          "content": "The <bpt id=\"p44\">**</bpt>request<ept id=\"p44\">**</ept><ph id=\"ph79\"/> object is supplied by Mobile Services to any function registered to a table operation.",
          "pos": [
            171,
            328
          ]
        },
        {
          "content": "The following server script for the insert operation checks the value of the <ph id=\"ph80\">`duplicateText`</ph><ph id=\"ph81\"/> parameter before the insert operation is run:",
          "pos": [
            329,
            501
          ]
        }
      ]
    },
    {
      "pos": [
        16207,
        16444
      ],
      "content": "Note that in <bpt id=\"p45\">**</bpt>insertItemIfNotComplete<ept id=\"p45\">**</ept><ph id=\"ph82\"/> the <bpt id=\"p46\">**</bpt>execute<ept id=\"p46\">**</ept><ph id=\"ph83\"/> function of the [request object] is invoked to insert the item when there is no duplicate text; otherwise the <bpt id=\"p47\">**</bpt>respond<ept id=\"p47\">**</ept><ph id=\"ph84\"/> function is invoked to notify the client of the duplicate."
    },
    {
      "pos": [
        16447,
        16521
      ],
      "content": "Note the syntax of the call to the <bpt id=\"p48\">**</bpt>success<ept id=\"p48\">**</ept><ph id=\"ph85\"/> function in the above code:"
    },
    {
      "pos": [
        16623,
        16689
      ],
      "content": "In JavaScript it is a compact version of the lengthier equivalent:"
    },
    {
      "pos": [
        16798,
        16801
      ],
      "content": "###"
    },
    {
      "pos": [
        16831,
        16854
      ],
      "content": "How to: Work with users"
    },
    {
      "pos": [
        16856,
        17355
      ],
      "content": "In Azure Mobile Services, you can use an identity provider to authenticate users. For more information, see [Get started with authentication]. When an authenticated user invokes a table operation, Mobile Services uses the [user object] to supply information about the user to the registered script function. The <bpt id=\"p49\">**</bpt>userId<ept id=\"p49\">**</ept><ph id=\"ph86\"/> property can be used to store and retrieve user-specific information. The following example sets the owner property of an item based on the <bpt id=\"p50\">**</bpt>userId<ept id=\"p50\">**</ept><ph id=\"ph87\"/> of an authenticated user:",
      "nodes": [
        {
          "content": "In Azure Mobile Services, you can use an identity provider to authenticate users.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "For more information, see [Get started with authentication].",
          "pos": [
            82,
            142
          ]
        },
        {
          "content": "When an authenticated user invokes a table operation, Mobile Services uses the [user object] to supply information about the user to the registered script function.",
          "pos": [
            143,
            307
          ]
        },
        {
          "content": "The <bpt id=\"p49\">**</bpt>userId<ept id=\"p49\">**</ept><ph id=\"ph86\"/> property can be used to store and retrieve user-specific information.",
          "pos": [
            308,
            447
          ]
        },
        {
          "content": "The following example sets the owner property of an item based on the <bpt id=\"p50\">**</bpt>userId<ept id=\"p50\">**</ept><ph id=\"ph87\"/> of an authenticated user:",
          "pos": [
            448,
            609
          ]
        }
      ]
    },
    {
      "pos": [
        17468,
        17653
      ],
      "content": "The next example adds an additional filter to the query based on the <bpt id=\"p51\">**</bpt>userId<ept id=\"p51\">**</ept><ph id=\"ph88\"/> of an authenticated user. This filter restricts the result to only items that belong to the current user:",
      "nodes": [
        {
          "content": "The next example adds an additional filter to the query based on the <bpt id=\"p51\">**</bpt>userId<ept id=\"p51\">**</ept><ph id=\"ph88\"/> of an authenticated user.",
          "pos": [
            0,
            160
          ]
        },
        {
          "content": "This filter restricts the result to only items that belong to the current user:",
          "pos": [
            161,
            240
          ]
        }
      ]
    },
    {
      "pos": [
        17798,
        17800
      ],
      "content": "##"
    },
    {
      "pos": [
        17825,
        17836
      ],
      "content": "Custom APIs"
    },
    {
      "pos": [
        17838,
        17950
      ],
      "content": "This section describes how you create and work with custom API endpoints, which includes the following sections:"
    },
    {
      "pos": [
        17959,
        18006
      ],
      "content": "<bpt id=\"p52\">[</bpt>Overview of custom APIs<ept id=\"p52\">](#custom-api-overview)</ept>"
    },
    {
      "pos": [
        18009,
        18038
      ],
      "content": "[How to: Define a custom API]"
    },
    {
      "pos": [
        18041,
        18073
      ],
      "content": "[How to: Implement HTTP methods]"
    },
    {
      "pos": [
        18076,
        18114
      ],
      "content": "[How to: Send and receive data as XML]"
    },
    {
      "pos": [
        18117,
        18170
      ],
      "content": "[How to: Work with users and headers in a custom API]"
    },
    {
      "pos": [
        18173,
        18221
      ],
      "content": "[How to: Define multiple routes in a custom API]"
    },
    {
      "pos": [
        18223,
        18226
      ],
      "content": "###"
    },
    {
      "pos": [
        18260,
        18283
      ],
      "content": "Overview of custom APIs"
    },
    {
      "pos": [
        18285,
        18691
      ],
      "content": "A custom API is an endpoint in your mobile service that is accessed by one or more of the standard HTTP methods: GET, POST, PUT, PATCH, DELETE. A separate function export can be defined for each HTTP method supported by the custom API, all in a single script file. The registered script is invoked when a request to the custom API using the given method is received. For more information, see [Custom API].",
      "nodes": [
        {
          "content": "A custom API is an endpoint in your mobile service that is accessed by one or more of the standard HTTP methods: GET, POST, PUT, PATCH, DELETE.",
          "pos": [
            0,
            143
          ]
        },
        {
          "content": "A separate function export can be defined for each HTTP method supported by the custom API, all in a single script file.",
          "pos": [
            144,
            264
          ]
        },
        {
          "content": "The registered script is invoked when a request to the custom API using the given method is received.",
          "pos": [
            265,
            366
          ]
        },
        {
          "content": "For more information, see [Custom API].",
          "pos": [
            367,
            406
          ]
        }
      ]
    },
    {
      "pos": [
        18693,
        19081
      ],
      "content": "When custom API functions are called by the Mobile Services runtime, both a [request][request object] and [response][response object] object are supplied. These objects expose the functionality of the [express.js library], which can be leveraged by your scripts. The following custom API named <bpt id=\"p53\">**</bpt>hello<ept id=\"p53\">**</ept><ph id=\"ph89\"/> is a very simple example that returns <bpt id=\"p54\">_</bpt>Hello, world!<ept id=\"p54\">_</ept><ph id=\"ph90\"/> in response to a POST request:",
      "nodes": [
        {
          "content": "When custom API functions are called by the Mobile Services runtime, both a [request][request object] and [response][response object] object are supplied.",
          "pos": [
            0,
            154
          ]
        },
        {
          "content": "These objects expose the functionality of the [express.js library], which can be leveraged by your scripts.",
          "pos": [
            155,
            262
          ]
        },
        {
          "content": "The following custom API named <bpt id=\"p53\">**</bpt>hello<ept id=\"p53\">**</ept><ph id=\"ph89\"/> is a very simple example that returns <bpt id=\"p54\">_</bpt>Hello, world!<ept id=\"p54\">_</ept><ph id=\"ph90\"/> in response to a POST request:",
          "pos": [
            263,
            498
          ]
        }
      ]
    },
    {
      "pos": [
        19212,
        19372
      ],
      "content": "The <bpt id=\"p55\">**</bpt>send<ept id=\"p55\">**</ept><ph id=\"ph91\"/> function on the [response object] returns your desired response to the client. This code is invoked by sending a POST request to the following URL:",
      "nodes": [
        {
          "content": "The <bpt id=\"p55\">**</bpt>send<ept id=\"p55\">**</ept><ph id=\"ph91\"/> function on the [response object] returns your desired response to the client.",
          "pos": [
            0,
            146
          ]
        },
        {
          "content": "This code is invoked by sending a POST request to the following URL:",
          "pos": [
            147,
            215
          ]
        }
      ]
    },
    {
      "pos": [
        19429,
        19479
      ],
      "content": "The global state is maintained between executions."
    },
    {
      "pos": [
        19482,
        19485
      ],
      "content": "###"
    },
    {
      "pos": [
        19517,
        19544
      ],
      "content": "How to: Define a custom API"
    },
    {
      "pos": [
        19546,
        19666
      ],
      "content": "You can define server scripts that are registered to HTTP methods in a custom API endpoint in one of the following ways:"
    },
    {
      "pos": [
        19670,
        19943
      ],
      "content": "In the [Azure classic portal]. Custom API scripts are created and modified in the <bpt id=\"p56\">**</bpt>API<ept id=\"p56\">**</ept><ph id=\"ph92\"/> tab. The server script code is in the <bpt id=\"p57\">**</bpt>Scripts<ept id=\"p57\">**</ept><ph id=\"ph93\"/> tab of a given custom API. The following shows the script that is invoked by a POST request to the <ph id=\"ph94\">`CompleteAll`</ph><ph id=\"ph95\"/> custom API endpoint.",
      "nodes": [
        {
          "content": "In the [Azure classic portal].",
          "pos": [
            0,
            30
          ]
        },
        {
          "content": "Custom API scripts are created and modified in the <bpt id=\"p56\">**</bpt>API<ept id=\"p56\">**</ept><ph id=\"ph92\"/> tab.",
          "pos": [
            31,
            149
          ]
        },
        {
          "content": "The server script code is in the <bpt id=\"p57\">**</bpt>Scripts<ept id=\"p57\">**</ept><ph id=\"ph93\"/> tab of a given custom API.",
          "pos": [
            150,
            276
          ]
        },
        {
          "content": "The following shows the script that is invoked by a POST request to the <ph id=\"ph94\">`CompleteAll`</ph><ph id=\"ph95\"/> custom API endpoint.",
          "pos": [
            277,
            417
          ]
        }
      ]
    },
    {
      "pos": [
        19950,
        19957
      ],
      "content": "<ph id=\"ph96\">![</ph>2<ph id=\"ph97\">][2]</ph>"
    },
    {
      "pos": [
        19967,
        20125
      ],
      "content": "Access permissions to custom API methods are assigned in the Permissions tab. To see how this custom API was created, see [Call a custom API from the client].",
      "nodes": [
        {
          "content": "Access permissions to custom API methods are assigned in the Permissions tab.",
          "pos": [
            0,
            77
          ]
        },
        {
          "content": "To see how this custom API was created, see [Call a custom API from the client].",
          "pos": [
            78,
            158
          ]
        }
      ]
    },
    {
      "pos": [
        20131,
        20639
      ],
      "content": "By using source control. When you have source control enabled, simply create a file named <ph id=\"ph98\">&lt;em&gt;</ph><ph id=\"ph99\">`&lt;custom_api&gt;`</ph><ph id=\"ph100\">&lt;/em&gt;</ph>.js in the .\\service\\api subfolder in your git repository, where <ph id=\"ph101\">&lt;em&gt;</ph><ph id=\"ph102\">`&lt;custom_api&gt;`</ph><ph id=\"ph103\">&lt;/em&gt;</ph><ph id=\"ph104\"/> is the name of the custom API being registered. This script file contains an <bpt id=\"p58\">_</bpt>exported<ept id=\"p58\">_</ept><ph id=\"ph105\"/> function for each HTTP method exposed by the custom API. Permissions are defined in a companion .json file. For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
      "nodes": [
        {
          "content": "By using source control.",
          "pos": [
            0,
            24
          ]
        },
        {
          "content": "When you have source control enabled, simply create a file named <ph id=\"ph98\">&lt;em&gt;</ph><ph id=\"ph99\">`&lt;custom_api&gt;`</ph><ph id=\"ph100\">&lt;/em&gt;</ph>.js in the .\\service\\api subfolder in your git repository, where <ph id=\"ph101\">&lt;em&gt;</ph><ph id=\"ph102\">`&lt;custom_api&gt;`</ph><ph id=\"ph103\">&lt;/em&gt;</ph><ph id=\"ph104\"/> is the name of the custom API being registered.",
          "pos": [
            25,
            419
          ]
        },
        {
          "content": "This script file contains an <bpt id=\"p58\">_</bpt>exported<ept id=\"p58\">_</ept><ph id=\"ph105\"/> function for each HTTP method exposed by the custom API.",
          "pos": [
            420,
            572
          ]
        },
        {
          "content": "Permissions are defined in a companion .json file.",
          "pos": [
            573,
            623
          ]
        },
        {
          "content": "For more information, see [Source control and shared code][Source control, shared code, and helper functions].",
          "pos": [
            624,
            734
          ]
        }
      ]
    },
    {
      "pos": [
        20643,
        20761
      ],
      "content": "From the command prompt by using the Azure command line tool. For more information, see [Using the command line tool].",
      "nodes": [
        {
          "content": "From the command prompt by using the Azure command line tool.",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "For more information, see [Using the command line tool].",
          "pos": [
            62,
            118
          ]
        }
      ]
    },
    {
      "pos": [
        20763,
        20766
      ],
      "content": "###"
    },
    {
      "pos": [
        20795,
        20825
      ],
      "content": "How to: Implement HTTP methods"
    },
    {
      "pos": [
        20827,
        21078
      ],
      "content": "A custom API can handle one or more of the HTTP methods, GET, POST, PUT, PATCH, and DELETE. An exported function is defined for each HTTP method handled by the custom API. A single custom API code file can export one or all of the following functions:",
      "nodes": [
        {
          "content": "A custom API can handle one or more of the HTTP methods, GET, POST, PUT, PATCH, and DELETE.",
          "pos": [
            0,
            91
          ]
        },
        {
          "content": "An exported function is defined for each HTTP method handled by the custom API.",
          "pos": [
            92,
            171
          ]
        },
        {
          "content": "A single custom API code file can export one or all of the following functions:",
          "pos": [
            172,
            251
          ]
        }
      ]
    },
    {
      "pos": [
        21382,
        21626
      ],
      "content": "The custom API endpoint cannot be called using an HTTP method that has not been implemented in the server script, and a 405 (Method Not Allowed) error response is returned. Separate permission levels can be assigned to each support HTTP method.",
      "nodes": [
        {
          "content": "The custom API endpoint cannot be called using an HTTP method that has not been implemented in the server script, and a 405 (Method Not Allowed) error response is returned.",
          "pos": [
            0,
            172
          ]
        },
        {
          "content": "Separate permission levels can be assigned to each support HTTP method.",
          "pos": [
            173,
            244
          ]
        }
      ]
    },
    {
      "pos": [
        21628,
        21631
      ],
      "content": "###"
    },
    {
      "pos": [
        21660,
        21696
      ],
      "content": "How to: Send and receive data as XML"
    },
    {
      "pos": [
        21698,
        22114
      ],
      "content": "When clients store and retrieve data, Mobile Services uses JavaScript Object Notation (JSON) to represent data in the message body. However, there are scenarios where you instead want to use an XML payload. For example, Windows Store apps have a built-in periodic notifications functionality that requires the service to emit XML. For more information, see [Define a custom API that supports periodic notifications].",
      "nodes": [
        {
          "content": "When clients store and retrieve data, Mobile Services uses JavaScript Object Notation (JSON) to represent data in the message body.",
          "pos": [
            0,
            131
          ]
        },
        {
          "content": "However, there are scenarios where you instead want to use an XML payload.",
          "pos": [
            132,
            206
          ]
        },
        {
          "content": "For example, Windows Store apps have a built-in periodic notifications functionality that requires the service to emit XML.",
          "pos": [
            207,
            330
          ]
        },
        {
          "content": "For more information, see [Define a custom API that supports periodic notifications].",
          "pos": [
            331,
            416
          ]
        }
      ]
    },
    {
      "pos": [
        22116,
        22219
      ],
      "content": "The following <bpt id=\"p59\">**</bpt>OrderPizza<ept id=\"p59\">**</ept><ph id=\"ph106\"/> custom API function returns a simple XML document as the response payload:"
    },
    {
      "pos": [
        22457,
        22542
      ],
      "content": "This custom API function is invoked by an HTTP GET request to the following endpoint:"
    },
    {
      "pos": [
        22602,
        22605
      ],
      "content": "###"
    },
    {
      "pos": [
        22632,
        22683
      ],
      "content": "How to: Work with users and headers in a custom API"
    },
    {
      "pos": [
        22685,
        23137
      ],
      "content": "In Azure Mobile Services, you can use an identity provider to authenticate users. For more information, see [Get started with authentication]. When an authenticated user requests a custom API, Mobile Services uses the [user object] to provide information about the user to custom API code. The [user object] is accessed from the user property of the [request object]. The <bpt id=\"p60\">**</bpt>userId<ept id=\"p60\">**</ept><ph id=\"ph107\"/> property can be used to store and retrieve user-specific information.",
      "nodes": [
        {
          "content": "In Azure Mobile Services, you can use an identity provider to authenticate users.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "For more information, see [Get started with authentication].",
          "pos": [
            82,
            142
          ]
        },
        {
          "content": "When an authenticated user requests a custom API, Mobile Services uses the [user object] to provide information about the user to custom API code.",
          "pos": [
            143,
            289
          ]
        },
        {
          "content": "The [user object] is accessed from the user property of the [request object].",
          "pos": [
            290,
            367
          ]
        },
        {
          "content": "The <bpt id=\"p60\">**</bpt>userId<ept id=\"p60\">**</ept><ph id=\"ph107\"/> property can be used to store and retrieve user-specific information.",
          "pos": [
            368,
            508
          ]
        }
      ]
    },
    {
      "pos": [
        23140,
        23273
      ],
      "content": "The following <bpt id=\"p61\">**</bpt>OrderPizza<ept id=\"p61\">**</ept><ph id=\"ph108\"/> custom API function sets the owner property of an item based on the <bpt id=\"p62\">**</bpt>userId<ept id=\"p62\">**</ept><ph id=\"ph109\"/> of an authenticated user:"
    },
    {
      "pos": [
        23716,
        23802
      ],
      "content": "This custom API function is invoked by an HTTP POST request to the following endpoint:"
    },
    {
      "pos": [
        23863,
        23964
      ],
      "content": "You can also access a specific HTTP header from the [request object], as shown in the following code:"
    },
    {
      "pos": [
        24150,
        24257
      ],
      "content": "This simple example reads a custom header named <ph id=\"ph110\">`my-custom-header`</ph>, then returns the value in the response."
    },
    {
      "pos": [
        24259,
        24262
      ],
      "content": "###"
    },
    {
      "pos": [
        24287,
        24333
      ],
      "content": "How to: Define multiple routes in a custom API"
    },
    {
      "pos": [
        24335,
        24563
      ],
      "content": "Mobile Services enables you to define multiple paths, or routes, in a custom API. For example, HTTP GET requests to the following URLs in a <bpt id=\"p63\">**</bpt>calculator<ept id=\"p63\">**</ept><ph id=\"ph111\"/> custom API will invoke an <bpt id=\"p64\">**</bpt>add<ept id=\"p64\">**</ept><ph id=\"ph112\"/> or <bpt id=\"p65\">**</bpt>subtract<ept id=\"p65\">**</ept><ph id=\"ph113\"/> function, respectively:",
      "nodes": [
        {
          "content": "Mobile Services enables you to define multiple paths, or routes, in a custom API.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "For example, HTTP GET requests to the following URLs in a <bpt id=\"p63\">**</bpt>calculator<ept id=\"p63\">**</ept><ph id=\"ph111\"/> custom API will invoke an <bpt id=\"p64\">**</bpt>add<ept id=\"p64\">**</ept><ph id=\"ph112\"/> or <bpt id=\"p65\">**</bpt>subtract<ept id=\"p65\">**</ept><ph id=\"ph113\"/> function, respectively:",
          "pos": [
            82,
            396
          ]
        }
      ]
    },
    {
      "pos": [
        24683,
        24992
      ],
      "content": "Multiple routes are defined by exporting a <bpt id=\"p66\">**</bpt>register<ept id=\"p66\">**</ept><ph id=\"ph116\"/> function, which is passed an <bpt id=\"p67\">**</bpt>api<ept id=\"p67\">**</ept><ph id=\"ph117\"/> object (similar to the [express object in express.js]) that is used to register routes under the custom API endpoint. The following example implements the <bpt id=\"p68\">**</bpt>add<ept id=\"p68\">**</ept><ph id=\"ph118\"/> and <bpt id=\"p69\">**</bpt>sub<ept id=\"p69\">**</ept><ph id=\"ph119\"/> methods in the <bpt id=\"p70\">**</bpt>calculator<ept id=\"p70\">**</ept><ph id=\"ph120\"/> custom API:",
      "nodes": [
        {
          "content": "Multiple routes are defined by exporting a <bpt id=\"p66\">**</bpt>register<ept id=\"p66\">**</ept><ph id=\"ph116\"/> function, which is passed an <bpt id=\"p67\">**</bpt>api<ept id=\"p67\">**</ept><ph id=\"ph117\"/> object (similar to the [express object in express.js]) that is used to register routes under the custom API endpoint.",
          "pos": [
            0,
            322
          ]
        },
        {
          "content": "The following example implements the <bpt id=\"p68\">**</bpt>add<ept id=\"p68\">**</ept><ph id=\"ph118\"/> and <bpt id=\"p69\">**</bpt>sub<ept id=\"p69\">**</ept><ph id=\"ph119\"/> methods in the <bpt id=\"p70\">**</bpt>calculator<ept id=\"p70\">**</ept><ph id=\"ph120\"/> custom API:",
          "pos": [
            323,
            589
          ]
        }
      ]
    },
    {
      "pos": [
        25468,
        25818
      ],
      "content": "The <bpt id=\"p71\">**</bpt>api<ept id=\"p71\">**</ept><ph id=\"ph121\"/> object passed to the <bpt id=\"p72\">**</bpt>register<ept id=\"p72\">**</ept><ph id=\"ph122\"/> function exposes a function for each HTTP method (<bpt id=\"p73\">**</bpt>get<ept id=\"p73\">**</ept>, <bpt id=\"p74\">**</bpt>post<ept id=\"p74\">**</ept>, <bpt id=\"p75\">**</bpt>put<ept id=\"p75\">**</ept>, <bpt id=\"p76\">**</bpt>patch<ept id=\"p76\">**</ept>, <bpt id=\"p77\">**</bpt>delete<ept id=\"p77\">**</ept>). These functions register a route to a defined function for a specific HTTP method. Each function takes two parameters, the first is the route name and the second is the function registered to the route.",
      "nodes": [
        {
          "content": "The <bpt id=\"p71\">**</bpt>api<ept id=\"p71\">**</ept><ph id=\"ph121\"/> object passed to the <bpt id=\"p72\">**</bpt>register<ept id=\"p72\">**</ept><ph id=\"ph122\"/> function exposes a function for each HTTP method (<bpt id=\"p73\">**</bpt>get<ept id=\"p73\">**</ept>, <bpt id=\"p74\">**</bpt>post<ept id=\"p74\">**</ept>, <bpt id=\"p75\">**</bpt>put<ept id=\"p75\">**</ept>, <bpt id=\"p76\">**</bpt>patch<ept id=\"p76\">**</ept>, <bpt id=\"p77\">**</bpt>delete<ept id=\"p77\">**</ept>).",
          "pos": [
            0,
            459
          ]
        },
        {
          "content": "These functions register a route to a defined function for a specific HTTP method.",
          "pos": [
            460,
            542
          ]
        },
        {
          "content": "Each function takes two parameters, the first is the route name and the second is the function registered to the route.",
          "pos": [
            543,
            662
          ]
        }
      ]
    },
    {
      "pos": [
        25821,
        25941
      ],
      "content": "The two routes in the above custom API example can be invoked by HTTP GET requests as follows (shown with the response):"
    },
    {
      "pos": [
        26122,
        26124
      ],
      "content": "##"
    },
    {
      "pos": [
        26156,
        26169
      ],
      "content": "Job Scheduler"
    },
    {
      "pos": [
        26171,
        26472
      ],
      "content": "Mobile Services enables you to define server scripts that are executed either as jobs on a fixed schedule or on-demand from the Azure classic portal. Scheduled jobs are useful for performing periodic tasks such as cleaning-up table data and batch processing. For more information, see [Schedule jobs].",
      "nodes": [
        {
          "content": "Mobile Services enables you to define server scripts that are executed either as jobs on a fixed schedule or on-demand from the Azure classic portal.",
          "pos": [
            0,
            149
          ]
        },
        {
          "content": "Scheduled jobs are useful for performing periodic tasks such as cleaning-up table data and batch processing.",
          "pos": [
            150,
            258
          ]
        },
        {
          "content": "For more information, see [Schedule jobs].",
          "pos": [
            259,
            301
          ]
        }
      ]
    },
    {
      "pos": [
        26474,
        26912
      ],
      "content": "Scripts that are registered to scheduled jobs have a main function with the same name as the scheduled job. Because a scheduled script is not invoked by an HTTP request, there is no context that can be passed by the server runtime and the function takes no parameters. Like other kinds of scripts, you can have subroutine functions and require shared modules. For more information, see [Source control, shared code, and helper functions].",
      "nodes": [
        {
          "content": "Scripts that are registered to scheduled jobs have a main function with the same name as the scheduled job.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "Because a scheduled script is not invoked by an HTTP request, there is no context that can be passed by the server runtime and the function takes no parameters.",
          "pos": [
            108,
            268
          ]
        },
        {
          "content": "Like other kinds of scripts, you can have subroutine functions and require shared modules.",
          "pos": [
            269,
            359
          ]
        },
        {
          "content": "For more information, see [Source control, shared code, and helper functions].",
          "pos": [
            360,
            438
          ]
        }
      ]
    },
    {
      "pos": [
        26914,
        26917
      ],
      "content": "###"
    },
    {
      "pos": [
        26949,
        26985
      ],
      "content": "How to: Define scheduled job scripts"
    },
    {
      "pos": [
        26987,
        27430
      ],
      "content": "A server script can be assigned to a job that's defined in the Mobile Services Scheduler. These scripts belong to the job and are executed according to the job schedule. (You can also use the [Azure classic portal] to run jobs on demand.) A script that defines a scheduled job has no parameters because Mobile Services doesn't pass it any data; it's executed as a regular JavaScript function and doesn't interact with Mobile Services directly.",
      "nodes": [
        {
          "content": "A server script can be assigned to a job that's defined in the Mobile Services Scheduler.",
          "pos": [
            0,
            89
          ]
        },
        {
          "content": "These scripts belong to the job and are executed according to the job schedule.",
          "pos": [
            90,
            169
          ]
        },
        {
          "content": "(You can also use the [Azure classic portal] to run jobs on demand.) A script that defines a scheduled job has no parameters because Mobile Services doesn't pass it any data; it's executed as a regular JavaScript function and doesn't interact with Mobile Services directly.",
          "pos": [
            170,
            443
          ]
        }
      ]
    },
    {
      "pos": [
        27433,
        27488
      ],
      "content": "You define scheduled jobs in one of the following ways:"
    },
    {
      "pos": [
        27493,
        27562
      ],
      "content": "In the [Azure classic portal] in the <bpt id=\"p78\">**</bpt>Script<ept id=\"p78\">**</ept><ph id=\"ph125\"/> tab in the scheduler:"
    },
    {
      "pos": [
        27568,
        27575
      ],
      "content": "<ph id=\"ph126\">![</ph>3<ph id=\"ph127\">][3]</ph>"
    },
    {
      "pos": [
        27581,
        27671
      ],
      "content": "For more information about how to do this, see [Schedule backend jobs in Mobile Services]."
    },
    {
      "pos": [
        27676,
        27794
      ],
      "content": "From the command prompt by using the Azure command line tool. For more information, see [Using the command line tool].",
      "nodes": [
        {
          "content": "From the command prompt by using the Azure command line tool.",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "For more information, see [Using the command line tool].",
          "pos": [
            62,
            118
          ]
        }
      ]
    },
    {
      "pos": [
        27797,
        28028
      ],
      "content": "<ph id=\"ph128\">[AZURE.NOTE]</ph>When you have source control enabled, you can edit scheduled job script files directly in the .\\service\\scheduler subfolder in your git repository. For more information, see [How to: Share code by using source control].",
      "nodes": [
        {
          "content": "<ph id=\"ph128\">[AZURE.NOTE]</ph>When you have source control enabled, you can edit scheduled job script files directly in the .\\service\\scheduler subfolder in your git repository.",
          "pos": [
            0,
            179
          ]
        },
        {
          "content": "For more information, see [How to: Share code by using source control].",
          "pos": [
            180,
            251
          ]
        }
      ]
    },
    {
      "pos": [
        28030,
        28032
      ],
      "content": "##"
    },
    {
      "pos": [
        28058,
        28107
      ],
      "content": "Source control, shared code, and helper functions"
    },
    {
      "pos": [
        28109,
        28282
      ],
      "content": "This sections shows you how to leverage source control to add your own custom node.js modules, shared code and other code reuse strategies, including the following sections:"
    },
    {
      "pos": [
        28286,
        28348
      ],
      "content": "<bpt id=\"p79\">[</bpt>Overview of leveraging shared code<ept id=\"p79\">](#leverage-source-control)</ept>"
    },
    {
      "pos": [
        28351,
        28381
      ],
      "content": "[How to: Load Node.js modules]"
    },
    {
      "pos": [
        28384,
        28414
      ],
      "content": "[How to: Use helper functions]"
    },
    {
      "pos": [
        28417,
        28461
      ],
      "content": "[How to: Share code by using source control]"
    },
    {
      "pos": [
        28464,
        28496
      ],
      "content": "[How to: Work with app settings]"
    },
    {
      "pos": [
        28499,
        28502
      ],
      "content": "###"
    },
    {
      "pos": [
        28540,
        28574
      ],
      "content": "Overview of leveraging shared code"
    },
    {
      "pos": [
        28576,
        28798
      ],
      "content": "Because Mobile Services uses Node.js on the server, your scripts already have access to the built-in Node.js modules. You can also use source control to define your own modules or add other Node.js modules to your service.",
      "nodes": [
        {
          "content": "Because Mobile Services uses Node.js on the server, your scripts already have access to the built-in Node.js modules.",
          "pos": [
            0,
            117
          ]
        },
        {
          "content": "You can also use source control to define your own modules or add other Node.js modules to your service.",
          "pos": [
            118,
            222
          ]
        }
      ]
    },
    {
      "pos": [
        28800,
        28934
      ],
      "content": "The following are just some of the more useful modules that can be leveraged in your scripts by using the global <bpt id=\"p80\">**</bpt>require<ept id=\"p80\">**</ept><ph id=\"ph129\"/> function:"
    },
    {
      "pos": [
        28938,
        29059
      ],
      "content": "<bpt id=\"p81\">**</bpt>azure<ept id=\"p81\">**</ept>: Exposes the functionality of the Azure SDK for Node.js. For more information, see the [Azure SDK for Node.js].",
      "nodes": [
        {
          "content": "<bpt id=\"p81\">**</bpt>azure<ept id=\"p81\">**</ept>: Exposes the functionality of the Azure SDK for Node.js.",
          "pos": [
            0,
            106
          ]
        },
        {
          "content": "For more information, see the [Azure SDK for Node.js].",
          "pos": [
            107,
            161
          ]
        }
      ]
    },
    {
      "pos": [
        29063,
        29183
      ],
      "content": "<bpt id=\"p82\">**</bpt>crypto<ept id=\"p82\">**</ept>: Provides crypto functionality of OpenSSL. For more information, see the [Node.js documentation][crypto API].",
      "nodes": [
        {
          "content": "<bpt id=\"p82\">**</bpt>crypto<ept id=\"p82\">**</ept>: Provides crypto functionality of OpenSSL.",
          "pos": [
            0,
            93
          ]
        },
        {
          "content": "For more information, see the [Node.js documentation][crypto API].",
          "pos": [
            94,
            160
          ]
        }
      ]
    },
    {
      "pos": [
        29186,
        29308
      ],
      "content": "<bpt id=\"p83\">**</bpt>path<ept id=\"p83\">**</ept>: Contains utilities for working with file paths. For more information, see the [Node.js documentation][path API].",
      "nodes": [
        {
          "content": "<bpt id=\"p83\">**</bpt>path<ept id=\"p83\">**</ept>: Contains utilities for working with file paths.",
          "pos": [
            0,
            97
          ]
        },
        {
          "content": "For more information, see the [Node.js documentation][path API].",
          "pos": [
            98,
            162
          ]
        }
      ]
    },
    {
      "pos": [
        29311,
        29450
      ],
      "content": "<bpt id=\"p84\">**</bpt>querystring<ept id=\"p84\">**</ept>: Contains utilities for working with query strings. For more information, see the [Node.js documentation][querystring API].",
      "nodes": [
        {
          "content": "<bpt id=\"p84\">**</bpt>querystring<ept id=\"p84\">**</ept>: Contains utilities for working with query strings.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "For more information, see the [Node.js documentation][querystring API].",
          "pos": [
            108,
            179
          ]
        }
      ]
    },
    {
      "pos": [
        29453,
        29589
      ],
      "content": "<bpt id=\"p85\">**</bpt>request<ept id=\"p85\">**</ept>: Sends HTTP requests to external REST services, such as Twitter and Facebook. For more information, see [Send HTTP request].",
      "nodes": [
        {
          "content": "<bpt id=\"p85\">**</bpt>request<ept id=\"p85\">**</ept>: Sends HTTP requests to external REST services, such as Twitter and Facebook.",
          "pos": [
            0,
            129
          ]
        },
        {
          "content": "For more information, see [Send HTTP request].",
          "pos": [
            130,
            176
          ]
        }
      ]
    },
    {
      "pos": [
        29592,
        29738
      ],
      "content": "<bpt id=\"p86\">**</bpt>sendgrid<ept id=\"p86\">**</ept>: Sends email by using the Sendgrid email service in Azure. For more information, see [Send email from Mobile Services with SendGrid].",
      "nodes": [
        {
          "content": "<bpt id=\"p86\">**</bpt>sendgrid<ept id=\"p86\">**</ept>: Sends email by using the Sendgrid email service in Azure.",
          "pos": [
            0,
            111
          ]
        },
        {
          "content": "For more information, see [Send email from Mobile Services with SendGrid].",
          "pos": [
            112,
            186
          ]
        }
      ]
    },
    {
      "pos": [
        29741,
        29859
      ],
      "content": "<bpt id=\"p87\">**</bpt>url<ept id=\"p87\">**</ept>: Contains utilities to parse and resolve URLs. For more information, see the [Node.js documentation][url API].",
      "nodes": [
        {
          "content": "<bpt id=\"p87\">**</bpt>url<ept id=\"p87\">**</ept>: Contains utilities to parse and resolve URLs.",
          "pos": [
            0,
            94
          ]
        },
        {
          "content": "For more information, see the [Node.js documentation][url API].",
          "pos": [
            95,
            158
          ]
        }
      ]
    },
    {
      "pos": [
        29862,
        30016
      ],
      "content": "<bpt id=\"p88\">**</bpt>util<ept id=\"p88\">**</ept>: Contains various utilities, such as string formatting and object type checking. For more information, see the [Node.js documentation][util API].",
      "nodes": [
        {
          "content": "<bpt id=\"p88\">**</bpt>util<ept id=\"p88\">**</ept>: Contains various utilities, such as string formatting and object type checking.",
          "pos": [
            0,
            129
          ]
        },
        {
          "content": "For more information, see the [Node.js documentation][util API].",
          "pos": [
            130,
            194
          ]
        }
      ]
    },
    {
      "pos": [
        30020,
        30155
      ],
      "content": "<bpt id=\"p89\">**</bpt>zlib<ept id=\"p89\">**</ept>: Exposes compression functionality, such as gzip and deflate. For more information, see the [Node.js documentation][zlib API].",
      "nodes": [
        {
          "content": "<bpt id=\"p89\">**</bpt>zlib<ept id=\"p89\">**</ept>: Exposes compression functionality, such as gzip and deflate.",
          "pos": [
            0,
            110
          ]
        },
        {
          "content": "For more information, see the [Node.js documentation][zlib API].",
          "pos": [
            111,
            175
          ]
        }
      ]
    },
    {
      "pos": [
        30158,
        30161
      ],
      "content": "###"
    },
    {
      "pos": [
        30200,
        30224
      ],
      "content": "How to: Leverage modules"
    },
    {
      "pos": [
        30226,
        30399
      ],
      "content": "Mobile Services exposes a set of modules that scripts can load by using the global <bpt id=\"p90\">**</bpt>require<ept id=\"p90\">**</ept><ph id=\"ph130\"/> function. For example, a script can require <bpt id=\"p91\">**</bpt>request<ept id=\"p91\">**</ept><ph id=\"ph131\"/> to make HTTP requests:",
      "nodes": [
        {
          "content": "Mobile Services exposes a set of modules that scripts can load by using the global <bpt id=\"p90\">**</bpt>require<ept id=\"p90\">**</ept><ph id=\"ph130\"/> function.",
          "pos": [
            0,
            160
          ]
        },
        {
          "content": "For example, a script can require <bpt id=\"p91\">**</bpt>request<ept id=\"p91\">**</ept><ph id=\"ph131\"/> to make HTTP requests:",
          "pos": [
            161,
            285
          ]
        }
      ]
    },
    {
      "pos": [
        30610,
        30613
      ],
      "content": "###"
    },
    {
      "pos": [
        30654,
        30696
      ],
      "content": "How to: Share code by using source control"
    },
    {
      "pos": [
        30698,
        30857
      ],
      "content": "You can use source control with the Node.js package manager (npm) to control which modules are available to your mobile service. There are two ways to do this:",
      "nodes": [
        {
          "content": "You can use source control with the Node.js package manager (npm) to control which modules are available to your mobile service.",
          "pos": [
            0,
            128
          ]
        },
        {
          "content": "There are two ways to do this:",
          "pos": [
            129,
            159
          ]
        }
      ]
    },
    {
      "pos": [
        30861,
        31246
      ],
      "content": "For modules that are published to and installed by npm, use the package.json file to declare which packages you want to be installed by your mobile service. In this way, your service always has access to the latest version of the required packages. The package.json file lives in the <ph id=\"ph132\">`.\\service`</ph><ph id=\"ph133\"/> directory. For more information, see [Support for package.json in Azure Mobile Services].",
      "nodes": [
        {
          "content": "For modules that are published to and installed by npm, use the package.json file to declare which packages you want to be installed by your mobile service.",
          "pos": [
            0,
            156
          ]
        },
        {
          "content": "In this way, your service always has access to the latest version of the required packages.",
          "pos": [
            157,
            248
          ]
        },
        {
          "content": "The package.json file lives in the <ph id=\"ph132\">`.\\service`</ph><ph id=\"ph133\"/> directory.",
          "pos": [
            249,
            342
          ]
        },
        {
          "content": "For more information, see [Support for package.json in Azure Mobile Services].",
          "pos": [
            343,
            421
          ]
        }
      ]
    },
    {
      "pos": [
        31250,
        31517
      ],
      "content": "For private or custom modules, you can use npm to manually install the module into the <ph id=\"ph134\">`.\\service\\node_modules`</ph><ph id=\"ph135\"/> directory of your source control. For an example of how to manually upload a module, see [Leverage shared code and Node.js modules in your server scripts].",
      "nodes": [
        {
          "content": "For private or custom modules, you can use npm to manually install the module into the <ph id=\"ph134\">`.\\service\\node_modules`</ph><ph id=\"ph135\"/> directory of your source control.",
          "pos": [
            0,
            181
          ]
        },
        {
          "content": "For an example of how to manually upload a module, see [Leverage shared code and Node.js modules in your server scripts].",
          "pos": [
            182,
            303
          ]
        }
      ]
    },
    {
      "pos": [
        31524,
        31775
      ],
      "content": "<ph id=\"ph136\">[AZURE.NOTE]</ph>When <ph id=\"ph137\">`node_modules`</ph><ph id=\"ph138\"/> already exists in the directory hierarchy, NPM will create the <ph id=\"ph139\">`\\node-uuid`</ph><ph id=\"ph140\"/> subdirectory there instead of creating a new <ph id=\"ph141\">`node_modules`</ph><ph id=\"ph142\"/> in the repository. In this case, just delete the existing <ph id=\"ph143\">`node_modules`</ph><ph id=\"ph144\"/> directory.",
      "nodes": [
        {
          "content": "<ph id=\"ph136\">[AZURE.NOTE]</ph>When <ph id=\"ph137\">`node_modules`</ph><ph id=\"ph138\"/> already exists in the directory hierarchy, NPM will create the <ph id=\"ph139\">`\\node-uuid`</ph><ph id=\"ph140\"/> subdirectory there instead of creating a new <ph id=\"ph141\">`node_modules`</ph><ph id=\"ph142\"/> in the repository.",
          "pos": [
            0,
            314
          ]
        },
        {
          "content": "In this case, just delete the existing <ph id=\"ph143\">`node_modules`</ph><ph id=\"ph144\"/> directory.",
          "pos": [
            315,
            415
          ]
        }
      ]
    },
    {
      "pos": [
        31777,
        31926
      ],
      "content": "After you commit the package.json file or custom modules to the repository for your mobile service, use <bpt id=\"p92\">**</bpt>require<ept id=\"p92\">**</ept><ph id=\"ph145\"/> to reference the modules by name."
    },
    {
      "pos": [
        31932,
        32119
      ],
      "content": "<ph id=\"ph146\">[AZURE.NOTE]</ph><ph id=\"ph147\"/> Modules that you specify in package.json or upload to your mobile service are only used in your server script code. These modules are not used by the Mobile Services runtime.",
      "nodes": [
        {
          "content": "<ph id=\"ph146\">[AZURE.NOTE]</ph><ph id=\"ph147\"/> Modules that you specify in package.json or upload to your mobile service are only used in your server script code.",
          "pos": [
            0,
            164
          ]
        },
        {
          "content": "These modules are not used by the Mobile Services runtime.",
          "pos": [
            165,
            223
          ]
        }
      ]
    },
    {
      "pos": [
        32121,
        32124
      ],
      "content": "###"
    },
    {
      "pos": [
        32155,
        32183
      ],
      "content": "How to: Use helper functions"
    },
    {
      "pos": [
        32185,
        32384
      ],
      "content": "In addition to requiring modules, individual server scripts can include helper functions. These are functions that are separate from the main function, which can be used to factor code in the script.",
      "nodes": [
        {
          "content": "In addition to requiring modules, individual server scripts can include helper functions.",
          "pos": [
            0,
            89
          ]
        },
        {
          "content": "These are functions that are separate from the main function, which can be used to factor code in the script.",
          "pos": [
            90,
            199
          ]
        }
      ]
    },
    {
      "pos": [
        32387,
        32527
      ],
      "content": "In the following example, a table script is registered to the insert operation, which includes the helper function <bpt id=\"p93\">**</bpt>handleUnapprovedItem<ept id=\"p93\">**</ept>:"
    },
    {
      "pos": [
        32866,
        33021
      ],
      "content": "In a script, helper functions must be declared after the main function. You must declare all variables in your script. Undeclared variables cause an error.",
      "nodes": [
        {
          "content": "In a script, helper functions must be declared after the main function.",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "You must declare all variables in your script.",
          "pos": [
            72,
            118
          ]
        },
        {
          "content": "Undeclared variables cause an error.",
          "pos": [
            119,
            155
          ]
        }
      ]
    },
    {
      "pos": [
        33023,
        33338
      ],
      "content": "Helper functions can also be defined once and shared between server scripts. To share a function between scripts, functions must be exported and the script file must exist in the <ph id=\"ph148\">`.\\service\\shared\\`</ph><ph id=\"ph149\"/> directory. The following is a template for how to export a shared function in a file <ph id=\"ph150\">`.\\services\\shared\\helpers.js`</ph>:",
      "nodes": [
        {
          "content": "Helper functions can also be defined once and shared between server scripts.",
          "pos": [
            0,
            76
          ]
        },
        {
          "content": "To share a function between scripts, functions must be exported and the script file must exist in the <ph id=\"ph148\">`.\\service\\shared\\`</ph><ph id=\"ph149\"/> directory.",
          "pos": [
            77,
            245
          ]
        },
        {
          "content": "The following is a template for how to export a shared function in a file <ph id=\"ph150\">`.\\services\\shared\\helpers.js`</ph>:",
          "pos": [
            246,
            371
          ]
        }
      ]
    },
    {
      "pos": [
        33571,
        33637
      ],
      "content": "You can then use a function like this in a table operation script:"
    },
    {
      "pos": [
        33973,
        34206
      ],
      "content": "In this example, you must pass both a [tables object] and a [user object] to the shared function. This is because shared scripts cannot access the global [tables object], and the [user object] only exists in the context of a request.",
      "nodes": [
        {
          "content": "In this example, you must pass both a [tables object] and a [user object] to the shared function.",
          "pos": [
            0,
            97
          ]
        },
        {
          "content": "This is because shared scripts cannot access the global [tables object], and the [user object] only exists in the context of a request.",
          "pos": [
            98,
            233
          ]
        }
      ]
    },
    {
      "pos": [
        34208,
        34400
      ],
      "content": "Script files are uploaded to the shared directory either by using [source control][How to: Share code by using source control] or by using the [command line tool][Using the command line tool]."
    },
    {
      "pos": [
        34402,
        34405
      ],
      "content": "###"
    },
    {
      "pos": [
        34432,
        34462
      ],
      "content": "How to: Work with app settings"
    },
    {
      "pos": [
        34464,
        34829
      ],
      "content": "Mobile Services enables you to securely store values as app settings, which can be accessed by your server scripts at runtime.  When you add data to the app settings of your mobile service, the name/value pairs are stored encrypted and you can access them in your server scripts without hard-coding them in the script file. For more information, see [App settings].",
      "nodes": [
        {
          "content": "Mobile Services enables you to securely store values as app settings, which can be accessed by your server scripts at runtime.",
          "pos": [
            0,
            126
          ]
        },
        {
          "content": "When you add data to the app settings of your mobile service, the name/value pairs are stored encrypted and you can access them in your server scripts without hard-coding them in the script file.",
          "pos": [
            128,
            323
          ]
        },
        {
          "content": "For more information, see [App settings].",
          "pos": [
            324,
            365
          ]
        }
      ]
    },
    {
      "pos": [
        34831,
        34932
      ],
      "content": "The following custom API example uses the supplied [service object] to retrieve an app setting value."
    },
    {
      "pos": [
        35249,
        35403
      ],
      "content": "The following code uses the configuration module to retrieve Twitter access token values, stored in app settings, that are used in a scheduled job script:"
    },
    {
      "pos": [
        35890,
        36227
      ],
      "content": "Note that this code also retrieves Twitter consumer key values stored in the <bpt id=\"p94\">**</bpt>Identity<ept id=\"p94\">**</ept><ph id=\"ph151\"/> tab in the portal. Because a <bpt id=\"p95\">**</bpt>config object<ept id=\"p95\">**</ept><ph id=\"ph152\"/> is not available in table operation and scheduled job scripts, you must require the configuration module to access app settings. For a complete example, see [Schedule backend jobs in Mobile Services].",
      "nodes": [
        {
          "content": "Note that this code also retrieves Twitter consumer key values stored in the <bpt id=\"p94\">**</bpt>Identity<ept id=\"p94\">**</ept><ph id=\"ph151\"/> tab in the portal.",
          "pos": [
            0,
            164
          ]
        },
        {
          "content": "Because a <bpt id=\"p95\">**</bpt>config object<ept id=\"p95\">**</ept><ph id=\"ph152\"/> is not available in table operation and scheduled job scripts, you must require the configuration module to access app settings.",
          "pos": [
            165,
            377
          ]
        },
        {
          "content": "For a complete example, see [Schedule backend jobs in Mobile Services].",
          "pos": [
            378,
            449
          ]
        }
      ]
    },
    {
      "pos": [
        36262,
        36289
      ],
      "content": "Using the command line tool"
    },
    {
      "pos": [
        36296,
        36498
      ],
      "content": "In Mobile Services, you can create, modify, and delete server scripts by using the Azure command line tool. Before uploading your scripts, make sure that you are using the following directory structure:",
      "nodes": [
        {
          "content": "In Mobile Services, you can create, modify, and delete server scripts by using the Azure command line tool.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "Before uploading your scripts, make sure that you are using the following directory structure:",
          "pos": [
            108,
            202
          ]
        }
      ]
    },
    {
      "pos": [
        36500,
        36507
      ],
      "content": "<ph id=\"ph153\">![</ph>4<ph id=\"ph154\">][4]</ph>"
    },
    {
      "pos": [
        36509,
        36604
      ],
      "content": "Note that this directory structure is the same as the git repository when using source control."
    },
    {
      "pos": [
        36607,
        36815
      ],
      "content": "When uploading script files from the command line tool, you must first navigate to the <ph id=\"ph155\">`.\\services\\`</ph><ph id=\"ph156\"/> directory. The following command uploads a script named <ph id=\"ph157\">`todoitem.insert.js`</ph><ph id=\"ph158\"/> from the <ph id=\"ph159\">`table`</ph><ph id=\"ph160\"/> subdirectory:",
      "nodes": [
        {
          "content": "When uploading script files from the command line tool, you must first navigate to the <ph id=\"ph155\">`.\\services\\`</ph><ph id=\"ph156\"/> directory.",
          "pos": [
            0,
            147
          ]
        },
        {
          "content": "The following command uploads a script named <ph id=\"ph157\">`todoitem.insert.js`</ph><ph id=\"ph158\"/> from the <ph id=\"ph159\">`table`</ph><ph id=\"ph160\"/> subdirectory:",
          "pos": [
            148,
            316
          ]
        }
      ]
    },
    {
      "pos": [
        36994,
        37094
      ],
      "content": "The following command returns information about every script file maintained in your mobile service:"
    },
    {
      "pos": [
        38511,
        38580
      ],
      "content": "For more information, see [Commands to manage Azure Mobile Services]."
    },
    {
      "pos": [
        38583,
        38585
      ],
      "content": "##"
    },
    {
      "pos": [
        38619,
        38638
      ],
      "content": "Working with tables"
    },
    {
      "pos": [
        38640,
        38756
      ],
      "content": "This section details strategies for working directly with SQL Database table data, including the following sections:"
    },
    {
      "pos": [
        38760,
        38811
      ],
      "content": "<bpt id=\"p96\">[</bpt>Overview of working with tables<ept id=\"p96\">](#overview-tables)</ept>"
    },
    {
      "pos": [
        38814,
        38850
      ],
      "content": "[How to: Access tables from scripts]"
    },
    {
      "pos": [
        38853,
        38883
      ],
      "content": "[How to: Perform Bulk Inserts]"
    },
    {
      "pos": [
        38886,
        38928
      ],
      "content": "[How to: Map JSON types to database types]"
    },
    {
      "pos": [
        38931,
        38968
      ],
      "content": "[Using Transact-SQL to access tables]"
    },
    {
      "pos": [
        38970,
        38973
      ],
      "content": "###"
    },
    {
      "pos": [
        39003,
        39034
      ],
      "content": "Overview of working with tables"
    },
    {
      "pos": [
        39036,
        39495
      ],
      "content": "Many scenarios in Mobile Services require server scripts to access tables in the database. For example. because Mobile Services does not preserve state between script executions, any data that needs to be persisted between script executions must be stored in tables. You might also want to examine entries in a permissions table or store audit data instead of just writing to the log, where data has a limited duration and cannot be accessed programmatically.",
      "nodes": [
        {
          "content": "Many scenarios in Mobile Services require server scripts to access tables in the database.",
          "pos": [
            0,
            90
          ]
        },
        {
          "content": "For example.",
          "pos": [
            91,
            103
          ]
        },
        {
          "content": "because Mobile Services does not preserve state between script executions, any data that needs to be persisted between script executions must be stored in tables.",
          "pos": [
            104,
            266
          ]
        },
        {
          "content": "You might also want to examine entries in a permissions table or store audit data instead of just writing to the log, where data has a limited duration and cannot be accessed programmatically.",
          "pos": [
            267,
            459
          ]
        }
      ]
    },
    {
      "pos": [
        39498,
        39828
      ],
      "content": "Mobile Services has two ways of accessing tables, either by using a [table object] proxy or by composing Transact-SQL queries using the [mssql object]. The [table object] makes it easy to access table data from your sever script code, but the [mssql object] supports more complex data operations and provides the most flexibility.",
      "nodes": [
        {
          "content": "Mobile Services has two ways of accessing tables, either by using a [table object] proxy or by composing Transact-SQL queries using the [mssql object].",
          "pos": [
            0,
            151
          ]
        },
        {
          "content": "The [table object] makes it easy to access table data from your sever script code, but the [mssql object] supports more complex data operations and provides the most flexibility.",
          "pos": [
            152,
            330
          ]
        }
      ]
    },
    {
      "pos": [
        39831,
        39834
      ],
      "content": "###"
    },
    {
      "pos": [
        39862,
        39896
      ],
      "content": "How to: Access tables from scripts"
    },
    {
      "pos": [
        39898,
        40158
      ],
      "content": "The easiest way to access tables from your script is by using the [tables object]. The <bpt id=\"p97\">**</bpt>getTable<ept id=\"p97\">**</ept><ph id=\"ph161\"/> function returns a [table object] instance that's a proxy for accessing the requested table. You can then call functions on the proxy to access and change data.",
      "nodes": [
        {
          "content": "The easiest way to access tables from your script is by using the [tables object].",
          "pos": [
            0,
            82
          ]
        },
        {
          "content": "The <bpt id=\"p97\">**</bpt>getTable<ept id=\"p97\">**</ept><ph id=\"ph161\"/> function returns a [table object] instance that's a proxy for accessing the requested table.",
          "pos": [
            83,
            248
          ]
        },
        {
          "content": "You can then call functions on the proxy to access and change data.",
          "pos": [
            249,
            316
          ]
        }
      ]
    },
    {
      "pos": [
        40161,
        40364
      ],
      "content": "Scripts registered to both table operations and scheduled jobs can access the [tables object] as a global object. This line of code gets a proxy for the <bpt id=\"p98\">*</bpt>TodoItems<ept id=\"p98\">*</ept><ph id=\"ph162\"/> table from the global [tables object]:",
      "nodes": [
        {
          "content": "Scripts registered to both table operations and scheduled jobs can access the [tables object] as a global object.",
          "pos": [
            0,
            113
          ]
        },
        {
          "content": "This line of code gets a proxy for the <bpt id=\"p98\">*</bpt>TodoItems<ept id=\"p98\">*</ept><ph id=\"ph162\"/> table from the global [tables object]:",
          "pos": [
            114,
            259
          ]
        }
      ]
    },
    {
      "pos": [
        40427,
        40485
      ],
      "content": "Custom API scripts can access the [tables object] from the"
    },
    {
      "pos": [
        40494,
        40501
      ],
      "content": "service"
    },
    {
      "pos": [
        40511,
        40610
      ],
      "content": "property of the supplied [request object]. This line of code gets [tables object] from the request:",
      "nodes": [
        {
          "content": "property of the supplied [request object].",
          "pos": [
            0,
            42
          ]
        },
        {
          "content": "This line of code gets [tables object] from the request:",
          "pos": [
            43,
            99
          ]
        }
      ]
    },
    {
      "pos": [
        40689,
        40835
      ],
      "content": "<ph id=\"ph163\">[AZURE.NOTE]</ph><ph id=\"ph164\"/> Shared functions cannot access the <bpt id=\"p99\">**</bpt>tables<ept id=\"p99\">**</ept><ph id=\"ph165\"/> object directly. In a shared function, you must pass the tables object to the function.",
      "nodes": [
        {
          "content": "<ph id=\"ph163\">[AZURE.NOTE]</ph><ph id=\"ph164\"/> Shared functions cannot access the <bpt id=\"p99\">**</bpt>tables<ept id=\"p99\">**</ept><ph id=\"ph165\"/> object directly.",
          "pos": [
            0,
            167
          ]
        },
        {
          "content": "In a shared function, you must pass the tables object to the function.",
          "pos": [
            168,
            238
          ]
        }
      ]
    },
    {
      "pos": [
        40837,
        41014
      ],
      "content": "Once you have a [table object], you can call one or more table operation functions: insert, update, delete or read. This example reads user permissions from a permissions table:",
      "nodes": [
        {
          "content": "Once you have a [table object], you can call one or more table operation functions: insert, update, delete or read.",
          "pos": [
            0,
            115
          ]
        },
        {
          "content": "This example reads user permissions from a permissions table:",
          "pos": [
            116,
            177
          ]
        }
      ]
    },
    {
      "pos": [
        41737,
        41804
      ],
      "content": "The next example writes auditing information to an <bpt id=\"p100\">**</bpt>audit<ept id=\"p100\">**</ept><ph id=\"ph166\"/> table:"
    },
    {
      "pos": [
        42457,
        42567
      ],
      "content": "A final example is in the code sample here: [How to: Access custom parameters][How to: Add custom parameters]."
    },
    {
      "pos": [
        42569,
        42572
      ],
      "content": "###"
    },
    {
      "pos": [
        42599,
        42627
      ],
      "content": "How to: Perform Bulk Inserts"
    },
    {
      "pos": [
        42629,
        43053
      ],
      "content": "If you use a <bpt id=\"p101\">**</bpt>for<ept id=\"p101\">**</ept><ph id=\"ph167\"/> or <bpt id=\"p102\">**</bpt>while<ept id=\"p102\">**</ept><ph id=\"ph168\"/> loop to directly insert a large number of items (1000, for example) into a  table , you may encounter a SQL connection limit that causes some of the inserts to fail. Your request may never complete or it may return a HTTP 500 Internal Server Error.  To avoid this problem, you can insert the items in batches of 10 or so. After the first batch is inserted, submit the next batch, and so on.",
      "nodes": [
        {
          "content": "If you use a <bpt id=\"p101\">**</bpt>for<ept id=\"p101\">**</ept><ph id=\"ph167\"/> or <bpt id=\"p102\">**</bpt>while<ept id=\"p102\">**</ept><ph id=\"ph168\"/> loop to directly insert a large number of items (1000, for example) into a  table , you may encounter a SQL connection limit that causes some of the inserts to fail.",
          "pos": [
            0,
            315
          ]
        },
        {
          "content": "Your request may never complete or it may return a HTTP 500 Internal Server Error.",
          "pos": [
            316,
            398
          ]
        },
        {
          "content": "To avoid this problem, you can insert the items in batches of 10 or so.",
          "pos": [
            400,
            471
          ]
        },
        {
          "content": "After the first batch is inserted, submit the next batch, and so on.",
          "pos": [
            472,
            540
          ]
        }
      ]
    },
    {
      "pos": [
        43055,
        43582
      ],
      "content": "By using the following script, you can set the size of a batch of records to insert in parallel. We recomend that you keep the number of records small. The function <bpt id=\"p103\">**</bpt>insertItems<ept id=\"p103\">**</ept><ph id=\"ph169\"/> calls itself recursively when an async insert batch has completed. The for loop at the end inserts one record at a time, and calls <bpt id=\"p104\">**</bpt>insertComplete<ept id=\"p104\">**</ept><ph id=\"ph170\"/> on success and <bpt id=\"p105\">**</bpt>errorHandler<ept id=\"p105\">**</ept><ph id=\"ph171\"/> on error. <bpt id=\"p106\">**</bpt>insertComplete<ept id=\"p106\">**</ept><ph id=\"ph172\"/>  controls whether <bpt id=\"p107\">**</bpt>insertItems<ept id=\"p107\">**</ept><ph id=\"ph173\"/> will be called recursively for the next batch, or whether the job is done and the script should exit.",
      "nodes": [
        {
          "content": "By using the following script, you can set the size of a batch of records to insert in parallel.",
          "pos": [
            0,
            96
          ]
        },
        {
          "content": "We recomend that you keep the number of records small.",
          "pos": [
            97,
            151
          ]
        },
        {
          "content": "The function <bpt id=\"p103\">**</bpt>insertItems<ept id=\"p103\">**</ept><ph id=\"ph169\"/> calls itself recursively when an async insert batch has completed.",
          "pos": [
            152,
            305
          ]
        },
        {
          "content": "The for loop at the end inserts one record at a time, and calls <bpt id=\"p104\">**</bpt>insertComplete<ept id=\"p104\">**</ept><ph id=\"ph170\"/> on success and <bpt id=\"p105\">**</bpt>errorHandler<ept id=\"p105\">**</ept><ph id=\"ph171\"/> on error.",
          "pos": [
            306,
            546
          ]
        },
        {
          "content": "<bpt id=\"p106\">**</bpt>insertComplete<ept id=\"p106\">**</ept><ph id=\"ph172\"/>  controls whether <bpt id=\"p107\">**</bpt>insertItems<ept id=\"p107\">**</ept><ph id=\"ph173\"/> will be called recursively for the next batch, or whether the job is done and the script should exit.",
          "pos": [
            547,
            817
          ]
        }
      ]
    },
    {
      "pos": [
        45168,
        45476
      ],
      "content": "The entire code sample, and accompanying discussion, can be found in this <bpt id=\"p108\">[</bpt>blog posting<ept id=\"p108\">](http://blogs.msdn.com/b/jpsanders/archive/2013/03/20/server-script-to-insert-table-items-in-windows-azure-mobile-services.aspx)</ept>. If you use this code, you can adapt it to your specific situation, and thoroughly test it.",
      "nodes": [
        {
          "content": "The entire code sample, and accompanying discussion, can be found in this <bpt id=\"p108\">[</bpt>blog posting<ept id=\"p108\">](http://blogs.msdn.com/b/jpsanders/archive/2013/03/20/server-script-to-insert-table-items-in-windows-azure-mobile-services.aspx)</ept>.",
          "pos": [
            0,
            259
          ]
        },
        {
          "content": "If you use this code, you can adapt it to your specific situation, and thoroughly test it.",
          "pos": [
            260,
            350
          ]
        }
      ]
    },
    {
      "pos": [
        45478,
        45481
      ],
      "content": "###"
    },
    {
      "pos": [
        45506,
        45546
      ],
      "content": "How to: Map JSON types to database types"
    },
    {
      "pos": [
        45548,
        45790
      ],
      "content": "The collections of data types on the client and in a Mobile Services database table are different. Sometimes they map easily to one another, and other times they don't. Mobile Services performs a number of type transformations in the mapping:",
      "nodes": [
        {
          "content": "The collections of data types on the client and in a Mobile Services database table are different.",
          "pos": [
            0,
            98
          ]
        },
        {
          "content": "Sometimes they map easily to one another, and other times they don't.",
          "pos": [
            99,
            168
          ]
        },
        {
          "content": "Mobile Services performs a number of type transformations in the mapping:",
          "pos": [
            169,
            242
          ]
        }
      ]
    },
    {
      "pos": [
        45794,
        45854
      ],
      "content": "The client language-specific types are serialized into JSON."
    },
    {
      "pos": [
        45857,
        45947
      ],
      "content": "The JSON representation is translated into JavaScript before it appears in server scripts."
    },
    {
      "pos": [
        45950,
        46049
      ],
      "content": "The JavaScript data types are converted to SQL database types when saved using the [tables object]."
    },
    {
      "pos": [
        46051,
        46461
      ],
      "content": "The transformation from client schema into JSON varies across platforms.  JSON.NET is used in Windows Store and Windows Phone clients. The Android client uses the gson library.  The iOS client uses the NSJSONSerialization class. The default serialization behavior of each of these libraries is used, except that date objects are converted to JSON strings that contain the date that's encoded by using ISO 8601.",
      "nodes": [
        {
          "content": "The transformation from client schema into JSON varies across platforms.",
          "pos": [
            0,
            72
          ]
        },
        {
          "content": "JSON.NET is used in Windows Store and Windows Phone clients.",
          "pos": [
            74,
            134
          ]
        },
        {
          "content": "The Android client uses the gson library.",
          "pos": [
            135,
            176
          ]
        },
        {
          "content": "The iOS client uses the NSJSONSerialization class.",
          "pos": [
            178,
            228
          ]
        },
        {
          "content": "The default serialization behavior of each of these libraries is used, except that date objects are converted to JSON strings that contain the date that's encoded by using ISO 8601.",
          "pos": [
            229,
            410
          ]
        }
      ]
    },
    {
      "pos": [
        46463,
        46874
      ],
      "content": "When you are writing server scripts that use [insert], [update], [read] or [delete] functions, you can access the JavaScript representation of your data. Mobile Services uses the Node.js's deserialization function (<bpt id=\"p109\">[</bpt>JSON.parse<ept id=\"p109\">](http://es5.github.io/#x15.12)</ept>) to transform JSON on the wire into JavaScript objects. However Mobile Services does  a transformation to extract <bpt id=\"p110\">**</bpt>Date<ept id=\"p110\">**</ept><ph id=\"ph174\"/> objects from ISO 8601 strings.",
      "nodes": [
        {
          "content": "When you are writing server scripts that use [insert], [update], [read] or [delete] functions, you can access the JavaScript representation of your data.",
          "pos": [
            0,
            153
          ]
        },
        {
          "content": "Mobile Services uses the Node.js's deserialization function (<bpt id=\"p109\">[</bpt>JSON.parse<ept id=\"p109\">](http://es5.github.io/#x15.12)</ept>) to transform JSON on the wire into JavaScript objects.",
          "pos": [
            154,
            355
          ]
        },
        {
          "content": "However Mobile Services does  a transformation to extract <bpt id=\"p110\">**</bpt>Date<ept id=\"p110\">**</ept><ph id=\"ph174\"/> objects from ISO 8601 strings.",
          "pos": [
            356,
            511
          ]
        }
      ]
    },
    {
      "pos": [
        46876,
        47106
      ],
      "content": "When you use the [tables object] or the [mssql object], or just let your table scripts execute, the deserialized JavaScript objects are inserted into your SQL database. In that process, object properties are mapped to T-SQL types:",
      "nodes": [
        {
          "content": "When you use the [tables object] or the [mssql object], or just let your table scripts execute, the deserialized JavaScript objects are inserted into your SQL database.",
          "pos": [
            0,
            168
          ]
        },
        {
          "content": "In that process, object properties are mapped to T-SQL types:",
          "pos": [
            169,
            230
          ]
        }
      ]
    },
    {
      "pos": [
        47108,
        47127
      ],
      "content": "JavaScript property"
    },
    {
      "pos": [
        47128,
        47138
      ],
      "content": "T-SQL type"
    },
    {
      "pos": [
        47147,
        47153
      ],
      "content": "Number"
    },
    {
      "pos": [
        47154,
        47163
      ],
      "content": "Float(53)"
    },
    {
      "pos": [
        47164,
        47171
      ],
      "content": "Boolean"
    },
    {
      "pos": [
        47172,
        47175
      ],
      "content": "Bit"
    },
    {
      "pos": [
        47176,
        47180
      ],
      "content": "Date"
    },
    {
      "pos": [
        47181,
        47198
      ],
      "content": "DateTimeOffset(3)"
    },
    {
      "pos": [
        47200,
        47206
      ],
      "content": "String"
    },
    {
      "pos": [
        47207,
        47220
      ],
      "content": "Nvarchar(max)"
    },
    {
      "pos": [
        47221,
        47227
      ],
      "content": "Buffer"
    },
    {
      "pos": [
        47228,
        47241
      ],
      "content": "Not supported"
    },
    {
      "pos": [
        47242,
        47248
      ],
      "content": "Object"
    },
    {
      "pos": [
        47249,
        47262
      ],
      "content": "Not supported"
    },
    {
      "pos": [
        47263,
        47268
      ],
      "content": "Array"
    },
    {
      "pos": [
        47269,
        47282
      ],
      "content": "Not supported"
    },
    {
      "pos": [
        47283,
        47289
      ],
      "content": "Stream"
    },
    {
      "pos": [
        47290,
        47303
      ],
      "content": "Not supported"
    },
    {
      "pos": [
        47305,
        47308
      ],
      "content": "###"
    },
    {
      "pos": [
        47327,
        47362
      ],
      "content": "Using Transact-SQL to access tables"
    },
    {
      "pos": [
        47364,
        47795
      ],
      "content": "The easiest way to work table data from server scripts is by using a [table object] proxy. However, there are more advanced scenarios that are not supported by the [table object], such as as join queries and other complex queries and invoking stored procedures. In these cases, you must execute Transact-SQL statements directly against the relational table by using the [mssql object]. This object provides the following functions:",
      "nodes": [
        {
          "content": "The easiest way to work table data from server scripts is by using a [table object] proxy.",
          "pos": [
            0,
            90
          ]
        },
        {
          "content": "However, there are more advanced scenarios that are not supported by the [table object], such as as join queries and other complex queries and invoking stored procedures.",
          "pos": [
            91,
            261
          ]
        },
        {
          "content": "In these cases, you must execute Transact-SQL statements directly against the relational table by using the [mssql object].",
          "pos": [
            262,
            385
          ]
        },
        {
          "content": "This object provides the following functions:",
          "pos": [
            386,
            431
          ]
        }
      ]
    },
    {
      "pos": [
        47799,
        48006
      ],
      "content": "<bpt id=\"p111\">**</bpt>query<ept id=\"p111\">**</ept>: executes a query, specified by a TSQL string; the results are returned to the <bpt id=\"p112\">**</bpt>success<ept id=\"p112\">**</ept><ph id=\"ph175\"/> callback on the <bpt id=\"p113\">**</bpt>options<ept id=\"p113\">**</ept><ph id=\"ph176\"/> object. The query can include parameters if the <bpt id=\"p114\">*</bpt>params<ept id=\"p114\">*</ept><ph id=\"ph177\"/> parameter is present.",
      "nodes": [
        {
          "content": "<bpt id=\"p111\">**</bpt>query<ept id=\"p111\">**</ept>: executes a query, specified by a TSQL string; the results are returned to the <bpt id=\"p112\">**</bpt>success<ept id=\"p112\">**</ept><ph id=\"ph175\"/> callback on the <bpt id=\"p113\">**</bpt>options<ept id=\"p113\">**</ept><ph id=\"ph176\"/> object.",
          "pos": [
            0,
            294
          ]
        },
        {
          "content": "The query can include parameters if the <bpt id=\"p114\">*</bpt>params<ept id=\"p114\">*</ept><ph id=\"ph177\"/> parameter is present.",
          "pos": [
            295,
            423
          ]
        }
      ]
    },
    {
      "pos": [
        48009,
        48128
      ],
      "content": "<bpt id=\"p115\">**</bpt>queryRaw<ept id=\"p115\">**</ept>: like <bpt id=\"p116\">*</bpt>query<ept id=\"p116\">*</ept><ph id=\"ph178\"/> except that the result set returned from the query is in a \"raw\" format (see example below)."
    },
    {
      "pos": [
        48131,
        48294
      ],
      "content": "<bpt id=\"p117\">**</bpt>open<ept id=\"p117\">**</ept>: used to get a connection to your Mobile Services database, and you can then use the connection object to invoke database operations such as transactions."
    },
    {
      "pos": [
        48296,
        48381
      ],
      "content": "These methods give you increasingly more low-level control over the query processing."
    },
    {
      "pos": [
        48385,
        48413
      ],
      "content": "[How to: Run a static query]"
    },
    {
      "pos": [
        48416,
        48445
      ],
      "content": "[How to: Run a dynamic query]"
    },
    {
      "pos": [
        48448,
        48480
      ],
      "content": "[How to: Join relational tables]"
    },
    {
      "pos": [
        48483,
        48531
      ],
      "content": "[How to: Run a query that returns <bpt id=\"p118\">*</bpt>raw<ept id=\"p118\">*</ept><ph id=\"ph179\"/> results]"
    },
    {
      "pos": [
        48534,
        48579
      ],
      "content": "[How to: Get access to a database connection]"
    },
    {
      "pos": [
        48582,
        48586
      ],
      "content": "####"
    },
    {
      "pos": [
        48613,
        48639
      ],
      "content": "How to: Run a static query"
    },
    {
      "pos": [
        48641,
        48774
      ],
      "content": "The following query has no parameters and returns three records from the <ph id=\"ph180\">`statusupdate`</ph><ph id=\"ph181\"/> table. The rowset is in standard JSON format.",
      "nodes": [
        {
          "content": "The following query has no parameters and returns three records from the <ph id=\"ph180\">`statusupdate`</ph><ph id=\"ph181\"/> table.",
          "pos": [
            0,
            130
          ]
        },
        {
          "content": "The rowset is in standard JSON format.",
          "pos": [
            131,
            169
          ]
        }
      ]
    },
    {
      "pos": [
        49041,
        49045
      ],
      "content": "####"
    },
    {
      "pos": [
        49073,
        49114
      ],
      "content": "How to: Run a dynamic parameterized query"
    },
    {
      "pos": [
        49116,
        49322
      ],
      "content": "The following example implements custom authorization by reading permissions for each user from the permissions table. The placeholder (?) is replaced with the supplied parameter when the query is executed.",
      "nodes": [
        {
          "content": "The following example implements custom authorization by reading permissions for each user from the permissions table.",
          "pos": [
            0,
            118
          ]
        },
        {
          "content": "The placeholder (?) is replaced with the supplied parameter when the query is executed.",
          "pos": [
            119,
            206
          ]
        }
      ]
    },
    {
      "pos": [
        50114,
        50118
      ],
      "content": "####"
    },
    {
      "pos": [
        50138,
        50168
      ],
      "content": "How to: Join relational tables"
    },
    {
      "pos": [
        50170,
        50482
      ],
      "content": "You can join two tables by using the <bpt id=\"p119\">**</bpt>query<ept id=\"p119\">**</ept><ph id=\"ph182\"/> method of the [mssql object] to pass in the TSQL code that implements the join. Let's assume we have some items in our <bpt id=\"p120\">**</bpt>ToDoItem<ept id=\"p120\">**</ept><ph id=\"ph183\"/> table and each item in the table has a <bpt id=\"p121\">**</bpt>priority<ept id=\"p121\">**</ept><ph id=\"ph184\"/> property, which corresponds to a column in the table. An item may look like this:",
      "nodes": [
        {
          "content": "You can join two tables by using the <bpt id=\"p119\">**</bpt>query<ept id=\"p119\">**</ept><ph id=\"ph182\"/> method of the [mssql object] to pass in the TSQL code that implements the join.",
          "pos": [
            0,
            184
          ]
        },
        {
          "content": "Let's assume we have some items in our <bpt id=\"p120\">**</bpt>ToDoItem<ept id=\"p120\">**</ept><ph id=\"ph183\"/> table and each item in the table has a <bpt id=\"p121\">**</bpt>priority<ept id=\"p121\">**</ept><ph id=\"ph184\"/> property, which corresponds to a column in the table.",
          "pos": [
            185,
            458
          ]
        },
        {
          "content": "An item may look like this:",
          "pos": [
            459,
            486
          ]
        }
      ]
    },
    {
      "pos": [
        50553,
        50804
      ],
      "content": "Let's also assume we have an additional table called <bpt id=\"p122\">**</bpt>Priority<ept id=\"p122\">**</ept><ph id=\"ph185\"/> with rows that contain a priority <bpt id=\"p123\">**</bpt>number<ept id=\"p123\">**</ept><ph id=\"ph186\"/> and a text <bpt id=\"p124\">**</bpt>description<ept id=\"p124\">**</ept>. For example, the priority number 1 might have the description of \"Critical\", with the object looking as follows:",
      "nodes": [
        {
          "content": "Let's also assume we have an additional table called <bpt id=\"p122\">**</bpt>Priority<ept id=\"p122\">**</ept><ph id=\"ph185\"/> with rows that contain a priority <bpt id=\"p123\">**</bpt>number<ept id=\"p123\">**</ept><ph id=\"ph186\"/> and a text <bpt id=\"p124\">**</bpt>description<ept id=\"p124\">**</ept>.",
          "pos": [
            0,
            296
          ]
        },
        {
          "content": "For example, the priority number 1 might have the description of \"Critical\", with the object looking as follows:",
          "pos": [
            297,
            409
          ]
        }
      ]
    },
    {
      "pos": [
        50853,
        51010
      ],
      "content": "We can now replace the <bpt id=\"p125\">**</bpt>priority<ept id=\"p125\">**</ept><ph id=\"ph187\"/> number in our item with the text description of the priority number. We do this with a relational join of the two tables.",
      "nodes": [
        {
          "content": "We can now replace the <bpt id=\"p125\">**</bpt>priority<ept id=\"p125\">**</ept><ph id=\"ph187\"/> number in our item with the text description of the priority number.",
          "pos": [
            0,
            162
          ]
        },
        {
          "content": "We do this with a relational join of the two tables.",
          "pos": [
            163,
            215
          ]
        }
      ]
    },
    {
      "pos": [
        51342,
        51452
      ],
      "content": "The script joins the two tables and writes the results to the log. The resulting objects could look like this:",
      "nodes": [
        {
          "content": "The script joins the two tables and writes the results to the log.",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "The resulting objects could look like this:",
          "pos": [
            67,
            110
          ]
        }
      ]
    },
    {
      "pos": [
        51540,
        51604
      ],
      "content": "<ph id=\"ph188\">&lt;a name=\"raw\"&gt;</ph><ph id=\"ph189\">&lt;/a&gt;</ph>How to: Run a query that returns <bpt id=\"p126\">*</bpt>raw<ept id=\"p126\">*</ept><ph id=\"ph190\"/> results"
    },
    {
      "pos": [
        51606,
        51950
      ],
      "content": "This example executes the query, as before, but returns the resultset in \"raw\" format which requires you to parse it, row by row, and column by column. A possible scenario for this is if you need access to data types that Mobile Services does not support. This code simply writes the output to the console log so you can inspect the raw format.",
      "nodes": [
        {
          "content": "This example executes the query, as before, but returns the resultset in \"raw\" format which requires you to parse it, row by row, and column by column.",
          "pos": [
            0,
            151
          ]
        },
        {
          "content": "A possible scenario for this is if you need access to data types that Mobile Services does not support.",
          "pos": [
            152,
            255
          ]
        },
        {
          "content": "This code simply writes the output to the console log so you can inspect the raw format.",
          "pos": [
            256,
            344
          ]
        }
      ]
    },
    {
      "pos": [
        52208,
        52358
      ],
      "content": "Here is the output from running this query. It contains metadata about each column in the table, followed by a representation of the rows and columns.",
      "nodes": [
        {
          "content": "Here is the output from running this query.",
          "pos": [
            0,
            43
          ]
        },
        {
          "content": "It contains metadata about each column in the table, followed by a representation of the rows and columns.",
          "pos": [
            44,
            150
          ]
        }
      ]
    },
    {
      "pos": [
        53273,
        53277
      ],
      "content": "####"
    },
    {
      "pos": [
        53302,
        53345
      ],
      "content": "How to: Get access to a database connection"
    },
    {
      "pos": [
        53347,
        53493
      ],
      "content": "You can use the <bpt id=\"p127\">**</bpt>open<ept id=\"p127\">**</ept><ph id=\"ph191\"/> method to get access to the database connection. One reason to do this might be if you need to use database transactions.",
      "nodes": [
        {
          "content": "You can use the <bpt id=\"p127\">**</bpt>open<ept id=\"p127\">**</ept><ph id=\"ph191\"/> method to get access to the database connection.",
          "pos": [
            0,
            131
          ]
        },
        {
          "content": "One reason to do this might be if you need to use database transactions.",
          "pos": [
            132,
            204
          ]
        }
      ]
    },
    {
      "pos": [
        53495,
        53773
      ],
      "content": "Successful execution of the <bpt id=\"p128\">**</bpt>open<ept id=\"p128\">**</ept><ph id=\"ph192\"/> causes the database connection to be passed into the <bpt id=\"p129\">**</bpt>success<ept id=\"p129\">**</ept><ph id=\"ph193\"/> function as a parameter. You can invoke any of the following functions on the <bpt id=\"p130\">**</bpt>connection<ept id=\"p130\">**</ept><ph id=\"ph194\"/> object: <bpt id=\"p131\">*</bpt>close<ept id=\"p131\">*</ept>, <bpt id=\"p132\">*</bpt>queryRaw<ept id=\"p132\">*</ept>, <bpt id=\"p133\">*</bpt>query<ept id=\"p133\">*</ept>, <bpt id=\"p134\">*</bpt>beginTransaction<ept id=\"p134\">*</ept>, <bpt id=\"p135\">*</bpt>commit<ept id=\"p135\">*</ept>, and <bpt id=\"p136\">*</bpt>rollback<ept id=\"p136\">*</ept>.",
      "nodes": [
        {
          "content": "Successful execution of the <bpt id=\"p128\">**</bpt>open<ept id=\"p128\">**</ept><ph id=\"ph192\"/> causes the database connection to be passed into the <bpt id=\"p129\">**</bpt>success<ept id=\"p129\">**</ept><ph id=\"ph193\"/> function as a parameter.",
          "pos": [
            0,
            242
          ]
        },
        {
          "content": "You can invoke any of the following functions on the <bpt id=\"p130\">**</bpt>connection<ept id=\"p130\">**</ept><ph id=\"ph194\"/> object: <bpt id=\"p131\">*</bpt>close<ept id=\"p131\">*</ept>, <bpt id=\"p132\">*</bpt>queryRaw<ept id=\"p132\">*</ept>, <bpt id=\"p133\">*</bpt>query<ept id=\"p133\">*</ept>, <bpt id=\"p134\">*</bpt>beginTransaction<ept id=\"p134\">*</ept>, <bpt id=\"p135\">*</bpt>commit<ept id=\"p135\">*</ept>, and <bpt id=\"p136\">*</bpt>rollback<ept id=\"p136\">*</ept>.",
          "pos": [
            243,
            704
          ]
        }
      ]
    },
    {
      "pos": [
        54052,
        54054
      ],
      "content": "##"
    },
    {
      "pos": [
        54078,
        54107
      ],
      "content": "Debugging and troubleshooting"
    },
    {
      "pos": [
        54109,
        54450
      ],
      "content": "The primary way to debug and troubleshoot your server scripts is by writing to the service log. By default, Mobile Services writes errors that occur during service script execution to the service logs. Your scripts can also write to the logs. Writing to logs is great way to debug your scripts and validate that they are behaving as desired.",
      "nodes": [
        {
          "content": "The primary way to debug and troubleshoot your server scripts is by writing to the service log.",
          "pos": [
            0,
            95
          ]
        },
        {
          "content": "By default, Mobile Services writes errors that occur during service script execution to the service logs.",
          "pos": [
            96,
            201
          ]
        },
        {
          "content": "Your scripts can also write to the logs.",
          "pos": [
            202,
            242
          ]
        },
        {
          "content": "Writing to logs is great way to debug your scripts and validate that they are behaving as desired.",
          "pos": [
            243,
            341
          ]
        }
      ]
    },
    {
      "pos": [
        54452,
        54455
      ],
      "content": "###"
    },
    {
      "pos": [
        54483,
        54530
      ],
      "content": "How to: Write output to the mobile service logs"
    },
    {
      "pos": [
        54532,
        54761
      ],
      "content": "To write to the logs, use the global [console object]. Use the <bpt id=\"p137\">**</bpt>log<ept id=\"p137\">**</ept><ph id=\"ph195\"/> or <bpt id=\"p138\">**</bpt>info<ept id=\"p138\">**</ept><ph id=\"ph196\"/> function to log information-level warnings. The <bpt id=\"p139\">**</bpt>warning<ept id=\"p139\">**</ept><ph id=\"ph197\"/> and <bpt id=\"p140\">**</bpt>error<ept id=\"p140\">**</ept><ph id=\"ph198\"/> functions log their respective levels, which are called-out in the logs.",
      "nodes": [
        {
          "content": "To write to the logs, use the global [console object].",
          "pos": [
            0,
            54
          ]
        },
        {
          "content": "Use the <bpt id=\"p137\">**</bpt>log<ept id=\"p137\">**</ept><ph id=\"ph195\"/> or <bpt id=\"p138\">**</bpt>info<ept id=\"p138\">**</ept><ph id=\"ph196\"/> function to log information-level warnings.",
          "pos": [
            55,
            242
          ]
        },
        {
          "content": "The <bpt id=\"p139\">**</bpt>warning<ept id=\"p139\">**</ept><ph id=\"ph197\"/> and <bpt id=\"p140\">**</bpt>error<ept id=\"p140\">**</ept><ph id=\"ph198\"/> functions log their respective levels, which are called-out in the logs.",
          "pos": [
            243,
            461
          ]
        }
      ]
    },
    {
      "pos": [
        54766,
        54954
      ],
      "content": "<ph id=\"ph199\">[AZURE.NOTE]</ph><ph id=\"ph200\"/> To view the logs for your mobile service, log on to the <bpt id=\"p141\">[</bpt>Azure classic portal<ept id=\"p141\">](https://manage.windowsazure.com/)</ept>, select your mobile service, and then choose the <bpt id=\"p142\">**</bpt>Logs<ept id=\"p142\">**</ept><ph id=\"ph201\"/> tab."
    },
    {
      "pos": [
        54956,
        55143
      ],
      "content": "You can also use the logging functions of the [console object] to format your messages using parameters. The following example supplies a JSON object as a parameter to the message string:",
      "nodes": [
        {
          "content": "You can also use the logging functions of the [console object] to format your messages using parameters.",
          "pos": [
            0,
            104
          ]
        },
        {
          "content": "The following example supplies a JSON object as a parameter to the message string:",
          "pos": [
            105,
            187
          ]
        }
      ]
    },
    {
      "pos": [
        55295,
        55421
      ],
      "content": "Notice that the string <ph id=\"ph202\">`%j`</ph><ph id=\"ph203\"/> is used as the placeholder for a JSON object and that parameters are supplied in sequential order."
    },
    {
      "pos": [
        55424,
        55545
      ],
      "content": "To avoid overloading your log, you should remove or disable calls to console.log() that aren't needed for production use."
    },
    {
      "pos": [
        55565,
        57630
      ],
      "content": "[Introduction]: #intro\n[Table operations]: #table-scripts\n[Basic table operations]: #basic-table-ops\n[How to: Register for table operations]: #register-table-scripts\n[How to: Define table scripts]: #execute-operation\n[How to: override the default response]: #override-response\n[How to: Modify an operation]: #modify-operation\n[How to: Override success and error]: #override-success-error\n[How to: Override execute success]: #override-success\n[How to: Override default error handling]: #override-error\n[How to: Access tables from scripts]: #access-tables\n[How to: Add custom parameters]: #access-headers\n[How to: Work with users]: #work-with-users\n[How to: Define scheduled job scripts]: #scheduler-scripts\n[How to: Refine access to tables]: #authorize-tables\n[Using Transact-SQL to access tables]: #TSQL\n[How to: Run a static query]: #static-query\n[How to: Run a dynamic query]: #dynamic-query\n[How to: Run a query that returns *raw* results]: #raw\n[How to: Get access to a database connection]: #connection\n[How to: Join relational tables]: #joins\n[How to: Perform Bulk Inserts]: #bulk-inserts\n[How to: Map JSON types to database types]: #JSON-types\n[How to: Load Node.js modules]: #modules-helper-functions\n[How to: Write output to the mobile service logs]: #write-to-logs\n[Source control, shared code, and helper functions]: #shared-code\n[Using the command line tool]: #command-prompt\n[Working with tables]: #working-with-tables\n[Custom API anchor]: #custom-api\n[How to: Define a custom API]: #define-custom-api\n[How to: Share code by using source control]: #shared-code-source-control\n[How to: Use helper functions]: #helper-functions\n[Debugging and troubleshooting]: #debugging\n[How to: Implement HTTP methods]: #handle-methods\n[How to: Work with users and headers in a custom API]: #get-api-user\n[How to: Access custom API request headers]: #get-api-headers\n[Job Scheduler]: #scheduler-scripts\n[How to: Define multiple routes in a custom API]: #api-routes\n[How to: Send and receive data as XML]: #api-return-xml\n[How to: Work with app settings]: #app-settings"
    },
    {
      "pos": [
        57995,
        62403
      ],
      "content": "[Mobile Services server script reference]: http://msdn.microsoft.com/library/windowsazure/jj554226.aspx\n[Schedule backend jobs in Mobile Services]: /develop/mobile/tutorials/schedule-backend-tasks/\n[request object]: http://msdn.microsoft.com/library/windowsazure/jj554218.aspx\n[response object]: http://msdn.microsoft.com/library/windowsazure/dn303373.aspx\n[User object]: http://msdn.microsoft.com/library/windowsazure/jj554220.aspx\n[push object]: http://msdn.microsoft.com/library/windowsazure/jj554217.aspx\n[insert function]: http://msdn.microsoft.com/library/windowsazure/jj554229.aspx\n[insert]: http://msdn.microsoft.com/library/windowsazure/jj554229.aspx\n[update function]: http://msdn.microsoft.com/library/windowsazure/jj554214.aspx\n[delete function]: http://msdn.microsoft.com/library/windowsazure/jj554215.aspx\n[read function]: http://msdn.microsoft.com/library/windowsazure/jj554224.aspx\n[update]: http://msdn.microsoft.com/library/windowsazure/jj554214.aspx\n[delete]: http://msdn.microsoft.com/library/windowsazure/jj554215.aspx\n[read]: http://msdn.microsoft.com/library/windowsazure/jj554224.aspx\n[query object]: http://msdn.microsoft.com/library/windowsazure/jj613353.aspx\n[apns object]: http://msdn.microsoft.com/library/windowsazure/jj839711.aspx\n[mpns object]: http://msdn.microsoft.com/library/windowsazure/jj871025.aspx\n[wns object]: http://msdn.microsoft.com/library/windowsazure/jj860484.aspx\n[table object]: http://msdn.microsoft.com/library/windowsazure/jj554210.aspx\n[tables object]: http://msdn.microsoft.com/library/windowsazure/jj614364.aspx\n[mssql object]: http://msdn.microsoft.com/library/windowsazure/jj554212.aspx\n[console object]: http://msdn.microsoft.com/library/windowsazure/jj554209.aspx\n[Read and write data]: http://msdn.microsoft.com/library/windowsazure/jj631640.aspx\n[Validate data]: http://msdn.microsoft.com/library/windowsazure/jj631638.aspx\n[Modify the request]: http://msdn.microsoft.com/library/windowsazure/jj631635.aspx\n[Modify the response]: http://msdn.microsoft.com/library/windowsazure/jj631631.aspx\n[Azure classic portal]: https://manage.windowsazure.com/\n[Schedule jobs]: http://msdn.microsoft.com/library/windowsazure/jj860528.aspx\n[Validate and modify data in Mobile Services by using server scripts]: /develop/mobile/tutorials/validate-modify-and-augment-data-dotnet/\n[Commands to manage Azure Mobile Services]: ../virtual-machines-command-line-tools.md#Mobile_Scripts\n[Windows Store Push]: /develop/mobile/tutorials/get-started-with-push-dotnet/\n[Windows Phone Push]: /develop/mobile/tutorials/get-started-with-push-wp8/\n[iOS Push]: /develop/mobile/tutorials/get-started-with-push-ios/\n[Android Push]: /develop/mobile/tutorials/get-started-with-push-android/\n[Azure SDK for Node.js]: http://go.microsoft.com/fwlink/p/?LinkId=275539\n[Send HTTP request]: http://msdn.microsoft.com/library/windowsazure/jj631641.aspx\n[Send email from Mobile Services with SendGrid]: /develop/mobile/tutorials/send-email-with-sendgrid/\n[Get started with authentication]: http://go.microsoft.com/fwlink/p/?LinkId=287177\n[crypto API]: http://go.microsoft.com/fwlink/p/?LinkId=288802\n[path API]: http://go.microsoft.com/fwlink/p/?LinkId=288803\n[querystring API]: http://go.microsoft.com/fwlink/p/?LinkId=288804\n[url API]: http://go.microsoft.com/fwlink/p/?LinkId=288805\n[util API]: http://go.microsoft.com/fwlink/p/?LinkId=288806\n[zlib API]: http://go.microsoft.com/fwlink/p/?LinkId=288807\n[Custom API]: http://msdn.microsoft.com/library/windowsazure/dn280974.aspx\n[Call a custom API from the client]: /develop/mobile/tutorials/call-custom-api-dotnet/#define-custom-api\n[express.js library]: http://go.microsoft.com/fwlink/p/?LinkId=309046\n[Define a custom API that supports periodic notifications]: /develop/mobile/tutorials/create-pull-notifications-dotnet/\n[express object in express.js]: http://expressjs.com/api.html#express\n[Store server scripts in source control]: /develop/mobile/tutorials/store-scripts-in-source-control/\n[Leverage shared code and Node.js modules in your server scripts]: /develop/mobile/tutorials/store-scripts-in-source-control/#use-npm\n[service object]: http://msdn.microsoft.com/library/windowsazure/dn303371.aspx\n[App settings]: http://msdn.microsoft.com/library/dn529070.aspx\n[config module]: http://msdn.microsoft.com/library/dn508125.aspx\n[Support for package.json in Azure Mobile Services]: http://go.microsoft.com/fwlink/p/?LinkId=391036"
    }
  ],
  "content": "<properties \n    pageTitle=\"Work with a JavaScript backend mobile service\" \n    description=\"Provides examples on how to define, register, and use server scripts in Azure Mobile Services.\" \n    services=\"mobile-services\" \n    documentationCenter=\"\" \n    authors=\"RickSaling\" \n    manager=\"dwrede\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"mobile-services\" \n    ms.workload=\"mobile\" \n    ms.tgt_pltfrm=\"javascript\" \n    ms.devlang=\"multiple\" \n    ms.topic=\"article\" \n    ms.date=\"12/01/2015\" \n    ms.author=\"ricksal\"/>\n\n\n# Work with a JavaScript backend mobile service\n\nThis article provides detailed information about and examples of how to work with a JavaScript backend in Azure Mobile Services. \n\n##<a name=\"intro\"></a>Introduction\n\nIn a JavaScript backend mobile service, you can define custom business logic as JavaScript code that's stored and executed on the server. This server script code is assigned to one of the following server functions:\n\n+ [Insert, read, update, or delete operations on a given table][Table operations].\n+ [Scheduled jobs][Job Scheduler].\n+ [HTTP methods defined in a custom API][Custom API anchor]. \n\nThe signature of the main function in the server script depends on the context of where the script is used. You can also define common script code as nodes.js modules that are shared across scripts. For more information, see [Source control and shared code][Source control, shared code, and helper functions].\n\nFor descriptions of individual server script objects and functions, see [Mobile Services server script reference]. \n\n\n##<a name=\"table-scripts\"></a>Table operations\n\nA table operation script is a server script that is registered to an operation on a table&mdash;insert, read, update, or delete (*del*). This section describes how to work with table operations in a JavaScript backend, which includes the following sections:\n\n+ [Overview of table operations][Basic table operations]\n+ [How to: Register for table operations]\n+ [How to: Override the default response]\n+ [How to: Override execute success]\n+ [How to: Override default error handling]\n+ [How to: Generate unique ID values](#generate-guids)\n+ [How to: Add custom parameters]\n+ [How to: Work with table users][How to: Work with users]\n\n###<a name=\"basic-table-ops\"></a>Overview of table operations\n\nThe name of the script must match the kind of operation for which it is registered. Only one script can be registered for a given table operation. The script is executed every time that the given operation is invoked by a REST request&mdash;for example, when a POST request is received to insert an item into the table. Mobile Services does not preserve state between script executions. Because a new global context is created every time a script is run, any state variables that are defined in the script are reinitialized. If you want to store state from one request to another, create a table in your mobile service, and then read and write the state to the table. For more information, see [How to: Access tables from scripts].\n\nYou write table operation scripts if you need to enforce customized business logic when the operation is executed. For example, the following script rejects insert operations where the string length of the `text` field is greater than ten characters: \n\n    function insert(item, user, request) {\n        if (item.text.length > 10) {\n            request.respond(statusCodes.BAD_REQUEST, \n                'Text length must be less than 10 characters');\n        } else {\n            request.execute();\n        }\n    }\n\nA table script function always takes three arguments.\n\n- The first argument varies depending on the table operation. \n\n    - For inserts and updates, it is an **item** object, which is a JSON representation of the row being affected by the operation. This allows you to access column values by name, for example, *item.Owner*, where *Owner* is one of the names in the JSON representation.\n    - For a delete, it is the ID of the record to delete. \n    - And for a read, it is a [query object] that specifies the rowset to return.\n\n- The second argument is always a [user object][User object] that represents the user that submitted the request. \n\n- The third argument is always a [request object][request object], by which you can control execution of the requested operation and the response that's sent to the client.\n\nHere are the canonical main-function signatures for the table operations: \n\n+ [Insert][insert function]: `function insert (item, user, request) { ... }`\n+ [Update][update function]: `function update (item, user, request) { ... }`\n+ [Delete][delete function]: `function del (id, user, request) { ... }`\n+ [Read][read function]: `function read (query, user, request) { ... }`\n\n>[AZURE.NOTE]A function that's registered to the delete operation must be named _del_ because delete is a reserved keyword in JavaScript. \n\nEvery server script has a main function, and may have optional helper functions. Even though a server script may have been created for a specific table, it can also reference other tables in the same database. You can also define common functions as modules that can be shared across scripts. For more information, see [Source control and shared code][Source control, shared code, and helper functions].\n\n###<a name=\"register-table-scripts\"></a>How to: Register table scripts\n\nYou can define server scripts that are registered to a table operation in one of the following ways:\n\n+ In the [Azure classic portal]. Scripts for table operations are accessed in the **Scripts** tab for a given table. The following shows the default code registered to the insert script for the `TodoItem` table. You can override this code with your own custom business logic.\n\n    ![1][1]\n    \n    To learn how to do this, see [Validate and modify data in Mobile Services by using server scripts].  \n\n+ By using source control. When you have source control enabled, simply create a file named <em>`<table>`</em>.<em>`<operation>`</em>.js in the .\\service\\table subfolder in your git repository, where <em>`<table>`</em> is the name of the table and <em>`<operation>`</em> is the table operation being registered. For more information, see [Source control and shared code][Source control, shared code, and helper functions].\n\n+ From the command prompt by using the Azure command line tool. For more information, see [Using the command line tool].\n\n\nA table operation script must call at least one of the following functions of the [request object] to make sure that the client receives a response. \n \n+ **execute function**: The operation is completed as requested and the standard response is returned.\n \n+ **respond function**: A custom response is returned.\n\n> [AZURE.IMPORTANT] When a script has a code path in which neither **execute** nor **respond** is invoked, the operation may become unresponsive.\n\nThe following script calls the **execute** function to complete the data operation requested by the client: \n\n    function insert(item, user, request) { \n        request.execute(); \n    }\n\nIn this example, the item is inserted into the database and the appropriate status code is returned to the user. \n\nWhen the **execute** function is called, the `item`, [query][query object], or `id` value that was passed as the first argument into the script function is used to perform the operation. For an insert, update or query operation, you can modify the item or query before you call **execute**: \n\n    function insert(item, user, request) { \n        item.scriptComment =\n            'this was added by a script and will be saved to the database'; \n        request.execute(); \n    } \n \n    function update(item, user, request) { \n        item.scriptComment = \n            'this was added by a script and will be saved to the database'; \n        request.execute(); \n    } \n\n    function read(query, user, request) { \n        // Only return records for the current user         \n        query.where({ userid: user.userId}); \n        request.execute(); \n    }\n \n>[AZURE.NOTE]In a delete script, changing the value of the supplied userId variable does not affect which record gets deleted.\n\nFor more examples, see [Read and write data], [Modify the request] and [Validate data].\n\n\n###<a name=\"override-response\"></a>How to: Override the default response\n\nYou can also use a script to implement validation logic that can override the default response behavior. If validation fails, just call the **respond** function instead of the **execute** function and write the response to the client: \n\n    function insert(item, user, request) {\n        if (item.userId !== user.userId) {\n            request.respond(statusCodes.FORBIDDEN, \n            'You may only insert records with your userId.');\n        } else {\n            request.execute();\n        }\n    }\n\nIn this example, the request is rejected when the inserted item does not have a `userId` property that matches the `userId` of the [user object] that's supplied for the authenticated client. In this case, a database operation (*insert*) does not occur, and a response that has a 403 HTTP status code and a custom error message is returned to the client. For more examples, see [Modify the response].\n\n###<a name=\"override-success\"></a>How to: Override execute success\n\nBy default in a table operation, the **execute** function writes responses automatically. However, you can pass two optional parameters to the execute function that override its behavior on success and/or on error.\n\nBy passing in a **success** handler when you call execute, you can modify the results of a query before you write them to the response. The following example calls `execute({ success: function(results) { ... })` to perform additional work after data is read from the database but before the response is written:\n\n    function read(query, user, request) {\n        request.execute({\n            success: function(results) {\n                results.forEach(function(r) {\n                    r.scriptComment = \n                    'this was added by a script after querying the database';\n                });\n                request.respond();\n            }\n        });\n    }\n\nWhen you provide a **success** handler to the **execute** function, you must also call the **respond** function as part of the **success** handler so that the runtime knows that the script has completed and that a response can be written. When you call **respond** without passing any arguments, Mobile Services generates the default response. \n\n>[AZURE.NOTE]You can call **respond** without arguments to invoke the default response only after you first call the **execute** function.\n \n###<a name=\"override-error\"></a>How to: Override default error handling\n\nThe **execute** function can fail if there is a loss of connectivity to the database, an invalid object, or an incorrect query. By default when an error occurs, server scripts log the error and write an error result to the response. Because Mobile Services provides default error handling, you don't have to handle errors that may occur in the service. \n\nYou can override the default error handling by implementing explicit error handling if you want a particular compensating action or when you want to use the global console object to write more detailed information to the log. Do this by supplying an **error** handler to the **execute** function:\n\n    function update(item, user, request) { \n      request.execute({ \n        error: function(err) { \n          // Do some custom logging, then call respond. \n          request.respond(); \n        } \n      }); \n    }\n \n\nWhen you provide an error handler, Mobile Services returns an error result to the client when **respond** is called.\n\nYou can also provide both a **success** and an **error** handler if you wish.\n\n###<a name=\"generate-guids\"></a>How to: Generate unique ID values\n\nMobile Services supports unique custom string values for the table's **id** column. This allows applications to use custom values such as email addresses or user names for the ID. \n\nString IDs provide you with the following benefits:\n\n+ IDs are generated without making a round-trip to the database.\n+ Records are easier to merge from different tables or databases.\n+ IDs values can integrate better with an application's logic.\n\nWhen a string ID value is not set on an inserted records, Mobile Services generates a unique value for the ID. You can generate your own unique ID values in server scripts. The script example below generates a custom GUID and assigns it to a new record's ID. This is similar to the id value that Mobile Services would generate if you didn't pass in a value for a record's ID.\n\n    // Example of generating an id. This is not required since Mobile Services\n    // will generate an id if one is not passed in.\n    item.id = item.id || newGuid();\n    request.execute();\n\n    function newGuid() {\n        var pad4 = function(str) { return \"0000\".substring(str.length) + str; };\n        var hex4 = function () { return pad4(Math.floor(Math.random() * 0x10000 /* 65536 */ ).toString(16)); };\n        return (hex4() + hex4() + \"-\" + hex4() + \"-\" + hex4() + \"-\" + hex4() + \"-\" + hex4() + hex4() + hex4());\n    }\n\n\nWhen an application provides a value for an ID, Mobile Services stores it as-is. This includes leading or trailing white spaces. White space are not trimmed from value.\n\nThe value for the `id` must be unique and it must not include characters from the following sets:\n\n+ Control characters: [0x0000-0x001F] and [0x007F-0x009F]. For more information, see [ASCII control codes C0 and C1](http://en.wikipedia.org/wiki/Data_link_escape_character#C1_set).\n+  Printable characters: **\"**(0x0022), **\\+** (0x002B), **/** (0x002F), **?** (0x003F), **\\\\** (0x005C), **`** (0x0060)\n+  The ids \".\" and \"..\"\n\nYou can also use integer IDs for your tables. To use an integer ID, you must create your table with the `mobile table create` command using the `--integerId` option. This command is used with the Command-line Interface (CLI) for Azure. For more information on using the CLI, see [CLI to manage Mobile Services tables](../virtual-machines-command-line-tools.md#Mobile_Tables).\n\n\n###<a name=\"access-headers\"></a>How to: Access custom parameters\n\nWhen you send a request to your mobile service, you can include custom parameters in the URI of the request to instruct your table operation scripts how to process a given request. You then modify your script to inspect the parameter to determine the processing path.\n\nFor example, the following URI for a POST request tells the service to not permit the insertion of a new *TodoItem* that has the same text value:\n\n        https://todolist.azure-mobile.net/tables/TodoItem?duplicateText=false\n\nThese custom query parameters are accessed as JSON values from the **parameters** property of the [request object]. The **request** object is supplied by Mobile Services to any function registered to a table operation. The following server script for the insert operation checks the value of the `duplicateText` parameter before the insert operation is run:\n\n        function insert(item, user, request) {\n            var todoItemTable = tables.getTable('TodoItem');\n            // Check the supplied custom parameter to see if\n            // we should allow duplicate text items to be inserted.        \n            if (request.parameters.duplicateText === 'false') {\n                // Find all existing items with the same text\n                // and that are not marked 'complete'. \n                todoItemTable.where({\n                    text: item.text,\n                    complete: false\n                }).read({\n                    success: insertItemIfNotComplete\n                });\n            } else {\n                request.execute();\n            }\n\n            function insertItemIfNotComplete(existingItems) {\n                if (existingItems.length > 0) {\n                    request.respond(statusCodes.CONFLICT, \n                        \"Duplicate items are not allowed.\");\n                } else {\n                    // Insert the item as normal. \n                    request.execute();\n                }\n            }\n        }\n\nNote that in **insertItemIfNotComplete** the **execute** function of the [request object] is invoked to insert the item when there is no duplicate text; otherwise the **respond** function is invoked to notify the client of the duplicate. \n\nNote the syntax of the call to the **success** function in the above code:\n\n                }).read({\n                    success: insertItemIfNotComplete\n                });\n\nIn JavaScript it is a compact version of the lengthier equivalent: \n\n        success: function(results) \n        { \n            insertItemIfNotComplete(results); \n        }\n\n\n###<a name=\"work-with-users\"></a>How to: Work with users\n\nIn Azure Mobile Services, you can use an identity provider to authenticate users. For more information, see [Get started with authentication]. When an authenticated user invokes a table operation, Mobile Services uses the [user object] to supply information about the user to the registered script function. The **userId** property can be used to store and retrieve user-specific information. The following example sets the owner property of an item based on the **userId** of an authenticated user:\n\n    function insert(item, user, request) {\n        item.owner = user.userId;\n        request.execute();\n    }\n\nThe next example adds an additional filter to the query based on the **userId** of an authenticated user. This filter restricts the result to only items that belong to the current user:  \n\n    function read(query, user, request) {\n        query.where({\n            owner: user.userId\n        });\n        request.execute();\n    }\n\n##<a name=\"custom-api\"></a>Custom APIs\n\nThis section describes how you create and work with custom API endpoints, which includes the following sections: \n    \n+ [Overview of custom APIs](#custom-api-overview)\n+ [How to: Define a custom API]\n+ [How to: Implement HTTP methods]\n+ [How to: Send and receive data as XML]\n+ [How to: Work with users and headers in a custom API]\n+ [How to: Define multiple routes in a custom API]\n\n###<a name=\"custom-api-overview\"></a>Overview of custom APIs\n\nA custom API is an endpoint in your mobile service that is accessed by one or more of the standard HTTP methods: GET, POST, PUT, PATCH, DELETE. A separate function export can be defined for each HTTP method supported by the custom API, all in a single script file. The registered script is invoked when a request to the custom API using the given method is received. For more information, see [Custom API].\n\nWhen custom API functions are called by the Mobile Services runtime, both a [request][request object] and [response][response object] object are supplied. These objects expose the functionality of the [express.js library], which can be leveraged by your scripts. The following custom API named **hello** is a very simple example that returns _Hello, world!_ in response to a POST request:\n\n        exports.post = function(request, response) {\n            response.send(200, \"{ message: 'Hello, world!' }\");\n        } \n\nThe **send** function on the [response object] returns your desired response to the client. This code is invoked by sending a POST request to the following URL:\n\n        https://todolist.azure-mobile.net/api/hello  \n\nThe global state is maintained between executions. \n\n###<a name=\"define-custom-api\"></a>How to: Define a custom API\n\nYou can define server scripts that are registered to HTTP methods in a custom API endpoint in one of the following ways:\n\n+ In the [Azure classic portal]. Custom API scripts are created and modified in the **API** tab. The server script code is in the **Scripts** tab of a given custom API. The following shows the script that is invoked by a POST request to the `CompleteAll` custom API endpoint. \n\n    ![2][2]\n    \n    Access permissions to custom API methods are assigned in the Permissions tab. To see how this custom API was created, see [Call a custom API from the client].  \n\n+ By using source control. When you have source control enabled, simply create a file named <em>`<custom_api>`</em>.js in the .\\service\\api subfolder in your git repository, where <em>`<custom_api>`</em> is the name of the custom API being registered. This script file contains an _exported_ function for each HTTP method exposed by the custom API. Permissions are defined in a companion .json file. For more information, see [Source control and shared code][Source control, shared code, and helper functions].\n\n+ From the command prompt by using the Azure command line tool. For more information, see [Using the command line tool].\n\n###<a name=\"handle-methods\"></a>How to: Implement HTTP methods\n\nA custom API can handle one or more of the HTTP methods, GET, POST, PUT, PATCH, and DELETE. An exported function is defined for each HTTP method handled by the custom API. A single custom API code file can export one or all of the following functions:\n\n        exports.get = function(request, response) { ... };\n        exports.post = function(request, response) { ... };\n        exports.patch = function(request, response) { ... };\n        exports.put = function(request, response) { ... };\n        exports.delete = function(request, response) { ... };\n\nThe custom API endpoint cannot be called using an HTTP method that has not been implemented in the server script, and a 405 (Method Not Allowed) error response is returned. Separate permission levels can be assigned to each support HTTP method.\n\n###<a name=\"api-return-xml\"></a>How to: Send and receive data as XML\n\nWhen clients store and retrieve data, Mobile Services uses JavaScript Object Notation (JSON) to represent data in the message body. However, there are scenarios where you instead want to use an XML payload. For example, Windows Store apps have a built-in periodic notifications functionality that requires the service to emit XML. For more information, see [Define a custom API that supports periodic notifications].\n\nThe following **OrderPizza** custom API function returns a simple XML document as the response payload:\n\n        exports.get = function(request, response) {\n          response.set('content-type', 'application/xml');\n          var xml = '<?xml version=\"1.0\"?><PizzaOrderForm><PizzaOrderForm/>';\n          response.send(200, xml);\n        };\n\nThis custom API function is invoked by an HTTP GET request to the following endpoint:\n\n        https://todolist.azure-mobile.net/api/orderpizza\n\n###<a name=\"get-api-user\"></a>How to: Work with users and headers in a custom API\n\nIn Azure Mobile Services, you can use an identity provider to authenticate users. For more information, see [Get started with authentication]. When an authenticated user requests a custom API, Mobile Services uses the [user object] to provide information about the user to custom API code. The [user object] is accessed from the user property of the [request object]. The **userId** property can be used to store and retrieve user-specific information. \n\nThe following **OrderPizza** custom API function sets the owner property of an item based on the **userId** of an authenticated user:\n\n        exports.post = function(request, response) {\n            var userTable = request.service.tables.getTable('user');\n            userTable.lookup(request.user.userId, {\n                success: function(userRecord) {\n                    callPizzaAPI(userRecord, request.body, function(orderResult) {\n                        response.send(201, orderResult);\n                    });\n                }\n            });\n        \n        };\n\nThis custom API function is invoked by an HTTP POST request to the following endpoint:\n\n        https://<service>.azure-mobile.net/api/orderpizza\n\nYou can also access a specific HTTP header from the [request object], as shown in the following code:\n\n        exports.get = function(request, response) {    \n            var header = request.header('my-custom-header');\n            response.send(200, \"You sent: \" + header);\n        };\n\nThis simple example reads a custom header named `my-custom-header`, then returns the value in the response.\n\n###<a name=\"api-routes\"></a>How to: Define multiple routes in a custom API\n\nMobile Services enables you to define multiple paths, or routes, in a custom API. For example, HTTP GET requests to the following URLs in a **calculator** custom API will invoke an **add** or **subtract** function, respectively: \n\n+ `https://<service>.azure-mobile.net/api/calculator/add`\n+ `https://<service>.azure-mobile.net/api/calculator/sub`\n\nMultiple routes are defined by exporting a **register** function, which is passed an **api** object (similar to the [express object in express.js]) that is used to register routes under the custom API endpoint. The following example implements the **add** and **sub** methods in the **calculator** custom API: \n\n        exports.register = function (api) {\n            api.get('add', add);\n            api.get('sub', subtract);\n        }\n        \n        function add(req, res) {\n            var result = parseInt(req.query.a) + parseInt(req.query.b);\n            res.send(200, { result: result });\n        }\n        \n        function subtract(req, res) {\n            var result = parseInt(req.query.a) - parseInt(req.query.b);\n            res.send(200, { result: result });\n        }\n\nThe **api** object passed to the **register** function exposes a function for each HTTP method (**get**, **post**, **put**, **patch**, **delete**). These functions register a route to a defined function for a specific HTTP method. Each function takes two parameters, the first is the route name and the second is the function registered to the route. \n\nThe two routes in the above custom API example can be invoked by HTTP GET requests as follows (shown with the response):\n\n+ `https://<service>.azure-mobile.net/api/calculator/add?a=1&b=2`\n\n        {\"result\":3}\n\n+ `https://<service>.azure-mobile.net/api/calculator/sub?a=3&b=5`\n\n        {\"result\":-2}\n\n##<a name=\"scheduler-scripts\"></a>Job Scheduler\n\nMobile Services enables you to define server scripts that are executed either as jobs on a fixed schedule or on-demand from the Azure classic portal. Scheduled jobs are useful for performing periodic tasks such as cleaning-up table data and batch processing. For more information, see [Schedule jobs].\n\nScripts that are registered to scheduled jobs have a main function with the same name as the scheduled job. Because a scheduled script is not invoked by an HTTP request, there is no context that can be passed by the server runtime and the function takes no parameters. Like other kinds of scripts, you can have subroutine functions and require shared modules. For more information, see [Source control, shared code, and helper functions].\n\n###<a name=\"scheduler-scripts\"></a>How to: Define scheduled job scripts\n\nA server script can be assigned to a job that's defined in the Mobile Services Scheduler. These scripts belong to the job and are executed according to the job schedule. (You can also use the [Azure classic portal] to run jobs on demand.) A script that defines a scheduled job has no parameters because Mobile Services doesn't pass it any data; it's executed as a regular JavaScript function and doesn't interact with Mobile Services directly. \n\nYou define scheduled jobs in one of the following ways: \n\n+ In the [Azure classic portal] in the **Script** tab in the scheduler:\n\n    ![3][3]\n\n    For more information about how to do this, see [Schedule backend jobs in Mobile Services]. \n\n+ From the command prompt by using the Azure command line tool. For more information, see [Using the command line tool].\n\n>[AZURE.NOTE]When you have source control enabled, you can edit scheduled job script files directly in the .\\service\\scheduler subfolder in your git repository. For more information, see [How to: Share code by using source control].\n\n##<a name=\"shared-code\"></a>Source control, shared code, and helper functions\n\nThis sections shows you how to leverage source control to add your own custom node.js modules, shared code and other code reuse strategies, including the following sections:\n\n+ [Overview of leveraging shared code](#leverage-source-control)\n+ [How to: Load Node.js modules]\n+ [How to: Use helper functions]\n+ [How to: Share code by using source control]\n+ [How to: Work with app settings] \n\n###<a name=\"leverage-source-control\"></a>Overview of leveraging shared code\n\nBecause Mobile Services uses Node.js on the server, your scripts already have access to the built-in Node.js modules. You can also use source control to define your own modules or add other Node.js modules to your service.\n\nThe following are just some of the more useful modules that can be leveraged in your scripts by using the global **require** function:\n\n+ **azure**: Exposes the functionality of the Azure SDK for Node.js. For more information, see the [Azure SDK for Node.js]. \n+ **crypto**: Provides crypto functionality of OpenSSL. For more information, see the [Node.js documentation][crypto API].\n+ **path**: Contains utilities for working with file paths. For more information, see the [Node.js documentation][path API].\n+ **querystring**: Contains utilities for working with query strings. For more information, see the [Node.js documentation][querystring API].\n+ **request**: Sends HTTP requests to external REST services, such as Twitter and Facebook. For more information, see [Send HTTP request].\n+ **sendgrid**: Sends email by using the Sendgrid email service in Azure. For more information, see [Send email from Mobile Services with SendGrid].\n+ **url**: Contains utilities to parse and resolve URLs. For more information, see the [Node.js documentation][url API].\n+ **util**: Contains various utilities, such as string formatting and object type checking. For more information, see the [Node.js documentation][util API]. \n+ **zlib**: Exposes compression functionality, such as gzip and deflate. For more information, see the [Node.js documentation][zlib API]. \n\n###<a name=\"modules-helper-functions\"></a>How to: Leverage modules\n\nMobile Services exposes a set of modules that scripts can load by using the global **require** function. For example, a script can require **request** to make HTTP requests: \n\n    function update(item, user, request) { \n        var httpRequest = require('request'); \n        httpRequest('http://www.google.com', function(err, response, body) { \n            ... \n        }); \n    } \n\n\n###<a name=\"shared-code-source-control\"></a>How to: Share code by using source control\n\nYou can use source control with the Node.js package manager (npm) to control which modules are available to your mobile service. There are two ways to do this:\n\n+ For modules that are published to and installed by npm, use the package.json file to declare which packages you want to be installed by your mobile service. In this way, your service always has access to the latest version of the required packages. The package.json file lives in the `.\\service` directory. For more information, see [Support for package.json in Azure Mobile Services].\n\n+ For private or custom modules, you can use npm to manually install the module into the `.\\service\\node_modules` directory of your source control. For an example of how to manually upload a module, see [Leverage shared code and Node.js modules in your server scripts].\n\n    >[AZURE.NOTE]When `node_modules` already exists in the directory hierarchy, NPM will create the `\\node-uuid` subdirectory there instead of creating a new `node_modules` in the repository. In this case, just delete the existing `node_modules` directory.\n\nAfter you commit the package.json file or custom modules to the repository for your mobile service, use **require** to reference the modules by name.   \n\n>[AZURE.NOTE] Modules that you specify in package.json or upload to your mobile service are only used in your server script code. These modules are not used by the Mobile Services runtime.\n\n###<a name=\"helper-functions\"></a>How to: Use helper functions\n\nIn addition to requiring modules, individual server scripts can include helper functions. These are functions that are separate from the main function, which can be used to factor code in the script. \n\nIn the following example, a table script is registered to the insert operation, which includes the helper function **handleUnapprovedItem**:\n\n\n    function insert(item, user, request) {\n        if (!item.approved) {\n            handleUnapprovedItem(item, user, request);\n        } else {\n            request.execute();\n        }\n    }\n    \n    function handleUnapprovedItem(item, user, request) {\n        // Do something with the supplied item, user, or request objects.\n    }\n \nIn a script, helper functions must be declared after the main function. You must declare all variables in your script. Undeclared variables cause an error.\n\nHelper functions can also be defined once and shared between server scripts. To share a function between scripts, functions must be exported and the script file must exist in the `.\\service\\shared\\` directory. The following is a template for how to export a shared function in a file `.\\services\\shared\\helpers.js`:\n\n        exports.handleUnapprovedItem = function (tables, user, callback) {\n            \n            // Do something with the supplied tables or user objects and \n            // return a value to the callback function.\n        };\n \nYou can then use a function like this in a table operation script:\n\n        function insert(item, user, request) {\n            var helper = require('../shared/helper');\n            helper.handleUnapprovedItem(tables, user, function(result) {\n                    \n                    // Do something based on the result.\n                    request.execute();\n                }\n            }\n        }\n\nIn this example, you must pass both a [tables object] and a [user object] to the shared function. This is because shared scripts cannot access the global [tables object], and the [user object] only exists in the context of a request.\n\nScript files are uploaded to the shared directory either by using [source control][How to: Share code by using source control] or by using the [command line tool][Using the command line tool].\n\n###<a name=\"app-settings\"></a>How to: Work with app settings\n\nMobile Services enables you to securely store values as app settings, which can be accessed by your server scripts at runtime.  When you add data to the app settings of your mobile service, the name/value pairs are stored encrypted and you can access them in your server scripts without hard-coding them in the script file. For more information, see [App settings].\n\nThe following custom API example uses the supplied [service object] to retrieve an app setting value.  \n\n        exports.get = function(request, response) {\n        \n            // Get the MY_CUSTOM_SETTING value from app settings.\n            var customSetting = \n                request.service.config.appSettings.my_custom_setting;\n                \n            // Do something and then send a response.\n\n        }\n\nThe following code uses the configuration module to retrieve Twitter access token values, stored in app settings, that are used in a scheduled job script:\n\n        // Get the service configuration module.\n        var config = require('mobileservice-config');\n\n        // Get the stored Twitter consumer key and secret. \n        var consumerKey = config.twitterConsumerKey,\n            consumerSecret = config.twitterConsumerSecret\n        // Get the Twitter access token from app settings.    \n        var accessToken= config.appSettings.TWITTER_ACCESS_TOKEN,\n            accessTokenSecret = config.appSettings.TWITTER_ACCESS_TOKEN_SECRET;\n\nNote that this code also retrieves Twitter consumer key values stored in the **Identity** tab in the portal. Because a **config object** is not available in table operation and scheduled job scripts, you must require the configuration module to access app settings. For a complete example, see [Schedule backend jobs in Mobile Services].\n\n<h2><a name=\"command-prompt\"></a>Using the command line tool</h2>\n\nIn Mobile Services, you can create, modify, and delete server scripts by using the Azure command line tool. Before uploading your scripts, make sure that you are using the following directory structure:\n\n![4][4]\n\nNote that this directory structure is the same as the git repository when using source control. \n\nWhen uploading script files from the command line tool, you must first navigate to the `.\\services\\` directory. The following command uploads a script named `todoitem.insert.js` from the `table` subdirectory:\n\n        ~$azure mobile script upload todolist table/todoitem.insert.js\n        info:    Executing command mobile script upload\n        info:    mobile script upload command OK\n\nThe following command returns information about every script file maintained in your mobile service:\n\n        ~$ azure mobile script list todolist\n        info:    Executing command mobile script list\n        + Retrieving script information\n        info:    Table scripts\n        data:    Name                       Size\n        data:    -------------------------  ----\n        data:    table/channels.insert      1980\n        data:    table/TodoItem.insert      5504\n        data:    table/TodoItem.read        64\n        info:    Shared scripts\n        data:    Name              Size\n        data:    ----------------  ----\n        data:    shared/helper.js  62\n        data:    shared/uuid.js    7452\n        info:    Scheduled job scripts\n        data:    Job name    Script name           Status    Interval     Last run  Next run\n        data:    ----------  --------------------  --------  -----------  --------  --------\n        data:    getUpdates  scheduler/getUpdates  disabled  15 [minute]  N/A       N/A\n        info:    Custom API scripts\n        data:    Name                    Get          Put          Post         Patch        Delete\n        data:    ----------------------  -----------  -----------  -----------  -----------  -----------\n        data:    completeall             application  application  application  application  application\n        data:    register_notifications  application  application  user         application  application\n        info:    mobile script list command OK\n\nFor more information, see [Commands to manage Azure Mobile Services]. \n\n##<a name=\"working-with-tables\"></a>Working with tables\n\nThis section details strategies for working directly with SQL Database table data, including the following sections:\n\n+ [Overview of working with tables](#overview-tables)\n+ [How to: Access tables from scripts]\n+ [How to: Perform Bulk Inserts]\n+ [How to: Map JSON types to database types]\n+ [Using Transact-SQL to access tables]\n\n###<a name=\"overview-tables\"></a>Overview of working with tables\n\nMany scenarios in Mobile Services require server scripts to access tables in the database. For example. because Mobile Services does not preserve state between script executions, any data that needs to be persisted between script executions must be stored in tables. You might also want to examine entries in a permissions table or store audit data instead of just writing to the log, where data has a limited duration and cannot be accessed programmatically. \n\nMobile Services has two ways of accessing tables, either by using a [table object] proxy or by composing Transact-SQL queries using the [mssql object]. The [table object] makes it easy to access table data from your sever script code, but the [mssql object] supports more complex data operations and provides the most flexibility. \n\n###<a name=\"access-tables\"></a>How to: Access tables from scripts\n\nThe easiest way to access tables from your script is by using the [tables object]. The **getTable** function returns a [table object] instance that's a proxy for accessing the requested table. You can then call functions on the proxy to access and change data. \n\nScripts registered to both table operations and scheduled jobs can access the [tables object] as a global object. This line of code gets a proxy for the *TodoItems* table from the global [tables object]: \n\n        var todoItemsTable = tables.getTable('TodoItems');\n\nCustom API scripts can access the [tables object] from the <strong>service</strong> property of the supplied [request object]. This line of code gets [tables object] from the request:\n\n        var todoItemsTable = request.service.tables.getTable('TodoItem');\n\n> [AZURE.NOTE] Shared functions cannot access the **tables** object directly. In a shared function, you must pass the tables object to the function.\n\nOnce you have a [table object], you can call one or more table operation functions: insert, update, delete or read. This example reads user permissions from a permissions table:\n\n    function insert(item, user, request) {\n        var permissionsTable = tables.getTable('permissions');\n    \n        permissionsTable\n            .where({ userId: user.userId, permission: 'submit order'})\n            .read({ success: checkPermissions });\n            \n        function checkPermissions(results) {\n            if(results.length > 0) {\n                // Permission record was found. Continue normal execution.\n                request.execute();\n            } else {\n                console.log('User %s attempted to submit an order without permissions.', user.userId);\n                request.respond(statusCodes.FORBIDDEN, 'You do not have permission to submit orders.');\n            }\n        }\n    }\n\nThe next example writes auditing information to an **audit** table:\n\n    function update(item, user, request) {\n        request.execute({ success: insertAuditEntry });\n        \n        function insertAuditEntry() {\n            var auditTable = tables.getTable('audit');\n            var audit = {\n                record: 'checkins',\n                recordId: item.id,\n                timestamp: new Date(),\n                values: JSON.stringify(item)\n            };\n            auditTable.insert(audit, {\n                success: function() {\n                    // Write to the response now that all data operations are complete\n                    request.respond();\n                }\n            });\n        }\n    }\n\nA final example is in the code sample here: [How to: Access custom parameters][How to: Add custom parameters].\n\n###<a name=\"bulk-inserts\"></a>How to: Perform Bulk Inserts\n\nIf you use a **for** or **while** loop to directly insert a large number of items (1000, for example) into a  table , you may encounter a SQL connection limit that causes some of the inserts to fail. Your request may never complete or it may return a HTTP 500 Internal Server Error.  To avoid this problem, you can insert the items in batches of 10 or so. After the first batch is inserted, submit the next batch, and so on.\n\nBy using the following script, you can set the size of a batch of records to insert in parallel. We recomend that you keep the number of records small. The function **insertItems** calls itself recursively when an async insert batch has completed. The for loop at the end inserts one record at a time, and calls **insertComplete** on success and **errorHandler** on error. **insertComplete**  controls whether **insertItems** will be called recursively for the next batch, or whether the job is done and the script should exit.\n\n        var todoTable = tables.getTable('TodoItem');\n        var recordsToInsert = 1000;\n        var batchSize = 10; \n        var totalCount = 0;\n        var errorCount = 0; \n        \n        function insertItems() {        \n            var batchCompletedCount = 0;  \n        \n            var insertComplete = function() { \n                batchCompletedCount++; \n                totalCount++; \n                if(batchCompletedCount === batchSize || totalCount === recordsToInsert) {                        \n                    if(totalCount < recordsToInsert) {\n                        // kick off the next batch \n                        insertItems(); \n                    } else { \n                        // or we are done, report the status of the job \n                        // to the log and don't do any more processing \n                        console.log(\"Insert complete. %d Records processed. There were %d errors.\", totalCount, errorCount); \n                    } \n                } \n            }; \n        \n            var errorHandler = function(err) { \n                errorCount++; \n                console.warn(\"Ignoring insert failure as part of batch.\", err); \n                insertComplete(); \n            };\n        \n            for(var i = 0; i < batchSize; i++) { \n                var item = { text: \"This is item number: \" + totalCount + i }; \n                todoTable.insert(item, { \n                    success: insertComplete, \n                    error: errorHandler \n                }); \n            } \n        } \n        \n        insertItems(); \n\n\nThe entire code sample, and accompanying discussion, can be found in this [blog posting](http://blogs.msdn.com/b/jpsanders/archive/2013/03/20/server-script-to-insert-table-items-in-windows-azure-mobile-services.aspx). If you use this code, you can adapt it to your specific situation, and thoroughly test it.\n\n###<a name=\"JSON-types\"></a>How to: Map JSON types to database types\n\nThe collections of data types on the client and in a Mobile Services database table are different. Sometimes they map easily to one another, and other times they don't. Mobile Services performs a number of type transformations in the mapping:\n\n- The client language-specific types are serialized into JSON.\n- The JSON representation is translated into JavaScript before it appears in server scripts.\n- The JavaScript data types are converted to SQL database types when saved using the [tables object].\n\nThe transformation from client schema into JSON varies across platforms.  JSON.NET is used in Windows Store and Windows Phone clients. The Android client uses the gson library.  The iOS client uses the NSJSONSerialization class. The default serialization behavior of each of these libraries is used, except that date objects are converted to JSON strings that contain the date that's encoded by using ISO 8601.\n\nWhen you are writing server scripts that use [insert], [update], [read] or [delete] functions, you can access the JavaScript representation of your data. Mobile Services uses the Node.js's deserialization function ([JSON.parse](http://es5.github.io/#x15.12)) to transform JSON on the wire into JavaScript objects. However Mobile Services does  a transformation to extract **Date** objects from ISO 8601 strings.\n\nWhen you use the [tables object] or the [mssql object], or just let your table scripts execute, the deserialized JavaScript objects are inserted into your SQL database. In that process, object properties are mapped to T-SQL types:\n\nJavaScript property|T-SQL type\n---|---\nNumber|Float(53)\nBoolean|Bit\nDate|DateTimeOffset(3)|\nString|Nvarchar(max)\nBuffer|Not supported\nObject|Not supported\nArray|Not supported\nStream|Not supported\n\n###<a name=\"TSQL\"></a>Using Transact-SQL to access tables\n\nThe easiest way to work table data from server scripts is by using a [table object] proxy. However, there are more advanced scenarios that are not supported by the [table object], such as as join queries and other complex queries and invoking stored procedures. In these cases, you must execute Transact-SQL statements directly against the relational table by using the [mssql object]. This object provides the following functions:\n\n- **query**: executes a query, specified by a TSQL string; the results are returned to the **success** callback on the **options** object. The query can include parameters if the *params* parameter is present.\n- **queryRaw**: like *query* except that the result set returned from the query is in a \"raw\" format (see example below).\n- **open**: used to get a connection to your Mobile Services database, and you can then use the connection object to invoke database operations such as transactions.\n\nThese methods give you increasingly more low-level control over the query processing.\n\n+ [How to: Run a static query]\n+ [How to: Run a dynamic query]\n+ [How to: Join relational tables]\n+ [How to: Run a query that returns *raw* results]\n+ [How to: Get access to a database connection] \n\n####<a name=\"static-query\"></a>How to: Run a static query\n\nThe following query has no parameters and returns three records from the `statusupdate` table. The rowset is in standard JSON format.\n\n        mssql.query('select top 3 * from statusupdates', {\n            success: function(results) {\n                console.log(results);\n            },\n            error: function(err) {\n                console.log(\"error is: \" + err);\n            }\n        });\n\n\n####<a name=\"dynamic-query\"></a>How to: Run a dynamic parameterized query\n\nThe following example implements custom authorization by reading permissions for each user from the permissions table. The placeholder (?) is replaced with the supplied parameter when the query is executed.\n\n            var sql = \"SELECT _id FROM permissions WHERE userId = ? AND permission = 'submit order'\";\n            mssql.query(sql, [user.userId], {\n                success: function(results) {\n                    if (results.length > 0) {\n                        // Permission record was found. Continue normal execution. \n                        request.execute();\n                    } else {\n                        console.log('User %s attempted to submit an order without permissions.', user.userId);\n                        request.respond(statusCodes.FORBIDDEN, 'You do not have permission to submit orders.');\n                    }\n                },\n                error: function(err) {\n                    console.log(\"error is: \" + err);\n                }   \n            });\n\n\n####<a name=\"joins\"></a>How to: Join relational tables\n\nYou can join two tables by using the **query** method of the [mssql object] to pass in the TSQL code that implements the join. Let's assume we have some items in our **ToDoItem** table and each item in the table has a **priority** property, which corresponds to a column in the table. An item may look like this:\n\n        { text: 'Take out the trash', complete: false, priority: 1}\n\nLet's also assume we have an additional table called **Priority** with rows that contain a priority **number** and a text **description**. For example, the priority number 1 might have the description of \"Critical\", with the object looking as follows:\n\n        { number: 1, description: 'Critical'}\n\nWe can now replace the **priority** number in our item with the text description of the priority number. We do this with a relational join of the two tables.\n\n        mssql.query('SELECT t.text, t.complete, p.description FROM ToDoItem as t INNER JOIN Priority as p ON t.priority = p.number', {\n            success: function(results) {\n                console.log(results);\n            },\n            error: function(err) {\n                console.log(\"error is: \" + err);\n        });\n    \nThe script joins the two tables and writes the results to the log. The resulting objects could look like this:\n\n        { text: 'Take out the trash', complete: false, description: 'Critical'}\n\n\n####<a name=\"raw\"></a>How to: Run a query that returns *raw* results\n\nThis example executes the query, as before, but returns the resultset in \"raw\" format which requires you to parse it, row by row, and column by column. A possible scenario for this is if you need access to data types that Mobile Services does not support. This code simply writes the output to the console log so you can inspect the raw format.\n\n        mssql.queryRaw('SELECT * FROM ToDoItem', {\n            success: function(results) {\n                console.log(results);\n            },\n            error: function(err) {\n                console.log(\"error is: \" + err);\n            }\n        });\n\nHere is the output from running this query. It contains metadata about each column in the table, followed by a representation of the rows and columns.\n\n        { meta: \n           [ { name: 'id',\n               size: 19,\n               nullable: false,\n               type: 'number',\n               sqlType: 'bigint identity' },\n             { name: 'text',\n               size: 0,\n               nullable: true,\n               type: 'text',\n               sqlType: 'nvarchar' },\n             { name: 'complete',\n               size: 1,\n               nullable: true,\n               type: 'boolean',\n               sqlType: 'bit' },\n             { name: 'priority',\n               size: 53,\n               nullable: true,\n               type: 'number',\n               sqlType: 'float' } ],\n          rows: \n           [ [ 1, 'good idea for the future', null, 3 ],\n             [ 2, 'this is important but not so much', null, 2 ],\n             [ 3, 'fix this bug now', null, 0 ],\n             [ 4, 'we need to fix this one real soon now', null, 1 ],\n           ] }\n\n####<a name=\"connection\"></a>How to: Get access to a database connection\n\nYou can use the **open** method to get access to the database connection. One reason to do this might be if you need to use database transactions.\n\nSuccessful execution of the **open** causes the database connection to be passed into the **success** function as a parameter. You can invoke any of the following functions on the **connection** object: *close*, *queryRaw*, *query*, *beginTransaction*, *commit*, and *rollback*.\n\n            mssql.open({\n                success: function(connection) {\n                    connection.query(//query to execute);\n                },\n                error: function(err) {\n                    console.log(\"error is: \" + err);\n                }\n            });\n\n##<a name=\"debugging\"></a>Debugging and troubleshooting\n\nThe primary way to debug and troubleshoot your server scripts is by writing to the service log. By default, Mobile Services writes errors that occur during service script execution to the service logs. Your scripts can also write to the logs. Writing to logs is great way to debug your scripts and validate that they are behaving as desired.\n\n###<a name=\"write-to-logs\"></a>How to: Write output to the mobile service logs\n\nTo write to the logs, use the global [console object]. Use the **log** or **info** function to log information-level warnings. The **warning** and **error** functions log their respective levels, which are called-out in the logs. \n\n> [AZURE.NOTE] To view the logs for your mobile service, log on to the [Azure classic portal](https://manage.windowsazure.com/), select your mobile service, and then choose the **Logs** tab.\n\nYou can also use the logging functions of the [console object] to format your messages using parameters. The following example supplies a JSON object as a parameter to the message string:\n\n    function insert(item, user, request) {\n        console.log(\"Inserting item '%j' for user '%j'.\", item, user);  \n        request.execute();\n    }\n\nNotice that the string `%j` is used as the placeholder for a JSON object and that parameters are supplied in sequential order. \n\nTo avoid overloading your log, you should remove or disable calls to console.log() that aren't needed for production use.\n\n<!-- Anchors. -->\n[Introduction]: #intro\n[Table operations]: #table-scripts\n[Basic table operations]: #basic-table-ops\n[How to: Register for table operations]: #register-table-scripts\n[How to: Define table scripts]: #execute-operation\n[How to: override the default response]: #override-response\n[How to: Modify an operation]: #modify-operation\n[How to: Override success and error]: #override-success-error\n[How to: Override execute success]: #override-success\n[How to: Override default error handling]: #override-error\n[How to: Access tables from scripts]: #access-tables\n[How to: Add custom parameters]: #access-headers\n[How to: Work with users]: #work-with-users\n[How to: Define scheduled job scripts]: #scheduler-scripts\n[How to: Refine access to tables]: #authorize-tables\n[Using Transact-SQL to access tables]: #TSQL\n[How to: Run a static query]: #static-query\n[How to: Run a dynamic query]: #dynamic-query\n[How to: Run a query that returns *raw* results]: #raw\n[How to: Get access to a database connection]: #connection\n[How to: Join relational tables]: #joins\n[How to: Perform Bulk Inserts]: #bulk-inserts\n[How to: Map JSON types to database types]: #JSON-types\n[How to: Load Node.js modules]: #modules-helper-functions\n[How to: Write output to the mobile service logs]: #write-to-logs\n[Source control, shared code, and helper functions]: #shared-code\n[Using the command line tool]: #command-prompt\n[Working with tables]: #working-with-tables\n[Custom API anchor]: #custom-api\n[How to: Define a custom API]: #define-custom-api\n[How to: Share code by using source control]: #shared-code-source-control\n[How to: Use helper functions]: #helper-functions\n[Debugging and troubleshooting]: #debugging\n[How to: Implement HTTP methods]: #handle-methods\n[How to: Work with users and headers in a custom API]: #get-api-user\n[How to: Access custom API request headers]: #get-api-headers\n[Job Scheduler]: #scheduler-scripts\n[How to: Define multiple routes in a custom API]: #api-routes\n[How to: Send and receive data as XML]: #api-return-xml\n[How to: Work with app settings]: #app-settings\n\n[1]: ./media/mobile-services-how-to-use-server-scripts/1-mobile-insert-script-users.png\n[2]: ./media/mobile-services-how-to-use-server-scripts/2-mobile-custom-api-script.png\n[3]: ./media/mobile-services-how-to-use-server-scripts/3-mobile-schedule-job-script.png\n[4]: ./media/mobile-services-how-to-use-server-scripts/4-mobile-source-local-cli.png\n\n<!-- URLs. -->\n[Mobile Services server script reference]: http://msdn.microsoft.com/library/windowsazure/jj554226.aspx\n[Schedule backend jobs in Mobile Services]: /develop/mobile/tutorials/schedule-backend-tasks/\n[request object]: http://msdn.microsoft.com/library/windowsazure/jj554218.aspx\n[response object]: http://msdn.microsoft.com/library/windowsazure/dn303373.aspx\n[User object]: http://msdn.microsoft.com/library/windowsazure/jj554220.aspx\n[push object]: http://msdn.microsoft.com/library/windowsazure/jj554217.aspx\n[insert function]: http://msdn.microsoft.com/library/windowsazure/jj554229.aspx\n[insert]: http://msdn.microsoft.com/library/windowsazure/jj554229.aspx\n[update function]: http://msdn.microsoft.com/library/windowsazure/jj554214.aspx\n[delete function]: http://msdn.microsoft.com/library/windowsazure/jj554215.aspx\n[read function]: http://msdn.microsoft.com/library/windowsazure/jj554224.aspx\n[update]: http://msdn.microsoft.com/library/windowsazure/jj554214.aspx\n[delete]: http://msdn.microsoft.com/library/windowsazure/jj554215.aspx\n[read]: http://msdn.microsoft.com/library/windowsazure/jj554224.aspx\n[query object]: http://msdn.microsoft.com/library/windowsazure/jj613353.aspx\n[apns object]: http://msdn.microsoft.com/library/windowsazure/jj839711.aspx\n[mpns object]: http://msdn.microsoft.com/library/windowsazure/jj871025.aspx\n[wns object]: http://msdn.microsoft.com/library/windowsazure/jj860484.aspx\n[table object]: http://msdn.microsoft.com/library/windowsazure/jj554210.aspx\n[tables object]: http://msdn.microsoft.com/library/windowsazure/jj614364.aspx\n[mssql object]: http://msdn.microsoft.com/library/windowsazure/jj554212.aspx\n[console object]: http://msdn.microsoft.com/library/windowsazure/jj554209.aspx\n[Read and write data]: http://msdn.microsoft.com/library/windowsazure/jj631640.aspx\n[Validate data]: http://msdn.microsoft.com/library/windowsazure/jj631638.aspx\n[Modify the request]: http://msdn.microsoft.com/library/windowsazure/jj631635.aspx\n[Modify the response]: http://msdn.microsoft.com/library/windowsazure/jj631631.aspx\n[Azure classic portal]: https://manage.windowsazure.com/\n[Schedule jobs]: http://msdn.microsoft.com/library/windowsazure/jj860528.aspx\n[Validate and modify data in Mobile Services by using server scripts]: /develop/mobile/tutorials/validate-modify-and-augment-data-dotnet/\n[Commands to manage Azure Mobile Services]: ../virtual-machines-command-line-tools.md#Mobile_Scripts\n[Windows Store Push]: /develop/mobile/tutorials/get-started-with-push-dotnet/\n[Windows Phone Push]: /develop/mobile/tutorials/get-started-with-push-wp8/\n[iOS Push]: /develop/mobile/tutorials/get-started-with-push-ios/\n[Android Push]: /develop/mobile/tutorials/get-started-with-push-android/\n[Azure SDK for Node.js]: http://go.microsoft.com/fwlink/p/?LinkId=275539\n[Send HTTP request]: http://msdn.microsoft.com/library/windowsazure/jj631641.aspx\n[Send email from Mobile Services with SendGrid]: /develop/mobile/tutorials/send-email-with-sendgrid/\n[Get started with authentication]: http://go.microsoft.com/fwlink/p/?LinkId=287177\n[crypto API]: http://go.microsoft.com/fwlink/p/?LinkId=288802\n[path API]: http://go.microsoft.com/fwlink/p/?LinkId=288803\n[querystring API]: http://go.microsoft.com/fwlink/p/?LinkId=288804\n[url API]: http://go.microsoft.com/fwlink/p/?LinkId=288805\n[util API]: http://go.microsoft.com/fwlink/p/?LinkId=288806\n[zlib API]: http://go.microsoft.com/fwlink/p/?LinkId=288807\n[Custom API]: http://msdn.microsoft.com/library/windowsazure/dn280974.aspx\n[Call a custom API from the client]: /develop/mobile/tutorials/call-custom-api-dotnet/#define-custom-api\n[express.js library]: http://go.microsoft.com/fwlink/p/?LinkId=309046\n[Define a custom API that supports periodic notifications]: /develop/mobile/tutorials/create-pull-notifications-dotnet/\n[express object in express.js]: http://expressjs.com/api.html#express\n[Store server scripts in source control]: /develop/mobile/tutorials/store-scripts-in-source-control/\n[Leverage shared code and Node.js modules in your server scripts]: /develop/mobile/tutorials/store-scripts-in-source-control/#use-npm\n[service object]: http://msdn.microsoft.com/library/windowsazure/dn303371.aspx\n[App settings]: http://msdn.microsoft.com/library/dn529070.aspx\n[config module]: http://msdn.microsoft.com/library/dn508125.aspx\n[Support for package.json in Azure Mobile Services]: http://go.microsoft.com/fwlink/p/?LinkId=391036\n \n"
}