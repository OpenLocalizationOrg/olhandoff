{
  "nodes": [
    {
      "content": "Easy application installation and management in Azure Batch | Microsoft Azure",
      "pos": [
        27,
        104
      ]
    },
    {
      "content": "Use the application packages feature of Azure Batch to easily manage multiple applications and versions for installation on Batch compute nodes.",
      "pos": [
        123,
        267
      ]
    },
    {
      "content": "Application deployment with Azure Batch application packages",
      "pos": [
        572,
        632
      ]
    },
    {
      "content": "The application packages feature of Azure Batch provides easy management and deployment of applications to the compute nodes in your pool.",
      "pos": [
        634,
        772
      ]
    },
    {
      "content": "With application packages, you can upload and manage multiple versions of the applications run by your tasks, including binaries and supporting files, then automatically deploy one or more of these applications to the compute nodes in your pool.",
      "pos": [
        773,
        1018
      ]
    },
    {
      "pos": [
        1020,
        1206
      ],
      "content": "In this article, you will learn how to upload and manage application packages using the Azure portal, then install them on a pool's compute nodes using the <bpt id=\"p1\">[</bpt>Batch .NET<ph id=\"ph1\">][</ph>api_net<ept id=\"p1\">]</ept> library."
    },
    {
      "pos": [
        1210,
        1353
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The application packages feature described here supersedes the \"Batch Apps\" feature available in previous versions of the service."
    },
    {
      "content": "Application packages requirements",
      "pos": [
        1358,
        1391
      ]
    },
    {
      "content": "The application packages feature discussed in this article is compatible <bpt id=\"p1\">*</bpt>only<ept id=\"p1\">*</ept> with Batch pools created after 10 March 2016.",
      "pos": [
        1393,
        1518
      ]
    },
    {
      "content": "Application packages will not be deployed to compute nodes in pools created before this date.",
      "pos": [
        1519,
        1612
      ]
    },
    {
      "content": "This feature was introduced in <bpt id=\"p1\">[</bpt>Batch REST API<ph id=\"ph1\">][</ph>api_rest<ept id=\"p1\">]</ept> version 2015-12-01.2.2, and the corresponding <bpt id=\"p2\">[</bpt>Batch .NET<ph id=\"ph2\">][</ph>api_net<ept id=\"p2\">]</ept> library version 3.1.0.",
      "pos": [
        1614,
        1762
      ]
    },
    {
      "content": "We recommend that you always use the latest API version when working with Batch.",
      "pos": [
        1763,
        1843
      ]
    },
    {
      "content": "About applications and application packages",
      "pos": [
        1848,
        1891
      ]
    },
    {
      "content": "Within Azure Batch, an <bpt id=\"p1\">**</bpt>application<ept id=\"p1\">**</ept> refers to a set of versioned binaries that can be automatically downloaded to the compute nodes in your pool.",
      "pos": [
        1893,
        2041
      ]
    },
    {
      "content": "An <bpt id=\"p1\">**</bpt>application package<ept id=\"p1\">**</ept> refers to a <bpt id=\"p2\">*</bpt>specific set<ept id=\"p2\">*</ept> of those binaries, and represents a given <bpt id=\"p3\">*</bpt>version<ept id=\"p3\">*</ept> of the application.",
      "pos": [
        2042,
        2167
      ]
    },
    {
      "content": "High-level diagram of applications and application packages",
      "pos": [
        2171,
        2230
      ]
    },
    {
      "content": "Applications",
      "pos": [
        2240,
        2252
      ]
    },
    {
      "content": "An application in Batch contains one or more application packages.",
      "pos": [
        2254,
        2320
      ]
    },
    {
      "content": "It specifies configuration options for the application such as the default application package version to install on compute nodes, and whether its packages may be updated or deleted.",
      "pos": [
        2321,
        2504
      ]
    },
    {
      "content": "Application packages",
      "pos": [
        2510,
        2530
      ]
    },
    {
      "content": "An application package is a ZIP file containing the application binaries and supporting files required for execution by your tasks.",
      "pos": [
        2532,
        2663
      ]
    },
    {
      "content": "Each application package represents a specific version of the application.",
      "pos": [
        2664,
        2738
      ]
    },
    {
      "content": "When you create a pool in the Batch service, you can specify one or more of these applications and (optionally) a version, and those application packages will be downloaded automatically and extracted onto each node as it joins the pool.",
      "pos": [
        2739,
        2976
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> There are restrictions on the number of applications and application packages within a Batch account, as well as the maximum application package size.",
      "pos": [
        2980,
        3148
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Quotas and limits for the Azure Batch service<ept id=\"p1\">](batch-quota-limit.md)</ept> for details on these limits.",
      "pos": [
        3149,
        3251
      ]
    },
    {
      "content": "Benefits of application packages",
      "pos": [
        3257,
        3289
      ]
    },
    {
      "content": "Application packages can simplify the code in your Batch solution, as well as lower the overhead required in managing the applications your tasks run.",
      "pos": [
        3291,
        3441
      ]
    },
    {
      "content": "With application packages, your pool's start task doesn't have to specify a long list of individual resource files to install on the nodes.",
      "pos": [
        3443,
        3582
      ]
    },
    {
      "content": "You don't have to manually manage multiple versions of these files in Azure Storage, or on your nodes.",
      "pos": [
        3583,
        3685
      ]
    },
    {
      "content": "And, you don't need to worry about generating <bpt id=\"p1\">[</bpt>SAS URLs<ept id=\"p1\">](../storage/storage-dotnet-shared-access-signature-part-1.md)</ept> to provide access to the files in your Azure Storage account.",
      "pos": [
        3686,
        3865
      ]
    },
    {
      "content": "Batch handles the details of working with Azure Storage in the background to store and deploy application packages to compute nodes, so both your code and your management overhead can be simplified.",
      "pos": [
        3867,
        4065
      ]
    },
    {
      "content": "Upload and manage applications",
      "pos": [
        4070,
        4100
      ]
    },
    {
      "content": "Using the Azure portal, you can add, update, and delete application packages, and configure default versions for each application.",
      "pos": [
        4102,
        4232
      ]
    },
    {
      "content": "At this time, these operations are supported only in the Azure portal.",
      "pos": [
        4233,
        4303
      ]
    },
    {
      "content": "In the next few sections, we'll first cover associating a Storage account with your Batch account, then review the package management features available in the Azure portal.",
      "pos": [
        4305,
        4478
      ]
    },
    {
      "content": "After that, you'll learn how to deploy these packages to compute nodes using the <bpt id=\"p1\">[</bpt>Batch .NET<ph id=\"ph1\">][</ph>api_net<ept id=\"p1\">]</ept> library.",
      "pos": [
        4479,
        4590
      ]
    },
    {
      "content": "Link a Storage account",
      "pos": [
        4596,
        4618
      ]
    },
    {
      "content": "In order to use application packages, you must first link an Azure Storage account to your Batch account.",
      "pos": [
        4620,
        4725
      ]
    },
    {
      "content": "If you have not yet configured a Storage account for your Batch account, the Azure portal will display a warning the first time you click the <bpt id=\"p1\">*</bpt>Applications<ept id=\"p1\">*</ept> tile in the Batch account blade.",
      "pos": [
        4726,
        4915
      ]
    },
    {
      "content": "No storage account configured warning in Azure portal",
      "pos": [
        4919,
        4972
      ]
    },
    {
      "content": "The Batch service uses the associated Storage account for the storage and retrieval of application packages.",
      "pos": [
        4978,
        5086
      ]
    },
    {
      "content": "Once you've linked the two accounts, Batch can automatically deploy the packages stored in the linked Storage account to your compute nodes.",
      "pos": [
        5087,
        5227
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Storage account settings<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">*</bpt>Warning<ept id=\"p2\">*</ept> blade, then <bpt id=\"p3\">**</bpt>Storage Account<ept id=\"p3\">**</ept> on the <bpt id=\"p4\">*</bpt>Storage Account<ept id=\"p4\">*</ept> blade to link a storage account to your Batch account.",
      "pos": [
        5228,
        5391
      ]
    },
    {
      "content": "Choose storage account blade in Azure portal",
      "pos": [
        5395,
        5439
      ]
    },
    {
      "content": "We recommend that you create a storage account <bpt id=\"p1\">*</bpt>specifically<ept id=\"p1\">*</ept> for use with your Batch account, and select it here.",
      "pos": [
        5446,
        5560
      ]
    },
    {
      "content": "For details on creating a storage account, see \"Create a storage account\" in <bpt id=\"p1\">[</bpt>About Azure storage accounts<ept id=\"p1\">](../storage/storage-create-storage-account.md)</ept>.",
      "pos": [
        5561,
        5715
      ]
    },
    {
      "content": "Once you've created a Storage account, you may then link it to your Batch account using the <bpt id=\"p1\">*</bpt>Storage Account<ept id=\"p1\">*</ept> blade.",
      "pos": [
        5716,
        5832
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.WARNING]</ph> Because Batch stores your application packages using Azure Storage, you are <bpt id=\"p1\">[</bpt>charged as normal<ph id=\"ph2\">][</ph>storage_pricing<ept id=\"p1\">]</ept> for the block blob data.",
      "pos": [
        5836,
        5989
      ]
    },
    {
      "content": "Be sure to consider the size and number of your application packages, and periodically remove deprecated packages to minimize cost.",
      "pos": [
        5990,
        6121
      ]
    },
    {
      "content": "View current applications",
      "pos": [
        6127,
        6152
      ]
    },
    {
      "pos": [
        6154,
        6261
      ],
      "content": "To view the applications in your Batch account, click the <bpt id=\"p1\">**</bpt>Applications<ept id=\"p1\">**</ept> tile in the Batch account blade."
    },
    {
      "content": "Applications tile",
      "pos": [
        6265,
        6282
      ]
    },
    {
      "pos": [
        6288,
        6324
      ],
      "content": "This opens the <bpt id=\"p1\">*</bpt>Applications<ept id=\"p1\">*</ept> blade:"
    },
    {
      "content": "List applications",
      "pos": [
        6328,
        6345
      ]
    },
    {
      "pos": [
        6351,
        6465
      ],
      "content": "The <bpt id=\"p1\">*</bpt>Applications<ept id=\"p1\">*</ept> blade displays the ID of each application in your account, as well as the following properties:"
    },
    {
      "pos": [
        6469,
        6540
      ],
      "content": "<bpt id=\"p1\">**</bpt>Packages<ept id=\"p1\">**</ept> - The number of versions associated with this application."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Default version<ept id=\"p1\">**</ept> – If you do not specify a version when setting the application for a pool, this version will be installed.",
      "pos": [
        6543,
        6669
      ]
    },
    {
      "content": "This setting is optional.",
      "pos": [
        6670,
        6695
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Allow updates<ept id=\"p1\">**</ept> – If this is set to <bpt id=\"p2\">*</bpt>No<ept id=\"p2\">*</ept>, package updates and deletions are disabled for the application--only new application package versions can be added.",
      "pos": [
        6698,
        6857
      ]
    },
    {
      "content": "The default is <bpt id=\"p1\">*</bpt>Yes<ept id=\"p1\">*</ept>.",
      "pos": [
        6858,
        6879
      ]
    },
    {
      "content": "View application details",
      "pos": [
        6885,
        6909
      ]
    },
    {
      "pos": [
        6911,
        7014
      ],
      "content": "Clicking on an application in the <bpt id=\"p1\">*</bpt>Applications<ept id=\"p1\">*</ept> blade displays the details blade for that application."
    },
    {
      "content": "Application details",
      "pos": [
        7018,
        7037
      ]
    },
    {
      "content": "In the application details blade, you can configure the following settings for your application.",
      "pos": [
        7043,
        7139
      ]
    },
    {
      "pos": [
        7143,
        7284
      ],
      "content": "<bpt id=\"p1\">**</bpt>Allow updates<ept id=\"p1\">**</ept> - Specify whether its application packages can be updated or deleted (see \"Update or Delete an application package\" below)."
    },
    {
      "pos": [
        7287,
        7374
      ],
      "content": "<bpt id=\"p1\">**</bpt>Default version<ept id=\"p1\">**</ept> - Specify a default application package to deploy to compute nodes."
    },
    {
      "pos": [
        7377,
        7578
      ],
      "content": "<bpt id=\"p1\">**</bpt>Display name<ept id=\"p1\">**</ept> - This is a \"friendly\" name that your Batch solution can use when displaying information about the application, such as in the UI of a service you provide your customers through Batch."
    },
    {
      "content": "Add a new application",
      "pos": [
        7584,
        7605
      ]
    },
    {
      "content": "To create a new application, add an application package using a new, unique application id.",
      "pos": [
        7607,
        7698
      ]
    },
    {
      "content": "The first application package that you add using the new application id will also create the new application.",
      "pos": [
        7699,
        7808
      ]
    },
    {
      "pos": [
        7810,
        7888
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">*</bpt>Applications<ept id=\"p2\">*</ept> blade to open the <bpt id=\"p3\">*</bpt>New application<ept id=\"p3\">*</ept> blade."
    },
    {
      "content": "New application blade in Azure portal",
      "pos": [
        7892,
        7929
      ]
    },
    {
      "pos": [
        7935,
        8069
      ],
      "content": "The <bpt id=\"p1\">*</bpt>New application<ept id=\"p1\">*</ept> blade provides the following fields for specifying the settings of your new application and application package."
    },
    {
      "content": "Metadata",
      "pos": [
        8073,
        8081
      ]
    },
    {
      "content": "You can either supply the application metadata manually by entering values directly into the <bpt id=\"p1\">**</bpt>Application id<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Version<ept id=\"p2\">**</ept> text boxes, or you can upload a JSON file that contains this metadata.",
      "pos": [
        8085,
        8283
      ]
    },
    {
      "content": "To specify the application id and version manually, simply leave the <bpt id=\"p1\">**</bpt>Metadata<ept id=\"p1\">**</ept> drop-down selector on <bpt id=\"p2\">**</bpt>Enter metadata<ept id=\"p2\">**</ept> (the default), and manually enter the values into the <bpt id=\"p3\">**</bpt>Application id<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Version<ept id=\"p4\">**</ept> text boxes.",
      "pos": [
        8284,
        8507
      ]
    },
    {
      "pos": [
        8509,
        8661
      ],
      "content": "To specify a JSON-formatted metadata file containing the id and version for a package, select <bpt id=\"p1\">**</bpt>Upload metatdata file<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Metadata<ept id=\"p2\">**</ept> drop-down:"
    },
    {
      "content": "Upload metadata file drop-down selector",
      "pos": [
        8665,
        8704
      ]
    },
    {
      "content": "Then, click the folder icon next to the <bpt id=\"p1\">**</bpt>Metadata file<ept id=\"p1\">**</ept> text box that appears, and browse to the local file containing the JSON data.",
      "pos": [
        8710,
        8845
      ]
    },
    {
      "content": "In this example, the file <ph id=\"ph1\">`litware_1.1001.2b.json`</ph> has been selected for upload, and the <bpt id=\"p1\">**</bpt>Application id<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Version<ept id=\"p2\">**</ept> text boxes have been automatically populated with the information in the file:",
      "pos": [
        8846,
        9048
      ]
    },
    {
      "content": "Metadata file selection detail",
      "pos": [
        9052,
        9082
      ]
    },
    {
      "content": "Use the following JSON format to specify the application package metadata in a file:",
      "pos": [
        9089,
        9173
      ]
    },
    {
      "pos": [
        9238,
        9451
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you upload a JSON metadata file for the id and version, you do <bpt id=\"p1\">*</bpt>not<ept id=\"p1\">*</ept> also need to edit the \"Application id\" or \"Version\" text boxes--they are automatically populated with the data in the JSON file."
    },
    {
      "content": "Application id",
      "pos": [
        9455,
        9469
      ]
    },
    {
      "content": "This specifies the id of your new application, which is subject to the standard Azure Batch ID validation rules:",
      "pos": [
        9473,
        9585
      ]
    },
    {
      "content": "Can contain any combination of alphanumeric characters, including hyphens and underscores.",
      "pos": [
        9589,
        9679
      ]
    },
    {
      "content": "Cannot contain more than 64 characters.",
      "pos": [
        9682,
        9721
      ]
    },
    {
      "content": "Must be unique within the Batch account.",
      "pos": [
        9724,
        9764
      ]
    },
    {
      "content": "Case preserving, and case insensitive.",
      "pos": [
        9767,
        9805
      ]
    },
    {
      "content": "Version",
      "pos": [
        9809,
        9816
      ]
    },
    {
      "content": "Specifies the version of the application package you are uploading.",
      "pos": [
        9820,
        9887
      ]
    },
    {
      "content": "Version strings are subject to the following validation rules:",
      "pos": [
        9888,
        9950
      ]
    },
    {
      "content": "Can contain any combination of alphanumeric characters, including hyphens, underscores, and periods.",
      "pos": [
        9954,
        10054
      ]
    },
    {
      "content": "Cannot contain more than 64 characters.",
      "pos": [
        10057,
        10096
      ]
    },
    {
      "content": "Must be unique within the application.",
      "pos": [
        10099,
        10137
      ]
    },
    {
      "content": "Case preserving, and case insensitive.",
      "pos": [
        10140,
        10178
      ]
    },
    {
      "content": "Application package",
      "pos": [
        10182,
        10201
      ]
    },
    {
      "content": "This specifies the ZIP file containing the application binaries and any supporting files required to execute the application.",
      "pos": [
        10205,
        10330
      ]
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Select a file<ept id=\"p1\">**</ept> text box or the folder icon to browse to and select a ZIP file containing your application's files.",
      "pos": [
        10331,
        10458
      ]
    },
    {
      "content": "Once you've selected a file, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to begin the upload to Azure Storage.",
      "pos": [
        10460,
        10539
      ]
    },
    {
      "content": "When the upload operation completes, you will be notified and the blade will close.",
      "pos": [
        10540,
        10623
      ]
    },
    {
      "content": "Note that depending on the size of the file that you are uploading and the speed of your network connection, this operation may take some time.",
      "pos": [
        10624,
        10767
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.WARNING]</ph> Do not close the <bpt id=\"p1\">*</bpt>New application<ept id=\"p1\">*</ept> blade before the upload operation is complete.",
      "pos": [
        10771,
        10868
      ]
    },
    {
      "content": "Doing so will abort the upload process.",
      "pos": [
        10869,
        10908
      ]
    },
    {
      "content": "Add a new application package",
      "pos": [
        10914,
        10943
      ]
    },
    {
      "pos": [
        10945,
        11140
      ],
      "content": "To add a new application package version for an existing application, select an application in the <bpt id=\"p1\">*</bpt>Applications<ept id=\"p1\">*</ept> blade, click <bpt id=\"p2\">**</bpt>Packages<ept id=\"p2\">**</ept>, then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept> to display the <bpt id=\"p4\">*</bpt>Add package<ept id=\"p4\">*</ept> blade."
    },
    {
      "content": "Add application package blade in Azure portal",
      "pos": [
        11144,
        11189
      ]
    },
    {
      "content": "As you can see, the fields match those of the <bpt id=\"p1\">*</bpt>New application<ept id=\"p1\">*</ept> blade, except for the disabled \"Application id\" text box.",
      "pos": [
        11195,
        11316
      ]
    },
    {
      "content": "As above, specify the <bpt id=\"p1\">**</bpt>Version<ept id=\"p1\">**</ept> for your new package, browse to your <bpt id=\"p2\">**</bpt>Application package<ept id=\"p2\">**</ept> ZIP file, then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept> to upload the package.",
      "pos": [
        11317,
        11462
      ]
    },
    {
      "content": "Update or Delete an application package",
      "pos": [
        11468,
        11507
      ]
    },
    {
      "pos": [
        11509,
        11781
      ],
      "content": "To update or delete an existing application package, open the details blade for the application, click <bpt id=\"p1\">**</bpt>Packages<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">*</bpt>Packages<ept id=\"p2\">*</ept> blade, click the <bpt id=\"p3\">**</bpt>ellipsis<ept id=\"p3\">**</ept> in the row of the application package you wish to modify, and select the action you wish to perform."
    },
    {
      "content": "Update or delete package in Azure portal",
      "pos": [
        11785,
        11825
      ]
    },
    {
      "content": "Update",
      "pos": [
        11833,
        11839
      ]
    },
    {
      "content": "When you click <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>, the <bpt id=\"p2\">*</bpt>Update package<ept id=\"p2\">*</ept> blade is displayed.",
      "pos": [
        11843,
        11910
      ]
    },
    {
      "content": "This blade is similar to the <bpt id=\"p1\">*</bpt>New application package<ept id=\"p1\">*</ept> blade, however only the package selection field is enabled, allowing you to specify a new ZIP file to upload.",
      "pos": [
        11911,
        12075
      ]
    },
    {
      "content": "Update package blade in Azure portal",
      "pos": [
        12079,
        12115
      ]
    },
    {
      "content": "Delete",
      "pos": [
        12124,
        12130
      ]
    },
    {
      "content": "When you click <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept>, you are asked to confirm the deletion of the package version, and Batch deletes the package from Azure Storage.",
      "pos": [
        12134,
        12272
      ]
    },
    {
      "content": "If you delete the default version of an application, the default version setting is removed for the application.",
      "pos": [
        12273,
        12385
      ]
    },
    {
      "content": "Delete application",
      "pos": [
        12389,
        12407
      ]
    },
    {
      "content": "Install applications on compute nodes",
      "pos": [
        12418,
        12455
      ]
    },
    {
      "content": "Now that we've covered uploading and managing application packages using the Azure portal, we are ready to discuss actually deploying them to compute nodes and running them with Batch tasks.",
      "pos": [
        12457,
        12647
      ]
    },
    {
      "content": "To install an application package on the compute nodes in a pool, you specify one or more application package <bpt id=\"p1\">*</bpt>references<ept id=\"p1\">*</ept> for the pool.",
      "pos": [
        12649,
        12785
      ]
    },
    {
      "content": "In Batch .NET, you do so by adding one or more <bpt id=\"p1\">[</bpt>CloudPool<ph id=\"ph1\">][</ph>net_cloudpool<ept id=\"p1\">]</ept>.<bpt id=\"p2\">[</bpt>ApplicationPackageReferences<ph id=\"ph2\">][</ph>net_cloudpool_pkgref<ept id=\"p2\">]</ept> when you create the pool, or to an existing pool.",
      "pos": [
        12786,
        12962
      ]
    },
    {
      "pos": [
        12964,
        13093
      ],
      "content": "The <bpt id=\"p1\">[</bpt>ApplicationPackageReference<ph id=\"ph1\">][</ph>net_pkgref<ept id=\"p1\">]</ept> class specifies an application ID and version to install on a pool's compute nodes."
    },
    {
      "content": "Execute the installed applications",
      "pos": [
        13838,
        13872
      ]
    },
    {
      "content": "As each compute node joins a pool (or is rebooted or reimaged) the packages you've specified are downloaded and extracted to a named directory within <ph id=\"ph1\">`AZ_BATCH_ROOT_DIR`</ph> on the node.",
      "pos": [
        13874,
        14056
      ]
    },
    {
      "content": "Batch also creates an environment variable for your task command lines to use when calling the application binaries--this variable adheres to the following naming scheme:",
      "pos": [
        14057,
        14227
      ]
    },
    {
      "pos": [
        14267,
        14459
      ],
      "content": "For example, if you specify that version 2.7 of application <bpt id=\"p1\">*</bpt>blender<ept id=\"p1\">*</ept> be installed, your tasks can access its binaries by referencing the following environment variable in their command lines:"
    },
    {
      "content": "If your application specifies a default version, you can reference the environment variable without the version string suffix.",
      "pos": [
        14497,
        14623
      ]
    },
    {
      "content": "For example, if you had specified default version 2.7 for the <bpt id=\"p1\">*</bpt>blender<ept id=\"p1\">*</ept> application within the Azure portal, your tasks can reference the following environment variable:",
      "pos": [
        14624,
        14793
      ]
    },
    {
      "pos": [
        14827,
        14963
      ],
      "content": "The following code snippet shows how a task might be configured when a default version has been specified for the <bpt id=\"p1\">*</bpt>blender<ept id=\"p1\">*</ept> application."
    },
    {
      "pos": [
        15169,
        15329
      ],
      "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> See \"Environment settings for tasks\" in the <bpt id=\"p1\">[</bpt>Batch feature overview<ept id=\"p1\">](batch-api-basics.md)</ept> for more information on compute node environment settings."
    },
    {
      "content": "Update a pool's application packages",
      "pos": [
        15334,
        15370
      ]
    },
    {
      "content": "If an existing pool has already been configured with an application package, you can specify a new package for the pool.",
      "pos": [
        15372,
        15492
      ]
    },
    {
      "content": "All new nodes that join the pool will install the newly specified package, as will any existing node that is rebooted or reimaged.",
      "pos": [
        15493,
        15623
      ]
    },
    {
      "content": "Compute nodes that are already in the pool when you update the package references do not automatically install the new application package.",
      "pos": [
        15624,
        15763
      ]
    },
    {
      "content": "In this example, the existing pool has version 2.7 of the <bpt id=\"p1\">*</bpt>blender<ept id=\"p1\">*</ept> application configured as one of its <bpt id=\"p2\">[</bpt>CloudPool<ph id=\"ph1\">][</ph>net_cloudpool<ept id=\"p2\">]</ept>.<bpt id=\"p3\">[</bpt>ApplicationPackageReferences<ph id=\"ph2\">][</ph>net_cloudpool_pkgref<ept id=\"p3\">]</ept>.",
      "pos": [
        15765,
        15950
      ]
    },
    {
      "content": "To update the pool's nodes with version 2.76b, specify a new <bpt id=\"p1\">[</bpt>ApplicationPackageReference<ph id=\"ph1\">][</ph>net_pkgref<ept id=\"p1\">]</ept> with the new version, and commit the change.",
      "pos": [
        15951,
        16098
      ]
    },
    {
      "content": "Now that the new version has been configured, any <bpt id=\"p1\">*</bpt>new<ept id=\"p1\">*</ept> node joining the pool will have version 2.76b deployed to it.",
      "pos": [
        16442,
        16559
      ]
    },
    {
      "content": "To install 2.76b on the nodes that are <bpt id=\"p1\">*</bpt>already<ept id=\"p1\">*</ept> in the pool, reboot (or reimage) them.",
      "pos": [
        16560,
        16647
      ]
    },
    {
      "content": "Note that rebooted nodes will retain the files from previous package deployments.",
      "pos": [
        16648,
        16729
      ]
    },
    {
      "content": "List the applications in a Batch account",
      "pos": [
        16734,
        16774
      ]
    },
    {
      "pos": [
        16776,
        16956
      ],
      "content": "You can list the applications and their packages in a Batch account by using the <bpt id=\"p1\">[</bpt>ApplicationOperations<ph id=\"ph1\">][</ph>net_appops<ept id=\"p1\">]</ept>.<bpt id=\"p2\">[</bpt>ListApplicationSummaries<ph id=\"ph2\">][</ph>net_appops_listappsummaries<ept id=\"p2\">]</ept> method."
    },
    {
      "content": "Wrapping up",
      "pos": [
        17411,
        17422
      ]
    },
    {
      "content": "With application packages, you can more easily provide your customers with the ability to select the applications for their jobs, and specify the exact version to use, when processing jobs with your Batch-enabled service.",
      "pos": [
        17424,
        17645
      ]
    },
    {
      "content": "You might also provide the ability for your customers to upload and track their own applications in your service.",
      "pos": [
        17646,
        17759
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        17764,
        17774
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Batch REST API<ph id=\"ph1\">][</ph>api_rest<ept id=\"p1\">]</ept> also provides support for working with application packages.",
      "pos": [
        17778,
        17869
      ]
    },
    {
      "content": "For example, see the <bpt id=\"p1\">[</bpt>applicationPackageReferences<ph id=\"ph1\">][</ph>rest_add_pool_with_packages<ept id=\"p1\">]</ept> element in <bpt id=\"p2\">[</bpt>Add a pool to an account<ph id=\"ph2\">][</ph>rest_add_pool<ept id=\"p2\">]</ept> for specifying packages to install using the REST API.",
      "pos": [
        17870,
        18058
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Applications<ph id=\"ph1\">][</ph>rest_applications<ept id=\"p1\">]</ept> for details on obtaining application information using the Batch REST API.",
      "pos": [
        18059,
        18171
      ]
    },
    {
      "content": "Learn how to programmatically <bpt id=\"p1\">[</bpt>manage Azure Batch accounts and quotas with Batch Management .NET<ept id=\"p1\">](batch-management-dotnet.md)</ept>.",
      "pos": [
        18175,
        18301
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Batch Management .NET<ph id=\"ph1\">][</ph>api_net_mgmt<ept id=\"p1\">]</ept> library can enable account creation and deletion features for your Batch application or service.",
      "pos": [
        18302,
        18440
      ]
    },
    {
      "pos": [
        18442,
        18506
      ],
      "content": "<ph id=\"ph1\">[</ph>api_net<ph id=\"ph2\">]: http://msdn.microsoft.com/library/azure/mt348682.aspx</ph>"
    },
    {
      "pos": [
        18507,
        18577
      ],
      "content": "<ph id=\"ph1\">[</ph>api_net_mgmt<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/mt463120.aspx</ph>"
    },
    {
      "pos": [
        18578,
        18643
      ],
      "content": "<ph id=\"ph1\">[</ph>api_rest<ph id=\"ph2\">]: http://msdn.microsoft.com/library/azure/dn820158.aspx</ph>"
    },
    {
      "pos": [
        18644,
        18706
      ],
      "content": "<ph id=\"ph1\">[</ph>github_samples<ph id=\"ph2\">]: https://github.com/Azure/azure-batch-samples</ph>"
    },
    {
      "pos": [
        18707,
        18778
      ],
      "content": "<ph id=\"ph1\">[</ph>storage_pricing<ph id=\"ph2\">]: https://azure.microsoft.com/pricing/details/storage/</ph>"
    },
    {
      "pos": [
        18779,
        18882
      ],
      "content": "<ph id=\"ph1\">[</ph>net_appops<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.applicationoperations.aspx</ph>"
    },
    {
      "pos": [
        18883,
        19028
      ],
      "content": "<ph id=\"ph1\">[</ph>net_appops_listappsummaries<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.applicationoperations.listapplicationsummaries.aspx</ph>"
    },
    {
      "pos": [
        19029,
        19123
      ],
      "content": "<ph id=\"ph1\">[</ph>net_cloudpool<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.aspx</ph>"
    },
    {
      "pos": [
        19124,
        19254
      ],
      "content": "<ph id=\"ph1\">[</ph>net_cloudpool_pkgref<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.applicationpackagereferences.aspx</ph>"
    },
    {
      "pos": [
        19255,
        19364
      ],
      "content": "<ph id=\"ph1\">[</ph>net_pkgref<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.applicationpackagereference.aspx</ph>"
    },
    {
      "pos": [
        19365,
        19440
      ],
      "content": "<ph id=\"ph1\">[</ph>rest_applications<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/mt643945.aspx</ph>"
    },
    {
      "pos": [
        19441,
        19512
      ],
      "content": "<ph id=\"ph1\">[</ph>rest_add_pool<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/dn820174.aspx</ph>"
    },
    {
      "pos": [
        19513,
        19615
      ],
      "content": "<ph id=\"ph1\">[</ph>rest_add_pool_with_packages<ph id=\"ph2\">]: https://msdn.microsoft.com/library/azure/dn820174.aspx#bk_apkgreference</ph>"
    },
    {
      "pos": [
        19617,
        19713
      ],
      "content": "<ph id=\"ph1\">[</ph>1<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_01.png</ph><ph id=\"ph3\"> \"</ph>Application packages high-level diagram<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        19714,
        19804
      ],
      "content": "<ph id=\"ph1\">[</ph>2<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_02.png</ph><ph id=\"ph3\"> \"</ph>Applications tile in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        19805,
        19896
      ],
      "content": "<ph id=\"ph1\">[</ph>3<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_03.png</ph><ph id=\"ph3\"> \"</ph>Applications blade in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        19897,
        19995
      ],
      "content": "<ph id=\"ph1\">[</ph>4<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_04.png</ph><ph id=\"ph3\"> \"</ph>Application details blade in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        19996,
        20090
      ],
      "content": "<ph id=\"ph1\">[</ph>5<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_05.png</ph><ph id=\"ph3\"> \"</ph>New application blade in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20091,
        20187
      ],
      "content": "<ph id=\"ph1\">[</ph>6<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_06.png</ph><ph id=\"ph3\"> \"</ph>Upload metadata file drop-down selector<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20188,
        20296
      ],
      "content": "<ph id=\"ph1\">[</ph>7<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_07.png</ph><ph id=\"ph3\"> \"</ph>Update or delete packages drop-down in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20297,
        20399
      ],
      "content": "<ph id=\"ph1\">[</ph>8<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_08.png</ph><ph id=\"ph3\"> \"</ph>New application package blade in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20400,
        20488
      ],
      "content": "<ph id=\"ph1\">[</ph>9<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_09.png</ph><ph id=\"ph3\"> \"</ph>No linked Storage account alert<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20489,
        20591
      ],
      "content": "<ph id=\"ph1\">[</ph>10<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_10.png</ph><ph id=\"ph3\"> \"</ph>Choose storage account blade in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20592,
        20686
      ],
      "content": "<ph id=\"ph1\">[</ph>11<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_11.png</ph><ph id=\"ph3\"> \"</ph>Update package blade in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20687,
        20795
      ],
      "content": "<ph id=\"ph1\">[</ph>12<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_12.png</ph><ph id=\"ph3\"> \"</ph>Delete package confirmation dialog in Azure portal<ph id=\"ph4\">\"</ph>"
    },
    {
      "pos": [
        20796,
        20884
      ],
      "content": "<ph id=\"ph1\">[</ph>13<ph id=\"ph2\">]: ./media/batch-application-packages/app_pkg_13.png</ph><ph id=\"ph3\"> \"</ph>Metadata file selection detail<ph id=\"ph4\">\"</ph>"
    }
  ],
  "content": "<properties\n    pageTitle=\"Easy application installation and management in Azure Batch | Microsoft Azure\"\n    description=\"Use the application packages feature of Azure Batch to easily manage multiple applications and versions for installation on Batch compute nodes.\"\n    services=\"batch\"\n    documentationCenter=\".net\"\n    authors=\"mmacy\"\n    manager=\"timlt\"\n    editor=\"\" />\n\n<tags\n    ms.service=\"batch\"\n    ms.devlang=\"multiple\"\n    ms.topic=\"article\"\n    ms.tgt_pltfrm=\"vm-windows\"\n    ms.workload=\"big-compute\"\n    ms.date=\"03/14/2016\"\n    ms.author=\"marsma\" />\n\n# Application deployment with Azure Batch application packages\n\nThe application packages feature of Azure Batch provides easy management and deployment of applications to the compute nodes in your pool. With application packages, you can upload and manage multiple versions of the applications run by your tasks, including binaries and supporting files, then automatically deploy one or more of these applications to the compute nodes in your pool.\n\nIn this article, you will learn how to upload and manage application packages using the Azure portal, then install them on a pool's compute nodes using the [Batch .NET][api_net] library.\n\n> [AZURE.NOTE] The application packages feature described here supersedes the \"Batch Apps\" feature available in previous versions of the service.\n\n## Application packages requirements\n\nThe application packages feature discussed in this article is compatible *only* with Batch pools created after 10 March 2016. Application packages will not be deployed to compute nodes in pools created before this date.\n\nThis feature was introduced in [Batch REST API][api_rest] version 2015-12-01.2.2, and the corresponding [Batch .NET][api_net] library version 3.1.0. We recommend that you always use the latest API version when working with Batch.\n\n## About applications and application packages\n\nWithin Azure Batch, an **application** refers to a set of versioned binaries that can be automatically downloaded to the compute nodes in your pool. An **application package** refers to a *specific set* of those binaries, and represents a given *version* of the application.\n\n![High-level diagram of applications and application packages][1]\n\n### Applications\n\nAn application in Batch contains one or more application packages. It specifies configuration options for the application such as the default application package version to install on compute nodes, and whether its packages may be updated or deleted.\n\n### Application packages\n\nAn application package is a ZIP file containing the application binaries and supporting files required for execution by your tasks. Each application package represents a specific version of the application. When you create a pool in the Batch service, you can specify one or more of these applications and (optionally) a version, and those application packages will be downloaded automatically and extracted onto each node as it joins the pool.\n\n> [AZURE.IMPORTANT] There are restrictions on the number of applications and application packages within a Batch account, as well as the maximum application package size. See [Quotas and limits for the Azure Batch service](batch-quota-limit.md) for details on these limits.\n\n### Benefits of application packages\n\nApplication packages can simplify the code in your Batch solution, as well as lower the overhead required in managing the applications your tasks run.\n\nWith application packages, your pool's start task doesn't have to specify a long list of individual resource files to install on the nodes. You don't have to manually manage multiple versions of these files in Azure Storage, or on your nodes. And, you don't need to worry about generating [SAS URLs](../storage/storage-dotnet-shared-access-signature-part-1.md) to provide access to the files in your Azure Storage account.\n\nBatch handles the details of working with Azure Storage in the background to store and deploy application packages to compute nodes, so both your code and your management overhead can be simplified.\n\n## Upload and manage applications\n\nUsing the Azure portal, you can add, update, and delete application packages, and configure default versions for each application. At this time, these operations are supported only in the Azure portal.\n\nIn the next few sections, we'll first cover associating a Storage account with your Batch account, then review the package management features available in the Azure portal. After that, you'll learn how to deploy these packages to compute nodes using the [Batch .NET][api_net] library.\n\n### Link a Storage account\n\nIn order to use application packages, you must first link an Azure Storage account to your Batch account. If you have not yet configured a Storage account for your Batch account, the Azure portal will display a warning the first time you click the *Applications* tile in the Batch account blade.\n\n![No storage account configured warning in Azure portal][9]\n\nThe Batch service uses the associated Storage account for the storage and retrieval of application packages. Once you've linked the two accounts, Batch can automatically deploy the packages stored in the linked Storage account to your compute nodes. Click **Storage account settings** on the *Warning* blade, then **Storage Account** on the *Storage Account* blade to link a storage account to your Batch account.\n\n![Choose storage account blade in Azure portal][10]\n\nWe recommend that you create a storage account *specifically* for use with your Batch account, and select it here. For details on creating a storage account, see \"Create a storage account\" in [About Azure storage accounts](../storage/storage-create-storage-account.md). Once you've created a Storage account, you may then link it to your Batch account using the *Storage Account* blade.\n\n> [AZURE.WARNING] Because Batch stores your application packages using Azure Storage, you are [charged as normal][storage_pricing] for the block blob data. Be sure to consider the size and number of your application packages, and periodically remove deprecated packages to minimize cost.\n\n### View current applications\n\nTo view the applications in your Batch account, click the **Applications** tile in the Batch account blade.\n\n![Applications tile][2]\n\nThis opens the *Applications* blade:\n\n![List applications][3]\n\nThe *Applications* blade displays the ID of each application in your account, as well as the following properties:\n\n* **Packages** - The number of versions associated with this application.\n* **Default version** – If you do not specify a version when setting the application for a pool, this version will be installed. This setting is optional.\n* **Allow updates** – If this is set to *No*, package updates and deletions are disabled for the application--only new application package versions can be added. The default is *Yes*.\n\n### View application details\n\nClicking on an application in the *Applications* blade displays the details blade for that application.\n\n![Application details][4]\n\nIn the application details blade, you can configure the following settings for your application.\n\n* **Allow updates** - Specify whether its application packages can be updated or deleted (see \"Update or Delete an application package\" below).\n* **Default version** - Specify a default application package to deploy to compute nodes.\n* **Display name** - This is a \"friendly\" name that your Batch solution can use when displaying information about the application, such as in the UI of a service you provide your customers through Batch.\n\n### Add a new application\n\nTo create a new application, add an application package using a new, unique application id. The first application package that you add using the new application id will also create the new application.\n\nClick **Add** on the *Applications* blade to open the *New application* blade.\n\n![New application blade in Azure portal][5]\n\nThe *New application* blade provides the following fields for specifying the settings of your new application and application package.\n\n**Metadata**\n\nYou can either supply the application metadata manually by entering values directly into the **Application id** and **Version** text boxes, or you can upload a JSON file that contains this metadata. To specify the application id and version manually, simply leave the **Metadata** drop-down selector on **Enter metadata** (the default), and manually enter the values into the **Application id** and **Version** text boxes.\n\nTo specify a JSON-formatted metadata file containing the id and version for a package, select **Upload metatdata file** from the **Metadata** drop-down:\n\n![Upload metadata file drop-down selector][6]\n\nThen, click the folder icon next to the **Metadata file** text box that appears, and browse to the local file containing the JSON data. In this example, the file `litware_1.1001.2b.json` has been selected for upload, and the **Application id** and **Version** text boxes have been automatically populated with the information in the file:\n\n![Metadata file selection detail][13]\n\nUse the following JSON format to specify the application package metadata in a file:\n\n```\n{\n    \"id\": \"litware\",\n    \"version\": \"1.1001.2b\"\n}\n```\n\n> [AZURE.NOTE] If you upload a JSON metadata file for the id and version, you do *not* also need to edit the \"Application id\" or \"Version\" text boxes--they are automatically populated with the data in the JSON file.\n\n**Application id**\n\nThis specifies the id of your new application, which is subject to the standard Azure Batch ID validation rules:\n\n* Can contain any combination of alphanumeric characters, including hyphens and underscores.\n* Cannot contain more than 64 characters.\n* Must be unique within the Batch account.\n* Case preserving, and case insensitive.\n\n**Version**\n\nSpecifies the version of the application package you are uploading. Version strings are subject to the following validation rules:\n\n* Can contain any combination of alphanumeric characters, including hyphens, underscores, and periods.\n* Cannot contain more than 64 characters.\n* Must be unique within the application.\n* Case preserving, and case insensitive.\n\n**Application package**\n\nThis specifies the ZIP file containing the application binaries and any supporting files required to execute the application. Click the **Select a file** text box or the folder icon to browse to and select a ZIP file containing your application's files.\n\nOnce you've selected a file, click **OK** to begin the upload to Azure Storage. When the upload operation completes, you will be notified and the blade will close. Note that depending on the size of the file that you are uploading and the speed of your network connection, this operation may take some time.\n\n> [AZURE.WARNING] Do not close the *New application* blade before the upload operation is complete. Doing so will abort the upload process.\n\n### Add a new application package\n\nTo add a new application package version for an existing application, select an application in the *Applications* blade, click **Packages**, then click **Add** to display the *Add package* blade.\n\n![Add application package blade in Azure portal][8]\n\nAs you can see, the fields match those of the *New application* blade, except for the disabled \"Application id\" text box. As above, specify the **Version** for your new package, browse to your **Application package** ZIP file, then click **OK** to upload the package.\n\n### Update or Delete an application package\n\nTo update or delete an existing application package, open the details blade for the application, click **Packages** to display the *Packages* blade, click the **ellipsis** in the row of the application package you wish to modify, and select the action you wish to perform.\n\n![Update or delete package in Azure portal][7]\n\n**Update**\n\nWhen you click **Update**, the *Update package* blade is displayed. This blade is similar to the *New application package* blade, however only the package selection field is enabled, allowing you to specify a new ZIP file to upload.\n\n![Update package blade in Azure portal][11]\n\n**Delete**\n\nWhen you click **Delete**, you are asked to confirm the deletion of the package version, and Batch deletes the package from Azure Storage. If you delete the default version of an application, the default version setting is removed for the application.\n\n![Delete application ][12]\n\n## Install applications on compute nodes\n\nNow that we've covered uploading and managing application packages using the Azure portal, we are ready to discuss actually deploying them to compute nodes and running them with Batch tasks.\n\nTo install an application package on the compute nodes in a pool, you specify one or more application package *references* for the pool. In Batch .NET, you do so by adding one or more [CloudPool][net_cloudpool].[ApplicationPackageReferences][net_cloudpool_pkgref] when you create the pool, or to an existing pool.\n\nThe [ApplicationPackageReference][net_pkgref] class specifies an application ID and version to install on a pool's compute nodes.\n\n```csharp\n// Create the unbound CloudPool\nCloudPool myCloudPool =\n    batchClient.PoolOperations.CreatePool(\n        poolId: \"myPool\",\n        targetDedicated: \"1\",\n        virtualMachineSize: \"small\",\n        cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: \"4\"));\n\n// Specify the application and version to install on the compute nodes\nmyCloudPool.ApplicationPackageReferences = new List<ApplicationPackageReference>\n{\n    new ApplicationPackageReference {\n        ApplicationId = \"litware\",\n        Version = \"1.1001.2b\" }\n};\n\n// Commit the pool so that it's created in the Batch service. As the nodes join\n// the pool, the specified application package will be installed on each.\nawait myCloudPool.CommitAsync();\n```\n\n## Execute the installed applications\n\nAs each compute node joins a pool (or is rebooted or reimaged) the packages you've specified are downloaded and extracted to a named directory within `AZ_BATCH_ROOT_DIR` on the node. Batch also creates an environment variable for your task command lines to use when calling the application binaries--this variable adheres to the following naming scheme:\n\n`AZ_BATCH_APP_PACKAGE_appid#version`\n\nFor example, if you specify that version 2.7 of application *blender* be installed, your tasks can access its binaries by referencing the following environment variable in their command lines:\n\n`AZ_BATCH_APP_PACKAGE_BLENDER#2.7`\n\nIf your application specifies a default version, you can reference the environment variable without the version string suffix. For example, if you had specified default version 2.7 for the *blender* application within the Azure portal, your tasks can reference the following environment variable:\n\n`AZ_BATCH_APP_PACKAGE_BLENDER`\n\nThe following code snippet shows how a task might be configured when a default version has been specified for the *blender* application.\n\n```csharp\nstring taskId = \"blendertask01\";\nstring commandLine = @\"cmd /c %AZ_BATCH_APP_PACKAGE_BLENDER%\\blender.exe -my -command -args\";\nCloudTask blenderTask = new CloudTask(taskId, commandLine);\n```\n\n> [AZURE.TIP] See \"Environment settings for tasks\" in the [Batch feature overview](batch-api-basics.md) for more information on compute node environment settings.\n\n## Update a pool's application packages\n\nIf an existing pool has already been configured with an application package, you can specify a new package for the pool. All new nodes that join the pool will install the newly specified package, as will any existing node that is rebooted or reimaged. Compute nodes that are already in the pool when you update the package references do not automatically install the new application package.\n\nIn this example, the existing pool has version 2.7 of the *blender* application configured as one of its [CloudPool][net_cloudpool].[ApplicationPackageReferences][net_cloudpool_pkgref]. To update the pool's nodes with version 2.76b, specify a new [ApplicationPackageReference][net_pkgref] with the new version, and commit the change.\n\n```csharp\nstring newVersion = \"2.76b\";\nCloudPool boundPool = await batchClient.PoolOperations.GetPoolAsync(\"myPool\");\nboundPool.ApplicationPackageReferences = new List<ApplicationPackageReference>\n{\n    new ApplicationPackageReference {\n        ApplicationId = \"blender\",\n        Version = newVersion }\n};\nawait boundPool.CommitAsync();\n```\n\nNow that the new version has been configured, any *new* node joining the pool will have version 2.76b deployed to it. To install 2.76b on the nodes that are *already* in the pool, reboot (or reimage) them. Note that rebooted nodes will retain the files from previous package deployments.\n\n## List the applications in a Batch account\n\nYou can list the applications and their packages in a Batch account by using the [ApplicationOperations][net_appops].[ListApplicationSummaries][net_appops_listappsummaries] method.\n\n```csharp\n// List the applications and their application packages in the Batch account.\nList<ApplicationSummary> applications = await batchClient.ApplicationOperations.ListApplicationSummaries().ToListAsync();\nforeach (ApplicationSummary app in applications)\n{\n    Console.WriteLine(\"ID: {0} | Display Name: {1}\", app.Id, app.DisplayName);\n\n    foreach (string version in app.Versions)\n    {\n        Console.WriteLine(\"  {0}\", version);\n    }\n}\n```\n\n## Wrapping up\n\nWith application packages, you can more easily provide your customers with the ability to select the applications for their jobs, and specify the exact version to use, when processing jobs with your Batch-enabled service. You might also provide the ability for your customers to upload and track their own applications in your service.\n\n## Next steps\n\n* The [Batch REST API][api_rest] also provides support for working with application packages. For example, see the [applicationPackageReferences][rest_add_pool_with_packages] element in [Add a pool to an account][rest_add_pool] for specifying packages to install using the REST API. See [Applications][rest_applications] for details on obtaining application information using the Batch REST API.\n\n* Learn how to programmatically [manage Azure Batch accounts and quotas with Batch Management .NET](batch-management-dotnet.md). The [Batch Management .NET][api_net_mgmt] library can enable account creation and deletion features for your Batch application or service.\n\n[api_net]: http://msdn.microsoft.com/library/azure/mt348682.aspx\n[api_net_mgmt]: https://msdn.microsoft.com/library/azure/mt463120.aspx\n[api_rest]: http://msdn.microsoft.com/library/azure/dn820158.aspx\n[github_samples]: https://github.com/Azure/azure-batch-samples\n[storage_pricing]: https://azure.microsoft.com/pricing/details/storage/\n[net_appops]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.applicationoperations.aspx\n[net_appops_listappsummaries]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.applicationoperations.listapplicationsummaries.aspx\n[net_cloudpool]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.aspx\n[net_cloudpool_pkgref]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.applicationpackagereferences.aspx\n[net_pkgref]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.applicationpackagereference.aspx\n[rest_applications]: https://msdn.microsoft.com/library/azure/mt643945.aspx\n[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx\n[rest_add_pool_with_packages]: https://msdn.microsoft.com/library/azure/dn820174.aspx#bk_apkgreference\n\n[1]: ./media/batch-application-packages/app_pkg_01.png \"Application packages high-level diagram\"\n[2]: ./media/batch-application-packages/app_pkg_02.png \"Applications tile in Azure portal\"\n[3]: ./media/batch-application-packages/app_pkg_03.png \"Applications blade in Azure portal\"\n[4]: ./media/batch-application-packages/app_pkg_04.png \"Application details blade in Azure portal\"\n[5]: ./media/batch-application-packages/app_pkg_05.png \"New application blade in Azure portal\"\n[6]: ./media/batch-application-packages/app_pkg_06.png \"Upload metadata file drop-down selector\"\n[7]: ./media/batch-application-packages/app_pkg_07.png \"Update or delete packages drop-down in Azure portal\"\n[8]: ./media/batch-application-packages/app_pkg_08.png \"New application package blade in Azure portal\"\n[9]: ./media/batch-application-packages/app_pkg_09.png \"No linked Storage account alert\"\n[10]: ./media/batch-application-packages/app_pkg_10.png \"Choose storage account blade in Azure portal\"\n[11]: ./media/batch-application-packages/app_pkg_11.png \"Update package blade in Azure portal\"\n[12]: ./media/batch-application-packages/app_pkg_12.png \"Delete package confirmation dialog in Azure portal\"\n[13]: ./media/batch-application-packages/app_pkg_13.png \"Metadata file selection detail\""
}