{
  "nodes": [
    {
      "content": "Setting up a DSC web pull server",
      "pos": [
        2,
        34
      ]
    },
    {
      "content": "Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0",
      "pos": [
        38,
        96
      ]
    },
    {
      "content": "A DSC web pull server is a web service in IIS that uses an OData interface to make DSC configuration files available to target nodes when those nodes ask for them.",
      "pos": [
        98,
        261
      ]
    },
    {
      "content": "Requirements for using a pull server:",
      "pos": [
        263,
        300
      ]
    },
    {
      "content": "A server running:",
      "pos": [
        304,
        321
      ]
    },
    {
      "content": "WMF/PowerShell 4.0 or greater",
      "pos": [
        326,
        355
      ]
    },
    {
      "content": "IIS server role",
      "pos": [
        360,
        375
      ]
    },
    {
      "content": "DSC Service",
      "pos": [
        380,
        391
      ]
    },
    {
      "content": "Ideally, some means of generating a certificate, to secure credentials passed to the Local Configuration Manager (LCM) on target nodes",
      "pos": [
        394,
        528
      ]
    },
    {
      "content": "You can add the IIS server role and DSC Service with the Add Roles and Features wizard in Server Manager, or by using PowerShell.",
      "pos": [
        530,
        659
      ]
    },
    {
      "content": "The sample scripts included in this topic will handle both of these steps for you as well.",
      "pos": [
        660,
        750
      ]
    },
    {
      "content": "Using the xWebService resource",
      "pos": [
        755,
        785
      ]
    },
    {
      "content": "The easiest way to set up a web pull server is to use the xWebService resource, included in the xPSDesiredStateConfiguration module.",
      "pos": [
        786,
        918
      ]
    },
    {
      "content": "The following steps explain how to use the resource in a configuration that sets up the web service.",
      "pos": [
        919,
        1019
      ]
    },
    {
      "content": "Call the <bpt id=\"p1\">[</bpt>Install-Module<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/dn807162.aspx)</ept> cmdlet to install the <bpt id=\"p2\">**</bpt>xPSDesiredStateConfiguration<ept id=\"p2\">**</ept> module.",
      "pos": [
        1024,
        1171
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: <bpt id=\"p2\">**</bpt>Install-Module<ept id=\"p2\">**</ept> is included in the <bpt id=\"p3\">**</bpt>PowerShellGet<ept id=\"p3\">**</ept> module, which is included in PowerShell 5.0.",
      "pos": [
        1172,
        1282
      ]
    },
    {
      "content": "You can download the <bpt id=\"p1\">**</bpt>PowerShellGet<ept id=\"p1\">**</ept> module for PowerShell 3.0 and 4.0 at <bpt id=\"p2\">[</bpt>PackageManagement PowerShell Modules Preview<ept id=\"p2\">](https://www.microsoft.com/en-us/download/details.aspx?id=49186)</ept>.",
      "pos": [
        1283,
        1470
      ]
    },
    {
      "content": "Create a self-signed certificate with the subject <ph id=\"ph1\">`\"CN=PSDSCPullServerCert\"`</ph> in the <ph id=\"ph2\">`CERT:\\LocalMachine\\MY\\`</ph> store.",
      "pos": [
        1475,
        1590
      ]
    },
    {
      "content": "You can do this with the command <ph id=\"ph1\">`New-SelfSignedCertificate  -CertStoreLocation 'CERT:\\LocalMachine\\MY' -Subject 'CN=PSDSCPullServerCert'`</ph>.",
      "pos": [
        1591,
        1730
      ]
    },
    {
      "content": "In the PowerShell ISE, start (F5) the following configuration script (included in the unzipped files as Sample_xDscWebService.ps1).",
      "pos": [
        1734,
        1865
      ]
    },
    {
      "content": "This script sets up the pull server and a compliance server.",
      "pos": [
        1866,
        1926
      ]
    },
    {
      "pos": [
        2901,
        3033
      ],
      "content": "Run the configuration, passing the thumbprint of the self-signed certificate you created as the <bpt id=\"p1\">**</bpt>certificateThumbPrint<ept id=\"p1\">**</ept> parameter:"
    },
    {
      "content": "Registration Key",
      "pos": [
        3209,
        3225
      ]
    },
    {
      "content": "To allow client nodes to register with the server so that they can use configuration names instead of a configuration ID, a registration key (which is a GUID known to both the server and the client node) must be placed in a file named <ph id=\"ph1\">`RegistrationKeys.txt`</ph>.",
      "pos": [
        3226,
        3484
      ]
    },
    {
      "content": "By default, the pull server created by this example expects that file to be located in <ph id=\"ph1\">`C:\\Program Files\\WindowsPowerShell\\DscService`</ph>.",
      "pos": [
        3485,
        3620
      ]
    },
    {
      "content": "Create a text file with only one line consisting of the registration key and save it in that folder.",
      "pos": [
        3621,
        3721
      ]
    },
    {
      "pos": [
        3724,
        3788
      ],
      "content": "<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: Registration keys are not supported in PowerShell 4.0."
    },
    {
      "content": "Placing configurations and resources",
      "pos": [
        3794,
        3830
      ]
    },
    {
      "content": "After the pull server setup completes, there is a new folder under <ph id=\"ph1\">`$env:PROGRAMFILES\\WindowsPowerShell`</ph> named \"DscService\".",
      "pos": [
        3831,
        3955
      ]
    },
    {
      "content": "In that folder, there are two folders named \"Modules\" and \"Configuration\".",
      "pos": [
        3956,
        4030
      ]
    },
    {
      "content": "In the \"Modules\" folder, place any resources that are needed for configurations that nodes will pull from this server.",
      "pos": [
        4031,
        4149
      ]
    },
    {
      "content": "In the \"Configuration\" folder, place the configuration MOF files for any configurations that are to be pulled by nodes.",
      "pos": [
        4150,
        4269
      ]
    },
    {
      "content": "The names of the MOF files depend on the type of pull client.",
      "pos": [
        4270,
        4331
      ]
    },
    {
      "content": "The following topics describe setting up pull clients in detail:",
      "pos": [
        4332,
        4396
      ]
    },
    {
      "content": "Setting up a DSC pull client using a configuration ID",
      "pos": [
        4401,
        4454
      ]
    },
    {
      "content": "Setting up a DSC pull client using configuration names",
      "pos": [
        4482,
        4536
      ]
    },
    {
      "content": "Partial configurations",
      "pos": [
        4567,
        4589
      ]
    },
    {
      "content": "See also",
      "pos": [
        4614,
        4622
      ]
    },
    {
      "content": "Windows PowerShell Desired State Configuration Overview",
      "pos": [
        4626,
        4681
      ]
    },
    {
      "content": "Enacting configurations",
      "pos": [
        4699,
        4722
      ]
    },
    {
      "content": "How to retrieve node information from DSC pull server",
      "pos": [
        4754,
        4807
      ]
    }
  ],
  "content": "# Setting up a DSC web pull server\n\n> Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0\n\nA DSC web pull server is a web service in IIS that uses an OData interface to make DSC configuration files available to target nodes when those nodes ask for them.\n\nRequirements for using a pull server:\n\n* A server running:\n  - WMF/PowerShell 4.0 or greater\n  - IIS server role\n  - DSC Service\n* Ideally, some means of generating a certificate, to secure credentials passed to the Local Configuration Manager (LCM) on target nodes\n\nYou can add the IIS server role and DSC Service with the Add Roles and Features wizard in Server Manager, or by using PowerShell. The sample scripts included in this topic will handle both of these steps for you as well.\n\n## Using the xWebService resource\nThe easiest way to set up a web pull server is to use the xWebService resource, included in the xPSDesiredStateConfiguration module. The following steps explain how to use the resource in a configuration that sets up the web service.\n\n1. Call the [Install-Module](https://technet.microsoft.com/en-us/library/dn807162.aspx) cmdlet to install the **xPSDesiredStateConfiguration** module. **Note**: **Install-Module** is included in the **PowerShellGet** module, which is included in PowerShell 5.0. You can download the **PowerShellGet** module for PowerShell 3.0 and 4.0 at [PackageManagement PowerShell Modules Preview](https://www.microsoft.com/en-us/download/details.aspx?id=49186). \n1. Create a self-signed certificate with the subject `\"CN=PSDSCPullServerCert\"` in the `CERT:\\LocalMachine\\MY\\` store. You can do this with the command `New-SelfSignedCertificate  -CertStoreLocation 'CERT:\\LocalMachine\\MY' -Subject 'CN=PSDSCPullServerCert'`.\n1. In the PowerShell ISE, start (F5) the following configuration script (included in the unzipped files as Sample_xDscWebService.ps1). This script sets up the pull server and a compliance server.\n  \n```powershell\nConfiguration Sample_xDSCService\n{\n    param (\n    [ValidateNotNullOrEmpty()]\n    [String] $certificateThumbPrint\n    )\n    Import-DSCResource –ModuleName DSCServic\n    Node localhost\n    {\n        WindowsFeature DSCServiceFeature\n        {\n            Ensure = “Present”\n            Name = “DSC-Service”\n        }\n        \n        DSCService PSDSCPullServer\n        {\n            Ensure   = \"Present\"\n            Name     = “PSDSCPullServer”\n            Port     = 8080\n            PhysicalPath = \"$env:SystemDrive\\inetpub\\wwwroot\\PSDSCPullServer\"\n            EnableFirewallException = $true\n            CertificateThumbprint = $certificateThumbPrint\n            ModulePath = “$env:PROGRAMFILES\\WindowsPowerShell\\DscService\\Modules”\n            ConfigurationPath = “$env:PROGRAMFILES\\WindowsPowerShell\\DscService\\Configuration”\n            State = “Started”\n            DependsOn = “[WindowsFeature]DSCServiceFeature             \n        }\n    }\n}\n```\n\n1. Run the configuration, passing the thumbprint of the self-signed certificate you created as the **certificateThumbPrint** parameter:\n\n```powershell\nPS:\\>$myCert = Get-ChildItem CERT: | Where {$_.Subject -eq 'CN=PSDSCPullServerCert'}\nPS:\\>Sample_xDSCService -certificateThumbprint $myCert.Thumbprint \n```\n\n## Registration Key\nTo allow client nodes to register with the server so that they can use configuration names instead of a configuration ID, a registration key (which is a GUID known to both the server and the client node) must be placed in a file named `RegistrationKeys.txt`. By default, the pull server created by this example expects that file to be located in `C:\\Program Files\\WindowsPowerShell\\DscService`. Create a text file with only one line consisting of the registration key and save it in that folder.\n> **Note**: Registration keys are not supported in PowerShell 4.0. \n\n## Placing configurations and resources\nAfter the pull server setup completes, there is a new folder under `$env:PROGRAMFILES\\WindowsPowerShell` named \"DscService\". In that folder, there are two folders named \"Modules\" and \"Configuration\". In the \"Modules\" folder, place any resources that are needed for configurations that nodes will pull from this server. In the \"Configuration\" folder, place the configuration MOF files for any configurations that are to be pulled by nodes. The names of the MOF files depend on the type of pull client. The following topics describe setting up pull clients in detail:\n\n* [Setting up a DSC pull client using a configuration ID](pullClientConfigID.md)\n* [Setting up a DSC pull client using configuration names](pullClientConfigNames.md)\n* [Partial configurations](partialConfigs.md)\n\n## See also\n* [Windows PowerShell Desired State Configuration Overview](overview.md)\n* [Enacting configurations](enactingConfigurations.md)\n* [How to retrieve node information from DSC pull server](retrieveNodeInfo.md)"
}