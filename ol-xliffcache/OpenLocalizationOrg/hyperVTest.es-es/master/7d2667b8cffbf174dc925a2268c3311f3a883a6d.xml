{
  "nodes": [
    {
      "pos": [
        28,
        140
      ],
      "content": "Create a Spark cluster on HDInsight and use Spark SQL from Zeppelin and Jupyter for interactive analysis | Azure"
    },
    {
      "pos": [
        160,
        334
      ],
      "content": "Step-by-step instructions on how to quickly create an Apache Spark cluster in HDInsight and then use Spark SQL from Zeppelin and Jupyter notebooks to run interactive queries."
    },
    {
      "pos": [
        651,
        750
      ],
      "content": "Quick Start: create Apache Spark on HDInsight and run interactive queries using Spark SQL (Windows)"
    },
    {
      "pos": [
        838,
        961
      ],
      "content": "<bpt id=\"p1\">[</bpt>Create Apache Spark on HDInsight and run interactive queries using Spark SQL<ept id=\"p1\">](hdinsight-apache-spark-jupyter-spark-sql.md)</ept>"
    },
    {
      "pos": [
        963,
        1230
      ],
      "content": "Learn how to create an Apache Spark cluster in HDInsight using the Quick Create option and then use the web-based <bpt id=\"p2\">[</bpt>Zeppelin<ept id=\"p2\">](https://zeppelin.incubator.apache.org)</ept><ph id=\"ph3\"/> and <bpt id=\"p3\">[</bpt>Jupyter<ept id=\"p3\">](https://jupyter.org)</ept><ph id=\"ph4\"/> notebooks to run Spark SQL interactive queries on the Spark cluster."
    },
    {
      "pos": [
        1236,
        1526
      ],
      "content": "<ph id=\"ph5\">![</ph>Get started using Apache Spark in HDInsight<ph id=\"ph6\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.getstartedflow.png  \"Get started using Apache Spark in HDInsight tutorial. Steps illustrated: create a storage account; create a cluster; run Spark SQL statements\")</ph>"
    },
    {
      "pos": [
        1528,
        1546
      ],
      "content": "<bpt id=\"p4\">**</bpt>Prerequisites:<ept id=\"p4\">**</ept>"
    },
    {
      "pos": [
        1548,
        1748
      ],
      "content": "Before you begin this tutorial, you must have an Azure subscription. See <bpt id=\"p5\">[</bpt>Get Azure free trial<ept id=\"p5\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
      "nodes": [
        {
          "content": "Before you begin this tutorial, you must have an Azure subscription.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "See <bpt id=\"p5\">[</bpt>Get Azure free trial<ept id=\"p5\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
          "pos": [
            69,
            238
          ]
        }
      ]
    },
    {
      "pos": [
        1750,
        1752
      ],
      "content": "##"
    },
    {
      "pos": [
        1774,
        1805
      ],
      "content": "Create an Azure Storage account"
    },
    {
      "pos": [
        1807,
        2180
      ],
      "content": "When you create an HDInsight cluster in HDInsight, you specify an Azure Storage account. A specific Blob storage container from that account is designated as the default file system. By default, the HDInsight cluster is created in the same data center as the storage account you specify. For more information, see <bpt id=\"p6\">[</bpt>Use Azure Blob storage with HDInsight<ept id=\"p6\">][hdinsight-storage]</ept>.",
      "nodes": [
        {
          "content": "When you create an HDInsight cluster in HDInsight, you specify an Azure Storage account.",
          "pos": [
            0,
            88
          ]
        },
        {
          "content": "A specific Blob storage container from that account is designated as the default file system.",
          "pos": [
            89,
            182
          ]
        },
        {
          "content": "By default, the HDInsight cluster is created in the same data center as the storage account you specify.",
          "pos": [
            183,
            287
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p6\">[</bpt>Use Azure Blob storage with HDInsight<ept id=\"p6\">][hdinsight-storage]</ept>.",
          "pos": [
            288,
            411
          ]
        }
      ]
    },
    {
      "pos": [
        2183,
        2221
      ],
      "content": "<bpt id=\"p7\">**</bpt>To create an Azure Storage account<ept id=\"p7\">**</ept>"
    },
    {
      "pos": [
        2226,
        2281
      ],
      "content": "Sign in to the <bpt id=\"p8\">[</bpt>Azure Portal<ept id=\"p8\">][azure-management-portal]</ept>."
    },
    {
      "pos": [
        2285,
        2372
      ],
      "content": "Click <bpt id=\"p9\">**</bpt>NEW<ept id=\"p9\">**</ept><ph id=\"ph7\"/> in the lower-left corner and then enter the values as shown in the image."
    },
    {
      "pos": [
        2378,
        2645
      ],
      "content": "<ph id=\"ph8\">![</ph>Azure portal where you can use Quick Create to set up a new storage account<ph id=\"ph9\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.storageaccount.quickcreate.png \"Azure portal where you can use Quick Create to set up a new storage account\")</ph>"
    },
    {
      "pos": [
        2648,
        2751
      ],
      "content": "<ph id=\"ph10\">[AZURE.NOTE]</ph><ph id=\"ph11\"/>  Make sure you create the storage account in a location that is supported for the cluster."
    },
    {
      "pos": [
        2753,
        3092
      ],
      "content": "Select the new storage account from the list and click <bpt id=\"p10\">**</bpt>MANAGE ACCESS KEYS<ept id=\"p10\">**</ept><ph id=\"ph12\"/> at the bottom of the page. Make a note of the <bpt id=\"p11\">**</bpt>PRIMARY ACCESS KEY<ept id=\"p11\">**</ept><ph id=\"ph13\"/> (or the <bpt id=\"p12\">**</bpt>SECONDARY ACCESS KEY<ept id=\"p12\">**</ept>—either of the keys work).  You will need this later in the tutorial. For more information, see <bpt id=\"p13\">[</bpt>How to Create a Storage Account<ept id=\"p13\">][azure-create-storageaccount]</ept><ph id=\"ph14\"/> .",
      "nodes": [
        {
          "content": "Select the new storage account from the list and click <bpt id=\"p10\">**</bpt>MANAGE ACCESS KEYS<ept id=\"p10\">**</ept><ph id=\"ph12\"/> at the bottom of the page.",
          "pos": [
            0,
            159
          ]
        },
        {
          "content": "Make a note of the <bpt id=\"p11\">**</bpt>PRIMARY ACCESS KEY<ept id=\"p11\">**</ept><ph id=\"ph13\"/> (or the <bpt id=\"p12\">**</bpt>SECONDARY ACCESS KEY<ept id=\"p12\">**</ept>—either of the keys work).",
          "pos": [
            160,
            355
          ]
        },
        {
          "content": "You will need this later in the tutorial.",
          "pos": [
            357,
            398
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p13\">[</bpt>How to Create a Storage Account<ept id=\"p13\">][azure-create-storageaccount]</ept><ph id=\"ph14\"/> .",
          "pos": [
            399,
            544
          ]
        }
      ]
    },
    {
      "pos": [
        3100,
        3133
      ],
      "content": "Create an HDInsight Spark cluster"
    },
    {
      "pos": [
        3135,
        3365
      ],
      "content": "In this section, you create an HDInsight version 3.2 cluster, which is based on Spark version 1.3.1. For information about HDInsight versions and their SLAs, see <bpt id=\"p14\">[</bpt>HDInsight component versioning<ept id=\"p14\">](hdinsight-component-versioning.md)</ept>.",
      "nodes": [
        {
          "content": "In this section, you create an HDInsight version 3.2 cluster, which is based on Spark version 1.3.1.",
          "pos": [
            0,
            100
          ]
        },
        {
          "content": "For information about HDInsight versions and their SLAs, see <bpt id=\"p14\">[</bpt>HDInsight component versioning<ept id=\"p14\">](hdinsight-component-versioning.md)</ept>.",
          "pos": [
            101,
            270
          ]
        }
      ]
    },
    {
      "pos": [
        3368,
        3732
      ],
      "content": "<ph id=\"ph15\">[AZURE.NOTE]</ph><ph id=\"ph16\"/> The steps in this article create an Apache Spark cluster in HDInsight by using basic configuration settings. For information about other cluster configuration settings (such as using additional storage, Azure virtual network, or a metastore for Hive), see <bpt id=\"p15\">[</bpt>Create HDInsight clusters using custom options<ept id=\"p15\">](hdinsight-apache-spark-provision-clusters.md)</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph15\">[AZURE.NOTE]</ph><ph id=\"ph16\"/> The steps in this article create an Apache Spark cluster in HDInsight by using basic configuration settings.",
          "pos": [
            0,
            155
          ]
        },
        {
          "content": "For information about other cluster configuration settings (such as using additional storage, Azure virtual network, or a metastore for Hive), see <bpt id=\"p15\">[</bpt>Create HDInsight clusters using custom options<ept id=\"p15\">](hdinsight-apache-spark-provision-clusters.md)</ept>.",
          "pos": [
            156,
            438
          ]
        }
      ]
    },
    {
      "pos": [
        3735,
        3764
      ],
      "content": "<bpt id=\"p16\">**</bpt>To create a Spark cluster<ept id=\"p16\">**</ept>"
    },
    {
      "pos": [
        3770,
        3825
      ],
      "content": "Sign in to the <bpt id=\"p17\">[</bpt>Azure Portal<ept id=\"p17\">][azure-management-portal]</ept>."
    },
    {
      "pos": [
        3831,
        3918
      ],
      "content": "Click <bpt id=\"p18\">**</bpt>NEW<ept id=\"p18\">**</ept><ph id=\"ph17\"/> in the lower-left corner and then enter the values as shown in the image."
    },
    {
      "pos": [
        3924,
        4103
      ],
      "content": "<ph id=\"ph18\">![</ph>Create a Spark cluster in HDInsight<ph id=\"ph19\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.quickcreatecluster.png \"Create a Spark cluster in HDInsight\")</ph>"
    },
    {
      "pos": [
        4106,
        4108
      ],
      "content": "##"
    },
    {
      "pos": [
        4131,
        4190
      ],
      "content": "Run interactive Spark SQL queries using a Zeppelin notebook"
    },
    {
      "pos": [
        4192,
        4479
      ],
      "content": "After you have created a cluster, you can use a web-based Zeppelin notebook to run Spark SQL interactive queries against the Spark HDInsight cluster. In this section, we will use a sample data file (hvac.csv) available by default on the cluster to run some interactive Spark SQL queries.",
      "nodes": [
        {
          "content": "After you have created a cluster, you can use a web-based Zeppelin notebook to run Spark SQL interactive queries against the Spark HDInsight cluster.",
          "pos": [
            0,
            149
          ]
        },
        {
          "content": "In this section, we will use a sample data file (hvac.csv) available by default on the cluster to run some interactive Spark SQL queries.",
          "pos": [
            150,
            287
          ]
        }
      ]
    },
    {
      "pos": [
        4482,
        4698
      ],
      "content": "<ph id=\"ph20\">[AZURE.NOTE]</ph><ph id=\"ph21\"/> The notebook you create following the instructions below is also available by default on the cluster. After you have launched Zeppelin, you will find this notebook by the name <bpt id=\"p19\">**</bpt>Zeppelin HVAC tutorial<ept id=\"p19\">**</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph20\">[AZURE.NOTE]</ph><ph id=\"ph21\"/> The notebook you create following the instructions below is also available by default on the cluster.",
          "pos": [
            0,
            148
          ]
        },
        {
          "content": "After you have launched Zeppelin, you will find this notebook by the name <bpt id=\"p19\">**</bpt>Zeppelin HVAC tutorial<ept id=\"p19\">**</ept>.",
          "pos": [
            149,
            290
          ]
        }
      ]
    },
    {
      "pos": [
        4703,
        4967
      ],
      "content": "From the <bpt id=\"p20\">[</bpt>Azure Portal<ept id=\"p20\">][azure-management-portal]</ept><ph id=\"ph22\"/> left pane, click <bpt id=\"p21\">**</bpt>HDInsight<ept id=\"p21\">**</ept>, and then click the Spark cluster you created. From the Spark cluster page, from the bottom pane, click <bpt id=\"p22\">**</bpt>Zeppelin Notebook<ept id=\"p22\">**</ept>. If prompted, enter the admin credentials for the cluster.",
      "nodes": [
        {
          "content": "From the <bpt id=\"p20\">[</bpt>Azure Portal<ept id=\"p20\">][azure-management-portal]</ept><ph id=\"ph22\"/> left pane, click <bpt id=\"p21\">**</bpt>HDInsight<ept id=\"p21\">**</ept>, and then click the Spark cluster you created.",
          "pos": [
            0,
            221
          ]
        },
        {
          "content": "From the Spark cluster page, from the bottom pane, click <bpt id=\"p22\">**</bpt>Zeppelin Notebook<ept id=\"p22\">**</ept>.",
          "pos": [
            222,
            341
          ]
        },
        {
          "content": "If prompted, enter the admin credentials for the cluster.",
          "pos": [
            342,
            399
          ]
        }
      ]
    },
    {
      "pos": [
        4975,
        5146
      ],
      "content": "<ph id=\"ph23\">[AZURE.NOTE]</ph><ph id=\"ph24\"/> You may also reach the Zeppelin Notebook for your cluster by opening the following URL in your browser. Replace <bpt id=\"p23\">__</bpt>CLUSTERNAME<ept id=\"p23\">__</ept><ph id=\"ph25\"/> with the name of your cluster:",
      "nodes": [
        {
          "content": "<ph id=\"ph23\">[AZURE.NOTE]</ph><ph id=\"ph24\"/> You may also reach the Zeppelin Notebook for your cluster by opening the following URL in your browser.",
          "pos": [
            0,
            150
          ]
        },
        {
          "content": "Replace <bpt id=\"p23\">__</bpt>CLUSTERNAME<ept id=\"p23\">__</ept><ph id=\"ph25\"/> with the name of your cluster:",
          "pos": [
            151,
            260
          ]
        }
      ]
    },
    {
      "pos": [
        5213,
        5313
      ],
      "content": "Create a new notebook. From the header pane, click <bpt id=\"p24\">**</bpt>Notebook<ept id=\"p24\">**</ept>, and then click <bpt id=\"p25\">**</bpt>Create New Note<ept id=\"p25\">**</ept>.",
      "nodes": [
        {
          "content": "Create a new notebook.",
          "pos": [
            0,
            22
          ]
        },
        {
          "content": "From the header pane, click <bpt id=\"p24\">**</bpt>Notebook<ept id=\"p24\">**</ept>, and then click <bpt id=\"p25\">**</bpt>Create New Note<ept id=\"p25\">**</ept>.",
          "pos": [
            23,
            180
          ]
        }
      ]
    },
    {
      "pos": [
        5319,
        5483
      ],
      "content": "<ph id=\"ph27\">![</ph>Create a new Zeppelin notebook<ph id=\"ph28\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.createnewnote.png \"Create a new Zeppelin notebook\")</ph>"
    },
    {
      "pos": [
        5489,
        5640
      ],
      "content": "On the same page, under the <bpt id=\"p26\">**</bpt>Notebook<ept id=\"p26\">**</ept><ph id=\"ph29\"/> heading, you should see a new notebook with the name starting with <bpt id=\"p27\">**</bpt>Note XXXXXXXXX<ept id=\"p27\">**</ept>. Click the new notebook.",
      "nodes": [
        {
          "content": "On the same page, under the <bpt id=\"p26\">**</bpt>Notebook<ept id=\"p26\">**</ept><ph id=\"ph29\"/> heading, you should see a new notebook with the name starting with <bpt id=\"p27\">**</bpt>Note XXXXXXXXX<ept id=\"p27\">**</ept>.",
          "pos": [
            0,
            222
          ]
        },
        {
          "content": "Click the new notebook.",
          "pos": [
            223,
            246
          ]
        }
      ]
    },
    {
      "pos": [
        5645,
        5880
      ],
      "content": "On the web page for the new notebook, click the heading, and change the name of the notebook if you want to. Press ENTER to save the name change. Also, make sure the notebook header shows a <bpt id=\"p28\">**</bpt>Connected<ept id=\"p28\">**</ept><ph id=\"ph30\"/> status in the top-right corner.",
      "nodes": [
        {
          "content": "On the web page for the new notebook, click the heading, and change the name of the notebook if you want to.",
          "pos": [
            0,
            108
          ]
        },
        {
          "content": "Press ENTER to save the name change.",
          "pos": [
            109,
            145
          ]
        },
        {
          "content": "Also, make sure the notebook header shows a <bpt id=\"p28\">**</bpt>Connected<ept id=\"p28\">**</ept><ph id=\"ph30\"/> status in the top-right corner.",
          "pos": [
            146,
            290
          ]
        }
      ]
    },
    {
      "pos": [
        5886,
        6042
      ],
      "content": "<ph id=\"ph31\">![</ph>Zeppelin notebook status<ph id=\"ph32\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.newnote.connected.png \"Zeppelin notebook status\")</ph>"
    },
    {
      "pos": [
        6047,
        6258
      ],
      "content": "Load sample data into a temporary table. When you create a Spark cluster in HDInsight, the sample data file, <bpt id=\"p29\">**</bpt>hvac.csv<ept id=\"p29\">**</ept>, is copied to the associated storage account under <bpt id=\"p30\">**</bpt>\\HdiSamples\\SensorSampleData\\hvac<ept id=\"p30\">**</ept>.",
      "nodes": [
        {
          "content": "Load sample data into a temporary table.",
          "pos": [
            0,
            40
          ]
        },
        {
          "content": "When you create a Spark cluster in HDInsight, the sample data file, <bpt id=\"p29\">**</bpt>hvac.csv<ept id=\"p29\">**</ept>, is copied to the associated storage account under <bpt id=\"p30\">**</bpt>\\HdiSamples\\SensorSampleData\\hvac<ept id=\"p30\">**</ept>.",
          "pos": [
            41,
            291
          ]
        }
      ]
    },
    {
      "pos": [
        6264,
        6363
      ],
      "content": "In the empty paragraph that is created by default in the new notebook, paste the following snippet."
    },
    {
      "pos": [
        7105,
        7399
      ],
      "content": "Press <bpt id=\"p31\">**</bpt>SHIFT + ENTER<ept id=\"p31\">**</ept><ph id=\"ph33\"/> or click the <bpt id=\"p32\">**</bpt>Play<ept id=\"p32\">**</ept><ph id=\"ph34\"/> button for the paragraph to run the snippet. The status on the right-corner of the paragraph should progress from READY, PENDING, RUNNING to FINISHED. The output shows up at the bottom of the same paragraph. The screenshot looks like the following:",
      "nodes": [
        {
          "content": "Press <bpt id=\"p31\">**</bpt>SHIFT + ENTER<ept id=\"p31\">**</ept><ph id=\"ph33\"/> or click the <bpt id=\"p32\">**</bpt>Play<ept id=\"p32\">**</ept><ph id=\"ph34\"/> button for the paragraph to run the snippet.",
          "pos": [
            0,
            200
          ]
        },
        {
          "content": "The status on the right-corner of the paragraph should progress from READY, PENDING, RUNNING to FINISHED.",
          "pos": [
            201,
            306
          ]
        },
        {
          "content": "The output shows up at the bottom of the same paragraph.",
          "pos": [
            307,
            363
          ]
        },
        {
          "content": "The screenshot looks like the following:",
          "pos": [
            364,
            404
          ]
        }
      ]
    },
    {
      "pos": [
        7405,
        7594
      ],
      "content": "<ph id=\"ph35\">![</ph>Create a temporary table from raw data<ph id=\"ph36\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.loaddataintotable.png \"Create a temporary table from raw data\")</ph>"
    },
    {
      "pos": [
        7600,
        7735
      ],
      "content": "You can also provide a title to each paragraph. From the right-hand corner, click the <bpt id=\"p33\">**</bpt>Settings<ept id=\"p33\">**</ept><ph id=\"ph37\"/> icon, and then click <bpt id=\"p34\">**</bpt>Show title<ept id=\"p34\">**</ept>.",
      "nodes": [
        {
          "content": "You can also provide a title to each paragraph.",
          "pos": [
            0,
            47
          ]
        },
        {
          "content": "From the right-hand corner, click the <bpt id=\"p33\">**</bpt>Settings<ept id=\"p33\">**</ept><ph id=\"ph37\"/> icon, and then click <bpt id=\"p34\">**</bpt>Show title<ept id=\"p34\">**</ept>.",
          "pos": [
            48,
            230
          ]
        }
      ]
    },
    {
      "pos": [
        7740,
        8003
      ],
      "content": "You can now run Spark SQL statements on the <bpt id=\"p35\">**</bpt>hvac<ept id=\"p35\">**</ept><ph id=\"ph38\"/> table. Paste the following query in a new paragraph. The query retrieves the building ID and the difference between the target and actual temperatures for each building on a given date. Press <bpt id=\"p36\">**</bpt>SHIFT + ENTER<ept id=\"p36\">**</ept>.",
      "nodes": [
        {
          "content": "You can now run Spark SQL statements on the <bpt id=\"p35\">**</bpt>hvac<ept id=\"p35\">**</ept><ph id=\"ph38\"/> table.",
          "pos": [
            0,
            114
          ]
        },
        {
          "content": "Paste the following query in a new paragraph.",
          "pos": [
            115,
            160
          ]
        },
        {
          "content": "The query retrieves the building ID and the difference between the target and actual temperatures for each building on a given date.",
          "pos": [
            161,
            293
          ]
        },
        {
          "content": "Press <bpt id=\"p36\">**</bpt>SHIFT + ENTER<ept id=\"p36\">**</ept>.",
          "pos": [
            294,
            358
          ]
        }
      ]
    },
    {
      "pos": [
        8145,
        8332
      ],
      "content": "The <bpt id=\"p37\">**</bpt>%sql<ept id=\"p37\">**</ept><ph id=\"ph39\"/> statement at the beginning tells the notebook to use the Spark  SQL interpreter. You can look at the defined interpreters from the <bpt id=\"p38\">**</bpt>Interpreter<ept id=\"p38\">**</ept><ph id=\"ph40\"/> tab in the notebook header.",
      "nodes": [
        {
          "content": "The <bpt id=\"p37\">**</bpt>%sql<ept id=\"p37\">**</ept><ph id=\"ph39\"/> statement at the beginning tells the notebook to use the Spark  SQL interpreter.",
          "pos": [
            0,
            148
          ]
        },
        {
          "content": "You can look at the defined interpreters from the <bpt id=\"p38\">**</bpt>Interpreter<ept id=\"p38\">**</ept><ph id=\"ph40\"/> tab in the notebook header.",
          "pos": [
            149,
            297
          ]
        }
      ]
    },
    {
      "pos": [
        8338,
        8380
      ],
      "content": "The following screenshot shows the output."
    },
    {
      "pos": [
        8386,
        8584
      ],
      "content": "<ph id=\"ph41\">![</ph>Run a Spark SQL statement using the notebook<ph id=\"ph42\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.sparksqlquery1.png \"Run a Spark SQL statement using the notebook\")</ph>"
    },
    {
      "pos": [
        8591,
        8890
      ],
      "content": "Click the display options (highlighted in rectangle) to switch between different representations for the same output. Click <bpt id=\"p39\">**</bpt>Settings<ept id=\"p39\">**</ept><ph id=\"ph43\"/> to choose what consitutes the key and values in the output. The screen capture above uses <bpt id=\"p40\">**</bpt>buildingID<ept id=\"p40\">**</ept><ph id=\"ph44\"/> as the key and the average of <bpt id=\"p41\">**</bpt>temp_diff<ept id=\"p41\">**</ept><ph id=\"ph45\"/> as the value.",
      "nodes": [
        {
          "content": "Click the display options (highlighted in rectangle) to switch between different representations for the same output.",
          "pos": [
            0,
            117
          ]
        },
        {
          "content": "Click <bpt id=\"p39\">**</bpt>Settings<ept id=\"p39\">**</ept><ph id=\"ph43\"/> to choose what consitutes the key and values in the output.",
          "pos": [
            118,
            251
          ]
        },
        {
          "content": "The screen capture above uses <bpt id=\"p40\">**</bpt>buildingID<ept id=\"p40\">**</ept><ph id=\"ph44\"/> as the key and the average of <bpt id=\"p41\">**</bpt>temp_diff<ept id=\"p41\">**</ept><ph id=\"ph45\"/> as the value.",
          "pos": [
            252,
            464
          ]
        }
      ]
    },
    {
      "pos": [
        8900,
        9205
      ],
      "content": "You can also run Spark SQL statements using variables in the query. The next snippet shows how to define a variable, <bpt id=\"p42\">**</bpt>Temp<ept id=\"p42\">**</ept>, in the query with the possible values you want to query with. When you first run the query, a drop-down is automatically populated with the values you specified for the variable.",
      "nodes": [
        {
          "content": "You can also run Spark SQL statements using variables in the query.",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "The next snippet shows how to define a variable, <bpt id=\"p42\">**</bpt>Temp<ept id=\"p42\">**</ept>, in the query with the possible values you want to query with.",
          "pos": [
            68,
            228
          ]
        },
        {
          "content": "When you first run the query, a drop-down is automatically populated with the values you specified for the variable.",
          "pos": [
            229,
            345
          ]
        }
      ]
    },
    {
      "pos": [
        9379,
        9488
      ],
      "content": "Paste this snippet in a new paragraph and press <bpt id=\"p43\">**</bpt>SHIFT + ENTER<ept id=\"p43\">**</ept>. The following screenshot shows the output.",
      "nodes": [
        {
          "content": "Paste this snippet in a new paragraph and press <bpt id=\"p43\">**</bpt>SHIFT + ENTER<ept id=\"p43\">**</ept>.",
          "pos": [
            0,
            106
          ]
        },
        {
          "content": "The following screenshot shows the output.",
          "pos": [
            107,
            149
          ]
        }
      ]
    },
    {
      "pos": [
        9494,
        9692
      ],
      "content": "<ph id=\"ph46\">![</ph>Run a Spark SQL statement using the notebook<ph id=\"ph47\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.sparksqlquery2.png \"Run a Spark SQL statement using the notebook\")</ph>"
    },
    {
      "pos": [
        9698,
        10004
      ],
      "content": "For subsequent queries, you can select a new value from the drop-down and run the query again. Click <bpt id=\"p44\">**</bpt>Settings<ept id=\"p44\">**</ept><ph id=\"ph48\"/> to choose what consitutes the key and values in the output. The screen capture above uses <bpt id=\"p45\">**</bpt>buildingID<ept id=\"p45\">**</ept><ph id=\"ph49\"/> as the key, the average of <bpt id=\"p46\">**</bpt>temp_diff<ept id=\"p46\">**</ept><ph id=\"ph50\"/> as the value, and <bpt id=\"p47\">**</bpt>targettemp<ept id=\"p47\">**</ept><ph id=\"ph51\"/> as the group.",
      "nodes": [
        {
          "content": "For subsequent queries, you can select a new value from the drop-down and run the query again.",
          "pos": [
            0,
            94
          ]
        },
        {
          "content": "Click <bpt id=\"p44\">**</bpt>Settings<ept id=\"p44\">**</ept><ph id=\"ph48\"/> to choose what consitutes the key and values in the output.",
          "pos": [
            95,
            228
          ]
        },
        {
          "content": "The screen capture above uses <bpt id=\"p45\">**</bpt>buildingID<ept id=\"p45\">**</ept><ph id=\"ph49\"/> as the key, the average of <bpt id=\"p46\">**</bpt>temp_diff<ept id=\"p46\">**</ept><ph id=\"ph50\"/> as the value, and <bpt id=\"p47\">**</bpt>targettemp<ept id=\"p47\">**</ept><ph id=\"ph51\"/> as the group.",
          "pos": [
            229,
            526
          ]
        }
      ]
    },
    {
      "pos": [
        10009,
        10159
      ],
      "content": "Restart the Spark SQL interpreter to exit the application. Click the <bpt id=\"p48\">**</bpt>Interpreter<ept id=\"p48\">**</ept><ph id=\"ph52\"/> tab at the top, and for the Spark interpreter, click <bpt id=\"p49\">**</bpt>Restart<ept id=\"p49\">**</ept>.",
      "nodes": [
        {
          "content": "Restart the Spark SQL interpreter to exit the application.",
          "pos": [
            0,
            58
          ]
        },
        {
          "content": "Click the <bpt id=\"p48\">**</bpt>Interpreter<ept id=\"p48\">**</ept><ph id=\"ph52\"/> tab at the top, and for the Spark interpreter, click <bpt id=\"p49\">**</bpt>Restart<ept id=\"p49\">**</ept>.",
          "pos": [
            59,
            245
          ]
        }
      ]
    },
    {
      "pos": [
        10165,
        10346
      ],
      "content": "<ph id=\"ph53\">![</ph>Restart the Zeppelin intepreter<ph id=\"ph54\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.zeppelin.restart.interpreter.png \"Restart the Zeppelin intepreter\")</ph>"
    },
    {
      "pos": [
        10348,
        10350
      ],
      "content": "##"
    },
    {
      "pos": [
        10372,
        10418
      ],
      "content": "Run Spark SQL queries using a Jupyter notebook"
    },
    {
      "pos": [
        10420,
        10513
      ],
      "content": "In this section, you use a Jupyter notebook to run Spark SQL queries against a Spark cluster."
    },
    {
      "pos": [
        10516,
        10727
      ],
      "content": "<ph id=\"ph55\">[AZURE.NOTE]</ph><ph id=\"ph56\"/> The notebook you create following the instructions below is also available by default on the cluster. After you have launched Jupyter, you will find this notebook by the name <bpt id=\"p50\">**</bpt>HVACTutorial.ipynb<ept id=\"p50\">**</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph55\">[AZURE.NOTE]</ph><ph id=\"ph56\"/> The notebook you create following the instructions below is also available by default on the cluster.",
          "pos": [
            0,
            148
          ]
        },
        {
          "content": "After you have launched Jupyter, you will find this notebook by the name <bpt id=\"p50\">**</bpt>HVACTutorial.ipynb<ept id=\"p50\">**</ept>.",
          "pos": [
            149,
            285
          ]
        }
      ]
    },
    {
      "pos": [
        10732,
        10996
      ],
      "content": "From the <bpt id=\"p51\">[</bpt>Azure Portal<ept id=\"p51\">][azure-management-portal]</ept><ph id=\"ph57\"/> left pane, click <bpt id=\"p52\">**</bpt>HDInsight<ept id=\"p52\">**</ept>, and then click the Spark cluster you created. From the Spark cluster page, from the bottom pane, click <bpt id=\"p53\">**</bpt>Zeppelin Notebook<ept id=\"p53\">**</ept>. If prompted, enter the admin credentials for the cluster.",
      "nodes": [
        {
          "content": "From the <bpt id=\"p51\">[</bpt>Azure Portal<ept id=\"p51\">][azure-management-portal]</ept><ph id=\"ph57\"/> left pane, click <bpt id=\"p52\">**</bpt>HDInsight<ept id=\"p52\">**</ept>, and then click the Spark cluster you created.",
          "pos": [
            0,
            221
          ]
        },
        {
          "content": "From the Spark cluster page, from the bottom pane, click <bpt id=\"p53\">**</bpt>Zeppelin Notebook<ept id=\"p53\">**</ept>.",
          "pos": [
            222,
            341
          ]
        },
        {
          "content": "If prompted, enter the admin credentials for the cluster.",
          "pos": [
            342,
            399
          ]
        }
      ]
    },
    {
      "pos": [
        11004,
        11174
      ],
      "content": "<ph id=\"ph58\">[AZURE.NOTE]</ph><ph id=\"ph59\"/> You may also reach the Jupyter Notebook for your cluster by opening the following URL in your browser. Replace <bpt id=\"p54\">__</bpt>CLUSTERNAME<ept id=\"p54\">__</ept><ph id=\"ph60\"/> with the name of your cluster:",
      "nodes": [
        {
          "content": "<ph id=\"ph58\">[AZURE.NOTE]</ph><ph id=\"ph59\"/> You may also reach the Jupyter Notebook for your cluster by opening the following URL in your browser.",
          "pos": [
            0,
            149
          ]
        },
        {
          "content": "Replace <bpt id=\"p54\">__</bpt>CLUSTERNAME<ept id=\"p54\">__</ept><ph id=\"ph60\"/> with the name of your cluster:",
          "pos": [
            150,
            259
          ]
        }
      ]
    },
    {
      "pos": [
        11240,
        11305
      ],
      "content": "Create a new notebook. Click <bpt id=\"p55\">**</bpt>New<ept id=\"p55\">**</ept>, and then click <bpt id=\"p56\">**</bpt>Python2<ept id=\"p56\">**</ept>.",
      "nodes": [
        {
          "content": "Create a new notebook.",
          "pos": [
            0,
            22
          ]
        },
        {
          "content": "Click <bpt id=\"p55\">**</bpt>New<ept id=\"p55\">**</ept>, and then click <bpt id=\"p56\">**</bpt>Python2<ept id=\"p56\">**</ept>.",
          "pos": [
            23,
            145
          ]
        }
      ]
    },
    {
      "pos": [
        11311,
        11487
      ],
      "content": "<ph id=\"ph62\">![</ph>Create a new Jupyter notebook<ph id=\"ph63\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.jupyter.createnotebook.png \"Create a new Jupyter notebook\")</ph>"
    },
    {
      "pos": [
        11492,
        11620
      ],
      "content": "A new notebook is created and opened with the name Untitled.pynb. Click the notebook name at the top, and enter a friendly name.",
      "nodes": [
        {
          "content": "A new notebook is created and opened with the name Untitled.pynb.",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "Click the notebook name at the top, and enter a friendly name.",
          "pos": [
            66,
            128
          ]
        }
      ]
    },
    {
      "pos": [
        11626,
        11805
      ],
      "content": "<ph id=\"ph64\">![</ph>Provide a name for the notebook<ph id=\"ph65\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.jupyter.notebook.name.png \"Provide a name for the notebook\")</ph>"
    },
    {
      "pos": [
        11810,
        11956
      ],
      "content": "Import the required modules and create the Spark and SQL contexts. Paste the following snippet in an empty cell, and then press <bpt id=\"p57\">**</bpt>SHIFT + ENTER<ept id=\"p57\">**</ept>.",
      "nodes": [
        {
          "content": "Import the required modules and create the Spark and SQL contexts.",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "Paste the following snippet in an empty cell, and then press <bpt id=\"p57\">**</bpt>SHIFT + ENTER<ept id=\"p57\">**</ept>.",
          "pos": [
            67,
            186
          ]
        }
      ]
    },
    {
      "pos": [
        12230,
        12506
      ],
      "content": "Everytime you run a job in Jupyter, your web browser window title will show a <bpt id=\"p58\">**</bpt>(Busy)<ept id=\"p58\">**</ept><ph id=\"ph66\"/> status along with the notebook title. You will also see a solid circle next to the <bpt id=\"p59\">**</bpt>Python 2<ept id=\"p59\">**</ept><ph id=\"ph67\"/> text in the top-right corner. After the job completes, this will change to a hollow circle.",
      "nodes": [
        {
          "content": "Everytime you run a job in Jupyter, your web browser window title will show a <bpt id=\"p58\">**</bpt>(Busy)<ept id=\"p58\">**</ept><ph id=\"ph66\"/> status along with the notebook title.",
          "pos": [
            0,
            181
          ]
        },
        {
          "content": "You will also see a solid circle next to the <bpt id=\"p59\">**</bpt>Python 2<ept id=\"p59\">**</ept><ph id=\"ph67\"/> text in the top-right corner.",
          "pos": [
            182,
            324
          ]
        },
        {
          "content": "After the job completes, this will change to a hollow circle.",
          "pos": [
            325,
            386
          ]
        }
      ]
    },
    {
      "pos": [
        12513,
        12686
      ],
      "content": "<ph id=\"ph68\">![</ph>Status of a Jupyter notebook job<ph id=\"ph69\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.jupyter.job.status.png \"Status of a Jupyter notebook job\")</ph>"
    },
    {
      "pos": [
        12691,
        12902
      ],
      "content": "Load sample data into a temporary table. When you create a Spark cluster in HDInsight, the sample data file, <bpt id=\"p60\">**</bpt>hvac.csv<ept id=\"p60\">**</ept>, is copied to the associated storage account under <bpt id=\"p61\">**</bpt>\\HdiSamples\\SensorSampleData\\hvac<ept id=\"p61\">**</ept>.",
      "nodes": [
        {
          "content": "Load sample data into a temporary table.",
          "pos": [
            0,
            40
          ]
        },
        {
          "content": "When you create a Spark cluster in HDInsight, the sample data file, <bpt id=\"p60\">**</bpt>hvac.csv<ept id=\"p60\">**</ept>, is copied to the associated storage account under <bpt id=\"p61\">**</bpt>\\HdiSamples\\SensorSampleData\\hvac<ept id=\"p61\">**</ept>.",
          "pos": [
            41,
            291
          ]
        }
      ]
    },
    {
      "pos": [
        12908,
        13054
      ],
      "content": "In an empty cell, paste the following snippet and press <bpt id=\"p62\">**</bpt>SHIFT + ENTER<ept id=\"p62\">**</ept>. This snippet registers the data into a temporary table called <bpt id=\"p63\">**</bpt>hvac<ept id=\"p63\">**</ept>.",
      "nodes": [
        {
          "content": "In an empty cell, paste the following snippet and press <bpt id=\"p62\">**</bpt>SHIFT + ENTER<ept id=\"p62\">**</ept>.",
          "pos": [
            0,
            114
          ]
        },
        {
          "content": "This snippet registers the data into a temporary table called <bpt id=\"p63\">**</bpt>hvac<ept id=\"p63\">**</ept>.",
          "pos": [
            115,
            226
          ]
        }
      ]
    },
    {
      "pos": [
        14104,
        14175
      ],
      "content": "Once the job completes successfully, the following output is displayed."
    },
    {
      "pos": [
        14937,
        15088
      ],
      "content": "Restart the kernel to exit the application. From the top menu bar, click <bpt id=\"p64\">**</bpt>Kernel<ept id=\"p64\">**</ept>, click <bpt id=\"p65\">**</bpt>Restart<ept id=\"p65\">**</ept>, and then click <bpt id=\"p66\">**</bpt>Restart<ept id=\"p66\">**</ept><ph id=\"ph70\"/> again at the prompt.",
      "nodes": [
        {
          "content": "Restart the kernel to exit the application.",
          "pos": [
            0,
            43
          ]
        },
        {
          "content": "From the top menu bar, click <bpt id=\"p64\">**</bpt>Kernel<ept id=\"p64\">**</ept>, click <bpt id=\"p65\">**</bpt>Restart<ept id=\"p65\">**</ept>, and then click <bpt id=\"p66\">**</bpt>Restart<ept id=\"p66\">**</ept><ph id=\"ph70\"/> again at the prompt.",
          "pos": [
            44,
            286
          ]
        }
      ]
    },
    {
      "pos": [
        15094,
        15259
      ],
      "content": "<ph id=\"ph71\">![</ph>Restart the Jupyter Kernel<ph id=\"ph72\">](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.jupyter.restart.kernel.png \"Restart the Jupyter Kernel\")</ph>"
    },
    {
      "pos": [
        15262,
        15264
      ],
      "content": "##"
    },
    {
      "pos": [
        15286,
        15294
      ],
      "content": "See also"
    },
    {
      "pos": [
        15299,
        15381
      ],
      "content": "<bpt id=\"p67\">[</bpt>Overview: Apache Spark on Azure HDInsight<ept id=\"p67\">](hdinsight-apache-spark-overview-v1.md)</ept>"
    },
    {
      "pos": [
        15384,
        15467
      ],
      "content": "<bpt id=\"p68\">[</bpt>Create a Spark on HDInsight cluster<ept id=\"p68\">](hdinsight-apache-spark-provision-clusters.md)</ept>"
    },
    {
      "pos": [
        15470,
        15587
      ],
      "content": "<bpt id=\"p69\">[</bpt>Perform interactive data analysis using Spark in HDInsight with BI tools<ept id=\"p69\">](hdinsight-apache-spark-use-bi-tools-v1.md)</ept>"
    },
    {
      "pos": [
        15590,
        15721
      ],
      "content": "<bpt id=\"p70\">[</bpt>Use Spark in HDInsight for building machine learning applications<ept id=\"p70\">](hdinsight-apache-spark-ipython-notebook-machine-learning-v1.md)</ept>"
    },
    {
      "pos": [
        15724,
        15863
      ],
      "content": "<bpt id=\"p71\">[</bpt>Use Spark in HDInsight for building real-time streaming applications<ept id=\"p71\">](hdinsight-apache-spark-csharp-apache-zeppelin-eventhub-streaming.md)</ept>"
    },
    {
      "pos": [
        15866,
        15979
      ],
      "content": "<bpt id=\"p72\">[</bpt>Manage resources for the Apache Spark cluster in Azure HDInsight<ept id=\"p72\">](hdinsight-apache-spark-resource-manager-v1.md)</ept>"
    }
  ],
  "content": "<properties \n    pageTitle=\"Create a Spark cluster on HDInsight and use Spark SQL from Zeppelin and Jupyter for interactive analysis | Azure\" \n    description=\"Step-by-step instructions on how to quickly create an Apache Spark cluster in HDInsight and then use Spark SQL from Zeppelin and Jupyter notebooks to run interactive queries.\" \n    services=\"hdinsight\" \n    documentationCenter=\"\" \n    authors=\"nitinme\" \n    manager=\"paulettm\" \n    editor=\"cgronlun\"/>\n\n<tags \n    ms.service=\"hdinsight\" \n    ms.workload=\"big-data\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"12/22/2015\" \n    ms.author=\"nitinme\"/>\n\n\n# Quick Start: create Apache Spark on HDInsight and run interactive queries using Spark SQL (Windows)\n\n[AZURE.INCLUDE [hdinsight-azure-portal](../../includes/hdinsight-azure-portal.md)]\n\n* [Create Apache Spark on HDInsight and run interactive queries using Spark SQL](hdinsight-apache-spark-jupyter-spark-sql.md)\n\nLearn how to create an Apache Spark cluster in HDInsight using the Quick Create option and then use the web-based [Zeppelin](https://zeppelin.incubator.apache.org) and [Jupyter](https://jupyter.org) notebooks to run Spark SQL interactive queries on the Spark cluster.\n\n\n   ![Get started using Apache Spark in HDInsight](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.getstartedflow.png  \"Get started using Apache Spark in HDInsight tutorial. Steps illustrated: create a storage account; create a cluster; run Spark SQL statements\")\n\n**Prerequisites:**\n\nBefore you begin this tutorial, you must have an Azure subscription. See [Get Azure free trial](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).\n\n##<a name=\"storage\"></a>Create an Azure Storage account\n\nWhen you create an HDInsight cluster in HDInsight, you specify an Azure Storage account. A specific Blob storage container from that account is designated as the default file system. By default, the HDInsight cluster is created in the same data center as the storage account you specify. For more information, see [Use Azure Blob storage with HDInsight][hdinsight-storage].\n\n\n**To create an Azure Storage account**\n\n1. Sign in to the [Azure Portal][azure-management-portal].\n2. Click **NEW** in the lower-left corner and then enter the values as shown in the image.\n\n    ![Azure portal where you can use Quick Create to set up a new storage account](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.storageaccount.quickcreate.png \"Azure portal where you can use Quick Create to set up a new storage account\")\n\n>[AZURE.NOTE]  Make sure you create the storage account in a location that is supported for the cluster.\n\nSelect the new storage account from the list and click **MANAGE ACCESS KEYS** at the bottom of the page. Make a note of the **PRIMARY ACCESS KEY** (or the **SECONDARY ACCESS KEY**—either of the keys work).  You will need this later in the tutorial. For more information, see [How to Create a Storage Account][azure-create-storageaccount] .\n    \n##Create an HDInsight Spark cluster\n\nIn this section, you create an HDInsight version 3.2 cluster, which is based on Spark version 1.3.1. For information about HDInsight versions and their SLAs, see [HDInsight component versioning](hdinsight-component-versioning.md).\n\n>[AZURE.NOTE] The steps in this article create an Apache Spark cluster in HDInsight by using basic configuration settings. For information about other cluster configuration settings (such as using additional storage, Azure virtual network, or a metastore for Hive), see [Create HDInsight clusters using custom options](hdinsight-apache-spark-provision-clusters.md).\n\n\n**To create a Spark cluster** \n\n1. Sign in to the [Azure Portal][azure-management-portal]. \n\n2. Click **NEW** in the lower-left corner and then enter the values as shown in the image.\n\n    ![Create a Spark cluster in HDInsight](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.quickcreatecluster.png \"Create a Spark cluster in HDInsight\")\n\n\n##<a name=\"zeppelin\"></a>Run interactive Spark SQL queries using a Zeppelin notebook\n\nAfter you have created a cluster, you can use a web-based Zeppelin notebook to run Spark SQL interactive queries against the Spark HDInsight cluster. In this section, we will use a sample data file (hvac.csv) available by default on the cluster to run some interactive Spark SQL queries.\n\n>[AZURE.NOTE] The notebook you create following the instructions below is also available by default on the cluster. After you have launched Zeppelin, you will find this notebook by the name **Zeppelin HVAC tutorial**.\n\n1. From the [Azure Portal][azure-management-portal] left pane, click **HDInsight**, and then click the Spark cluster you created. From the Spark cluster page, from the bottom pane, click **Zeppelin Notebook**. If prompted, enter the admin credentials for the cluster.\n\n    > [AZURE.NOTE] You may also reach the Zeppelin Notebook for your cluster by opening the following URL in your browser. Replace __CLUSTERNAME__ with the name of your cluster:\n    >\n    > `https://CLUSTERNAME.azurehdinsight.net/zeppelin`\n\n2. Create a new notebook. From the header pane, click **Notebook**, and then click **Create New Note**.\n\n    ![Create a new Zeppelin notebook](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.createnewnote.png \"Create a new Zeppelin notebook\")\n\n    On the same page, under the **Notebook** heading, you should see a new notebook with the name starting with **Note XXXXXXXXX**. Click the new notebook.\n\n3. On the web page for the new notebook, click the heading, and change the name of the notebook if you want to. Press ENTER to save the name change. Also, make sure the notebook header shows a **Connected** status in the top-right corner.\n\n    ![Zeppelin notebook status](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.newnote.connected.png \"Zeppelin notebook status\")\n\n4. Load sample data into a temporary table. When you create a Spark cluster in HDInsight, the sample data file, **hvac.csv**, is copied to the associated storage account under **\\HdiSamples\\SensorSampleData\\hvac**.\n\n    In the empty paragraph that is created by default in the new notebook, paste the following snippet.\n\n        // Create an RDD using the default Spark context, sc\n        val hvacText = sc.textFile(\"wasb:///HdiSamples/SensorSampleData/hvac/HVAC.csv\")\n        \n        // Define a schema\n        case class Hvac(date: String, time: String, targettemp: Integer, actualtemp: Integer, buildingID: String)\n        \n        // Map the values in the .csv file to the schema\n        val hvac = hvacText.map(s => s.split(\",\")).filter(s => s(0) != \"Date\").map(\n            s => Hvac(s(0), \n                    s(1),\n                    s(2).toInt,\n                    s(3).toInt,\n                    s(6)\n            )\n        ).toDF()\n        \n        // Register as a temporary table called \"hvac\"\n        hvac.registerTempTable(\"hvac\")\n        \n    Press **SHIFT + ENTER** or click the **Play** button for the paragraph to run the snippet. The status on the right-corner of the paragraph should progress from READY, PENDING, RUNNING to FINISHED. The output shows up at the bottom of the same paragraph. The screenshot looks like the following:\n\n    ![Create a temporary table from raw data](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.loaddataintotable.png \"Create a temporary table from raw data\")\n\n    You can also provide a title to each paragraph. From the right-hand corner, click the **Settings** icon, and then click **Show title**.\n\n5. You can now run Spark SQL statements on the **hvac** table. Paste the following query in a new paragraph. The query retrieves the building ID and the difference between the target and actual temperatures for each building on a given date. Press **SHIFT + ENTER**.\n\n        %sql\n        select buildingID, (targettemp - actualtemp) as temp_diff, date \n        from hvac\n        where date = \"6/1/13\" \n\n    The **%sql** statement at the beginning tells the notebook to use the Spark  SQL interpreter. You can look at the defined interpreters from the **Interpreter** tab in the notebook header.\n\n    The following screenshot shows the output.\n\n    ![Run a Spark SQL statement using the notebook](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.sparksqlquery1.png \"Run a Spark SQL statement using the notebook\")\n\n     Click the display options (highlighted in rectangle) to switch between different representations for the same output. Click **Settings** to choose what consitutes the key and values in the output. The screen capture above uses **buildingID** as the key and the average of **temp_diff** as the value.\n\n    \n6. You can also run Spark SQL statements using variables in the query. The next snippet shows how to define a variable, **Temp**, in the query with the possible values you want to query with. When you first run the query, a drop-down is automatically populated with the values you specified for the variable.\n\n        %sql\n        select buildingID, date, targettemp, (targettemp - actualtemp) as temp_diff\n        from hvac\n        where targettemp > \"${Temp = 65,65|75|85}\" \n\n    Paste this snippet in a new paragraph and press **SHIFT + ENTER**. The following screenshot shows the output.\n\n    ![Run a Spark SQL statement using the notebook](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.sparksqlquery2.png \"Run a Spark SQL statement using the notebook\")\n\n    For subsequent queries, you can select a new value from the drop-down and run the query again. Click **Settings** to choose what consitutes the key and values in the output. The screen capture above uses **buildingID** as the key, the average of **temp_diff** as the value, and **targettemp** as the group.\n\n7. Restart the Spark SQL interpreter to exit the application. Click the **Interpreter** tab at the top, and for the Spark interpreter, click **Restart**.\n\n    ![Restart the Zeppelin intepreter](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.zeppelin.restart.interpreter.png \"Restart the Zeppelin intepreter\")\n\n##<a name=\"jupyter\"></a>Run Spark SQL queries using a Jupyter notebook\n\nIn this section, you use a Jupyter notebook to run Spark SQL queries against a Spark cluster.\n\n>[AZURE.NOTE] The notebook you create following the instructions below is also available by default on the cluster. After you have launched Jupyter, you will find this notebook by the name **HVACTutorial.ipynb**.\n\n1. From the [Azure Portal][azure-management-portal] left pane, click **HDInsight**, and then click the Spark cluster you created. From the Spark cluster page, from the bottom pane, click **Zeppelin Notebook**. If prompted, enter the admin credentials for the cluster.\n\n    > [AZURE.NOTE] You may also reach the Jupyter Notebook for your cluster by opening the following URL in your browser. Replace __CLUSTERNAME__ with the name of your cluster:\n    >\n    > `https://CLUSTERNAME.azurehdinsight.net/jupyter`\n\n2. Create a new notebook. Click **New**, and then click **Python2**.\n\n    ![Create a new Jupyter notebook](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.jupyter.createnotebook.png \"Create a new Jupyter notebook\")\n\n3. A new notebook is created and opened with the name Untitled.pynb. Click the notebook name at the top, and enter a friendly name.\n\n    ![Provide a name for the notebook](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.note.jupyter.notebook.name.png \"Provide a name for the notebook\")\n\n4. Import the required modules and create the Spark and SQL contexts. Paste the following snippet in an empty cell, and then press **SHIFT + ENTER**.\n\n        from pyspark import SparkContext\n        from pyspark.sql import SQLContext\n        from pyspark.sql.types import *\n\n        # Create Spark and SQL contexts\n        sc = SparkContext('spark://headnodehost:7077', 'pyspark')\n        sqlContext = SQLContext(sc)\n\n    Everytime you run a job in Jupyter, your web browser window title will show a **(Busy)** status along with the notebook title. You will also see a solid circle next to the **Python 2** text in the top-right corner. After the job completes, this will change to a hollow circle.\n\n     ![Status of a Jupyter notebook job](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.jupyter.job.status.png \"Status of a Jupyter notebook job\")\n\n4. Load sample data into a temporary table. When you create a Spark cluster in HDInsight, the sample data file, **hvac.csv**, is copied to the associated storage account under **\\HdiSamples\\SensorSampleData\\hvac**.\n\n    In an empty cell, paste the following snippet and press **SHIFT + ENTER**. This snippet registers the data into a temporary table called **hvac**.\n\n\n        # Load the data\n        hvacText = sc.textFile(\"wasb:///HdiSamples/SensorSampleData/hvac/HVAC.csv\")\n        \n        # Create the schema\n        hvacSchema = StructType([StructField(\"date\", StringType(), False),StructField(\"time\", StringType(), False),StructField(\"targettemp\", IntegerType(), False),StructField(\"actualtemp\", IntegerType(), False),StructField(\"buildingID\", StringType(), False)])\n        \n        # Parse the data in hvacText\n        hvac = hvacText.map(lambda s: s.split(\",\")).filter(lambda s: s[0] != \"Date\").map(lambda s:(str(s[0]), str(s[1]), int(s[2]), int(s[3]), str(s[6]) ))\n        \n        # Create a data frame\n        hvacdf = sqlContext.createDataFrame(hvac,hvacSchema)\n        \n        # Register the data fram as a table to run queries against\n        hvacdf.registerAsTable(\"hvac\")\n        \n        # Run queries against the table and display the data\n        data = sqlContext.sql(\"select buildingID, (targettemp - actualtemp) as temp_diff, date from hvac where date = \\\"6/1/13\\\"\")\n        data.show()\n\n5. Once the job completes successfully, the following output is displayed.\n\n        buildingID temp_diff date  \n        4          8         6/1/13\n        3          2         6/1/13\n        7          -10       6/1/13\n        12         3         6/1/13\n        7          9         6/1/13\n        7          5         6/1/13\n        3          11        6/1/13\n        8          -7        6/1/13\n        17         14        6/1/13\n        16         -3        6/1/13\n        8          -8        6/1/13\n        1          -1        6/1/13\n        12         11        6/1/13\n        3          14        6/1/13\n        6          -4        6/1/13\n        1          4         6/1/13\n        19         4         6/1/13\n        19         12        6/1/13\n        9          -9        6/1/13\n        15         -10       6/1/13\n\n6. Restart the kernel to exit the application. From the top menu bar, click **Kernel**, click **Restart**, and then click **Restart** again at the prompt.\n\n    ![Restart the Jupyter Kernel](./media/hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql-v1/hdispark.jupyter.restart.kernel.png \"Restart the Jupyter Kernel\")\n\n\n##<a name=\"seealso\"></a>See also\n\n\n* [Overview: Apache Spark on Azure HDInsight](hdinsight-apache-spark-overview-v1.md)\n* [Create a Spark on HDInsight cluster](hdinsight-apache-spark-provision-clusters.md)\n* [Perform interactive data analysis using Spark in HDInsight with BI tools](hdinsight-apache-spark-use-bi-tools-v1.md)\n* [Use Spark in HDInsight for building machine learning applications](hdinsight-apache-spark-ipython-notebook-machine-learning-v1.md)\n* [Use Spark in HDInsight for building real-time streaming applications](hdinsight-apache-spark-csharp-apache-zeppelin-eventhub-streaming.md)\n* [Manage resources for the Apache Spark cluster in Azure HDInsight](hdinsight-apache-spark-resource-manager-v1.md)\n\n\n[hdinsight-versions]: hdinsight-component-versioning.md\n[hdinsight-upload-data]: hdinsight-upload-data.md\n[hdinsight-storage]: hdinsight-hadoop-use-blob-storage.md\n\n[azure-purchase-options]: http://azure.microsoft.com/pricing/purchase-options/\n[azure-member-offers]: http://azure.microsoft.com/pricing/member-offers/\n[azure-free-trial]: http://azure.microsoft.com/pricing/free-trial/\n[azure-management-portal]: https://manage.windowsazure.com/\n[azure-create-storageaccount]: storage-create-storage-account.md\n\n\n\n\n\n\n\n"
}