{
  "nodes": [
    {
      "content": "How to work with the Node.js backend server SDK for Mobile Apps | Azure App Service",
      "pos": [
        27,
        110
      ]
    },
    {
      "content": "Learn how to work with the Node.js backend server SDK for Azure App Service Mobile Apps.",
      "pos": [
        129,
        217
      ]
    },
    {
      "content": "How to use the Azure Mobile Apps Node.js SDK",
      "pos": [
        548,
        592
      ]
    },
    {
      "content": "This article provides detailed information and examples showing how to work with a Node.js backend in Azure App Service Mobile Apps.",
      "pos": [
        710,
        842
      ]
    },
    {
      "pos": [
        847,
        886
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"Introduction\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Introduction"
    },
    {
      "content": "Azure App Service Mobile Apps provides the capability to add a mobile-optimized data access Web API to a web application.",
      "pos": [
        888,
        1009
      ]
    },
    {
      "content": "The Azure App",
      "pos": [
        1011,
        1024
      ]
    },
    {
      "content": "Service Mobile Apps SDK is provided for ASP.NET and Node.js web applications.",
      "pos": [
        1025,
        1102
      ]
    },
    {
      "content": "The SDK provides the following operations:",
      "pos": [
        1104,
        1146
      ]
    },
    {
      "content": "Table operations (Read, Insert, Update, Delete) for data access",
      "pos": [
        1150,
        1213
      ]
    },
    {
      "content": "Custom API operations",
      "pos": [
        1216,
        1237
      ]
    },
    {
      "content": "Both operations provide for authentication across all identity providers allowed by Azure App Service, including social identity",
      "pos": [
        1239,
        1367
      ]
    },
    {
      "content": "providers such as Facebook, Twitter, Google and Microsoft as well as Azure Active Directory for enterprise identity.",
      "pos": [
        1368,
        1484
      ]
    },
    {
      "pos": [
        1486,
        1562
      ],
      "content": "You can find samples for each use case in the <bpt id=\"p1\">[</bpt><ept id=\"p1\">samples directory on GitHub]</ept>."
    },
    {
      "pos": [
        1567,
        1665
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-cmdline-basicapp\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Create a Basic Node.js backend using the Command Line"
    },
    {
      "content": "Every Azure App Service Mobile App Node.js backend starts as an ExpressJS application.",
      "pos": [
        1667,
        1753
      ]
    },
    {
      "content": "ExpressJS is the most popular web service framework",
      "pos": [
        1755,
        1806
      ]
    },
    {
      "content": "available for Node.js.",
      "pos": [
        1807,
        1829
      ]
    },
    {
      "content": "You can create a basic <bpt id=\"p1\">[</bpt><ept id=\"p1\">Express]</ept> application as follows:",
      "pos": [
        1831,
        1887
      ]
    },
    {
      "content": "In a command or PowerShell window, create a new directory for your project.",
      "pos": [
        1892,
        1967
      ]
    },
    {
      "content": "Run npm init to initialize the package structure.",
      "pos": [
        1996,
        2045
      ]
    },
    {
      "content": "The npm init command will ask a set of questions to initialize the project.",
      "pos": [
        2089,
        2164
      ]
    },
    {
      "content": "See the example output below",
      "pos": [
        2166,
        2194
      ]
    },
    {
      "content": "The npm init output",
      "pos": [
        2202,
        2221
      ]
    },
    {
      "content": "Install the express and azure-mobile-apps libraries from the npm repository.",
      "pos": [
        2230,
        2306
      ]
    },
    {
      "content": "Create an app.js file to implement the basic mobile server.",
      "pos": [
        2365,
        2424
      ]
    },
    {
      "content": "This application creates a simple mobile-optimized WebAPI with a single endpoint (<ph id=\"ph1\">`/tables/TodoItem`</ph>) that provides",
      "pos": [
        2845,
        2960
      ]
    },
    {
      "content": "unauthenticated access to an underlying SQL data store using a dynamic schema.",
      "pos": [
        2961,
        3039
      ]
    },
    {
      "content": "It is suitable for following the",
      "pos": [
        3041,
        3073
      ]
    },
    {
      "content": "client library quick starts:",
      "pos": [
        3074,
        3102
      ]
    },
    {
      "content": "Android Client QuickStart",
      "pos": [
        3107,
        3132
      ]
    },
    {
      "content": "Apache Cordova Client QuickStart",
      "pos": [
        3137,
        3169
      ]
    },
    {
      "content": "iOS Client QuickStart",
      "pos": [
        3174,
        3195
      ]
    },
    {
      "content": "Windows Store Client QuickStart",
      "pos": [
        3200,
        3231
      ]
    },
    {
      "content": "Xamarin.iOS Client QuickStart",
      "pos": [
        3236,
        3265
      ]
    },
    {
      "content": "Xamarin.Android Client QuickStart",
      "pos": [
        3270,
        3303
      ]
    },
    {
      "content": "Xamarin.Forms Client QuickStart",
      "pos": [
        3308,
        3339
      ]
    },
    {
      "pos": [
        3343,
        3427
      ],
      "content": "You can find the code for this basic application in the <bpt id=\"p1\">[</bpt><ept id=\"p1\">basicapp sample on GitHub]</ept>."
    },
    {
      "pos": [
        3432,
        3521
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-vs2015-basicapp\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Create a Node backend with Visual Studio 2015"
    },
    {
      "content": "Visual Studio 2015 requires an extension to develop Node.js applications within the IDE.",
      "pos": [
        3523,
        3611
      ]
    },
    {
      "content": "To start, download and install the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Node.js Tools 1.1 for Visual Studio]</ept>.",
      "pos": [
        3613,
        3686
      ]
    },
    {
      "content": "Once the Node.js Tools for Visual Studio are installed, create an Express 4.x application:",
      "pos": [
        3688,
        3778
      ]
    },
    {
      "pos": [
        3783,
        3858
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog (from <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>New<ept id=\"p3\">**</ept> &gt; <bpt id=\"p4\">**</bpt>Project...<ept id=\"p4\">**</ept>)."
    },
    {
      "pos": [
        3863,
        3915
      ],
      "content": "Expand <bpt id=\"p1\">**</bpt>Templates<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>JavaScript<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Node.js<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        3920,
        3977
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Basic Azure Node.js Express 4 Application<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Fill in the project name.",
      "pos": [
        3982,
        4007
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">*</bpt>OK<ept id=\"p1\">*</ept>.",
      "pos": [
        4009,
        4023
      ]
    },
    {
      "content": "Visual Studio 2015 New Project",
      "pos": [
        4031,
        4061
      ]
    },
    {
      "pos": [
        4070,
        4145
      ],
      "content": "Right-click on the <bpt id=\"p1\">**</bpt>npm<ept id=\"p1\">**</ept> node and select <bpt id=\"p2\">**</bpt>Install New npm packages...<ept id=\"p2\">**</ept>."
    },
    {
      "content": "You may need to refresh the npm catalog on creating your first Node.js application.",
      "pos": [
        4150,
        4233
      ]
    },
    {
      "content": "If this is required, you will be prompted - click on <bpt id=\"p1\">**</bpt>Refresh<ept id=\"p1\">**</ept>.",
      "pos": [
        4235,
        4300
      ]
    },
    {
      "content": "Enter <bpt id=\"p1\">_</bpt>azure-mobile-apps<ept id=\"p1\">_</ept> in the search box.",
      "pos": [
        4305,
        4349
      ]
    },
    {
      "content": "Click on the <bpt id=\"p1\">**</bpt>azure-mobile-apps 2.0.0<ept id=\"p1\">**</ept> package, then click on <bpt id=\"p2\">**</bpt>Install Package<ept id=\"p2\">**</ept>.",
      "pos": [
        4351,
        4435
      ]
    },
    {
      "content": "Install New npm packages",
      "pos": [
        4443,
        4467
      ]
    },
    {
      "pos": [
        4476,
        4495
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Open the <bpt id=\"p1\">_</bpt>app.js<ept id=\"p1\">_</ept> file to add support for the Azure Mobile Apps SDK.",
      "pos": [
        4500,
        4568
      ]
    },
    {
      "content": "At line 6 at the bottom of the library require statements, add the following code:",
      "pos": [
        4570,
        4652
      ]
    },
    {
      "content": "At approximately line 27 after the other app.use statements, add the following code:",
      "pos": [
        4768,
        4852
      ]
    },
    {
      "content": "Save the file.",
      "pos": [
        5042,
        5056
      ]
    },
    {
      "content": "Either run the application locally (the API will be served on http://localhost:3000) or publish to Azure.",
      "pos": [
        5062,
        5167
      ]
    },
    {
      "pos": [
        5172,
        5276
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"download-quickstart\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Download the Node.js backend quickstart code project using Git"
    },
    {
      "content": "When you create a new Node.js Mobile App backend by using the portal <bpt id=\"p1\">**</bpt>Quick start<ept id=\"p1\">**</ept> blade, a new Node.js project is created for you and deployed to your site.",
      "pos": [
        5278,
        5437
      ]
    },
    {
      "content": "You can add tables and APIs and edit code files for the Node.js backend in the portal.",
      "pos": [
        5438,
        5524
      ]
    },
    {
      "content": "You can also use one of a variety of deployment tools to download the backend project so that you can add or modify tables and APIs, then republish the project.",
      "pos": [
        5525,
        5685
      ]
    },
    {
      "content": "For more information, see the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure App Service Deployment Guide]</ept>.",
      "pos": [
        5686,
        5753
      ]
    },
    {
      "content": "the following procedure uses a Git repository to download the quickstart project code.",
      "pos": [
        5754,
        5840
      ]
    },
    {
      "content": "Install Git, if you haven't already done so.",
      "pos": [
        5845,
        5889
      ]
    },
    {
      "content": "The steps required to install Git vary between operating systems.",
      "pos": [
        5890,
        5955
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Installing Git<ept id=\"p1\">](http://git-scm.com/book/en/Getting-Started-Installing-Git)</ept> for operating system specific distributions and installation guidance.",
      "pos": [
        5956,
        6106
      ]
    },
    {
      "pos": [
        6111,
        6331
      ],
      "content": "Follow the steps in <bpt id=\"p1\">[</bpt>Enable the web app repository<ept id=\"p1\">](../app-service-web/web-sites-publish-source-control.md#Step4)</ept> to enable the Git repository for your backend site, making a note of the deployment username and password."
    },
    {
      "pos": [
        6336,
        6423
      ],
      "content": "In the blade for your Mobile App backend, make a note of the <bpt id=\"p1\">**</bpt>Git clone URL<ept id=\"p1\">**</ept> setting."
    },
    {
      "pos": [
        6429,
        6585
      ],
      "content": "Execute the <ph id=\"ph1\">`git clone`</ph> command in a Git-aware command-line tool using the Git clone URL, entering your password when required, as in the following example:"
    },
    {
      "content": "Browse to local directory, which in the above example is /todolist, and notice that project files have been downloaded.",
      "pos": [
        6676,
        6795
      ]
    },
    {
      "content": "In the /tables subfolder you will find a todoitem.json file, which defines permissions on the table, and todoitem.js file, which defines that CRUD operation scripts for the table.",
      "pos": [
        6796,
        6975
      ]
    },
    {
      "content": "After you have made changes to project files, execute the following commands to add, commit, then upload the changes to the site:",
      "pos": [
        6980,
        7109
      ]
    },
    {
      "pos": [
        7200,
        7289
      ],
      "content": "When you add new files to the project, you first need to execute the <ph id=\"ph1\">`git add .`</ph> command."
    },
    {
      "content": "The site is republished every time a new set of commits is pushed to the site.",
      "pos": [
        7291,
        7369
      ]
    },
    {
      "pos": [
        7374,
        7456
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-publish-to-azure\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Publish your Node.js backend to Azure"
    },
    {
      "content": "Microsoft Azure provides many mechanisms for publishing your Azure App Service Mobile Apps Node.js backend to the Azure service.",
      "pos": [
        7458,
        7586
      ]
    },
    {
      "content": "These include utilizing deployment tools integrated into Visual Studio, command-line tools and continuous deployment options based on source control.",
      "pos": [
        7588,
        7737
      ]
    },
    {
      "content": "For more information on this topic, refer to the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure App Service Deployment Guide]</ept>.",
      "pos": [
        7739,
        7825
      ]
    },
    {
      "content": "Azure App Service has specific advice for Node.js application that you should review before deploying:",
      "pos": [
        7827,
        7929
      ]
    },
    {
      "pos": [
        7933,
        7966
      ],
      "content": "How to <bpt id=\"p1\">[</bpt><ept id=\"p1\">specify the Node Version]</ept>"
    },
    {
      "pos": [
        7969,
        7994
      ],
      "content": "How to <bpt id=\"p1\">[</bpt><ept id=\"p1\">use Node modules]</ept>"
    },
    {
      "pos": [
        7999,
        8082
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-enable-homepage\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Enable a Home Page for your application"
    },
    {
      "content": "Many applications are a combination of web and mobile apps and the ExpressJS framework allows you to combine the two facets.",
      "pos": [
        8084,
        8208
      ]
    },
    {
      "content": "Sometimes, however, you",
      "pos": [
        8210,
        8233
      ]
    },
    {
      "content": "may wish to only implement a mobile interface.",
      "pos": [
        8234,
        8280
      ]
    },
    {
      "content": "It is useful to provide a landing page to ensure the app service is up and running.",
      "pos": [
        8282,
        8365
      ]
    },
    {
      "content": "You can either",
      "pos": [
        8367,
        8381
      ]
    },
    {
      "content": "provide your own home page or enable a temporary home page.",
      "pos": [
        8382,
        8441
      ]
    },
    {
      "content": "To enable a temporary home page, adjust the Mobile App constructor to the following:",
      "pos": [
        8443,
        8527
      ]
    },
    {
      "pos": [
        8584,
        8702
      ],
      "content": "You can add this setting to your <ph id=\"ph1\">`azureMobile.js`</ph> file if you only want this option available when developing locally."
    },
    {
      "pos": [
        8707,
        8763
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"TableOperations\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Overview: Table operations"
    },
    {
      "content": "The azure-mobile-apps Node.js Server SDK provides mechanisms to expose data tables stored in Azure SQL Database as a WebAPI.",
      "pos": [
        8765,
        8889
      ]
    },
    {
      "content": "Five operations are provided.",
      "pos": [
        8891,
        8920
      ]
    },
    {
      "content": "Operation",
      "pos": [
        8924,
        8933
      ]
    },
    {
      "content": "Description",
      "pos": [
        8936,
        8947
      ]
    },
    {
      "pos": [
        8980,
        9003
      ],
      "content": "GET /tables/<bpt id=\"p1\">_</bpt>tablename<ept id=\"p1\">_</ept>"
    },
    {
      "content": "Get all records in the table",
      "pos": [
        9006,
        9034
      ]
    },
    {
      "pos": [
        9039,
        9066
      ],
      "content": "GET /tables/<bpt id=\"p1\">_</bpt>tablename<ept id=\"p1\">_</ept>/:id"
    },
    {
      "content": "Get a specific record in the table",
      "pos": [
        9069,
        9103
      ]
    },
    {
      "pos": [
        9108,
        9132
      ],
      "content": "POST /tables/<bpt id=\"p1\">_</bpt>tablename<ept id=\"p1\">_</ept>"
    },
    {
      "content": "Create a new record in the table",
      "pos": [
        9135,
        9167
      ]
    },
    {
      "pos": [
        9172,
        9201
      ],
      "content": "PATCH /tables/<bpt id=\"p1\">_</bpt>tablename<ept id=\"p1\">_</ept>/:id"
    },
    {
      "content": "Update an existing record in the table",
      "pos": [
        9204,
        9242
      ]
    },
    {
      "pos": [
        9247,
        9277
      ],
      "content": "DELETE /tables/<bpt id=\"p1\">_</bpt>tablename<ept id=\"p1\">_</ept>/:id"
    },
    {
      "content": "Delete a record in the table",
      "pos": [
        9280,
        9308
      ]
    },
    {
      "pos": [
        9312,
        9401
      ],
      "content": "This WebAPI supports <bpt id=\"p1\">[</bpt><ept id=\"p1\">OData]</ept> and extends the table schema to support <bpt id=\"p2\">[</bpt><ept id=\"p2\">offline data sync]</ept>."
    },
    {
      "pos": [
        9406,
        9484
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-dynamicschema\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Define tables using a dynamic schema"
    },
    {
      "content": "Before a table can be used, it must be defined.",
      "pos": [
        9486,
        9533
      ]
    },
    {
      "content": "Tables can be defined with a static schema (where the developer defines the columns within the schema) or dynamically (where the SDK controls the schema based on incoming requests).",
      "pos": [
        9535,
        9716
      ]
    },
    {
      "content": "In addition, the developer can control specific aspects of the WebAPI by adding Javascript code to the definition.",
      "pos": [
        9717,
        9831
      ]
    },
    {
      "content": "As a best practice, you should define each table in a Javascript file in the tables directory, then use the tables.import() method to import the tables.",
      "pos": [
        9833,
        9985
      ]
    },
    {
      "content": "Extending the basic-app, the app.js file would be adjusted:",
      "pos": [
        9986,
        10045
      ]
    },
    {
      "content": "Define the table in ./tables/TodoItem.js:",
      "pos": [
        10594,
        10635
      ]
    },
    {
      "content": "Tables use dynamic schema by default.",
      "pos": [
        10822,
        10859
      ]
    },
    {
      "content": "To turn off dynamic schema globally, set the App Setting <bpt id=\"p1\">**</bpt>MS_DynamicSchema<ept id=\"p1\">**</ept> to false within the Azure Portal.",
      "pos": [
        10861,
        10972
      ]
    },
    {
      "pos": [
        10974,
        11037
      ],
      "content": "You can find a complete example in the <bpt id=\"p1\">[</bpt><ept id=\"p1\">todo sample on GitHub]</ept>."
    },
    {
      "pos": [
        11042,
        11118
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-staticschema\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Define tables using a static schema"
    },
    {
      "content": "You can explicitly define the columns to expose via the WebAPI.",
      "pos": [
        11120,
        11183
      ]
    },
    {
      "content": "The azure-mobile-apps Node.js SDK will automatically add any additional columns required for offline data sync to the list that you provide.",
      "pos": [
        11185,
        11325
      ]
    },
    {
      "content": "For example, the QuickStart client applications require a table with two columns: text (a string) and complete (a boolean).",
      "pos": [
        11327,
        11450
      ]
    },
    {
      "content": "This can be defined in the table definition JavaScript file (located in the tables directory) as follows:",
      "pos": [
        11452,
        11557
      ]
    },
    {
      "content": "If you define tables statically, then you must also call the tables.initialize() method to create the database schema on startup.",
      "pos": [
        11881,
        12010
      ]
    },
    {
      "content": "The tables.initialize() method returns a <bpt id=\"p1\">[</bpt><ept id=\"p1\">Promise]</ept> - this is used to ensure that the web service does not serve requests prior to the database being initialized.",
      "pos": [
        12012,
        12173
      ]
    },
    {
      "pos": [
        12178,
        12288
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-sqlexpress-setup\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Use SQL Express as a development data store on your local machine"
    },
    {
      "content": "The Azure Mobile Apps The AzureMobile Apps Node SDK provides three options for serving data out of the box: SDK provides three options for serving data out of the box:",
      "pos": [
        12290,
        12457
      ]
    },
    {
      "pos": [
        12461,
        12528
      ],
      "content": "Use the <bpt id=\"p1\">**</bpt>memory<ept id=\"p1\">**</ept> driver to provide a non-persistent example store"
    },
    {
      "pos": [
        12531,
        12607
      ],
      "content": "Use the <bpt id=\"p1\">**</bpt>mssql<ept id=\"p1\">**</ept> driver to provide a SQL Express data store for development"
    },
    {
      "pos": [
        12610,
        12693
      ],
      "content": "Use the <bpt id=\"p1\">**</bpt>mssql<ept id=\"p1\">**</ept> driver to provide an Azure SQL Database data store for production"
    },
    {
      "content": "The Azure Mobile Apps Node.js SDK uses the <bpt id=\"p1\">[</bpt><ept id=\"p1\">mssql Node.js package]</ept> to establish and use a connection to both SQL Express and SQL Database.",
      "pos": [
        12695,
        12833
      ]
    },
    {
      "content": "This package requires that you enable TCP connections on your SQL Express instance.",
      "pos": [
        12835,
        12918
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> The memory driver does not provide a complete set of facilities for testing.",
      "pos": [
        12922,
        13010
      ]
    },
    {
      "content": "If you wish to test your backend locally,",
      "pos": [
        13012,
        13053
      ]
    },
    {
      "content": "we recommend the use of a SQL Express data store and the mssql driver.",
      "pos": [
        13054,
        13124
      ]
    },
    {
      "content": "Download and install <bpt id=\"p1\">[</bpt><ept id=\"p1\">Microsoft SQL Server 2014 Express]</ept>.",
      "pos": [
        13129,
        13186
      ]
    },
    {
      "content": "Ensure you install the SQL Server 2014 Express with Tools edition.",
      "pos": [
        13188,
        13254
      ]
    },
    {
      "content": "Unless you explicitly",
      "pos": [
        13256,
        13277
      ]
    },
    {
      "content": "require 64 Bit support, the 32 Bit version will consume less memory when running.",
      "pos": [
        13278,
        13359
      ]
    },
    {
      "content": "Run the SQL Server 2014 Configuration Manager.",
      "pos": [
        13364,
        13410
      ]
    },
    {
      "pos": [
        13417,
        13497
      ],
      "content": "Expand the <bpt id=\"p1\">**</bpt>SQL Server Network Configuration<ept id=\"p1\">**</ept> node in the left hand tree menu."
    },
    {
      "pos": [
        13503,
        13541
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>Protocols for SQLEXPRESS<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Right-click on <bpt id=\"p1\">**</bpt>TCP/IP<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Enable<ept id=\"p2\">**</ept>.",
      "pos": [
        13547,
        13595
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> in the pop-up dialog.",
      "pos": [
        13597,
        13634
      ]
    },
    {
      "pos": [
        13640,
        13692
      ],
      "content": "Right-click on <bpt id=\"p1\">**</bpt>TCP/IP<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        13698,
        13732
      ],
      "content": "Click on the <bpt id=\"p1\">**</bpt>IP Addresses<ept id=\"p1\">**</ept> tab."
    },
    {
      "content": "Find the <bpt id=\"p1\">**</bpt>IPAll<ept id=\"p1\">**</ept> node.",
      "pos": [
        13738,
        13762
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>TCP Port<ept id=\"p1\">**</ept> field, enter <bpt id=\"p2\">**</bpt>1433<ept id=\"p2\">**</ept>.",
      "pos": [
        13764,
        13806
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        13861,
        13877
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> in the pop-up dialog.",
      "pos": [
        13879,
        13916
      ]
    },
    {
      "pos": [
        13922,
        13982
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>SQL Server Services<ept id=\"p1\">**</ept> in the left hand tree menu."
    },
    {
      "pos": [
        13988,
        14053
      ],
      "content": "Right-click on <bpt id=\"p1\">**</bpt>SQL Server (SQLEXPRESS)<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Restart<ept id=\"p2\">**</ept>"
    },
    {
      "content": "Close the SQL Server 2014 Configuration Manager.",
      "pos": [
        14060,
        14108
      ]
    },
    {
      "content": "Run the SQL Server 2014 Management Studio and connect to your local SQL Express instance",
      "pos": [
        14113,
        14201
      ]
    },
    {
      "pos": [
        14208,
        14285
      ],
      "content": "Right-click on your instance in the Object Explorer and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        14291,
        14320
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> page."
    },
    {
      "pos": [
        14326,
        14395
      ],
      "content": "Ensure the <bpt id=\"p1\">**</bpt>SQL Server and Windows Authentication mode<ept id=\"p1\">**</ept> is selected"
    },
    {
      "pos": [
        14401,
        14416
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>"
    },
    {
      "content": "Configure SQL Express Authentication",
      "pos": [
        14428,
        14464
      ]
    },
    {
      "pos": [
        14475,
        14530
      ],
      "content": "Expand <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Logins<ept id=\"p2\">**</ept> in the Object Explorer"
    },
    {
      "pos": [
        14536,
        14589
      ],
      "content": "Right-click on <bpt id=\"p1\">**</bpt>Logins<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>New Login...<ept id=\"p2\">**</ept>"
    },
    {
      "content": "Enter a Login name.",
      "pos": [
        14595,
        14614
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>SQL Server authentication<ept id=\"p1\">**</ept>.",
      "pos": [
        14616,
        14653
      ]
    },
    {
      "content": "Enter a Password, then enter the same password in <bpt id=\"p1\">**</bpt>Confirm password<ept id=\"p1\">**</ept>.",
      "pos": [
        14655,
        14726
      ]
    },
    {
      "content": "Note that the password must meet Windows complexity requirement.",
      "pos": [
        14728,
        14792
      ]
    },
    {
      "pos": [
        14798,
        14813
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>"
    },
    {
      "content": "Add a new user to SQL Express",
      "pos": [
        14825,
        14854
      ]
    },
    {
      "pos": [
        14865,
        14920
      ],
      "content": "Right-click on your new login and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        14927,
        14959
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Server Roles<ept id=\"p1\">**</ept> page"
    },
    {
      "pos": [
        14966,
        15017
      ],
      "content": "Check the box next to the <bpt id=\"p1\">**</bpt>dbcreator<ept id=\"p1\">**</ept> server role"
    },
    {
      "pos": [
        15024,
        15039
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>"
    },
    {
      "content": "Close the SQL Server 2015 Management Studio",
      "pos": [
        15046,
        15089
      ]
    },
    {
      "content": "Ensure you record the username and password you selected.",
      "pos": [
        15091,
        15148
      ]
    },
    {
      "content": "You may need to assign additional server roles or permissions depending on your specific database requirements.",
      "pos": [
        15150,
        15261
      ]
    },
    {
      "content": "The Node.js application will read the <bpt id=\"p1\">**</bpt>SQLCONNSTR_MS_TableConnectionString<ept id=\"p1\">**</ept> environment variable to read the connection string for this database.",
      "pos": [
        15263,
        15410
      ]
    },
    {
      "content": "You can set this within your environment.",
      "pos": [
        15412,
        15453
      ]
    },
    {
      "content": "For example, you can use PowerShell to set this environment variable:",
      "pos": [
        15455,
        15524
      ]
    },
    {
      "content": "Note that you must access the database through a TCP/IP connection and provide a username and password for the connection.",
      "pos": [
        15663,
        15785
      ]
    },
    {
      "pos": [
        15790,
        15878
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-config-localdev\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Configure your project for local development"
    },
    {
      "content": "Azure Mobile Apps reads a JavaScript file called <bpt id=\"p1\">_</bpt>azureMobile.js<ept id=\"p1\">_</ept> from the local filesystem.",
      "pos": [
        15880,
        15972
      ]
    },
    {
      "content": "You should not use this file to configure the Azure Mobile Apps SDK in production - use App Settings within the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept> instead.",
      "pos": [
        15974,
        16109
      ]
    },
    {
      "content": "The <bpt id=\"p1\">_</bpt>azureMobile.js<ept id=\"p1\">_</ept> file should export a configuration object.",
      "pos": [
        16111,
        16174
      ]
    },
    {
      "content": "The most common settings are:",
      "pos": [
        16176,
        16205
      ]
    },
    {
      "content": "Database Settings",
      "pos": [
        16209,
        16226
      ]
    },
    {
      "content": "Diagnostic Logging Settings",
      "pos": [
        16229,
        16256
      ]
    },
    {
      "content": "Alternate CORS Settings",
      "pos": [
        16259,
        16282
      ]
    },
    {
      "pos": [
        16284,
        16373
      ],
      "content": "An example <bpt id=\"p1\">_</bpt>azureMobile.js<ept id=\"p1\">_</ept> file implementing the database settings given above is below:"
    },
    {
      "content": "We recommend that you add <bpt id=\"p1\">_</bpt>azureMobile.js<ept id=\"p1\">_</ept> to your <bpt id=\"p2\">_</bpt>.gitignore<ept id=\"p2\">_</ept> file (or other source code control ignore file) to prevent passwords from",
      "pos": [
        16729,
        16866
      ]
    },
    {
      "content": "being stored in the cloud.",
      "pos": [
        16867,
        16893
      ]
    },
    {
      "content": "Always configure production settings in App Settings within the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept>.",
      "pos": [
        16895,
        16974
      ]
    },
    {
      "pos": [
        16979,
        17058
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-appsettings\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How: Configure App Settings for your Mobile App"
    },
    {
      "content": "Most settings in the <bpt id=\"p1\">_</bpt>azureMobile.js<ept id=\"p1\">_</ept> file have an equivalent App Setting in the <bpt id=\"p2\">[</bpt><ept id=\"p2\">Azure Portal]</ept>.",
      "pos": [
        17060,
        17156
      ]
    },
    {
      "content": "Use the following list to configure your",
      "pos": [
        17158,
        17198
      ]
    },
    {
      "content": "app in App Settings:",
      "pos": [
        17199,
        17219
      ]
    },
    {
      "content": "App Setting",
      "pos": [
        17223,
        17234
      ]
    },
    {
      "pos": [
        17253,
        17277
      ],
      "content": "<bpt id=\"p1\">_</bpt>azureMobile.js<ept id=\"p1\">_</ept> Setting"
    },
    {
      "content": "Description",
      "pos": [
        17281,
        17292
      ]
    },
    {
      "content": "Valid Values",
      "pos": [
        17325,
        17337
      ]
    },
    {
      "content": "MS_MobileAppName",
      "pos": [
        17525,
        17541
      ]
    },
    {
      "content": "name",
      "pos": [
        17553,
        17557
      ]
    },
    {
      "content": "The name of the app",
      "pos": [
        17581,
        17600
      ]
    },
    {
      "content": "string",
      "pos": [
        17625,
        17631
      ]
    },
    {
      "content": "MS_MobileLoggingLevel",
      "pos": [
        17675,
        17696
      ]
    },
    {
      "content": "logging.level",
      "pos": [
        17703,
        17716
      ]
    },
    {
      "content": "Minimum log level of messages to log",
      "pos": [
        17731,
        17767
      ]
    },
    {
      "content": "error, warning, info, verbose, debug, silly",
      "pos": [
        17775,
        17818
      ]
    },
    {
      "content": "MS_DebugMode",
      "pos": [
        17825,
        17837
      ]
    },
    {
      "content": "debug",
      "pos": [
        17853,
        17858
      ]
    },
    {
      "content": "Enable or Disable debug mode",
      "pos": [
        17881,
        17909
      ]
    },
    {
      "content": "true, false",
      "pos": [
        17925,
        17936
      ]
    },
    {
      "content": "MS_TableSchema",
      "pos": [
        17975,
        17989
      ]
    },
    {
      "content": "data.schema",
      "pos": [
        18003,
        18014
      ]
    },
    {
      "content": "Default schema name for SQL tables",
      "pos": [
        18031,
        18065
      ]
    },
    {
      "content": "string (default: dbo)",
      "pos": [
        18075,
        18096
      ]
    },
    {
      "content": "MS_DynamicSchema",
      "pos": [
        18125,
        18141
      ]
    },
    {
      "content": "data.dynamicSchema",
      "pos": [
        18153,
        18171
      ]
    },
    {
      "content": "Enable or Disable debug mode",
      "pos": [
        18181,
        18209
      ]
    },
    {
      "content": "true, false",
      "pos": [
        18225,
        18236
      ]
    },
    {
      "content": "MS_DisableVersionHeader",
      "pos": [
        18275,
        18298
      ]
    },
    {
      "content": "version (set to undefined)",
      "pos": [
        18303,
        18329
      ]
    },
    {
      "content": "Disables the X-ZUMO-Server-Version header",
      "pos": [
        18331,
        18372
      ]
    },
    {
      "content": "true, false",
      "pos": [
        18375,
        18386
      ]
    },
    {
      "content": "MS_SkipVersionCheck",
      "pos": [
        18425,
        18444
      ]
    },
    {
      "content": "skipversioncheck",
      "pos": [
        18453,
        18469
      ]
    },
    {
      "content": "Disables the client API version check",
      "pos": [
        18481,
        18518
      ]
    },
    {
      "content": "true, false",
      "pos": [
        18525,
        18536
      ]
    },
    {
      "content": "To set an App Setting:",
      "pos": [
        18572,
        18594
      ]
    },
    {
      "pos": [
        18599,
        18627
      ],
      "content": "Log into the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept>."
    },
    {
      "pos": [
        18631,
        18718
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>All resources<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>App Services<ept id=\"p2\">**</ept> then click on the name of your Mobile App."
    },
    {
      "pos": [
        18722,
        18801
      ],
      "content": "The Settings blade will open by default - if it doesn't, click on <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18805,
        18859
      ],
      "content": "Click on <bpt id=\"p1\">**</bpt>Application settings<ept id=\"p1\">**</ept> in the GENERAL menu."
    },
    {
      "content": "Scroll to the App Settings section.",
      "pos": [
        18863,
        18898
      ]
    },
    {
      "content": "If your app setting already exists, click on the value of the app setting to edit the value.",
      "pos": [
        18902,
        18994
      ]
    },
    {
      "content": "If you app setting does not exist, enter the App Setting in the Key box and the value in the Value box.",
      "pos": [
        18998,
        19101
      ]
    },
    {
      "pos": [
        19105,
        19146
      ],
      "content": "Once you are complete, click on <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Changing most app settings will require a service restart.",
      "pos": [
        19148,
        19206
      ]
    },
    {
      "pos": [
        19211,
        19298
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-use-sqlazure\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Use SQL Database as your production data store"
    },
    {
      "content": "Using Azure SQL Database as a data store is identical across all Azure App Service application types.",
      "pos": [
        19443,
        19544
      ]
    },
    {
      "content": "If you have not done so already, follow these steps to create a new Mobile App backend.",
      "pos": [
        19545,
        19632
      ]
    },
    {
      "pos": [
        19637,
        19665
      ],
      "content": "Log into the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept>."
    },
    {
      "pos": [
        19670,
        19812
      ],
      "content": "In the top left of the window, click the <bpt id=\"p1\">**</bpt>+NEW<ept id=\"p1\">**</ept> button &gt; <bpt id=\"p2\">**</bpt>Web + Mobile<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Mobile App<ept id=\"p3\">**</ept>, then provide a name for your Mobile App backend."
    },
    {
      "pos": [
        19817,
        19880
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Resource Group<ept id=\"p1\">**</ept> box, enter the same name as your app."
    },
    {
      "content": "The Default App Service plan will be selected.",
      "pos": [
        19885,
        19931
      ]
    },
    {
      "content": "If you wish to change your App Service plan, you can do so by clicking on the App Service Plan &gt; <bpt id=\"p1\">**</bpt>+ Create New<ept id=\"p1\">**</ept>.",
      "pos": [
        19933,
        20047
      ]
    },
    {
      "content": "Provide a name of the new App Service plan and select an appropriate location.",
      "pos": [
        20049,
        20127
      ]
    },
    {
      "content": "Click the Pricing tier and select an appropriate pricing tier for the service.",
      "pos": [
        20129,
        20207
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>View all<ept id=\"p1\">**</ept> to view more pricing options, such as <bpt id=\"p2\">**</bpt>Free<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Shared<ept id=\"p3\">**</ept>.",
      "pos": [
        20208,
        20290
      ]
    },
    {
      "content": "Once you have selected the pricing tier, click the <bpt id=\"p1\">**</bpt>Select<ept id=\"p1\">**</ept> button.",
      "pos": [
        20292,
        20361
      ]
    },
    {
      "content": "Back in the <bpt id=\"p1\">**</bpt>App Service plan<ept id=\"p1\">**</ept> blade, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.",
      "pos": [
        20363,
        20416
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>.",
      "pos": [
        20421,
        20438
      ]
    },
    {
      "content": "This creates a Mobile App backend where you will later deploy your server project.",
      "pos": [
        20439,
        20521
      ]
    },
    {
      "content": "Provisioning a Mobile App backend can take a couple of minutes.",
      "pos": [
        20523,
        20586
      ]
    },
    {
      "content": "Once the Mobile App backend is provisioned, the portal will open the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> blade for the Mobile App backend.",
      "pos": [
        20588,
        20703
      ]
    },
    {
      "content": "Once the Mobile App backend is created, you can choose to either connect an existing SQL database to your Mobile App backend or create a new SQL database.",
      "pos": [
        20705,
        20859
      ]
    },
    {
      "content": "In this section, we will create a new SQL database.",
      "pos": [
        20861,
        20912
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you already have a database in the same location as the new mobile app backend, you can instead choose <bpt id=\"p1\">**</bpt>Use an existing database<ept id=\"p1\">**</ept> and then select that database.",
      "pos": [
        20916,
        21094
      ]
    },
    {
      "content": "The use of a database in a different location is not recommended because of additional bandwidth costs and higher latencies.",
      "pos": [
        21095,
        21219
      ]
    },
    {
      "pos": [
        21224,
        21313
      ],
      "content": "In the new Mobile App backend, click <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Mobile App<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Data<ept id=\"p3\">**</ept> &gt; <bpt id=\"p4\">**</bpt>+Add<ept id=\"p4\">**</ept>."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Add data connection<ept id=\"p1\">**</ept> blade, click <bpt id=\"p2\">**</bpt>SQL Database - Configure required settings<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Create a new database<ept id=\"p3\">**</ept>.",
      "pos": [
        21318,
        21437
      ]
    },
    {
      "content": "Enter the name of the new database in the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> field.",
      "pos": [
        21439,
        21496
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Server<ept id=\"p1\">**</ept>.",
      "pos": [
        21501,
        21518
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>New server<ept id=\"p1\">**</ept> blade, enter a unique server name in the <bpt id=\"p2\">**</bpt>Server name<ept id=\"p2\">**</ept> field, and provide a suitable <bpt id=\"p3\">**</bpt>Server admin login<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Password<ept id=\"p4\">**</ept>.",
      "pos": [
        21520,
        21669
      ]
    },
    {
      "content": "Ensure <bpt id=\"p1\">**</bpt>Allow azure services to access server<ept id=\"p1\">**</ept> is checked.",
      "pos": [
        21671,
        21731
      ]
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        21733,
        21749
      ]
    },
    {
      "content": "Create an Azure SQL Database",
      "pos": [
        21757,
        21785
      ]
    },
    {
      "pos": [
        21794,
        21841
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>New database<ept id=\"p1\">**</ept> blade, click on <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Back on the <bpt id=\"p1\">**</bpt>Add data connection<ept id=\"p1\">**</ept> blade, select <bpt id=\"p2\">**</bpt>Connection string<ept id=\"p2\">**</ept>, enter the login and password that you just provided when creating the database.",
      "pos": [
        21847,
        21999
      ]
    },
    {
      "content": "If you use an existing database, provide the login credentials for that database.",
      "pos": [
        22001,
        22082
      ]
    },
    {
      "content": "Once entered, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        22084,
        22111
      ]
    },
    {
      "pos": [
        22117,
        22205
      ],
      "content": "Back on the <bpt id=\"p1\">**</bpt>Add data connection<ept id=\"p1\">**</ept> blade again, click on <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept> to create the database."
    },
    {
      "content": "Creation of the database can take a few minutes.",
      "pos": [
        22243,
        22291
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">**</bpt>Notifications<ept id=\"p1\">**</ept> area to monitor the progress of the deployment.",
      "pos": [
        22293,
        22366
      ]
    },
    {
      "content": "Do not progress until the database has been deployed sucessfully.",
      "pos": [
        22368,
        22433
      ]
    },
    {
      "content": "Once successfully deployed, a Connection String will be created for the SQL Database instance in your Mobile backend App Settings.",
      "pos": [
        22435,
        22565
      ]
    },
    {
      "content": "You can see this app setting in the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Application settings<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Connection strings<ept id=\"p3\">**</ept>.",
      "pos": [
        22567,
        22668
      ]
    },
    {
      "pos": [
        22673,
        22756
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-tables-auth\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Require Authentication for access to tables"
    },
    {
      "content": "If you wish to use App Service Authentication with the tables endpoint, you must configure App Service Authentication in the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept> first.",
      "pos": [
        22758,
        22904
      ]
    },
    {
      "content": "For",
      "pos": [
        22906,
        22909
      ]
    },
    {
      "content": "more details about configuring authentication in an Azure App Service, review the Configuration Guide for the identity provider you intend to use:",
      "pos": [
        22910,
        23056
      ]
    },
    {
      "content": "How to configure Azure Active Directory Authentication",
      "pos": [
        23061,
        23115
      ]
    },
    {
      "content": "How to configure Facebook Authentication",
      "pos": [
        23120,
        23160
      ]
    },
    {
      "content": "How to configure Google Authentication",
      "pos": [
        23165,
        23203
      ]
    },
    {
      "content": "How to configure Microsoft Authentication",
      "pos": [
        23208,
        23249
      ]
    },
    {
      "content": "How to configure Twitter Authentication",
      "pos": [
        23254,
        23293
      ]
    },
    {
      "content": "Each table has an access property that can be used to control access to the table.",
      "pos": [
        23296,
        23378
      ]
    },
    {
      "content": "The following sample shows a statically defined table with authentication required.",
      "pos": [
        23380,
        23463
      ]
    },
    {
      "content": "The access property can take one of three values",
      "pos": [
        23874,
        23922
      ]
    },
    {
      "pos": [
        23928,
        24024
      ],
      "content": "<bpt id=\"p1\">*</bpt>anonymous<ept id=\"p1\">*</ept> indicates that the client application is allowed to read data without authentication"
    },
    {
      "pos": [
        24029,
        24138
      ],
      "content": "<bpt id=\"p1\">*</bpt>authenticated<ept id=\"p1\">*</ept> indicates that the client application must send a valid authentication token with the request"
    },
    {
      "pos": [
        24143,
        24201
      ],
      "content": "<bpt id=\"p1\">*</bpt>disabled<ept id=\"p1\">*</ept> indicates that this table is currently disabled"
    },
    {
      "content": "If the access property is undefined, unauthenticated access is allowed.",
      "pos": [
        24203,
        24274
      ]
    },
    {
      "pos": [
        24279,
        24368
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-tables-getidentity\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Use Authentication Claims with your tables"
    },
    {
      "content": "You can set up a number of claims that are requested when authentication is set up.",
      "pos": [
        24370,
        24453
      ]
    },
    {
      "content": "These claims are not normally available through the <ph id=\"ph1\">`context.user`</ph> object.",
      "pos": [
        24455,
        24529
      ]
    },
    {
      "content": "However, they can be retrieved using the <ph id=\"ph1\">`context.user.getIdentity()`</ph> method.",
      "pos": [
        24530,
        24607
      ]
    },
    {
      "content": "The <ph id=\"ph1\">`getIdentity()`</ph> method returns a Promise that resolves to an object.",
      "pos": [
        24609,
        24681
      ]
    },
    {
      "content": "The object",
      "pos": [
        24683,
        24693
      ]
    },
    {
      "content": "is keyed by the authentication method (facebook, google, twitter, microsoftaccount or aad).",
      "pos": [
        24694,
        24785
      ]
    },
    {
      "content": "For example, if you set up Microsoft Account authentication and request the email addresses claim, you can add the email address to the record with the following:",
      "pos": [
        24787,
        24949
      ]
    },
    {
      "pos": [
        26753,
        26851
      ],
      "content": "To see what claims are available, use a web browser to view the <ph id=\"ph1\">`/.auth/me`</ph> endpoint of your site."
    },
    {
      "pos": [
        26856,
        26943
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-tables-disabled\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Disable access to specific table operations"
    },
    {
      "content": "In addition to appearing on the table, the access property can be used to control individual operations.",
      "pos": [
        26945,
        27049
      ]
    },
    {
      "content": "There are four operations:",
      "pos": [
        27051,
        27077
      ]
    },
    {
      "pos": [
        27083,
        27131
      ],
      "content": "<bpt id=\"p1\">*</bpt>read<ept id=\"p1\">*</ept> is the RESTful GET operation on the table"
    },
    {
      "pos": [
        27136,
        27187
      ],
      "content": "<bpt id=\"p1\">*</bpt>insert<ept id=\"p1\">*</ept> is the RESTful POST operation on the table"
    },
    {
      "pos": [
        27192,
        27244
      ],
      "content": "<bpt id=\"p1\">*</bpt>update<ept id=\"p1\">*</ept> is the RESTful PATCH operation on the table"
    },
    {
      "pos": [
        27249,
        27302
      ],
      "content": "<bpt id=\"p1\">*</bpt>delete<ept id=\"p1\">*</ept> is the RESTful DELETE operation on the table"
    },
    {
      "content": "For example, you may wish to provide a read-only unauthenticated table.",
      "pos": [
        27304,
        27375
      ]
    },
    {
      "content": "This can be provided by the following table definition:",
      "pos": [
        27377,
        27432
      ]
    },
    {
      "pos": [
        27769,
        27861
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-tables-query\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Adjust the query that is used with table operations"
    },
    {
      "content": "A common requirement for table operations is to provide a restricted view of the data.",
      "pos": [
        27863,
        27949
      ]
    },
    {
      "content": "For example, you may provide a table that is",
      "pos": [
        27951,
        27995
      ]
    },
    {
      "content": "tagged with the authenticated user ID such that the user can only read or update their own records.",
      "pos": [
        27996,
        28095
      ]
    },
    {
      "content": "The following table definition",
      "pos": [
        28097,
        28127
      ]
    },
    {
      "content": "will provide this functionality:",
      "pos": [
        28128,
        28160
      ]
    },
    {
      "content": "Operations that normally execute a query will have a query property that you can adjust with a where clause.",
      "pos": [
        28985,
        29093
      ]
    },
    {
      "content": "The query property is",
      "pos": [
        29097,
        29118
      ]
    },
    {
      "content": "a <bpt id=\"p1\">[</bpt><ept id=\"p1\">QueryJS]</ept> object that is used to convert an OData query to something that the data backend can process.",
      "pos": [
        29119,
        29224
      ]
    },
    {
      "content": "For simple equality cases",
      "pos": [
        29226,
        29251
      ]
    },
    {
      "content": "(like the one above), a map can be used.",
      "pos": [
        29252,
        29292
      ]
    },
    {
      "content": "It is also relatively easy to add specific SQL clauses:",
      "pos": [
        29293,
        29348
      ]
    },
    {
      "pos": [
        29404,
        29482
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-tables-softdelete\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Configure Soft Delete on a table"
    },
    {
      "content": "Soft Delete does not actually delete records.",
      "pos": [
        29484,
        29529
      ]
    },
    {
      "content": "Instead it marks them as deleted within the database by setting the deleted column to true.",
      "pos": [
        29531,
        29622
      ]
    },
    {
      "content": "The Azure Mobile Apps SDK automatically removes soft-deleted records from results unless the Mobile Client SDK uses IncludeDeleted().",
      "pos": [
        29624,
        29757
      ]
    },
    {
      "content": "To configure a table for soft delete, set the softDelete property in the table definition file.",
      "pos": [
        29759,
        29854
      ]
    },
    {
      "content": "An example might be:",
      "pos": [
        29856,
        29876
      ]
    },
    {
      "content": "You will need to establish a mechanism for purging records - either from a client application, via a WebJob or through a custom mechanism.",
      "pos": [
        30344,
        30482
      ]
    },
    {
      "pos": [
        30487,
        30558
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-tables-seeding\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Seed your database with data"
    },
    {
      "content": "When creating a new application, you may wish to seed a table with data.",
      "pos": [
        30560,
        30632
      ]
    },
    {
      "content": "This can be done within the table definition JavaScript file as",
      "pos": [
        30634,
        30697
      ]
    },
    {
      "content": "follows:",
      "pos": [
        30698,
        30706
      ]
    },
    {
      "content": "It is important to note that seeding of data is only done when the table is created by the Azure Mobile Apps SDK.",
      "pos": [
        31237,
        31350
      ]
    },
    {
      "content": "If the table already",
      "pos": [
        31352,
        31372
      ]
    },
    {
      "content": "exists within the database, no data is injected into the table.",
      "pos": [
        31373,
        31436
      ]
    },
    {
      "content": "If dynamic schema is turned on, then the schema will be inferred from",
      "pos": [
        31438,
        31507
      ]
    },
    {
      "content": "the seeded data.",
      "pos": [
        31508,
        31524
      ]
    },
    {
      "content": "We recommend that you explicitly call the initialize() method to create the table when the service starts running.",
      "pos": [
        31526,
        31640
      ]
    },
    {
      "pos": [
        31645,
        31697
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"Swagger\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Enable Swagger Support"
    },
    {
      "content": "Azure App Service Mobile Apps comes with built-in <bpt id=\"p1\">[</bpt><ept id=\"p1\">Swagger]</ept> support.",
      "pos": [
        31699,
        31767
      ]
    },
    {
      "content": "To enable Swagger support, first install the swagger-ui as a dependency:",
      "pos": [
        31769,
        31841
      ]
    },
    {
      "content": "Once installed, you can enable Swagger support in the Azure Mobile Apps constructor:",
      "pos": [
        31878,
        31962
      ]
    },
    {
      "content": "You probably only want to enable Swagger support in development editions.",
      "pos": [
        32018,
        32091
      ]
    },
    {
      "content": "You can do this by utilizing the <ph id=\"ph1\">`NODE_ENV`</ph> app setting:",
      "pos": [
        32093,
        32149
      ]
    },
    {
      "content": "The swagger endpoint will be located at http://<bpt id=\"p1\">_</bpt>yoursite<ept id=\"p1\">_</ept>.azurewebsites.net/swagger.",
      "pos": [
        32238,
        32322
      ]
    },
    {
      "content": "You can access the Swagger UI via the <ph id=\"ph1\">`/swagger/ui`</ph> endpoint.",
      "pos": [
        32324,
        32385
      ]
    },
    {
      "content": "Note that Swagger produces an error for the / endpoint if you choose to require authentication across your entire application.",
      "pos": [
        32386,
        32512
      ]
    },
    {
      "content": "For best",
      "pos": [
        32514,
        32522
      ]
    },
    {
      "content": "results, choose to allow unauthenticated requests through in the Azure App Service Authentication / Authorization settings, then control",
      "pos": [
        32523,
        32659
      ]
    },
    {
      "content": "authentication using the <ph id=\"ph1\">`table.access`</ph> property.",
      "pos": [
        32660,
        32709
      ]
    },
    {
      "pos": [
        32711,
        32834
      ],
      "content": "You can also add the Swagger option to your <ph id=\"ph1\">`azureMobile.js`</ph> file if you only want Swagger support when developing locally."
    },
    {
      "pos": [
        32839,
        32886
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"push\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Overview: Push notifications"
    },
    {
      "content": "Mobile Apps integrates with Azure Notification Hubs to enable you to send targeted push notifications to millions of devices across all major platforms.",
      "pos": [
        32887,
        33039
      ]
    },
    {
      "content": "By using Notification Hubs, you can send push notifications to iOS, Android and Windows devices.",
      "pos": [
        33040,
        33136
      ]
    },
    {
      "content": "To learn more about all that you can do with Notification Hubs, see <bpt id=\"p1\">[</bpt>Notification Hubs Overview<ept id=\"p1\">](../notification-hubs/notification-hubs-overview.md)</ept>.",
      "pos": [
        33137,
        33286
      ]
    },
    {
      "pos": [
        33291,
        33346
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"send-push\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Send push notifications"
    },
    {
      "content": "The following code shows how to use the push object to send a broadcast push notification to registered iOS devices:",
      "pos": [
        33348,
        33464
      ]
    },
    {
      "content": "By creating a template push registration from the client, you can instead send a template push message to devices on all supported platforms.",
      "pos": [
        33849,
        33990
      ]
    },
    {
      "content": "The following code shows how to send a template notification:",
      "pos": [
        33991,
        34052
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"push-user\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Send push notifications to an authenticated user using tags",
      "pos": [
        34434,
        34525
      ]
    },
    {
      "content": "When an authenticated user registers for push notifications, a user ID tag is automatically added to the registration.",
      "pos": [
        34526,
        34644
      ]
    },
    {
      "content": "By using this tag, you can send push notifications to all devices registered by a specific user.",
      "pos": [
        34645,
        34741
      ]
    },
    {
      "content": "The following code gets the SID of user making the request and sends a template push notification to every device registration for that user:",
      "pos": [
        34742,
        34883
      ]
    },
    {
      "content": "When registering for push notifications from an authenticated client, make sure that authentication is complete before attempting registration.",
      "pos": [
        35178,
        35321
      ]
    },
    {
      "pos": [
        35326,
        35371
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"CustomAPI\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Overview: Custom APIs"
    },
    {
      "content": "In addition to the data access API via the /tables endpoint, Azure Mobile Apps can provide custom API coverage.",
      "pos": [
        35373,
        35484
      ]
    },
    {
      "content": "Custom",
      "pos": [
        35486,
        35492
      ]
    },
    {
      "content": "APIs are defined in a similar way to the table definitions and can access all the same facilities, including authentication.",
      "pos": [
        35493,
        35617
      ]
    },
    {
      "content": "If you wish to use App Service Authentication with a Custom API, you must configure App Service Authentication",
      "pos": [
        35619,
        35729
      ]
    },
    {
      "content": "in the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept> first.",
      "pos": [
        35730,
        35758
      ]
    },
    {
      "content": "For more details about configuring authentication in an  Azure App Service, review",
      "pos": [
        35760,
        35842
      ]
    },
    {
      "content": "the Configuration Guide for the identity provider you intend to use:",
      "pos": [
        35843,
        35911
      ]
    },
    {
      "content": "How to configure Azure Active Directory Authentication",
      "pos": [
        35916,
        35970
      ]
    },
    {
      "content": "How to configure Facebook Authentication",
      "pos": [
        35975,
        36015
      ]
    },
    {
      "content": "How to configure Google Authentication",
      "pos": [
        36020,
        36058
      ]
    },
    {
      "content": "How to configure Microsoft Authentication",
      "pos": [
        36063,
        36104
      ]
    },
    {
      "content": "How to configure Twitter Authentication",
      "pos": [
        36109,
        36148
      ]
    },
    {
      "pos": [
        36154,
        36224
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-customapi-basic\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Define a simple custom API"
    },
    {
      "content": "Custom APIs are defined in much the same way as the Tables API.",
      "pos": [
        36226,
        36289
      ]
    },
    {
      "pos": [
        36294,
        36321
      ],
      "content": "Create an <bpt id=\"p1\">**</bpt>api<ept id=\"p1\">**</ept> directory"
    },
    {
      "pos": [
        36325,
        36391
      ],
      "content": "Create an API definition JavaScript file in the <bpt id=\"p1\">**</bpt>api<ept id=\"p1\">**</ept> directory."
    },
    {
      "pos": [
        36395,
        36449
      ],
      "content": "Use the import method to import the <bpt id=\"p1\">**</bpt>api<ept id=\"p1\">**</ept> directory."
    },
    {
      "content": "Here is the prototype api definition based on the basic-app sample we used earlier.",
      "pos": [
        36451,
        36534
      ]
    },
    {
      "content": "Let's take a simple API that will return the server date using the <bpt id=\"p1\">_</bpt>Date.now()<ept id=\"p1\">_</ept> method.",
      "pos": [
        36910,
        36997
      ]
    },
    {
      "content": "Here is the api/date.js file:",
      "pos": [
        36999,
        37028
      ]
    },
    {
      "content": "Each parameter is one of the standard RESTful verbs - GET, POST, PATCH or DELETE.",
      "pos": [
        37251,
        37332
      ]
    },
    {
      "content": "The method is a standard <bpt id=\"p1\">[</bpt><ept id=\"p1\">ExpressJS Middleware]</ept> function that sends the required output.",
      "pos": [
        37334,
        37422
      ]
    },
    {
      "pos": [
        37427,
        37519
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-customapi-auth\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Require authentication for access to a custom API"
    },
    {
      "content": "Azure Mobile Apps SDK implements authentication in the same way for both the tables endpoint and custom APIs.",
      "pos": [
        37521,
        37630
      ]
    },
    {
      "content": "To add authentication to the API developed in the previous section, add an <bpt id=\"p1\">**</bpt>access<ept id=\"p1\">**</ept> property:",
      "pos": [
        37632,
        37727
      ]
    },
    {
      "content": "You can also specify authentication on specific operations:",
      "pos": [
        38026,
        38085
      ]
    },
    {
      "content": "The same token that is used for the tables endpoint must be used for custom APIs requiring authentication.",
      "pos": [
        38390,
        38496
      ]
    },
    {
      "pos": [
        38501,
        38569
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-customapi-auth\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Handle Large File Uploads"
    },
    {
      "content": "Azure Mobile Apps SDK uses the <bpt id=\"p1\">[</bpt>body-parser middleware<ept id=\"p1\">](https://github.com/expressjs/body-parser)</ept> to accept and decode body content in your submission.",
      "pos": [
        38571,
        38722
      ]
    },
    {
      "content": "You can pre-configure",
      "pos": [
        38724,
        38745
      ]
    },
    {
      "content": "body-parser to accept larger file uploads:",
      "pos": [
        38746,
        38788
      ]
    },
    {
      "content": "You can adjust the 50Mb limit we have shown above.",
      "pos": [
        39372,
        39422
      ]
    },
    {
      "content": "Note that the file will be base-64 encoded before transmission, which will",
      "pos": [
        39424,
        39498
      ]
    },
    {
      "content": "increase the size of the actual upload.",
      "pos": [
        39499,
        39538
      ]
    },
    {
      "pos": [
        39543,
        39614
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"howto-customapi-sql\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Execute Custom SQL Statements"
    },
    {
      "content": "The Azure Mobile Apps SDK allows access to the entire Context through the request object, allowing you to execute",
      "pos": [
        39616,
        39729
      ]
    },
    {
      "content": "parameterized SQL statements to the defined data provider easily:",
      "pos": [
        39730,
        39795
      ]
    },
    {
      "pos": [
        40777,
        40895
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"Debugging\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph><ph id=\"ph3\">&lt;a name=\"howto-diagnostic-logs\"&gt;</ph><ph id=\"ph4\">&lt;/a&gt;</ph>How to: Debug, Diagnose and Troubleshoot Azure Mobile Apps"
    },
    {
      "content": "The Azure App Service provides several debugging and troubleshooting techniques for Node.js applications.",
      "pos": [
        40897,
        41002
      ]
    },
    {
      "content": "Refer to the following articles to get started in troubleshooting your Node.js Mobile backend:",
      "pos": [
        41003,
        41097
      ]
    },
    {
      "content": "Monitoring an Azure App Service",
      "pos": [
        41102,
        41133
      ]
    },
    {
      "content": "Enable Diagnostic Logging in Azure App Service",
      "pos": [
        41138,
        41184
      ]
    },
    {
      "content": "Toubleshoot an Azure App Service in Visual Studio",
      "pos": [
        41189,
        41238
      ]
    },
    {
      "content": "Node.js applications have access to a wide range of diagnostic log tools.",
      "pos": [
        41241,
        41314
      ]
    },
    {
      "content": "Internally, the Azure Mobile Apps Node.js SDK uses <bpt id=\"p1\">[</bpt><ept id=\"p1\">Winston]</ept> for diagnostic logging.",
      "pos": [
        41316,
        41400
      ]
    },
    {
      "content": "This is automatically enabled by enabling debug mode or by setting the <bpt id=\"p1\">**</bpt>MS_DebugMode<ept id=\"p1\">**</ept> app setting to true in the <bpt id=\"p2\">[</bpt><ept id=\"p2\">Azure Portal]</ept>.",
      "pos": [
        41402,
        41532
      ]
    },
    {
      "content": "Logs generated will appear in the Diagnostic Logs on the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Portal]</ept>.",
      "pos": [
        41534,
        41606
      ]
    },
    {
      "pos": [
        41611,
        41723
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"in-portal-editing\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph><ph id=\"ph3\">&lt;a name=\"work-easy-tables\"&gt;</ph><ph id=\"ph4\">&lt;/a&gt;</ph>How to: Work with Easy Tables in the Azure portal"
    },
    {
      "content": "Easy Tables in the portal let you create and work with tables right in the portal.",
      "pos": [
        41725,
        41807
      ]
    },
    {
      "content": "You can even edit table operations using the Visual Studio online editor.",
      "pos": [
        41808,
        41881
      ]
    },
    {
      "content": "When you click <bpt id=\"p1\">**</bpt>Easy tables<ept id=\"p1\">**</ept> in your backend site settings, you can add a new table or modify or delete an existing table.",
      "pos": [
        41883,
        42007
      ]
    },
    {
      "content": "You can also see data in the table.",
      "pos": [
        42008,
        42043
      ]
    },
    {
      "content": "Work with Easy Tables",
      "pos": [
        42047,
        42068
      ]
    },
    {
      "content": "The following commands are available on the command bar for a table:",
      "pos": [
        42162,
        42230
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Change permissions<ept id=\"p1\">**</ept> - modify the the permission for read, insert, update and delete operations on the table.",
      "pos": [
        42234,
        42345
      ]
    },
    {
      "content": "Options are to allow anonymous access, to require authentication, or to disable all access to the operation.",
      "pos": [
        42346,
        42454
      ]
    },
    {
      "content": "This modifies the table.json project code file.",
      "pos": [
        42455,
        42502
      ]
    },
    {
      "pos": [
        42505,
        42605
      ],
      "content": "<bpt id=\"p1\">**</bpt>Edit script<ept id=\"p1\">**</ept> - the script file for the table is opened in the Visual Studio Team Services editor."
    },
    {
      "pos": [
        42608,
        42676
      ],
      "content": "<bpt id=\"p1\">**</bpt>Manage schema<ept id=\"p1\">**</ept> - add or delete columns or change the table index."
    },
    {
      "pos": [
        42679,
        42784
      ],
      "content": "<bpt id=\"p1\">**</bpt>Clear table<ept id=\"p1\">**</ept> - truncates an existing table be deleting all data rows but leaving the schema unchanged."
    },
    {
      "pos": [
        42787,
        42836
      ],
      "content": "<bpt id=\"p1\">**</bpt>Delete rows<ept id=\"p1\">**</ept> - delete individual rows of data."
    },
    {
      "pos": [
        42839,
        42921
      ],
      "content": "<bpt id=\"p1\">**</bpt>View streaming logs<ept id=\"p1\">**</ept> - connects you to the streaming log service for your site."
    },
    {
      "pos": [
        42925,
        43001
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"work-easy-apis\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Work with Easy APIs in the Azure portal"
    },
    {
      "content": "Easy APIs in the portal let you create and work with custom APIs right in the portal.",
      "pos": [
        43003,
        43088
      ]
    },
    {
      "content": "You can even edit API scripts using the Visual Studio online editor.",
      "pos": [
        43089,
        43157
      ]
    },
    {
      "pos": [
        43159,
        43302
      ],
      "content": "When you click <bpt id=\"p1\">**</bpt>Easy APIs<ept id=\"p1\">**</ept> in your backend site settings, you can add a new custom API endpoint or modify or delete an existing API endpoint."
    },
    {
      "content": "Work with Easy APIs",
      "pos": [
        43306,
        43325
      ]
    },
    {
      "content": "In the portal, you can change the access permissions for a given HTTP action, edit the API script file in the Visual Studio Team Services editor, or view the streaming logs.",
      "pos": [
        43417,
        43590
      ]
    },
    {
      "pos": [
        43594,
        43670
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"online-editor\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Edit code in Visual Studio Team Services"
    },
    {
      "content": "The Azure portal lets you edit your Node.js backend script files in Visual Studio Team Services without having to download the project to your local computer.",
      "pos": [
        43672,
        43830
      ]
    },
    {
      "content": "To edit script files in the online editor:",
      "pos": [
        43831,
        43873
      ]
    },
    {
      "content": "In your Mobile App backend blade, click <bpt id=\"p1\">**</bpt>All settings<ept id=\"p1\">**</ept> &gt; either <bpt id=\"p2\">**</bpt>Easy tables<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Easy APIs<ept id=\"p3\">**</ept>, click a table or API, then click <bpt id=\"p4\">**</bpt>Edit script<ept id=\"p4\">**</ept>.",
      "pos": [
        43878,
        44027
      ]
    },
    {
      "content": "The script file is opened in the Visual Studio Team Services editor.",
      "pos": [
        44028,
        44096
      ]
    },
    {
      "content": "Visual Studio Team Services code editor",
      "pos": [
        44104,
        44143
      ]
    },
    {
      "content": "Make your changes to the code file in the online editor.",
      "pos": [
        44249,
        44305
      ]
    },
    {
      "content": "Changes are saved automatically as you type.",
      "pos": [
        44306,
        44350
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"How to work with the Node.js backend server SDK for Mobile Apps | Azure App Service\"\n    description=\"Learn how to work with the Node.js backend server SDK for Azure App Service Mobile Apps.\"\n    services=\"app-service\\mobile\"\n    documentationCenter=\"\"\n    authors=\"adrianhall\"\n    manager=\"erikre\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"app-service-mobile\"\n    ms.workload=\"mobile\"\n    ms.tgt_pltfrm=\"mobile-multiple\"\n    ms.devlang=\"node\"\n    ms.topic=\"article\"\n    ms.date=\"03/07/2016\"\n    ms.author=\"adrianhall\"/>\n\n# How to use the Azure Mobile Apps Node.js SDK\n\n[AZURE.INCLUDE [app-service-mobile-selector-server-sdk](../../includes/app-service-mobile-selector-server-sdk.md)]\n\nThis article provides detailed information and examples showing how to work with a Node.js backend in Azure App Service Mobile Apps.\n\n## <a name=\"Introduction\"></a>Introduction\n\nAzure App Service Mobile Apps provides the capability to add a mobile-optimized data access Web API to a web application.  The Azure App\nService Mobile Apps SDK is provided for ASP.NET and Node.js web applications.  The SDK provides the following operations:\n\n- Table operations (Read, Insert, Update, Delete) for data access\n- Custom API operations\n\nBoth operations provide for authentication across all identity providers allowed by Azure App Service, including social identity\nproviders such as Facebook, Twitter, Google and Microsoft as well as Azure Active Directory for enterprise identity.\n\nYou can find samples for each use case in the [samples directory on GitHub].\n\n## <a name=\"howto-cmdline-basicapp\"></a>How to: Create a Basic Node.js backend using the Command Line\n\nEvery Azure App Service Mobile App Node.js backend starts as an ExpressJS application.  ExpressJS is the most popular web service framework\navailable for Node.js.  You can create a basic [Express] application as follows:\n\n1. In a command or PowerShell window, create a new directory for your project.\n\n        mkdir basicapp\n\n2. Run npm init to initialize the package structure.\n\n        cd basicapp\n        npm init\n\n    The npm init command will ask a set of questions to initialize the project.  See the example output below\n\n    ![The npm init output][0]\n\n3. Install the express and azure-mobile-apps libraries from the npm repository.\n\n        npm install --save express azure-mobile-apps\n\n4. Create an app.js file to implement the basic mobile server.\n\n        var express = require('express'),\n            azureMobileApps = require('azure-mobile-apps');\n\n        var app = express(),\n            mobile = azureMobileApps();\n\n        // Define a TodoItem table\n        mobile.tables.add('TodoItem');\n\n        // Add the mobile API so it is accessible as a Web API\n        app.use(mobile);\n\n        // Start listening on HTTP\n        app.listen(process.env.PORT || 3000);\n\nThis application creates a simple mobile-optimized WebAPI with a single endpoint (`/tables/TodoItem`) that provides\nunauthenticated access to an underlying SQL data store using a dynamic schema.  It is suitable for following the\nclient library quick starts:\n\n- [Android Client QuickStart]\n- [Apache Cordova Client QuickStart]\n- [iOS Client QuickStart]\n- [Windows Store Client QuickStart]\n- [Xamarin.iOS Client QuickStart]\n- [Xamarin.Android Client QuickStart]\n- [Xamarin.Forms Client QuickStart]\n\n\nYou can find the code for this basic application in the [basicapp sample on GitHub].\n\n## <a name=\"howto-vs2015-basicapp\"></a>How to: Create a Node backend with Visual Studio 2015\n\nVisual Studio 2015 requires an extension to develop Node.js applications within the IDE.  To start, download and install the [Node.js Tools 1.1 for Visual Studio].  Once the Node.js Tools for Visual Studio are installed, create an Express 4.x application:\n\n1. Open the **New Project** dialog (from **File** > **New** > **Project...**).\n\n2. Expand **Templates** > **JavaScript** > **Node.js**.\n\n3. Select the **Basic Azure Node.js Express 4 Application**.\n\n4. Fill in the project name.  Click on *OK*.\n\n    ![Visual Studio 2015 New Project][1]\n\n5. Right-click on the **npm** node and select **Install New npm packages...**.\n\n6. You may need to refresh the npm catalog on creating your first Node.js application.  If this is required, you will be prompted - click on **Refresh**.\n\n7. Enter _azure-mobile-apps_ in the search box.  Click on the **azure-mobile-apps 2.0.0** package, then click on **Install Package**.\n\n    ![Install New npm packages][2]\n\n8. Click on **Close**.\n\n9. Open the _app.js_ file to add support for the Azure Mobile Apps SDK.  At line 6 at the bottom of the library require statements, add the following code:\n\n        var bodyParser = require('body-parser');\n        var azureMobileApps = require('azure-mobile-apps');\n\n    At approximately line 27 after the other app.use statements, add the following code:\n\n        app.use('/users', users);\n\n        // Azure Mobile Apps Initialization\n        var mobile = azureMobileApps();\n        mobile.tables.add('TodoItem');\n        app.use(mobile);\n\n    Save the file.\n\n10. Either run the application locally (the API will be served on http://localhost:3000) or publish to Azure.\n\n## <a name=\"download-quickstart\"></a>How to: Download the Node.js backend quickstart code project using Git\n\nWhen you create a new Node.js Mobile App backend by using the portal **Quick start** blade, a new Node.js project is created for you and deployed to your site. You can add tables and APIs and edit code files for the Node.js backend in the portal. You can also use one of a variety of deployment tools to download the backend project so that you can add or modify tables and APIs, then republish the project. For more information, see the [Azure App Service Deployment Guide]. the following procedure uses a Git repository to download the quickstart project code.\n\n1. Install Git, if you haven't already done so. The steps required to install Git vary between operating systems. See [Installing Git](http://git-scm.com/book/en/Getting-Started-Installing-Git) for operating system specific distributions and installation guidance.\n\n2. Follow the steps in [Enable the web app repository](../app-service-web/web-sites-publish-source-control.md#Step4) to enable the Git repository for your backend site, making a note of the deployment username and password.\n\n3. In the blade for your Mobile App backend, make a note of the **Git clone URL** setting.\n\n4.  Execute the `git clone` command in a Git-aware command-line tool using the Git clone URL, entering your password when required, as in the following example:\n\n        $ git clone https://username@todolist.scm.azurewebsites.net:443/todolist.git\n\n5. Browse to local directory, which in the above example is /todolist, and notice that project files have been downloaded. In the /tables subfolder you will find a todoitem.json file, which defines permissions on the table, and todoitem.js file, which defines that CRUD operation scripts for the table.\n\n6. After you have made changes to project files, execute the following commands to add, commit, then upload the changes to the site:\n\n        $ git commit -m \"updated the table script\"\n        $ git push origin master\n\n    When you add new files to the project, you first need to execute the `git add .` command.\n\nThe site is republished every time a new set of commits is pushed to the site.\n\n## <a name=\"howto-publish-to-azure\"></a>How to: Publish your Node.js backend to Azure\n\nMicrosoft Azure provides many mechanisms for publishing your Azure App Service Mobile Apps Node.js backend to the Azure service.  These include utilizing deployment tools integrated into Visual Studio, command-line tools and continuous deployment options based on source control.  For more information on this topic, refer to the [Azure App Service Deployment Guide].\n\nAzure App Service has specific advice for Node.js application that you should review before deploying:\n\n- How to [specify the Node Version]\n- How to [use Node modules]\n\n## <a name=\"howto-enable-homepage\"></a>How to: Enable a Home Page for your application\n\nMany applications are a combination of web and mobile apps and the ExpressJS framework allows you to combine the two facets.  Sometimes, however, you\nmay wish to only implement a mobile interface.  It is useful to provide a landing page to ensure the app service is up and running.  You can either\nprovide your own home page or enable a temporary home page.  To enable a temporary home page, adjust the Mobile App constructor to the following:\n\n    var mobile = azureMobileApps({ homePage: true });\n\nYou can add this setting to your `azureMobile.js` file if you only want this option available when developing locally.\n\n## <a name=\"TableOperations\"></a>Overview: Table operations\n\nThe azure-mobile-apps Node.js Server SDK provides mechanisms to expose data tables stored in Azure SQL Database as a WebAPI.  Five operations are provided.\n\n| Operation | Description |\n| --------- | ----------- |\n| GET /tables/_tablename_ | Get all records in the table |\n| GET /tables/_tablename_/:id | Get a specific record in the table |\n| POST /tables/_tablename_ | Create a new record in the table |\n| PATCH /tables/_tablename_/:id | Update an existing record in the table |\n| DELETE /tables/_tablename_/:id | Delete a record in the table |\n\nThis WebAPI supports [OData] and extends the table schema to support [offline data sync].\n\n## <a name=\"howto-dynamicschema\"></a>How to: Define tables using a dynamic schema\n\nBefore a table can be used, it must be defined.  Tables can be defined with a static schema (where the developer defines the columns within the schema) or dynamically (where the SDK controls the schema based on incoming requests). In addition, the developer can control specific aspects of the WebAPI by adding Javascript code to the definition.\n\nAs a best practice, you should define each table in a Javascript file in the tables directory, then use the tables.import() method to import the tables.\nExtending the basic-app, the app.js file would be adjusted:\n\n    var express = require('express'),\n        azureMobileApps = require('azure-mobile-apps');\n\n    var app = express(),\n        mobile = azureMobileApps();\n\n    // Define the database schema that is exposed\n    mobile.tables.import('./tables');\n\n    // Provide initialization of any tables that are statically defined\n    mobile.tables.initialize().then(function () {\n        // Add the mobile API so it is accessible as a Web API\n        app.use(mobile);\n\n        // Start listening on HTTP\n        app.listen(process.env.PORT || 3000);\n    });\n\nDefine the table in ./tables/TodoItem.js:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Additional configuration for the table goes here\n\n    module.exports = table;\n\nTables use dynamic schema by default.  To turn off dynamic schema globally, set the App Setting **MS_DynamicSchema** to false within the Azure Portal.\n\nYou can find a complete example in the [todo sample on GitHub].\n\n## <a name=\"howto-staticschema\"></a>How to: Define tables using a static schema\n\nYou can explicitly define the columns to expose via the WebAPI.  The azure-mobile-apps Node.js SDK will automatically add any additional columns required for offline data sync to the list that you provide.  For example, the QuickStart client applications require a table with two columns: text (a string) and complete (a boolean).  This can be defined in the table definition JavaScript file (located in the tables directory) as follows:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Define the columns within the table\n    table.columns = {\n        \"text\": \"string\",\n        \"complete\": \"boolean\"\n    };\n\n    // Turn off dynamic schema\n    table.dynamicSchema = false;\n\n    module.exports = table;\n\nIf you define tables statically, then you must also call the tables.initialize() method to create the database schema on startup.  The tables.initialize() method returns a [Promise] - this is used to ensure that the web service does not serve requests prior to the database being initialized.\n\n## <a name=\"howto-sqlexpress-setup\"></a>How to: Use SQL Express as a development data store on your local machine\n\nThe Azure Mobile Apps The AzureMobile Apps Node SDK provides three options for serving data out of the box: SDK provides three options for serving data out of the box:\n\n- Use the **memory** driver to provide a non-persistent example store\n- Use the **mssql** driver to provide a SQL Express data store for development\n- Use the **mssql** driver to provide an Azure SQL Database data store for production\n\nThe Azure Mobile Apps Node.js SDK uses the [mssql Node.js package] to establish and use a connection to both SQL Express and SQL Database.  This package requires that you enable TCP connections on your SQL Express instance.\n\n> [AZURE.TIP] The memory driver does not provide a complete set of facilities for testing.  If you wish to test your backend locally,\nwe recommend the use of a SQL Express data store and the mssql driver.\n\n1. Download and install [Microsoft SQL Server 2014 Express].  Ensure you install the SQL Server 2014 Express with Tools edition.  Unless you explicitly\nrequire 64 Bit support, the 32 Bit version will consume less memory when running.\n\n2. Run the SQL Server 2014 Configuration Manager.\n\n  1. Expand the **SQL Server Network Configuration** node in the left hand tree menu.\n  2. Click on **Protocols for SQLEXPRESS**.\n  3. Right-click on **TCP/IP** and select **Enable**.  Click on **OK** in the pop-up dialog.\n  4. Right-click on **TCP/IP** and select **Properties**.\n  5. Click on the **IP Addresses** tab.\n  6. Find the **IPAll** node.  In the **TCP Port** field, enter **1433**.\n\n         ![Configure SQL Express for TCP/IP][3]\n  7. Click on **OK**.  Click on **OK** in the pop-up dialog.\n  8. Click on **SQL Server Services** in the left hand tree menu.\n  9. Right-click on **SQL Server (SQLEXPRESS)** and select **Restart**\n  10. Close the SQL Server 2014 Configuration Manager.\n\n3. Run the SQL Server 2014 Management Studio and connect to your local SQL Express instance\n\n  1. Right-click on your instance in the Object Explorer and select **Properties**\n  2. Select the **Security** page.\n  3. Ensure the **SQL Server and Windows Authentication mode** is selected\n  4. Click on **OK**\n\n        ![Configure SQL Express Authentication][4]\n\n  5. Expand **Security** > **Logins** in the Object Explorer\n  6. Right-click on **Logins** and select **New Login...**\n  7. Enter a Login name.  Select **SQL Server authentication**.  Enter a Password, then enter the same password in **Confirm password**.  Note that the password must meet Windows complexity requirement.\n  8. Click on **OK**\n\n        ![Add a new user to SQL Express][5]\n\n  9. Right-click on your new login and select **Properties**\n  10. Select the **Server Roles** page\n  11. Check the box next to the **dbcreator** server role\n  12. Click on **OK**\n  13. Close the SQL Server 2015 Management Studio\n\nEnsure you record the username and password you selected.  You may need to assign additional server roles or permissions depending on your specific database requirements.\n\nThe Node.js application will read the **SQLCONNSTR_MS_TableConnectionString** environment variable to read the connection string for this database.  You can set this within your environment.  For example, you can use PowerShell to set this environment variable:\n\n    $env:SQLCONNSTR_MS_TableConnectionString = \"Server=127.0.0.1; Database=mytestdatabase; User Id=azuremobile; Password=T3stPa55word;\"\n\nNote that you must access the database through a TCP/IP connection and provide a username and password for the connection.\n\n## <a name=\"howto-config-localdev\"></a>How to: Configure your project for local development\n\nAzure Mobile Apps reads a JavaScript file called _azureMobile.js_ from the local filesystem.  You should not use this file to configure the Azure Mobile Apps SDK in production - use App Settings within the [Azure Portal] instead.  The _azureMobile.js_ file should export a configuration object.  The most common settings are:\n\n- Database Settings\n- Diagnostic Logging Settings\n- Alternate CORS Settings\n\nAn example _azureMobile.js_ file implementing the database settings given above is below:\n\n    module.exports = {\n        cors: {\n            origins: [ 'localhost' ]\n        },\n        data: {\n            provider: 'mssql',\n            server: '127.0.0.1',\n            database: 'mytestdatabase',\n            user: 'azuremobile',\n            password: 'T3stPa55word'\n        },\n        logging: {\n            level: 'verbose'\n        }\n    };\n\nWe recommend that you add _azureMobile.js_ to your _.gitignore_ file (or other source code control ignore file) to prevent passwords from\nbeing stored in the cloud.  Always configure production settings in App Settings within the [Azure Portal].\n\n## <a name=\"howto-appsettings\"></a>How: Configure App Settings for your Mobile App\n\nMost settings in the _azureMobile.js_ file have an equivalent App Setting in the [Azure Portal].  Use the following list to configure your\napp in App Settings:\n\n| App Setting                 | _azureMobile.js_ Setting  | Description                               | Valid Values                                |\n| :-------------------------- | :------------------------ | :---------------------------------------- | :------------------------------------------ |\n| **MS_MobileAppName**        | name                      | The name of the app                       | string                                      |\n| **MS_MobileLoggingLevel**   | logging.level             | Minimum log level of messages to log      | error, warning, info, verbose, debug, silly |\n| **MS_DebugMode**            | debug                     | Enable or Disable debug mode              | true, false                                 |\n| **MS_TableSchema**          | data.schema               | Default schema name for SQL tables        | string (default: dbo)                       |\n| **MS_DynamicSchema**        | data.dynamicSchema        | Enable or Disable debug mode              | true, false                                 |\n| **MS_DisableVersionHeader** | version (set to undefined)| Disables the X-ZUMO-Server-Version header | true, false                                 |\n| **MS_SkipVersionCheck**     | skipversioncheck          | Disables the client API version check     | true, false                                 |\n\nTo set an App Setting:\n\n1. Log into the [Azure Portal].\n2. Select **All resources** or **App Services** then click on the name of your Mobile App.\n3. The Settings blade will open by default - if it doesn't, click on **Settings**.\n4. Click on **Application settings** in the GENERAL menu.\n5. Scroll to the App Settings section.\n6. If your app setting already exists, click on the value of the app setting to edit the value.\n7. If you app setting does not exist, enter the App Setting in the Key box and the value in the Value box.\n8. Once you are complete, click on **Save**.\n\nChanging most app settings will require a service restart.\n\n## <a name=\"howto-use-sqlazure\"></a>How to: Use SQL Database as your production data store\n\n<!--- ALTERNATE INCLUDE - we can't use ../includes/app-service-mobile-dotnet-backend-create-new-service.md - slightly different semantics -->\n\nUsing Azure SQL Database as a data store is identical across all Azure App Service application types. If you have not done so already, follow these steps to create a new Mobile App backend.\n\n1. Log into the [Azure Portal].\n\n2. In the top left of the window, click the **+NEW** button > **Web + Mobile** > **Mobile App**, then provide a name for your Mobile App backend.\n\n3. In the **Resource Group** box, enter the same name as your app.\n\n4. The Default App Service plan will be selected.  If you wish to change your App Service plan, you can do so by clicking on the App Service Plan > **+ Create New**.  Provide a name of the new App Service plan and select an appropriate location.  Click the Pricing tier and select an appropriate pricing tier for the service. Select **View all** to view more pricing options, such as **Free** and **Shared**.  Once you have selected the pricing tier, click the **Select** button.  Back in the **App Service plan** blade, click **OK**.\n\n5. Click **Create**. This creates a Mobile App backend where you will later deploy your server project.  Provisioning a Mobile App backend can take a couple of minutes.  Once the Mobile App backend is provisioned, the portal will open the **Settings** blade for the Mobile App backend.\n\nOnce the Mobile App backend is created, you can choose to either connect an existing SQL database to your Mobile App backend or create a new SQL database.  In this section, we will create a new SQL database.\n\n> [AZURE.NOTE] If you already have a database in the same location as the new mobile app backend, you can instead choose **Use an existing database** and then select that database. The use of a database in a different location is not recommended because of additional bandwidth costs and higher latencies.\n\n6. In the new Mobile App backend, click **Settings** > **Mobile App** > **Data** > **+Add**.\n\n7. In the **Add data connection** blade, click **SQL Database - Configure required settings** > **Create a new database**.  Enter the name of the new database in the **Name** field.\n\n8. Click **Server**.  In the **New server** blade, enter a unique server name in the **Server name** field, and provide a suitable **Server admin login** and **Password**.  Ensure **Allow azure services to access server** is checked.  Click on **OK**.\n\n    ![Create an Azure SQL Database][6]\n\n9. On the **New database** blade, click on **OK**.\n\n10. Back on the **Add data connection** blade, select **Connection string**, enter the login and password that you just provided when creating the database.  If you use an existing database, provide the login credentials for that database.  Once entered, click **OK**.\n\n11. Back on the **Add data connection** blade again, click on **OK** to create the database.\n\n<!--- END OF ALTERNATE INCLUDE -->\n\nCreation of the database can take a few minutes.  Use the **Notifications** area to monitor the progress of the deployment.  Do not progress until the database has been deployed sucessfully.  Once successfully deployed, a Connection String will be created for the SQL Database instance in your Mobile backend App Settings.  You can see this app setting in the **Settings** > **Application settings** > **Connection strings**.\n\n## <a name=\"howto-tables-auth\"></a>How to: Require Authentication for access to tables\n\nIf you wish to use App Service Authentication with the tables endpoint, you must configure App Service Authentication in the [Azure Portal] first.  For\nmore details about configuring authentication in an Azure App Service, review the Configuration Guide for the identity provider you intend to use:\n\n- [How to configure Azure Active Directory Authentication]\n- [How to configure Facebook Authentication]\n- [How to configure Google Authentication]\n- [How to configure Microsoft Authentication]\n- [How to configure Twitter Authentication]\n\nEach table has an access property that can be used to control access to the table.  The following sample shows a statically defined table with authentication required.\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Define the columns within the table\n    table.columns = {\n        \"text\": \"string\",\n        \"complete\": \"boolean\"\n    };\n\n    // Turn off dynamic schema\n    table.dynamicSchema = false;\n\n    // Require authentication to access the table\n    table.access = 'authenticated';\n\n    module.exports = table;\n\nThe access property can take one of three values\n\n  - *anonymous* indicates that the client application is allowed to read data without authentication\n  - *authenticated* indicates that the client application must send a valid authentication token with the request\n  - *disabled* indicates that this table is currently disabled\n\nIf the access property is undefined, unauthenticated access is allowed.\n\n## <a name=\"howto-tables-getidentity\"></a>How to: Use Authentication Claims with your tables\n\nYou can set up a number of claims that are requested when authentication is set up.  These claims are not normally available through the `context.user` object.\nHowever, they can be retrieved using the `context.user.getIdentity()` method.  The `getIdentity()` method returns a Promise that resolves to an object.  The object\nis keyed by the authentication method (facebook, google, twitter, microsoftaccount or aad).\n\nFor example, if you set up Microsoft Account authentication and request the email addresses claim, you can add the email address to the record with the following:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    // Create a new table definition\n    var table = azureMobileApps.table();\n\n    table.columns = {\n        \"emailAddress\": \"string\",\n        \"text\": \"string\",\n        \"complete\": \"boolean\"\n    };\n    table.dynamicSchema = false;\n    table.access = 'authenticated';\n\n    /**\n    * Limit the context query to those records with the authenticated user email address\n    * @param {Context} context the operation context\n    * @returns {Promise} context execution Promise\n    */\n    function queryContextForEmail(context) {\n        return context.user.getIdentity().then((data) => {\n            context.query.where({ emailAddress: data.microsoftaccount.claims.emailaddress });\n            return context.execute();\n        });\n    }\n\n    /**\n    * Adds the email address from the claims to the context item - used for\n    * insert operations\n    * @param {Context} context the operation context\n    * @returns {Promise} context execution Promise\n    */\n    function addEmailToContext(context) {\n        return context.user.getIdentity().then((data) => {\n            context.item.emailAddress = data.microsoftaccount.claims.emailaddress;\n            return context.execute();\n        });\n    }\n\n    // Configure specific code when the client does a request\n    // READ - only return records belonging to the authenticated user\n    table.read(queryContextForEmail);\n\n    // CREATE - add or overwrite the userId based on the authenticated user\n    table.insert(addEmailToContext);\n\n    // UPDATE - only allow updating of record belong to the authenticated user\n    table.update(queryContextForEmail);\n\n    // DELETE - only allow deletion of records belong to the authenticated uer\n    table.delete(queryContextForEmail);\n\n    module.exports = table;\n\nTo see what claims are available, use a web browser to view the `/.auth/me` endpoint of your site.\n\n## <a name=\"howto-tables-disabled\"></a>How to: Disable access to specific table operations\n\nIn addition to appearing on the table, the access property can be used to control individual operations.  There are four operations:\n\n  - *read* is the RESTful GET operation on the table\n  - *insert* is the RESTful POST operation on the table\n  - *update* is the RESTful PATCH operation on the table\n  - *delete* is the RESTful DELETE operation on the table\n\nFor example, you may wish to provide a read-only unauthenticated table.  This can be provided by the following table definition:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Read-Only table - only allow READ operations\n    table.read.access = 'anonymous';\n    table.insert.access = 'disabled';\n    table.update.access = 'disabled';\n    table.delete.access = 'disabled';\n\n    module.exports = table;\n\n## <a name=\"howto-tables-query\"></a>How to: Adjust the query that is used with table operations\n\nA common requirement for table operations is to provide a restricted view of the data.  For example, you may provide a table that is\ntagged with the authenticated user ID such that the user can only read or update their own records.  The following table definition\nwill provide this functionality:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Define a static schema for the table\n    table.columns = {\n        \"userId\": \"string\",\n        \"text\": \"string\",\n        \"complete\": \"boolean\"\n    };\n    table.dynamicSchema = false;\n\n    // Require authentication for this table\n    table.access = 'authenticated';\n\n    // Ensure that only records for the authenticated user are retrieved\n    table.read(function (context) {\n        context.query.where({ userId: context.user.id });\n        return context.execute();\n    });\n\n    // When adding records, add or overwrite the userId with the authenticated user\n    table.insert(function (context) {\n        context.item.userId = context.user.id;\n        return context.execute();\n    });\n\n    module.exports = table;\n\nOperations that normally execute a query will have a query property that you can adjust with a where clause.    The query property is\na [QueryJS] object that is used to convert an OData query to something that the data backend can process.  For simple equality cases\n(like the one above), a map can be used. It is also relatively easy to add specific SQL clauses:\n\n    context.query.where('myfield eq ?', 'value');\n\n## <a name=\"howto-tables-softdelete\"></a>How to: Configure Soft Delete on a table\n\nSoft Delete does not actually delete records.  Instead it marks them as deleted within the database by setting the deleted column to true.  The Azure Mobile Apps SDK automatically removes soft-deleted records from results unless the Mobile Client SDK uses IncludeDeleted().  To configure a table for soft delete, set the softDelete property in the table definition file.  An example might be:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Define the columns within the table\n    table.columns = {\n        \"text\": \"string\",\n        \"complete\": \"boolean\"\n    };\n\n    // Turn off dynamic schema\n    table.dynamicSchema = false;\n\n    // Turn on Soft Delete\n    table.softDelete = true;\n\n    // Require authentication to access the table\n    table.access = 'authenticated';\n\n    module.exports = table;\n\nYou will need to establish a mechanism for purging records - either from a client application, via a WebJob or through a custom mechanism.\n\n## <a name=\"howto-tables-seeding\"></a>How to: Seed your database with data\n\nWhen creating a new application, you may wish to seed a table with data.  This can be done within the table definition JavaScript file as\nfollows:\n\n    var azureMobileApps = require('azure-mobile-apps');\n\n    var table = azureMobileApps.table();\n\n    // Define the columns within the table\n    table.columns = {\n        \"text\": \"string\",\n        \"complete\": \"boolean\"\n    };\n    table.seed = [\n        { text: 'Example 1', complete: false },\n        { text: 'Example 2', complete: true }\n    ];\n\n    // Turn off dynamic schema\n    table.dynamicSchema = false;\n\n    // Require authentication to access the table\n    table.access = 'authenticated';\n\n    module.exports = table;\n\nIt is important to note that seeding of data is only done when the table is created by the Azure Mobile Apps SDK.  If the table already\nexists within the database, no data is injected into the table.  If dynamic schema is turned on, then the schema will be inferred from\nthe seeded data.\n\nWe recommend that you explicitly call the initialize() method to create the table when the service starts running.\n\n## <a name=\"Swagger\"></a>How to: Enable Swagger Support\n\nAzure App Service Mobile Apps comes with built-in [Swagger] support.  To enable Swagger support, first install the swagger-ui as a dependency:\n\n    npm install --save swagger-ui\n\nOnce installed, you can enable Swagger support in the Azure Mobile Apps constructor:\n\n    var mobile = azureMobileApps({ swagger: true });\n\nYou probably only want to enable Swagger support in development editions.  You can do this by utilizing the `NODE_ENV` app setting:\n\n    var mobile = azureMobileApps({ swagger: process.env.NODE_ENV !== 'production' });\n\nThe swagger endpoint will be located at http://_yoursite_.azurewebsites.net/swagger.  You can access the Swagger UI via the `/swagger/ui` endpoint.\nNote that Swagger produces an error for the / endpoint if you choose to require authentication across your entire application.  For best\nresults, choose to allow unauthenticated requests through in the Azure App Service Authentication / Authorization settings, then control\nauthentication using the `table.access` property.\n\nYou can also add the Swagger option to your `azureMobile.js` file if you only want Swagger support when developing locally.\n\n## <a name=\"push\"></a>Overview: Push notifications\nMobile Apps integrates with Azure Notification Hubs to enable you to send targeted push notifications to millions of devices across all major platforms. By using Notification Hubs, you can send push notifications to iOS, Android and Windows devices. To learn more about all that you can do with Notification Hubs, see [Notification Hubs Overview](../notification-hubs/notification-hubs-overview.md).\n\n## <a name=\"send-push\"></a>How to: Send push notifications\n\nThe following code shows how to use the push object to send a broadcast push notification to registered iOS devices:\n\n    // Create an APNS payload.\n    var payload = '{\"aps\": {\"alert\": \"This is an APNS payload.\"}}';\n\n    // Only do the push if configured\n    if (context.push) {\n        // Send a push notification using APNS.\n        context.push.apns.send(null, payload, function (error) {\n            if (error) {\n                // Do something or log the error.\n            }\n        });\n    }\n\nBy creating a template push registration from the client, you can instead send a template push message to devices on all supported platforms. The following code shows how to send a template notification:\n\n    // Define the template payload.\n    var payload = '{\"messageParam\": \"This is a template payload.\"}';\n\n    // Only do the push if configured\n    if (context.push) {\n        // Send a template notification.\n        context.push.send(null, payload, function (error) {\n            if (error) {\n                // Do something or log the error.\n            }\n        });\n    }\n\n\n##<a name=\"push-user\"></a>How to: Send push notifications to an authenticated user using tags\nWhen an authenticated user registers for push notifications, a user ID tag is automatically added to the registration. By using this tag, you can send push notifications to all devices registered by a specific user. The following code gets the SID of user making the request and sends a template push notification to every device registration for that user:\n\n    // Only do the push if configured\n    if (context.push) {\n        // Send a notification to the current user.\n        context.push.send(context.user.id, payload, function (error) {\n            if (error) {\n                // Do something or log the error.\n            }\n        });\n    }\n\nWhen registering for push notifications from an authenticated client, make sure that authentication is complete before attempting registration.\n\n## <a name=\"CustomAPI\"></a>Overview: Custom APIs\n\nIn addition to the data access API via the /tables endpoint, Azure Mobile Apps can provide custom API coverage.  Custom\nAPIs are defined in a similar way to the table definitions and can access all the same facilities, including authentication.\n\nIf you wish to use App Service Authentication with a Custom API, you must configure App Service Authentication\nin the [Azure Portal] first.  For more details about configuring authentication in an  Azure App Service, review\nthe Configuration Guide for the identity provider you intend to use:\n\n- [How to configure Azure Active Directory Authentication]\n- [How to configure Facebook Authentication]\n- [How to configure Google Authentication]\n- [How to configure Microsoft Authentication]\n- [How to configure Twitter Authentication]\n\n## <a name=\"howto-customapi-basic\"></a>How to: Define a simple custom API\n\nCustom APIs are defined in much the same way as the Tables API.\n\n1. Create an **api** directory\n2. Create an API definition JavaScript file in the **api** directory.\n3. Use the import method to import the **api** directory.\n\nHere is the prototype api definition based on the basic-app sample we used earlier.\n\n    var express = require('express'),\n        azureMobileApps = require('azure-mobile-apps');\n\n    var app = express(),\n        mobile = azureMobileApps();\n\n    // Import the Custom API\n    mobile.api.import('./api');\n\n    // Add the mobile API so it is accessible as a Web API\n    app.use(mobile);\n\n    // Start listening on HTTP\n    app.listen(process.env.PORT || 3000);\n\nLet's take a simple API that will return the server date using the _Date.now()_ method.  Here is the api/date.js file:\n\n    var api = {\n        get: function (req, res, next) {\n            var date = { currentTime: Date.now() };\n            res.status(200).type('application/json').send(date);\n        });\n    };\n\n    module.exports = api;\n\nEach parameter is one of the standard RESTful verbs - GET, POST, PATCH or DELETE.  The method is a standard [ExpressJS Middleware] function that sends the required output.\n\n## <a name=\"howto-customapi-auth\"></a>How to: Require authentication for access to a custom API\n\nAzure Mobile Apps SDK implements authentication in the same way for both the tables endpoint and custom APIs.  To add authentication to the API developed in the previous section, add an **access** property:\n\n    var api = {\n        get: function (req, res, next) {\n            var date = { currentTime: Date.now() };\n            res.status(200).type('application/json').send(date);\n        });\n    };\n    // All methods must be authenticated.\n    api.access = 'authenticated';\n\n    module.exports = api;\n\nYou can also specify authentication on specific operations:\n\n    var api = {\n        get: function (req, res, next) {\n            var date = { currentTime: Date.now() };\n            res.status(200).type('application/json').send(date);\n        }\n    };\n    // The GET methods must be authenticated.\n    api.get.access = 'authenticated';\n\n    module.exports = api;\n\nThe same token that is used for the tables endpoint must be used for custom APIs requiring authentication.\n\n## <a name=\"howto-customapi-auth\"></a>How to: Handle Large File Uploads\n\nAzure Mobile Apps SDK uses the [body-parser middleware](https://github.com/expressjs/body-parser) to accept and decode body content in your submission.  You can pre-configure\nbody-parser to accept larger file uploads:\n\n    var express = require('express'),\n        bodyParser = require('body-parser'),\n        azureMobileApps = require('azure-mobile-apps');\n\n    var app = express(),\n        mobile = azureMobileApps();\n\n    // Set up large body content handling\n    app.use(bodyParser.json({ limit: '50mb' }));\n    app.use(bodyParser.urlencoded({ limit: '50mb', extended: true }));\n\n    // Import the Custom API\n    mobile.api.import('./api');\n\n    // Add the mobile API so it is accessible as a Web API\n    app.use(mobile);\n\n    // Start listening on HTTP\n    app.listen(process.env.PORT || 3000);\n\nYou can adjust the 50Mb limit we have shown above.  Note that the file will be base-64 encoded before transmission, which will\nincrease the size of the actual upload.\n\n## <a name=\"howto-customapi-sql\"></a>How to: Execute Custom SQL Statements\n\nThe Azure Mobile Apps SDK allows access to the entire Context through the request object, allowing you to execute\nparameterized SQL statements to the defined data provider easily:\n\n    var api = {\n        get: function (request, response, next) {\n            // Check for parameters - if not there, pass on to a later API call\n            if (typeof request.params.completed === 'undefined')\n                return next();\n\n            // Define the query - anything that can be handled by the mssql\n            // driver is allowed.\n            var query = {\n                sql: 'UPDATE TodoItem SET complete=@completed',\n                parameters: [{\n                    completed: request.params.completed\n                }]\n            };\n\n            // Execute the query.  The context for Azure Mobile Apps is available through\n            // request.azureMobile - the data object contains the configured data provider.\n            request.azureMobile.data.execute(query)\n            .then(function (results) {\n                response.json(results);\n            });\n        }\n    };\n\n    api.get.access = 'authenticated';\n    module.exports = api;\n\n## <a name=\"Debugging\"></a><a name=\"howto-diagnostic-logs\"></a>How to: Debug, Diagnose and Troubleshoot Azure Mobile Apps\n\nThe Azure App Service provides several debugging and troubleshooting techniques for Node.js applications.\nRefer to the following articles to get started in troubleshooting your Node.js Mobile backend:\n\n- [Monitoring an Azure App Service]\n- [Enable Diagnostic Logging in Azure App Service]\n- [Toubleshoot an Azure App Service in Visual Studio]\n\nNode.js applications have access to a wide range of diagnostic log tools.  Internally, the Azure Mobile Apps Node.js SDK uses [Winston] for diagnostic logging.  This is automatically enabled by enabling debug mode or by setting the **MS_DebugMode** app setting to true in the [Azure Portal].  Logs generated will appear in the Diagnostic Logs on the [Azure Portal].\n\n## <a name=\"in-portal-editing\"></a><a name=\"work-easy-tables\"></a>How to: Work with Easy Tables in the Azure portal\n\nEasy Tables in the portal let you create and work with tables right in the portal. You can even edit table operations using the Visual Studio online editor.\n\nWhen you click **Easy tables** in your backend site settings, you can add a new table or modify or delete an existing table. You can also see data in the table.\n\n![Work with Easy Tables](./media/app-service-mobile-node-backend-how-to-use-server-sdk/mobile-apps-easy-tables.png)\n\nThe following commands are available on the command bar for a table:\n\n+ **Change permissions** - modify the the permission for read, insert, update and delete operations on the table. Options are to allow anonymous access, to require authentication, or to disable all access to the operation. This modifies the table.json project code file.\n+ **Edit script** - the script file for the table is opened in the Visual Studio Team Services editor.\n+ **Manage schema** - add or delete columns or change the table index.\n+ **Clear table** - truncates an existing table be deleting all data rows but leaving the schema unchanged.\n+ **Delete rows** - delete individual rows of data.\n+ **View streaming logs** - connects you to the streaming log service for your site.\n\n##<a name=\"work-easy-apis\"></a>How to: Work with Easy APIs in the Azure portal\n\nEasy APIs in the portal let you create and work with custom APIs right in the portal. You can even edit API scripts using the Visual Studio online editor.\n\nWhen you click **Easy APIs** in your backend site settings, you can add a new custom API endpoint or modify or delete an existing API endpoint.\n\n![Work with Easy APIs](./media/app-service-mobile-node-backend-how-to-use-server-sdk/mobile-apps-easy-apis.png)\n\nIn the portal, you can change the access permissions for a given HTTP action, edit the API script file in the Visual Studio Team Services editor, or view the streaming logs.\n\n##<a name=\"online-editor\"></a>How to: Edit code in Visual Studio Team Services\n\nThe Azure portal lets you edit your Node.js backend script files in Visual Studio Team Services without having to download the project to your local computer. To edit script files in the online editor:\n\n1. In your Mobile App backend blade, click **All settings** > either **Easy tables** or **Easy APIs**, click a table or API, then click **Edit script**. The script file is opened in the Visual Studio Team Services editor.\n\n    ![Visual Studio Team Services code editor](./media/app-service-mobile-node-backend-how-to-use-server-sdk/mobile-apps-visual-studio-editor.png)\n\n2. Make your changes to the code file in the online editor. Changes are saved automatically as you type.\n\n\n<!-- Images -->\n[0]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/npm-init.png\n[1]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/vs2015-new-project.png\n[2]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/vs2015-install-npm.png\n[3]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/sqlexpress-config.png\n[4]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/sqlexpress-authconfig.png\n[5]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/sqlexpress-newuser-1.png\n[6]: ./media/app-service-mobile-node-backend-how-to-use-server-sdk/dotnet-backend-create-db.png\n\n<!-- URLs -->\n[Android Client QuickStart]: app-service-mobile-android-get-started.md\n[Apache Cordova Client QuickStart]: app-service-mobile-cordova-get-started.md\n[iOS Client QuickStart]: app-service-mobile-ios-get-started.md\n[Xamarin.iOS Client QuickStart]: app-service-mobile-xamarin-ios-get-started.md\n[Xamarin.Android Client QuickStart]: app-service-mobile-xamarin-android-get-started.md\n[Xamarin.Forms Client QuickStart]: app-service-mobile-xamarin-forms-get-started.md\n[Windows Store Client QuickStart]: app-service-mobile-windows-store-dotnet-get-started.md\n[HTML/Javascript Client QuickStart]: app-service-html-get-started.md\n[offline data sync]: app-service-mobile-offline-data-sync.md\n[How to configure Azure Active Directory Authentication]: app-service-mobile-how-to-configure-active-directory-authentication.md\n[How to configure Facebook Authentication]: app-service-mobile-how-to-configure-facebook-authentication.md\n[How to configure Google Authentication]: app-service-mobile-how-to-configure-google-authentication.md\n[How to configure Microsoft Authentication]: app-service-mobile-how-to-configure-microsoft-authentication.md\n[How to configure Twitter Authentication]: app-service-mobile-how-to-configure-twitter-authentication.md\n[Azure App Service Deployment Guide]: ../app-service-web/web-sites-deploy.md\n[Monitoring an Azure App Service]: ../app-service-web/web-sites-monitor.md\n[Enable Diagnostic Logging in Azure App Service]: ../app-service-web/web-sites-enable-diagnostic-log.md\n[Toubleshoot an Azure App Service in Visual Studio]: ../app-service-web/web-sites-dotnet-troubleshoot-visual-studio.md\n[specify the Node Version]: ../nodejs-specify-node-version-azure-apps.md\n[use Node modules]: ../nodejs-use-node-modules-azure-apps.md\n[Create a new Azure App Service]: ../app-service-web/\n[azure-mobile-apps]: https://www.npmjs.com/package/azure-mobile-apps\n[Express]: http://expressjs.com/\n[Swagger]: http://swagger.io/\n\n[Azure Portal]: https://portal.azure.com/\n[OData]: http://www.odata.org\n[Promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\n[basicapp sample on GitHub]: https://github.com/azure/azure-mobile-apps-node/tree/master/samples/basic-app\n[todo sample on GitHub]: https://github.com/azure/azure-mobile-apps-node/tree/master/samples/todo\n[samples directory on GitHub]: https://github.com/azure/azure-mobile-apps-node/tree/master/samples\n[static-schema sample on GitHub]: https://github.com/azure/azure-mobile-apps-node/tree/master/samples/static-schema\n[QueryJS]: https://github.com/Azure/queryjs\n[Node.js Tools 1.1 for Visual Studio]: https://github.com/Microsoft/nodejstools/releases/tag/v1.1-RC.2.1\n[mssql Node.js package]: https://www.npmjs.com/package/mssql\n[Microsoft SQL Server 2014 Express]: http://www.microsoft.com/en-us/server-cloud/Products/sql-server-editions/sql-server-express.aspx\n[ExpressJS Middleware]: http://expressjs.com/guide/using-middleware.html\n[Winston]: https://github.com/winstonjs/winston\n"
}