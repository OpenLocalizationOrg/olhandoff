{
  "nodes": [
    {
      "content": "Debug an API App in Azure App Service",
      "pos": [
        28,
        65
      ]
    },
    {
      "content": "Learn how to debug an API App while it runs in Azure App Service, using Visual Studio.",
      "pos": [
        85,
        171
      ]
    },
    {
      "content": "Debug an API App in Azure App Service",
      "pos": [
        504,
        541
      ]
    },
    {
      "content": "Overview",
      "pos": [
        632,
        640
      ]
    },
    {
      "content": "In this tutorial, you debug ASP.NET Web API code that is configured to run in an <bpt id=\"p1\">[</bpt>API app<ept id=\"p1\">](app-service-api-apps-why-best-platform.md)</ept> in <bpt id=\"p2\">[</bpt>Azure App Service<ept id=\"p2\">](../app-service/app-service-value-prop-what-is.md)</ept>.",
      "pos": [
        642,
        849
      ]
    },
    {
      "content": "You debug the code while it is running locally and while it runs remotely in Azure.",
      "pos": [
        850,
        933
      ]
    },
    {
      "pos": [
        936,
        1120
      ],
      "content": "The tutorial works with the API app that you <bpt id=\"p1\">[</bpt>create<ept id=\"p1\">](app-service-dotnet-create-api-app.md)</ept> and <bpt id=\"p2\">[</bpt>deploy<ept id=\"p2\">](app-service-dotnet-deploy-api-app.md)</ept> in the previous tutorials in this series."
    },
    {
      "content": "Debug an API app remotely",
      "pos": [
        1125,
        1150
      ]
    },
    {
      "content": "To enable remote debugging, you have to deploy a debug build to Azure.",
      "pos": [
        1153,
        1223
      ]
    },
    {
      "pos": [
        1228,
        1403
      ],
      "content": "In the Visual Studio <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the project that you deployed in <bpt id=\"p2\">[</bpt>the previous tutorial<ept id=\"p2\">](app-service-dotnet-deploy-api-app.md)</ept>, and select <bpt id=\"p3\">**</bpt>Publish<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        1408,
        1512
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Publish Web<ept id=\"p1\">**</ept> dialog, select the <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> tab and select the <bpt id=\"p3\">**</bpt>Debug<ept id=\"p3\">**</ept> build configuration."
    },
    {
      "pos": [
        1517,
        1535
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Publish project",
      "pos": [
        1543,
        1558
      ]
    },
    {
      "content": "A browser window opens to the base URL of your API app.",
      "pos": [
        1624,
        1679
      ]
    },
    {
      "content": "In the browser address bar, add /swagger to the end of the URL and press Enter.",
      "pos": [
        1684,
        1763
      ]
    },
    {
      "pos": [
        1770,
        1895
      ],
      "content": "This step assumes that you enabled the Swagger UI as directed in the <bpt id=\"p1\">[</bpt>create<ept id=\"p1\">](app-service-dotnet-create-api-app.md)</ept> tutorial."
    },
    {
      "content": "Swagger UI",
      "pos": [
        1903,
        1913
      ]
    },
    {
      "pos": [
        1975,
        2042
      ],
      "content": "Return to Visual Studio, and click from <bpt id=\"p1\">**</bpt>View &gt; Server Explorer<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        2048,
        2112
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Server Explorer<ept id=\"p1\">**</ept>, expand the <bpt id=\"p2\">**</bpt>Azure &gt; App Service<ept id=\"p2\">**</ept> node."
    },
    {
      "content": "Locate the resource group that you created or selected when you deployed your API app.",
      "pos": [
        2118,
        2204
      ]
    },
    {
      "pos": [
        2210,
        2305
      ],
      "content": "Under the resource group, right-click the node for your API app and select <bpt id=\"p1\">**</bpt>Attach Debugger<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Attaching debugger",
      "pos": [
        2314,
        2332
      ]
    },
    {
      "content": "The remote debugger will try to connect.",
      "pos": [
        2400,
        2440
      ]
    },
    {
      "content": "In some cases, you may need to retry clicking <bpt id=\"p1\">**</bpt>Attach Debugger<ept id=\"p1\">**</ept> to establish a connection, so if it fails, try again.",
      "pos": [
        2441,
        2560
      ]
    },
    {
      "content": "Attaching debugger",
      "pos": [
        2568,
        2586
      ]
    },
    {
      "pos": [
        2647,
        2789
      ],
      "content": "After the connection is established, open the <bpt id=\"p1\">**</bpt>ContactsController.cs<ept id=\"p1\">**</ept> file in the API App project, and add a breakpoint in the <ph id=\"ph1\">`Get`</ph> method."
    },
    {
      "content": "Applying breakpoints to controller",
      "pos": [
        2797,
        2831
      ]
    },
    {
      "content": "Return to the browser session, click the <bpt id=\"p1\">**</bpt>Get<ept id=\"p1\">**</ept> verb to display the schema for the <bpt id=\"p2\">*</bpt>Contact<ept id=\"p2\">*</ept> object, and then click <bpt id=\"p3\">**</bpt>Try it Out<ept id=\"p3\">**</ept>.",
      "pos": [
        2895,
        3027
      ]
    },
    {
      "content": "Visual Studio stops program execution at your breakpoint, and you can debug your controller's logic.",
      "pos": [
        3028,
        3128
      ]
    },
    {
      "content": "Try it out",
      "pos": [
        3137,
        3147
      ]
    },
    {
      "content": "Debug an API app locally",
      "pos": [
        3209,
        3233
      ]
    },
    {
      "content": "There may be times when you want to debug your API app locally; for example, if round-trips to the Azure server make debugging slow.",
      "pos": [
        3236,
        3368
      ]
    },
    {
      "content": "This section illustrates how to debug your API app locally using the Swagger UI  as the test client.",
      "pos": [
        3369,
        3469
      ]
    },
    {
      "pos": [
        3474,
        3556
      ],
      "content": "In your browser, navigate to the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">](https://portal.azure.com)</ept>."
    },
    {
      "pos": [
        3562,
        3629
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> button on the sidebar and select <bpt id=\"p2\">**</bpt>API Apps<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Browse options on Azure portal",
      "pos": [
        3638,
        3668
      ]
    },
    {
      "content": "From the list of API apps in your subscription, select the API app you created.",
      "pos": [
        3726,
        3805
      ]
    },
    {
      "content": "API App List",
      "pos": [
        3813,
        3825
      ]
    },
    {
      "pos": [
        3889,
        3940
      ],
      "content": "In the API app's blade, click the <bpt id=\"p1\">**</bpt>API app host<ept id=\"p1\">**</ept>."
    },
    {
      "content": "API App Host",
      "pos": [
        3948,
        3960
      ]
    },
    {
      "pos": [
        4038,
        4090
      ],
      "content": "In the API app host's blade, click <bpt id=\"p1\">**</bpt>All Settings<ept id=\"p1\">**</ept>."
    },
    {
      "content": "API App Host All Settings",
      "pos": [
        4098,
        4123
      ]
    },
    {
      "pos": [
        4200,
        4258
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> blade, click <bpt id=\"p2\">**</bpt>Application settings<ept id=\"p2\">**</ept>."
    },
    {
      "content": "API App Host Application Settings",
      "pos": [
        4266,
        4299
      ]
    },
    {
      "pos": [
        4371,
        4450
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Web app settings<ept id=\"p1\">**</ept> blade, scroll down to the <bpt id=\"p2\">**</bpt>App settings<ept id=\"p2\">**</ept> section."
    },
    {
      "content": "API App Host Application Settings for Local Debug",
      "pos": [
        4458,
        4507
      ]
    },
    {
      "pos": [
        4591,
        4654
      ],
      "content": "In Visual Studio, open the API app project's <bpt id=\"p1\">*</bpt>web.config<ept id=\"p1\">*</ept> file."
    },
    {
      "pos": [
        4660,
        4776
      ],
      "content": "From <bpt id=\"p1\">**</bpt>App settings<ept id=\"p1\">**</ept>, add each of the following keys and values to the <bpt id=\"p2\">*</bpt>web.config<ept id=\"p2\">*</ept> file's <bpt id=\"p3\">**</bpt>appSettings<ept id=\"p3\">**</ept> section."
    },
    {
      "content": "EMA\\_MicroserviceId",
      "pos": [
        4785,
        4804
      ]
    },
    {
      "content": "EMA\\_Secret",
      "pos": [
        4815,
        4826
      ]
    },
    {
      "content": "EMA\\_RuntimeUrl",
      "pos": [
        4837,
        4852
      ]
    },
    {
      "pos": [
        4860,
        4968
      ],
      "content": "When you're done, the <bpt id=\"p1\">**</bpt>appSettings<ept id=\"p1\">**</ept> section of your <bpt id=\"p2\">*</bpt>web.config<ept id=\"p2\">*</ept> should resemble the following screenshot."
    },
    {
      "content": "API App Host Application Settings for Local Debug",
      "pos": [
        4976,
        5025
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> The <bpt id=\"p2\">*</bpt>EMA_<ept id=\"p2\">*</ept> values you added to your <bpt id=\"p3\">*</bpt>web.config<ept id=\"p3\">*</ept> file in this section contain sensitive authorization information.",
      "pos": [
        5092,
        5216
      ]
    },
    {
      "content": "Therefore, it is recommended that you avoid saving these values in a public source control repository.",
      "pos": [
        5217,
        5319
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Best practices for deploying passwords and other sensitive data to ASP.NET and Azure App Service<ept id=\"p1\">](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure)</ept>.",
      "pos": [
        5320,
        5580
      ]
    },
    {
      "pos": [
        5589,
        5662
      ],
      "content": "Place a breakpoint in your API app's controller code in the <ph id=\"ph1\">`Get`</ph> method."
    },
    {
      "content": "Press F5 to start a Visual Studio debugging session.",
      "pos": [
        5668,
        5720
      ]
    },
    {
      "pos": [
        5728,
        5832
      ],
      "content": "If the API app's access level is set to <bpt id=\"p1\">**</bpt>Public (anonymous)<ept id=\"p1\">**</ept>, you can use the Swagger UI page to test."
    },
    {
      "pos": [
        6266,
        6549
      ],
      "content": "If the API app's access level is set to <bpt id=\"p1\">**</bpt>Public (authenticated)<ept id=\"p1\">**</ept>, you'll need to authenticate and use a browser tool following the procedures shown in <bpt id=\"p2\">[</bpt>Protect an API app<ept id=\"p2\">](app-service-api-dotnet-add-authentication.md#use-postman-to-send-a-post-request)</ept> for a Post request, that is:"
    },
    {
      "content": "Go to the gateway login URL and enter credentials to log in.",
      "pos": [
        6557,
        6617
      ]
    },
    {
      "content": "Get the Zumo token value from the x-zumo-auth cookie.",
      "pos": [
        6624,
        6677
      ]
    },
    {
      "content": "Add an x-zumo-auth header to your request, and set its value to the x-zumo-auth cookie value.",
      "pos": [
        6684,
        6777
      ]
    },
    {
      "content": "Submit the request.",
      "pos": [
        6784,
        6803
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> When you're running locally, Azure cannot control access to the API app to ensure that only authenticated users can execute its methods.",
      "pos": [
        6809,
        6955
      ]
    },
    {
      "content": "When you run in Azure, all traffic intended for the API app is routed through the gateway, and the gateway doesn't pass on unauthenticated requests.",
      "pos": [
        6956,
        7104
      ]
    },
    {
      "content": "There is no redirection when you run locally, which means that unauthenticated requests are not prevented from accessing the API app.",
      "pos": [
        7105,
        7238
      ]
    },
    {
      "content": "The value of authenticating as described above is that you can successfully execute authentication-related code in the API app, such as code that retrieves information about the logged-on user.",
      "pos": [
        7240,
        7433
      ]
    },
    {
      "content": "For more information about how the gateway handles authentication for API apps, see <bpt id=\"p1\">[</bpt>Authentication for API apps and mobile apps<ept id=\"p1\">](../app-service/app-service-authentication-overview.md#azure-app-service-gateway)</ept>.",
      "pos": [
        7434,
        7645
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        7650,
        7660
      ]
    },
    {
      "content": "In this tutorial, you've seen how to debug API Apps.",
      "pos": [
        7662,
        7714
      ]
    },
    {
      "content": "For more troubleshooting information, see <bpt id=\"p1\">[</bpt>Troubleshoot a web app in Azure App Service using Visual Studio<ept id=\"p1\">](../app-service-web/web-sites-dotnet-troubleshoot-visual-studio.md)</ept>.",
      "pos": [
        7717,
        7892
      ]
    },
    {
      "content": "Because API apps are web apps that have additional features for hosting web services, you can use the same debugging and troubleshooting tools for API apps that you use for web apps.",
      "pos": [
        7893,
        8075
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Debug an API App in Azure App Service\" \n    description=\"Learn how to debug an API App while it runs in Azure App Service, using Visual Studio.\" \n    services=\"app-service\\api\" \n    documentationCenter=\".net\" \n    authors=\"bradygaster\" \n    manager=\"wpickett\" \n    editor=\"jimbe\"/>\n\n<tags \n    ms.service=\"app-service-api\" \n    ms.workload=\"web\" \n    ms.tgt_pltfrm=\"dotnet\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"10/08/2015\" \n    ms.author=\"tdykstra\"/>\n\n# Debug an API App in Azure App Service\n\n[AZURE.INCLUDE [app-service-api-v2-note](../../includes/app-service-api-v2-note.md)]\n\n## Overview\n\nIn this tutorial, you debug ASP.NET Web API code that is configured to run in an [API app](app-service-api-apps-why-best-platform.md) in [Azure App Service](../app-service/app-service-value-prop-what-is.md). You debug the code while it is running locally and while it runs remotely in Azure. \n\nThe tutorial works with the API app that you [create](app-service-dotnet-create-api-app.md) and [deploy](app-service-dotnet-deploy-api-app.md) in the previous tutorials in this series.\n\n## Debug an API app remotely \n\nTo enable remote debugging, you have to deploy a debug build to Azure.\n\n1. In the Visual Studio **Solution Explorer**, right-click the project that you deployed in [the previous tutorial](app-service-dotnet-deploy-api-app.md), and select **Publish**.\n\n2. In the **Publish Web** dialog, select the **Settings** tab and select the **Debug** build configuration.\n\n4. Click **Publish**.\n\n    ![Publish project](./media/app-service-api-dotnet-debug/rd-debug-publish.png)\n\n    A browser window opens to the base URL of your API app.\n\n4. In the browser address bar, add /swagger to the end of the URL and press Enter. \n\n    This step assumes that you enabled the Swagger UI as directed in the [create](app-service-dotnet-create-api-app.md) tutorial.\n\n    ![Swagger UI](./media/app-service-api-dotnet-debug/rd-swagger-ui.png)\n\n5. Return to Visual Studio, and click from **View > Server Explorer**. \n\n6. In **Server Explorer**, expand the **Azure > App Service** node. \n\n7. Locate the resource group that you created or selected when you deployed your API app. \n\n8. Under the resource group, right-click the node for your API app and select **Attach Debugger**. \n\n    ![Attaching debugger](./media/app-service-api-dotnet-debug/rd-attach-debugger.png)\n\n    The remote debugger will try to connect. In some cases, you may need to retry clicking **Attach Debugger** to establish a connection, so if it fails, try again.\n\n    ![Attaching debugger](./media/app-service-api-dotnet-debug/rd-attaching.png)\n\n9. After the connection is established, open the **ContactsController.cs** file in the API App project, and add a breakpoint in the `Get` method.\n\n    ![Applying breakpoints to controller](./media/app-service-api-dotnet-debug/rd-breakpoints.png)\n\n10. Return to the browser session, click the **Get** verb to display the schema for the *Contact* object, and then click **Try it Out**. Visual Studio stops program execution at your breakpoint, and you can debug your controller's logic. \n\n    ![Try it out](./media/app-service-api-dotnet-debug/rd-try-it-out.png)\n\n## Debug an API app locally \n\nThere may be times when you want to debug your API app locally; for example, if round-trips to the Azure server make debugging slow. This section illustrates how to debug your API app locally using the Swagger UI  as the test client.\n\n2. In your browser, navigate to the [Azure preview portal](https://portal.azure.com). \n\n3. Click the **Browse** button on the sidebar and select **API Apps**. \n\n    ![Browse options on Azure portal](./media/app-service-api-dotnet-debug/ld-browse.png)\n\n4. From the list of API apps in your subscription, select the API app you created.\n\n    ![API App List](./media/app-service-api-dotnet-debug/ld-api-app-list.png)\n\n5. In the API app's blade, click the **API app host**.\n\n    ![API App Host](./media/app-service-api-dotnet-debug/ld-api-app-blade-api-app-host.png)\n\n6. In the API app host's blade, click **All Settings**.\n\n    ![API App Host All Settings](./media/app-service-api-dotnet-debug/ld-api-app-host-all-settings.png)\n\n7. In the **Settings** blade, click **Application settings**.\n\n    ![API App Host Application Settings](./media/app-service-api-dotnet-debug/ld-application-settings.png)\n\n8. In the **Web app settings** blade, scroll down to the **App settings** section.\n\n    ![API App Host Application Settings for Local Debug](./media/app-service-api-dotnet-debug/ld-app-settings-for-local-debugging.png)\n\n1. In Visual Studio, open the API app project's *web.config* file. \n\n9. From **App settings**, add each of the following keys and values to the *web.config* file's **appSettings** section.\n    - **EMA\\_MicroserviceId**\n    - **EMA\\_Secret**\n    - **EMA\\_RuntimeUrl**\n\n    When you're done, the **appSettings** section of your *web.config* should resemble the following screenshot.\n\n    ![API App Host Application Settings for Local Debug](./media/app-service-api-dotnet-debug/ld-debug-settings.png)\n\n    **Note:** The *EMA_* values you added to your *web.config* file in this section contain sensitive authorization information. Therefore, it is recommended that you avoid saving these values in a public source control repository. For more information, see [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure App Service](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).   \n\n10. Place a breakpoint in your API app's controller code in the `Get` method.\n\n11. Press F5 to start a Visual Studio debugging session.\n \n13.  If the API app's access level is set to **Public (anonymous)**, you can use the Swagger UI page to test.\n\n    * When the browser loads the page, you see an HTTP 403 error page. Add */swagger* to the end of the URL in your browser's address bar and press Enter.\n\n    * Once the Swagger UI has loaded, click the **Get** verb on the browser window to display the schema for the Contact object, and then click **Try it Out**.\n\n        Visual Studio stops program execution on your breakpoint, and you can debug your controller's logic. \n\n14. If the API app's access level is set to **Public (authenticated)**, you'll need to authenticate and use a browser tool following the procedures shown in [Protect an API app](app-service-api-dotnet-add-authentication.md#use-postman-to-send-a-post-request) for a Post request, that is:\n\n    * Go to the gateway login URL and enter credentials to log in.\n    * Get the Zumo token value from the x-zumo-auth cookie.\n    * Add an x-zumo-auth header to your request, and set its value to the x-zumo-auth cookie value.\n    * Submit the request.\n\n    **Note:** When you're running locally, Azure cannot control access to the API app to ensure that only authenticated users can execute its methods. When you run in Azure, all traffic intended for the API app is routed through the gateway, and the gateway doesn't pass on unauthenticated requests. There is no redirection when you run locally, which means that unauthenticated requests are not prevented from accessing the API app.  The value of authenticating as described above is that you can successfully execute authentication-related code in the API app, such as code that retrieves information about the logged-on user. For more information about how the gateway handles authentication for API apps, see [Authentication for API apps and mobile apps](../app-service/app-service-authentication-overview.md#azure-app-service-gateway).\n\n## Next steps\n\nIn this tutorial, you've seen how to debug API Apps. \n\nFor more troubleshooting information, see [Troubleshoot a web app in Azure App Service using Visual Studio](../app-service-web/web-sites-dotnet-troubleshoot-visual-studio.md). Because API apps are web apps that have additional features for hosting web services, you can use the same debugging and troubleshooting tools for API apps that you use for web apps.    \n\n\n"
}