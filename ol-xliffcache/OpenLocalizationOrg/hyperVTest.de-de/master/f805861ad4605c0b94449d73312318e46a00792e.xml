{
  "nodes": [
    {
      "pos": [
        27,
        96
      ],
      "content": "Manage Hadoop clusters in HDInsight with PowerShell | Microsoft Azure"
    },
    {
      "pos": [
        115,
        217
      ],
      "content": "Learn how to perform administrative tasks for the Hadoop clusters in HDInsight using Azure PowerShell."
    },
    {
      "pos": [
        541,
        602
      ],
      "content": "Manage Hadoop clusters in HDInsight by using Azure PowerShell"
    },
    {
      "pos": [
        688,
        1117
      ],
      "content": "Azure PowerShell is a powerful scripting environment that you can use to control and automate the deployment and management of your workloads in Azure. In this article, you will learn how to manage Hadoop clusters in Azure HDInsight by using a local Azure PowerShell console through the use of Windows PowerShell. For the list of the HDInsight PowerShell cmdlets, see <bpt id=\"p1\">[</bpt>HDInsight cmdlet reference<ept id=\"p1\">][hdinsight-powershell-reference]</ept>.",
      "nodes": [
        {
          "content": "Azure PowerShell is a powerful scripting environment that you can use to control and automate the deployment and management of your workloads in Azure.",
          "pos": [
            0,
            151
          ]
        },
        {
          "content": "In this article, you will learn how to manage Hadoop clusters in Azure HDInsight by using a local Azure PowerShell console through the use of Windows PowerShell.",
          "pos": [
            152,
            313
          ]
        },
        {
          "content": "For the list of the HDInsight PowerShell cmdlets, see <bpt id=\"p1\">[</bpt>HDInsight cmdlet reference<ept id=\"p1\">][hdinsight-powershell-reference]</ept>.",
          "pos": [
            314,
            467
          ]
        }
      ]
    },
    {
      "pos": [
        1121,
        1138
      ],
      "content": "<bpt id=\"p2\">**</bpt>Prerequisites<ept id=\"p2\">**</ept>"
    },
    {
      "pos": [
        1140,
        1199
      ],
      "content": "Before you begin this article, you must have the following:"
    },
    {
      "pos": [
        1203,
        1361
      ],
      "content": "<bpt id=\"p3\">**</bpt>An Azure subscription<ept id=\"p3\">**</ept>. See <bpt id=\"p4\">[</bpt>Get Azure free trial<ept id=\"p4\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p3\">**</bpt>An Azure subscription<ept id=\"p3\">**</ept>.",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "See <bpt id=\"p4\">[</bpt>Get Azure free trial<ept id=\"p4\">](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/)</ept>.",
          "pos": [
            65,
            234
          ]
        }
      ]
    },
    {
      "pos": [
        1365,
        1405
      ],
      "content": "Install Azure PowerShell 1.0 and greater"
    },
    {
      "pos": [
        1407,
        1449
      ],
      "content": "First you must unintall the 0.9x versions."
    },
    {
      "pos": [
        1451,
        1500
      ],
      "content": "To check the version of the installed PowerShell:"
    },
    {
      "pos": [
        1530,
        1609
      ],
      "content": "To uninstall the older version, run Programs and Features in the control panel."
    },
    {
      "pos": [
        1612,
        1671
      ],
      "content": "There are two main options for installing Azure PowerShell."
    },
    {
      "pos": [
        1676,
        1829
      ],
      "content": "<bpt id=\"p5\">[</bpt>PowerShell Gallery<ept id=\"p5\">](https://www.powershellgallery.com/)</ept>. Run the following commands from elevated PowerShell ISE or elevated Windows PowerShell console:",
      "nodes": [
        {
          "content": "<bpt id=\"p5\">[</bpt>PowerShell Gallery<ept id=\"p5\">](https://www.powershellgallery.com/)</ept>.",
          "pos": [
            0,
            95
          ]
        },
        {
          "content": "Run the following commands from elevated PowerShell ISE or elevated Windows PowerShell console:",
          "pos": [
            96,
            191
          ]
        }
      ]
    },
    {
      "pos": [
        2288,
        2371
      ],
      "content": "For more information, see <bpt id=\"p6\">[</bpt>PowerShell Gallery<ept id=\"p6\">](https://www.powershellgallery.com/)</ept>."
    },
    {
      "pos": [
        2375,
        2831
      ],
      "content": "<bpt id=\"p7\">[</bpt>Microsoft Web Platform Installer (WebPI)<ept id=\"p7\">](http://aka.ms/webpi-azps)</ept>. If you have Azure PowerShell 0.9.x installed, you will be prompted to uninstall 0.9.x. If you installed Azure PowerShell modules from PowerShell Gallery, the installer requires the modules be removed prior to installation to ensure a consistent Azure PowerShell Environment. For the instructions, see <bpt id=\"p8\">[</bpt>Install Azure PowerShell 1.0 via WebPI<ept id=\"p8\">](https://azure.microsoft.com/blog/azps-1-0/)</ept>.",
      "nodes": [
        {
          "content": "<bpt id=\"p7\">[</bpt>Microsoft Web Platform Installer (WebPI)<ept id=\"p7\">](http://aka.ms/webpi-azps)</ept>.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "If you have Azure PowerShell 0.9.x installed, you will be prompted to uninstall 0.9.x.",
          "pos": [
            108,
            194
          ]
        },
        {
          "content": "If you installed Azure PowerShell modules from PowerShell Gallery, the installer requires the modules be removed prior to installation to ensure a consistent Azure PowerShell Environment.",
          "pos": [
            195,
            382
          ]
        },
        {
          "content": "For the instructions, see <bpt id=\"p8\">[</bpt>Install Azure PowerShell 1.0 via WebPI<ept id=\"p8\">](https://azure.microsoft.com/blog/azps-1-0/)</ept>.",
          "pos": [
            383,
            532
          ]
        }
      ]
    },
    {
      "pos": [
        2833,
        3075
      ],
      "content": "WebPI will receive monthly updates. PowerShell Gallery will receive updates on a continuous basis. If you are comfortable with installing from PowerShell Gallery, that will be the first channel for the latest and greatest in Azure PowerShell.",
      "nodes": [
        {
          "content": "WebPI will receive monthly updates.",
          "pos": [
            0,
            35
          ]
        },
        {
          "content": "PowerShell Gallery will receive updates on a continuous basis.",
          "pos": [
            36,
            98
          ]
        },
        {
          "content": "If you are comfortable with installing from PowerShell Gallery, that will be the first channel for the latest and greatest in Azure PowerShell.",
          "pos": [
            99,
            242
          ]
        }
      ]
    },
    {
      "pos": [
        3079,
        3094
      ],
      "content": "Create clusters"
    },
    {
      "pos": [
        3096,
        3196
      ],
      "content": "HDInsight cluster requires an Azure Resource group and a Blob container on an Azure Storage account:"
    },
    {
      "pos": [
        3200,
        3476
      ],
      "content": "Azure Resource group is a logical container for Azure resources. The Azure resource group and the HDInsight cluster don't have to be in the same location.  For more information, see <bpt id=\"p9\">[</bpt>Using Azure PowerShell with Azure Resource Manager<ept id=\"p9\">](../powershell-azure-resource-manager.md)</ept>.",
      "nodes": [
        {
          "content": "Azure Resource group is a logical container for Azure resources.",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "The Azure resource group and the HDInsight cluster don't have to be in the same location.",
          "pos": [
            65,
            154
          ]
        },
        {
          "content": "For more information, see <bpt id=\"p9\">[</bpt>Using Azure PowerShell with Azure Resource Manager<ept id=\"p9\">](../powershell-azure-resource-manager.md)</ept>.",
          "pos": [
            156,
            314
          ]
        }
      ]
    },
    {
      "pos": [
        3479,
        3759
      ],
      "content": "HDInsight uses a Blob container of an Azure Storage account as the default file system. An Azure Storage account and a storage container are required before you can create an HDInsight cluster. The default storage account and the HDInsight cluster have to be in the same location.",
      "nodes": [
        {
          "content": "HDInsight uses a Blob container of an Azure Storage account as the default file system.",
          "pos": [
            0,
            87
          ]
        },
        {
          "content": "An Azure Storage account and a storage container are required before you can create an HDInsight cluster.",
          "pos": [
            88,
            193
          ]
        },
        {
          "content": "The default storage account and the HDInsight cluster have to be in the same location.",
          "pos": [
            194,
            280
          ]
        }
      ]
    },
    {
      "pos": [
        3839,
        3862
      ],
      "content": "<bpt id=\"p10\">**</bpt>To connect to Azure<ept id=\"p10\">**</ept>"
    },
    {
      "pos": [
        4052,
        4139
      ],
      "content": "<bpt id=\"p11\">**</bpt>Select-AzureRMSubscription<ept id=\"p11\">**</ept><ph id=\"ph4\"/> is called in case you have multiple Azure subscriptions."
    },
    {
      "pos": [
        4145,
        4179
      ],
      "content": "<bpt id=\"p12\">**</bpt>To create a new resource group<ept id=\"p12\">**</ept>"
    },
    {
      "pos": [
        4306,
        4344
      ],
      "content": "<bpt id=\"p13\">**</bpt>To create an Azure Storage account<ept id=\"p13\">**</ept>"
    },
    {
      "pos": [
        4949,
        5110
      ],
      "content": "For information on creating an Azure Storage account by using the Azure Portal, see <bpt id=\"p14\">[</bpt>About Azure storage accounts<ept id=\"p14\">](../storage/storage-create-storage-account.md)</ept>."
    },
    {
      "pos": [
        5112,
        5267
      ],
      "content": "If you have already had a Storage account but do not know the account name and account key, you can use the following commands to retrieve the information:"
    },
    {
      "pos": [
        5534,
        5739
      ],
      "content": "For details on getting the information by using the Portal, see the \"View, copy, and regenerate storage access keys\" section of <bpt id=\"p15\">[</bpt>About Azure storage accounts<ept id=\"p15\">](../storage/storage-create-storage-account.md)</ept>."
    },
    {
      "pos": [
        5741,
        5781
      ],
      "content": "<bpt id=\"p16\">**</bpt>To create an Azure storage container<ept id=\"p16\">**</ept>"
    },
    {
      "pos": [
        5783,
        5919
      ],
      "content": "Azure PowerShell cannot create a Blob container during the HDInsight creation process. You can create one by using the following script:",
      "nodes": [
        {
          "content": "Azure PowerShell cannot create a Blob container during the HDInsight creation process.",
          "pos": [
            0,
            86
          ]
        },
        {
          "content": "You can create one by using the following script:",
          "pos": [
            87,
            136
          ]
        }
      ]
    },
    {
      "pos": [
        6487,
        6510
      ],
      "content": "<bpt id=\"p17\">**</bpt>To create a cluster<ept id=\"p17\">**</ept>"
    },
    {
      "pos": [
        6512,
        6613
      ],
      "content": "Once you have the Storage account and the Blob container prepared, you are ready to create a cluster."
    },
    {
      "pos": [
        7470,
        7483
      ],
      "content": "List clusters"
    },
    {
      "pos": [
        7484,
        7559
      ],
      "content": "Use the following command to list all clusters in the current subscription:"
    },
    {
      "pos": [
        7596,
        7608
      ],
      "content": "Show cluster"
    },
    {
      "pos": [
        7610,
        7702
      ],
      "content": "Use the following command to show details of a specific cluster in the current subscription:"
    },
    {
      "pos": [
        7767,
        7782
      ],
      "content": "Delete clusters"
    },
    {
      "pos": [
        7783,
        7829
      ],
      "content": "Use the following command to delete a cluster:"
    },
    {
      "pos": [
        7897,
        7911
      ],
      "content": "Scale clusters"
    },
    {
      "pos": [
        7912,
        8081
      ],
      "content": "The cluster scaling feature allows you to change the number of worker nodes used by a cluster that is running in Azure HDInsight without having to re-create the cluster."
    },
    {
      "pos": [
        8084,
        8395
      ],
      "content": "<ph id=\"ph6\">[AZURE.NOTE]</ph><ph id=\"ph7\"/> Only clusters with HDInsight version 3.1.3 or higher are supported. If you are unsure of the version of your cluster, you can check the Properties page.  See <bpt id=\"p18\">[</bpt>Get familiar with the cluster portal interface<ept id=\"p18\">](hdinsight-adminster-use-management-portal/#Get-familiar-with-the-cluster-portal-interface)</ept>.",
      "nodes": [
        {
          "content": "<ph id=\"ph6\">[AZURE.NOTE]</ph><ph id=\"ph7\"/> Only clusters with HDInsight version 3.1.3 or higher are supported.",
          "pos": [
            0,
            112
          ]
        },
        {
          "content": "If you are unsure of the version of your cluster, you can check the Properties page.",
          "pos": [
            113,
            197
          ]
        },
        {
          "content": "See <bpt id=\"p18\">[</bpt>Get familiar with the cluster portal interface<ept id=\"p18\">](hdinsight-adminster-use-management-portal/#Get-familiar-with-the-cluster-portal-interface)</ept>.",
          "pos": [
            199,
            383
          ]
        }
      ]
    },
    {
      "pos": [
        8397,
        8493
      ],
      "content": "The impact of changing the number of data nodes for each type of cluster supported by HDInsight:"
    },
    {
      "pos": [
        8497,
        8503
      ],
      "content": "Hadoop"
    },
    {
      "pos": [
        8509,
        8826
      ],
      "content": "You can seamlessly increase the number of worker nodes in a Hadoop cluster that is running without impacting any pending or running jobs. New jobs can also be submitted while the operation is in progress. Failures in a scaling operation are gracefully handled so that the cluster is always left in a functional state.",
      "nodes": [
        {
          "content": "You can seamlessly increase the number of worker nodes in a Hadoop cluster that is running without impacting any pending or running jobs.",
          "pos": [
            0,
            137
          ]
        },
        {
          "content": "New jobs can also be submitted while the operation is in progress.",
          "pos": [
            138,
            204
          ]
        },
        {
          "content": "Failures in a scaling operation are gracefully handled so that the cluster is always left in a functional state.",
          "pos": [
            205,
            317
          ]
        }
      ]
    },
    {
      "pos": [
        8832,
        9118
      ],
      "content": "When a Hadoop cluster is scaled down by reducing the number of data nodes, some of the services in the cluster are restarted. This causes all running and pending jobs to fail at the completion of the scaling operation. You can, however, resubmit the jobs once the operation is complete.",
      "nodes": [
        {
          "content": "When a Hadoop cluster is scaled down by reducing the number of data nodes, some of the services in the cluster are restarted.",
          "pos": [
            0,
            125
          ]
        },
        {
          "content": "This causes all running and pending jobs to fail at the completion of the scaling operation.",
          "pos": [
            126,
            218
          ]
        },
        {
          "content": "You can, however, resubmit the jobs once the operation is complete.",
          "pos": [
            219,
            286
          ]
        }
      ]
    },
    {
      "pos": [
        9122,
        9127
      ],
      "content": "HBase"
    },
    {
      "pos": [
        9133,
        9481
      ],
      "content": "You can seamlessly add or remove nodes to your HBase cluster while it is running. Regional Servers are automatically balanced within a few minutes of completing the scaling operation. However, you can also manually balance the regional servers by logging into the headnode of cluster and running the following commands from a command prompt window:",
      "nodes": [
        {
          "content": "You can seamlessly add or remove nodes to your HBase cluster while it is running.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "Regional Servers are automatically balanced within a few minutes of completing the scaling operation.",
          "pos": [
            82,
            183
          ]
        },
        {
          "content": "However, you can also manually balance the regional servers by logging into the headnode of cluster and running the following commands from a command prompt window:",
          "pos": [
            184,
            348
          ]
        }
      ]
    },
    {
      "pos": [
        9559,
        9612
      ],
      "content": "For more information on using the HBase shell, see []"
    },
    {
      "pos": [
        9615,
        9620
      ],
      "content": "Storm"
    },
    {
      "pos": [
        9626,
        9813
      ],
      "content": "You can seamlessly add or remove data nodes to your Storm cluster while it is running. But after a successful completion of the scaling operation, you will need to rebalance the topology.",
      "nodes": [
        {
          "content": "You can seamlessly add or remove data nodes to your Storm cluster while it is running.",
          "pos": [
            0,
            86
          ]
        },
        {
          "content": "But after a successful completion of the scaling operation, you will need to rebalance the topology.",
          "pos": [
            87,
            187
          ]
        }
      ]
    },
    {
      "pos": [
        9819,
        9863
      ],
      "content": "Rebalancing can be accomplished in two ways:"
    },
    {
      "pos": [
        9871,
        9883
      ],
      "content": "Storm web UI"
    },
    {
      "pos": [
        9890,
        9923
      ],
      "content": "Command-line interface (CLI) tool"
    },
    {
      "pos": [
        9929,
        10089
      ],
      "content": "Please refer to the <bpt id=\"p19\">[</bpt>Apache Storm documentation<ept id=\"p19\">](http://storm.apache.org/documentation/Understanding-the-parallelism-of-a-Storm-topology.html)</ept><ph id=\"ph8\"/> for more details."
    },
    {
      "pos": [
        10095,
        10150
      ],
      "content": "The Storm web UI is available on the HDInsight cluster:"
    },
    {
      "pos": [
        10156,
        10293
      ],
      "content": "<ph id=\"ph9\">![</ph>hdinsight storm scale rebalance<ph id=\"ph10\">](./media/hdinsight-administer-use-management-portal/hdinsight.portal.scale.cluster.storm.rebalance.png)</ph>"
    },
    {
      "pos": [
        10299,
        10377
      ],
      "content": "Here is an example how to use the CLI command to rebalance the Storm topology:"
    },
    {
      "pos": [
        10645,
        10754
      ],
      "content": "To change the Hadoop cluster size by using Azure PowerShell, run the following command from a client machine:"
    },
    {
      "pos": [
        10859,
        10878
      ],
      "content": "Grant/revoke access"
    },
    {
      "pos": [
        10880,
        10983
      ],
      "content": "HDInsight clusters have the following HTTP web services (all of these services have RESTful endpoints):"
    },
    {
      "pos": [
        10987,
        10991
      ],
      "content": "ODBC"
    },
    {
      "pos": [
        10994,
        10998
      ],
      "content": "JDBC"
    },
    {
      "pos": [
        11001,
        11007
      ],
      "content": "Ambari"
    },
    {
      "pos": [
        11010,
        11015
      ],
      "content": "Oozie"
    },
    {
      "pos": [
        11018,
        11027
      ],
      "content": "Templeton"
    },
    {
      "pos": [
        11030,
        11124
      ],
      "content": "By default, these services are granted for access. You can revoke/grant the access. To revoke:",
      "nodes": [
        {
          "content": "By default, these services are granted for access.",
          "pos": [
            0,
            50
          ]
        },
        {
          "content": "You can revoke/grant the access.",
          "pos": [
            51,
            83
          ]
        },
        {
          "content": "To revoke:",
          "pos": [
            84,
            94
          ]
        }
      ]
    },
    {
      "pos": [
        11201,
        11210
      ],
      "content": "To grant:"
    },
    {
      "pos": [
        11791,
        11887
      ],
      "content": "<ph id=\"ph11\">[AZURE.NOTE]</ph><ph id=\"ph12\"/> By granting/revoking the access, you will reset the cluster user name and password."
    },
    {
      "pos": [
        11889,
        12004
      ],
      "content": "This can also be done via the Portal. See <bpt id=\"p20\">[</bpt>Administer HDInsight by using the Azure Portal<ept id=\"p20\">][hdinsight-admin-portal]</ept>.",
      "nodes": [
        {
          "content": "This can also be done via the Portal.",
          "pos": [
            0,
            37
          ]
        },
        {
          "content": "See <bpt id=\"p20\">[</bpt>Administer HDInsight by using the Azure Portal<ept id=\"p20\">][hdinsight-admin-portal]</ept>.",
          "pos": [
            38,
            155
          ]
        }
      ]
    },
    {
      "pos": [
        12008,
        12036
      ],
      "content": "Update HTTP user credentials"
    },
    {
      "pos": [
        12038,
        12248
      ],
      "content": "It is the same procedure as <bpt id=\"p21\">[</bpt>Grant/revoke HTTP access<ept id=\"p21\">](#grant/revoke-access)</ept>.If the cluster has been granted the HTTP access, you must first revoke it.  And then grant the access with new HTTP user credentials.",
      "nodes": [
        {
          "content": "It is the same procedure as <bpt id=\"p21\">[</bpt>Grant/revoke HTTP access<ept id=\"p21\">](#grant/revoke-access)</ept>.If the cluster has been granted the HTTP access, you must first revoke it.",
          "pos": [
            0,
            191
          ]
        },
        {
          "content": "And then grant the access with new HTTP user credentials.",
          "pos": [
            193,
            250
          ]
        }
      ]
    },
    {
      "pos": [
        12253,
        12285
      ],
      "content": "Find the default storage account"
    },
    {
      "pos": [
        12287,
        12426
      ],
      "content": "The following Powershell script demonstrates how to get the default storage account name and the default storage account key for a cluster."
    },
    {
      "pos": [
        13069,
        13092
      ],
      "content": "Find the resource group"
    },
    {
      "pos": [
        13094,
        13198
      ],
      "content": "In the ARM mode, each HDInsight cluster belongs to an Azure resource group.  To find the resource group:",
      "nodes": [
        {
          "content": "In the ARM mode, each HDInsight cluster belongs to an Azure resource group.",
          "pos": [
            0,
            75
          ]
        },
        {
          "content": "To find the resource group:",
          "pos": [
            77,
            104
          ]
        }
      ]
    },
    {
      "pos": [
        13372,
        13383
      ],
      "content": "Submit jobs"
    },
    {
      "pos": [
        13385,
        13413
      ],
      "content": "<bpt id=\"p22\">**</bpt>To submit MapReduce jobs<ept id=\"p22\">**</ept>"
    },
    {
      "pos": [
        13415,
        13503
      ],
      "content": "See <bpt id=\"p23\">[</bpt>Run Hadoop MapReduce samples in Windows-based HDInsight<ept id=\"p23\">](hdinsight-run-samples.md)</ept>."
    },
    {
      "pos": [
        13505,
        13528
      ],
      "content": "<bpt id=\"p24\">**</bpt>To submit Hive jobs<ept id=\"p24\">**</ept>"
    },
    {
      "pos": [
        13531,
        13612
      ],
      "content": "See <bpt id=\"p25\">[</bpt>Run Hive queries using PowerShell<ept id=\"p25\">](hdinsight-hadoop-use-hive-powershell.md)</ept>."
    },
    {
      "pos": [
        13614,
        13636
      ],
      "content": "<bpt id=\"p26\">**</bpt>To submit Pig jobs<ept id=\"p26\">**</ept>"
    },
    {
      "pos": [
        13638,
        13714
      ],
      "content": "See <bpt id=\"p27\">[</bpt>Run Pig jobs using PowerShell<ept id=\"p27\">](hdinsight-hadoop-use-pig-powershell.md)</ept>."
    },
    {
      "pos": [
        13716,
        13740
      ],
      "content": "<bpt id=\"p28\">**</bpt>To submit Sqoop jobs<ept id=\"p28\">**</ept>"
    },
    {
      "pos": [
        13742,
        13797
      ],
      "content": "See <bpt id=\"p29\">[</bpt>Use Sqoop with HDInsight<ept id=\"p29\">](hdinsight-use-sqoop.md)</ept>."
    },
    {
      "pos": [
        13799,
        13823
      ],
      "content": "<bpt id=\"p30\">**</bpt>To submit Oozie jobs<ept id=\"p30\">**</ept>"
    },
    {
      "pos": [
        13825,
        13919
      ],
      "content": "See <bpt id=\"p31\">[</bpt>Use Oozie with Hadoop to define and run a workflow in HDInsight<ept id=\"p31\">](hdinsight-use-oozie.md)</ept>."
    },
    {
      "pos": [
        13923,
        14011
      ],
      "content": "Upload data to Azure Blob storage\nSee <bpt id=\"p32\">[</bpt>Upload data to HDInsight<ept id=\"p32\">][hdinsight-upload-data]</ept>."
    },
    {
      "pos": [
        14017,
        14025
      ],
      "content": "See Also"
    },
    {
      "pos": [
        14028,
        14102
      ],
      "content": "<bpt id=\"p33\">[</bpt>HDInsight cmdlet reference documentation<ept id=\"p33\">][hdinsight-powershell-reference]</ept>"
    },
    {
      "pos": [
        14105,
        14177
      ],
      "content": "<bpt id=\"p34\">[</bpt>Administer HDInsight by using the Azure Portal<ept id=\"p34\">][hdinsight-admin-portal]</ept>"
    },
    {
      "pos": [
        14180,
        14254
      ],
      "content": "<bpt id=\"p35\">[</bpt>Administer HDInsight using a command-line interface<ept id=\"p35\">][hdinsight-admin-cli]</ept>"
    },
    {
      "pos": [
        14257,
        14305
      ],
      "content": "<bpt id=\"p36\">[</bpt>Create HDInsight clusters<ept id=\"p36\">][hdinsight-provision]</ept>"
    },
    {
      "pos": [
        14308,
        14357
      ],
      "content": "<bpt id=\"p37\">[</bpt>Upload data to HDInsight<ept id=\"p37\">][hdinsight-upload-data]</ept>"
    },
    {
      "pos": [
        14360,
        14420
      ],
      "content": "<bpt id=\"p38\">[</bpt>Submit Hadoop jobs programmatically<ept id=\"p38\">][hdinsight-submit-jobs]</ept>"
    },
    {
      "pos": [
        14423,
        14480
      ],
      "content": "<bpt id=\"p39\">[</bpt>Get started with Azure HDInsight<ept id=\"p39\">][hdinsight-get-started]</ept>"
    }
  ],
  "content": "<properties\n    pageTitle=\"Manage Hadoop clusters in HDInsight with PowerShell | Microsoft Azure\"\n    description=\"Learn how to perform administrative tasks for the Hadoop clusters in HDInsight using Azure PowerShell.\"\n    services=\"hdinsight\"\n    editor=\"cgronlun\"\n    manager=\"paulettm\"\n    tags=\"azure-portal\"\n    authors=\"mumian\"\n    documentationCenter=\"\"/>\n\n<tags\n    ms.service=\"hdinsight\"\n    ms.workload=\"big-data\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"01/04/2016\"\n    ms.author=\"jgao\"/>\n\n# Manage Hadoop clusters in HDInsight by using Azure PowerShell\n\n[AZURE.INCLUDE [selector](../../includes/hdinsight-portal-management-selector.md)]\n\nAzure PowerShell is a powerful scripting environment that you can use to control and automate the deployment and management of your workloads in Azure. In this article, you will learn how to manage Hadoop clusters in Azure HDInsight by using a local Azure PowerShell console through the use of Windows PowerShell. For the list of the HDInsight PowerShell cmdlets, see [HDInsight cmdlet reference][hdinsight-powershell-reference].\n\n\n\n**Prerequisites**\n\nBefore you begin this article, you must have the following:\n\n- **An Azure subscription**. See [Get Azure free trial](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).\n\n##Install Azure PowerShell 1.0 and greater\n\nFirst you must unintall the 0.9x versions.\n\nTo check the version of the installed PowerShell:\n\n    Get-Module *azure*\n    \nTo uninstall the older version, run Programs and Features in the control panel. \n\nThere are two main options for installing Azure PowerShell. \n\n- [PowerShell Gallery](https://www.powershellgallery.com/). Run the following commands from elevated PowerShell ISE or elevated Windows PowerShell console:\n\n        # Install the Azure Resource Manager modules from PowerShell Gallery\n        Install-Module AzureRM\n        Install-AzureRM\n        \n        # Install the Azure Service Management module from PowerShell Gallery\n        Install-Module Azure\n        \n        # Import AzureRM modules for the given version manifest in the AzureRM module\n        Import-AzureRM\n        \n        # Import Azure Service Management module\n        Import-Module Azure\n\n    For more information, see [PowerShell Gallery](https://www.powershellgallery.com/).\n\n- [Microsoft Web Platform Installer (WebPI)](http://aka.ms/webpi-azps). If you have Azure PowerShell 0.9.x installed, you will be prompted to uninstall 0.9.x. If you installed Azure PowerShell modules from PowerShell Gallery, the installer requires the modules be removed prior to installation to ensure a consistent Azure PowerShell Environment. For the instructions, see [Install Azure PowerShell 1.0 via WebPI](https://azure.microsoft.com/blog/azps-1-0/).\n\nWebPI will receive monthly updates. PowerShell Gallery will receive updates on a continuous basis. If you are comfortable with installing from PowerShell Gallery, that will be the first channel for the latest and greatest in Azure PowerShell.\n\n##Create clusters\n\nHDInsight cluster requires an Azure Resource group and a Blob container on an Azure Storage account:\n\n- Azure Resource group is a logical container for Azure resources. The Azure resource group and the HDInsight cluster don't have to be in the same location.  For more information, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).\n- HDInsight uses a Blob container of an Azure Storage account as the default file system. An Azure Storage account and a storage container are required before you can create an HDInsight cluster. The default storage account and the HDInsight cluster have to be in the same location.\n\n[AZURE.INCLUDE [provisioningnote](../../includes/hdinsight-provisioning.md)]\n\n**To connect to Azure**\n\n    Login-AzureRmAccount\n    Get-AzureRmSubscription  # list your subscriptions and get your subscription ID\n    Select-AzureRmSubscription -SubscriptionId \"<Your Azure Subscription ID>\"\n\n**Select-AzureRMSubscription** is called in case you have multiple Azure subscriptions.\n    \n**To create a new resource group**\n\n    New-AzureRmResourceGroup -name <New Azure Resource Group Name> -Location \"<Azure Location>\"  # For example, \"EAST US 2\"\n\n**To create an Azure Storage account**\n\n    New-AzureRmStorageAccount -ResourceGroupName <Azure Resource Group Name> -Name <Azure Storage Account Name> -Location \"<Azure Location>\" -Type <AccountType> # account type example: Standard_LRS for zero redundancy storage\n    \n    Don't use **Standard_ZRS** because it deson't support Azure Table.  HDInsight uses Azure Table to logging. For a full list of the storage account types, see [https://msdn.microsoft.com/library/azure/hh264518.aspx](https://msdn.microsoft.com/library/azure/hh264518.aspx).\n\n[AZURE.INCLUDE [data center list](../../includes/hdinsight-pricing-data-centers-clusters.md)]\n\n\nFor information on creating an Azure Storage account by using the Azure Portal, see [About Azure storage accounts](../storage/storage-create-storage-account.md).\n\nIf you have already had a Storage account but do not know the account name and account key, you can use the following commands to retrieve the information:\n\n    # List Storage accounts for the current subscription\n    Get-AzureRmStorageAccount\n    # List the keys for a Storage account\n    Get-AzureRmStorageAccountKey -ResourceGroupName <Azure Resource Group Name> -name $storageAccountName <Azure Storage Account Name>\n\nFor details on getting the information by using the Portal, see the \"View, copy, and regenerate storage access keys\" section of [About Azure storage accounts](../storage/storage-create-storage-account.md).\n\n**To create an Azure storage container**\n\nAzure PowerShell cannot create a Blob container during the HDInsight creation process. You can create one by using the following script:\n\n    $resourceGroupName = \"<AzureResoureGroupName>\"\n    $storageAccountName = \"<Azure Storage Account Name>\"\n    $storageAccountKey = Get-AzureRmStorageAccountKey -ResourceGroupName $resourceGroupName -Name $defaultStorageAccount |  %{ $_.Key1 }\n    $containerName=\"<AzureBlobContainerName>\"\n\n    # Create a storage context object\n    $destContext = New-AzureStorageContext -StorageAccountName $storageAccountName -StorageAccountKey $storageAccountKey  \n\n    # Create a Blob storage container\n    New-AzureStorageContainer -Name $containerName -Context $destContext\n\n**To create a cluster**\n\nOnce you have the Storage account and the Blob container prepared, you are ready to create a cluster.\n\n    $resourceGroupName = \"<AzureResoureGroupName>\"\n\n    $storageAccountName = \"<Azure Storage Account Name>\"\n    $containerName = \"<AzureBlobContainerName>\"\n\n    $clusterName = \"<HDInsightClusterName>\"\n    $location = \"<AzureDataCenter>\"\n    $clusterNodes = <ClusterSizeInNodes>\n\n    # Get the Storage account key\n    $storageAccountKey = Get-AzureRmStorageAccountKey -ResourceGroupName $resourceGroupName -Name $storageAccountName | %{ $_.Key1 }\n\n    # Create a new HDInsight cluster\n    New-AzureRmHDInsightCluster -ResourceGroupName $resourceGroupName `\n        -ClusterName $clusterName `\n        -Location $location `\n        -DefaultStorageAccountName \"$storageAccountName.blob.core.windows.net\" `\n        -DefaultStorageAccountKey $storageAccountKey `\n        -DefaultStorageContainer $containerName  `\n        -ClusterSizeInNodes $clusterNodes\n\n##List clusters\nUse the following command to list all clusters in the current subscription:\n\n    Get-AzureRmHDInsightCluster\n\n##Show cluster\n\nUse the following command to show details of a specific cluster in the current subscription:\n\n    Get-AzureRmHDInsightCluster -ClusterName <Cluster Name>\n\n##Delete clusters\nUse the following command to delete a cluster:\n\n    Remove-AzureRmHDInsightCluster -ClusterName <Cluster Name>\n\n##Scale clusters\nThe cluster scaling feature allows you to change the number of worker nodes used by a cluster that is running in Azure HDInsight without having to re-create the cluster.\n\n>[AZURE.NOTE] Only clusters with HDInsight version 3.1.3 or higher are supported. If you are unsure of the version of your cluster, you can check the Properties page.  See [Get familiar with the cluster portal interface](hdinsight-adminster-use-management-portal/#Get-familiar-with-the-cluster-portal-interface).\n\nThe impact of changing the number of data nodes for each type of cluster supported by HDInsight:\n\n- Hadoop\n\n    You can seamlessly increase the number of worker nodes in a Hadoop cluster that is running without impacting any pending or running jobs. New jobs can also be submitted while the operation is in progress. Failures in a scaling operation are gracefully handled so that the cluster is always left in a functional state.\n\n    When a Hadoop cluster is scaled down by reducing the number of data nodes, some of the services in the cluster are restarted. This causes all running and pending jobs to fail at the completion of the scaling operation. You can, however, resubmit the jobs once the operation is complete.\n\n- HBase\n\n    You can seamlessly add or remove nodes to your HBase cluster while it is running. Regional Servers are automatically balanced within a few minutes of completing the scaling operation. However, you can also manually balance the regional servers by logging into the headnode of cluster and running the following commands from a command prompt window:\n\n        >pushd %HBASE_HOME%\\bin\n        >hbase shell\n        >balancer\n\n    For more information on using the HBase shell, see []\n- Storm\n\n    You can seamlessly add or remove data nodes to your Storm cluster while it is running. But after a successful completion of the scaling operation, you will need to rebalance the topology.\n\n    Rebalancing can be accomplished in two ways:\n\n    * Storm web UI\n    * Command-line interface (CLI) tool\n\n    Please refer to the [Apache Storm documentation](http://storm.apache.org/documentation/Understanding-the-parallelism-of-a-Storm-topology.html) for more details.\n\n    The Storm web UI is available on the HDInsight cluster:\n\n    ![hdinsight storm scale rebalance](./media/hdinsight-administer-use-management-portal/hdinsight.portal.scale.cluster.storm.rebalance.png)\n\n    Here is an example how to use the CLI command to rebalance the Storm topology:\n\n        ## Reconfigure the topology \"mytopology\" to use 5 worker processes,\n        ## the spout \"blue-spout\" to use 3 executors, and\n        ## the bolt \"yellow-bolt\" to use 10 executors\n\n        $ storm rebalance mytopology -n 5 -e blue-spout=3 -e yellow-bolt=10\n\nTo change the Hadoop cluster size by using Azure PowerShell, run the following command from a client machine:\n\n    Set-AzureRmHDInsightClusterSize -ClusterName <Cluster Name> -TargetInstanceCount <NewSize>\n    \n\n##Grant/revoke access\n\nHDInsight clusters have the following HTTP web services (all of these services have RESTful endpoints):\n\n- ODBC\n- JDBC\n- Ambari\n- Oozie\n- Templeton\n\n\nBy default, these services are granted for access. You can revoke/grant the access. To revoke:\n\n    Revoke-AzureRmHDInsightHttpServicesAccess -ClusterName <Cluster Name>\n\nTo grant:\n\n    $clusterName = \"<HDInsight Cluster Name>\"\n\n    # Credential option 1\n    $hadoopUserName = \"admin\"\n    $hadoopUserPassword = \"<Enter the Password>\"\n    $hadoopUserPW = ConvertTo-SecureString -String $hadoopUserPassword -AsPlainText -Force\n    $credential = New-Object System.Management.Automation.PSCredential($hadoopUserName,$hadoopUserPW)\n\n    # Credential option 2\n    #$credential = Get-Credential -Message \"Enter the HTTP username and password:\" -UserName \"admin\"\n    \n    Grant-AzureRmHDInsightHttpServicesAccess -ClusterName $clusterName -HttpCredential $credential\n\n>[AZURE.NOTE] By granting/revoking the access, you will reset the cluster user name and password.\n\nThis can also be done via the Portal. See [Administer HDInsight by using the Azure Portal][hdinsight-admin-portal].\n\n##Update HTTP user credentials\n\nIt is the same procedure as [Grant/revoke HTTP access](#grant/revoke-access).If the cluster has been granted the HTTP access, you must first revoke it.  And then grant the access with new HTTP user credentials.\n\n\n##Find the default storage account\n\nThe following Powershell script demonstrates how to get the default storage account name and the default storage account key for a cluster.\n\n    $clusterName = \"<HDInsight Cluster Name>\"\n    \n    $cluster = Get-AzureRmHDInsightCluster -ClusterName $clusterName\n    $resourceGroupName = $cluster.ResourceGroup\n    $defaultStorageAccountName = ($cluster.DefaultStorageAccount).Replace(\".blob.core.windows.net\", \"\")\n    $defaultBlobContainerName = $cluster.DefaultStorageContainer\n    $defaultStorageAccountKey = Get-AzureRmStorageAccountKey -ResourceGroupName $resourceGroupName -Name $defaultStorageAccountName |  %{ $_.Key1 }\n    $defaultStorageAccountContext = New-AzureStorageContext -StorageAccountName $defaultStorageAccountName -StorageAccountKey $defaultStorageAccountKey \n\n##Find the resource group\n\nIn the ARM mode, each HDInsight cluster belongs to an Azure resource group.  To find the resource group:\n\n    $clusterName = \"<HDInsight Cluster Name>\"\n    \n    $cluster = Get-AzureRmHDInsightCluster -ClusterName $clusterName\n    $resourceGroupName = $cluster.ResourceGroup\n\n\n##Submit jobs\n\n**To submit MapReduce jobs**\n\nSee [Run Hadoop MapReduce samples in Windows-based HDInsight](hdinsight-run-samples.md).\n\n**To submit Hive jobs** \n\nSee [Run Hive queries using PowerShell](hdinsight-hadoop-use-hive-powershell.md).\n\n**To submit Pig jobs**\n\nSee [Run Pig jobs using PowerShell](hdinsight-hadoop-use-pig-powershell.md).\n\n**To submit Sqoop jobs**\n\nSee [Use Sqoop with HDInsight](hdinsight-use-sqoop.md).\n\n**To submit Oozie jobs**\n\nSee [Use Oozie with Hadoop to define and run a workflow in HDInsight](hdinsight-use-oozie.md).\n\n##Upload data to Azure Blob storage\nSee [Upload data to HDInsight][hdinsight-upload-data].\n\n\n## See Also\n* [HDInsight cmdlet reference documentation][hdinsight-powershell-reference]\n* [Administer HDInsight by using the Azure Portal][hdinsight-admin-portal]\n* [Administer HDInsight using a command-line interface][hdinsight-admin-cli]\n* [Create HDInsight clusters][hdinsight-provision]\n* [Upload data to HDInsight][hdinsight-upload-data]\n* [Submit Hadoop jobs programmatically][hdinsight-submit-jobs]\n* [Get started with Azure HDInsight][hdinsight-get-started]\n\n\n[azure-purchase-options]: http://azure.microsoft.com/pricing/purchase-options/\n[azure-member-offers]: http://azure.microsoft.com/pricing/member-offers/\n[azure-free-trial]: http://azure.microsoft.com/pricing/free-trial/\n\n[hdinsight-get-started]: hdinsight-hadoop-linux-tutorial-get-started.md\n[hdinsight-provision]: hdinsight-provision-clusters.md\n[hdinsight-provision-custom-options]: hdinsight-provision-clusters.md#configuration\n[hdinsight-submit-jobs]: hdinsight-submit-hadoop-jobs-programmatically.md\n\n[hdinsight-admin-cli]: hdinsight-administer-use-command-line.md\n[hdinsight-admin-portal]: hdinsight-administer-use-management-portal.md\n[hdinsight-storage]: hdinsight-hadoop-use-blob-storage.md\n[hdinsight-use-hive]: hdinsight-use-hive.md\n[hdinsight-use-mapreduce]: hdinsight-use-mapreduce.md\n[hdinsight-upload-data]: hdinsight-upload-data.md\n[hdinsight-flight]: hdinsight-analyze-flight-delay-data.md\n\n[hdinsight-powershell-reference]: https://msdn.microsoft.com/library/dn858087.aspx\n\n[powershell-install-configure]: powershell-install-configure.md\n\n[image-hdi-ps-provision]: ./media/hdinsight-administer-use-powershell/HDI.PS.Provision.png\n"
}