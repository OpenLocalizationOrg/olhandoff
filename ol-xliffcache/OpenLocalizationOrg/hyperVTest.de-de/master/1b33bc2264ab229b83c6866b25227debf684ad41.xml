{
  "nodes": [
    {
      "pos": [
        27,
        100
      ],
      "content": "Quickstart tutorial for R language for Machine Learning | Microsoft Azure"
    },
    {
      "pos": [
        119,
        263
      ],
      "content": "Use this R programming tutorial to get started quickly using the R language with Azure Machine Learning Studio to create a forecasting solution."
    },
    {
      "pos": [
        671,
        748
      ],
      "content": "Quickstart tutorial for the R programming language for Azure Machine Learning"
    },
    {
      "pos": [
        750,
        773
      ],
      "content": "Stephen F Elston, Ph.D."
    },
    {
      "pos": [
        779,
        791
      ],
      "content": "Introduction"
    },
    {
      "pos": [
        793,
        1141
      ],
      "content": "This quickstart tutorial helps you quickly start extending Azure Machine Learning by using the R programming language. Follow this R programming tutorial to create, test and execute R code within Azure Machine Learning. As you work through tutorial, you will create a complete forecasting solution by using the R language in Azure Machine Learning.",
      "nodes": [
        {
          "content": "This quickstart tutorial helps you quickly start extending Azure Machine Learning by using the R programming language.",
          "pos": [
            0,
            118
          ]
        },
        {
          "content": "Follow this R programming tutorial to create, test and execute R code within Azure Machine Learning.",
          "pos": [
            119,
            219
          ]
        },
        {
          "content": "As you work through tutorial, you will create a complete forecasting solution by using the R language in Azure Machine Learning.",
          "pos": [
            220,
            348
          ]
        }
      ]
    },
    {
      "pos": [
        1145,
        1558
      ],
      "content": "Microsoft Azure Machine Learning contains many powerful machine learning and data manipulation modules. The powerful R language has been described as the lingua franca of analytics. Happily, analytics and data manipulation in Azure Machine Learning can be extended by using R. This combination provides the scalability and ease of deployment of Azure Machine Learning with the flexibility and deep analytics of R.",
      "nodes": [
        {
          "content": "Microsoft Azure Machine Learning contains many powerful machine learning and data manipulation modules.",
          "pos": [
            0,
            103
          ]
        },
        {
          "content": "The powerful R language has been described as the lingua franca of analytics.",
          "pos": [
            104,
            181
          ]
        },
        {
          "content": "Happily, analytics and data manipulation in Azure Machine Learning can be extended by using R. This combination provides the scalability and ease of deployment of Azure Machine Learning with the flexibility and deep analytics of R.",
          "pos": [
            182,
            413
          ]
        }
      ]
    },
    {
      "pos": [
        1658,
        1685
      ],
      "content": "Forecasting and the dataset"
    },
    {
      "pos": [
        1687,
        1946
      ],
      "content": "Forecasting is a widely employed and quite useful analytical method. Common uses range from predicting sales of seasonal items, determining optimal inventory levels, to predicting macroeconomic variables. Forecasting is typically done with time series models.",
      "nodes": [
        {
          "content": "Forecasting is a widely employed and quite useful analytical method.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "Common uses range from predicting sales of seasonal items, determining optimal inventory levels, to predicting macroeconomic variables.",
          "pos": [
            69,
            204
          ]
        },
        {
          "content": "Forecasting is typically done with time series models.",
          "pos": [
            205,
            259
          ]
        }
      ]
    },
    {
      "pos": [
        1948,
        2243
      ],
      "content": "Time series data is data in which the values have a time index. The time index can be regular, e.g. every month or every minute, or irregular. A time series model is based on time series data. The R programming language contains a flexible framework and extensive analytics for time series data.",
      "nodes": [
        {
          "content": "Time series data is data in which the values have a time index.",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "The time index can be regular, e.g. every month or every minute, or irregular.",
          "pos": [
            64,
            142
          ]
        },
        {
          "content": "A time series model is based on time series data.",
          "pos": [
            143,
            192
          ]
        },
        {
          "content": "The R programming language contains a flexible framework and extensive analytics for time series data.",
          "pos": [
            193,
            295
          ]
        }
      ]
    },
    {
      "pos": [
        2245,
        2472
      ],
      "content": "In this quickstart guide we will be working with California dairy production and pricing data. This data includes monthly information on the production of several dairy products and the price of milk fat, a benchmark commodity.",
      "nodes": [
        {
          "content": "In this quickstart guide we will be working with California dairy production and pricing data.",
          "pos": [
            0,
            94
          ]
        },
        {
          "content": "This data includes monthly information on the production of several dairy products and the price of milk fat, a benchmark commodity.",
          "pos": [
            95,
            227
          ]
        }
      ]
    },
    {
      "pos": [
        2474,
        2710
      ],
      "content": "The data used in this article, along with R scripts, can be [downloaded here][download]. This data was originally synthesized from information available from the University of Wisconsin at http://future.aae.wisc.edu/tab/production.html.",
      "nodes": [
        {
          "content": "The data used in this article, along with R scripts, can be [downloaded here][download].",
          "pos": [
            0,
            88
          ]
        },
        {
          "content": "This data was originally synthesized from information available from the University of Wisconsin at http://future.aae.wisc.edu/tab/production.html.",
          "pos": [
            89,
            236
          ]
        }
      ]
    },
    {
      "pos": [
        2716,
        2728
      ],
      "content": "Organization"
    },
    {
      "pos": [
        2730,
        2895
      ],
      "content": "We will progress through several steps as you learn how to create, test and execute analytics and data manipulation R code in the Azure Machine Learning environment."
    },
    {
      "pos": [
        2901,
        3007
      ],
      "content": "First we will explore the basics of using the R language in the Azure Machine Learning Studio environment."
    },
    {
      "pos": [
        3011,
        3137
      ],
      "content": "Then we progress to discussing various aspects of I/O for data, R code and graphics in the Azure Machine Learning environment."
    },
    {
      "pos": [
        3141,
        3261
      ],
      "content": "We will then construct the first part of our forecasting solution by creating code for data cleaning and transformation."
    },
    {
      "pos": [
        3265,
        3384
      ],
      "content": "With our data prepared we will perform an analysis of the correlations between several of the variables in our dataset."
    },
    {
      "pos": [
        3388,
        3473
      ],
      "content": "Finally, we will create a seasonal time series forecasting model for milk production."
    },
    {
      "pos": [
        3475,
        3477
      ],
      "content": "##"
    },
    {
      "pos": [
        3498,
        3549
      ],
      "content": "Interact with R language in Machine Learning Studio"
    },
    {
      "pos": [
        3551,
        3832
      ],
      "content": "This section takes you through some basics of interacting with the R programming language in the Machine Learning Studio environment. The R language provides a powerful tool to create customized analytics and data manipulation modules within the Azure Machine Learning environment.",
      "nodes": [
        {
          "content": "This section takes you through some basics of interacting with the R programming language in the Machine Learning Studio environment.",
          "pos": [
            0,
            133
          ]
        },
        {
          "content": "The R language provides a powerful tool to create customized analytics and data manipulation modules within the Azure Machine Learning environment.",
          "pos": [
            134,
            281
          ]
        }
      ]
    },
    {
      "pos": [
        3834,
        4029
      ],
      "content": "I will use RStudio to develop, test and debug R code on a small scale. This code is then cut and paste into an [Execute R Script][execute-r-script] module in Machine Learning Studio ready to run.",
      "nodes": [
        {
          "content": "I will use RStudio to develop, test and debug R code on a small scale.",
          "pos": [
            0,
            70
          ]
        },
        {
          "content": "This code is then cut and paste into an [Execute R Script][execute-r-script] module in Machine Learning Studio ready to run.",
          "pos": [
            71,
            195
          ]
        }
      ]
    },
    {
      "pos": [
        4036,
        4063
      ],
      "content": "The Execute R Script module"
    },
    {
      "pos": [
        4065,
        4281
      ],
      "content": "Within Machine Learning Studio, R scripts are run within the [Execute R Script][execute-r-script] module. An example of the [Execute R Script][execute-r-script] module in Machine Learning Studio is shown in Figure 1.",
      "nodes": [
        {
          "content": "Within Machine Learning Studio, R scripts are run within the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            105
          ]
        },
        {
          "content": "An example of the [Execute R Script][execute-r-script] module in Machine Learning Studio is shown in Figure 1.",
          "pos": [
            106,
            216
          ]
        }
      ]
    },
    {
      "pos": [
        4284,
        4377
      ],
      "content": "![R programming language: The Execute R Script module selected in Machine Learning Studio][1]"
    },
    {
      "pos": [
        4379,
        4476
      ],
      "content": "<bpt id=\"p1\">*</bpt>Figure 1. The Machine Learning Studio environment showing the Execute R Script module selected.<ept id=\"p1\">*</ept>"
    },
    {
      "pos": [
        4478,
        4645
      ],
      "content": "Referring to Figure 1, let's look at some of the key parts of the Machine Learning Studio environment for working with the [Execute R Script][execute-r-script] module."
    },
    {
      "pos": [
        4649,
        4708
      ],
      "content": "The modules in the experiment are shown in the center pane."
    },
    {
      "pos": [
        4712,
        4795
      ],
      "content": "The upper part of the right pane contains a window to view and edit your R scripts."
    },
    {
      "pos": [
        4801,
        4986
      ],
      "content": "The lower part of right pane shows some properties of the [Execute R Script][execute-r-script]. You can view the error and output logs by clicking on the appropriate spots of this pane.",
      "nodes": [
        {
          "content": "The lower part of right pane shows some properties of the [Execute R Script][execute-r-script].",
          "pos": [
            0,
            95
          ]
        },
        {
          "content": "You can view the error and output logs by clicking on the appropriate spots of this pane.",
          "pos": [
            96,
            185
          ]
        }
      ]
    },
    {
      "pos": [
        4988,
        5110
      ],
      "content": "We will, of course, be discussing the [Execute R Script][execute-r-script] in greater detail in the rest of this document."
    },
    {
      "pos": [
        5112,
        5555
      ],
      "content": "When working with complex R functions, I recommend that you edit, test and debug in RStudio. As with any software development, extend your code incrementally and test it on small simple test cases. Then cut and paste your functions into the R script window of the [Execute R Script][execute-r-script] module. This approach allows you to harness both the RStudio integrated development environment (IDE) and the power of Azure Machine Learning.",
      "nodes": [
        {
          "content": "When working with complex R functions, I recommend that you edit, test and debug in RStudio.",
          "pos": [
            0,
            92
          ]
        },
        {
          "content": "As with any software development, extend your code incrementally and test it on small simple test cases.",
          "pos": [
            93,
            197
          ]
        },
        {
          "content": "Then cut and paste your functions into the R script window of the [Execute R Script][execute-r-script] module.",
          "pos": [
            198,
            308
          ]
        },
        {
          "content": "This approach allows you to harness both the RStudio integrated development environment (IDE) and the power of Azure Machine Learning.",
          "pos": [
            309,
            443
          ]
        }
      ]
    },
    {
      "pos": [
        5563,
        5577
      ],
      "content": "Execute R code"
    },
    {
      "pos": [
        5579,
        5821
      ],
      "content": "Any R code in the [Execute R Script][execute-r-script] module will execute when you run the experiment by clicking on the <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept><ph id=\"ph3\"/> button. When execution has completed, a check mark will appear on the [Execute R Script][execute-r-script] icon.",
      "nodes": [
        {
          "content": "Any R code in the [Execute R Script][execute-r-script] module will execute when you run the experiment by clicking on the <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept><ph id=\"ph3\"/> button.",
          "pos": [
            0,
            189
          ]
        },
        {
          "content": "When execution has completed, a check mark will appear on the [Execute R Script][execute-r-script] icon.",
          "pos": [
            190,
            294
          ]
        }
      ]
    },
    {
      "pos": [
        5827,
        5872
      ],
      "content": "Defensive R coding for Azure Machine Learning"
    },
    {
      "pos": [
        5874,
        6296
      ],
      "content": "If you are developing R code for, say, a web service by using Azure Machine Learning, you should definitely plan how your code will deal with an unexpected data input and exceptions. To maintain clarity, I have not included much in the way of checking or exception handling in most of the code examples shown. However, as we proceed I will give you several examples of functions by using R's exception handling capability.",
      "nodes": [
        {
          "content": "If you are developing R code for, say, a web service by using Azure Machine Learning, you should definitely plan how your code will deal with an unexpected data input and exceptions.",
          "pos": [
            0,
            182
          ]
        },
        {
          "content": "To maintain clarity, I have not included much in the way of checking or exception handling in most of the code examples shown.",
          "pos": [
            183,
            309
          ]
        },
        {
          "content": "However, as we proceed I will give you several examples of functions by using R's exception handling capability.",
          "pos": [
            310,
            422
          ]
        }
      ]
    },
    {
      "pos": [
        6300,
        6484
      ],
      "content": "If you need a more complete treatment of R exception handling, I recommend you read the applicable sections of the book by Wickham listed in <bpt id=\"p3\">[</bpt>Appendix B - Further Reading<ept id=\"p3\">](#appendixb)</ept>."
    },
    {
      "pos": [
        6491,
        6534
      ],
      "content": "Debug and test R in Machine Learning Studio"
    },
    {
      "pos": [
        6536,
        6831
      ],
      "content": "To reiterate, I recommend you test and debug your R code on a small scale in RStudio. However, there are cases where you will need to track down R code problems in the [Execute R Script][execute-r-script] itself. In addition, it is good practice to check your results in Machine Learning Studio.",
      "nodes": [
        {
          "content": "To reiterate, I recommend you test and debug your R code on a small scale in RStudio.",
          "pos": [
            0,
            85
          ]
        },
        {
          "content": "However, there are cases where you will need to track down R code problems in the [Execute R Script][execute-r-script] itself.",
          "pos": [
            86,
            212
          ]
        },
        {
          "content": "In addition, it is good practice to check your results in Machine Learning Studio.",
          "pos": [
            213,
            295
          ]
        }
      ]
    },
    {
      "pos": [
        6833,
        7005
      ],
      "content": "Output from the execution of your R code and on the Azure Machine Learning platform is found primarily in output.log. Some additional information will be seen in error.log.",
      "nodes": [
        {
          "content": "Output from the execution of your R code and on the Azure Machine Learning platform is found primarily in output.log.",
          "pos": [
            0,
            117
          ]
        },
        {
          "content": "Some additional information will be seen in error.log.",
          "pos": [
            118,
            172
          ]
        }
      ]
    },
    {
      "pos": [
        7009,
        7373
      ],
      "content": "If an error occurs in Machine Learning Studio while running your R code, your first course of action should be to look at error.log. This file can contain useful error messages to help you understand and correct your error. To view error.log, click on <bpt id=\"p4\">**</bpt>View error log<ept id=\"p4\">**</ept><ph id=\"ph4\"/> on the <bpt id=\"p5\">**</bpt>properties pane<ept id=\"p5\">**</ept><ph id=\"ph5\"/> for the [Execute R Script][execute-r-script] containing the error.",
      "nodes": [
        {
          "content": "If an error occurs in Machine Learning Studio while running your R code, your first course of action should be to look at error.log.",
          "pos": [
            0,
            132
          ]
        },
        {
          "content": "This file can contain useful error messages to help you understand and correct your error.",
          "pos": [
            133,
            223
          ]
        },
        {
          "content": "To view error.log, click on <bpt id=\"p4\">**</bpt>View error log<ept id=\"p4\">**</ept><ph id=\"ph4\"/> on the <bpt id=\"p5\">**</bpt>properties pane<ept id=\"p5\">**</ept><ph id=\"ph5\"/> for the [Execute R Script][execute-r-script] containing the error.",
          "pos": [
            224,
            468
          ]
        }
      ]
    },
    {
      "pos": [
        7375,
        7496
      ],
      "content": "For example, I ran the following R code, with an undefined variable y, in an [Execute R Script][execute-r-script] module:"
    },
    {
      "pos": [
        7527,
        7685
      ],
      "content": "This code fails to execute, resulting in an error condition. Clicking on <bpt id=\"p6\">**</bpt>View error log<ept id=\"p6\">**</ept><ph id=\"ph6\"/> on the <bpt id=\"p7\">**</bpt>properties pane<ept id=\"p7\">**</ept><ph id=\"ph7\"/> produces the display shown in Figure 2.",
      "nodes": [
        {
          "content": "This code fails to execute, resulting in an error condition.",
          "pos": [
            0,
            60
          ]
        },
        {
          "content": "Clicking on <bpt id=\"p6\">**</bpt>View error log<ept id=\"p6\">**</ept><ph id=\"ph6\"/> on the <bpt id=\"p7\">**</bpt>properties pane<ept id=\"p7\">**</ept><ph id=\"ph7\"/> produces the display shown in Figure 2.",
          "pos": [
            61,
            262
          ]
        }
      ]
    },
    {
      "pos": [
        7689,
        7715
      ],
      "content": "![Error message pop up][2]"
    },
    {
      "pos": [
        7717,
        7750
      ],
      "content": "<bpt id=\"p8\">*</bpt>Figure 2. Error message pop-up.<ept id=\"p8\">*</ept>"
    },
    {
      "pos": [
        7752,
        8014
      ],
      "content": "It looks like we need to look in output.log to see the R error message. Click on the [Execute R Script][execute-r-script] and then click on the <bpt id=\"p9\">**</bpt>View output.log<ept id=\"p9\">**</ept><ph id=\"ph8\"/> item on the <bpt id=\"p10\">**</bpt>properties pane<ept id=\"p10\">**</ept><ph id=\"ph9\"/> to the right. A new browser window opens, and I see the following.",
      "nodes": [
        {
          "content": "It looks like we need to look in output.log to see the R error message.",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "Click on the [Execute R Script][execute-r-script] and then click on the <bpt id=\"p9\">**</bpt>View output.log<ept id=\"p9\">**</ept><ph id=\"ph8\"/> item on the <bpt id=\"p10\">**</bpt>properties pane<ept id=\"p10\">**</ept><ph id=\"ph9\"/> to the right.",
          "pos": [
            72,
            315
          ]
        },
        {
          "content": "A new browser window opens, and I see the following.",
          "pos": [
            316,
            368
          ]
        }
      ]
    },
    {
      "pos": [
        8288,
        8364
      ],
      "content": "This error message contains no surprises and clearly identifies the problem."
    },
    {
      "pos": [
        8366,
        8668
      ],
      "content": "To inspect the value of any object in R, you can print these values to the output.log file. The rules for examining object values are essentially the same as in an interactive R session. For example, if you type a variable name on a line, the value of the object will be printed to the output.log file.",
      "nodes": [
        {
          "content": "To inspect the value of any object in R, you can print these values to the output.log file.",
          "pos": [
            0,
            91
          ]
        },
        {
          "content": "The rules for examining object values are essentially the same as in an interactive R session.",
          "pos": [
            92,
            186
          ]
        },
        {
          "content": "For example, if you type a variable name on a line, the value of the object will be printed to the output.log file.",
          "pos": [
            187,
            302
          ]
        }
      ]
    },
    {
      "pos": [
        8676,
        8711
      ],
      "content": "Packages in Machine Learning Studio"
    },
    {
      "pos": [
        8713,
        8920
      ],
      "content": "Azure Machine Learning comes with over 350 preinstalled R language packages. You can use the following code in the [Execute R Script][execute-r-script] module to retrieve a list of the preinstalled packages.",
      "nodes": [
        {
          "content": "Azure Machine Learning comes with over 350 preinstalled R language packages.",
          "pos": [
            0,
            76
          ]
        },
        {
          "content": "You can use the following code in the [Execute R Script][execute-r-script] module to retrieve a list of the preinstalled packages.",
          "pos": [
            77,
            207
          ]
        }
      ]
    },
    {
      "pos": [
        9007,
        9189
      ],
      "content": "If you don't understand the last line of this code at the moment, read on. In the rest of this document we will extensively discuss using R in the Azure Machine Learning environment.",
      "nodes": [
        {
          "content": "If you don't understand the last line of this code at the moment, read on.",
          "pos": [
            0,
            74
          ]
        },
        {
          "content": "In the rest of this document we will extensively discuss using R in the Azure Machine Learning environment.",
          "pos": [
            75,
            182
          ]
        }
      ]
    },
    {
      "pos": [
        9195,
        9218
      ],
      "content": "Introduction to RStudio"
    },
    {
      "pos": [
        9220,
        9518
      ],
      "content": "RStudio is a widely used IDE for R. I will use RStudio for editing, testing and debugging some of the R code used in this quick start guide. Once R code is tested and ready, you simply cut and paste from the RStudio editor into a Machine Learning Studio [Execute R Script][execute-r-script] module.",
      "nodes": [
        {
          "content": "RStudio is a widely used IDE for R. I will use RStudio for editing, testing and debugging some of the R code used in this quick start guide.",
          "pos": [
            0,
            140
          ]
        },
        {
          "content": "Once R code is tested and ready, you simply cut and paste from the RStudio editor into a Machine Learning Studio [Execute R Script][execute-r-script] module.",
          "pos": [
            141,
            298
          ]
        }
      ]
    },
    {
      "pos": [
        9522,
        10003
      ],
      "content": "If you do not have the R programming language installed on your desktop machine, I recommend you do so now. Free downloads of open source R language are available at the Comprehensive R Archive Network (CRAN) at <bpt id=\"p11\">[</bpt>http://www.r-project.org/<ept id=\"p11\">](http://www.r-project.org/)</ept>. There are downloads available for Windows, Mac OS, and Linux/UNIX. Choose a nearby mirror and follow the download directions. In addition, CRAN contains a wealth of useful analytics and data manipulation packages.",
      "nodes": [
        {
          "content": "If you do not have the R programming language installed on your desktop machine, I recommend you do so now.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "Free downloads of open source R language are available at the Comprehensive R Archive Network (CRAN) at <bpt id=\"p11\">[</bpt>http://www.r-project.org/<ept id=\"p11\">](http://www.r-project.org/)</ept>.",
          "pos": [
            108,
            307
          ]
        },
        {
          "content": "There are downloads available for Windows, Mac OS, and Linux/UNIX.",
          "pos": [
            308,
            374
          ]
        },
        {
          "content": "Choose a nearby mirror and follow the download directions.",
          "pos": [
            375,
            433
          ]
        },
        {
          "content": "In addition, CRAN contains a wealth of useful analytics and data manipulation packages.",
          "pos": [
            434,
            521
          ]
        }
      ]
    },
    {
      "pos": [
        10005,
        10275
      ],
      "content": "If you are new to RStudio, you should download and install the desktop version. You can find the RStudio downloads for Windows, Mac OS, and Linux/UNIX at http://www.rstudio.com/products/RStudio/. Follow the directions provided to install RStudio on your desktop machine.",
      "nodes": [
        {
          "content": "If you are new to RStudio, you should download and install the desktop version.",
          "pos": [
            0,
            79
          ]
        },
        {
          "content": "You can find the RStudio downloads for Windows, Mac OS, and Linux/UNIX at http://www.rstudio.com/products/RStudio/.",
          "pos": [
            80,
            195
          ]
        },
        {
          "content": "Follow the directions provided to install RStudio on your desktop machine.",
          "pos": [
            196,
            270
          ]
        }
      ]
    },
    {
      "pos": [
        10279,
        10394
      ],
      "content": "A tutorial introduction to RStudio is available at https://support.rstudio.com/hc/sections/200107586-Using-RStudio."
    },
    {
      "pos": [
        10396,
        10478
      ],
      "content": "I provide some additional information on using RStudio in [Appendix A][appendixa]."
    },
    {
      "pos": [
        10482,
        10484
      ],
      "content": "##"
    },
    {
      "pos": [
        10509,
        10559
      ],
      "content": "Get data in and out of the Execute R Script module"
    },
    {
      "pos": [
        10561,
        10792
      ],
      "content": "In this section we will discuss how you get data into and out of the [Execute R Script][execute-r-script] module. We will review how to handle various data types read into and out of the [Execute R Script][execute-r-script] module.",
      "nodes": [
        {
          "content": "In this section we will discuss how you get data into and out of the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            113
          ]
        },
        {
          "content": "We will review how to handle various data types read into and out of the [Execute R Script][execute-r-script] module.",
          "pos": [
            114,
            231
          ]
        }
      ]
    },
    {
      "pos": [
        10794,
        10871
      ],
      "content": "The complete code for this section is in the zip file you downloaded earlier."
    },
    {
      "pos": [
        10876,
        10922
      ],
      "content": "Load and check data in Machine Learning Studio"
    },
    {
      "pos": [
        10924,
        10928
      ],
      "content": "####"
    },
    {
      "pos": [
        10948,
        10964
      ],
      "content": "Load the dataset"
    },
    {
      "pos": [
        10966,
        11055
      ],
      "content": "We will start by loading the <bpt id=\"p12\">**</bpt>csdairydata.csv<ept id=\"p12\">**</ept><ph id=\"ph10\"/> file into Azure Machine Learning Studio."
    },
    {
      "pos": [
        11059,
        11112
      ],
      "content": "Start your Azure Machine Learning Studio environment."
    },
    {
      "pos": [
        11116,
        11191
      ],
      "content": "Click on <bpt id=\"p13\">__</bpt>+ NEW<ept id=\"p13\">__</ept><ph id=\"ph11\"/> at the lower left of your screen and select <bpt id=\"p14\">**</bpt>Dataset<ept id=\"p14\">**</ept>."
    },
    {
      "pos": [
        11195,
        11262
      ],
      "content": "Select <bpt id=\"p15\">**</bpt>From Local File<ept id=\"p15\">**</ept>, and then <bpt id=\"p16\">**</bpt>Browse<ept id=\"p16\">**</ept><ph id=\"ph12\"/> to select the file."
    },
    {
      "pos": [
        11266,
        11362
      ],
      "content": "Make sure you have selected <bpt id=\"p17\">**</bpt>Generic CSV file with header (.csv)<ept id=\"p17\">**</ept><ph id=\"ph13\"/> as the type for the dataset."
    },
    {
      "pos": [
        11366,
        11387
      ],
      "content": "Click the check mark."
    },
    {
      "pos": [
        11391,
        11495
      ],
      "content": "After the dataset has been uploaded, you should see the new dataset by clicking on the <bpt id=\"p18\">**</bpt>Datasets<ept id=\"p18\">**</ept><ph id=\"ph14\"/> tab."
    },
    {
      "pos": [
        11503,
        11523
      ],
      "content": "Create an experiment"
    },
    {
      "pos": [
        11525,
        11631
      ],
      "content": "Now that we have some data in Machine Learning Studio, we need to create an experiment to do the analysis."
    },
    {
      "pos": [
        11637,
        11727
      ],
      "content": "Click on <bpt id=\"p19\">__</bpt>+ NEW<ept id=\"p19\">__</ept><ph id=\"ph15\"/> at the lower left and select <bpt id=\"p20\">**</bpt>Experiment<ept id=\"p20\">**</ept>, then <bpt id=\"p21\">**</bpt>Blank Experiment<ept id=\"p21\">**</ept>."
    },
    {
      "pos": [
        11731,
        11903
      ],
      "content": "You can name your experiment by selecting, and modifying, the <bpt id=\"p22\">**</bpt>Experiment created on ...<ept id=\"p22\">**</ept><ph id=\"ph16\"/> title at the top of the page. For example, changing it to <bpt id=\"p23\">**</bpt>CA Dairy Analysis<ept id=\"p23\">**</ept>.",
      "nodes": [
        {
          "content": "You can name your experiment by selecting, and modifying, the <bpt id=\"p22\">**</bpt>Experiment created on ...<ept id=\"p22\">**</ept><ph id=\"ph16\"/> title at the top of the page.",
          "pos": [
            0,
            176
          ]
        },
        {
          "content": "For example, changing it to <bpt id=\"p23\">**</bpt>CA Dairy Analysis<ept id=\"p23\">**</ept>.",
          "pos": [
            177,
            267
          ]
        }
      ]
    },
    {
      "pos": [
        11907,
        12061
      ],
      "content": "On the left of the experiment page, expand <bpt id=\"p24\">**</bpt>Saved Datasets<ept id=\"p24\">**</ept>, and then <bpt id=\"p25\">**</bpt>My Datasets<ept id=\"p25\">**</ept>. You should see the <bpt id=\"p26\">**</bpt>cadairydata.csv<ept id=\"p26\">**</ept><ph id=\"ph17\"/> that you uploaded earlier.",
      "nodes": [
        {
          "content": "On the left of the experiment page, expand <bpt id=\"p24\">**</bpt>Saved Datasets<ept id=\"p24\">**</ept>, and then <bpt id=\"p25\">**</bpt>My Datasets<ept id=\"p25\">**</ept>.",
          "pos": [
            0,
            168
          ]
        },
        {
          "content": "You should see the <bpt id=\"p26\">**</bpt>cadairydata.csv<ept id=\"p26\">**</ept><ph id=\"ph17\"/> that you uploaded earlier.",
          "pos": [
            169,
            289
          ]
        }
      ]
    },
    {
      "pos": [
        12065,
        12131
      ],
      "content": "Drag and drop the <bpt id=\"p27\">**</bpt>csdairydata.csv dataset<ept id=\"p27\">**</ept><ph id=\"ph18\"/> onto the experiment."
    },
    {
      "pos": [
        12135,
        12296
      ],
      "content": "In the <bpt id=\"p28\">**</bpt>Search experiment items<ept id=\"p28\">**</ept><ph id=\"ph19\"/> box on the top of the left pane, type [Execute R Script][execute-r-script]. You will see the module appear in the search list.",
      "nodes": [
        {
          "content": "In the <bpt id=\"p28\">**</bpt>Search experiment items<ept id=\"p28\">**</ept><ph id=\"ph19\"/> box on the top of the left pane, type [Execute R Script][execute-r-script].",
          "pos": [
            0,
            165
          ]
        },
        {
          "content": "You will see the module appear in the search list.",
          "pos": [
            166,
            216
          ]
        }
      ]
    },
    {
      "pos": [
        12300,
        12379
      ],
      "content": "Drag and drop the [Execute R Script][execute-r-script] module onto your pallet."
    },
    {
      "pos": [
        12385,
        12520
      ],
      "content": "Connect the output of the <bpt id=\"p29\">**</bpt>csdairydata.csv dataset<ept id=\"p29\">**</ept><ph id=\"ph20\"/> to the leftmost input (<bpt id=\"p30\">**</bpt>Dataset1<ept id=\"p30\">**</ept>) of the [Execute R Script][execute-r-script]."
    },
    {
      "pos": [
        12524,
        12560
      ],
      "content": "<bpt id=\"p31\">**</bpt>Don't forget to click on 'Save'!<ept id=\"p31\">**</ept>"
    },
    {
      "pos": [
        12564,
        12630
      ],
      "content": "At this point your experiment should look something like Figure 3."
    },
    {
      "pos": [
        12632,
        12711
      ],
      "content": "![The CA Dairy Analysis experiment with dataset and Execute R Script module][3]"
    },
    {
      "pos": [
        12713,
        12799
      ],
      "content": "<bpt id=\"p32\">*</bpt>Figure 3. The CA Dairy Analysis experiment with dataset and Execute R Script module.<ept id=\"p32\">*</ept>"
    },
    {
      "pos": [
        12805,
        12822
      ],
      "content": "Check on the data"
    },
    {
      "pos": [
        12824,
        13029
      ],
      "content": "Let's have a look at the data we have loaded into our experiment. In the experiment, click on the output of the <bpt id=\"p33\">**</bpt>cadairydata.csv dataset<ept id=\"p33\">**</ept><ph id=\"ph21\"/> and select <bpt id=\"p34\">**</bpt>visualize<ept id=\"p34\">**</ept>. You should see something like Figure 4.",
      "nodes": [
        {
          "content": "Let's have a look at the data we have loaded into our experiment.",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "In the experiment, click on the output of the <bpt id=\"p33\">**</bpt>cadairydata.csv dataset<ept id=\"p33\">**</ept><ph id=\"ph21\"/> and select <bpt id=\"p34\">**</bpt>visualize<ept id=\"p34\">**</ept>.",
          "pos": [
            66,
            260
          ]
        },
        {
          "content": "You should see something like Figure 4.",
          "pos": [
            261,
            300
          ]
        }
      ]
    },
    {
      "pos": [
        13033,
        13077
      ],
      "content": "![Summary of the cadairydata.csv dataset][4]"
    },
    {
      "pos": [
        13079,
        13130
      ],
      "content": "<bpt id=\"p35\">*</bpt>Figure 4. Summary of the cadairydata.csv dataset.<ept id=\"p35\">*</ept>"
    },
    {
      "pos": [
        13132,
        13524
      ],
      "content": "In this view we see a lot of useful information. We can see the first several rows of that dataset. If we select a column, the Statistics section shows more information about the column. For example, the Feature Type row shows us what data types Azure Machine Learning Studio assigned to the column. Having a quick look like this is a good sanity check before we start to do any serious work.",
      "nodes": [
        {
          "content": "In this view we see a lot of useful information.",
          "pos": [
            0,
            48
          ]
        },
        {
          "content": "We can see the first several rows of that dataset.",
          "pos": [
            49,
            99
          ]
        },
        {
          "content": "If we select a column, the Statistics section shows more information about the column.",
          "pos": [
            100,
            186
          ]
        },
        {
          "content": "For example, the Feature Type row shows us what data types Azure Machine Learning Studio assigned to the column.",
          "pos": [
            187,
            299
          ]
        },
        {
          "content": "Having a quick look like this is a good sanity check before we start to do any serious work.",
          "pos": [
            300,
            392
          ]
        }
      ]
    },
    {
      "pos": [
        13530,
        13544
      ],
      "content": "First R script"
    },
    {
      "pos": [
        13546,
        13694
      ],
      "content": "Let's create a simple first R script to experiment with in Azure Machine Learning Studio. I have created and tested the following script in RStudio.",
      "nodes": [
        {
          "content": "Let's create a simple first R script to experiment with in Azure Machine Learning Studio.",
          "pos": [
            0,
            89
          ]
        },
        {
          "content": "I have created and tested the following script in RStudio.",
          "pos": [
            90,
            148
          ]
        }
      ]
    },
    {
      "pos": [
        14294,
        14459
      ],
      "content": "Now I need to transfer this script to Azure Machine Learning Studio. I could simply cut and paste. However, in this case, I will transfer my R script via a zip file.",
      "nodes": [
        {
          "content": "Now I need to transfer this script to Azure Machine Learning Studio.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "I could simply cut and paste.",
          "pos": [
            69,
            98
          ]
        },
        {
          "content": "However, in this case, I will transfer my R script via a zip file.",
          "pos": [
            99,
            165
          ]
        }
      ]
    },
    {
      "pos": [
        14465,
        14506
      ],
      "content": "Data input to the Execute R Script module"
    },
    {
      "pos": [
        14508,
        14700
      ],
      "content": "Let's have a look at the inputs to the [Execute R Script][execute-r-script] module. In this example we will read the California dairy data into the [Execute R Script][execute-r-script] module.",
      "nodes": [
        {
          "content": "Let's have a look at the inputs to the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            83
          ]
        },
        {
          "content": "In this example we will read the California dairy data into the [Execute R Script][execute-r-script] module.",
          "pos": [
            84,
            192
          ]
        }
      ]
    },
    {
      "pos": [
        14704,
        14942
      ],
      "content": "There are three possible inputs for the [Execute R Script][execute-r-script] module. You may use any one or all of these inputs, depending on your application. It is also perfectly reasonable to use an R script that takes no input at all.",
      "nodes": [
        {
          "content": "There are three possible inputs for the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            84
          ]
        },
        {
          "content": "You may use any one or all of these inputs, depending on your application.",
          "pos": [
            85,
            159
          ]
        },
        {
          "content": "It is also perfectly reasonable to use an R script that takes no input at all.",
          "pos": [
            160,
            238
          ]
        }
      ]
    },
    {
      "pos": [
        14946,
        15114
      ],
      "content": "Let's look at each of these inputs, going from left to right. You can see the names of each of the inputs by placing your cursor over the input and reading the tooltip.",
      "nodes": [
        {
          "content": "Let's look at each of these inputs, going from left to right.",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "You can see the names of each of the inputs by placing your cursor over the input and reading the tooltip.",
          "pos": [
            62,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        15123,
        15136
      ],
      "content": "Script Bundle"
    },
    {
      "pos": [
        15138,
        15354
      ],
      "content": "The Script Bundle input allows you to pass the contents of a zip file into [Execute R Script][execute-r-script] module. You can use one of the following commands to read the contents of the zip file into your R code.",
      "nodes": [
        {
          "content": "The Script Bundle input allows you to pass the contents of a zip file into [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            119
          ]
        },
        {
          "content": "You can use one of the following commands to read the contents of the zip file into your R code.",
          "pos": [
            120,
            216
          ]
        }
      ]
    },
    {
      "pos": [
        15474,
        15837
      ],
      "content": "<ph id=\"ph22\">[AZURE.NOTE]</ph><ph id=\"ph23\"/> Azure Machine Learning treats files in the zip as if they are in the src/ directory, so you need to prefix your file names with this directory name. For example, if the zip contains the files <ph id=\"ph24\">`yourfile.R`</ph><ph id=\"ph25\"/> and <ph id=\"ph26\">`yourData.rdata`</ph><ph id=\"ph27\"/> in the root of the zip, you would address these as <ph id=\"ph28\">`src/yourfile.R`</ph><ph id=\"ph29\"/> and <ph id=\"ph30\">`src/yourData.rdata`</ph><ph id=\"ph31\"/> when using <ph id=\"ph32\">`source`</ph><ph id=\"ph33\"/> and <ph id=\"ph34\">`load`</ph>.",
      "nodes": [
        {
          "content": "<ph id=\"ph22\">[AZURE.NOTE]</ph><ph id=\"ph23\"/> Azure Machine Learning treats files in the zip as if they are in the src/ directory, so you need to prefix your file names with this directory name.",
          "pos": [
            0,
            195
          ]
        },
        {
          "content": "For example, if the zip contains the files <ph id=\"ph24\">`yourfile.R`</ph><ph id=\"ph25\"/> and <ph id=\"ph26\">`yourData.rdata`</ph><ph id=\"ph27\"/> in the root of the zip, you would address these as <ph id=\"ph28\">`src/yourfile.R`</ph><ph id=\"ph29\"/> and <ph id=\"ph30\">`src/yourData.rdata`</ph><ph id=\"ph31\"/> when using <ph id=\"ph32\">`source`</ph><ph id=\"ph33\"/> and <ph id=\"ph34\">`load`</ph>.",
          "pos": [
            196,
            586
          ]
        }
      ]
    },
    {
      "pos": [
        15839,
        16007
      ],
      "content": "We already discussed loading datasets in <bpt id=\"p36\">[</bpt>Loading the dataset<ept id=\"p36\">](#loading)</ept>. Once you have created and tested the R script shown in the previous section, do the following:",
      "nodes": [
        {
          "content": "We already discussed loading datasets in <bpt id=\"p36\">[</bpt>Loading the dataset<ept id=\"p36\">](#loading)</ept>.",
          "pos": [
            0,
            113
          ]
        },
        {
          "content": "Once you have created and tested the R script shown in the previous section, do the following:",
          "pos": [
            114,
            208
          ]
        }
      ]
    },
    {
      "pos": [
        16012,
        16104
      ],
      "content": "Save the R script into a .R file. I call my script file \"simpleplot.R\". Here's the contents.",
      "nodes": [
        {
          "content": "Save the R script into a .R file.",
          "pos": [
            0,
            33
          ]
        },
        {
          "content": "I call my script file \"simpleplot.R\".",
          "pos": [
            34,
            71
          ]
        },
        {
          "content": "Here's the contents.",
          "pos": [
            72,
            92
          ]
        }
      ]
    },
    {
      "pos": [
        16746,
        16972
      ],
      "content": "Create a zip file and copy your script into this zip file. On Windows, you can right-click on the file and select <bpt id=\"p37\">__</bpt>Send to<ept id=\"p37\">__</ept>, and then <bpt id=\"p38\">__</bpt>Compressed folder<ept id=\"p38\">__</ept>. This will create a new zip file containing the \"simpleplot.R\" file.",
      "nodes": [
        {
          "content": "Create a zip file and copy your script into this zip file.",
          "pos": [
            0,
            58
          ]
        },
        {
          "content": "On Windows, you can right-click on the file and select <bpt id=\"p37\">__</bpt>Send to<ept id=\"p37\">__</ept>, and then <bpt id=\"p38\">__</bpt>Compressed folder<ept id=\"p38\">__</ept>.",
          "pos": [
            59,
            238
          ]
        },
        {
          "content": "This will create a new zip file containing the \"simpleplot.R\" file.",
          "pos": [
            239,
            306
          ]
        }
      ]
    },
    {
      "pos": [
        16978,
        17121
      ],
      "content": "Add your file to the <bpt id=\"p39\">**</bpt>datasets<ept id=\"p39\">**</ept><ph id=\"ph35\"/> in Machine Learning Studio, specifying the type as <bpt id=\"p40\">**</bpt>zip<ept id=\"p40\">**</ept>. You should now see the zip file in your datasets.",
      "nodes": [
        {
          "content": "Add your file to the <bpt id=\"p39\">**</bpt>datasets<ept id=\"p39\">**</ept><ph id=\"ph35\"/> in Machine Learning Studio, specifying the type as <bpt id=\"p40\">**</bpt>zip<ept id=\"p40\">**</ept>.",
          "pos": [
            0,
            188
          ]
        },
        {
          "content": "You should now see the zip file in your datasets.",
          "pos": [
            189,
            238
          ]
        }
      ]
    },
    {
      "pos": [
        17127,
        17202
      ],
      "content": "Drag and drop the zip file from <bpt id=\"p41\">**</bpt>datasets<ept id=\"p41\">**</ept><ph id=\"ph36\"/> onto the <bpt id=\"p42\">**</bpt>ML Studio canvas<ept id=\"p42\">**</ept>."
    },
    {
      "pos": [
        17208,
        17334
      ],
      "content": "Connect the output of the <bpt id=\"p43\">**</bpt>zip data<ept id=\"p43\">**</ept><ph id=\"ph37\"/> icon to the <bpt id=\"p44\">**</bpt>Script Bundle<ept id=\"p44\">**</ept><ph id=\"ph38\"/> input of the [Execute R Script][execute-r-script] module."
    },
    {
      "pos": [
        17340,
        17515
      ],
      "content": "Type the <ph id=\"ph39\">`source()`</ph><ph id=\"ph40\"/> function with your zip file name into the code window for the [Execute R Script][execute-r-script] module. In my case I typed <ph id=\"ph41\">`source(\"src/simpleplot.R\")`</ph>.",
      "nodes": [
        {
          "content": "Type the <ph id=\"ph39\">`source()`</ph><ph id=\"ph40\"/> function with your zip file name into the code window for the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            160
          ]
        },
        {
          "content": "In my case I typed <ph id=\"ph41\">`source(\"src/simpleplot.R\")`</ph>.",
          "pos": [
            161,
            228
          ]
        }
      ]
    },
    {
      "pos": [
        17523,
        17552
      ],
      "content": "Make sure you click <bpt id=\"p45\">**</bpt>Save<ept id=\"p45\">**</ept>."
    },
    {
      "pos": [
        17554,
        17769
      ],
      "content": "Once these steps are complete, the [Execute R Script][execute-r-script] module will execute the R script in the zip file when the experiment is run. At this point your experiment should look something like Figure 5.",
      "nodes": [
        {
          "content": "Once these steps are complete, the [Execute R Script][execute-r-script] module will execute the R script in the zip file when the experiment is run.",
          "pos": [
            0,
            148
          ]
        },
        {
          "content": "At this point your experiment should look something like Figure 5.",
          "pos": [
            149,
            215
          ]
        }
      ]
    },
    {
      "pos": [
        17771,
        17809
      ],
      "content": "![Experiment using zipped R script][6]"
    },
    {
      "pos": [
        17811,
        17856
      ],
      "content": "<bpt id=\"p46\">*</bpt>Figure 5. Experiment using zipped R script.<ept id=\"p46\">*</ept>"
    },
    {
      "pos": [
        17863,
        17871
      ],
      "content": "Dataset1"
    },
    {
      "pos": [
        17873,
        18181
      ],
      "content": "You can pass a rectangular table of data to your R code by using the Dataset1 input. In our simple script the <ph id=\"ph42\">`maml.mapInputPort(1)`</ph><ph id=\"ph43\"/> function reads the data from port 1. This data is then assigned to a dataframe variable name in your code. In our simple script the first line of code performs the assignment.",
      "nodes": [
        {
          "content": "You can pass a rectangular table of data to your R code by using the Dataset1 input.",
          "pos": [
            0,
            84
          ]
        },
        {
          "content": "In our simple script the <ph id=\"ph42\">`maml.mapInputPort(1)`</ph><ph id=\"ph43\"/> function reads the data from port 1.",
          "pos": [
            85,
            203
          ]
        },
        {
          "content": "This data is then assigned to a dataframe variable name in your code.",
          "pos": [
            204,
            273
          ]
        },
        {
          "content": "In our simple script the first line of code performs the assignment.",
          "pos": [
            274,
            342
          ]
        }
      ]
    },
    {
      "pos": [
        18224,
        18579
      ],
      "content": "Execute your experiment by clicking on the <bpt id=\"p47\">**</bpt>Run<ept id=\"p47\">**</ept><ph id=\"ph44\"/> button. When the execution finishes, click on the [Execute R Script][execute-r-script] module and then click <bpt id=\"p48\">**</bpt>View output log<ept id=\"p48\">**</ept><ph id=\"ph45\"/> on the properties pane. A new page should appear in your browser showing the contents of the output.log file. When you scroll down you should see something like the following.",
      "nodes": [
        {
          "content": "Execute your experiment by clicking on the <bpt id=\"p47\">**</bpt>Run<ept id=\"p47\">**</ept><ph id=\"ph44\"/> button.",
          "pos": [
            0,
            113
          ]
        },
        {
          "content": "When the execution finishes, click on the [Execute R Script][execute-r-script] module and then click <bpt id=\"p48\">**</bpt>View output log<ept id=\"p48\">**</ept><ph id=\"ph45\"/> on the properties pane.",
          "pos": [
            114,
            313
          ]
        },
        {
          "content": "A new page should appear in your browser showing the contents of the output.log file.",
          "pos": [
            314,
            399
          ]
        },
        {
          "content": "When you scroll down you should see something like the following.",
          "pos": [
            400,
            465
          ]
        }
      ]
    },
    {
      "pos": [
        18863,
        18975
      ],
      "content": "Farther down the page is more detailed information on the columns, which will look something like the following."
    },
    {
      "pos": [
        19976,
        20141
      ],
      "content": "These results are mostly as expected, with 228 observations and 9 columns in the dataframe. We can see the column names, the R data type and a sample of each column.",
      "nodes": [
        {
          "content": "These results are mostly as expected, with 228 observations and 9 columns in the dataframe.",
          "pos": [
            0,
            91
          ]
        },
        {
          "content": "We can see the column names, the R data type and a sample of each column.",
          "pos": [
            92,
            165
          ]
        }
      ]
    },
    {
      "pos": [
        20145,
        20385
      ],
      "content": "<ph id=\"ph46\">[AZURE.NOTE]</ph><ph id=\"ph47\"/> This same printed output is conveniently available from the R Device output of the [Execute R Script][execute-r-script] module. We will discuss the outputs of the [Execute R Script][execute-r-script] module in the next section.",
      "nodes": [
        {
          "content": "<ph id=\"ph46\">[AZURE.NOTE]</ph><ph id=\"ph47\"/> This same printed output is conveniently available from the R Device output of the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            174
          ]
        },
        {
          "content": "We will discuss the outputs of the [Execute R Script][execute-r-script] module in the next section.",
          "pos": [
            175,
            274
          ]
        }
      ]
    },
    {
      "pos": [
        20393,
        20401
      ],
      "content": "Dataset2"
    },
    {
      "pos": [
        20403,
        20639
      ],
      "content": "The behavior of the Dataset2 input is identical to that of Dataset1. Using this input you can pass a second rectangular table of data into your R code. The function <ph id=\"ph48\">`maml.mapInputPort(2)`</ph>, with the argument 2, is used to pass this data.",
      "nodes": [
        {
          "content": "The behavior of the Dataset2 input is identical to that of Dataset1.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "Using this input you can pass a second rectangular table of data into your R code.",
          "pos": [
            69,
            151
          ]
        },
        {
          "content": "The function <ph id=\"ph48\">`maml.mapInputPort(2)`</ph>, with the argument 2, is used to pass this data.",
          "pos": [
            152,
            255
          ]
        }
      ]
    },
    {
      "pos": [
        20646,
        20670
      ],
      "content": "Execute R Script outputs"
    },
    {
      "pos": [
        20676,
        20694
      ],
      "content": "Output a dataframe"
    },
    {
      "pos": [
        20696,
        20907
      ],
      "content": "You can output the contents of an R dataframe as a rectangular table through the Result Dataset1 port by using the <ph id=\"ph49\">`maml.mapOutputPort()`</ph><ph id=\"ph50\"/> function. In our simple R script this is performed by the following line.",
      "nodes": [
        {
          "content": "You can output the contents of an R dataframe as a rectangular table through the Result Dataset1 port by using the <ph id=\"ph49\">`maml.mapOutputPort()`</ph><ph id=\"ph50\"/> function.",
          "pos": [
            0,
            181
          ]
        },
        {
          "content": "In our simple R script this is performed by the following line.",
          "pos": [
            182,
            245
          ]
        }
      ]
    },
    {
      "pos": [
        20948,
        21091
      ],
      "content": "After running the experiment, click on the Result Dataset1 output port and then click on <bpt id=\"p49\">**</bpt>Visualize<ept id=\"p49\">**</ept>. You should see something like Figure 6.",
      "nodes": [
        {
          "content": "After running the experiment, click on the Result Dataset1 output port and then click on <bpt id=\"p49\">**</bpt>Visualize<ept id=\"p49\">**</ept>.",
          "pos": [
            0,
            143
          ]
        },
        {
          "content": "You should see something like Figure 6.",
          "pos": [
            144,
            183
          ]
        }
      ]
    },
    {
      "pos": [
        21093,
        21159
      ],
      "content": "![The visualization of the output of the California dairy data][7]"
    },
    {
      "pos": [
        21161,
        21234
      ],
      "content": "<bpt id=\"p50\">*</bpt>Figure 6. The visualization of the output of the California dairy data.<ept id=\"p50\">*</ept>"
    },
    {
      "pos": [
        21236,
        21301
      ],
      "content": "This output looks identical to the input, exactly as we expected."
    },
    {
      "pos": [
        21309,
        21324
      ],
      "content": "R Device output"
    },
    {
      "pos": [
        21326,
        21527
      ],
      "content": "The Device output of the [Execute R Script][execute-r-script] module contains messages and graphics output. Both standard output and standard error messages from R are sent to the R Device output port.",
      "nodes": [
        {
          "content": "The Device output of the [Execute R Script][execute-r-script] module contains messages and graphics output.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "Both standard output and standard error messages from R are sent to the R Device output port.",
          "pos": [
            108,
            201
          ]
        }
      ]
    },
    {
      "pos": [
        21531,
        21681
      ],
      "content": "To view the R Device output, click on the port and then on <bpt id=\"p51\">**</bpt>Visualize<ept id=\"p51\">**</ept>. We see the standard output and standard error from the R script in Figure 7.",
      "nodes": [
        {
          "content": "To view the R Device output, click on the port and then on <bpt id=\"p51\">**</bpt>Visualize<ept id=\"p51\">**</ept>.",
          "pos": [
            0,
            113
          ]
        },
        {
          "content": "We see the standard output and standard error from the R script in Figure 7.",
          "pos": [
            114,
            190
          ]
        }
      ]
    },
    {
      "pos": [
        21683,
        21746
      ],
      "content": "![Standard output and standard error from the R Device port][8]"
    },
    {
      "pos": [
        21748,
        21818
      ],
      "content": "<bpt id=\"p52\">*</bpt>Figure 7. Standard output and standard error from the R Device port.<ept id=\"p52\">*</ept>"
    },
    {
      "pos": [
        21820,
        21892
      ],
      "content": "Scrolling down we see the graphics output from our R script in Figure 8."
    },
    {
      "pos": [
        21896,
        21940
      ],
      "content": "![Graphics output from the R Device port][9]"
    },
    {
      "pos": [
        21942,
        21993
      ],
      "content": "<bpt id=\"p53\">*</bpt>Figure 8. Graphics output from the R Device port.<ept id=\"p53\">*</ept>"
    },
    {
      "pos": [
        21997,
        21999
      ],
      "content": "##"
    },
    {
      "pos": [
        22021,
        22054
      ],
      "content": "Data filtering and transformation"
    },
    {
      "pos": [
        22056,
        22271
      ],
      "content": "In this section we will perform some basic data filtering and transformation operations on the California dairy data. By the end of this section we will have data in a format suitable for building an analytic model.",
      "nodes": [
        {
          "content": "In this section we will perform some basic data filtering and transformation operations on the California dairy data.",
          "pos": [
            0,
            117
          ]
        },
        {
          "content": "By the end of this section we will have data in a format suitable for building an analytic model.",
          "pos": [
            118,
            215
          ]
        }
      ]
    },
    {
      "pos": [
        22275,
        22580
      ],
      "content": "More specifically, in this section we will perform several common data cleaning and transformation tasks: type transformation, filtering on dataframes, adding new computed columns, and value transformations. This background should help you deal with the many variations encountered in real-world problems.",
      "nodes": [
        {
          "content": "More specifically, in this section we will perform several common data cleaning and transformation tasks: type transformation, filtering on dataframes, adding new computed columns, and value transformations.",
          "pos": [
            0,
            207
          ]
        },
        {
          "content": "This background should help you deal with the many variations encountered in real-world problems.",
          "pos": [
            208,
            305
          ]
        }
      ]
    },
    {
      "pos": [
        22582,
        22671
      ],
      "content": "The complete R code for this section is available in the zip file you downloaded earlier."
    },
    {
      "pos": [
        22677,
        22697
      ],
      "content": "Type transformations"
    },
    {
      "pos": [
        22699,
        22894
      ],
      "content": "Now that we can read the California dairy data into the R code in the [Execute R Script][execute-r-script] module, we need to ensure that the data in the columns has the intended type and format."
    },
    {
      "pos": [
        22898,
        23247
      ],
      "content": "R is a dynamically typed language, which means that data types are coerced from one to another as required. The atomic data types in R include numeric, logical and character. The factor type is used to compactly store categorical data. You can find much more information on data types in the references in <bpt id=\"p54\">[</bpt>Appendix B - Further reading<ept id=\"p54\">](#appendixb)</ept>.",
      "nodes": [
        {
          "content": "R is a dynamically typed language, which means that data types are coerced from one to another as required.",
          "pos": [
            0,
            107
          ]
        },
        {
          "content": "The atomic data types in R include numeric, logical and character.",
          "pos": [
            108,
            174
          ]
        },
        {
          "content": "The factor type is used to compactly store categorical data.",
          "pos": [
            175,
            235
          ]
        },
        {
          "content": "You can find much more information on data types in the references in <bpt id=\"p54\">[</bpt>Appendix B - Further reading<ept id=\"p54\">](#appendixb)</ept>.",
          "pos": [
            236,
            389
          ]
        }
      ]
    },
    {
      "pos": [
        23249,
        23621
      ],
      "content": "When tabular data is read into R from an external source, it is always a good idea to check the resulting types in the columns. You may want a column of type character, but in many cases this will show up as factor or vice versa. In other cases a column you think should be numeric is represented by character data, e.g. '1.23' rather than 1.23 as a floating point number.",
      "nodes": [
        {
          "content": "When tabular data is read into R from an external source, it is always a good idea to check the resulting types in the columns.",
          "pos": [
            0,
            127
          ]
        },
        {
          "content": "You may want a column of type character, but in many cases this will show up as factor or vice versa.",
          "pos": [
            128,
            229
          ]
        },
        {
          "content": "In other cases a column you think should be numeric is represented by character data, e.g. '1.23' rather than 1.23 as a floating point number.",
          "pos": [
            230,
            372
          ]
        }
      ]
    },
    {
      "pos": [
        23625,
        23916
      ],
      "content": "Fortunately, it is easy to convert one type to another, as long as mapping is possible. For example, you cannot convert 'Nevada' into a numeric value, but you can convert it to a factor (categorical variable). As another example, you can convert a numeric 1 into a character '1' or a factor.",
      "nodes": [
        {
          "content": "Fortunately, it is easy to convert one type to another, as long as mapping is possible.",
          "pos": [
            0,
            87
          ]
        },
        {
          "content": "For example, you cannot convert 'Nevada' into a numeric value, but you can convert it to a factor (categorical variable).",
          "pos": [
            88,
            209
          ]
        },
        {
          "content": "As another example, you can convert a numeric 1 into a character '1' or a factor.",
          "pos": [
            210,
            291
          ]
        }
      ]
    },
    {
      "pos": [
        23920,
        24042
      ],
      "content": "The syntax for any of these conversions is simple: <ph id=\"ph51\">`as.datatype()`</ph>. These type conversion functions include the following.",
      "nodes": [
        {
          "content": "The syntax for any of these conversions is simple: <ph id=\"ph51\">`as.datatype()`</ph>.",
          "pos": [
            0,
            86
          ]
        },
        {
          "content": "These type conversion functions include the following.",
          "pos": [
            87,
            141
          ]
        }
      ]
    },
    {
      "pos": [
        24117,
        24344
      ],
      "content": "Looking at the data types of the columns we input in the previous section: all columns are of type numeric, except for the column labeled 'Month', which is of type character. Let's convert this to a factor and test the results.",
      "nodes": [
        {
          "content": "Looking at the data types of the columns we input in the previous section: all columns are of type numeric, except for the column labeled 'Month', which is of type character.",
          "pos": [
            0,
            174
          ]
        },
        {
          "content": "Let's convert this to a factor and test the results.",
          "pos": [
            175,
            227
          ]
        }
      ]
    },
    {
      "pos": [
        24348,
        24707
      ],
      "content": "I have deleted the line that created the scatterplot matrix and added a line converting the 'Month' column to a factor. In my experiment I will just cut and paste the R code into the code window of the [Execute R Script][execute-r-script] Module. You could also update the zip file and upload it to Azure Machine Learning Studio, but this takes several steps.",
      "nodes": [
        {
          "content": "I have deleted the line that created the scatterplot matrix and added a line converting the 'Month' column to a factor.",
          "pos": [
            0,
            119
          ]
        },
        {
          "content": "In my experiment I will just cut and paste the R code into the code window of the [Execute R Script][execute-r-script] Module.",
          "pos": [
            120,
            246
          ]
        },
        {
          "content": "You could also update the zip file and upload it to Azure Machine Learning Studio, but this takes several steps.",
          "pos": [
            247,
            359
          ]
        }
      ]
    },
    {
      "pos": [
        25354,
        25475
      ],
      "content": "Let's execute this code and look at the output log for the R script. The relevant data from the log is shown in Figure 9.",
      "nodes": [
        {
          "content": "Let's execute this code and look at the output log for the R script.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "The relevant data from the log is shown in Figure 9.",
          "pos": [
            69,
            121
          ]
        }
      ]
    },
    {
      "pos": [
        26686,
        26746
      ],
      "content": "<bpt id=\"p55\">*</bpt>Figure 9. Summary of the dataframe with a factor variable.<ept id=\"p55\">*</ept>"
    },
    {
      "pos": [
        26748,
        26976
      ],
      "content": "The type for Month should now say '<bpt id=\"p56\">**</bpt>Factor w/ 14 levels<ept id=\"p56\">**</ept>'. This is a problem since there are only 12 months in the year. You can also check to see that the type in <bpt id=\"p57\">**</bpt>Visualize<ept id=\"p57\">**</ept><ph id=\"ph56\"/> of the Result Dataset port is '<bpt id=\"p58\">**</bpt>Categorical<ept id=\"p58\">**</ept>'.",
      "nodes": [
        {
          "content": "The type for Month should now say '<bpt id=\"p56\">**</bpt>Factor w/ 14 levels<ept id=\"p56\">**</ept>'.",
          "pos": [
            0,
            100
          ]
        },
        {
          "content": "This is a problem since there are only 12 months in the year.",
          "pos": [
            101,
            162
          ]
        },
        {
          "content": "You can also check to see that the type in <bpt id=\"p57\">**</bpt>Visualize<ept id=\"p57\">**</ept><ph id=\"ph56\"/> of the Result Dataset port is '<bpt id=\"p58\">**</bpt>Categorical<ept id=\"p58\">**</ept>'.",
          "pos": [
            163,
            363
          ]
        }
      ]
    },
    {
      "pos": [
        26978,
        27242
      ],
      "content": "The problem is that the 'Month' column has not been coded systematically. In some cases a month is called April and in others it is abbreviated as Apr. We can solve this problem by trimming the string to 3 characters. The line of code now looks like the following:",
      "nodes": [
        {
          "content": "The problem is that the 'Month' column has not been coded systematically.",
          "pos": [
            0,
            73
          ]
        },
        {
          "content": "In some cases a month is called April and in others it is abbreviated as Apr. We can solve this problem by trimming the string to 3 characters.",
          "pos": [
            74,
            217
          ]
        },
        {
          "content": "The line of code now looks like the following:",
          "pos": [
            218,
            264
          ]
        }
      ]
    },
    {
      "pos": [
        27383,
        27473
      ],
      "content": "Rerun the experiment and view the output log. The expected results are shown in Figure 10.",
      "nodes": [
        {
          "content": "Rerun the experiment and view the output log.",
          "pos": [
            0,
            45
          ]
        },
        {
          "content": "The expected results are shown in Figure 10.",
          "pos": [
            46,
            90
          ]
        }
      ]
    },
    {
      "pos": [
        28689,
        28764
      ],
      "content": "<bpt id=\"p59\">*</bpt>Figure 10. Summary of the dataframe with correct number of factor levels.<ept id=\"p59\">*</ept>"
    },
    {
      "pos": [
        28766,
        28816
      ],
      "content": "Our factor variable now has the desired 12 levels."
    },
    {
      "pos": [
        28821,
        28847
      ],
      "content": "Basic data frame filtering"
    },
    {
      "pos": [
        28849,
        29150
      ],
      "content": "R dataframes support powerful filtering capabilities. Datasets can be subsetted by using logical filters on either rows or columns. In many cases, complex filter criteria will be required. The references in <bpt id=\"p60\">[</bpt>Appendix B - Further reading<ept id=\"p60\">](#appendixb)</ept><ph id=\"ph57\"/> contain extensive examples of filtering dataframes.",
      "nodes": [
        {
          "content": "R dataframes support powerful filtering capabilities.",
          "pos": [
            0,
            53
          ]
        },
        {
          "content": "Datasets can be subsetted by using logical filters on either rows or columns.",
          "pos": [
            54,
            131
          ]
        },
        {
          "content": "In many cases, complex filter criteria will be required.",
          "pos": [
            132,
            188
          ]
        },
        {
          "content": "The references in <bpt id=\"p60\">[</bpt>Appendix B - Further reading<ept id=\"p60\">](#appendixb)</ept><ph id=\"ph57\"/> contain extensive examples of filtering dataframes.",
          "pos": [
            189,
            356
          ]
        }
      ]
    },
    {
      "pos": [
        29154,
        29505
      ],
      "content": "There is one bit of filtering we should do on our dataset. If you look at the columns in the cadairydata dataframe, you will see two unnecessary columns. The first column just holds a row number, which is not very useful. The second column, Year.Month, contains redundant information. We can easily exclude these columns by using the following R code.",
      "nodes": [
        {
          "content": "There is one bit of filtering we should do on our dataset.",
          "pos": [
            0,
            58
          ]
        },
        {
          "content": "If you look at the columns in the cadairydata dataframe, you will see two unnecessary columns.",
          "pos": [
            59,
            153
          ]
        },
        {
          "content": "The first column just holds a row number, which is not very useful.",
          "pos": [
            154,
            221
          ]
        },
        {
          "content": "The second column, Year.Month, contains redundant information.",
          "pos": [
            222,
            284
          ]
        },
        {
          "content": "We can easily exclude these columns by using the following R code.",
          "pos": [
            285,
            351
          ]
        }
      ]
    },
    {
      "pos": [
        29509,
        29788
      ],
      "content": "<ph id=\"ph58\">[AZURE.NOTE]</ph><ph id=\"ph59\"/> From now on in this section, I will just show you the additional code I am adding in the [Execute R Script][execute-r-script] module. I will add each new line <bpt id=\"p61\">**</bpt>before<ept id=\"p61\">**</ept><ph id=\"ph60\"/> the <ph id=\"ph61\">`str()`</ph><ph id=\"ph62\"/> function. I use this function to verify my results in Azure Machine Learning Studio.",
      "nodes": [
        {
          "content": "<ph id=\"ph58\">[AZURE.NOTE]</ph><ph id=\"ph59\"/> From now on in this section, I will just show you the additional code I am adding in the [Execute R Script][execute-r-script] module.",
          "pos": [
            0,
            180
          ]
        },
        {
          "content": "I will add each new line <bpt id=\"p61\">**</bpt>before<ept id=\"p61\">**</ept><ph id=\"ph60\"/> the <ph id=\"ph61\">`str()`</ph><ph id=\"ph62\"/> function.",
          "pos": [
            181,
            327
          ]
        },
        {
          "content": "I use this function to verify my results in Azure Machine Learning Studio.",
          "pos": [
            328,
            402
          ]
        }
      ]
    },
    {
      "pos": [
        29790,
        29879
      ],
      "content": "I add the following line to my R code in the [Execute R Script][execute-r-script] module."
    },
    {
      "pos": [
        29966,
        30078
      ],
      "content": "Run this code in your experiment and check the result from the output log. These results are shown in Figure 11.",
      "nodes": [
        {
          "content": "Run this code in your experiment and check the result from the output log.",
          "pos": [
            0,
            74
          ]
        },
        {
          "content": "These results are shown in Figure 11.",
          "pos": [
            75,
            112
          ]
        }
      ]
    },
    {
      "pos": [
        31106,
        31169
      ],
      "content": "<bpt id=\"p62\">*</bpt>Figure 11. Summary of the dataframe with two columns removed.<ept id=\"p62\">*</ept>"
    },
    {
      "pos": [
        31171,
        31210
      ],
      "content": "Good news! We get the expected results.",
      "nodes": [
        {
          "content": "Good news!",
          "pos": [
            0,
            10
          ]
        },
        {
          "content": "We get the expected results.",
          "pos": [
            11,
            39
          ]
        }
      ]
    },
    {
      "pos": [
        31215,
        31231
      ],
      "content": "Add a new column"
    },
    {
      "pos": [
        31233,
        31401
      ],
      "content": "To create time series models it will be convenient to have a column containing the months since the start of the time series. We will create a new column 'Month.Count'.",
      "nodes": [
        {
          "content": "To create time series models it will be convenient to have a column containing the months since the start of the time series.",
          "pos": [
            0,
            125
          ]
        },
        {
          "content": "We will create a new column 'Month.Count'.",
          "pos": [
            126,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        31403,
        31587
      ],
      "content": "To help organize the code we will create our first simple function, <ph id=\"ph63\">`num.month()`</ph>. We will then apply this function to create a new column in the dataframe. The new code is as follows.",
      "nodes": [
        {
          "content": "To help organize the code we will create our first simple function, <ph id=\"ph63\">`num.month()`</ph>.",
          "pos": [
            0,
            101
          ]
        },
        {
          "content": "We will then apply this function to create a new column in the dataframe.",
          "pos": [
            102,
            175
          ]
        },
        {
          "content": "The new code is as follows.",
          "pos": [
            176,
            203
          ]
        }
      ]
    },
    {
      "pos": [
        32086,
        32198
      ],
      "content": "Now run the updated experiment and use the output log to view the results. These results are shown in Figure 12.",
      "nodes": [
        {
          "content": "Now run the updated experiment and use the output log to view the results.",
          "pos": [
            0,
            74
          ]
        },
        {
          "content": "These results are shown in Figure 12.",
          "pos": [
            75,
            112
          ]
        }
      ]
    },
    {
      "pos": [
        33316,
        33381
      ],
      "content": "<bpt id=\"p63\">*</bpt>Figure 12. Summary of the dataframe with the additional column.<ept id=\"p63\">*</ept>"
    },
    {
      "pos": [
        33383,
        33485
      ],
      "content": "It looks like everything is working. We have the new column with the expected values in our dataframe.",
      "nodes": [
        {
          "content": "It looks like everything is working.",
          "pos": [
            0,
            36
          ]
        },
        {
          "content": "We have the new column with the expected values in our dataframe.",
          "pos": [
            37,
            102
          ]
        }
      ]
    },
    {
      "pos": [
        33490,
        33511
      ],
      "content": "Value transformations"
    },
    {
      "pos": [
        33513,
        33780
      ],
      "content": "In this section we will perform some simple transformations on the values in some of the columns of our dataframe. The R language supports nearly arbitrary value transformations. The references in <bpt id=\"p64\">[</bpt>Appendix B - Further Reading<ept id=\"p64\">](#appendixb)</ept><ph id=\"ph64\"/> contain extensive examples.",
      "nodes": [
        {
          "content": "In this section we will perform some simple transformations on the values in some of the columns of our dataframe.",
          "pos": [
            0,
            114
          ]
        },
        {
          "content": "The R language supports nearly arbitrary value transformations.",
          "pos": [
            115,
            178
          ]
        },
        {
          "content": "The references in <bpt id=\"p64\">[</bpt>Appendix B - Further Reading<ept id=\"p64\">](#appendixb)</ept><ph id=\"ph64\"/> contain extensive examples.",
          "pos": [
            179,
            322
          ]
        }
      ]
    },
    {
      "pos": [
        33782,
        34380
      ],
      "content": "If you look at the values in the summaries of our dataframe you should see something odd here. Is more ice cream than milk produced in California? No, of course not, as this makes no sense, sad as this fact may be to some of us ice cream lovers. The units are different. The price is in units of US pounds, milk is in units of 1 M US pounds, ice cream is in units of 1,000 US gallons, and cottage cheese is in units of 1,000 US pounds. Assuming ice cream weighs about 6.5 pounds per gallon, we can easily do the multiplication to convert these values so they are all in equal units of 1,000 pounds.",
      "nodes": [
        {
          "content": "If you look at the values in the summaries of our dataframe you should see something odd here.",
          "pos": [
            0,
            94
          ]
        },
        {
          "content": "Is more ice cream than milk produced in California?",
          "pos": [
            95,
            146
          ]
        },
        {
          "content": "No, of course not, as this makes no sense, sad as this fact may be to some of us ice cream lovers.",
          "pos": [
            147,
            245
          ]
        },
        {
          "content": "The units are different.",
          "pos": [
            246,
            270
          ]
        },
        {
          "content": "The price is in units of US pounds, milk is in units of 1 M US pounds, ice cream is in units of 1,000 US gallons, and cottage cheese is in units of 1,000 US pounds.",
          "pos": [
            271,
            435
          ]
        },
        {
          "content": "Assuming ice cream weighs about 6.5 pounds per gallon, we can easily do the multiplication to convert these values so they are all in equal units of 1,000 pounds.",
          "pos": [
            436,
            598
          ]
        }
      ]
    },
    {
      "pos": [
        34382,
        34655
      ],
      "content": "For our forecasting model we use a multiplicative model for trend and seasonal adjustment of this data. A log transformation allows us to use a linear model, simplifying this process. We can apply the log transformation in the same function where the multiplier is applied.",
      "nodes": [
        {
          "content": "For our forecasting model we use a multiplicative model for trend and seasonal adjustment of this data.",
          "pos": [
            0,
            103
          ]
        },
        {
          "content": "A log transformation allows us to use a linear model, simplifying this process.",
          "pos": [
            104,
            183
          ]
        },
        {
          "content": "We can apply the log transformation in the same function where the multiplier is applied.",
          "pos": [
            184,
            273
          ]
        }
      ]
    },
    {
      "pos": [
        34657,
        35210
      ],
      "content": "In the following code, I define a new function, <ph id=\"ph65\">`log.transform()`</ph>, and apply it to the rows containing the numerical values. The R <ph id=\"ph66\">`Map()`</ph><ph id=\"ph67\"/> function is used to apply the <ph id=\"ph68\">`log.transform()`</ph><ph id=\"ph69\"/> function to the selected columns of the dataframe. <ph id=\"ph70\">`Map()`</ph><ph id=\"ph71\"/> is similar to <ph id=\"ph72\">`apply()`</ph><ph id=\"ph73\"/> but allows for more than one list of arguments to the function. Note that a list of multipliers supplies the second argument to the <ph id=\"ph74\">`log.transform()`</ph><ph id=\"ph75\"/> function. The <ph id=\"ph76\">`na.omit()`</ph><ph id=\"ph77\"/> function is used as a bit of cleanup to ensure we do not have missing or undefined values in the dataframe.",
      "nodes": [
        {
          "content": "In the following code, I define a new function, <ph id=\"ph65\">`log.transform()`</ph>, and apply it to the rows containing the numerical values.",
          "pos": [
            0,
            143
          ]
        },
        {
          "content": "The R <ph id=\"ph66\">`Map()`</ph><ph id=\"ph67\"/> function is used to apply the <ph id=\"ph68\">`log.transform()`</ph><ph id=\"ph69\"/> function to the selected columns of the dataframe.",
          "pos": [
            144,
            324
          ]
        },
        {
          "content": "<ph id=\"ph70\">`Map()`</ph><ph id=\"ph71\"/> is similar to <ph id=\"ph72\">`apply()`</ph><ph id=\"ph73\"/> but allows for more than one list of arguments to the function.",
          "pos": [
            325,
            488
          ]
        },
        {
          "content": "Note that a list of multipliers supplies the second argument to the <ph id=\"ph74\">`log.transform()`</ph><ph id=\"ph75\"/> function.",
          "pos": [
            489,
            618
          ]
        },
        {
          "content": "The <ph id=\"ph76\">`na.omit()`</ph><ph id=\"ph77\"/> function is used as a bit of cleanup to ensure we do not have missing or undefined values in the dataframe.",
          "pos": [
            619,
            776
          ]
        }
      ]
    },
    {
      "pos": [
        36686,
        36958
      ],
      "content": "There is quite a bit happening in the <ph id=\"ph78\">`log.transform()`</ph><ph id=\"ph79\"/> function. Most of this code is checking for potential problems with the arguments or dealing with exceptions, which can still arise during the computations. Only a few lines of this code actually do the computations.",
      "nodes": [
        {
          "content": "There is quite a bit happening in the <ph id=\"ph78\">`log.transform()`</ph><ph id=\"ph79\"/> function.",
          "pos": [
            0,
            99
          ]
        },
        {
          "content": "Most of this code is checking for potential problems with the arguments or dealing with exceptions, which can still arise during the computations.",
          "pos": [
            100,
            246
          ]
        },
        {
          "content": "Only a few lines of this code actually do the computations.",
          "pos": [
            247,
            306
          ]
        }
      ]
    },
    {
      "pos": [
        36960,
        37351
      ],
      "content": "The goal of the defensive programming is to prevent the failure of a single function that prevents processing from continuing. An abrupt failure of a long-running analysis can be quite frustrating for users. To avoid this situation, default return values must be chosen that will limit damage to downstream processing. A message is also produced to alert users that something has gone wrong.",
      "nodes": [
        {
          "content": "The goal of the defensive programming is to prevent the failure of a single function that prevents processing from continuing.",
          "pos": [
            0,
            126
          ]
        },
        {
          "content": "An abrupt failure of a long-running analysis can be quite frustrating for users.",
          "pos": [
            127,
            207
          ]
        },
        {
          "content": "To avoid this situation, default return values must be chosen that will limit damage to downstream processing.",
          "pos": [
            208,
            318
          ]
        },
        {
          "content": "A message is also produced to alert users that something has gone wrong.",
          "pos": [
            319,
            391
          ]
        }
      ]
    },
    {
      "pos": [
        37353,
        37487
      ],
      "content": "If you are not used to defensive programming in R, all this code may seem a bit overwhelming. I will walk you through the major steps:",
      "nodes": [
        {
          "content": "If you are not used to defensive programming in R, all this code may seem a bit overwhelming.",
          "pos": [
            0,
            93
          ]
        },
        {
          "content": "I will walk you through the major steps:",
          "pos": [
            94,
            134
          ]
        }
      ]
    },
    {
      "pos": [
        37492,
        37660
      ],
      "content": "A vector of four messages is defined. These messages are used to communicate information about some of the possible errors and exceptions that can occur with this code.",
      "nodes": [
        {
          "content": "A vector of four messages is defined.",
          "pos": [
            0,
            37
          ]
        },
        {
          "content": "These messages are used to communicate information about some of the possible errors and exceptions that can occur with this code.",
          "pos": [
            38,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        37665,
        37851
      ],
      "content": "I return a value of NA for each case. There are many other possibilities that might have fewer side effects. I could return a vector of zeroes, or the original input vector, for example.",
      "nodes": [
        {
          "content": "I return a value of NA for each case.",
          "pos": [
            0,
            37
          ]
        },
        {
          "content": "There are many other possibilities that might have fewer side effects.",
          "pos": [
            38,
            108
          ]
        },
        {
          "content": "I could return a vector of zeroes, or the original input vector, for example.",
          "pos": [
            109,
            186
          ]
        }
      ]
    },
    {
      "pos": [
        37856,
        38269
      ],
      "content": "Checks are run on the arguments to the function. In each case, if an error is detected, a default value is returned and a message is produced by the <ph id=\"ph80\">`warming()`</ph><ph id=\"ph81\"/> function. I am using <ph id=\"ph82\">`warning()`</ph><ph id=\"ph83\"/> rather than <ph id=\"ph84\">`stop()`</ph><ph id=\"ph85\"/> as the latter will terminate execution, exactly what I am trying to avoid. Note that I have written this code in a procedural style, as in this case a functional approach seemed complex and obscure.",
      "nodes": [
        {
          "content": "Checks are run on the arguments to the function.",
          "pos": [
            0,
            48
          ]
        },
        {
          "content": "In each case, if an error is detected, a default value is returned and a message is produced by the <ph id=\"ph80\">`warming()`</ph><ph id=\"ph81\"/> function.",
          "pos": [
            49,
            204
          ]
        },
        {
          "content": "I am using <ph id=\"ph82\">`warning()`</ph><ph id=\"ph83\"/> rather than <ph id=\"ph84\">`stop()`</ph><ph id=\"ph85\"/> as the latter will terminate execution, exactly what I am trying to avoid.",
          "pos": [
            205,
            391
          ]
        },
        {
          "content": "Note that I have written this code in a procedural style, as in this case a functional approach seemed complex and obscure.",
          "pos": [
            392,
            515
          ]
        }
      ]
    },
    {
      "pos": [
        38274,
        38488
      ],
      "content": "The log computations are wrapped in <ph id=\"ph86\">`tryCatch()`</ph><ph id=\"ph87\"/> so that exceptions will not cause an abrupt halt to processing. Without <ph id=\"ph88\">`tryCatch()`</ph><ph id=\"ph89\"/> most errors raised by R functions result in a stop signal, which does just that.",
      "nodes": [
        {
          "content": "The log computations are wrapped in <ph id=\"ph86\">`tryCatch()`</ph><ph id=\"ph87\"/> so that exceptions will not cause an abrupt halt to processing.",
          "pos": [
            0,
            146
          ]
        },
        {
          "content": "Without <ph id=\"ph88\">`tryCatch()`</ph><ph id=\"ph89\"/> most errors raised by R functions result in a stop signal, which does just that.",
          "pos": [
            147,
            282
          ]
        }
      ]
    },
    {
      "pos": [
        38490,
        38685
      ],
      "content": "Execute this R code in your experiment and have a look at the printed output in the output.log file. You will now see the transformed values of the four columns in the log, as shown in Figure 13.",
      "nodes": [
        {
          "content": "Execute this R code in your experiment and have a look at the printed output in the output.log file.",
          "pos": [
            0,
            100
          ]
        },
        {
          "content": "You will now see the transformed values of the four columns in the log, as shown in Figure 13.",
          "pos": [
            101,
            195
          ]
        }
      ]
    },
    {
      "pos": [
        39794,
        39858
      ],
      "content": "<bpt id=\"p65\">*</bpt>Figure 13. Summary of the transformed values in the dataframe.<ept id=\"p65\">*</ept>"
    },
    {
      "pos": [
        39860,
        40022
      ],
      "content": "We see the values have been transformed. Milk production now greatly exceeds all other dairy product production, recalling that we are now looking at a log scale.",
      "nodes": [
        {
          "content": "We see the values have been transformed.",
          "pos": [
            0,
            40
          ]
        },
        {
          "content": "Milk production now greatly exceeds all other dairy product production, recalling that we are now looking at a log scale.",
          "pos": [
            41,
            162
          ]
        }
      ]
    },
    {
      "pos": [
        40024,
        40313
      ],
      "content": "At this point our data is cleaned up and we are ready for some modeling. Looking at the visualization summary for the Result Dataset output of our [Execute R Script][execute-r-script] module, you will see the 'Month' column is 'Categorical' with 12 unique values, again, just as we wanted.",
      "nodes": [
        {
          "content": "At this point our data is cleaned up and we are ready for some modeling.",
          "pos": [
            0,
            72
          ]
        },
        {
          "content": "Looking at the visualization summary for the Result Dataset output of our [Execute R Script][execute-r-script] module, you will see the 'Month' column is 'Categorical' with 12 unique values, again, just as we wanted.",
          "pos": [
            73,
            289
          ]
        }
      ]
    },
    {
      "pos": [
        40315,
        40317
      ],
      "content": "##"
    },
    {
      "pos": [
        40340,
        40384
      ],
      "content": "Time series objects and correlation analysis"
    },
    {
      "pos": [
        40386,
        40610
      ],
      "content": "In this section we will explore a few basic R time series objects and analyze the correlations between some of the variables. Our goal is to output a dataframe containing the pairwise correlation information at several lags.",
      "nodes": [
        {
          "content": "In this section we will explore a few basic R time series objects and analyze the correlations between some of the variables.",
          "pos": [
            0,
            125
          ]
        },
        {
          "content": "Our goal is to output a dataframe containing the pairwise correlation information at several lags.",
          "pos": [
            126,
            224
          ]
        }
      ]
    },
    {
      "pos": [
        40612,
        40691
      ],
      "content": "The complete R code for this section is in the zip file you downloaded earlier."
    },
    {
      "pos": [
        40696,
        40720
      ],
      "content": "Time series objects in R"
    },
    {
      "pos": [
        40722,
        41174
      ],
      "content": "As already mentioned, time series are a series of data values indexed by time. R time series objects are used to create and manage the time index. There are several advantages to using time series objects. Time series objects free you from the many details of managing the time series index values that are encapsulated in the object. In addition, time series objects allow you to use the many time series methods for plotting, printing, modeling, etc.",
      "nodes": [
        {
          "content": "As already mentioned, time series are a series of data values indexed by time.",
          "pos": [
            0,
            78
          ]
        },
        {
          "content": "R time series objects are used to create and manage the time index.",
          "pos": [
            79,
            146
          ]
        },
        {
          "content": "There are several advantages to using time series objects.",
          "pos": [
            147,
            205
          ]
        },
        {
          "content": "Time series objects free you from the many details of managing the time series index values that are encapsulated in the object.",
          "pos": [
            206,
            334
          ]
        },
        {
          "content": "In addition, time series objects allow you to use the many time series methods for plotting, printing, modeling, etc.",
          "pos": [
            335,
            452
          ]
        }
      ]
    },
    {
      "pos": [
        41176,
        41480
      ],
      "content": "The POSIXct time series class is commonly used and is relatively simple. This time series class measures time from the start of the epoch, January 1, 1970. We will use POSIXct time series objects in this example. Other widely used R time series object classes include zoo and xts, extensible time series.",
      "nodes": [
        {
          "content": "The POSIXct time series class is commonly used and is relatively simple.",
          "pos": [
            0,
            72
          ]
        },
        {
          "content": "This time series class measures time from the start of the epoch, January 1, 1970.",
          "pos": [
            73,
            155
          ]
        },
        {
          "content": "We will use POSIXct time series objects in this example.",
          "pos": [
            156,
            212
          ]
        },
        {
          "content": "Other widely used R time series object classes include zoo and xts, extensible time series.",
          "pos": [
            213,
            304
          ]
        }
      ]
    },
    {
      "pos": [
        41659,
        41685
      ],
      "content": "Time series object example"
    },
    {
      "pos": [
        41687,
        41995
      ],
      "content": "Let's get started with our example. Drag and drop a <bpt id=\"p66\">**</bpt>new<ept id=\"p66\">**</ept><ph id=\"ph91\"/> [Execute R Script][execute-r-script] module into your experiment. Connect the Result Dataset1 output port of the existing [Execute R Script][execute-r-script] module to the Dataset1 input port of the new [Execute R Script][execute-r-script] module.",
      "nodes": [
        {
          "content": "Let's get started with our example.",
          "pos": [
            0,
            35
          ]
        },
        {
          "content": "Drag and drop a <bpt id=\"p66\">**</bpt>new<ept id=\"p66\">**</ept><ph id=\"ph91\"/> [Execute R Script][execute-r-script] module into your experiment.",
          "pos": [
            36,
            180
          ]
        },
        {
          "content": "Connect the Result Dataset1 output port of the existing [Execute R Script][execute-r-script] module to the Dataset1 input port of the new [Execute R Script][execute-r-script] module.",
          "pos": [
            181,
            363
          ]
        }
      ]
    },
    {
      "pos": [
        41997,
        42154
      ],
      "content": "As I did for the first examples, as we progress through the example, at some points I will show only the incremental additional lines of R code at each step."
    },
    {
      "pos": [
        42166,
        42187
      ],
      "content": "Reading the dataframe"
    },
    {
      "pos": [
        42189,
        42312
      ],
      "content": "As a first step, let's read in a dataframe and make sure we get the expected results. The following code should do the job.",
      "nodes": [
        {
          "content": "As a first step, let's read in a dataframe and make sure we get the expected results.",
          "pos": [
            0,
            85
          ]
        },
        {
          "content": "The following code should do the job.",
          "pos": [
            86,
            123
          ]
        }
      ]
    },
    {
      "pos": [
        42441,
        42535
      ],
      "content": "Now, run the experiment. The log of the new Execute R Script shape should look like Figure 14.",
      "nodes": [
        {
          "content": "Now, run the experiment.",
          "pos": [
            0,
            24
          ]
        },
        {
          "content": "The log of the new Execute R Script shape should look like Figure 14.",
          "pos": [
            25,
            94
          ]
        }
      ]
    },
    {
      "pos": [
        43476,
        43545
      ],
      "content": "<bpt id=\"p67\">*</bpt>Figure 14. Summary of the dataframe in the Execute R Script module.<ept id=\"p67\">*</ept>"
    },
    {
      "pos": [
        43547,
        43679
      ],
      "content": "This data is of the expected types and format. Note that the 'Month' column is of type factor and has the expected number of levels.",
      "nodes": [
        {
          "content": "This data is of the expected types and format.",
          "pos": [
            0,
            46
          ]
        },
        {
          "content": "Note that the 'Month' column is of type factor and has the expected number of levels.",
          "pos": [
            47,
            132
          ]
        }
      ]
    },
    {
      "pos": [
        43685,
        43714
      ],
      "content": "Creating a time series object"
    },
    {
      "pos": [
        43716,
        43856
      ],
      "content": "We need to add a time series object to our dataframe. Replace the current code with the following, which adds a new column of class POSIXct.",
      "nodes": [
        {
          "content": "We need to add a time series object to our dataframe.",
          "pos": [
            0,
            53
          ]
        },
        {
          "content": "Replace the current code with the following, which adds a new column of class POSIXct.",
          "pos": [
            54,
            140
          ]
        }
      ]
    },
    {
      "pos": [
        44241,
        44291
      ],
      "content": "Now, check the log. It should look like Figure 15.",
      "nodes": [
        {
          "content": "Now, check the log.",
          "pos": [
            0,
            19
          ]
        },
        {
          "content": "It should look like Figure 15.",
          "pos": [
            20,
            50
          ]
        }
      ]
    },
    {
      "pos": [
        45340,
        45404
      ],
      "content": "<bpt id=\"p68\">*</bpt>Figure 15. Summary of the dataframe with a time series object.<ept id=\"p68\">*</ept>"
    },
    {
      "pos": [
        45406,
        45482
      ],
      "content": "We can see from the summary that the new column is in fact of class POSIXct."
    },
    {
      "pos": [
        45487,
        45522
      ],
      "content": "Exploring and transforming the data"
    },
    {
      "pos": [
        45524,
        45720
      ],
      "content": "Let's explore some of the variables in this dataset. A scatterplot matrix is a good way to produce a quick look. I am replacing the <ph id=\"ph92\">`str()`</ph><ph id=\"ph93\"/> function in the previous R code with the following line.",
      "nodes": [
        {
          "content": "Let's explore some of the variables in this dataset.",
          "pos": [
            0,
            52
          ]
        },
        {
          "content": "A scatterplot matrix is a good way to produce a quick look.",
          "pos": [
            53,
            112
          ]
        },
        {
          "content": "I am replacing the <ph id=\"ph92\">`str()`</ph><ph id=\"ph93\"/> function in the previous R code with the following line.",
          "pos": [
            113,
            230
          ]
        }
      ]
    },
    {
      "pos": [
        45872,
        45974
      ],
      "content": "Run this code and see what happens. The plot produced at the R Device port should look like Figure 16.",
      "nodes": [
        {
          "content": "Run this code and see what happens.",
          "pos": [
            0,
            35
          ]
        },
        {
          "content": "The plot produced at the R Device port should look like Figure 16.",
          "pos": [
            36,
            102
          ]
        }
      ]
    },
    {
      "pos": [
        45976,
        46023
      ],
      "content": "![Scatterplot matrix of selected variables][17]"
    },
    {
      "pos": [
        46025,
        46079
      ],
      "content": "<bpt id=\"p69\">*</bpt>Figure 16. Scatterplot matrix of selected variables.<ept id=\"p69\">*</ept>"
    },
    {
      "pos": [
        46081,
        46269
      ],
      "content": "There is some odd-looking structure in the relationships between these variables. Perhaps this arises from trends in the data and from the fact that we have not standardized the variables.",
      "nodes": [
        {
          "content": "There is some odd-looking structure in the relationships between these variables.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "Perhaps this arises from trends in the data and from the fact that we have not standardized the variables.",
          "pos": [
            82,
            188
          ]
        }
      ]
    },
    {
      "pos": [
        46274,
        46294
      ],
      "content": "Correlation analysis"
    },
    {
      "pos": [
        46296,
        46576
      ],
      "content": "To perform correlation analysis we need to both de-trend and standardize the variables. We could simply use the R <ph id=\"ph94\">`scale()`</ph><ph id=\"ph95\"/> function, which both centers and scales variables. This function might well run faster. However, I want to show you an example of defensive programing in R.",
      "nodes": [
        {
          "content": "To perform correlation analysis we need to both de-trend and standardize the variables.",
          "pos": [
            0,
            87
          ]
        },
        {
          "content": "We could simply use the R <ph id=\"ph94\">`scale()`</ph><ph id=\"ph95\"/> function, which both centers and scales variables.",
          "pos": [
            88,
            208
          ]
        },
        {
          "content": "This function might well run faster.",
          "pos": [
            209,
            245
          ]
        },
        {
          "content": "However, I want to show you an example of defensive programing in R.",
          "pos": [
            246,
            314
          ]
        }
      ]
    },
    {
      "pos": [
        46578,
        46735
      ],
      "content": "The <ph id=\"ph96\">`ts.detrend()`</ph><ph id=\"ph97\"/> function shown below performs both of these operations. The following two lines of code de-trend the data and then standardize the values.",
      "nodes": [
        {
          "content": "The <ph id=\"ph96\">`ts.detrend()`</ph><ph id=\"ph97\"/> function shown below performs both of these operations.",
          "pos": [
            0,
            108
          ]
        },
        {
          "content": "The following two lines of code de-trend the data and then standardize the values.",
          "pos": [
            109,
            191
          ]
        }
      ]
    },
    {
      "pos": [
        48991,
        49260
      ],
      "content": "There is quite a bit happening in the <ph id=\"ph98\">`ts.detrend()`</ph><ph id=\"ph99\"/> function. Most of this code is checking for potential problems with the arguments or dealing with exceptions, which can still arise during the computations. Only a few lines of this code actually do the computations.",
      "nodes": [
        {
          "content": "There is quite a bit happening in the <ph id=\"ph98\">`ts.detrend()`</ph><ph id=\"ph99\"/> function.",
          "pos": [
            0,
            96
          ]
        },
        {
          "content": "Most of this code is checking for potential problems with the arguments or dealing with exceptions, which can still arise during the computations.",
          "pos": [
            97,
            243
          ]
        },
        {
          "content": "Only a few lines of this code actually do the computations.",
          "pos": [
            244,
            303
          ]
        }
      ]
    },
    {
      "pos": [
        49262,
        49543
      ],
      "content": "We have already discussed an example of defensive programming in <bpt id=\"p70\">[</bpt>Value transformations<ept id=\"p70\">](#valuetransformations)</ept>. Both computation blocks are wrapped in <ph id=\"ph100\">`tryCatch()`</ph>. For some errors it makes sense to return the original input vector, and in other cases, I return a vector of zeros.",
      "nodes": [
        {
          "content": "We have already discussed an example of defensive programming in <bpt id=\"p70\">[</bpt>Value transformations<ept id=\"p70\">](#valuetransformations)</ept>.",
          "pos": [
            0,
            152
          ]
        },
        {
          "content": "Both computation blocks are wrapped in <ph id=\"ph100\">`tryCatch()`</ph>.",
          "pos": [
            153,
            225
          ]
        },
        {
          "content": "For some errors it makes sense to return the original input vector, and in other cases, I return a vector of zeros.",
          "pos": [
            226,
            341
          ]
        }
      ]
    },
    {
      "pos": [
        49547,
        49676
      ],
      "content": "Note that the linear regression used for de-trending is a time series regression. The predictor variable is a time series object.",
      "nodes": [
        {
          "content": "Note that the linear regression used for de-trending is a time series regression.",
          "pos": [
            0,
            81
          ]
        },
        {
          "content": "The predictor variable is a time series object.",
          "pos": [
            82,
            129
          ]
        }
      ]
    },
    {
      "pos": [
        49680,
        50010
      ],
      "content": "Once <ph id=\"ph101\">`ts.detrend()`</ph><ph id=\"ph102\"/> is defined we apply it to the variables of interest in our dataframe. We must coerce the resulting list created by <ph id=\"ph103\">`lapply()`</ph><ph id=\"ph104\"/> to data dataframe by using <ph id=\"ph105\">`as.data.frame()`</ph>. Because of defensive aspects of <ph id=\"ph106\">`ts.detrend()`</ph>, failure to process one of the variables will not prevent correct processing of the others.",
      "nodes": [
        {
          "content": "Once <ph id=\"ph101\">`ts.detrend()`</ph><ph id=\"ph102\"/> is defined we apply it to the variables of interest in our dataframe.",
          "pos": [
            0,
            125
          ]
        },
        {
          "content": "We must coerce the resulting list created by <ph id=\"ph103\">`lapply()`</ph><ph id=\"ph104\"/> to data dataframe by using <ph id=\"ph105\">`as.data.frame()`</ph>.",
          "pos": [
            126,
            283
          ]
        },
        {
          "content": "Because of defensive aspects of <ph id=\"ph106\">`ts.detrend()`</ph>, failure to process one of the variables will not prevent correct processing of the others.",
          "pos": [
            284,
            442
          ]
        }
      ]
    },
    {
      "pos": [
        50014,
        50149
      ],
      "content": "The final line of code creates a pairwise scatterplot. After running the R code, the results of the scatterplot are shown in Figure 17.",
      "nodes": [
        {
          "content": "The final line of code creates a pairwise scatterplot.",
          "pos": [
            0,
            54
          ]
        },
        {
          "content": "After running the R code, the results of the scatterplot are shown in Figure 17.",
          "pos": [
            55,
            135
          ]
        }
      ]
    },
    {
      "pos": [
        50151,
        50221
      ],
      "content": "![Pairwise scatterplot of de-trended and standardized time series][18]"
    },
    {
      "pos": [
        50223,
        50300
      ],
      "content": "<bpt id=\"p71\">*</bpt>Figure 17. Pairwise scatterplot of de-trended and standardized time series.<ept id=\"p71\">*</ept>"
    },
    {
      "pos": [
        50302,
        50489
      ],
      "content": "You can compare these results to those shown in Figure 17. With the trend removed and the variables standardized, we see a lot less structure in the relationships between these variables.",
      "nodes": [
        {
          "content": "You can compare these results to those shown in Figure 17.",
          "pos": [
            0,
            58
          ]
        },
        {
          "content": "With the trend removed and the variables standardized, we see a lot less structure in the relationships between these variables.",
          "pos": [
            59,
            187
          ]
        }
      ]
    },
    {
      "pos": [
        50491,
        50559
      ],
      "content": "The code to compute the correlations as R ccf objects is as follows."
    },
    {
      "pos": [
        51070,
        51124
      ],
      "content": "Running this code produces the log shown in Figure 18."
    },
    {
      "pos": [
        52614,
        52686
      ],
      "content": "<bpt id=\"p72\">*</bpt>Figure 18. List of ccf objects from the pairwise correlation analysis.<ept id=\"p72\">*</ept>"
    },
    {
      "pos": [
        52688,
        52871
      ],
      "content": "There is a correlation value for each lag. None of these correlation values is large enough to be significant. We can therefore conclude that we can model each variable independently.",
      "nodes": [
        {
          "content": "There is a correlation value for each lag.",
          "pos": [
            0,
            42
          ]
        },
        {
          "content": "None of these correlation values is large enough to be significant.",
          "pos": [
            43,
            110
          ]
        },
        {
          "content": "We can therefore conclude that we can model each variable independently.",
          "pos": [
            111,
            183
          ]
        }
      ]
    },
    {
      "pos": [
        52876,
        52894
      ],
      "content": "Output a dataframe"
    },
    {
      "pos": [
        52896,
        53204
      ],
      "content": "We have computed the pairwise correlations as a list of R ccf objects. This presents a bit of a problem as the Result Dataset output port really requires a dataframe. Further, the ccf object is itself a list and we want only the values in the first element of this list, the correlations at the various lags.",
      "nodes": [
        {
          "content": "We have computed the pairwise correlations as a list of R ccf objects.",
          "pos": [
            0,
            70
          ]
        },
        {
          "content": "This presents a bit of a problem as the Result Dataset output port really requires a dataframe.",
          "pos": [
            71,
            166
          ]
        },
        {
          "content": "Further, the ccf object is itself a list and we want only the values in the first element of this list, the correlations at the various lags.",
          "pos": [
            167,
            308
          ]
        }
      ]
    },
    {
      "pos": [
        53206,
        53306
      ],
      "content": "The following code extracts the lag values from the list of ccf objects, which are themselves lists."
    },
    {
      "pos": [
        54130,
        54269
      ],
      "content": "The first line of code is a bit tricky, and some explanation may help you understand it. Working from the inside out we have the following:",
      "nodes": [
        {
          "content": "The first line of code is a bit tricky, and some explanation may help you understand it.",
          "pos": [
            0,
            88
          ]
        },
        {
          "content": "Working from the inside out we have the following:",
          "pos": [
            89,
            139
          ]
        }
      ]
    },
    {
      "pos": [
        54275,
        54416
      ],
      "content": "The '<bpt id=\"p73\">**</bpt>[[<ept id=\"p73\">**</ept>' operator with the argument '<bpt id=\"p74\">**</bpt>1<ept id=\"p74\">**</ept>' selects the vector of correlations at the lags from the first element of the ccf object list."
    },
    {
      "pos": [
        54422,
        54530
      ],
      "content": "The <ph id=\"ph107\">`do.call()`</ph><ph id=\"ph108\"/> function applies the <ph id=\"ph109\">`rbind()`</ph><ph id=\"ph110\"/> function over the elements of the list returns by <ph id=\"ph111\">`lapply()`</ph>."
    },
    {
      "pos": [
        54536,
        54622
      ],
      "content": "The <ph id=\"ph112\">`data.frame()`</ph><ph id=\"ph113\"/> function coerces the result produced by <ph id=\"ph114\">`do.call()`</ph><ph id=\"ph115\"/> to a dataframe."
    },
    {
      "pos": [
        54624,
        54782
      ],
      "content": "Note that the row names are in a column of the dataframe. Doing so preserves the row names when they are output from the [Execute R Script][execute-r-script].",
      "nodes": [
        {
          "content": "Note that the row names are in a column of the dataframe.",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "Doing so preserves the row names when they are output from the [Execute R Script][execute-r-script].",
          "pos": [
            58,
            158
          ]
        }
      ]
    },
    {
      "pos": [
        54784,
        54951
      ],
      "content": "Running the code produces the output shown in Figure 19 when I <bpt id=\"p75\">**</bpt>Visualize<ept id=\"p75\">**</ept><ph id=\"ph116\"/> the output at the Result Dataset port. The row names are in the first column, as intended.",
      "nodes": [
        {
          "content": "Running the code produces the output shown in Figure 19 when I <bpt id=\"p75\">**</bpt>Visualize<ept id=\"p75\">**</ept><ph id=\"ph116\"/> the output at the Result Dataset port.",
          "pos": [
            0,
            171
          ]
        },
        {
          "content": "The row names are in the first column, as intended.",
          "pos": [
            172,
            223
          ]
        }
      ]
    },
    {
      "pos": [
        54953,
        55004
      ],
      "content": "![Results output from the correlation analysis][20]"
    },
    {
      "pos": [
        55006,
        55064
      ],
      "content": "<bpt id=\"p76\">*</bpt>Figure 19. Results output from the correlation analysis.<ept id=\"p76\">*</ept>"
    },
    {
      "pos": [
        55066,
        55068
      ],
      "content": "##"
    },
    {
      "pos": [
        55100,
        55141
      ],
      "content": "Time series example: seasonal forecasting"
    },
    {
      "pos": [
        55143,
        55421
      ],
      "content": "Our data is now in a form suitable for analysis, and we have determined there are no significant correlations between the variables. Let's move on and create a time series forecasting model. Using this model we will forecast California milk production for the 12 months of 2013.",
      "nodes": [
        {
          "content": "Our data is now in a form suitable for analysis, and we have determined there are no significant correlations between the variables.",
          "pos": [
            0,
            132
          ]
        },
        {
          "content": "Let's move on and create a time series forecasting model.",
          "pos": [
            133,
            190
          ]
        },
        {
          "content": "Using this model we will forecast California milk production for the 12 months of 2013.",
          "pos": [
            191,
            278
          ]
        }
      ]
    },
    {
      "pos": [
        55423,
        55781
      ],
      "content": "Our forecasting model will have two components, a trend component and a seasonal component. The complete forecast is the product of these two components. This type of model is known as a multiplicative model. The alternative is an additive model. We have already applied a log transformation to the variables of interest, which makes this analysis tractable.",
      "nodes": [
        {
          "content": "Our forecasting model will have two components, a trend component and a seasonal component.",
          "pos": [
            0,
            91
          ]
        },
        {
          "content": "The complete forecast is the product of these two components.",
          "pos": [
            92,
            153
          ]
        },
        {
          "content": "This type of model is known as a multiplicative model.",
          "pos": [
            154,
            208
          ]
        },
        {
          "content": "The alternative is an additive model.",
          "pos": [
            209,
            246
          ]
        },
        {
          "content": "We have already applied a log transformation to the variables of interest, which makes this analysis tractable.",
          "pos": [
            247,
            358
          ]
        }
      ]
    },
    {
      "pos": [
        55783,
        55862
      ],
      "content": "The complete R code for this section is in the zip file you downloaded earlier."
    },
    {
      "pos": [
        55868,
        55903
      ],
      "content": "Creating the dataframe for analysis"
    },
    {
      "pos": [
        55905,
        56186
      ],
      "content": "Start by adding a <bpt id=\"p77\">**</bpt>new<ept id=\"p77\">**</ept><ph id=\"ph117\"/> [Execute R Script][execute-r-script] module to your experiment. Connect the <bpt id=\"p78\">**</bpt>Result Dataset<ept id=\"p78\">**</ept><ph id=\"ph118\"/> output of the existing [Execute R Script][execute-r-script] module to the <bpt id=\"p79\">**</bpt>Dataset1<ept id=\"p79\">**</ept><ph id=\"ph119\"/> input of the new module. The result should look something like Figure 20.",
      "nodes": [
        {
          "content": "Start by adding a <bpt id=\"p77\">**</bpt>new<ept id=\"p77\">**</ept><ph id=\"ph117\"/> [Execute R Script][execute-r-script] module to your experiment.",
          "pos": [
            0,
            145
          ]
        },
        {
          "content": "Connect the <bpt id=\"p78\">**</bpt>Result Dataset<ept id=\"p78\">**</ept><ph id=\"ph118\"/> output of the existing [Execute R Script][execute-r-script] module to the <bpt id=\"p79\">**</bpt>Dataset1<ept id=\"p79\">**</ept><ph id=\"ph119\"/> input of the new module.",
          "pos": [
            146,
            400
          ]
        },
        {
          "content": "The result should look something like Figure 20.",
          "pos": [
            401,
            449
          ]
        }
      ]
    },
    {
      "pos": [
        56188,
        56252
      ],
      "content": "![The experiment with the new Execute R Script module added][21]"
    },
    {
      "pos": [
        56254,
        56325
      ],
      "content": "<bpt id=\"p80\">*</bpt>Figure 20. The experiment with the new Execute R Script module added.<ept id=\"p80\">*</ept>"
    },
    {
      "pos": [
        56327,
        56475
      ],
      "content": "As with the correlation analysis we just completed, we need to add a column with a POSIXct time series object. The following code will do just this.",
      "nodes": [
        {
          "content": "As with the correlation analysis we just completed, we need to add a column with a POSIXct time series object.",
          "pos": [
            0,
            110
          ]
        },
        {
          "content": "The following code will do just this.",
          "pos": [
            111,
            148
          ]
        }
      ]
    },
    {
      "pos": [
        56890,
        56963
      ],
      "content": "Run this code and look at the log. The result should look like Figure 21.",
      "nodes": [
        {
          "content": "Run this code and look at the log.",
          "pos": [
            0,
            34
          ]
        },
        {
          "content": "The result should look like Figure 21.",
          "pos": [
            35,
            73
          ]
        }
      ]
    },
    {
      "pos": [
        58012,
        58052
      ],
      "content": "<bpt id=\"p81\">*</bpt>Figure 21. A summary of the dataframe.<ept id=\"p81\">*</ept>"
    },
    {
      "pos": [
        58054,
        58107
      ],
      "content": "With this result, we are ready to start our analysis."
    },
    {
      "pos": [
        58112,
        58137
      ],
      "content": "Create a training dataset"
    },
    {
      "pos": [
        58139,
        58783
      ],
      "content": "With the dataframe constructed we need to create a training dataset. This data will include all of the observations except the last 12, of the year 2013, which is our test dataset. The following code subsets the dataframe and creates plots of the dairy production and price variables. I then create plots of the four production and price variables. An anonymous function is used to define some augments for plot, and then iterate over the list of the other two arguments with <ph id=\"ph120\">`Map()`</ph>. If you are thinking that a for loop would have worked fine here, you are correct. But, since R is a functional language I am showing you a functional approach.",
      "nodes": [
        {
          "content": "With the dataframe constructed we need to create a training dataset.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "This data will include all of the observations except the last 12, of the year 2013, which is our test dataset.",
          "pos": [
            69,
            180
          ]
        },
        {
          "content": "The following code subsets the dataframe and creates plots of the dairy production and price variables.",
          "pos": [
            181,
            284
          ]
        },
        {
          "content": "I then create plots of the four production and price variables.",
          "pos": [
            285,
            348
          ]
        },
        {
          "content": "An anonymous function is used to define some augments for plot, and then iterate over the list of the other two arguments with <ph id=\"ph120\">`Map()`</ph>.",
          "pos": [
            349,
            504
          ]
        },
        {
          "content": "If you are thinking that a for loop would have worked fine here, you are correct.",
          "pos": [
            505,
            586
          ]
        },
        {
          "content": "But, since R is a functional language I am showing you a functional approach.",
          "pos": [
            587,
            664
          ]
        }
      ]
    },
    {
      "pos": [
        59199,
        59394
      ],
      "content": "Running the code produces the series of time series plots from the R Device output shown in Figure 22. Note that the time axis is in units of dates, a nice benefit of the time series plot method.",
      "nodes": [
        {
          "content": "Running the code produces the series of time series plots from the R Device output shown in Figure 22.",
          "pos": [
            0,
            102
          ]
        },
        {
          "content": "Note that the time axis is in units of dates, a nice benefit of the time series plot method.",
          "pos": [
            103,
            195
          ]
        }
      ]
    },
    {
      "pos": [
        59396,
        59532
      ],
      "content": "<ph id=\"ph121\">![</ph>First of time series plots of California dairy production and price data<ph id=\"ph122\">](./media/machine-learning-r-quickstart/unnamed-chunk-161.png)</ph>"
    },
    {
      "pos": [
        59534,
        59671
      ],
      "content": "<ph id=\"ph123\">![</ph>Second of time series plots of California dairy production and price data<ph id=\"ph124\">](./media/machine-learning-r-quickstart/unnamed-chunk-162.png)</ph>"
    },
    {
      "pos": [
        59673,
        59809
      ],
      "content": "<ph id=\"ph125\">![</ph>Third of time series plots of California dairy production and price data<ph id=\"ph126\">](./media/machine-learning-r-quickstart/unnamed-chunk-163.png)</ph>"
    },
    {
      "pos": [
        59811,
        59948
      ],
      "content": "<ph id=\"ph127\">![</ph>Fourth of time series plots of California dairy production and price data<ph id=\"ph128\">](./media/machine-learning-r-quickstart/unnamed-chunk-164.png)</ph>"
    },
    {
      "pos": [
        59950,
        60027
      ],
      "content": "<bpt id=\"p82\">*</bpt>Figure 22. Time series plots of California dairy production and price data.<ept id=\"p82\">*</ept>"
    },
    {
      "pos": [
        60033,
        60046
      ],
      "content": "A trend model"
    },
    {
      "pos": [
        60048,
        60390
      ],
      "content": "Having created a time series object and having had a look at the data, let's start to construct a trend model for the California milk production data. We can do this with a time series regression. However, it is clear from the plot that we will need more than a slope and intercept to accurately model the observed trend in the training data.",
      "nodes": [
        {
          "content": "Having created a time series object and having had a look at the data, let's start to construct a trend model for the California milk production data.",
          "pos": [
            0,
            150
          ]
        },
        {
          "content": "We can do this with a time series regression.",
          "pos": [
            151,
            196
          ]
        },
        {
          "content": "However, it is clear from the plot that we will need more than a slope and intercept to accurately model the observed trend in the training data.",
          "pos": [
            197,
            342
          ]
        }
      ]
    },
    {
      "pos": [
        60392,
        60625
      ],
      "content": "Given the small scale of the data, I will build the model for trend in RStudio and then cut and paste the resulting model into Azure Machine Learning. RStudio provides an interactive environment for this type of interactive analysis.",
      "nodes": [
        {
          "content": "Given the small scale of the data, I will build the model for trend in RStudio and then cut and paste the resulting model into Azure Machine Learning.",
          "pos": [
            0,
            150
          ]
        },
        {
          "content": "RStudio provides an interactive environment for this type of interactive analysis.",
          "pos": [
            151,
            233
          ]
        }
      ]
    },
    {
      "pos": [
        60627,
        60989
      ],
      "content": "As a first attempt, I will try a polynomial regression with powers up to 3. There is a real danger of over-fitting these kinds of models. Therefore, it is best to avoid high order terms. The <ph id=\"ph129\">`I()`</ph><ph id=\"ph130\"/> function inhibits interpretation of the contents (interprets the contents 'as is') and allows you to write a literally interpreted function in a regression equation.",
      "nodes": [
        {
          "content": "As a first attempt, I will try a polynomial regression with powers up to 3.",
          "pos": [
            0,
            75
          ]
        },
        {
          "content": "There is a real danger of over-fitting these kinds of models.",
          "pos": [
            76,
            137
          ]
        },
        {
          "content": "Therefore, it is best to avoid high order terms.",
          "pos": [
            138,
            186
          ]
        },
        {
          "content": "The <ph id=\"ph129\">`I()`</ph><ph id=\"ph130\"/> function inhibits interpretation of the contents (interprets the contents 'as is') and allows you to write a literally interpreted function in a regression equation.",
          "pos": [
            187,
            398
          ]
        }
      ]
    },
    {
      "pos": [
        61108,
        61137
      ],
      "content": "This generates the following."
    },
    {
      "pos": [
        62025,
        62208
      ],
      "content": "From P values (Pr(&gt;|t|)) in this output, we can see that the squared term may not be significant. I will use the <ph id=\"ph131\">`update()`</ph><ph id=\"ph132\"/> function to modify this model by dropping the squared term.",
      "nodes": [
        {
          "content": "From P values (Pr(&gt;|t|)) in this output, we can see that the squared term may not be significant.",
          "pos": [
            0,
            100
          ]
        },
        {
          "content": "I will use the <ph id=\"ph131\">`update()`</ph><ph id=\"ph132\"/> function to modify this model by dropping the squared term.",
          "pos": [
            101,
            222
          ]
        }
      ]
    },
    {
      "pos": [
        62289,
        62318
      ],
      "content": "This generates the following."
    },
    {
      "pos": [
        63114,
        63250
      ],
      "content": "This looks better. All of the terms are significant. However, the 2e-16 value is a default value, and should not be taken too seriously.",
      "nodes": [
        {
          "content": "This looks better.",
          "pos": [
            0,
            18
          ]
        },
        {
          "content": "All of the terms are significant.",
          "pos": [
            19,
            52
          ]
        },
        {
          "content": "However, the 2e-16 value is a default value, and should not be taken too seriously.",
          "pos": [
            53,
            136
          ]
        }
      ]
    },
    {
      "pos": [
        63254,
        63559
      ],
      "content": "As a sanity test, let's make a time series plot of the California dairy production data with the trend curve shown. I have added the following code in the Azure Machine Learning [Execute R Script][execute-r-script] model (not RStudio) to create the model and make a plot. The result is shown in Figure 23.",
      "nodes": [
        {
          "content": "As a sanity test, let's make a time series plot of the California dairy production data with the trend curve shown.",
          "pos": [
            0,
            115
          ]
        },
        {
          "content": "I have added the following code in the Azure Machine Learning [Execute R Script][execute-r-script] model (not RStudio) to create the model and make a plot.",
          "pos": [
            116,
            271
          ]
        },
        {
          "content": "The result is shown in Figure 23.",
          "pos": [
            272,
            305
          ]
        }
      ]
    },
    {
      "pos": [
        63839,
        63956
      ],
      "content": "<ph id=\"ph133\">![</ph>California milk production data with trend model shown<ph id=\"ph134\">](./media/machine-learning-r-quickstart/unnamed-chunk-18.png)</ph>"
    },
    {
      "pos": [
        63958,
        64026
      ],
      "content": "<bpt id=\"p83\">*</bpt>Figure 23. California milk production data with trend model shown.<ept id=\"p83\">*</ept>"
    },
    {
      "pos": [
        64028,
        64185
      ],
      "content": "It looks like the trend model fits the data fairly well. Further, there does not seem to be evidence of over-fitting, such as odd wiggles in the model curve.",
      "nodes": [
        {
          "content": "It looks like the trend model fits the data fairly well.",
          "pos": [
            0,
            56
          ]
        },
        {
          "content": "Further, there does not seem to be evidence of over-fitting, such as odd wiggles in the model curve.",
          "pos": [
            57,
            157
          ]
        }
      ]
    },
    {
      "pos": [
        64192,
        64206
      ],
      "content": "Seasonal model"
    },
    {
      "pos": [
        64208,
        64621
      ],
      "content": "With a trend model in hand, we need to push on and include the seasonal effects. We will use the month of the year as a dummy variable in the linear model to capture the month-by-month effect. Note that when you introduce factor variables into a model, the intercept must not be computed. If you do not do this, the formula is over-specified and R will drop one of the desired factors but keep the intercept term.",
      "nodes": [
        {
          "content": "With a trend model in hand, we need to push on and include the seasonal effects.",
          "pos": [
            0,
            80
          ]
        },
        {
          "content": "We will use the month of the year as a dummy variable in the linear model to capture the month-by-month effect.",
          "pos": [
            81,
            192
          ]
        },
        {
          "content": "Note that when you introduce factor variables into a model, the intercept must not be computed.",
          "pos": [
            193,
            288
          ]
        },
        {
          "content": "If you do not do this, the formula is over-specified and R will drop one of the desired factors but keep the intercept term.",
          "pos": [
            289,
            413
          ]
        }
      ]
    },
    {
      "pos": [
        64623,
        64835
      ],
      "content": "Since we have a satisfactory trend model we can use the <ph id=\"ph135\">`update()`</ph><ph id=\"ph136\"/> function to add the new terms to the existing model. The -1 in the update formula drops the intercept term. Continuing in RStudio for the moment:",
      "nodes": [
        {
          "content": "Since we have a satisfactory trend model we can use the <ph id=\"ph135\">`update()`</ph><ph id=\"ph136\"/> function to add the new terms to the existing model.",
          "pos": [
            0,
            155
          ]
        },
        {
          "content": "The -1 in the update formula drops the intercept term.",
          "pos": [
            156,
            210
          ]
        },
        {
          "content": "Continuing in RStudio for the moment:",
          "pos": [
            211,
            248
          ]
        }
      ]
    },
    {
      "pos": [
        64911,
        64940
      ],
      "content": "This generates the following."
    },
    {
      "pos": [
        66486,
        66616
      ],
      "content": "We see that the model no longer has an intercept term and has 12 significant month factors. This is exactly what we wanted to see.",
      "nodes": [
        {
          "content": "We see that the model no longer has an intercept term and has 12 significant month factors.",
          "pos": [
            0,
            91
          ]
        },
        {
          "content": "This is exactly what we wanted to see.",
          "pos": [
            92,
            130
          ]
        }
      ]
    },
    {
      "pos": [
        66618,
        66876
      ],
      "content": "Let's make another time series plot of the California dairy production data to see how well the seasonal model is working. I have added the following code in the Azure Machine Learning [Execute R Script][execute-r-script] to create the model and make a plot.",
      "nodes": [
        {
          "content": "Let's make another time series plot of the California dairy production data to see how well the seasonal model is working.",
          "pos": [
            0,
            122
          ]
        },
        {
          "content": "I have added the following code in the Azure Machine Learning [Execute R Script][execute-r-script] to create the model and make a plot.",
          "pos": [
            123,
            258
          ]
        }
      ]
    },
    {
      "pos": [
        67170,
        67251
      ],
      "content": "Running this code in Azure Machine Learning produces the plot shown in Figure 24."
    },
    {
      "pos": [
        67253,
        67380
      ],
      "content": "<ph id=\"ph137\">![</ph>California milk production with model including seasonal effects<ph id=\"ph138\">](./media/machine-learning-r-quickstart/unnamed-chunk-20.png)</ph>"
    },
    {
      "pos": [
        67382,
        67460
      ],
      "content": "<bpt id=\"p84\">*</bpt>Figure 24. California milk production with model including seasonal effects.<ept id=\"p84\">*</ept>"
    },
    {
      "pos": [
        67462,
        67599
      ],
      "content": "The fit to the data shown in Figure 24 is rather encouraging. Both the trend and the seasonal effect (monthly variation) look reasonable.",
      "nodes": [
        {
          "content": "The fit to the data shown in Figure 24 is rather encouraging.",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "Both the trend and the seasonal effect (monthly variation) look reasonable.",
          "pos": [
            62,
            137
          ]
        }
      ]
    },
    {
      "pos": [
        67601,
        67838
      ],
      "content": "As another check on our model, let's have a look at the residuals. The following code computes the predicted values from our two models, computes the residuals for the seasonal model, and then plots these residuals for the training data.",
      "nodes": [
        {
          "content": "As another check on our model, let's have a look at the residuals.",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "The following code computes the predicted values from our two models, computes the residuals for the seasonal model, and then plots these residuals for the training data.",
          "pos": [
            67,
            237
          ]
        }
      ]
    },
    {
      "pos": [
        68166,
        68206
      ],
      "content": "The residual plot is shown in Figure 25."
    },
    {
      "pos": [
        68208,
        68324
      ],
      "content": "<ph id=\"ph139\">![</ph>Residuals of the seasonal model for the training data<ph id=\"ph140\">](./media/machine-learning-r-quickstart/unnamed-chunk-21.png)</ph>"
    },
    {
      "pos": [
        68326,
        68393
      ],
      "content": "<bpt id=\"p85\">*</bpt>Figure 25. Residuals of the seasonal model for the training data.<ept id=\"p85\">*</ept>"
    },
    {
      "pos": [
        68395,
        68563
      ],
      "content": "These residuals look reasonable. There is no particular structure, except the effect of the 2008-2009 recession, which our model does not account for particularly well.",
      "nodes": [
        {
          "content": "These residuals look reasonable.",
          "pos": [
            0,
            32
          ]
        },
        {
          "content": "There is no particular structure, except the effect of the 2008-2009 recession, which our model does not account for particularly well.",
          "pos": [
            33,
            168
          ]
        }
      ]
    },
    {
      "pos": [
        68565,
        68881
      ],
      "content": "The plot shown in Figure 25 is useful for detecting any time-dependent patterns in the residuals. The explicit approach of computing and plotting the residuals I used places the residuals in time order on the plot. If, on the other hand, I had plotted <ph id=\"ph141\">`milk.lm$residuals`</ph>, the plot would not have been in time order.",
      "nodes": [
        {
          "content": "The plot shown in Figure 25 is useful for detecting any time-dependent patterns in the residuals.",
          "pos": [
            0,
            97
          ]
        },
        {
          "content": "The explicit approach of computing and plotting the residuals I used places the residuals in time order on the plot.",
          "pos": [
            98,
            214
          ]
        },
        {
          "content": "If, on the other hand, I had plotted <ph id=\"ph141\">`milk.lm$residuals`</ph>, the plot would not have been in time order.",
          "pos": [
            215,
            336
          ]
        }
      ]
    },
    {
      "pos": [
        68883,
        68952
      ],
      "content": "You can also use <ph id=\"ph142\">`plot.lm()`</ph><ph id=\"ph143\"/> to produce a series of diagnostic plots."
    },
    {
      "pos": [
        69034,
        69101
      ],
      "content": "This code produces a series of diagnostic plots shown in Figure 26."
    },
    {
      "pos": [
        69103,
        69215
      ],
      "content": "<ph id=\"ph144\">![</ph>First of diagnostic plots for the seasonal model<ph id=\"ph145\">](./media/machine-learning-r-quickstart/unnamed-chunk-221.png)</ph>"
    },
    {
      "pos": [
        69217,
        69330
      ],
      "content": "<ph id=\"ph146\">![</ph>Second of diagnostic plots for the seasonal model<ph id=\"ph147\">](./media/machine-learning-r-quickstart/unnamed-chunk-222.png)</ph>"
    },
    {
      "pos": [
        69332,
        69444
      ],
      "content": "<ph id=\"ph148\">![</ph>Third of diagnostic plots for the seasonal model<ph id=\"ph149\">](./media/machine-learning-r-quickstart/unnamed-chunk-223.png)</ph>"
    },
    {
      "pos": [
        69446,
        69559
      ],
      "content": "<ph id=\"ph150\">![</ph>Fourth of diagnostic plots for the seasonal model<ph id=\"ph151\">](./media/machine-learning-r-quickstart/unnamed-chunk-224.png)</ph>"
    },
    {
      "pos": [
        69561,
        69614
      ],
      "content": "<bpt id=\"p86\">*</bpt>Figure 26. Diagnostic plots for the seasonal model.<ept id=\"p86\">*</ept>"
    },
    {
      "pos": [
        69616,
        69862
      ],
      "content": "There are a few highly influential points identified in these plots, but nothing to cause great concern. Further, we can see from the Normal Q-Q plot that the residuals are close to normally distributed, an important assumption for linear models.",
      "nodes": [
        {
          "content": "There are a few highly influential points identified in these plots, but nothing to cause great concern.",
          "pos": [
            0,
            104
          ]
        },
        {
          "content": "Further, we can see from the Normal Q-Q plot that the residuals are close to normally distributed, an important assumption for linear models.",
          "pos": [
            105,
            246
          ]
        }
      ]
    },
    {
      "pos": [
        69867,
        69899
      ],
      "content": "Forecasting and model evaluation"
    },
    {
      "pos": [
        69901,
        70300
      ],
      "content": "There is just one more thing to do to complete our example. We need to compute forecasts and measure the error against the actual data. Our forecast will be for the 12 months of 2013. We can compute an error measure for this forecast to the actual data that is not part of our training dataset. Additionally, we can compare performance on the 18 years of training data to the 12 months of test data.",
      "nodes": [
        {
          "content": "There is just one more thing to do to complete our example.",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "We need to compute forecasts and measure the error against the actual data.",
          "pos": [
            60,
            135
          ]
        },
        {
          "content": "Our forecast will be for the 12 months of 2013.",
          "pos": [
            136,
            183
          ]
        },
        {
          "content": "We can compute an error measure for this forecast to the actual data that is not part of our training dataset.",
          "pos": [
            184,
            294
          ]
        },
        {
          "content": "Additionally, we can compare performance on the 18 years of training data to the 12 months of test data.",
          "pos": [
            295,
            399
          ]
        }
      ]
    },
    {
      "pos": [
        70304,
        70506
      ],
      "content": "A number of metrics are used to measure the performance of time series models. In our case we will use the root mean square (RMS) error. The following function computes the RMS error between two series.",
      "nodes": [
        {
          "content": "A number of metrics are used to measure the performance of time series models.",
          "pos": [
            0,
            78
          ]
        },
        {
          "content": "In our case we will use the root mean square (RMS) error.",
          "pos": [
            79,
            136
          ]
        },
        {
          "content": "The following function computes the RMS error between two series.",
          "pos": [
            137,
            202
          ]
        }
      ]
    },
    {
      "pos": [
        72039,
        72449
      ],
      "content": "As with the <ph id=\"ph152\">`log.transform()`</ph><ph id=\"ph153\"/> function we discussed in the \"Value transformations\" section, there is quite a lot of error checking and exception recovery code in this function. The principles employed are the same. The work is done in two places wrapped in <ph id=\"ph154\">`tryCatch()`</ph>. First, the time series are exponentiated, since we have been working with the logs of the values. Second, the actual RMS error is computed.",
      "nodes": [
        {
          "content": "As with the <ph id=\"ph152\">`log.transform()`</ph><ph id=\"ph153\"/> function we discussed in the \"Value transformations\" section, there is quite a lot of error checking and exception recovery code in this function.",
          "pos": [
            0,
            212
          ]
        },
        {
          "content": "The principles employed are the same.",
          "pos": [
            213,
            250
          ]
        },
        {
          "content": "The work is done in two places wrapped in <ph id=\"ph154\">`tryCatch()`</ph>.",
          "pos": [
            251,
            326
          ]
        },
        {
          "content": "First, the time series are exponentiated, since we have been working with the logs of the values.",
          "pos": [
            327,
            424
          ]
        },
        {
          "content": "Second, the actual RMS error is computed.",
          "pos": [
            425,
            466
          ]
        }
      ]
    },
    {
      "pos": [
        72453,
        72743
      ],
      "content": "Equipped with a function to measure the RMS error, let's build and output a dataframe containing the RMS errors. We will include terms for the trend model alone and the complete model with seasonal factors. The following code does the job by using the two linear models we have constructed.",
      "nodes": [
        {
          "content": "Equipped with a function to measure the RMS error, let's build and output a dataframe containing the RMS errors.",
          "pos": [
            0,
            112
          ]
        },
        {
          "content": "We will include terms for the trend model alone and the complete model with seasonal factors.",
          "pos": [
            113,
            206
          ]
        },
        {
          "content": "The following code does the job by using the two linear models we have constructed.",
          "pos": [
            207,
            290
          ]
        }
      ]
    },
    {
      "pos": [
        73444,
        73535
      ],
      "content": "Running this code produces the output shown in Figure 27 at the Result Dataset output port."
    },
    {
      "pos": [
        73537,
        73583
      ],
      "content": "<ph id=\"ph155\">![</ph>Comparison of RMS errors for the models<ph id=\"ph156\">][26]</ph>"
    },
    {
      "pos": [
        73585,
        73638
      ],
      "content": "<bpt id=\"p87\">*</bpt>Figure 27. Comparison of RMS errors for the models.<ept id=\"p87\">*</ept>"
    },
    {
      "pos": [
        73640,
        73844
      ],
      "content": "From these results, we see that adding the seasonal factors to the model reduces the RMS error significantly. Not too surprisingly, the RMS error for the training data is a bit less than for the forecast.",
      "nodes": [
        {
          "content": "From these results, we see that adding the seasonal factors to the model reduces the RMS error significantly.",
          "pos": [
            0,
            109
          ]
        },
        {
          "content": "Not too surprisingly, the RMS error for the training data is a bit less than for the forecast.",
          "pos": [
            110,
            204
          ]
        }
      ]
    },
    {
      "pos": [
        73846,
        73848
      ],
      "content": "##"
    },
    {
      "pos": [
        73870,
        73898
      ],
      "content": "APPENDIX A: Guide to RStudio"
    },
    {
      "pos": [
        73900,
        74048
      ],
      "content": "RStudio is quite well documented, so in this appendix I will provide some links to the key sections of the RStudio documentation to get you started."
    },
    {
      "pos": [
        74054,
        74071
      ],
      "content": "Creating projects"
    },
    {
      "pos": [
        74077,
        74267
      ],
      "content": "You can organize and manage your R code into projects by using RStudio. The documentation that uses projects can be found at https://support.rstudio.com/hc/articles/200526207-Using-Projects.",
      "nodes": [
        {
          "content": "You can organize and manage your R code into projects by using RStudio.",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "The documentation that uses projects can be found at https://support.rstudio.com/hc/articles/200526207-Using-Projects.",
          "pos": [
            72,
            190
          ]
        }
      ]
    },
    {
      "pos": [
        74273,
        74380
      ],
      "content": "I recommend that you follow these directions and create a project for the R code examples in this document."
    },
    {
      "pos": [
        74388,
        74416
      ],
      "content": "Editing and executing R code"
    },
    {
      "pos": [
        74422,
        74606
      ],
      "content": "RStudio provides an integrated environment for editing and executing R code. Documentation can be found at https://support.rstudio.com/hc/articles/200484448-Editing-and-Executing-Code.",
      "nodes": [
        {
          "content": "RStudio provides an integrated environment for editing and executing R code.",
          "pos": [
            0,
            76
          ]
        },
        {
          "content": "Documentation can be found at https://support.rstudio.com/hc/articles/200484448-Editing-and-Executing-Code.",
          "pos": [
            77,
            184
          ]
        }
      ]
    },
    {
      "pos": [
        74612,
        74621
      ],
      "content": "Debugging"
    },
    {
      "pos": [
        74627,
        74789
      ],
      "content": "RStudio includes powerful debugging capabilities. Documentation for these features is at https://support.rstudio.com/hc/articles/200713843-Debugging-with-RStudio.",
      "nodes": [
        {
          "content": "RStudio includes powerful debugging capabilities.",
          "pos": [
            0,
            49
          ]
        },
        {
          "content": "Documentation for these features is at https://support.rstudio.com/hc/articles/200713843-Debugging-with-RStudio.",
          "pos": [
            50,
            162
          ]
        }
      ]
    },
    {
      "pos": [
        74795,
        74930
      ],
      "content": "The breakpoint troubleshooting features are documented at https://support.rstudio.com/hc/articles/200534337-Breakpoint-Troubleshooting."
    },
    {
      "pos": [
        74932,
        74934
      ],
      "content": "##"
    },
    {
      "pos": [
        74956,
        74983
      ],
      "content": "APPENDIX B: Further reading"
    },
    {
      "pos": [
        74985,
        75178
      ],
      "content": "This R programming tutorial covers the basics of what you need to use the R language with Azure Machine Learning Studio. If you are not familiar with R, two introductions are available on CRAN:",
      "nodes": [
        {
          "content": "This R programming tutorial covers the basics of what you need to use the R language with Azure Machine Learning Studio.",
          "pos": [
            0,
            120
          ]
        },
        {
          "content": "If you are not familiar with R, two introductions are available on CRAN:",
          "pos": [
            121,
            193
          ]
        }
      ]
    },
    {
      "pos": [
        75182,
        75307
      ],
      "content": "R for Beginners by Emmanuel Paradis is a good place to start at http://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf."
    },
    {
      "pos": [
        75313,
        75442
      ],
      "content": "An Introduction to R by W. N. Venables et. al. goes into a bit more depth, at http://cran.r-project.org/doc/manuals/R-intro.html.",
      "nodes": [
        {
          "content": "An Introduction to R by W. N.",
          "pos": [
            0,
            29
          ]
        },
        {
          "content": "Venables et.",
          "pos": [
            30,
            42
          ]
        },
        {
          "content": "al.",
          "pos": [
            43,
            46
          ]
        },
        {
          "content": "goes into a bit more depth, at http://cran.r-project.org/doc/manuals/R-intro.html.",
          "pos": [
            47,
            129
          ]
        }
      ]
    },
    {
      "pos": [
        75444,
        75530
      ],
      "content": "There are many books on R that can help you get started. Here are a few I find useful:",
      "nodes": [
        {
          "content": "There are many books on R that can help you get started.",
          "pos": [
            0,
            56
          ]
        },
        {
          "content": "Here are a few I find useful:",
          "pos": [
            57,
            86
          ]
        }
      ]
    },
    {
      "pos": [
        75534,
        75665
      ],
      "content": "The Art of R Programming: A Tour of Statistical Software Design by Norman Matloff is an excellent introduction to programming in R."
    },
    {
      "pos": [
        75671,
        75749
      ],
      "content": "R Cookbook by Paul Teetor provides a problem and solution approach to using R."
    },
    {
      "pos": [
        75755,
        75905
      ],
      "content": "R in Action by Robert Kabacoff is another useful introductory book. The companion Quick R website is a useful resource at http://www.statmethods.net/.",
      "nodes": [
        {
          "content": "R in Action by Robert Kabacoff is another useful introductory book.",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "The companion Quick R website is a useful resource at http://www.statmethods.net/.",
          "pos": [
            68,
            150
          ]
        }
      ]
    },
    {
      "pos": [
        75909,
        76162
      ],
      "content": "R Inferno by Patrick Burns is a surprisingly humorous book that deals with a number of tricky and difficult topics that can be encountered when programming in R. The book is available for free at http://www.burns-stat.com/documents/books/the-r-inferno/."
    },
    {
      "pos": [
        76166,
        76352
      ],
      "content": "If you want a deep dive into advanced topics in R, have a look at the book Advanced R by Hadley Wickham. The online version of this book is available for free at http://adv-r.had.co.nz/.",
      "nodes": [
        {
          "content": "If you want a deep dive into advanced topics in R, have a look at the book Advanced R by Hadley Wickham.",
          "pos": [
            0,
            104
          ]
        },
        {
          "content": "The online version of this book is available for free at http://adv-r.had.co.nz/.",
          "pos": [
            105,
            186
          ]
        }
      ]
    },
    {
      "pos": [
        76354,
        76618
      ],
      "content": "A catalogue of R time series packages can be found in the CRAN Task View for time series analysis: http://cran.r-project.org/web/views/TimeSeries.html. For information on specific time series object packages, you should refer to the documentation for that package.",
      "nodes": [
        {
          "content": "A catalogue of R time series packages can be found in the CRAN Task View for time series analysis: http://cran.r-project.org/web/views/TimeSeries.html.",
          "pos": [
            0,
            151
          ]
        },
        {
          "content": "For information on specific time series object packages, you should refer to the documentation for that package.",
          "pos": [
            152,
            264
          ]
        }
      ]
    },
    {
      "pos": [
        76620,
        76810
      ],
      "content": "The book Introductory Time Series with R by Paul Cowpertwait and Andrew Metcalfe provides an introduction to using R for time series analysis. Many more theoretical texts provide R examples.",
      "nodes": [
        {
          "content": "The book Introductory Time Series with R by Paul Cowpertwait and Andrew Metcalfe provides an introduction to using R for time series analysis.",
          "pos": [
            0,
            142
          ]
        },
        {
          "content": "Many more theoretical texts provide R examples.",
          "pos": [
            143,
            190
          ]
        }
      ]
    },
    {
      "pos": [
        76812,
        76842
      ],
      "content": "Some great internet resources:"
    },
    {
      "pos": [
        76846,
        77110
      ],
      "content": "DataCamp: DataCamp teaches R in the comfort of your browser with video lessons and coding exercises. There are interactive tutorials on the latest R techniques and packages. Take the free interactive R tutorial at https://www.datacamp.com/courses/introduction-to-r",
      "nodes": [
        {
          "content": "DataCamp: DataCamp teaches R in the comfort of your browser with video lessons and coding exercises.",
          "pos": [
            0,
            100
          ]
        },
        {
          "content": "There are interactive tutorials on the latest R techniques and packages.",
          "pos": [
            101,
            173
          ]
        },
        {
          "content": "Take the free interactive R tutorial at https://www.datacamp.com/courses/introduction-to-r",
          "pos": [
            174,
            264
          ]
        }
      ]
    },
    {
      "pos": [
        77116,
        77210
      ],
      "content": "A quick R tutorial by Kelly Black from Clarkson University http://www.cyclismo.org/tutorial/R/"
    },
    {
      "pos": [
        77214,
        77354
      ],
      "content": "60+ R resources listed at http://www.computerworld.com/article/2497464/business-intelligence-60-r-resources-to-improve-your-data-skills.html"
    },
    {
      "pos": [
        77380,
        78549
      ],
      "content": "[1]: ./media/machine-learning-r-quickstart/fig1.png\n[2]: ./media/machine-learning-r-quickstart/fig2.png\n[3]: ./media/machine-learning-r-quickstart/fig3.png\n[4]: ./media/machine-learning-r-quickstart/fig4.png\n[5]: ./media/machine-learning-r-quickstart/fig5.png\n[6]: ./media/machine-learning-r-quickstart/fig6.png\n[7]: ./media/machine-learning-r-quickstart/fig7.png\n[8]: ./media/machine-learning-r-quickstart/fig8.png\n[9]: ./media/machine-learning-r-quickstart/fig9.png\n[10]: ./media/machine-learning-r-quickstart/fig10.png\n[11]: ./media/machine-learning-r-quickstart/fig11.png\n[12]: ./media/machine-learning-r-quickstart/fig12.png\n[13]: ./media/machine-learning-r-quickstart/fig13.png\n[14]: ./media/machine-learning-r-quickstart/fig14.png\n[15]: ./media/machine-learning-r-quickstart/fig15.png\n[16]: ./media/machine-learning-r-quickstart/fig16.png\n[17]: ./media/machine-learning-r-quickstart/fig17.png\n[18]: ./media/machine-learning-r-quickstart/fig18.png\n[19]: ./media/machine-learning-r-quickstart/fig19.png\n[20]: ./media/machine-learning-r-quickstart/fig20.png\n[21]: ./media/machine-learning-r-quickstart/fig21.png\n[22]: ./media/machine-learning-r-quickstart/fig22.png"
    },
    {
      "pos": [
        78619,
        78729
      ],
      "content": "[appendixa]: #appendixa\n[download]: https://azurebigdatatutorials.blob.core.windows.net/rquickstart/RFiles.zip"
    },
    {
      "pos": [
        78759,
        78857
      ],
      "content": "[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/"
    }
  ],
  "content": "<properties\n    pageTitle=\"Quickstart tutorial for R language for Machine Learning | Microsoft Azure\"\n    description=\"Use this R programming tutorial to get started quickly using the R language with Azure Machine Learning Studio to create a forecasting solution.\"\n    keywords=\"quickstart,r language,r programming language,r programming tutorial\"\n    services=\"machine-learning\"\n    documentationCenter=\"\"\n    authors=\"Blackmist\"\n    manager=\"paulettm\"\n    editor=\"cgronlun\"/>\n\n<tags\n    ms.service=\"machine-learning\"\n    ms.workload=\"data-services\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"02/04/2016\"\n    ms.author=\"larryfr\"/>\n\n# Quickstart tutorial for the R programming language for Azure Machine Learning\n\nStephen F Elston, Ph.D.\n\n##  Introduction\n\nThis quickstart tutorial helps you quickly start extending Azure Machine Learning by using the R programming language. Follow this R programming tutorial to create, test and execute R code within Azure Machine Learning. As you work through tutorial, you will create a complete forecasting solution by using the R language in Azure Machine Learning.  \n\nMicrosoft Azure Machine Learning contains many powerful machine learning and data manipulation modules. The powerful R language has been described as the lingua franca of analytics. Happily, analytics and data manipulation in Azure Machine Learning can be extended by using R. This combination provides the scalability and ease of deployment of Azure Machine Learning with the flexibility and deep analytics of R.\n\n[AZURE.INCLUDE [machine-learning-free-trial](../../includes/machine-learning-free-trial.md)]\n\n\n###Forecasting and the dataset\n\nForecasting is a widely employed and quite useful analytical method. Common uses range from predicting sales of seasonal items, determining optimal inventory levels, to predicting macroeconomic variables. Forecasting is typically done with time series models.\n\nTime series data is data in which the values have a time index. The time index can be regular, e.g. every month or every minute, or irregular. A time series model is based on time series data. The R programming language contains a flexible framework and extensive analytics for time series data.\n\nIn this quickstart guide we will be working with California dairy production and pricing data. This data includes monthly information on the production of several dairy products and the price of milk fat, a benchmark commodity.\n\nThe data used in this article, along with R scripts, can be [downloaded here][download]. This data was originally synthesized from information available from the University of Wisconsin at http://future.aae.wisc.edu/tab/production.html.\n\n### Organization\n\nWe will progress through several steps as you learn how to create, test and execute analytics and data manipulation R code in the Azure Machine Learning environment.  \n\n* First we will explore the basics of using the R language in the Azure Machine Learning Studio environment.\n\n* Then we progress to discussing various aspects of I/O for data, R code and graphics in the Azure Machine Learning environment.\n\n* We will then construct the first part of our forecasting solution by creating code for data cleaning and transformation.\n\n* With our data prepared we will perform an analysis of the correlations between several of the variables in our dataset.\n\n* Finally, we will create a seasonal time series forecasting model for milk production.\n\n##<a id=\"mlstudio\"></a>Interact with R language in Machine Learning Studio\n\nThis section takes you through some basics of interacting with the R programming language in the Machine Learning Studio environment. The R language provides a powerful tool to create customized analytics and data manipulation modules within the Azure Machine Learning environment.\n\nI will use RStudio to develop, test and debug R code on a small scale. This code is then cut and paste into an [Execute R Script][execute-r-script] module in Machine Learning Studio ready to run.  \n\n###The Execute R Script module\n\nWithin Machine Learning Studio, R scripts are run within the [Execute R Script][execute-r-script] module. An example of the [Execute R Script][execute-r-script] module in Machine Learning Studio is shown in Figure 1.\n\n ![R programming language: The Execute R Script module selected in Machine Learning Studio][1]\n\n*Figure 1. The Machine Learning Studio environment showing the Execute R Script module selected.*\n\nReferring to Figure 1, let's look at some of the key parts of the Machine Learning Studio environment for working with the [Execute R Script][execute-r-script] module.\n\n- The modules in the experiment are shown in the center pane.\n\n- The upper part of the right pane contains a window to view and edit your R scripts.  \n\n- The lower part of right pane shows some properties of the [Execute R Script][execute-r-script]. You can view the error and output logs by clicking on the appropriate spots of this pane.\n\nWe will, of course, be discussing the [Execute R Script][execute-r-script] in greater detail in the rest of this document.\n\nWhen working with complex R functions, I recommend that you edit, test and debug in RStudio. As with any software development, extend your code incrementally and test it on small simple test cases. Then cut and paste your functions into the R script window of the [Execute R Script][execute-r-script] module. This approach allows you to harness both the RStudio integrated development environment (IDE) and the power of Azure Machine Learning.  \n\n####Execute R code\n\nAny R code in the [Execute R Script][execute-r-script] module will execute when you run the experiment by clicking on the **Run** button. When execution has completed, a check mark will appear on the [Execute R Script][execute-r-script] icon.\n\n####Defensive R coding for Azure Machine Learning\n\nIf you are developing R code for, say, a web service by using Azure Machine Learning, you should definitely plan how your code will deal with an unexpected data input and exceptions. To maintain clarity, I have not included much in the way of checking or exception handling in most of the code examples shown. However, as we proceed I will give you several examples of functions by using R's exception handling capability.  \n\nIf you need a more complete treatment of R exception handling, I recommend you read the applicable sections of the book by Wickham listed in [Appendix B - Further Reading](#appendixb).\n\n\n####Debug and test R in Machine Learning Studio\n\nTo reiterate, I recommend you test and debug your R code on a small scale in RStudio. However, there are cases where you will need to track down R code problems in the [Execute R Script][execute-r-script] itself. In addition, it is good practice to check your results in Machine Learning Studio.\n\nOutput from the execution of your R code and on the Azure Machine Learning platform is found primarily in output.log. Some additional information will be seen in error.log.  \n\nIf an error occurs in Machine Learning Studio while running your R code, your first course of action should be to look at error.log. This file can contain useful error messages to help you understand and correct your error. To view error.log, click on **View error log** on the **properties pane** for the [Execute R Script][execute-r-script] containing the error.\n\nFor example, I ran the following R code, with an undefined variable y, in an [Execute R Script][execute-r-script] module:\n\n    x <- 1.0\n    z <- x + y\n\nThis code fails to execute, resulting in an error condition. Clicking on **View error log** on the **properties pane** produces the display shown in Figure 2.\n\n  ![Error message pop up][2]\n\n*Figure 2. Error message pop-up.*\n\nIt looks like we need to look in output.log to see the R error message. Click on the [Execute R Script][execute-r-script] and then click on the **View output.log** item on the **properties pane** to the right. A new browser window opens, and I see the following.\n\n\n    [Critical]     Error: Error 0063: The following error occurred during evaluation of R script:\n    ---------- Start of error message from R ----------\n    object 'y' not found\n    \n    \n    object 'y' not found\n    ----------- End of error message from R -----------\n\nThis error message contains no surprises and clearly identifies the problem.\n\nTo inspect the value of any object in R, you can print these values to the output.log file. The rules for examining object values are essentially the same as in an interactive R session. For example, if you type a variable name on a line, the value of the object will be printed to the output.log file.  \n\n####Packages in Machine Learning Studio\n\nAzure Machine Learning comes with over 350 preinstalled R language packages. You can use the following code in the [Execute R Script][execute-r-script] module to retrieve a list of the preinstalled packages.\n\n    data.set <- data.frame(installed.packages())\n    maml.mapOutputPort(\"data.set\")\n\nIf you don't understand the last line of this code at the moment, read on. In the rest of this document we will extensively discuss using R in the Azure Machine Learning environment.\n\n### Introduction to RStudio\n\nRStudio is a widely used IDE for R. I will use RStudio for editing, testing and debugging some of the R code used in this quick start guide. Once R code is tested and ready, you simply cut and paste from the RStudio editor into a Machine Learning Studio [Execute R Script][execute-r-script] module.  \n\nIf you do not have the R programming language installed on your desktop machine, I recommend you do so now. Free downloads of open source R language are available at the Comprehensive R Archive Network (CRAN) at [http://www.r-project.org/](http://www.r-project.org/). There are downloads available for Windows, Mac OS, and Linux/UNIX. Choose a nearby mirror and follow the download directions. In addition, CRAN contains a wealth of useful analytics and data manipulation packages.\n\nIf you are new to RStudio, you should download and install the desktop version. You can find the RStudio downloads for Windows, Mac OS, and Linux/UNIX at http://www.rstudio.com/products/RStudio/. Follow the directions provided to install RStudio on your desktop machine.  \n\nA tutorial introduction to RStudio is available at https://support.rstudio.com/hc/sections/200107586-Using-RStudio.\n\nI provide some additional information on using RStudio in [Appendix A][appendixa].  \n\n##<a id=\"scriptmodule\"></a>Get data in and out of the Execute R Script module\n\nIn this section we will discuss how you get data into and out of the [Execute R Script][execute-r-script] module. We will review how to handle various data types read into and out of the [Execute R Script][execute-r-script] module.\n\nThe complete code for this section is in the zip file you downloaded earlier.\n\n###Load and check data in Machine Learning Studio\n\n####<a id=\"loading\"></a>Load the dataset\n\nWe will start by loading the **csdairydata.csv** file into Azure Machine Learning Studio.\n\n- Start your Azure Machine Learning Studio environment.\n\n- Click on __+ NEW__ at the lower left of your screen and select **Dataset**.\n\n- Select **From Local File**, and then **Browse** to select the file.\n\n- Make sure you have selected **Generic CSV file with header (.csv)** as the type for the dataset.\n\n- Click the check mark.\n\n- After the dataset has been uploaded, you should see the new dataset by clicking on the **Datasets** tab.  \n\n####Create an experiment\n\nNow that we have some data in Machine Learning Studio, we need to create an experiment to do the analysis.  \n\n- Click on __+ NEW__ at the lower left and select **Experiment**, then **Blank Experiment**.\n\n- You can name your experiment by selecting, and modifying, the **Experiment created on ...** title at the top of the page. For example, changing it to **CA Dairy Analysis**.\n\n- On the left of the experiment page, expand **Saved Datasets**, and then **My Datasets**. You should see the **cadairydata.csv** that you uploaded earlier.\n\n- Drag and drop the **csdairydata.csv dataset** onto the experiment.\n\n- In the **Search experiment items** box on the top of the left pane, type [Execute R Script][execute-r-script]. You will see the module appear in the search list.\n\n- Drag and drop the [Execute R Script][execute-r-script] module onto your pallet.  \n\n- Connect the output of the **csdairydata.csv dataset** to the leftmost input (**Dataset1**) of the [Execute R Script][execute-r-script].\n\n- **Don't forget to click on 'Save'!**  \n\nAt this point your experiment should look something like Figure 3.\n\n![The CA Dairy Analysis experiment with dataset and Execute R Script module][3]\n\n*Figure 3. The CA Dairy Analysis experiment with dataset and Execute R Script module.*\n\n####Check on the data\n\nLet's have a look at the data we have loaded into our experiment. In the experiment, click on the output of the **cadairydata.csv dataset** and select **visualize**. You should see something like Figure 4.  \n\n![Summary of the cadairydata.csv dataset][4]\n\n*Figure 4. Summary of the cadairydata.csv dataset.*\n\nIn this view we see a lot of useful information. We can see the first several rows of that dataset. If we select a column, the Statistics section shows more information about the column. For example, the Feature Type row shows us what data types Azure Machine Learning Studio assigned to the column. Having a quick look like this is a good sanity check before we start to do any serious work.\n\n### First R script\n\nLet's create a simple first R script to experiment with in Azure Machine Learning Studio. I have created and tested the following script in RStudio.  \n\n    ## Only one of the following two lines should be used\n    ## If running in Machine Learning Studio, use the first line with maml.mapInputPort()\n    ## If in RStudio, use the second line with read.csv()\n    cadairydata <- maml.mapInputPort(1)\n    # cadairydata  <- read.csv(\"cadairydata.csv\", header = TRUE, stringsAsFactors = FALSE)\n    str(cadairydata)\n    pairs(~ Cotagecheese.Prod + Icecream.Prod + Milk.Prod + N.CA.Fat.Price, data = cadairydata)\n    ## The following line should be executed only when running in\n    ## Azure Machine Learning Studio\n    maml.mapOutputPort('cadairydata')\n\nNow I need to transfer this script to Azure Machine Learning Studio. I could simply cut and paste. However, in this case, I will transfer my R script via a zip file.\n\n### Data input to the Execute R Script module\n\nLet's have a look at the inputs to the [Execute R Script][execute-r-script] module. In this example we will read the California dairy data into the [Execute R Script][execute-r-script] module.  \n\nThere are three possible inputs for the [Execute R Script][execute-r-script] module. You may use any one or all of these inputs, depending on your application. It is also perfectly reasonable to use an R script that takes no input at all.  \n\nLet's look at each of these inputs, going from left to right. You can see the names of each of the inputs by placing your cursor over the input and reading the tooltip.  \n\n#### Script Bundle\n\nThe Script Bundle input allows you to pass the contents of a zip file into [Execute R Script][execute-r-script] module. You can use one of the following commands to read the contents of the zip file into your R code.\n\n    source(\"src/yourfile.R\") # Reads a zipped R script\n    load(\"src/yourData.rdata\") # Reads a zipped R data file\n\n> [AZURE.NOTE] Azure Machine Learning treats files in the zip as if they are in the src/ directory, so you need to prefix your file names with this directory name. For example, if the zip contains the files `yourfile.R` and `yourData.rdata` in the root of the zip, you would address these as `src/yourfile.R` and `src/yourData.rdata` when using `source` and `load`.\n\nWe already discussed loading datasets in [Loading the dataset](#loading). Once you have created and tested the R script shown in the previous section, do the following:\n\n1. Save the R script into a .R file. I call my script file \"simpleplot.R\". Here's the contents.\n\n        ## Only one of the following two lines should be used\n        ## If running in Machine Learning Studio, use the first line with maml.mapInputPort()\n        ## If in RStudio, use the second line with read.csv()\n        cadairydata <- maml.mapInputPort(1)\n        # cadairydata  <- read.csv(\"cadairydata.csv\", header = TRUE, stringsAsFactors = FALSE)\n        str(cadairydata)\n        pairs(~ Cotagecheese.Prod + Icecream.Prod + Milk.Prod + N.CA.Fat.Price, data = cadairydata)\n        ## The following line should be executed only when running in\n        ## Azure Machine Learning Studio\n        maml.mapOutputPort('cadairydata')\n\n2.  Create a zip file and copy your script into this zip file. On Windows, you can right-click on the file and select __Send to__, and then __Compressed folder__. This will create a new zip file containing the \"simpleplot.R\" file.\n\n3.  Add your file to the **datasets** in Machine Learning Studio, specifying the type as **zip**. You should now see the zip file in your datasets.\n\n4.  Drag and drop the zip file from **datasets** onto the **ML Studio canvas**.\n\n5.  Connect the output of the **zip data** icon to the **Script Bundle** input of the [Execute R Script][execute-r-script] module.\n\n6.  Type the `source()` function with your zip file name into the code window for the [Execute R Script][execute-r-script] module. In my case I typed `source(\"src/simpleplot.R\")`.  \n\n7.  Make sure you click **Save**.\n\nOnce these steps are complete, the [Execute R Script][execute-r-script] module will execute the R script in the zip file when the experiment is run. At this point your experiment should look something like Figure 5.\n\n![Experiment using zipped R script][6]\n\n*Figure 5. Experiment using zipped R script.*\n\n#### Dataset1\n\nYou can pass a rectangular table of data to your R code by using the Dataset1 input. In our simple script the `maml.mapInputPort(1)` function reads the data from port 1. This data is then assigned to a dataframe variable name in your code. In our simple script the first line of code performs the assignment.\n\n    cadairydata <- maml.mapInputPort(1)\n\nExecute your experiment by clicking on the **Run** button. When the execution finishes, click on the [Execute R Script][execute-r-script] module and then click **View output log** on the properties pane. A new page should appear in your browser showing the contents of the output.log file. When you scroll down you should see something like the following.\n\n    [ModuleOutput] InputDataStructure\n    [ModuleOutput]\n    [ModuleOutput] {\n    [ModuleOutput]  \"InputName\":Dataset1\n    [ModuleOutput]  \"Rows\":228\n    [ModuleOutput]  \"Cols\":9\n    [ModuleOutput]  \"ColumnTypes\":System.Int32,3,System.Double,5,System.String,1\n    [ModuleOutput] }\n\nFarther down the page is more detailed information on the columns, which will look something like the following.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput]\n    [ModuleOutput] 'data.frame':    228 obs. of  9 variables:\n    [ModuleOutput]\n    [ModuleOutput]  $ Column 0         : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Year.Month       : num  1995 1995 1995 1995 1995 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Month            : chr  \"Jan\" \"Feb\" \"Mar\" \"Apr\" ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Cotagecheese.Prod: num  4.37 3.69 4.54 4.28 4.47 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Icecream.Prod    : num  51.6 56.1 68.5 65.7 73.7 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ Milk.Prod        : num  2.11 1.93 2.16 2.13 2.23 ...\n    [ModuleOutput]\n    [ModuleOutput]  $ N.CA.Fat.Price   : num  0.98 0.892 0.892 0.897 0.897 ...\n\nThese results are mostly as expected, with 228 observations and 9 columns in the dataframe. We can see the column names, the R data type and a sample of each column.\n\n> [AZURE.NOTE] This same printed output is conveniently available from the R Device output of the [Execute R Script][execute-r-script] module. We will discuss the outputs of the [Execute R Script][execute-r-script] module in the next section.  \n\n####Dataset2\n\nThe behavior of the Dataset2 input is identical to that of Dataset1. Using this input you can pass a second rectangular table of data into your R code. The function `maml.mapInputPort(2)`, with the argument 2, is used to pass this data.  \n\n###Execute R Script outputs\n\n####Output a dataframe\n\nYou can output the contents of an R dataframe as a rectangular table through the Result Dataset1 port by using the `maml.mapOutputPort()` function. In our simple R script this is performed by the following line.\n\n    maml.mapOutputPort('cadairydata')\n\nAfter running the experiment, click on the Result Dataset1 output port and then click on **Visualize**. You should see something like Figure 6.\n\n![The visualization of the output of the California dairy data][7]\n\n*Figure 6. The visualization of the output of the California dairy data.*\n\nThis output looks identical to the input, exactly as we expected.  \n\n### R Device output\n\nThe Device output of the [Execute R Script][execute-r-script] module contains messages and graphics output. Both standard output and standard error messages from R are sent to the R Device output port.  \n\nTo view the R Device output, click on the port and then on **Visualize**. We see the standard output and standard error from the R script in Figure 7.\n\n![Standard output and standard error from the R Device port][8]\n\n*Figure 7. Standard output and standard error from the R Device port.*\n\nScrolling down we see the graphics output from our R script in Figure 8.  \n\n![Graphics output from the R Device port][9]\n\n*Figure 8. Graphics output from the R Device port.*  \n\n##<a id=\"filtering\"></a>Data filtering and transformation\n\nIn this section we will perform some basic data filtering and transformation operations on the California dairy data. By the end of this section we will have data in a format suitable for building an analytic model.  \n\nMore specifically, in this section we will perform several common data cleaning and transformation tasks: type transformation, filtering on dataframes, adding new computed columns, and value transformations. This background should help you deal with the many variations encountered in real-world problems.\n\nThe complete R code for this section is available in the zip file you downloaded earlier.\n\n### Type transformations\n\nNow that we can read the California dairy data into the R code in the [Execute R Script][execute-r-script] module, we need to ensure that the data in the columns has the intended type and format.  \n\nR is a dynamically typed language, which means that data types are coerced from one to another as required. The atomic data types in R include numeric, logical and character. The factor type is used to compactly store categorical data. You can find much more information on data types in the references in [Appendix B - Further reading](#appendixb).\n\nWhen tabular data is read into R from an external source, it is always a good idea to check the resulting types in the columns. You may want a column of type character, but in many cases this will show up as factor or vice versa. In other cases a column you think should be numeric is represented by character data, e.g. '1.23' rather than 1.23 as a floating point number.  \n\nFortunately, it is easy to convert one type to another, as long as mapping is possible. For example, you cannot convert 'Nevada' into a numeric value, but you can convert it to a factor (categorical variable). As another example, you can convert a numeric 1 into a character '1' or a factor.  \n\nThe syntax for any of these conversions is simple: `as.datatype()`. These type conversion functions include the following.\n\n* `as.numeric()`\n\n* `as.character()`\n\n* `as.logical()`\n\n* `as.factor()`\n\nLooking at the data types of the columns we input in the previous section: all columns are of type numeric, except for the column labeled 'Month', which is of type character. Let's convert this to a factor and test the results.  \n\nI have deleted the line that created the scatterplot matrix and added a line converting the 'Month' column to a factor. In my experiment I will just cut and paste the R code into the code window of the [Execute R Script][execute-r-script] Module. You could also update the zip file and upload it to Azure Machine Learning Studio, but this takes several steps.  \n\n    ## Only one of the following two lines should be used\n    ## If running in Machine Learning Studio, use the first line with maml.mapInputPort()\n    ## If in RStudio, use the second line with read.csv()\n    cadairydata <- maml.mapInputPort(1)\n    # cadairydata  <- read.csv(\"cadairydata.csv\", header = TRUE, stringsAsFactors = FALSE)\n    ## Ensure the coding is consistent and convert column to a factor\n    cadairydata$Month <- as.factor(cadairydata$Month)\n    str(cadairydata) # Check the result\n    ## The following line should be executed only when running in\n    ## Azure Machine Learning Studio\n    maml.mapOutputPort('cadairydata')\n\nLet's execute this code and look at the output log for the R script. The relevant data from the log is shown in Figure 9.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  9 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Column 0         : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year.Month       : num  1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 14 levels \"Apr\",\"April\",..: 6 5 9 1 11 8 7 3 14 13 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  4.37 3.69 4.54 4.28 4.47 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  51.6 56.1 68.5 65.7 73.7 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  2.11 1.93 2.16 2.13 2.23 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  0.98 0.892 0.892 0.897 0.897 ...\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving variable  cadairydata  ...\"\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving the following item(s):  .maml.oport1\"\n\n*Figure 9. Summary of the dataframe with a factor variable.*\n\nThe type for Month should now say '**Factor w/ 14 levels**'. This is a problem since there are only 12 months in the year. You can also check to see that the type in **Visualize** of the Result Dataset port is '**Categorical**'.\n\nThe problem is that the 'Month' column has not been coded systematically. In some cases a month is called April and in others it is abbreviated as Apr. We can solve this problem by trimming the string to 3 characters. The line of code now looks like the following:\n\n    ## Ensure the coding is consistent and convert column to a factor\n    cadairydata$Month <- as.factor(substr(cadairydata$Month, 1, 3))\n\nRerun the experiment and view the output log. The expected results are shown in Figure 10.  \n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  9 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Column 0         : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year.Month       : num  1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  4.37 3.69 4.54 4.28 4.47 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  51.6 56.1 68.5 65.7 73.7 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  2.11 1.93 2.16 2.13 2.23 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  0.98 0.892 0.892 0.897 0.897 ...\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving variable  cadairydata  ...\"\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving the following item(s):  .maml.oport1\"\n\n*Figure 10. Summary of the dataframe with correct number of factor levels.*\n\nOur factor variable now has the desired 12 levels.\n\n###Basic data frame filtering\n\nR dataframes support powerful filtering capabilities. Datasets can be subsetted by using logical filters on either rows or columns. In many cases, complex filter criteria will be required. The references in [Appendix B - Further reading](#appendixb) contain extensive examples of filtering dataframes.  \n\nThere is one bit of filtering we should do on our dataset. If you look at the columns in the cadairydata dataframe, you will see two unnecessary columns. The first column just holds a row number, which is not very useful. The second column, Year.Month, contains redundant information. We can easily exclude these columns by using the following R code.\n\n> [AZURE.NOTE] From now on in this section, I will just show you the additional code I am adding in the [Execute R Script][execute-r-script] module. I will add each new line **before** the `str()` function. I use this function to verify my results in Azure Machine Learning Studio.\n\nI add the following line to my R code in the [Execute R Script][execute-r-script] module.\n\n    # Remove two columns we do not need\n    cadairydata <- cadairydata[, c(-1, -2)]\n\nRun this code in your experiment and check the result from the output log. These results are shown in Figure 11.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  7 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  4.37 3.69 4.54 4.28 4.47 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  51.6 56.1 68.5 65.7 73.7 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  2.11 1.93 2.16 2.13 2.23 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  0.98 0.892 0.892 0.897 0.897 ...\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving variable  cadairydata  ...\"\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving the following item(s):  .maml.oport1\"\n\n*Figure 11. Summary of the dataframe with two columns removed.*\n\nGood news! We get the expected results.\n\n###Add a new column\n\nTo create time series models it will be convenient to have a column containing the months since the start of the time series. We will create a new column 'Month.Count'.\n\nTo help organize the code we will create our first simple function, `num.month()`. We will then apply this function to create a new column in the dataframe. The new code is as follows.\n\n    ## Create a new column with the month count\n    ## Function to find the number of months from the first\n    ## month of the time series\n    num.month <- function(Year, Month) {\n      ## Find the starting year\n      min.year  <- min(Year)\n\n      ## Compute the number of months from the start of the time series\n      12 * (Year - min.year) + Month - 1\n    }\n\n    ## Compute the new column for the dataframe\n    cadairydata$Month.Count <- num.month(cadairydata$Year, cadairydata$Month.Number)\n\nNow run the updated experiment and use the output log to view the results. These results are shown in Figure 12.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  8 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  4.37 3.69 4.54 4.28 4.47 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  51.6 56.1 68.5 65.7 73.7 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  2.11 1.93 2.16 2.13 2.23 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  0.98 0.892 0.892 0.897 0.897 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Count      : num  0 1 2 3 4 5 6 7 8 9 ...\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving variable  cadairydata  ...\"\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving the following item(s):  .maml.oport1\"\n\n*Figure 12. Summary of the dataframe with the additional column.*\n\nIt looks like everything is working. We have the new column with the expected values in our dataframe.\n\n###Value transformations\n\nIn this section we will perform some simple transformations on the values in some of the columns of our dataframe. The R language supports nearly arbitrary value transformations. The references in [Appendix B - Further Reading](#appendixb) contain extensive examples.\n\nIf you look at the values in the summaries of our dataframe you should see something odd here. Is more ice cream than milk produced in California? No, of course not, as this makes no sense, sad as this fact may be to some of us ice cream lovers. The units are different. The price is in units of US pounds, milk is in units of 1 M US pounds, ice cream is in units of 1,000 US gallons, and cottage cheese is in units of 1,000 US pounds. Assuming ice cream weighs about 6.5 pounds per gallon, we can easily do the multiplication to convert these values so they are all in equal units of 1,000 pounds.\n\nFor our forecasting model we use a multiplicative model for trend and seasonal adjustment of this data. A log transformation allows us to use a linear model, simplifying this process. We can apply the log transformation in the same function where the multiplier is applied.\n\nIn the following code, I define a new function, `log.transform()`, and apply it to the rows containing the numerical values. The R `Map()` function is used to apply the `log.transform()` function to the selected columns of the dataframe. `Map()` is similar to `apply()` but allows for more than one list of arguments to the function. Note that a list of multipliers supplies the second argument to the `log.transform()` function. The `na.omit()` function is used as a bit of cleanup to ensure we do not have missing or undefined values in the dataframe.\n\n    log.transform <- function(invec, multiplier = 1) {\n      ## Function for the transformation, which is the log\n      ## of the input value times a multiplier\n\n      warningmessages <- c(\"ERROR: Non-numeric argument encountered in function log.transform\",\n                           \"ERROR: Arguments to function log.transform must be greate than zero\",\n                           \"ERROR: Aggurment multiplier to funcition log.transform must be a scaler\",\n                           \"ERROR: Invalid time seies value encountered in function log.transform\"\n                           )\n\n      ## Check the input arguments\n      if(!is.numeric(invec) | !is.numeric(multiplier)) {warning(warningmessages[1]); return(NA)}  \n      if(any(invec < 0.0) | any(multiplier < 0.0)) {warning(warningmessages[2]); return(NA)}\n      if(length(multiplier) != 1) {{warning(warningmessages[3]); return(NA)}}\n\n      ## Wrap the multiplication in tryCatch\n      ## If there is an exception, print the warningmessage to\n      ## standard error and return NA\n      tryCatch(log(multiplier * invec),\n               error = function(e){warning(warningmessages[4]); NA})\n    }\n\n\n    ## Apply the transformation function to the 4 columns\n    ## of the dataframe with production data\n    multipliers  <- list(1.0, 6.5, 1000.0, 1000.0)\n    cadairydata[, 4:7] <- Map(log.transform, cadairydata[, 4:7], multipliers)\n\n    ## Get rid of any rows with NA values\n    cadairydata <- na.omit(cadairydata)  \n\nThere is quite a bit happening in the `log.transform()` function. Most of this code is checking for potential problems with the arguments or dealing with exceptions, which can still arise during the computations. Only a few lines of this code actually do the computations.\n\nThe goal of the defensive programming is to prevent the failure of a single function that prevents processing from continuing. An abrupt failure of a long-running analysis can be quite frustrating for users. To avoid this situation, default return values must be chosen that will limit damage to downstream processing. A message is also produced to alert users that something has gone wrong.\n\nIf you are not used to defensive programming in R, all this code may seem a bit overwhelming. I will walk you through the major steps:\n\n1. A vector of four messages is defined. These messages are used to communicate information about some of the possible errors and exceptions that can occur with this code.\n\n2. I return a value of NA for each case. There are many other possibilities that might have fewer side effects. I could return a vector of zeroes, or the original input vector, for example.\n\n3. Checks are run on the arguments to the function. In each case, if an error is detected, a default value is returned and a message is produced by the `warming()` function. I am using `warning()` rather than `stop()` as the latter will terminate execution, exactly what I am trying to avoid. Note that I have written this code in a procedural style, as in this case a functional approach seemed complex and obscure.\n\n4. The log computations are wrapped in `tryCatch()` so that exceptions will not cause an abrupt halt to processing. Without `tryCatch()` most errors raised by R functions result in a stop signal, which does just that.\n\nExecute this R code in your experiment and have a look at the printed output in the output.log file. You will now see the transformed values of the four columns in the log, as shown in Figure 13.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  8 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  1.47 1.31 1.51 1.45 1.5 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  5.82 5.9 6.1 6.06 6.17 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  7.66 7.57 7.68 7.66 7.71 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  6.89 6.79 6.79 6.8 6.8 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Count      : num  0 1 2 3 4 5 6 7 8 9 ...\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving variable  cadairydata  ...\"\n    [ModuleOutput] \n    [ModuleOutput] [1] \"Saving the following item(s):  .maml.oport1\"\n\n*Figure 13. Summary of the transformed values in the dataframe.*\n\nWe see the values have been transformed. Milk production now greatly exceeds all other dairy product production, recalling that we are now looking at a log scale.\n\nAt this point our data is cleaned up and we are ready for some modeling. Looking at the visualization summary for the Result Dataset output of our [Execute R Script][execute-r-script] module, you will see the 'Month' column is 'Categorical' with 12 unique values, again, just as we wanted.\n\n##<a id=\"timeseries\"></a>Time series objects and correlation analysis\n\nIn this section we will explore a few basic R time series objects and analyze the correlations between some of the variables. Our goal is to output a dataframe containing the pairwise correlation information at several lags.\n\nThe complete R code for this section is in the zip file you downloaded earlier.\n\n###Time series objects in R\n\nAs already mentioned, time series are a series of data values indexed by time. R time series objects are used to create and manage the time index. There are several advantages to using time series objects. Time series objects free you from the many details of managing the time series index values that are encapsulated in the object. In addition, time series objects allow you to use the many time series methods for plotting, printing, modeling, etc.\n\nThe POSIXct time series class is commonly used and is relatively simple. This time series class measures time from the start of the epoch, January 1, 1970. We will use POSIXct time series objects in this example. Other widely used R time series object classes include zoo and xts, extensible time series.\n<!-- Additional information on R time series objects is provided in the references in Section 5.7. [commenting because this section doesn't exist, even in the original] -->\n\n### Time series object example\n\nLet's get started with our example. Drag and drop a **new** [Execute R Script][execute-r-script] module into your experiment. Connect the Result Dataset1 output port of the existing [Execute R Script][execute-r-script] module to the Dataset1 input port of the new [Execute R Script][execute-r-script] module.\n\nAs I did for the first examples, as we progress through the example, at some points I will show only the incremental additional lines of R code at each step.  \n\n####    Reading the dataframe\n\nAs a first step, let's read in a dataframe and make sure we get the expected results. The following code should do the job.\n\n    # Comment the following if using RStudio\n    cadairydata <- maml.mapInputPort(1)\n    str(cadairydata) # Check the results\n\nNow, run the experiment. The log of the new Execute R Script shape should look like Figure 14.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  8 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  1.47 1.31 1.51 1.45 1.5 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  5.82 5.9 6.1 6.06 6.17 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  7.66 7.57 7.68 7.66 7.71 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  6.89 6.79 6.79 6.8 6.8 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Count      : num  0 1 2 3 4 5 6 7 8 9 ...\n\n*Figure 14. Summary of the dataframe in the Execute R Script module.*\n\nThis data is of the expected types and format. Note that the 'Month' column is of type factor and has the expected number of levels.\n\n####Creating a time series object\n\nWe need to add a time series object to our dataframe. Replace the current code with the following, which adds a new column of class POSIXct.\n\n    # Comment the following if using RStudio\n    cadairydata <- maml.mapInputPort(1)\n\n    ## Create a new column as a POSIXct object\n    Sys.setenv(TZ = \"PST8PDT\")\n    cadairydata$Time <- as.POSIXct(strptime(paste(as.character(cadairydata$Year), \"-\", as.character(cadairydata$Month.Number), \"-01 00:00:00\", sep = \"\"), \"%Y-%m-%d %H:%M:%S\"))\n\n    str(cadairydata) # Check the results\n\nNow, check the log. It should look like Figure 15.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  9 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  1.47 1.31 1.51 1.45 1.5 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  5.82 5.9 6.1 6.06 6.17 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  7.66 7.57 7.68 7.66 7.71 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  6.89 6.79 6.79 6.8 6.8 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Count      : num  0 1 2 3 4 5 6 7 8 9 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Time             : POSIXct, format: \"1995-01-01\" \"1995-02-01\" ...\n\n*Figure 15. Summary of the dataframe with a time series object.*\n\nWe can see from the summary that the new column is in fact of class POSIXct.\n\n###Exploring and transforming the data\n\nLet's explore some of the variables in this dataset. A scatterplot matrix is a good way to produce a quick look. I am replacing the `str()` function in the previous R code with the following line.\n\n    pairs(~ Cotagecheese.Prod + Icecream.Prod + Milk.Prod + N.CA.Fat.Price, data = cadairydata, main = \"Pairwise Scatterplots of dairy time series\")\n\nRun this code and see what happens. The plot produced at the R Device port should look like Figure 16.\n\n![Scatterplot matrix of selected variables][17]\n\n*Figure 16. Scatterplot matrix of selected variables.*\n\nThere is some odd-looking structure in the relationships between these variables. Perhaps this arises from trends in the data and from the fact that we have not standardized the variables.\n\n###Correlation analysis\n\nTo perform correlation analysis we need to both de-trend and standardize the variables. We could simply use the R `scale()` function, which both centers and scales variables. This function might well run faster. However, I want to show you an example of defensive programing in R.\n\nThe `ts.detrend()` function shown below performs both of these operations. The following two lines of code de-trend the data and then standardize the values.\n\n    ts.detrend <- function(ts, Time, min.length = 3){\n      ## Function to de-trend and standardize a time series\n\n      ## Define some messages if they are NULL  \n      messages <- c('ERROR: ts.detrend requires arguments ts and Time to have the same length',\n                    'ERROR: ts.detrend requires argument ts to be of type numeric',\n                    paste('WARNING: ts.detrend has encountered a time series with length less than', as.character(min.length)),\n                    'ERROR: ts.detrend has encountered a Time argument not of class POSIXct',\n                    'ERROR: Detrend regression has failed in ts.detrend',\n                    'ERROR: Exception occurred in ts.detrend while standardizing time series in function ts.detrend'\n    )\n      # Create a vector of zeros to return as a default in some cases\n      zerovec  <- rep(length(ts), 0.0)\n\n      # The input arguments are not of the same length, return ts and quit\n      if(length(Time) != length(ts)) {warning(messages[1]); return(ts)}\n\n      # If the ts is not numeric, just return a zero vector and quit\n      if(!is.numeric(ts)) {warning(messages[2]); return(zerovec)}\n\n      # If the ts is too short, just return it and quit\n      if((ts.length <- length(ts)) < min.length) {warning(messages[3]); return(ts)}\n\n      ## Check that the Time variable is of class POSIXct\n      if(class(cadairydata$Time)[[1]] != \"POSIXct\") {warning(messages[4]); return(ts)}\n\n      ## De-trend the time series by using a linear model\n      ts.frame  <- data.frame(ts = ts, Time = Time)\n      tryCatch({ts <- ts - fitted(lm(ts ~ Time, data = ts.frame))},\n               error = function(e){warning(messages[5]); zerovec})\n\n      tryCatch( {stdev <- sqrt(sum((ts - mean(ts))^2))/(ts.length - 1)\n                 ts <- ts/stdev},\n                error = function(e){warning(messages[6]); zerovec})\n\n      ts\n    }  \n    ## Apply the detrend.ts function to the variables of interest\n    df.detrend <- data.frame(lapply(cadairydata[, 4:7], ts.detrend, cadairydata$Time))\n\n    ## Plot the results to look at the relationships\n    pairs(~ Cotagecheese.Prod + Icecream.Prod + Milk.Prod + N.CA.Fat.Price, data = df.detrend, main = \"Pairwise Scatterplots of detrended standardized time series\")\n\nThere is quite a bit happening in the `ts.detrend()` function. Most of this code is checking for potential problems with the arguments or dealing with exceptions, which can still arise during the computations. Only a few lines of this code actually do the computations.\n\nWe have already discussed an example of defensive programming in [Value transformations](#valuetransformations). Both computation blocks are wrapped in `tryCatch()`. For some errors it makes sense to return the original input vector, and in other cases, I return a vector of zeros.  \n\nNote that the linear regression used for de-trending is a time series regression. The predictor variable is a time series object.  \n\nOnce `ts.detrend()` is defined we apply it to the variables of interest in our dataframe. We must coerce the resulting list created by `lapply()` to data dataframe by using `as.data.frame()`. Because of defensive aspects of `ts.detrend()`, failure to process one of the variables will not prevent correct processing of the others.  \n\nThe final line of code creates a pairwise scatterplot. After running the R code, the results of the scatterplot are shown in Figure 17.\n\n![Pairwise scatterplot of de-trended and standardized time series][18]\n\n*Figure 17. Pairwise scatterplot of de-trended and standardized time series.*\n\nYou can compare these results to those shown in Figure 17. With the trend removed and the variables standardized, we see a lot less structure in the relationships between these variables.\n\nThe code to compute the correlations as R ccf objects is as follows.\n\n    ## A function to compute pairwise correlations from a\n    ## list of time series value vectors\n    pair.cor <- function(pair.ind, ts.list, lag.max = 1, plot = FALSE){\n      ccf(ts.list[[pair.ind[1]]], ts.list[[pair.ind[2]]], lag.max = lag.max, plot = plot)\n    }\n\n    ## A list of the pairwise indices\n    corpairs <- list(c(1,2), c(1,3), c(1,4), c(2,3), c(2,4), c(3,4))\n\n    ## Compute the list of ccf objects\n    cadairycorrelations <- lapply(corpairs, pair.cor, df.detrend)  \n\n    cadairycorrelations\n\nRunning this code produces the log shown in Figure 18.\n\n    [ModuleOutput] Loading objects:\n    [ModuleOutput]   port1\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] [[1]]\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] Autocorrelations of series 'X', by lag\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput]    -1     0     1 \n    [ModuleOutput] 0.148 0.358 0.317 \n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] [[2]]\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] Autocorrelations of series 'X', by lag\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput]     -1      0      1 \n    [ModuleOutput] -0.395 -0.186 -0.238 \n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] [[3]]\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] Autocorrelations of series 'X', by lag\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput]     -1      0      1 \n    [ModuleOutput] -0.059 -0.089 -0.127 \n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] [[4]]\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] Autocorrelations of series 'X', by lag\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput]    -1     0     1 \n    [ModuleOutput] 0.140 0.294 0.293 \n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] [[5]]\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput] Autocorrelations of series 'X', by lag\n    [ModuleOutput] \n    [ModuleOutput] \n    [ModuleOutput]     -1      0      1 \n    [ModuleOutput] -0.002 -0.074 -0.124 \n\n*Figure 18. List of ccf objects from the pairwise correlation analysis.*\n\nThere is a correlation value for each lag. None of these correlation values is large enough to be significant. We can therefore conclude that we can model each variable independently.\n\n###Output a dataframe\n\nWe have computed the pairwise correlations as a list of R ccf objects. This presents a bit of a problem as the Result Dataset output port really requires a dataframe. Further, the ccf object is itself a list and we want only the values in the first element of this list, the correlations at the various lags.\n\nThe following code extracts the lag values from the list of ccf objects, which are themselves lists.\n\n    df.correlations <- data.frame(do.call(rbind, lapply(cadairycorrelations, '[[', 1)))\n\n    c.names <- c(\"-1 lag\", \"0 lag\", \"+1 lag\")\n    r.names  <- c(\"Corr Cot Cheese - Ice Cream\",\n                  \"Corr Cot Cheese - Milk Prod\",\n                  \"Corr Cot Cheese - Fat Price\",\n                  \"Corr Ice Cream - Mik Prod\",\n                  \"Corr Ice Cream - Fat Price\",\n                  \"Corr Milk Prod - Fat Price\")\n\n    ## Build a dataframe with the row names column and the\n    ## correlation data frame and assign the column names\n    outframe <- cbind(r.names, df.correlations)\n    colnames(outframe) <- c.names\n    outframe\n\n\n    ## WARNING!\n    ## The following line works only in Azure Machine Learning\n    ## When running in RStudio, this code will result in an error\n    #maml.mapOutputPort('outframe')\n\nThe first line of code is a bit tricky, and some explanation may help you understand it. Working from the inside out we have the following:\n\n1.  The '**[[**' operator with the argument '**1**' selects the vector of correlations at the lags from the first element of the ccf object list.\n\n2.  The `do.call()` function applies the `rbind()` function over the elements of the list returns by `lapply()`.\n\n3.  The `data.frame()` function coerces the result produced by `do.call()` to a dataframe.\n\nNote that the row names are in a column of the dataframe. Doing so preserves the row names when they are output from the [Execute R Script][execute-r-script].\n\nRunning the code produces the output shown in Figure 19 when I **Visualize** the output at the Result Dataset port. The row names are in the first column, as intended.\n\n![Results output from the correlation analysis][20]\n\n*Figure 19. Results output from the correlation analysis.*\n\n##<a id=\"seasonalforecasting\"></a>Time series example: seasonal forecasting\n\nOur data is now in a form suitable for analysis, and we have determined there are no significant correlations between the variables. Let's move on and create a time series forecasting model. Using this model we will forecast California milk production for the 12 months of 2013.\n\nOur forecasting model will have two components, a trend component and a seasonal component. The complete forecast is the product of these two components. This type of model is known as a multiplicative model. The alternative is an additive model. We have already applied a log transformation to the variables of interest, which makes this analysis tractable.\n\nThe complete R code for this section is in the zip file you downloaded earlier.\n\n### Creating the dataframe for analysis\n\nStart by adding a **new** [Execute R Script][execute-r-script] module to your experiment. Connect the **Result Dataset** output of the existing [Execute R Script][execute-r-script] module to the **Dataset1** input of the new module. The result should look something like Figure 20.\n\n![The experiment with the new Execute R Script module added][21]\n\n*Figure 20. The experiment with the new Execute R Script module added.*\n\nAs with the correlation analysis we just completed, we need to add a column with a POSIXct time series object. The following code will do just this.\n\n    # If running in Machine Learning Studio, uncomment the first line with maml.mapInputPort()\n    cadairydata <- maml.mapInputPort(1)\n\n    ## Create a new column as a POSIXct object\n    Sys.setenv(TZ = \"PST8PDT\")\n    cadairydata$Time <- as.POSIXct(strptime(paste(as.character(cadairydata$Year), \"-\", as.character(cadairydata$Month.Number), \"-01 00:00:00\", sep = \"\"), \"%Y-%m-%d %H:%M:%S\"))\n\n    str(cadairydata)\n\nRun this code and look at the log. The result should look like Figure 21.\n\n    [ModuleOutput] [1] \"Loading variable port1...\"\n    [ModuleOutput] \n    [ModuleOutput] 'data.frame':    228 obs. of  9 variables:\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Number     : int  1 2 3 4 5 6 7 8 9 10 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Year             : int  1995 1995 1995 1995 1995 1995 1995 1995 1995 1995 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month            : Factor w/ 12 levels \"Apr\",\"Aug\",\"Dec\",..: 5 4 8 1 9 7 6 2 12 11 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Cotagecheese.Prod: num  1.47 1.31 1.51 1.45 1.5 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Icecream.Prod    : num  5.82 5.9 6.1 6.06 6.17 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Milk.Prod        : num  7.66 7.57 7.68 7.66 7.71 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ N.CA.Fat.Price   : num  6.89 6.79 6.79 6.8 6.8 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Month.Count      : num  0 1 2 3 4 5 6 7 8 9 ...\n    [ModuleOutput] \n    [ModuleOutput]  $ Time             : POSIXct, format: \"1995-01-01\" \"1995-02-01\" ...\n\n*Figure 21. A summary of the dataframe.*\n\nWith this result, we are ready to start our analysis.\n\n###Create a training dataset\n\nWith the dataframe constructed we need to create a training dataset. This data will include all of the observations except the last 12, of the year 2013, which is our test dataset. The following code subsets the dataframe and creates plots of the dairy production and price variables. I then create plots of the four production and price variables. An anonymous function is used to define some augments for plot, and then iterate over the list of the other two arguments with `Map()`. If you are thinking that a for loop would have worked fine here, you are correct. But, since R is a functional language I am showing you a functional approach.\n\n    cadairytrain <- cadairydata[1:216, ]\n\n    Ylabs  <- list(\"Log CA Cotage Cheese Production, 1000s lb\",\n                   \"Log CA Ice Cream Production, 1000s lb\",\n                   \"Log CA Milk Production 1000s lb\",\n                   \"Log North CA Milk Milk Fat Price per 1000 lb\")\n\n    Map(function(y, Ylabs){plot(cadairytrain$Time, y, xlab = \"Time\", ylab = Ylabs, type = \"l\")}, cadairytrain[, 4:7], Ylabs)\n\nRunning the code produces the series of time series plots from the R Device output shown in Figure 22. Note that the time axis is in units of dates, a nice benefit of the time series plot method.\n\n![First of time series plots of California dairy production and price data](./media/machine-learning-r-quickstart/unnamed-chunk-161.png)\n\n![Second of time series plots of California dairy production and price data](./media/machine-learning-r-quickstart/unnamed-chunk-162.png)\n\n![Third of time series plots of California dairy production and price data](./media/machine-learning-r-quickstart/unnamed-chunk-163.png)\n\n![Fourth of time series plots of California dairy production and price data](./media/machine-learning-r-quickstart/unnamed-chunk-164.png)\n\n*Figure 22. Time series plots of California dairy production and price data.*\n\n### A trend model\n\nHaving created a time series object and having had a look at the data, let's start to construct a trend model for the California milk production data. We can do this with a time series regression. However, it is clear from the plot that we will need more than a slope and intercept to accurately model the observed trend in the training data.\n\nGiven the small scale of the data, I will build the model for trend in RStudio and then cut and paste the resulting model into Azure Machine Learning. RStudio provides an interactive environment for this type of interactive analysis.\n\nAs a first attempt, I will try a polynomial regression with powers up to 3. There is a real danger of over-fitting these kinds of models. Therefore, it is best to avoid high order terms. The `I()` function inhibits interpretation of the contents (interprets the contents 'as is') and allows you to write a literally interpreted function in a regression equation.\n\n    milk.lm <- lm(Milk.Prod ~ Time + I(Month.Count^2) + I(Month.Count^3), data = cadairytrain)\n    summary(milk.lm)\n\nThis generates the following.\n\n    ##\n    ## Call:\n    ## lm(formula = Milk.Prod ~ Time + I(Month.Count^2) + I(Month.Count^3),\n    ##     data = cadairytrain)\n    ##\n    ## Residuals:\n    ##      Min       1Q   Median       3Q      Max\n    ## -0.12667 -0.02730  0.00236  0.02943  0.10586\n    ##\n    ## Coefficients:\n    ##                   Estimate Std. Error t value Pr(>|t|)\n    ## (Intercept)       6.33e+00   1.45e-01   43.60   <2e-16 ***\n    ## Time              1.63e-09   1.72e-10    9.47   <2e-16 ***\n    ## I(Month.Count^2) -1.71e-06   4.89e-06   -0.35    0.726\n    ## I(Month.Count^3) -3.24e-08   1.49e-08   -2.17    0.031 *  \n    ## ---\n    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n    ##\n    ## Residual standard error: 0.0418 on 212 degrees of freedom\n    ## Multiple R-squared:  0.941,  Adjusted R-squared:  0.94\n    ## F-statistic: 1.12e+03 on 3 and 212 DF,  p-value: <2e-16\n\nFrom P values (Pr(>|t|)) in this output, we can see that the squared term may not be significant. I will use the `update()` function to modify this model by dropping the squared term.\n\n    milk.lm <- update(milk.lm, . ~ . - I(Month.Count^2))\n    summary(milk.lm)\n\nThis generates the following.\n\n    ##\n    ## Call:\n    ## lm(formula = Milk.Prod ~ Time + I(Month.Count^3), data = cadairytrain)\n    ##\n    ## Residuals:\n    ##      Min       1Q   Median       3Q      Max\n    ## -0.12597 -0.02659  0.00185  0.02963  0.10696\n    ##\n    ## Coefficients:\n    ##                   Estimate Std. Error t value Pr(>|t|)\n    ## (Intercept)       6.38e+00   4.07e-02   156.6   <2e-16 ***\n    ## Time              1.57e-09   4.32e-11    36.3   <2e-16 ***\n    ## I(Month.Count^3) -3.76e-08   2.50e-09   -15.1   <2e-16 ***\n    ## ---\n    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n    ##\n    ## Residual standard error: 0.0417 on 213 degrees of freedom\n    ## Multiple R-squared:  0.941,  Adjusted R-squared:  0.94\n    ## F-statistic: 1.69e+03 on 2 and 213 DF,  p-value: <2e-16\n\nThis looks better. All of the terms are significant. However, the 2e-16 value is a default value, and should not be taken too seriously.  \n\nAs a sanity test, let's make a time series plot of the California dairy production data with the trend curve shown. I have added the following code in the Azure Machine Learning [Execute R Script][execute-r-script] model (not RStudio) to create the model and make a plot. The result is shown in Figure 23.\n\n    milk.lm <- lm(Milk.Prod ~ Time + I(Month.Count^3), data = cadairytrain)\n\n    plot(cadairytrain$Time, cadairytrain$Milk.Prod, xlab = \"Time\", ylab = \"Log CA Milk Production 1000s lb\", type = \"l\")\n    lines(cadairytrain$Time, predict(milk.lm, cadairytrain), lty = 2, col = 2)\n\n![California milk production data with trend model shown](./media/machine-learning-r-quickstart/unnamed-chunk-18.png)\n\n*Figure 23. California milk production data with trend model shown.*\n\nIt looks like the trend model fits the data fairly well. Further, there does not seem to be evidence of over-fitting, such as odd wiggles in the model curve.  \n\n###Seasonal model\n\nWith a trend model in hand, we need to push on and include the seasonal effects. We will use the month of the year as a dummy variable in the linear model to capture the month-by-month effect. Note that when you introduce factor variables into a model, the intercept must not be computed. If you do not do this, the formula is over-specified and R will drop one of the desired factors but keep the intercept term.\n\nSince we have a satisfactory trend model we can use the `update()` function to add the new terms to the existing model. The -1 in the update formula drops the intercept term. Continuing in RStudio for the moment:\n\n    milk.lm2 <- update(milk.lm, . ~ . + Month - 1)\n    summary(milk.lm2)\n\nThis generates the following.\n\n    ##\n    ## Call:\n    ## lm(formula = Milk.Prod ~ Time + I(Month.Count^3) + Month - 1,\n    ##     data = cadairytrain)\n    ##\n    ## Residuals:\n    ##      Min       1Q   Median       3Q      Max\n    ## -0.06879 -0.01693  0.00346  0.01543  0.08726\n    ##\n    ## Coefficients:\n    ##                   Estimate Std. Error t value Pr(>|t|)\n    ## Time              1.57e-09   2.72e-11    57.7   <2e-16 ***\n    ## I(Month.Count^3) -3.74e-08   1.57e-09   -23.8   <2e-16 ***\n    ## MonthApr          6.40e+00   2.63e-02   243.3   <2e-16 ***\n    ## MonthAug          6.38e+00   2.63e-02   242.2   <2e-16 ***\n    ## MonthDec          6.38e+00   2.64e-02   241.9   <2e-16 ***\n    ## MonthFeb          6.31e+00   2.63e-02   240.1   <2e-16 ***\n    ## MonthJan          6.39e+00   2.63e-02   243.1   <2e-16 ***\n    ## MonthJul          6.39e+00   2.63e-02   242.6   <2e-16 ***\n    ## MonthJun          6.38e+00   2.63e-02   242.4   <2e-16 ***\n    ## MonthMar          6.42e+00   2.63e-02   244.2   <2e-16 ***\n    ## MonthMay          6.43e+00   2.63e-02   244.3   <2e-16 ***\n    ## MonthNov          6.34e+00   2.63e-02   240.6   <2e-16 ***\n    ## MonthOct          6.37e+00   2.63e-02   241.8   <2e-16 ***\n    ## MonthSep          6.34e+00   2.63e-02   240.6   <2e-16 ***\n    ## ---\n    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n    ##\n    ## Residual standard error: 0.0263 on 202 degrees of freedom\n    ## Multiple R-squared:     1,   Adjusted R-squared:     1\n    ## F-statistic: 1.42e+06 on 14 and 202 DF,  p-value: <2e-16\n\nWe see that the model no longer has an intercept term and has 12 significant month factors. This is exactly what we wanted to see.\n\nLet's make another time series plot of the California dairy production data to see how well the seasonal model is working. I have added the following code in the Azure Machine Learning [Execute R Script][execute-r-script] to create the model and make a plot.\n\n    milk.lm2 <- lm(Milk.Prod ~ Time + I(Month.Count^3) + Month - 1, data = cadairytrain)\n\n    plot(cadairytrain$Time, cadairytrain$Milk.Prod, xlab = \"Time\", ylab = \"Log CA Milk Production 1000s lb\", type = \"l\")\n    lines(cadairytrain$Time, predict(milk.lm2, cadairytrain), lty = 2, col = 2)\n\nRunning this code in Azure Machine Learning produces the plot shown in Figure 24.\n\n![California milk production with model including seasonal effects](./media/machine-learning-r-quickstart/unnamed-chunk-20.png)\n\n*Figure 24. California milk production with model including seasonal effects.*\n\nThe fit to the data shown in Figure 24 is rather encouraging. Both the trend and the seasonal effect (monthly variation) look reasonable.\n\nAs another check on our model, let's have a look at the residuals. The following code computes the predicted values from our two models, computes the residuals for the seasonal model, and then plots these residuals for the training data.\n\n    ## Compute predictions from our models\n    predict1  <- predict(milk.lm, cadairydata)\n    predict2  <- predict(milk.lm2, cadairydata)\n\n    ## Compute and plot the residuals\n    residuals <- cadairydata$Milk.Prod - predict2\n    plot(cadairytrain$Time, residuals[1:216], xlab = \"Time\", ylab =\"Residuals of Seasonal Model\")\n\nThe residual plot is shown in Figure 25.\n\n![Residuals of the seasonal model for the training data](./media/machine-learning-r-quickstart/unnamed-chunk-21.png)\n\n*Figure 25. Residuals of the seasonal model for the training data.*\n\nThese residuals look reasonable. There is no particular structure, except the effect of the 2008-2009 recession, which our model does not account for particularly well.\n\nThe plot shown in Figure 25 is useful for detecting any time-dependent patterns in the residuals. The explicit approach of computing and plotting the residuals I used places the residuals in time order on the plot. If, on the other hand, I had plotted `milk.lm$residuals`, the plot would not have been in time order.\n\nYou can also use `plot.lm()` to produce a series of diagnostic plots.\n\n    ## Show the diagnostic plots for the model\n    plot(milk.lm2, ask = FALSE)\n\nThis code produces a series of diagnostic plots shown in Figure 26.\n\n![First of diagnostic plots for the seasonal model](./media/machine-learning-r-quickstart/unnamed-chunk-221.png)\n\n![Second of diagnostic plots for the seasonal model](./media/machine-learning-r-quickstart/unnamed-chunk-222.png)\n\n![Third of diagnostic plots for the seasonal model](./media/machine-learning-r-quickstart/unnamed-chunk-223.png)\n\n![Fourth of diagnostic plots for the seasonal model](./media/machine-learning-r-quickstart/unnamed-chunk-224.png)\n\n*Figure 26. Diagnostic plots for the seasonal model.*\n\nThere are a few highly influential points identified in these plots, but nothing to cause great concern. Further, we can see from the Normal Q-Q plot that the residuals are close to normally distributed, an important assumption for linear models.\n\n###Forecasting and model evaluation\n\nThere is just one more thing to do to complete our example. We need to compute forecasts and measure the error against the actual data. Our forecast will be for the 12 months of 2013. We can compute an error measure for this forecast to the actual data that is not part of our training dataset. Additionally, we can compare performance on the 18 years of training data to the 12 months of test data.  \n\nA number of metrics are used to measure the performance of time series models. In our case we will use the root mean square (RMS) error. The following function computes the RMS error between two series.  \n\n    RMS.error <- function(series1, series2, is.log = TRUE, min.length = 2){\n      ## Function to compute the RMS error or difference between two\n      ## series or vectors\n\n      messages <- c(\"ERROR: Input arguments to function RMS.error of wrong type encountered\",\n                    \"ERROR: Input vector to function RMS.error is too short\",\n                    \"ERROR: Input vectors to function RMS.error must be of same length\",\n                    \"WARNING: Funtion rms.error has received invald input time series.\")\n\n      ## Check the arguments\n      if(!is.numeric(series1) | !is.numeric(series2) | !is.logical(is.log) | !is.numeric(min.length)) {\n        warning(messages[1])\n        return(NA)}\n\n      if(length(series1) < min.length) {\n        warning(messages[2])\n        return(NA)}\n\n      if((length(series1) != length(series2))) {\n        warning(messages[3])\n        return(NA)}\n\n      ## If is.log is TRUE exponentiate the values, else just copy\n      if(is.log) {\n        tryCatch( {\n          temp1 <- exp(series1)\n          temp2 <- exp(series2) },\n          error = function(e){warning(messages[4]); NA}\n        )\n      } else {\n        temp1 <- series1\n        temp2 <- series2\n      }\n\n     ## Compute predictions from our models\n    predict1  <- predict(milk.lm, cadairydata)\n    predict2  <- predict(milk.lm2, cadairydata)\n\n    ## Compute the RMS error in a dataframe\n      tryCatch( {\n        sqrt(sum((temp1 - temp2)^2) / length(temp1))},\n        error = function(e){warning(messages[4]); NA})\n    }\n\nAs with the `log.transform()` function we discussed in the \"Value transformations\" section, there is quite a lot of error checking and exception recovery code in this function. The principles employed are the same. The work is done in two places wrapped in `tryCatch()`. First, the time series are exponentiated, since we have been working with the logs of the values. Second, the actual RMS error is computed.  \n\nEquipped with a function to measure the RMS error, let's build and output a dataframe containing the RMS errors. We will include terms for the trend model alone and the complete model with seasonal factors. The following code does the job by using the two linear models we have constructed.\n\n    ## Compute the RMS error in a dataframe\n    ## Include the row names in the first column so they will\n    ## appear in the output of the Execute R Script\n    RMS.df  <-  data.frame(\n    rowNames = c(\"Trend Model\", \"Seasonal Model\"),\n      Traing = c(\n      RMS.error(predict1[1:216], cadairydata$Milk.Prod[1:216]),\n      RMS.error(predict2[1:216], cadairydata$Milk.Prod[1:216])),\n      Forecast = c(\n        RMS.error(predict1[217:228], cadairydata$Milk.Prod[217:228]),\n        RMS.error(predict2[217:228], cadairydata$Milk.Prod[217:228]))\n    )\n    RMS.df\n\n    ## The following line should be executed only when running in\n    ## Azure Machine Learning Studio\n    maml.mapOutputPort('RMS.df')\n\nRunning this code produces the output shown in Figure 27 at the Result Dataset output port.\n\n![Comparison of RMS errors for the models][26]\n\n*Figure 27. Comparison of RMS errors for the models.*\n\nFrom these results, we see that adding the seasonal factors to the model reduces the RMS error significantly. Not too surprisingly, the RMS error for the training data is a bit less than for the forecast.\n\n##<a id=\"appendixa\"></a>APPENDIX A: Guide to RStudio\n\nRStudio is quite well documented, so in this appendix I will provide some links to the key sections of the RStudio documentation to get you started.\n\n1.  Creating projects\n\n    You can organize and manage your R code into projects by using RStudio. The documentation that uses projects can be found at https://support.rstudio.com/hc/articles/200526207-Using-Projects.\n\n    I recommend that you follow these directions and create a project for the R code examples in this document.  \n\n2.  Editing and executing R code\n\n    RStudio provides an integrated environment for editing and executing R code. Documentation can be found at https://support.rstudio.com/hc/articles/200484448-Editing-and-Executing-Code.\n\n3.  Debugging\n\n    RStudio includes powerful debugging capabilities. Documentation for these features is at https://support.rstudio.com/hc/articles/200713843-Debugging-with-RStudio.\n\n    The breakpoint troubleshooting features are documented at https://support.rstudio.com/hc/articles/200534337-Breakpoint-Troubleshooting.\n\n##<a id=\"appendixb\"></a>APPENDIX B: Further reading\n\nThis R programming tutorial covers the basics of what you need to use the R language with Azure Machine Learning Studio. If you are not familiar with R, two introductions are available on CRAN:\n\n- R for Beginners by Emmanuel Paradis is a good place to start at http://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf.  \n\n- An Introduction to R by W. N. Venables et. al. goes into a bit more depth, at http://cran.r-project.org/doc/manuals/R-intro.html.\n\nThere are many books on R that can help you get started. Here are a few I find useful:\n\n- The Art of R Programming: A Tour of Statistical Software Design by Norman Matloff is an excellent introduction to programming in R.  \n\n- R Cookbook by Paul Teetor provides a problem and solution approach to using R.  \n\n- R in Action by Robert Kabacoff is another useful introductory book. The companion Quick R website is a useful resource at http://www.statmethods.net/.\n\n- R Inferno by Patrick Burns is a surprisingly humorous book that deals with a number of tricky and difficult topics that can be encountered when programming in R. The book is available for free at http://www.burns-stat.com/documents/books/the-r-inferno/.\n\n- If you want a deep dive into advanced topics in R, have a look at the book Advanced R by Hadley Wickham. The online version of this book is available for free at http://adv-r.had.co.nz/.\n\nA catalogue of R time series packages can be found in the CRAN Task View for time series analysis: http://cran.r-project.org/web/views/TimeSeries.html. For information on specific time series object packages, you should refer to the documentation for that package.\n\nThe book Introductory Time Series with R by Paul Cowpertwait and Andrew Metcalfe provides an introduction to using R for time series analysis. Many more theoretical texts provide R examples.\n\nSome great internet resources:\n\n- DataCamp: DataCamp teaches R in the comfort of your browser with video lessons and coding exercises. There are interactive tutorials on the latest R techniques and packages. Take the free interactive R tutorial at https://www.datacamp.com/courses/introduction-to-r  \n\n- A quick R tutorial by Kelly Black from Clarkson University http://www.cyclismo.org/tutorial/R/\n\n- 60+ R resources listed at http://www.computerworld.com/article/2497464/business-intelligence-60-r-resources-to-improve-your-data-skills.html\n\n<!--Image references-->\n[1]: ./media/machine-learning-r-quickstart/fig1.png\n[2]: ./media/machine-learning-r-quickstart/fig2.png\n[3]: ./media/machine-learning-r-quickstart/fig3.png\n[4]: ./media/machine-learning-r-quickstart/fig4.png\n[5]: ./media/machine-learning-r-quickstart/fig5.png\n[6]: ./media/machine-learning-r-quickstart/fig6.png\n[7]: ./media/machine-learning-r-quickstart/fig7.png\n[8]: ./media/machine-learning-r-quickstart/fig8.png\n[9]: ./media/machine-learning-r-quickstart/fig9.png\n[10]: ./media/machine-learning-r-quickstart/fig10.png\n[11]: ./media/machine-learning-r-quickstart/fig11.png\n[12]: ./media/machine-learning-r-quickstart/fig12.png\n[13]: ./media/machine-learning-r-quickstart/fig13.png\n[14]: ./media/machine-learning-r-quickstart/fig14.png\n[15]: ./media/machine-learning-r-quickstart/fig15.png\n[16]: ./media/machine-learning-r-quickstart/fig16.png\n[17]: ./media/machine-learning-r-quickstart/fig17.png\n[18]: ./media/machine-learning-r-quickstart/fig18.png\n[19]: ./media/machine-learning-r-quickstart/fig19.png\n[20]: ./media/machine-learning-r-quickstart/fig20.png\n[21]: ./media/machine-learning-r-quickstart/fig21.png\n[22]: ./media/machine-learning-r-quickstart/fig22.png\n\n[26]: ./media/machine-learning-r-quickstart/fig26.png\n\n<!--links-->\n[appendixa]: #appendixa\n[download]: https://azurebigdatatutorials.blob.core.windows.net/rquickstart/RFiles.zip\n\n\n<!-- Module References -->\n[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/\n"
}