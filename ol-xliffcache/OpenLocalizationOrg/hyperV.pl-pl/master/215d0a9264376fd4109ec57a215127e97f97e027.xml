{
  "nodes": [
    {
      "content": "Setting up on-premises conditional access using Azure Active Directory Device Registration | Microsoft Azure",
      "pos": [
        27,
        135
      ]
    },
    {
      "content": "A step-by-step guide to enable conditional access to on-premises applications using Active Directory Federation Service (AD FS) in Windows Server 2012 R2.",
      "pos": [
        154,
        308
      ]
    },
    {
      "content": "Setting up on-premises conditional access using Azure Active Directory Device Registration",
      "pos": [
        617,
        707
      ]
    },
    {
      "content": "Personally owned devices of your users can be marked known to your organization by requiring the users to work place join their devices to the Azure Active Directory Device Registration service.",
      "pos": [
        709,
        903
      ]
    },
    {
      "content": "Below is a step-by-step guide to enable conditional access to on-premises applications using Active Directory Federation Service (AD FS) in Windows Server 2012 R2.",
      "pos": [
        904,
        1067
      ]
    },
    {
      "pos": [
        1072,
        1364
      ],
      "content": "[AZURE.NOTE]\nOffice 365 license or Azure AD Premium license is required when using devices registered in Azure Active Directory Device Registration service conditional access policies. This includes policies enforced by Active Directory Federation Services (AD FS) to on-premises resources.",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "Office 365 license or Azure AD Premium license is required when using devices registered in Azure Active Directory Device Registration service conditional access policies. This includes policies enforced by Active Directory Federation Services (AD FS) to on-premises resources.",
          "pos": [
            13,
            290
          ],
          "nodes": [
            {
              "content": "Office 365 license or Azure AD Premium license is required when using devices registered in Azure Active Directory Device Registration service conditional access policies.",
              "pos": [
                0,
                171
              ]
            },
            {
              "content": "This includes policies enforced by Active Directory Federation Services (AD FS) to on-premises resources.",
              "pos": [
                172,
                277
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        1366,
        1611
      ],
      "content": "For more information on the conditional access scenarios for on-premises, see <bpt id=\"p1\">[</bpt>Join to Workplace from Any Device for SSO and Seamless Second Factor Authentication Across Company Applications<ept id=\"p1\">](https://technet.microsoft.com/library/dn280945.aspx)</ept>."
    },
    {
      "content": "These capabilities are available to customers that purchase an Azure Active Directory Premium license.",
      "pos": [
        1613,
        1715
      ]
    },
    {
      "content": "Supported Devices",
      "pos": [
        1717,
        1734
      ]
    },
    {
      "content": "Windows 7 domain joined devices.",
      "pos": [
        1811,
        1843
      ]
    },
    {
      "content": "Windows 8.1 personal and domain joined devices.",
      "pos": [
        1846,
        1893
      ]
    },
    {
      "content": "iOS 6 and later, for Safari browser",
      "pos": [
        1896,
        1931
      ]
    },
    {
      "content": "Android 4.0 or later, Samsung GS3 or above phones, Samsung Note2 or above tablets.",
      "pos": [
        1934,
        2016
      ]
    },
    {
      "content": "Scenario Prerequisites",
      "pos": [
        2019,
        2041
      ]
    },
    {
      "content": "Subscription to Office 365 or Azure Active Directory Premium",
      "pos": [
        2117,
        2177
      ]
    },
    {
      "content": "Azure Active Directory Tenant",
      "pos": [
        2180,
        2209
      ]
    },
    {
      "content": "Windows Server Active Directory (Windows Server 2008 or above)",
      "pos": [
        2212,
        2274
      ]
    },
    {
      "content": "Updated schema in Windows Server 2012 R2",
      "pos": [
        2277,
        2317
      ]
    },
    {
      "content": "Subscription to Azure Active Directory Premium",
      "pos": [
        2320,
        2366
      ]
    },
    {
      "content": "Windows Server 2012 R2 Federation Services, configured for SSO to Azure AD",
      "pos": [
        2369,
        2443
      ]
    },
    {
      "content": "Windows Server 2012 R2 Web Application Proxy Microsoft Azure Active Directory Connect (Azure AD Connect).",
      "pos": [
        2446,
        2551
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Download Azure AD Connect here<ept id=\"p1\">](http://www.microsoft.com/en-us/download/details.aspx?id=47594)</ept>.",
      "pos": [
        2552,
        2648
      ]
    },
    {
      "content": "Verified domain.",
      "pos": [
        2651,
        2667
      ]
    },
    {
      "content": "Known issues in this release",
      "pos": [
        2670,
        2698
      ]
    },
    {
      "content": "Device based conditional access policies require device object write-back to Active Directory from Azure Active Directory.",
      "pos": [
        2781,
        2903
      ]
    },
    {
      "content": "It can take up to 3 hours for device objects to be written-back to Active Directory",
      "pos": [
        2904,
        2987
      ]
    },
    {
      "content": "iOS 7 devices will always prompt the user to select a certificate during client certificate authentication.",
      "pos": [
        2990,
        3097
      ]
    },
    {
      "content": "Some versions of iOS8, before iOS 8.3 do not work.",
      "pos": [
        3101,
        3151
      ]
    },
    {
      "content": "Scenario assumptions",
      "pos": [
        3157,
        3177
      ]
    },
    {
      "content": "This scenario assumes that you have a hybrid environment consisting of an Azure AD tenant and a local active directory.",
      "pos": [
        3178,
        3297
      ]
    },
    {
      "content": "These tenants should be connected using Azure AD Connect and with a verified domain and AD FS for SSO.",
      "pos": [
        3298,
        3400
      ]
    },
    {
      "content": "The checklist below will help you configure your environment to the stage described above.",
      "pos": [
        3401,
        3491
      ]
    },
    {
      "content": "Checklist: Prerequisites for Conditional Access Scenario",
      "pos": [
        3494,
        3550
      ]
    },
    {
      "content": "Connect your Azure AD Tenant with your Local Active Directory.",
      "pos": [
        3614,
        3676
      ]
    },
    {
      "content": "Configure Azure Active Directory Device Registration Service",
      "pos": [
        3682,
        3742
      ]
    },
    {
      "content": "Use this guide to deploy and configure Azure Active Directory Device Registration Service for your organization.",
      "pos": [
        3743,
        3855
      ]
    },
    {
      "content": "This guide assumes that you have configured Windows Server Active Directory and have subscribed to Microsoft Azure Active Directory.",
      "pos": [
        3857,
        3989
      ]
    },
    {
      "content": "See prerequisites above.",
      "pos": [
        3990,
        4014
      ]
    },
    {
      "content": "To deploy Azure Active Directory Device Registration Service with your Azure Active Directory tenant, complete the tasks in the following checklist, in order.",
      "pos": [
        4016,
        4174
      ]
    },
    {
      "content": "When a reference link takes you to a conceptual topic, return to this checklist after you review the conceptual topic so that you can proceed with the remaining tasks in this checklist.",
      "pos": [
        4175,
        4360
      ]
    },
    {
      "content": "Some tasks will include a scenario validation step that can help you confirm the step was completed successfully.",
      "pos": [
        4361,
        4474
      ]
    },
    {
      "content": "Part 1: Enable Azure Active Directory Device Registration",
      "pos": [
        4479,
        4536
      ]
    },
    {
      "content": "Follow the checklist below to enable and configure the Azure Active Directory Device Registration Service.",
      "pos": [
        4538,
        4644
      ]
    },
    {
      "content": "Task",
      "pos": [
        4648,
        4652
      ]
    },
    {
      "content": "Reference",
      "pos": [
        5035,
        5044
      ]
    },
    {
      "content": "Enable Device Registration in your Azure Active Directory tenant to allow devices to join the workplace.",
      "pos": [
        5558,
        5662
      ]
    },
    {
      "content": "By default, multi-factor authentication is not enabled for the service.",
      "pos": [
        5663,
        5734
      ]
    },
    {
      "content": "However, multi-factor authentication is recommended when registering a device.",
      "pos": [
        5735,
        5813
      ]
    },
    {
      "content": "Before enabling multi-factor authentication in ADRS, ensure that AD FS is configured for a multi-factor authentication provider.",
      "pos": [
        5814,
        5942
      ]
    },
    {
      "content": "Enable Azure Active Directory Device Registration",
      "pos": [
        5946,
        5995
      ]
    },
    {
      "content": "Devices will discover your Azure Active Directory Device Registration Service by looking for well-known DNS records.",
      "pos": [
        6084,
        6200
      ]
    },
    {
      "content": "You must configure your company DNS so that devices can discover your Azure Active Directory Device Registration Service.",
      "pos": [
        6201,
        6322
      ]
    },
    {
      "content": "Configure Azure Active Directory Device Registration discovery.",
      "pos": [
        6472,
        6535
      ]
    },
    {
      "content": "Part 2: Deploy and configure Windows Server 2012 R2 Active Directory Federation Services and set up a federation relationship with Azure AD",
      "pos": [
        6611,
        6750
      ]
    },
    {
      "content": "Task",
      "pos": [
        6754,
        6758
      ]
    },
    {
      "content": "Reference",
      "pos": [
        7141,
        7150
      ]
    },
    {
      "content": "Deploy Active Directory Domain Services domain with the Windows Server 2012 R2 schema extensions.",
      "pos": [
        7664,
        7761
      ]
    },
    {
      "content": "You do not need to upgrade any of your domain controllers to Windows Server 2012 R2.",
      "pos": [
        7762,
        7846
      ]
    },
    {
      "content": "The schema upgrade is the only requirement.",
      "pos": [
        7847,
        7890
      ]
    },
    {
      "content": "[Upgrade your Active Directory Domain Services Schema](#Upgrade your Active Directory Domain Services Schema)",
      "pos": [
        7893,
        8002
      ]
    },
    {
      "content": "Devices will discover your Azure Active Directory Device Registration Service by looking for well-known DNS records.",
      "pos": [
        8021,
        8137
      ]
    },
    {
      "content": "You must configure your company DNS so that devices can discover your Azure Active Directory Device Registration Service.",
      "pos": [
        8138,
        8259
      ]
    },
    {
      "content": "[Prepare your Active Directory support devices](#Prepare your Active Directory to support devices)",
      "pos": [
        8408,
        8506
      ]
    },
    {
      "content": "Part 3: Enable device writeback in Azure AD",
      "pos": [
        8513,
        8556
      ]
    },
    {
      "content": "Task",
      "pos": [
        8560,
        8564
      ]
    },
    {
      "content": "Reference",
      "pos": [
        8947,
        8956
      ]
    },
    {
      "content": "Complete part 2 of Enabling device writeback in Azure AD Connect.",
      "pos": [
        9470,
        9535
      ]
    },
    {
      "content": "Upon completion, return this this guide.",
      "pos": [
        9536,
        9576
      ]
    },
    {
      "content": "[Enabling device writeback in Azure AD Connect](#Upgrade your Active Directory Domain Services Schema)",
      "pos": [
        9579,
        9681
      ]
    },
    {
      "content": "[Optional] Part 4: Enable multi-factor authentication",
      "pos": [
        9707,
        9760
      ]
    },
    {
      "content": "It is strongly recommended that you configure one of the several options for multi-factor authentication.",
      "pos": [
        9762,
        9867
      ]
    },
    {
      "content": "If you want to require MFA, see <bpt id=\"p1\">[</bpt>Choose the multi-factor security solution for you<ept id=\"p1\">](multi-factor-authentication-get-started.md)</ept>.",
      "pos": [
        9868,
        9996
      ]
    },
    {
      "content": "It includes a description of each solution, and links to help you configure the solution of your choice.",
      "pos": [
        9997,
        10101
      ]
    },
    {
      "content": "Part 5: Verification",
      "pos": [
        10107,
        10127
      ]
    },
    {
      "content": "The deployment is now complete.",
      "pos": [
        10129,
        10160
      ]
    },
    {
      "content": "You can now try out some scenarios.",
      "pos": [
        10161,
        10196
      ]
    },
    {
      "content": "Follow the links below to experiment with the service and become familiar with the features",
      "pos": [
        10197,
        10288
      ]
    },
    {
      "content": "Task",
      "pos": [
        10293,
        10297
      ]
    },
    {
      "content": "Reference",
      "pos": [
        10516,
        10525
      ]
    },
    {
      "content": "Join some devices to your workplace using Azure Active Directory Device Registration.",
      "pos": [
        10907,
        10992
      ]
    },
    {
      "content": "You can join iOS, Windows, and Android devices",
      "pos": [
        10993,
        11039
      ]
    },
    {
      "content": "[Join devices to your workplace using Azure Active Directory Device Registration](#Join devices to your workplace using Azure Active Directory Device Registration)",
      "pos": [
        11130,
        11293
      ]
    },
    {
      "content": "You can view and enable/disable registered devices using the Administrator Portal.",
      "pos": [
        11298,
        11380
      ]
    },
    {
      "content": "In this task you will view some registered devices using the Administrator Portal.",
      "pos": [
        11381,
        11463
      ]
    },
    {
      "content": "Azure Active Directory Device Registration Overview",
      "pos": [
        11522,
        11573
      ]
    },
    {
      "content": "Verify that device objects are written back from Azure Active Directory to Windows Server Active Directory.",
      "pos": [
        11676,
        11783
      ]
    },
    {
      "content": "[Verify registered devices are written-back to Active Directory](#Verify registered devices are written-back to Active Director)",
      "pos": [
        11899,
        12027
      ]
    },
    {
      "content": "Now that users can register their devices, you can create application access polices in AD FS that allow only registered devices.",
      "pos": [
        12049,
        12178
      ]
    },
    {
      "content": "In this task you will create an application access rule and a custom access denied message",
      "pos": [
        12179,
        12269
      ]
    },
    {
      "content": "[Create an application access policy and custom access denied message](#Create an application access policy and custom access denied message)",
      "pos": [
        12272,
        12413
      ]
    },
    {
      "content": "Integrate Azure Active Directory with local Active Directory",
      "pos": [
        12433,
        12493
      ]
    },
    {
      "content": "This will help you integrate your Azure AD tenant with your local active directory, using Azure AD Connect.",
      "pos": [
        12494,
        12601
      ]
    },
    {
      "content": "Although the steps are available in the Azure Portal, make note of any special instructions listed in this section.",
      "pos": [
        12602,
        12717
      ]
    },
    {
      "content": "Log on to the Azure Portal as Administrator.",
      "pos": [
        12724,
        12768
      ]
    },
    {
      "pos": [
        12773,
        12819
      ],
      "content": "On the left pane, select <bpt id=\"p1\">**</bpt>Active Directory<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        12824,
        12872
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Directory<ept id=\"p1\">**</ept> tab, select your directory."
    },
    {
      "pos": [
        12877,
        12918
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Directory Integration<ept id=\"p1\">**</ept> tab."
    },
    {
      "pos": [
        12923,
        13051
      ],
      "content": "Under <bpt id=\"p1\">**</bpt>deploy and manage<ept id=\"p1\">**</ept> section, follow the steps 1 through 3 to integrate Azure Active Directory with your local directory."
    },
    {
      "content": "Add domains.",
      "pos": [
        13060,
        13072
      ]
    },
    {
      "pos": [
        13081,
        13267
      ],
      "content": "Install and run Azure AD Connect: Install Azure AD Connect using the following instructions, <bpt id=\"p1\">[</bpt>Custom installation of Azure AD Connect<ept id=\"p1\">](active-directory-aadconnect-get-started-custom.md)</ept>."
    },
    {
      "content": "Verify and manage directory sync.",
      "pos": [
        13273,
        13306
      ]
    },
    {
      "content": "Single sign-on instructions are available within this step.",
      "pos": [
        13307,
        13366
      ]
    },
    {
      "pos": [
        13370,
        13531
      ],
      "content": "[AZURE.NOTE] Configure Federation with AD FS as outlined in the document linked above. \n[AZURE.NOTE] You do not need to configure any of the preview features.",
      "leadings": [
        "",
        "  >"
      ],
      "nodes": [
        {
          "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Configure Federation with AD FS as outlined in the document linked above.",
          "pos": [
            0,
            86
          ]
        },
        {
          "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You do not need to configure any of the preview features.",
          "pos": [
            88,
            158
          ]
        }
      ]
    },
    {
      "content": "Upgrade your Active Directory Domain Services schema",
      "pos": [
        13544,
        13596
      ]
    },
    {
      "pos": [
        13599,
        13741
      ],
      "content": "[AZURE.NOTE]\nUpgrading your Active Directory schema cannot be reversed. It is recommended that you first perform this in a test environment.",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "Upgrading your Active Directory schema cannot be reversed. It is recommended that you first perform this in a test environment.",
          "pos": [
            13,
            140
          ],
          "nodes": [
            {
              "content": "Upgrading your Active Directory schema cannot be reversed.",
              "pos": [
                0,
                58
              ]
            },
            {
              "content": "It is recommended that you first perform this in a test environment.",
              "pos": [
                59,
                127
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "Log in to your domain controller with an account that has both Enterprise Admin and Schema Admin rights.",
      "pos": [
        13746,
        13850
      ]
    },
    {
      "pos": [
        13854,
        13971
      ],
      "content": "Copy the <bpt id=\"p1\">**</bpt>[media]\\support\\adprep<ept id=\"p1\">**</ept> directory and sub-directories to one of your Active Directory domain controllers."
    },
    {
      "content": "Where [media] is the path to the Windows Server 2012 R2 installation media.",
      "pos": [
        13976,
        14051
      ]
    },
    {
      "content": "From a command prompt, navigate to the adprep directory and execute: <bpt id=\"p1\">**</bpt>adprep.exe /forestprep<ept id=\"p1\">**</ept>.",
      "pos": [
        14055,
        14151
      ]
    },
    {
      "content": "Follow the onscreen instructions to complete the schema upgrade.",
      "pos": [
        14152,
        14216
      ]
    },
    {
      "content": "Prepare your Active Directory to support devices",
      "pos": [
        14221,
        14269
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> This is a one-time operation that you must run to prepare your Active Directory forest to support devices.",
      "pos": [
        14271,
        14390
      ]
    },
    {
      "content": "You must be logged on with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema to complete this procedure.",
      "pos": [
        14391,
        14559
      ]
    },
    {
      "content": "Prepare your Active Directory forest to support devices",
      "pos": [
        14564,
        14619
      ]
    },
    {
      "pos": [
        14623,
        14912
      ],
      "content": "[AZURE.NOTE]\nThis is a one-time operation that you must run to prepare your Active Directory forest to support devices. You must be logged on with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema to complete this procedure.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "This is a one-time operation that you must run to prepare your Active Directory forest to support devices. You must be logged on with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema to complete this procedure.",
          "pos": [
            13,
            288
          ],
          "nodes": [
            {
              "content": "This is a one-time operation that you must run to prepare your Active Directory forest to support devices.",
              "pos": [
                0,
                106
              ]
            },
            {
              "content": "You must be logged on with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema to complete this procedure.",
              "pos": [
                107,
                275
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "Prepare your Active Directory forest",
      "pos": [
        14918,
        14954
      ]
    },
    {
      "pos": [
        14960,
        15074
      ],
      "content": "On your federation server, open a Windows PowerShell command window and type:\n Initialize-ADDeviceRegistration",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "On your federation server, open a Windows PowerShell command window and type:",
          "pos": [
            0,
            77
          ]
        },
        {
          "content": "Initialize-ADDeviceRegistration",
          "pos": [
            79,
            110
          ]
        }
      ]
    },
    {
      "content": "When prompted for <bpt id=\"p1\">**</bpt>ServiceAccountName<ept id=\"p1\">**</ept>, enter the name of the service account you selected as the service account for AD FS.",
      "pos": [
        15079,
        15205
      ]
    },
    {
      "content": "If it is a gMSA account, enter the account in the <bpt id=\"p1\">**</bpt>domain\\accountname$<ept id=\"p1\">**</ept> format.",
      "pos": [
        15206,
        15287
      ]
    },
    {
      "content": "For a domain account, use the format <bpt id=\"p1\">**</bpt>domain\\accountname<ept id=\"p1\">**</ept>.",
      "pos": [
        15288,
        15348
      ]
    },
    {
      "content": "Enable device authentication in AD FS",
      "pos": [
        15356,
        15393
      ]
    },
    {
      "pos": [
        15398,
        15515
      ],
      "content": "On your federation server, open the AD FS management console and navigate to <bpt id=\"p1\">**</bpt>AD FS<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Authentication Policies<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Edit Global Primary Authentication…<ept id=\"p1\">**</ept>",
      "pos": [
        15519,
        15565
      ]
    },
    {
      "content": "from the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> pane.",
      "pos": [
        15566,
        15592
      ]
    },
    {
      "pos": [
        15596,
        15657
      ],
      "content": "Check <bpt id=\"p1\">**</bpt>Enable device authentication<ept id=\"p1\">**</ept> and then select<bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "By default, AD FS will periodically remove unused devices from Active Directory.",
      "pos": [
        15661,
        15741
      ]
    },
    {
      "content": "You must disable this task when using Azure Active Directory Device Registration so that devices can be managed in Azure.",
      "pos": [
        15742,
        15863
      ]
    },
    {
      "content": "Disable unused device cleanup",
      "pos": [
        15870,
        15899
      ]
    },
    {
      "pos": [
        15903,
        16034
      ],
      "content": "On your federation server, open a Windows PowerShell command window and type:\n Set-AdfsDeviceRegistration -MaximumInactiveDays 0",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "On your federation server, open a Windows PowerShell command window and type:",
          "pos": [
            0,
            77
          ]
        },
        {
          "content": "Set-AdfsDeviceRegistration -MaximumInactiveDays 0",
          "pos": [
            79,
            128
          ]
        }
      ]
    },
    {
      "content": "Prepare Azure AD Connect for device writeback",
      "pos": [
        16040,
        16085
      ]
    },
    {
      "content": "Complete Part 1: Prepare AAD Connect.",
      "pos": [
        16091,
        16128
      ]
    },
    {
      "content": "Join devices to your workplace using Azure Active Directory Device Registration",
      "pos": [
        16135,
        16214
      ]
    },
    {
      "content": "Join an iOS device using Azure Active Directory Device Registration",
      "pos": [
        16220,
        16287
      ]
    },
    {
      "content": "Azure Active Directory Device Registration uses the Over-the-Air Profile enrollment process for iOS devices.",
      "pos": [
        16289,
        16397
      ]
    },
    {
      "content": "This process begins with the user connecting to the profile enrollment URL using the Safari web browser.",
      "pos": [
        16398,
        16502
      ]
    },
    {
      "content": "The URL format is as follows:",
      "pos": [
        16503,
        16532
      ]
    },
    {
      "content": "Where <ph id=\"ph1\">`yourdomainname`</ph> is the domain name that you have configured with Azure Active Directory.",
      "pos": [
        16627,
        16722
      ]
    },
    {
      "content": "For example, if your domain name is contoso.com, the URL would be:",
      "pos": [
        16723,
        16789
      ]
    },
    {
      "content": "There are many different ways to communicate this URL to your users.",
      "pos": [
        16879,
        16947
      ]
    },
    {
      "content": "One recommended way is to publish this URL in a custom application access denied message in AD FS.",
      "pos": [
        16948,
        17046
      ]
    },
    {
      "content": "This is covered in the upcoming section: [Create an application access policy and custom access denied message](#Create an application access policy and custom access denied message).",
      "pos": [
        17047,
        17230
      ]
    },
    {
      "content": "Join a Windows 8.1 device using Azure Active Directory Device Registration",
      "pos": [
        17235,
        17309
      ]
    },
    {
      "pos": [
        17314,
        17400
      ],
      "content": "On your Windows 8.1 device, navigate to <bpt id=\"p1\">**</bpt>PC Settings<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Network<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Workplace<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Enter your user name in UPN format.",
      "pos": [
        17404,
        17439
      ]
    },
    {
      "content": "For example, dan@contoso.com..",
      "pos": [
        17440,
        17470
      ]
    },
    {
      "pos": [
        17474,
        17490
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Join<ept id=\"p1\">**</ept>."
    },
    {
      "content": "When prompted, sign-in with your credentials.",
      "pos": [
        17494,
        17539
      ]
    },
    {
      "content": "The device is now joined.",
      "pos": [
        17540,
        17565
      ]
    },
    {
      "content": "Join an Android device using Azure Active Directory Device Registration",
      "pos": [
        17571,
        17642
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Azure Authenticator for Android topic<ept id=\"p1\">](active-directory-conditional-access-azure-authenticator-app.md)</ept> has instructions on how to install Azure authenticator app on your Android device and add a work account.",
      "pos": [
        17644,
        17857
      ]
    },
    {
      "content": "When a work account is created successfully on an Android device, that device is workplace joined to the organization.",
      "pos": [
        17858,
        17976
      ]
    },
    {
      "content": "Verify registered devices are written-back to Active Directory",
      "pos": [
        17981,
        18043
      ]
    },
    {
      "content": "You can view and verify that your device objects have been written back to your Active Directory using LDP.exe or ADSI Edit.",
      "pos": [
        18044,
        18168
      ]
    },
    {
      "content": "Both are available with the Active Directory Administrator tools.",
      "pos": [
        18169,
        18234
      ]
    },
    {
      "content": "By default, device objects that are written-back from Azure Active Directory will be placed in the same domain as your AD FS farm.",
      "pos": [
        18236,
        18366
      ]
    },
    {
      "content": "Create an application access policy and custom access denied message",
      "pos": [
        18418,
        18486
      ]
    },
    {
      "content": "Consider the following scenario: You create an application Relying Party Trust in AD FS and configure an Issuance Authorization Rule that allows only registered devices.",
      "pos": [
        18487,
        18656
      ]
    },
    {
      "content": "Now only devices that are registered are allowed to access the application.",
      "pos": [
        18657,
        18732
      ]
    },
    {
      "content": "To make it easy for your users to gain access to the application, you configure a custom access denied message that includes instructions on how to join their device.",
      "pos": [
        18733,
        18899
      ]
    },
    {
      "content": "Now your users have a seamless way to register their devices in order to access an application.",
      "pos": [
        18900,
        18995
      ]
    },
    {
      "content": "The following steps will show you how to implement this scenario.",
      "pos": [
        18997,
        19062
      ]
    },
    {
      "content": "This section assumes that you have already configured a Relying Party Trust for your application in AD FS.",
      "pos": [
        19077,
        19183
      ]
    },
    {
      "content": "Open the AD FS MMC tool and navigate to AD FS &gt; Trust Relationships &gt; Relying Party Trusts.",
      "pos": [
        19188,
        19279
      ]
    },
    {
      "content": "Locate the application for which this new access rule will apply.",
      "pos": [
        19283,
        19348
      ]
    },
    {
      "content": "Right-click the application and select Edit Claim Rules…",
      "pos": [
        19349,
        19405
      ]
    },
    {
      "pos": [
        19409,
        19486
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Issuance Authorization Rules<ept id=\"p1\">**</ept> tab and then select <bpt id=\"p2\">**</bpt>Add Rule…<ept id=\"p2\">**</ept>"
    },
    {
      "content": "From the <bpt id=\"p1\">**</bpt>Claim rule<ept id=\"p1\">**</ept> template drop down list, select <bpt id=\"p2\">**</bpt>Permit or Deny Users Based on an Incoming Claim<ept id=\"p2\">**</ept>.",
      "pos": [
        19490,
        19598
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        19599,
        19615
      ]
    },
    {
      "pos": [
        19619,
        19696
      ],
      "content": "In the Claim Rule name: field type: <bpt id=\"p1\">**</bpt>Permit access from registered devices<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        19700,
        19776
      ],
      "content": "From the Incoming claim type: drop down list, select <bpt id=\"p1\">**</bpt>Is Registered User<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        19780,
        19830
      ],
      "content": "In the Incoming claim value: field, type: <bpt id=\"p1\">**</bpt>true<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        19834,
        19910
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Permit access to users with this incoming claim<ept id=\"p1\">**</ept> radio button."
    },
    {
      "pos": [
        19914,
        19958
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept> and then select <bpt id=\"p2\">**</bpt>Apply<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Remove any rules that are more permissive than the rule you just created.",
      "pos": [
        19963,
        20036
      ]
    },
    {
      "content": "For example, remove the default <bpt id=\"p1\">**</bpt>Permit Access to all Users<ept id=\"p1\">**</ept> rule.",
      "pos": [
        20037,
        20105
      ]
    },
    {
      "content": "Your application is now configured to allow access only when the user is coming from a device that they registered and joined to the workplace.",
      "pos": [
        20107,
        20250
      ]
    },
    {
      "content": "For more advanced access polices, see <bpt id=\"p1\">[</bpt>Manage Risk with Multi-Factor Access Control<ept id=\"p1\">](https://technet.microsoft.com/library/dn280949.aspx)</ept>.",
      "pos": [
        20251,
        20389
      ]
    },
    {
      "content": "Next, you will configure a custom error message for your application.",
      "pos": [
        20391,
        20460
      ]
    },
    {
      "content": "The error message will let users know that they must join their device to the workplace before they are allowed access to the application.",
      "pos": [
        20461,
        20599
      ]
    },
    {
      "content": "You can create a custom application access denied message using custom HTML and Windows PowerShell.",
      "pos": [
        20600,
        20699
      ]
    },
    {
      "content": "On your federation server, open a Windows PowerShell command window and type the following command.",
      "pos": [
        20701,
        20800
      ]
    },
    {
      "content": "Replace portions of the command with items that are specific to your system:",
      "pos": [
        20801,
        20877
      ]
    },
    {
      "content": "You must register your device before you can access this application.",
      "pos": [
        20983,
        21052
      ]
    },
    {
      "pos": [
        21054,
        21127
      ],
      "content": "<bpt id=\"p1\">**</bpt>If you are using an iOS device, select this link to join your device<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "Join this iOS device to your workplace.",
      "pos": [
        21229,
        21268
      ]
    },
    {
      "pos": [
        21271,
        21397
      ],
      "content": "<bpt id=\"p1\">**</bpt>If you are using a Windows 8.1 device<ept id=\"p1\">**</ept>, you can join your device by going to **PC Settings **&gt; <bpt id=\"p2\">**</bpt>Network<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Workplace<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Where \"<bpt id=\"p1\">**</bpt>relying party trust name<ept id=\"p1\">**</ept>\" is the name of your applications Relying Party Trust object in AD FS.",
      "pos": [
        21400,
        21506
      ]
    },
    {
      "content": "Where <bpt id=\"p1\">**</bpt>yourdomain.com<ept id=\"p1\">**</ept> is the domain name that you have configured with Azure Active Directory.",
      "pos": [
        21508,
        21605
      ]
    },
    {
      "content": "For example, contoso.com.",
      "pos": [
        21606,
        21631
      ]
    },
    {
      "content": "Be sure to remove any line breaks (if any) from the html content that you pass to the <bpt id=\"p1\">**</bpt>Set-AdfsRelyingPartyWebContent<ept id=\"p1\">**</ept> cmdlet.",
      "pos": [
        21633,
        21761
      ]
    },
    {
      "content": "Now when users access your application from a device that is not registered with the Azure Active Directory Device Registration Service, they will receive a page that looks similar to the screen shot below.",
      "pos": [
        21764,
        21970
      ]
    },
    {
      "content": "Screeshot of an error when users haven't registered their device with Azure AD",
      "pos": [
        21975,
        22053
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Setting up on-premises conditional access using Azure Active Directory Device Registration | Microsoft Azure\"\n    description=\"A step-by-step guide to enable conditional access to on-premises applications using Active Directory Federation Service (AD FS) in Windows Server 2012 R2.\"\n    services=\"active-directory\"\n    documentationCenter=\"\"\n    authors=\"femila\"\n    manager=\"stevenpo\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"active-directory\"\n    ms.workload=\"identity\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"11/24/2015\"\n    ms.author=\"femila\"/>\n\n\n# Setting up on-premises conditional access using Azure Active Directory Device Registration\n\nPersonally owned devices of your users can be marked known to your organization by requiring the users to work place join their devices to the Azure Active Directory Device Registration service. Below is a step-by-step guide to enable conditional access to on-premises applications using Active Directory Federation Service (AD FS) in Windows Server 2012 R2. \n\n> [AZURE.NOTE]\n> Office 365 license or Azure AD Premium license is required when using devices registered in Azure Active Directory Device Registration service conditional access policies. This includes policies enforced by Active Directory Federation Services (AD FS) to on-premises resources.\n\nFor more information on the conditional access scenarios for on-premises, see [Join to Workplace from Any Device for SSO and Seamless Second Factor Authentication Across Company Applications](https://technet.microsoft.com/library/dn280945.aspx).\n\nThese capabilities are available to customers that purchase an Azure Active Directory Premium license.\n\nSupported Devices\n-------------------------------------------------------------------------\n* Windows 7 domain joined devices.\n* Windows 8.1 personal and domain joined devices.\n* iOS 6 and later, for Safari browser\n* Android 4.0 or later, Samsung GS3 or above phones, Samsung Note2 or above tablets.\n\n\nScenario Prerequisites\n------------------------------------------------------------------------\n* Subscription to Office 365 or Azure Active Directory Premium\n* Azure Active Directory Tenant\n* Windows Server Active Directory (Windows Server 2008 or above)\n* Updated schema in Windows Server 2012 R2\n* Subscription to Azure Active Directory Premium\n* Windows Server 2012 R2 Federation Services, configured for SSO to Azure AD\n* Windows Server 2012 R2 Web Application Proxy Microsoft Azure Active Directory Connect (Azure AD Connect). [Download Azure AD Connect here](http://www.microsoft.com/en-us/download/details.aspx?id=47594).\n* Verified domain. \n\nKnown issues in this release\n-------------------------------------------------------------------------------\n* Device based conditional access policies require device object write-back to Active Directory from Azure Active Directory. It can take up to 3 hours for device objects to be written-back to Active Directory\n* iOS 7 devices will always prompt the user to select a certificate during client certificate authentication. \n* Some versions of iOS8, before iOS 8.3 do not work. \n\n## Scenario assumptions\nThis scenario assumes that you have a hybrid environment consisting of an Azure AD tenant and a local active directory. These tenants should be connected using Azure AD Connect and with a verified domain and AD FS for SSO. The checklist below will help you configure your environment to the stage described above. \n\nChecklist: Prerequisites for Conditional Access Scenario\n--------------------------------------------------------------\nConnect your Azure AD Tenant with your Local Active Directory. \n\n## Configure Azure Active Directory Device Registration Service\nUse this guide to deploy and configure Azure Active Directory Device Registration Service for your organization.\n\nThis guide assumes that you have configured Windows Server Active Directory and have subscribed to Microsoft Azure Active Directory. See prerequisites above.\n\nTo deploy Azure Active Directory Device Registration Service with your Azure Active Directory tenant, complete the tasks in the following checklist, in order. When a reference link takes you to a conceptual topic, return to this checklist after you review the conceptual topic so that you can proceed with the remaining tasks in this checklist. Some tasks will include a scenario validation step that can help you confirm the step was completed successfully.\n\n## Part 1: Enable Azure Active Directory Device Registration\n\nFollow the checklist below to enable and configure the Azure Active Directory Device Registration Service.\n\n| Task                                                                                                                                                                                                                                                                                                                                                                                             | Reference                                                       |\n|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n| Enable Device Registration in your Azure Active Directory tenant to allow devices to join the workplace. By default, multi-factor authentication is not enabled for the service. However, multi-factor authentication is recommended when registering a device. Before enabling multi-factor authentication in ADRS, ensure that AD FS is configured for a multi-factor authentication provider. | [Enable Azure Active Directory Device Registration](active-directory-conditional-access-device-registration-overview.md)               |\n| Devices will discover your Azure Active Directory Device Registration Service by looking for well-known DNS records. You must configure your company DNS so that devices can discover your Azure Active Directory Device Registration Service.                                                                                                                                                   | [Configure Azure Active Directory Device Registration discovery.](active-directory-conditional-access-device-registration-overview.md) |\n\n##Part 2: Deploy and configure Windows Server 2012 R2 Active Directory Federation Services and set up a federation relationship with Azure AD\n\n| Task                                                                                                                                                                                                                                                                                                                                                                                             | Reference                                                       |\n|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n| Deploy Active Directory Domain Services domain with the Windows Server 2012 R2 schema extensions. You do not need to upgrade any of your domain controllers to Windows Server 2012 R2. The schema upgrade is the only requirement. | [Upgrade your Active Directory Domain Services Schema](#Upgrade your Active Directory Domain Services Schema)               |\n| Devices will discover your Azure Active Directory Device Registration Service by looking for well-known DNS records. You must configure your company DNS so that devices can discover your Azure Active Directory Device Registration Service.                                                                                                                                                   | [Prepare your Active Directory support devices](#Prepare your Active Directory to support devices) |\n\n\n##Part 3: Enable device writeback in Azure AD\n\n| Task                                                                                                                                                                                                                                                                                                                                                                                             | Reference                                                       |\n|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n| Complete part 2 of Enabling device writeback in Azure AD Connect. Upon completion, return this this guide. | [Enabling device writeback in Azure AD Connect](#Upgrade your Active Directory Domain Services Schema)               |\n     \n\n##[Optional] Part 4: Enable multi-factor authentication\n\nIt is strongly recommended that you configure one of the several options for multi-factor authentication. If you want to require MFA, see [Choose the multi-factor security solution for you](multi-factor-authentication-get-started.md). It includes a description of each solution, and links to help you configure the solution of your choice. \n\n## Part 5: Verification\n\nThe deployment is now complete. You can now try out some scenarios. Follow the links below to experiment with the service and become familiar with the features\n\n\n| Task                                                                                                                                                                                                                         | Reference                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n| Join some devices to your workplace using Azure Active Directory Device Registration. You can join iOS, Windows, and Android devices                                                                                         | [Join devices to your workplace using Azure Active Directory Device Registration](#Join devices to your workplace using Azure Active Directory Device Registration) |\n| You can view and enable/disable registered devices using the Administrator Portal. In this task you will view some registered devices using the Administrator Portal.                                                        | [Azure Active Directory Device Registration Overview](active-directory-conditional-access-device-registration-overview.md)                             |\n| Verify that device objects are written back from Azure Active Directory to Windows Server Active Directory.                                                                                                                  | [Verify registered devices are written-back to Active Directory](#Verify registered devices are written-back to Active Director)                  |\n| Now that users can register their devices, you can create application access polices in AD FS that allow only registered devices. In this task you will create an application access rule and a custom access denied message | [Create an application access policy and custom access denied message](#Create an application access policy and custom access denied message)            |\n\n\n\n## Integrate Azure Active Directory with local Active Directory\nThis will help you integrate your Azure AD tenant with your local active directory, using Azure AD Connect. Although the steps are available in the Azure Portal, make note of any special instructions listed in this section. \n\n1.  Log on to the Azure Portal as Administrator.\n2.  On the left pane, select **Active Directory**.\n3.  On the **Directory** tab, select your directory.\n4.  Select the **Directory Integration** tab.\n5.  Under **deploy and manage** section, follow the steps 1 through 3 to integrate Azure Active Directory with your local directory.\n  1.    Add domains.\n  2.    Install and run Azure AD Connect: Install Azure AD Connect using the following instructions, [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).\n  3. Verify and manage directory sync. Single sign-on instructions are available within this step.\n  >[AZURE.NOTE] Configure Federation with AD FS as outlined in the document linked above. \n  >[AZURE.NOTE] You do not need to configure any of the preview features.\n  \n   \n\n\n## Upgrade your Active Directory Domain Services schema\n> [AZURE.NOTE]\n> Upgrading your Active Directory schema cannot be reversed. It is recommended that you first perform this in a test environment.\n\n1. Log in to your domain controller with an account that has both Enterprise Admin and Schema Admin rights.\n2. Copy the **[media]\\support\\adprep** directory and sub-directories to one of your Active Directory domain controllers. \n3. Where [media] is the path to the Windows Server 2012 R2 installation media.\n4. From a command prompt, navigate to the adprep directory and execute: **adprep.exe /forestprep**. Follow the onscreen instructions to complete the schema upgrade.\n\n## Prepare your Active Directory to support devices\n>[AZURE.NOTE] This is a one-time operation that you must run to prepare your Active Directory forest to support devices. You must be logged on with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema to complete this procedure.\n\n\n##Prepare your Active Directory forest to support devices\n\n> [AZURE.NOTE]\n>This is a one-time operation that you must run to prepare your Active Directory forest to support devices. You must be logged on with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema to complete this procedure.\n\n### Prepare your Active Directory forest\n\n1.  On your federation server, open a Windows PowerShell command window and type:\n     Initialize-ADDeviceRegistration\n2.  When prompted for **ServiceAccountName**, enter the name of the service account you selected as the service account for AD FS. If it is a gMSA account, enter the account in the **domain\\accountname$** format. For a domain account, use the format **domain\\accountname**.\n\n\n\n### Enable device authentication in AD FS\n\n1. On your federation server, open the AD FS management console and navigate to **AD FS** > **Authentication Policies**.\n2. Select **Edit Global Primary Authentication…** from the **Actions** pane.\n3. Check **Enable device authentication** and then select**OK**.\n4. By default, AD FS will periodically remove unused devices from Active Directory. You must disable this task when using Azure Active Directory Device Registration so that devices can be managed in Azure.\n\n\n### Disable unused device cleanup\n1. On your federation server, open a Windows PowerShell command window and type:\n    Set-AdfsDeviceRegistration -MaximumInactiveDays 0\n\n### Prepare Azure AD Connect for device writeback\n\n1.  Complete Part 1: Prepare AAD Connect. \n\n\n## Join devices to your workplace using Azure Active Directory Device Registration\n\n### Join an iOS device using Azure Active Directory Device Registration\n\nAzure Active Directory Device Registration uses the Over-the-Air Profile enrollment process for iOS devices. This process begins with the user connecting to the profile enrollment URL using the Safari web browser. The URL format is as follows:\n\n    https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/\"yourdomainname\"\n\nWhere `yourdomainname` is the domain name that you have configured with Azure Active Directory. For example, if your domain name is contoso.com, the URL would be:\n\n    https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/contoso.com\n\nThere are many different ways to communicate this URL to your users. One recommended way is to publish this URL in a custom application access denied message in AD FS. This is covered in the upcoming section: [Create an application access policy and custom access denied message](#Create an application access policy and custom access denied message).\n\n###Join a Windows 8.1 device using Azure Active Directory Device Registration\n\n1. On your Windows 8.1 device, navigate to **PC Settings** > **Network** > **Workplace**.\n2. Enter your user name in UPN format. For example, dan@contoso.com..\n3. Select **Join**.\n4. When prompted, sign-in with your credentials. The device is now joined.\n\n### Join an Android device using Azure Active Directory Device Registration\n\nThe [Azure Authenticator for Android topic](active-directory-conditional-access-azure-authenticator-app.md) has instructions on how to install Azure authenticator app on your Android device and add a work account. When a work account is created successfully on an Android device, that device is workplace joined to the organization.\n\n## Verify registered devices are written-back to Active Directory\nYou can view and verify that your device objects have been written back to your Active Directory using LDP.exe or ADSI Edit. Both are available with the Active Directory Administrator tools.\n\nBy default, device objects that are written-back from Azure Active Directory will be placed in the same domain as your AD FS farm.\n\n    CN=RegisteredDevices,defaultNamingContext\n\n## Create an application access policy and custom access denied message\nConsider the following scenario: You create an application Relying Party Trust in AD FS and configure an Issuance Authorization Rule that allows only registered devices. Now only devices that are registered are allowed to access the application. To make it easy for your users to gain access to the application, you configure a custom access denied message that includes instructions on how to join their device. Now your users have a seamless way to register their devices in order to access an application.\n\nThe following steps will show you how to implement this scenario.\n>[AZURE.NOTE]\nThis section assumes that you have already configured a Relying Party Trust for your application in AD FS.\n\n1. Open the AD FS MMC tool and navigate to AD FS > Trust Relationships > Relying Party Trusts.\n2. Locate the application for which this new access rule will apply. Right-click the application and select Edit Claim Rules…\n3. Select the **Issuance Authorization Rules** tab and then select **Add Rule…**\n4. From the **Claim rule** template drop down list, select **Permit or Deny Users Based on an Incoming Claim**. Select **Next**.\n5. In the Claim Rule name: field type: **Permit access from registered devices**\n6. From the Incoming claim type: drop down list, select **Is Registered User**.\n7. In the Incoming claim value: field, type: **true**\n8. Select the **Permit access to users with this incoming claim** radio button.\n9. Select **Finish** and then select **Apply**.\n10. Remove any rules that are more permissive than the rule you just created. For example, remove the default **Permit Access to all Users** rule.\n\nYour application is now configured to allow access only when the user is coming from a device that they registered and joined to the workplace. For more advanced access polices, see [Manage Risk with Multi-Factor Access Control](https://technet.microsoft.com/library/dn280949.aspx).\n\nNext, you will configure a custom error message for your application. The error message will let users know that they must join their device to the workplace before they are allowed access to the application. You can create a custom application access denied message using custom HTML and Windows PowerShell.\n\nOn your federation server, open a Windows PowerShell command window and type the following command. Replace portions of the command with items that are specific to your system:\n\n    Set-AdfsRelyingPartyWebContent -Name \"relying party trust name\" -ErrorPageAuthorizationErrorMessage\nYou must register your device before you can access this application.\n\n**If you are using an iOS device, select this link to join your device**: \n\n    a href='https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/yourdomain.com\n\nJoin this iOS device to your workplace.\n\n\n**If you are using a Windows 8.1 device**, you can join your device by going to **PC Settings **> **Network** > **Workplace**.\n\n\nWhere \"**relying party trust name**\" is the name of your applications Relying Party Trust object in AD FS. \nWhere **yourdomain.com** is the domain name that you have configured with Azure Active Directory. For example, contoso.com. \nBe sure to remove any line breaks (if any) from the html content that you pass to the **Set-AdfsRelyingPartyWebContent** cmdlet.\n\n\nNow when users access your application from a device that is not registered with the Azure Active Directory Device Registration Service, they will receive a page that looks similar to the screen shot below. \n\n![Screeshot of an error when users haven't registered their device with Azure AD](./media/active-directory-conditional-access/error-azureDRS-device-not-registered.gif)\n\n"
}