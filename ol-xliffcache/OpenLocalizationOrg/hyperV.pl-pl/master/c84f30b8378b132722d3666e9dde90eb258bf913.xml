{
  "nodes": [
    {
      "content": "What happened to my MVC project (Visual Studio Azure Active Directory connected service) | Microsoft Azure",
      "pos": [
        27,
        133
      ]
    },
    {
      "content": "Describes what happens to your MVC project when you connect to Azure AD by using Visual Studio connected services",
      "pos": [
        153,
        266
      ]
    },
    {
      "content": "What happened to my MVC project (Visual Studio Azure Active Directory connected service)?",
      "pos": [
        591,
        680
      ]
    },
    {
      "content": "[AZURE.SELECTOR]",
      "pos": [
        684,
        700
      ]
    },
    {
      "content": "Getting Started",
      "pos": [
        706,
        721
      ]
    },
    {
      "content": "What Happened",
      "pos": [
        775,
        788
      ]
    },
    {
      "content": "References have been added",
      "pos": [
        841,
        867
      ]
    },
    {
      "content": "NuGet package references",
      "pos": [
        873,
        897
      ]
    },
    {
      "content": "Microsoft.IdentityModel.Protocol.Extensions",
      "pos": [
        903,
        946
      ]
    },
    {
      "content": "Microsoft.Owin",
      "pos": [
        953,
        967
      ]
    },
    {
      "content": "Microsoft.Owin.Host.SystemWeb",
      "pos": [
        974,
        1003
      ]
    },
    {
      "content": "Microsoft.Owin.Security",
      "pos": [
        1010,
        1033
      ]
    },
    {
      "content": "Microsoft.Owin.Security.Cookies",
      "pos": [
        1040,
        1071
      ]
    },
    {
      "content": "Microsoft.Owin.Security.OpenIdConnect",
      "pos": [
        1078,
        1115
      ]
    },
    {
      "content": "Owin",
      "pos": [
        1122,
        1126
      ]
    },
    {
      "content": "System.IdentityModel.Tokens.Jwt",
      "pos": [
        1133,
        1164
      ]
    },
    {
      "content": ".NET references",
      "pos": [
        1172,
        1187
      ]
    },
    {
      "content": "Microsoft.IdentityModel.Protocol.Extensions",
      "pos": [
        1193,
        1236
      ]
    },
    {
      "content": "Microsoft.Owin",
      "pos": [
        1243,
        1257
      ]
    },
    {
      "content": "Microsoft.Owin.Host.SystemWeb",
      "pos": [
        1264,
        1293
      ]
    },
    {
      "content": "Microsoft.Owin.Security",
      "pos": [
        1300,
        1323
      ]
    },
    {
      "content": "Microsoft.Owin.Security.Cookies",
      "pos": [
        1330,
        1361
      ]
    },
    {
      "content": "Microsoft.Owin.Security.OpenIdConnect",
      "pos": [
        1368,
        1405
      ]
    },
    {
      "content": "Owin",
      "pos": [
        1412,
        1416
      ]
    },
    {
      "content": "System.IdentityModel",
      "pos": [
        1423,
        1443
      ]
    },
    {
      "content": "System.IdentityModel.Tokens.Jwt",
      "pos": [
        1450,
        1481
      ]
    },
    {
      "content": "System.Runtime.Serialization",
      "pos": [
        1488,
        1516
      ]
    },
    {
      "content": "Code has been added",
      "pos": [
        1523,
        1542
      ]
    },
    {
      "content": "Code files were added to your project",
      "pos": [
        1548,
        1585
      ]
    },
    {
      "content": "An authentication startup class, <bpt id=\"p1\">**</bpt>App_Start/Startup.Auth.cs<ept id=\"p1\">**</ept> was added to your project containing startup logic for Azure AD authentication.",
      "pos": [
        1587,
        1729
      ]
    },
    {
      "content": "Also, a controller class, Controllers/AccountController.cs was added which contains <bpt id=\"p1\">**</bpt>SignIn()<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SignOut()<ept id=\"p2\">**</ept> methods.",
      "pos": [
        1730,
        1853
      ]
    },
    {
      "content": "Finally, a partial view, <bpt id=\"p1\">**</bpt>Views/Shared/_LoginPartial.cshtml<ept id=\"p1\">**</ept> was added containing an action link for SignIn/SignOut.",
      "pos": [
        1854,
        1972
      ]
    },
    {
      "content": "Startup code was added to your project",
      "pos": [
        1978,
        2016
      ]
    },
    {
      "content": "If you already had a Startup class in your project, the <bpt id=\"p1\">**</bpt>Configuration<ept id=\"p1\">**</ept> method was updated to include a call to <bpt id=\"p2\">**</bpt>ConfigureAuth(app)<ept id=\"p2\">**</ept>.",
      "pos": [
        2018,
        2155
      ]
    },
    {
      "content": "Otherwise, a Startup class was added to your project.",
      "pos": [
        2156,
        2209
      ]
    },
    {
      "content": "Your app.config or web.config has new configuration values",
      "pos": [
        2215,
        2273
      ]
    },
    {
      "content": "The following configuration entries have been added.",
      "pos": [
        2275,
        2327
      ]
    },
    {
      "content": "An Azure Active Directory (AD) App was created",
      "pos": [
        2764,
        2810
      ]
    },
    {
      "content": "An Azure AD Application was created in the directory that you selected in the wizard.",
      "pos": [
        2811,
        2896
      ]
    },
    {
      "content": "If I checked <bpt id=\"p1\">*</bpt>disable Individual User Accounts authentication<ept id=\"p1\">*</ept>, what additional changes were made to my project?",
      "pos": [
        2900,
        3012
      ]
    },
    {
      "content": "NuGet package references were removed, and files were removed and backed up.",
      "pos": [
        3013,
        3089
      ]
    },
    {
      "content": "Depending on the state of your project, you may have to manually remove additional references or files, or modify code as appropriate.",
      "pos": [
        3090,
        3224
      ]
    },
    {
      "content": "NuGet package references removed (for those present)",
      "pos": [
        3230,
        3282
      ]
    },
    {
      "content": "Microsoft.AspNet.Identity.Core",
      "pos": [
        3288,
        3318
      ]
    },
    {
      "content": "Microsoft.AspNet.Identity.EntityFramework",
      "pos": [
        3325,
        3366
      ]
    },
    {
      "content": "Microsoft.AspNet.Identity.Owin",
      "pos": [
        3373,
        3403
      ]
    },
    {
      "content": "Code files backed up and removed (for those present)",
      "pos": [
        3411,
        3463
      ]
    },
    {
      "content": "Each of following files was backed up and removed from the project.",
      "pos": [
        3465,
        3532
      ]
    },
    {
      "content": "Backup files are located in a 'Backup' folder at the root of the project's directory.",
      "pos": [
        3533,
        3618
      ]
    },
    {
      "content": "App_Start\\IdentityConfig.cs",
      "pos": [
        3624,
        3651
      ]
    },
    {
      "content": "Controllers\\ManageController.cs",
      "pos": [
        3658,
        3689
      ]
    },
    {
      "content": "Models\\IdentityModels.cs",
      "pos": [
        3696,
        3720
      ]
    },
    {
      "content": "Models\\ManageViewModels.cs",
      "pos": [
        3727,
        3753
      ]
    },
    {
      "content": "Code files backed up (for those present)",
      "pos": [
        3761,
        3801
      ]
    },
    {
      "content": "Each of following files was backed up before being replaced.",
      "pos": [
        3803,
        3863
      ]
    },
    {
      "content": "Backup files are located in a 'Backup' folder at the root of the project's directory.",
      "pos": [
        3864,
        3949
      ]
    },
    {
      "content": "Startup.cs",
      "pos": [
        3955,
        3965
      ]
    },
    {
      "content": "App_Start\\Startup.Auth.cs",
      "pos": [
        3972,
        3997
      ]
    },
    {
      "content": "Controllers\\AccountController.cs",
      "pos": [
        4004,
        4036
      ]
    },
    {
      "content": "Views\\Shared\\_LoginPartial.cshtml",
      "pos": [
        4043,
        4076
      ]
    },
    {
      "pos": [
        4083,
        4167
      ],
      "content": "If I checked <bpt id=\"p1\">*</bpt>Read directory data<ept id=\"p1\">*</ept>, what additional changes were made to my project?"
    },
    {
      "content": "Additional references have been added.",
      "pos": [
        4169,
        4207
      ]
    },
    {
      "content": "Additional NuGet package references",
      "pos": [
        4212,
        4247
      ]
    },
    {
      "content": "EntityFramework",
      "pos": [
        4253,
        4268
      ]
    },
    {
      "content": "Microsoft.Azure.ActiveDirectory.GraphClient",
      "pos": [
        4275,
        4318
      ]
    },
    {
      "content": "Microsoft.Data.Edm",
      "pos": [
        4325,
        4343
      ]
    },
    {
      "content": "Microsoft.Data.OData",
      "pos": [
        4350,
        4370
      ]
    },
    {
      "content": "Microsoft.Data.Services.Client",
      "pos": [
        4377,
        4407
      ]
    },
    {
      "content": "Microsoft.IdentityModel.Clients.ActiveDirectory",
      "pos": [
        4414,
        4461
      ]
    },
    {
      "content": "System.Spatial",
      "pos": [
        4468,
        4482
      ]
    },
    {
      "content": "Additional .NET references",
      "pos": [
        4489,
        4515
      ]
    },
    {
      "content": "EntityFramework",
      "pos": [
        4521,
        4536
      ]
    },
    {
      "content": "EntityFramework.SqlServer",
      "pos": [
        4543,
        4568
      ]
    },
    {
      "content": "Microsoft.Azure.ActiveDirectory.GraphClient",
      "pos": [
        4575,
        4618
      ]
    },
    {
      "content": "Microsoft.Data.Edm",
      "pos": [
        4625,
        4643
      ]
    },
    {
      "content": "Microsoft.Data.OData",
      "pos": [
        4650,
        4670
      ]
    },
    {
      "content": "Microsoft.Data.Services.Client",
      "pos": [
        4677,
        4707
      ]
    },
    {
      "content": "Microsoft.IdentityModel.Clients.ActiveDirectory",
      "pos": [
        4714,
        4761
      ]
    },
    {
      "content": "Microsoft.IdentityModel.Clients.ActiveDirectory.WindowsForms",
      "pos": [
        4768,
        4828
      ]
    },
    {
      "content": "System.Spatial",
      "pos": [
        4835,
        4849
      ]
    },
    {
      "content": "Additional Code files were added to your project",
      "pos": [
        4856,
        4904
      ]
    },
    {
      "content": "Two files were added to support token caching: <bpt id=\"p1\">**</bpt>Models\\ADALTokenCache.cs<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Models\\ApplicationDbContext.cs<ept id=\"p2\">**</ept>.",
      "pos": [
        4906,
        5021
      ]
    },
    {
      "content": "An additional controller and view were added to illustrate accessing user profile information using Azure graph APIs.",
      "pos": [
        5023,
        5140
      ]
    },
    {
      "content": "These files are <bpt id=\"p1\">**</bpt>Controllers\\UserProfileController.cs<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Views\\UserProfile\\Index.cshtml<ept id=\"p2\">**</ept>.",
      "pos": [
        5142,
        5238
      ]
    },
    {
      "content": "Additional Startup code was added to your project",
      "pos": [
        5243,
        5292
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>startup.auth.cs<ept id=\"p1\">**</ept> file, a new <bpt id=\"p2\">**</bpt>OpenIdConnectAuthenticationNotifications<ept id=\"p2\">**</ept> object was added to the <bpt id=\"p3\">**</bpt>Notifications<ept id=\"p3\">**</ept> member of the <bpt id=\"p4\">**</bpt>OpenIdConnectAuthenticationOptions<ept id=\"p4\">**</ept>.",
      "pos": [
        5294,
        5473
      ]
    },
    {
      "content": "This is to enable receiving the OAuth code and exchange it for an access token.",
      "pos": [
        5475,
        5554
      ]
    },
    {
      "content": "Additional changes were made to your app.config or web.config",
      "pos": [
        5559,
        5620
      ]
    },
    {
      "content": "The following additional configuration entries have been added.",
      "pos": [
        5622,
        5685
      ]
    },
    {
      "content": "The following configuration sections and connection string have been added.",
      "pos": [
        5810,
        5885
      ]
    },
    {
      "content": "Your Azure Active Directory App was updated",
      "pos": [
        7083,
        7126
      ]
    },
    {
      "content": "Your Azure Active Directory App was updated to include the <bpt id=\"p1\">*</bpt>Read directory data<ept id=\"p1\">*</ept> permission and an additional key was created which was then used as the <bpt id=\"p2\">*</bpt>ida:ClientSecret<ept id=\"p2\">*</ept> in the <bpt id=\"p3\">**</bpt>web.config<ept id=\"p3\">**</ept> file.",
      "pos": [
        7127,
        7326
      ]
    },
    {
      "content": "Learn more about Azure Active Directory",
      "pos": [
        7329,
        7368
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"What happened to my MVC project (Visual Studio Azure Active Directory connected service) | Microsoft Azure \"\n    description=\"Describes what happens to your MVC project when you connect to Azure AD by using Visual Studio connected services\"\n    services=\"active-directory\"\n    documentationCenter=\"na\"\n    authors=\"TomArcher\"\n    manager=\"douge\"\n    editor=\"tglee\"/>\n\n<tags\n    ms.service=\"active-directory\"\n    ms.workload=\"web\"\n    ms.tgt_pltfrm=\"vs-what-happened\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"09/03/2015\"\n    ms.author=\"tarcher\"/>\n\n# What happened to my MVC project (Visual Studio Azure Active Directory connected service)?\n\n> [AZURE.SELECTOR]\n> - [Getting Started](vs-active-directory-dotnet-getting-started.md)\n> - [What Happened](vs-active-directory-dotnet-what-happened.md)\n\n\n\n## References have been added\n\n### NuGet package references\n\n- **Microsoft.IdentityModel.Protocol.Extensions**\n- **Microsoft.Owin**\n- **Microsoft.Owin.Host.SystemWeb**\n- **Microsoft.Owin.Security**\n- **Microsoft.Owin.Security.Cookies**\n- **Microsoft.Owin.Security.OpenIdConnect**\n- **Owin**\n- **System.IdentityModel.Tokens.Jwt**\n\n### .NET references\n\n- **Microsoft.IdentityModel.Protocol.Extensions**\n- **Microsoft.Owin**\n- **Microsoft.Owin.Host.SystemWeb**\n- **Microsoft.Owin.Security**\n- **Microsoft.Owin.Security.Cookies**\n- **Microsoft.Owin.Security.OpenIdConnect**\n- **Owin**\n- **System.IdentityModel**\n- **System.IdentityModel.Tokens.Jwt**\n- **System.Runtime.Serialization**\n\n## Code has been added\n\n### Code files were added to your project\n\nAn authentication startup class, **App_Start/Startup.Auth.cs** was added to your project containing startup logic for Azure AD authentication. Also, a controller class, Controllers/AccountController.cs was added which contains **SignIn()** and **SignOut()** methods. Finally, a partial view, **Views/Shared/_LoginPartial.cshtml** was added containing an action link for SignIn/SignOut.\n\n### Startup code was added to your project\n\nIf you already had a Startup class in your project, the **Configuration** method was updated to include a call to **ConfigureAuth(app)**. Otherwise, a Startup class was added to your project.\n\n### Your app.config or web.config has new configuration values\n\nThe following configuration entries have been added.\n\n\n    <appSettings>\n        <add key=\"ida:ClientId\" value=\"ClientId from the new Azure AD App\" />\n        <add key=\"ida:AADInstance\" value=\"https://login.microsoftonline.com/\" />\n        <add key=\"ida:Domain\" value=\"The selected Azure AD Domain\" />\n        <add key=\"ida:TenantId\" value=\"The Id of your selected Azure AD Tenant\" />\n        <add key=\"ida:PostLogoutRedirectUri\" value=\"Your project start page\" />\n    </appSettings>\n\n### An Azure Active Directory (AD) App was created\nAn Azure AD Application was created in the directory that you selected in the wizard.\n\n##If I checked *disable Individual User Accounts authentication*, what additional changes were made to my project?\nNuGet package references were removed, and files were removed and backed up. Depending on the state of your project, you may have to manually remove additional references or files, or modify code as appropriate.\n\n### NuGet package references removed (for those present)\n\n- **Microsoft.AspNet.Identity.Core**\n- **Microsoft.AspNet.Identity.EntityFramework**\n- **Microsoft.AspNet.Identity.Owin**\n\n### Code files backed up and removed (for those present)\n\nEach of following files was backed up and removed from the project. Backup files are located in a 'Backup' folder at the root of the project's directory.\n\n- **App_Start\\IdentityConfig.cs**\n- **Controllers\\ManageController.cs**\n- **Models\\IdentityModels.cs**\n- **Models\\ManageViewModels.cs**\n\n### Code files backed up (for those present)\n\nEach of following files was backed up before being replaced. Backup files are located in a 'Backup' folder at the root of the project's directory.\n\n- **Startup.cs**\n- **App_Start\\Startup.Auth.cs**\n- **Controllers\\AccountController.cs**\n- **Views\\Shared\\_LoginPartial.cshtml**\n\n## If I checked *Read directory data*, what additional changes were made to my project?\n\nAdditional references have been added.\n\n###Additional NuGet package references\n\n- **EntityFramework**\n- **Microsoft.Azure.ActiveDirectory.GraphClient**\n- **Microsoft.Data.Edm**\n- **Microsoft.Data.OData**\n- **Microsoft.Data.Services.Client**\n- **Microsoft.IdentityModel.Clients.ActiveDirectory**\n- **System.Spatial**\n\n###Additional .NET references\n\n- **EntityFramework**\n- **EntityFramework.SqlServer**\n- **Microsoft.Azure.ActiveDirectory.GraphClient**\n- **Microsoft.Data.Edm**\n- **Microsoft.Data.OData**\n- **Microsoft.Data.Services.Client**\n- **Microsoft.IdentityModel.Clients.ActiveDirectory**\n- **Microsoft.IdentityModel.Clients.ActiveDirectory.WindowsForms**\n- **System.Spatial**\n\n###Additional Code files were added to your project\n\nTwo files were added to support token caching: **Models\\ADALTokenCache.cs** and **Models\\ApplicationDbContext.cs**.  An additional controller and view were added to illustrate accessing user profile information using Azure graph APIs.  These files are **Controllers\\UserProfileController.cs** and **Views\\UserProfile\\Index.cshtml**.\n\n###Additional Startup code was added to your project\n\nIn the **startup.auth.cs** file, a new **OpenIdConnectAuthenticationNotifications** object was added to the **Notifications** member of the **OpenIdConnectAuthenticationOptions**.  This is to enable receiving the OAuth code and exchange it for an access token.\n\n###Additional changes were made to your app.config or web.config\n\nThe following additional configuration entries have been added.\n\n    <appSettings>\n        <add key=\"ida:ClientSecret\" value=\"Your Azure AD App's new client secret\" />\n    </appSettings>\n\nThe following configuration sections and connection string have been added.\n\n    <configSections>\n        <!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 -->\n        <section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" />\n    </configSections>\n    <connectionStrings>\n        <add name=\"DefaultConnection\" connectionString=\"Data Source=(localdb)\\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\\aspnet-[AppName + Generated Id].mdf;Initial Catalog=aspnet-[AppName + Generated Id];Integrated Security=True\" providerName=\"System.Data.SqlClient\" />\n    </connectionStrings>\n    <entityFramework>\n        <defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\">\n          <parameters>\n            <parameter value=\"mssqllocaldb\" />\n          </parameters>\n        </defaultConnectionFactory>\n        <providers>\n          <provider invariantName=\"System.Data.SqlClient\" type=\"System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer\" />\n        </providers>\n    </entityFramework>\n\n\n###Your Azure Active Directory App was updated\nYour Azure Active Directory App was updated to include the *Read directory data* permission and an additional key was created which was then used as the *ida:ClientSecret* in the **web.config** file.\n\n[Learn more about Azure Active Directory](http://azure.microsoft.com/services/active-directory/)\n\n\n"
}