{
  "nodes": [
    {
      "content": "Run the HPC Pack IaaS deployment PowerShell script on a client",
      "pos": [
        4,
        66
      ]
    },
    {
      "content": "computer to deploy a complete HPC Pack cluster in Azure infrastructure",
      "pos": [
        67,
        137
      ]
    },
    {
      "content": "services (IaaS).",
      "pos": [
        138,
        154
      ]
    },
    {
      "content": "The script provides several deployment options, and can add cluster compute nodes running supported Linux",
      "pos": [
        155,
        260
      ]
    },
    {
      "content": "distributions or Windows Server operating systems.",
      "pos": [
        261,
        311
      ]
    },
    {
      "content": "Depending on your environment and choices, the script can create all the cluster infrastructure, including the Azure virtual network, storage accounts, cloud services, domain controller, remote or local SQL databases, head node, broker nodes, compute nodes, and Azure cloud service (“burst”, or PaaS) nodes.",
      "pos": [
        313,
        620
      ]
    },
    {
      "content": "Alternatively, the script can use pre-existing Azure infrastructure and then create the HPC cluster head node, broker nodes, compute nodes, and Azure burst nodes.",
      "pos": [
        621,
        783
      ]
    },
    {
      "pos": [
        786,
        1059
      ],
      "content": "For background information about planning an HPC Pack cluster, see the <bpt id=\"p1\">[</bpt>Product Evaluation and Planning<ept id=\"p1\">](https://technet.microsoft.com/library/jj899596.aspx)</ept> and <bpt id=\"p2\">[</bpt>Getting Started<ept id=\"p2\">](https://technet.microsoft.com/library/jj899590.aspx)</ept> content in the HPC Pack TechNet Library."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>You can also use an Azure Resource Manager template to deploy an HPC Pack cluster.",
      "pos": [
        1062,
        1156
      ]
    },
    {
      "content": "For an example, see <bpt id=\"p1\">[</bpt>Create an HPC cluster<ept id=\"p1\">](https://azure.microsoft.com/documentation/templates/create-hpc-cluster/)</ept>, <bpt id=\"p2\">[</bpt>Create an HPC cluster with a custom compute node image<ept id=\"p2\">](https://azure.microsoft.com/documentation/templates/create-hpc-cluster-custom-image/)</ept>, or <bpt id=\"p3\">[</bpt>Create an HPC cluster with Linux compute nodes<ept id=\"p3\">](https://azure.microsoft.com/documentation/templates/create-hpc-cluster-linux-cn/)</ept>.",
      "pos": [
        1157,
        1553
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        1558,
        1571
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Azure subscription<ept id=\"p1\">**</ept> - You can use a subscription in either the Azure Global or Azure China service.",
      "pos": [
        1575,
        1677
      ]
    },
    {
      "content": "Your subscription limits will affect the number and type of cluster nodes you can deploy.",
      "pos": [
        1678,
        1767
      ]
    },
    {
      "content": "For information, see <bpt id=\"p1\">[</bpt>Azure subscription and service limits, quotas, and constraints<ept id=\"p1\">](../articles/azure-subscription-service-limits.md)</ept>.",
      "pos": [
        1768,
        1904
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Windows client computer with Azure PowerShell 0.8.7 or later installed and configured<ept id=\"p1\">**</ept> - See <bpt id=\"p2\">[</bpt>Install and configure Azure PowerShell<ept id=\"p2\">](../articles/powershell-install-configure.md)</ept>.",
      "pos": [
        1909,
        2091
      ]
    },
    {
      "content": "The script runs in Azure Service Management.",
      "pos": [
        2092,
        2136
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>HPC Pack IaaS deployment script<ept id=\"p1\">**</ept> - Download and unpack the latest version of the script from the <bpt id=\"p2\">[</bpt>Microsoft Download Center<ept id=\"p2\">](https://www.microsoft.com/download/details.aspx?id=44949)</ept>.",
      "pos": [
        2141,
        2327
      ]
    },
    {
      "content": "Check the version of the script by running <ph id=\"ph1\">`New-HPCIaaSCluster.ps1 –Version`</ph>.",
      "pos": [
        2328,
        2405
      ]
    },
    {
      "content": "This article is based on version 4.4.0 of the script.",
      "pos": [
        2406,
        2459
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Script configuration file<ept id=\"p1\">**</ept> - You'll need to create an XML file that the script uses to configure the HPC cluster.",
      "pos": [
        2463,
        2579
      ]
    },
    {
      "content": "For information and examples, see sections later in this article.",
      "pos": [
        2580,
        2645
      ]
    },
    {
      "content": "Syntax",
      "pos": [
        2651,
        2657
      ]
    },
    {
      "pos": [
        2890,
        2946
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>You must run the script as an administrator."
    },
    {
      "content": "Parameters",
      "pos": [
        2952,
        2962
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>ConfigFile<ept id=\"p1\">**</ept> - Specifies the file path of the configuration file to describe the HPC cluster.",
      "pos": [
        2966,
        3061
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Configuration file<ept id=\"p1\">](#Configuration-file)</ept> in this topic, or the file Manual.rtf, in the folder containing the script.",
      "pos": [
        3062,
        3205
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>AdminUserName<ept id=\"p1\">**</ept> - Specifies the user name.",
      "pos": [
        3209,
        3253
      ]
    },
    {
      "content": "If the domain forest is created by the script, this becomes the local administrator user name for all VMs as well as the domain administrator name.",
      "pos": [
        3254,
        3401
      ]
    },
    {
      "content": "If the domain forest already exists, this specifies the domain user as the local administrator user name to install HPC Pack.",
      "pos": [
        3402,
        3527
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>AdminPassword<ept id=\"p1\">**</ept> - Specifies the administrator’s password.",
      "pos": [
        3531,
        3590
      ]
    },
    {
      "content": "If not specified in the command line, the script will prompt you to input the password.",
      "pos": [
        3591,
        3678
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>HPCImageName<ept id=\"p1\">**</ept> (optional) - Specifies the HPC Pack VM image name used to deploy the HPC cluster.",
      "pos": [
        3682,
        3780
      ]
    },
    {
      "content": "It must be a Microsoft-provided HPC Pack image from the Azure Marketplace.",
      "pos": [
        3781,
        3855
      ]
    },
    {
      "content": "If not specified (recommended in most cases), the script chooses the latest published HPC Pack image.",
      "pos": [
        3856,
        3957
      ]
    },
    {
      "pos": [
        3964,
        4042
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Deployment will fail if you don't specify a valid HPC Pack image."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>LogFile<ept id=\"p1\">**</ept> (optional) - Specifies the deployment log file path.",
      "pos": [
        4046,
        4110
      ]
    },
    {
      "content": "If not specified, the script will create a log file in the temp directory of the computer running the script.",
      "pos": [
        4111,
        4220
      ]
    },
    {
      "pos": [
        4224,
        4287
      ],
      "content": "<bpt id=\"p1\">**</bpt>Force<ept id=\"p1\">**</ept> (optional) - Suppresses all the confirmation prompts."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>NoCleanOnFailure<ept id=\"p1\">**</ept> (optional) - Specifies that the Azure VMs that are not successfully deployed will not be removed.",
      "pos": [
        4291,
        4409
      ]
    },
    {
      "content": "You must remove these VMs manually before rerunning the script to continue the deployment, or the deployment may fail.",
      "pos": [
        4410,
        4528
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>PSSessionSkipCACheck<ept id=\"p1\">**</ept> (optional) - For every cloud service with VMs deployed by this script, a self-signed certificate is automatically generated by Azure, and all the VMs in the cloud service use this certificate as the default Windows Remote Management (WinRM) certificate.",
      "pos": [
        4532,
        4810
      ]
    },
    {
      "content": "To deploy HPC features in these Azure VMs, the script by default temporarily installs these certificates in the Local Computer\\\\Trusted Root Certification Authorities store of the client computer to suppress the “not trusted CA” security error during script execution; the certificates are removed when the script finishes.",
      "pos": [
        4811,
        5134
      ]
    },
    {
      "content": "If this parameter is specified, the certificates are not installed in the client computer, and the security warning is suppressed.",
      "pos": [
        5135,
        5265
      ]
    },
    {
      "pos": [
        5272,
        5351
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> This parameter is not recommended for production deployments."
    },
    {
      "content": "Example",
      "pos": [
        5357,
        5364
      ]
    },
    {
      "content": "The following example creates a new HPC Pack cluster using the",
      "pos": [
        5366,
        5428
      ]
    },
    {
      "content": "configuration file <bpt id=\"p1\">*</bpt>MyConfigFile.xml<ept id=\"p1\">*</ept>, and specifies administrative",
      "pos": [
        5429,
        5496
      ]
    },
    {
      "content": "credentials for installing the cluster.",
      "pos": [
        5497,
        5536
      ]
    },
    {
      "content": "Additional considerations",
      "pos": [
        5655,
        5680
      ]
    },
    {
      "content": "The script uses the HPC Pack VM image in the Azure Marketplace to create the cluster head node.",
      "pos": [
        5684,
        5779
      ]
    },
    {
      "content": "The latest image is based on Windows Server 2012 R2 Datacenter with HPC Pack 2012 R2 Update 3 installed.",
      "pos": [
        5780,
        5884
      ]
    },
    {
      "content": "The script can optionally enable job submission through the HPC Pack web portal or the HPC Pack REST API.",
      "pos": [
        5888,
        5993
      ]
    },
    {
      "content": "The script can optionally run custom pre- and post-configuration scripts on the head node if you want to install additional software or configure other settings.",
      "pos": [
        5997,
        6158
      ]
    },
    {
      "content": "Configuration file",
      "pos": [
        6164,
        6182
      ]
    },
    {
      "content": "The configuration file for the deployment script is an XML",
      "pos": [
        6184,
        6242
      ]
    },
    {
      "content": "file.",
      "pos": [
        6243,
        6248
      ]
    },
    {
      "content": "The schema file HPCIaaSClusterConfig.xsd is in the HPC Pack IaaS",
      "pos": [
        6249,
        6313
      ]
    },
    {
      "content": "deployment script folder.",
      "pos": [
        6314,
        6339
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>IaaSClusterConfig<ept id=\"p1\">**</ept> is the root element of",
      "pos": [
        6340,
        6384
      ]
    },
    {
      "content": "the configuration file, which contains the child elements described in",
      "pos": [
        6385,
        6455
      ]
    },
    {
      "content": "detail in the file Manual.rtf in the deployment script folder.",
      "pos": [
        6456,
        6518
      ]
    },
    {
      "content": "For example files for different scenarios, see",
      "pos": [
        6519,
        6565
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Example configuration files<ept id=\"p1\">](#Example-configuration-files)</ept> in this article.",
      "pos": [
        6566,
        6642
      ]
    },
    {
      "content": "Example configuration files",
      "pos": [
        6647,
        6674
      ]
    },
    {
      "content": "Example 1",
      "pos": [
        6680,
        6689
      ]
    },
    {
      "content": "The following configuration file deploys an HPC Pack cluster in an existing domain forest.",
      "pos": [
        6691,
        6781
      ]
    },
    {
      "content": "The cluster has 1 head node with local databases and 12 compute nodes with the BGInfo VM extension applied.",
      "pos": [
        6782,
        6889
      ]
    },
    {
      "content": "Automatic installation of Windows updates is disabled for all the VMs in",
      "pos": [
        6890,
        6962
      ]
    },
    {
      "content": "the domain forest.",
      "pos": [
        6963,
        6981
      ]
    },
    {
      "content": "All the cloud services are created directly in the",
      "pos": [
        6982,
        7032
      ]
    },
    {
      "content": "East Asia location.",
      "pos": [
        7033,
        7052
      ]
    },
    {
      "content": "The compute nodes are created in 3 cloud services",
      "pos": [
        7053,
        7102
      ]
    },
    {
      "content": "and 3 storage accounts (i.e., <bpt id=\"p1\">_</bpt>MyHPCCN-0001<ept id=\"p1\">_</ept> to <bpt id=\"p2\">_</bpt>MyHPCCN-0005<ept id=\"p2\">_</ept> in",
      "pos": [
        7103,
        7168
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyHPCCNService01<ept id=\"p1\">_</ept> and <bpt id=\"p2\">_</bpt>mycnstorage01<ept id=\"p2\">_</ept>; <bpt id=\"p3\">_</bpt>MyHPCCN-0006<ept id=\"p3\">_</ept> to <bpt id=\"p4\">_</bpt>MyHPCCN0010<ept id=\"p4\">_</ept> in",
      "pos": [
        7169,
        7243
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyHPCCNService02<ept id=\"p1\">_</ept> and <bpt id=\"p2\">_</bpt>mycnstorage02<ept id=\"p2\">_</ept>; and <bpt id=\"p3\">_</bpt>MyHPCCN-0011<ept id=\"p3\">_</ept> to <bpt id=\"p4\">_</bpt>MyHPCCN-0012<ept id=\"p4\">_</ept> in",
      "pos": [
        7244,
        7323
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyHPCCNService03<ept id=\"p1\">_</ept> and <bpt id=\"p2\">_</bpt>mycnstorage03<ept id=\"p2\">_</ept>).",
      "pos": [
        7324,
        7364
      ]
    },
    {
      "content": "The compute nodes are created from",
      "pos": [
        7365,
        7399
      ]
    },
    {
      "content": "an existing private image captured from a compute node.",
      "pos": [
        7400,
        7455
      ]
    },
    {
      "content": "The auto grow",
      "pos": [
        7456,
        7469
      ]
    },
    {
      "content": "and shrink service is enabled with default grow and shrink intervals.",
      "pos": [
        7470,
        7539
      ]
    },
    {
      "content": "Example 2",
      "pos": [
        9237,
        9246
      ]
    },
    {
      "content": "The following configuration file deploys an HPC Pack cluster",
      "pos": [
        9248,
        9308
      ]
    },
    {
      "content": "in an existing domain forest.",
      "pos": [
        9309,
        9338
      ]
    },
    {
      "content": "The cluster contains 1 head node, 1",
      "pos": [
        9339,
        9374
      ]
    },
    {
      "content": "database server with a 500GB data disk, 2 broker nodes running the Windows",
      "pos": [
        9375,
        9449
      ]
    },
    {
      "content": "Server 2012 R2 operating system, and 5 compute nodes running the Windows",
      "pos": [
        9450,
        9522
      ]
    },
    {
      "content": "Server 2012 R2 operating system.",
      "pos": [
        9523,
        9555
      ]
    },
    {
      "content": "The cloud service MyHPCCNService is",
      "pos": [
        9556,
        9591
      ]
    },
    {
      "content": "created in the affinity group <bpt id=\"p1\">*</bpt>MyIBAffinityGroup<ept id=\"p1\">*</ept>, and all the other cloud",
      "pos": [
        9592,
        9666
      ]
    },
    {
      "content": "services are created in the affinity group <bpt id=\"p1\">*</bpt>MyAffinityGroup<ept id=\"p1\">*</ept>.",
      "pos": [
        9667,
        9728
      ]
    },
    {
      "content": "The HPC Job",
      "pos": [
        9729,
        9740
      ]
    },
    {
      "content": "Scheduler REST API and HPC web portal are enabled on the head node.",
      "pos": [
        9741,
        9808
      ]
    },
    {
      "content": "Example 3",
      "pos": [
        11228,
        11237
      ]
    },
    {
      "content": "The following configuration file creates a new domain forest",
      "pos": [
        11239,
        11299
      ]
    },
    {
      "content": "and Deployments an HPC Pack cluster which has 1 head node with local",
      "pos": [
        11300,
        11368
      ]
    },
    {
      "content": "databases and 20 Linux compute nodes.",
      "pos": [
        11369,
        11406
      ]
    },
    {
      "content": "All the cloud services are created",
      "pos": [
        11407,
        11441
      ]
    },
    {
      "content": "directly in the East Asia location.",
      "pos": [
        11442,
        11477
      ]
    },
    {
      "content": "The Linux compute nodes are created",
      "pos": [
        11478,
        11513
      ]
    },
    {
      "content": "in 4 cloud services and 4 storage accounts (i.e. <bpt id=\"p1\">_</bpt>MyLnxCN-0001<ept id=\"p1\">_</ept> to",
      "pos": [
        11514,
        11580
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyLnxCN-0005<ept id=\"p1\">_</ept> in <bpt id=\"p2\">_</bpt>MyLnxCNService01<ept id=\"p2\">_</ept> and <bpt id=\"p3\">_</bpt>mylnxstorage01<ept id=\"p3\">_</ept>, <bpt id=\"p4\">_</bpt>MyLnxCN-0006<ept id=\"p4\">_</ept> to",
      "pos": [
        11581,
        11657
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyLnxCN-0010<ept id=\"p1\">_</ept> in <bpt id=\"p2\">_</bpt>MyLnxCNService02<ept id=\"p2\">_</ept> and <bpt id=\"p3\">_</bpt>mylnxstorage02<ept id=\"p3\">_</ept>, <bpt id=\"p4\">_</bpt>MyLnxCN-0011<ept id=\"p4\">_</ept> to",
      "pos": [
        11658,
        11734
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyLnxCN-0015<ept id=\"p1\">_</ept> in <bpt id=\"p2\">_</bpt>MyLnxCNService03<ept id=\"p2\">_</ept> and <bpt id=\"p3\">_</bpt>mylnxstorage03<ept id=\"p3\">_</ept>, and <bpt id=\"p4\">_</bpt>MyLnxCN-0016<ept id=\"p4\">_</ept> to",
      "pos": [
        11735,
        11815
      ]
    },
    {
      "content": "<bpt id=\"p1\">_</bpt>MyLnxCN-0020<ept id=\"p1\">_</ept> in <bpt id=\"p2\">_</bpt>MyLnxCNService04<ept id=\"p2\">_</ept> and <bpt id=\"p3\">_</bpt>mylnxstorage04<ept id=\"p3\">_</ept>).",
      "pos": [
        11816,
        11875
      ]
    },
    {
      "content": "The compute nodes",
      "pos": [
        11876,
        11893
      ]
    },
    {
      "content": "are created from an OpenLogic CentOS version 7.0 Linux image.",
      "pos": [
        11894,
        11955
      ]
    },
    {
      "content": "Example 4",
      "pos": [
        13333,
        13342
      ]
    },
    {
      "content": "The following configuration file deploys an HPC Pack cluster",
      "pos": [
        13344,
        13404
      ]
    },
    {
      "content": "which has a head node with local databases and 5 compute nodes running",
      "pos": [
        13405,
        13475
      ]
    },
    {
      "content": "the Windows Server 2008 R2 operating system.",
      "pos": [
        13476,
        13520
      ]
    },
    {
      "content": "All the cloud services are",
      "pos": [
        13521,
        13547
      ]
    },
    {
      "content": "created directly in the East Asia location.",
      "pos": [
        13548,
        13591
      ]
    },
    {
      "content": "The head node acts as domain",
      "pos": [
        13592,
        13620
      ]
    },
    {
      "content": "controller of the domain forest.",
      "pos": [
        13621,
        13653
      ]
    },
    {
      "content": "Example 5",
      "pos": [
        14566,
        14575
      ]
    },
    {
      "content": "The following configuration file deploys an HPC Pack cluster",
      "pos": [
        14577,
        14637
      ]
    },
    {
      "content": "in an existing domain forest.",
      "pos": [
        14638,
        14667
      ]
    },
    {
      "content": "The cluster has 1 head node with local",
      "pos": [
        14668,
        14706
      ]
    },
    {
      "content": "databases, two Azure node templates are created, and 3 Medium size Azure",
      "pos": [
        14707,
        14779
      ]
    },
    {
      "content": "nodes are created for Azure node template <bpt id=\"p1\">_</bpt>AzureTemplate1<ept id=\"p1\">_</ept>.",
      "pos": [
        14780,
        14839
      ]
    },
    {
      "content": "A script file",
      "pos": [
        14840,
        14853
      ]
    },
    {
      "content": "will run on the head node after the head node is configured.",
      "pos": [
        14854,
        14914
      ]
    },
    {
      "content": "Known issues",
      "pos": [
        16892,
        16904
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>“VNet doesn’t exist” error<ept id=\"p1\">**</ept> - If you run the HPC Pack IaaS deployment script to deploy multiple",
      "pos": [
        16909,
        17007
      ]
    },
    {
      "content": "clusters in Azure concurrently under one subscription, one or more",
      "pos": [
        17008,
        17074
      ]
    },
    {
      "content": "deployments may fail with the error “VNet <bpt id=\"p1\">*</bpt>VNet\\_Name<ept id=\"p1\">*</ept> doesn't exist”.",
      "pos": [
        17075,
        17145
      ]
    },
    {
      "content": "If this error occurs, re-run the script for the failed deployment.",
      "pos": [
        17146,
        17212
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Problem accessing the Internet from the Azure virtual network<ept id=\"p1\">**</ept> - If you create an HPC Pack cluster with a new domain controller by using",
      "pos": [
        17216,
        17355
      ]
    },
    {
      "content": "the deployment script, or you manually promote a VM to domain",
      "pos": [
        17356,
        17417
      ]
    },
    {
      "content": "controller, you may experience problems connecting the VMs in the Azure",
      "pos": [
        17418,
        17489
      ]
    },
    {
      "content": "virtual network to the Internet.",
      "pos": [
        17490,
        17522
      ]
    },
    {
      "content": "This can occur if a forwarder DNS",
      "pos": [
        17523,
        17556
      ]
    },
    {
      "content": "server is automatically configured on the domain controller, and this",
      "pos": [
        17557,
        17626
      ]
    },
    {
      "content": "forwarder DNS server doesn’t resolve properly.",
      "pos": [
        17627,
        17673
      ]
    },
    {
      "pos": [
        17679,
        17963
      ],
      "content": "To work around this problem, log on to the domain controller and either\n  remove the forwarder configuration setting or configure a valid\n  forwarder DNS server. To do this, in Server Manager click **Tools** >\n  **DNS** to open DNS Manager, and then double-click **Forwarders**.",
      "leadings": [
        "",
        "  ",
        "  ",
        "  "
      ],
      "nodes": [
        {
          "content": "To work around this problem, log on to the domain controller and either",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "remove the forwarder configuration setting or configure a valid",
          "pos": [
            74,
            137
          ]
        },
        {
          "content": "  forwarder DNS server. To do this, in Server Manager click **Tools** >",
          "pos": [
            138,
            209
          ],
          "nodes": [
            {
              "content": "forwarder DNS server.",
              "pos": [
                2,
                23
              ]
            },
            {
              "content": "To do this, in Server Manager click <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> &gt;",
              "pos": [
                24,
                71
              ]
            }
          ]
        },
        {
          "content": "<bpt id=\"p1\">  **</bpt>DNS<ept id=\"p1\">**</ept> to open DNS Manager, and then double-click <bpt id=\"p2\">**</bpt>Forwarders<ept id=\"p2\">**</ept>.",
          "pos": [
            210,
            278
          ]
        }
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Problem accessing RDMA network from size A8 or A9 VMs<ept id=\"p1\">**</ept> - If you add Windows Server compute node or broker node VMs of size A8 or",
      "pos": [
        17967,
        18098
      ]
    },
    {
      "content": "A9 by using the deployment script, you may experience problems",
      "pos": [
        18099,
        18161
      ]
    },
    {
      "content": "connecting those VMs to the RDMA application network.",
      "pos": [
        18162,
        18215
      ]
    },
    {
      "content": "One reason this",
      "pos": [
        18216,
        18231
      ]
    },
    {
      "content": "can occur is if the HpcVmDrivers extension is not properly installed",
      "pos": [
        18232,
        18300
      ]
    },
    {
      "content": "when the size A8 or A9 VMs are added to the cluster.",
      "pos": [
        18301,
        18353
      ]
    },
    {
      "content": "For example, the",
      "pos": [
        18354,
        18370
      ]
    },
    {
      "content": "extension might be stuck in the installing state.",
      "pos": [
        18371,
        18420
      ]
    },
    {
      "pos": [
        18426,
        18737
      ],
      "content": "To work around this problem, first check the state of the extension in\n  the VMs. If the extension is not properly installed, try removing the\n  nodes from the HPC cluster and then add the nodes again. For example,\n  you can add compute node VMs by running the Add-HpcIaaSNode.ps1 script on the head node.",
      "leadings": [
        "",
        "  ",
        "  ",
        "  "
      ],
      "nodes": [
        {
          "content": "To work around this problem, first check the state of the extension in",
          "pos": [
            0,
            70
          ]
        },
        {
          "content": "the VMs. If the extension is not properly installed, try removing the",
          "pos": [
            73,
            142
          ],
          "nodes": [
            {
              "content": "the VMs.",
              "pos": [
                0,
                8
              ]
            },
            {
              "content": "If the extension is not properly installed, try removing the",
              "pos": [
                9,
                69
              ]
            }
          ]
        },
        {
          "content": "nodes from the HPC cluster and then add the nodes again. For example,",
          "pos": [
            145,
            214
          ],
          "nodes": [
            {
              "content": "nodes from the HPC cluster and then add the nodes again.",
              "pos": [
                0,
                56
              ]
            },
            {
              "content": "For example,",
              "pos": [
                57,
                69
              ]
            }
          ]
        },
        {
          "content": "you can add compute node VMs by running the Add-HpcIaaSNode.ps1 script on the head node.",
          "pos": [
            217,
            305
          ]
        }
      ]
    }
  ],
  "content": "\n\n\n\nRun the HPC Pack IaaS deployment PowerShell script on a client\ncomputer to deploy a complete HPC Pack cluster in Azure infrastructure\nservices (IaaS). The script provides several deployment options, and can add cluster compute nodes running supported Linux\ndistributions or Windows Server operating systems.\n\nDepending on your environment and choices, the script can create all the cluster infrastructure, including the Azure virtual network, storage accounts, cloud services, domain controller, remote or local SQL databases, head node, broker nodes, compute nodes, and Azure cloud service (“burst”, or PaaS) nodes. Alternatively, the script can use pre-existing Azure infrastructure and then create the HPC cluster head node, broker nodes, compute nodes, and Azure burst nodes.\n\n\nFor background information about planning an HPC Pack cluster, see the [Product Evaluation and Planning](https://technet.microsoft.com/library/jj899596.aspx) and [Getting Started](https://technet.microsoft.com/library/jj899590.aspx) content in the HPC Pack TechNet Library.\n\n>[AZURE.NOTE]You can also use an Azure Resource Manager template to deploy an HPC Pack cluster. For an example, see [Create an HPC cluster](https://azure.microsoft.com/documentation/templates/create-hpc-cluster/), [Create an HPC cluster with a custom compute node image](https://azure.microsoft.com/documentation/templates/create-hpc-cluster-custom-image/), or [Create an HPC cluster with Linux compute nodes](https://azure.microsoft.com/documentation/templates/create-hpc-cluster-linux-cn/).\n\n## Prerequisites\n\n* **Azure subscription** - You can use a subscription in either the Azure Global or Azure China service. Your subscription limits will affect the number and type of cluster nodes you can deploy. For information, see [Azure subscription and service limits, quotas, and constraints](../articles/azure-subscription-service-limits.md).\n\n\n* **Windows client computer with Azure PowerShell 0.8.7 or later installed and configured** - See [Install and configure Azure PowerShell](../articles/powershell-install-configure.md). The script runs in Azure Service Management.\n\n\n* **HPC Pack IaaS deployment script** - Download and unpack the latest version of the script from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=44949). Check the version of the script by running `New-HPCIaaSCluster.ps1 –Version`. This article is based on version 4.4.0 of the script.\n\n* **Script configuration file** - You'll need to create an XML file that the script uses to configure the HPC cluster. For information and examples, see sections later in this article.\n\n\n## Syntax\n\n```\nNew-HPCIaaSCluster.ps1 [-ConfigFile] <String> [-AdminUserName]<String> [[-AdminPassword] <String>] [[-HPCImageName] <String>] [[-LogFile] <String>] [-Force] [-NoCleanOnFailure] [-PSSessionSkipCACheck] [<CommonParameters>]\n```\n>[AZURE.NOTE]You must run the script as an administrator.\n\n### Parameters\n\n* **ConfigFile** - Specifies the file path of the configuration file to describe the HPC cluster. For more information, see [Configuration file](#Configuration-file) in this topic, or the file Manual.rtf, in the folder containing the script.\n\n* **AdminUserName** - Specifies the user name. If the domain forest is created by the script, this becomes the local administrator user name for all VMs as well as the domain administrator name. If the domain forest already exists, this specifies the domain user as the local administrator user name to install HPC Pack.\n\n* **AdminPassword** - Specifies the administrator’s password. If not specified in the command line, the script will prompt you to input the password.\n\n* **HPCImageName** (optional) - Specifies the HPC Pack VM image name used to deploy the HPC cluster. It must be a Microsoft-provided HPC Pack image from the Azure Marketplace. If not specified (recommended in most cases), the script chooses the latest published HPC Pack image.\n\n    >[AZURE.NOTE] Deployment will fail if you don't specify a valid HPC Pack image.\n\n* **LogFile** (optional) - Specifies the deployment log file path. If not specified, the script will create a log file in the temp directory of the computer running the script.\n\n* **Force** (optional) - Suppresses all the confirmation prompts.\n\n* **NoCleanOnFailure** (optional) - Specifies that the Azure VMs that are not successfully deployed will not be removed. You must remove these VMs manually before rerunning the script to continue the deployment, or the deployment may fail.\n\n* **PSSessionSkipCACheck** (optional) - For every cloud service with VMs deployed by this script, a self-signed certificate is automatically generated by Azure, and all the VMs in the cloud service use this certificate as the default Windows Remote Management (WinRM) certificate. To deploy HPC features in these Azure VMs, the script by default temporarily installs these certificates in the Local Computer\\\\Trusted Root Certification Authorities store of the client computer to suppress the “not trusted CA” security error during script execution; the certificates are removed when the script finishes. If this parameter is specified, the certificates are not installed in the client computer, and the security warning is suppressed.\n\n    >[AZURE.IMPORTANT] This parameter is not recommended for production deployments.\n\n### Example\n\nThe following example creates a new HPC Pack cluster using the\nconfiguration file *MyConfigFile.xml*, and specifies administrative\ncredentials for installing the cluster.\n\n```\nNew-HPCIaaSCluster.ps1 –ConfigFile MyConfigFile.xml -AdminUserName <username> –AdminPassword <password>\n```\n\n### Additional considerations\n\n* The script uses the HPC Pack VM image in the Azure Marketplace to create the cluster head node. The latest image is based on Windows Server 2012 R2 Datacenter with HPC Pack 2012 R2 Update 3 installed.\n\n* The script can optionally enable job submission through the HPC Pack web portal or the HPC Pack REST API.\n\n* The script can optionally run custom pre- and post-configuration scripts on the head node if you want to install additional software or configure other settings.\n\n\n## Configuration file\n\nThe configuration file for the deployment script is an XML\nfile. The schema file HPCIaaSClusterConfig.xsd is in the HPC Pack IaaS\ndeployment script folder. **IaaSClusterConfig** is the root element of\nthe configuration file, which contains the child elements described in\ndetail in the file Manual.rtf in the deployment script folder. For example files for different scenarios, see\n[Example configuration files](#Example-configuration-files) in this article.\n\n## Example configuration files\n\n### Example 1\n\nThe following configuration file deploys an HPC Pack cluster in an existing domain forest. The cluster has 1 head node with local databases and 12 compute nodes with the BGInfo VM extension applied.\nAutomatic installation of Windows updates is disabled for all the VMs in\nthe domain forest. All the cloud services are created directly in the\nEast Asia location. The compute nodes are created in 3 cloud services\nand 3 storage accounts (i.e., _MyHPCCN-0001_ to _MyHPCCN-0005_ in\n_MyHPCCNService01_ and _mycnstorage01_; _MyHPCCN-0006_ to _MyHPCCN0010_ in\n_MyHPCCNService02_ and _mycnstorage02_; and _MyHPCCN-0011_ to _MyHPCCN-0012_ in\n_MyHPCCNService03_ and _mycnstorage03_). The compute nodes are created from\nan existing private image captured from a compute node. The auto grow\nand shrink service is enabled with default grow and shrink intervals.\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<IaaSClusterConfig>\n  <Subscription>\n    <SubscriptionName>Subscription-1</SubscriptionName>\n    <StorageAccount>mystorageaccount</StorageAccount>\n  </Subscription>\n  <Location>East Asia</Location>  \n  <VNet>\n    <VNetName>MyVNet</VNetName>\n    <SubnetName>Subnet-1</SubnetName>\n  </VNet>\n  <Domain>\n    <DCOption>NewDC</DCOption>\n    <DomainFQDN>hpc.local</DomainFQDN>\n    <DomainController>\n      <VMName>MyDCServer</VMName>\n      <ServiceName>MyHPCService</ServiceName>\n      <VMSize>Large</VMSize>\n      </DomainController>\n     <NoWindowsAutoUpdate />\n  </Domain>\n  <Database>\n    <DBOption>LocalDB</DBOption>\n  </Database>\n  <HeadNode>\n    <VMName>MyHeadNode</VMName>\n    <ServiceName>MyHPCService</ServiceName>\n    <VMSize>ExtraLarge</VMSize>\n  </HeadNode>\n  <Certificates>\n    <Certificate>\n      <Id>1</Id>\n      <PfxFile>d:\\mytestcert1.pfx</PfxFile>\n      <Password>MyPsw!!2</Password>\n    </Certificate>\n  </Certificates>\n  <ComputeNodes>\n    <VMNamePattern>MyHPCCN-%0001%</VMNamePattern>\n<ServiceNamePattern>MyHPCCNService%01%</ServiceNamePattern>\n<MaxNodeCountPerService>5</MaxNodeCountPerService>\n<StorageAccountNamePattern>mycnstorage%01%</StorageAccountNamePattern>\n    <VMSize>Medium</VMSize>\n    <NodeCount>12</NodeCount>\n    <ImageName HPCPackInstalled=”true”>MyHPCComputeNodeImage</ImageName>\n    <VMExtensions>\n       <VMExtension>\n          <ExtensionName>BGInfo</ExtensionName>\n          <Publisher>Microsoft.Compute</Publisher>\n          <Version>1.*</Version>\n       </VMExtension>\n    </VMExtensions>\n  </ComputeNodes>\n  <AutoGrowShrink>\n    <CertificateId>1</CertificateId>\n  </AutoGrowShrink>\n</IaaSClusterConfig>\n\n```\n\n### Example 2\n\nThe following configuration file deploys an HPC Pack cluster\nin an existing domain forest. The cluster contains 1 head node, 1\ndatabase server with a 500GB data disk, 2 broker nodes running the Windows\nServer 2012 R2 operating system, and 5 compute nodes running the Windows\nServer 2012 R2 operating system. The cloud service MyHPCCNService is\ncreated in the affinity group *MyIBAffinityGroup*, and all the other cloud\nservices are created in the affinity group *MyAffinityGroup*. The HPC Job\nScheduler REST API and HPC web portal are enabled on the head node.\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<IaaSClusterConfig>\n  <Subscription>\n    <SubscriptionName>Subscription-1</SubscriptionName>\n    <StorageAccount>mystorageaccount</StorageAccount>\n  </Subscription>\n  <AffinityGroup>MyAffinityGroup</AffinityGroup>\n  <Location>East Asia</Location>  \n  <VNet>\n    <VNetName>MyVNet</VNetName>\n    <SubnetName>Subnet-1</SubnetName>\n  </VNet>    \n  <Domain>\n    <DCOption>ExistingDC</DCOption>\n    <DomainFQDN>hpc.local</DomainFQDN>\n  </Domain>\n  <Database>\n    <DBOption>NewRemoteDB</DBOption>\n    <DBVersion>SQLServer2014_Enterprise</DBVersion>\n    <DBServer>\n      <VMName>MyDBServer</VMName>\n      <ServiceName>MyHPCService</ServiceName>\n      <VMSize>ExtraLarge</VMSize>\n      <DataDiskSizeInGB>500</DataDiskSizeInGB>\n    </DBServer>\n  </Database>\n  <HeadNode>\n    <VMName>MyHeadNode</VMName>\n    <ServiceName>MyHPCService</ServiceName>\n    <VMSize>ExtraLarge</VMSize>\n    <EnableRESTAPI />\n    <EnableWebPortal />\n  </HeadNode>\n  <ComputeNodes>\n    <VMNamePattern>MyHPCCN-%0000%</VMNamePattern>\n    <ServiceName>MyHPCCNService</ServiceName>\n    <VMSize>A8</VMSize>\n<NodeCount>5</NodeCount>\n<AffinityGroup>MyIBAffinityGroup</AffinityGroup>\n  </ComputeNodes>\n  <BrokerNodes>\n    <VMNamePattern>MyHPCBN-%0000%</VMNamePattern>\n    <ServiceName>MyHPCBNService</ServiceName>\n    <VMSize>Medium</VMSize>\n    <NodeCount>2</NodeCount>\n  </BrokerNodes>\n</IaaSClusterConfig>\n```\n\n### Example 3\n\nThe following configuration file creates a new domain forest\nand Deployments an HPC Pack cluster which has 1 head node with local\ndatabases and 20 Linux compute nodes. All the cloud services are created\ndirectly in the East Asia location. The Linux compute nodes are created\nin 4 cloud services and 4 storage accounts (i.e. _MyLnxCN-0001_ to\n_MyLnxCN-0005_ in _MyLnxCNService01_ and _mylnxstorage01_, _MyLnxCN-0006_ to\n_MyLnxCN-0010_ in _MyLnxCNService02_ and _mylnxstorage02_, _MyLnxCN-0011_ to\n_MyLnxCN-0015_ in _MyLnxCNService03_ and _mylnxstorage03_, and _MyLnxCN-0016_ to\n_MyLnxCN-0020_ in _MyLnxCNService04_ and _mylnxstorage04_). The compute nodes\nare created from an OpenLogic CentOS version 7.0 Linux image.\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<IaaSClusterConfig>\n  <Subscription>\n    <SubscriptionName>Subscription-1</SubscriptionName>\n    <StorageAccount>mystorageaccount</StorageAccount>\n  </Subscription>\n  <Location>East Asia</Location>  \n  <VNet>\n    <VNetName>MyVNet</VNetName>\n    <SubnetName>Subnet-1</SubnetName>\n  </VNet>\n  <Domain>\n    <DCOption>NewDC</DCOption>\n    <DomainFQDN>hpc.local</DomainFQDN>\n    <DomainController>\n      <VMName>MyDCServer</VMName>\n      <ServiceName>MyHPCService</ServiceName>\n      <VMSize>Large</VMSize>\n    </DomainController>\n  </Domain>\n  <Database>\n    <DBOption>LocalDB</DBOption>\n  </Database>\n  <HeadNode>\n    <VMName>MyHeadNode</VMName>\n    <ServiceName>MyHPCService</ServiceName>\n    <VMSize>ExtraLarge</VMSize>\n  </HeadNode>\n  <LinuxComputeNodes>\n    <VMNamePattern>MyLnxCN-%0001%</VMNamePattern>\n    <ServiceNamePattern>MyLnxCNService%01%</ServiceNamePattern>\n    <MaxNodeCountPerService>5</MaxNodeCountPerService>\n    <StorageAccountNamePattern>mylnxstorage%01%</StorageAccountNamePattern>\n    <VMSize>Medium</VMSize>\n    <NodeCount>20</NodeCount>\n    <ImageName>5112500ae3b842c8b9c604889f8753c3__OpenLogic-CentOS-70-20150325 </ImageName>\n    <SSHKeyPairForRoot>\n      <PfxFile>d:\\mytestcert1.pfx</PfxFile>\n      <Password>MyPsw!!2</Password>\n    </SSHKeyPairForRoot>\n  </LinuxComputeNodes>\n</IaaSClusterConfig>\n```\n\n\n### Example 4\n\nThe following configuration file deploys an HPC Pack cluster\nwhich has a head node with local databases and 5 compute nodes running\nthe Windows Server 2008 R2 operating system. All the cloud services are\ncreated directly in the East Asia location. The head node acts as domain\ncontroller of the domain forest.\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<IaaSClusterConfig>\n  <Subscription>\n    <SubscriptionId>08701940-C02E-452F-B0B1-39D50119F267</SubscriptionId>\n    <StorageAccount>mystorageaccount</StorageAccount>\n  </Subscription>\n  <Location>East Asia</Location>  \n  <VNet>\n    <VNetName>MyVNet</VNetName>\n    <SubnetName>Subnet-1</SubnetName>\n  </VNet>\n  <Domain>\n    <DCOption>HeadNodeAsDC</DCOption>\n    <DomainFQDN>hpc.local</DomainFQDN>\n  </Domain>\n  <Database>\n    <DBOption>LocalDB</DBOption>\n  </Database>\n  <HeadNode>\n    <VMName>MyHeadNode</VMName>\n    <ServiceName>MyHPCService</ServiceName>\n    <VMSize>ExtraLarge</VMSize>\n  </HeadNode>\n  <ComputeNodes>\n    <VMNamePattern>MyHPCCN-%1000%</VMNamePattern>\n    <ServiceName>MyHPCCNService</ServiceName>\n    <VMSize>Medium</VMSize>\n    <NodeCount>5</NodeCount>\n    <OSVersion>WindowsServer2008R2</OSVersion>\n  </ComputeNodes>\n</IaaSClusterConfig>\n```\n\n### Example 5\n\nThe following configuration file deploys an HPC Pack cluster\nin an existing domain forest. The cluster has 1 head node with local\ndatabases, two Azure node templates are created, and 3 Medium size Azure\nnodes are created for Azure node template _AzureTemplate1_. A script file\nwill run on the head node after the head node is configured.\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<IaaSClusterConfig>\n  <Subscription>\n    <SubscriptionName>Subscription-1</SubscriptionName>\n    <StorageAccount>mystorageaccount</StorageAccount>\n  </Subscription>\n  <AffinityGroup>MyAffinityGroup</AffinityGroup>\n  <Location>East Asia</Location>  \n  <VNet>\n    <VNetName>MyVNet</VNetName>\n    <SubnetName>Subnet-1</SubnetName>\n  </VNet>\n  <Domain>\n    <DCOption>ExistingDC</DCOption>\n    <DomainFQDN>hpc.local</DomainFQDN>\n  </Domain>\n  <Database>\n    <DBOption>LocalDB</DBOption>\n  </Database>\n  <HeadNode>\n    <VMName>MyHeadNode</VMName>\n    <ServiceName>MyHPCService</ServiceName>\n<VMSize>ExtraLarge</VMSize>\n    <PostConfigScript>c:\\MyHNPostActions.ps1</PostConfigScript>\n  </HeadNode>\n  <Certificates>\n    <Certificate>\n      <Id>1</Id>\n      <PfxFile>d:\\mytestcert1.pfx</PfxFile>\n      <Password>MyPsw!!2</Password>\n    </Certificate>\n    <Certificate>\n      <Id>2</Id>\n      <PfxFile>d:\\mytestcert2.pfx</PfxFile>\n    </Certificate>    \n  </Certificates>\n  <AzureBurst>\n    <AzureNodeTemplate>\n      <TemplateName>AzureTemplate1</TemplateName>\n      <SubscriptionId>bb9252ba-831f-4c9d-ae14-9a38e6da8ee4</SubscriptionId>\n      <CertificateId>1</CertificateId>\n      <ServiceName>mytestsvc1</ServiceName>\n      <StorageAccount>myteststorage1</StorageAccount>\n      <NodeCount>3</NodeCount>\n      <RoleSize>Medium</RoleSize>\n    </AzureNodeTemplate>\n    <AzureNodeTemplate>\n      <TemplateName>AzureTemplate2</TemplateName>\n      <SubscriptionId>ad4b9f9f-05f2-4c74-a83f-f2eb73000e0b</SubscriptionId>\n      <CertificateId>1</CertificateId>\n      <ServiceName>mytestsvc2</ServiceName>\n      <StorageAccount>myteststorage2</StorageAccount>\n      <Proxy>\n        <UsesStaticProxyCount>false</UsesStaticProxyCount>     \n        <ProxyRatio>100</ProxyRatio>\n        <ProxyRatioBase>400</ProxyRatioBase>\n      </Proxy>\n      <OSVersion>WindowsServer2012</OSVersion>\n    </AzureNodeTemplate>\n  </AzureBurst>\n</IaaSClusterConfig>\n```\n## Known issues\n\n\n* **“VNet doesn’t exist” error** - If you run the HPC Pack IaaS deployment script to deploy multiple\nclusters in Azure concurrently under one subscription, one or more\ndeployments may fail with the error “VNet *VNet\\_Name* doesn't exist”.\nIf this error occurs, re-run the script for the failed deployment.\n\n* **Problem accessing the Internet from the Azure virtual network** - If you create an HPC Pack cluster with a new domain controller by using\nthe deployment script, or you manually promote a VM to domain\ncontroller, you may experience problems connecting the VMs in the Azure\nvirtual network to the Internet. This can occur if a forwarder DNS\nserver is automatically configured on the domain controller, and this\nforwarder DNS server doesn’t resolve properly.\n\n    To work around this problem, log on to the domain controller and either\n    remove the forwarder configuration setting or configure a valid\n    forwarder DNS server. To do this, in Server Manager click **Tools** >\n    **DNS** to open DNS Manager, and then double-click **Forwarders**.\n\n* **Problem accessing RDMA network from size A8 or A9 VMs** - If you add Windows Server compute node or broker node VMs of size A8 or\nA9 by using the deployment script, you may experience problems\nconnecting those VMs to the RDMA application network. One reason this\ncan occur is if the HpcVmDrivers extension is not properly installed\nwhen the size A8 or A9 VMs are added to the cluster. For example, the\nextension might be stuck in the installing state.\n\n    To work around this problem, first check the state of the extension in\n    the VMs. If the extension is not properly installed, try removing the\n    nodes from the HPC cluster and then add the nodes again. For example,\n    you can add compute node VMs by running the Add-HpcIaaSNode.ps1 script on the head node.\n\n\n"
}