{
  "nodes": [
    {
      "content": "Azure AD Connect sync: Configure filtering | Microsoft Azure",
      "pos": [
        27,
        87
      ]
    },
    {
      "content": "Explains how to configure filtering in Azure AD Connect sync.",
      "pos": [
        106,
        167
      ]
    },
    {
      "content": "Azure AD Connect sync: Configure Filtering",
      "pos": [
        489,
        531
      ]
    },
    {
      "content": "In Azure AD Connect sync, you can enable filtering at any time.",
      "pos": [
        533,
        596
      ]
    },
    {
      "content": "If you have already run the default configurations of directory synchronization and then configured the filtering, the objects that are filtered out are no longer synchronized to Azure AD.",
      "pos": [
        597,
        785
      ]
    },
    {
      "content": "As a result of this, any objects in Azure AD that were previously synchronized but were then filtered are deleted in Azure AD.",
      "pos": [
        786,
        912
      ]
    },
    {
      "content": "If objects were inadvertently deleted because of a filtering error, you can re-create the objects in Azure AD by removing your filtering configurations, and then synchronize your directories again.",
      "pos": [
        913,
        1110
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph>Microsoft does not support modification or operation of the Azure AD Connect sync outside of those actions formally documented.",
      "pos": [
        1114,
        1258
      ]
    },
    {
      "content": "Any of these actions may result in an inconsistent or unsupported state of Azure AD Connect sync and as a result, Microsoft cannot provide technical support for such deployments.",
      "pos": [
        1259,
        1437
      ]
    },
    {
      "content": "With the exception of outbound attribute-based filtering, the configurations will be retained when you install or upgrade to a newer version of Azure AD Connect.",
      "pos": [
        1439,
        1600
      ]
    },
    {
      "content": "It is always a best practice to verify that the configuration was not inadvertently changed after an upgrade to a newer version before running the first synchronization cycle.",
      "pos": [
        1601,
        1776
      ]
    },
    {
      "content": "Filtering Options",
      "pos": [
        1782,
        1799
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>In this topic, Source AD is used as name for your Active Directory Domain Service Connector.",
      "pos": [
        1803,
        1907
      ]
    },
    {
      "content": "If you have multiple forests, you will have one Connector per forest and the configuration must be repeated for each forest.",
      "pos": [
        1908,
        2032
      ]
    },
    {
      "content": "The following three filtering configuration types can be applied to the Directory Synchronization tool:",
      "pos": [
        2034,
        2137
      ]
    },
    {
      "content": "[<bpt id=\"p1\">**</bpt>Domain-based<ept id=\"p1\">**</ept>](#configure-domain-based filtering): You can use this filtering type to manage the properties of the SourceAD Connector in Azure AD Connect sync.",
      "pos": [
        2141,
        2304
      ]
    },
    {
      "content": "This type enables you to select which domains are allowed to synchronize to Azure AD.",
      "pos": [
        2305,
        2390
      ]
    },
    {
      "content": "[<bpt id=\"p1\">**</bpt>Configure organizational-unit–based filtering<ept id=\"p1\">**</ept>](#configure-organizational-unit–based filtering): You can use this filtering type to manage the properties of the SourceAD Connector in Azure AD Connect sync.",
      "pos": [
        2394,
        2603
      ]
    },
    {
      "content": "This filtering type enables you to select which OUs are allowed to synchronize to Azure AD.",
      "pos": [
        2604,
        2695
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Attribute–based<ept id=\"p2\">**</ept><ept id=\"p1\">](#configure-attribute-based-filtering)</ept>: You can use this filtering method to specify attribute-based filters.",
      "pos": [
        2699,
        2829
      ]
    },
    {
      "content": "This enables you to control which objects should be synchronized to the cloud.",
      "pos": [
        2830,
        2908
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>If you make a change to filter configuration and you use password synchronization then you need to trigger a full sync of all passwords after you have completed the configuration.",
      "pos": [
        2912,
        3103
      ]
    },
    {
      "content": "For steps on how to trigger a password full sync see <bpt id=\"p1\">[</bpt>Trigger a full sync of all passwords<ept id=\"p1\">](active-directory-aadconnectsync-implement-password-synchronization.md#trigger-a-full-sync-of-all-passwords)</ept>",
      "pos": [
        3104,
        3303
      ]
    },
    {
      "content": "Configure domain-based filtering",
      "pos": [
        3308,
        3340
      ]
    },
    {
      "content": "This section provides you with the steps you need to perform to configure your domain filter.",
      "pos": [
        3342,
        3435
      ]
    },
    {
      "content": "If you have added or removed domains in your forest after you have installed Azure AD Connect you will also have to update the filtering configuration.",
      "pos": [
        3437,
        3588
      ]
    },
    {
      "content": "Changing the filter for existing domains",
      "pos": [
        3595,
        3635
      ]
    },
    {
      "pos": [
        3639,
        3735
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you have modified your domain filter, you also need to update your run profiles."
    },
    {
      "content": "To set the domain filter, perform the following steps:",
      "pos": [
        3740,
        3794
      ]
    },
    {
      "pos": [
        3801,
        3938
      ],
      "content": "Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the <bpt id=\"p1\">**</bpt>ADSyncAdmins<ept id=\"p1\">**</ept> security group."
    },
    {
      "pos": [
        3943,
        4046
      ],
      "content": "On <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, tap or click <bpt id=\"p2\">**</bpt>Synchronization Service<ept id=\"p2\">**</ept> to open the <bpt id=\"p3\">**</bpt>Synchronization Service Manager<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        4051,
        4123
      ],
      "content": "To open the connectors view, click <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Tools<ept id=\"p2\">**</ept> menu."
    },
    {
      "pos": [
        4128,
        4234
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> list, select the connector that has <bpt id=\"p2\">**</bpt>Active Directory Domain Service<ept id=\"p2\">**</ept> as <bpt id=\"p3\">**</bpt>Type<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        4239,
        4319
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu."
    },
    {
      "pos": [
        4324,
        4365
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Configure Directory Partitions<ept id=\"p1\">**</ept>."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Select directory partitions<ept id=\"p1\">**</ept> list, verify that only the partitions you want to synchronize are selected.",
      "pos": [
        4370,
        4484
      ]
    },
    {
      "content": "To remove a domain from the synchronization process, clear the domain’s check box.",
      "pos": [
        4490,
        4572
      ]
    },
    {
      "pos": [
        4577,
        4626
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "If you have updated your domain filter, you also need to update the following run profiles:",
      "pos": [
        4629,
        4720
      ]
    },
    {
      "content": "Full Import",
      "pos": [
        4724,
        4735
      ]
    },
    {
      "content": "Full Synchronization",
      "pos": [
        4738,
        4758
      ]
    },
    {
      "content": "Delta Import",
      "pos": [
        4761,
        4773
      ]
    },
    {
      "content": "Delta Synchronization",
      "pos": [
        4776,
        4797
      ]
    },
    {
      "content": "Export",
      "pos": [
        4800,
        4806
      ]
    },
    {
      "pos": [
        4809,
        4983
      ],
      "content": "If you have <bpt id=\"p1\">**</bpt>removed<ept id=\"p1\">**</ept> a partition from the directory partitions list, you need to make sure that all run profile steps that are referencing this partition are also removed."
    },
    {
      "content": "To remove a step from a run profile, perform the following steps:",
      "pos": [
        4987,
        5052
      ]
    },
    {
      "pos": [
        5059,
        5165
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> list, select the connector that has <bpt id=\"p2\">**</bpt>Active Directory Domain Service<ept id=\"p2\">**</ept> as <bpt id=\"p3\">**</bpt>Type<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        5170,
        5278
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Configure Run Profiles for<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Configure Run Profiles<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu."
    },
    {
      "pos": [
        5283,
        5367
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connector run profiles<ept id=\"p1\">**</ept> list, select the run profile you want to configure"
    },
    {
      "content": "For each step in the step details list, perform the following steps:",
      "pos": [
        5372,
        5440
      ]
    },
    {
      "content": "4.1.",
      "pos": [
        5447,
        5451
      ]
    },
    {
      "content": "If necessary, click the step to expand the step details.",
      "pos": [
        5452,
        5508
      ]
    },
    {
      "content": "4.2.",
      "pos": [
        5515,
        5519
      ]
    },
    {
      "content": "If the <bpt id=\"p1\">**</bpt>Value<ept id=\"p1\">**</ept> of the <bpt id=\"p2\">**</bpt>Partition<ept id=\"p2\">**</ept> attribute is a GUID, click Delete Step.",
      "pos": [
        5520,
        5597
      ]
    },
    {
      "pos": [
        5602,
        5667
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Configure Run Profiles for<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        5669,
        5861
      ],
      "content": "If you have <bpt id=\"p1\">**</bpt>added<ept id=\"p1\">**</ept> a partition to the directory partitions list, you need to make sure that a run profile step for that partition is available on each of the run profiles in the list above."
    },
    {
      "content": "To add a step to a run profile, perform the following steps:",
      "pos": [
        5865,
        5925
      ]
    },
    {
      "pos": [
        5932,
        6038
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> list, select the connector that has <bpt id=\"p2\">**</bpt>Active Directory Domain Service<ept id=\"p2\">**</ept> as <bpt id=\"p3\">**</bpt>Type<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        6043,
        6151
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Configure Run Profiles for<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Configure Run Profiles<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu."
    },
    {
      "pos": [
        6156,
        6240
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connector run profiles<ept id=\"p1\">**</ept> list, select the run profile you want to configure"
    },
    {
      "pos": [
        6245,
        6310
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Configure Run Profile<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>New Step<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        6315,
        6416
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Configure Step<ept id=\"p1\">**</ept> page, in the step type list, select the step type, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        6421,
        6559
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Connector Configuration<ept id=\"p1\">**</ept> page, in the <bpt id=\"p2\">**</bpt>Partition<ept id=\"p2\">**</ept> list, select the name of the partition you have added to your domain filter."
    },
    {
      "pos": [
        6564,
        6628
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Configure Run Profile<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        6633,
        6698
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Configure Run Profiles<ept id=\"p1\">**</ept> for dialog, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Changing the filter for new or removed domains",
      "pos": [
        6704,
        6750
      ]
    },
    {
      "content": "If you have added a new domain to the forest or removed a domain from the forest, the domain filtering configuration must be updated.",
      "pos": [
        6751,
        6884
      ]
    },
    {
      "content": "Steps if you have added a domain",
      "pos": [
        6888,
        6920
      ]
    },
    {
      "pos": [
        6927,
        7064
      ],
      "content": "Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the <bpt id=\"p1\">**</bpt>ADSyncAdmins<ept id=\"p1\">**</ept> security group."
    },
    {
      "pos": [
        7069,
        7172
      ],
      "content": "On <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, tap or click <bpt id=\"p2\">**</bpt>Synchronization Service<ept id=\"p2\">**</ept> to open the <bpt id=\"p3\">**</bpt>Synchronization Service Manager<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        7177,
        7249
      ],
      "content": "To open the connectors view, click <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Tools<ept id=\"p2\">**</ept> menu."
    },
    {
      "pos": [
        7254,
        7360
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> list, select the connector that has <bpt id=\"p2\">**</bpt>Active Directory Domain Service<ept id=\"p2\">**</ept> as <bpt id=\"p3\">**</bpt>Type<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        7365,
        7445
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu."
    },
    {
      "pos": [
        7450,
        7491
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Configure Directory Partitions<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        7496,
        7548
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Refresh<ept id=\"p1\">**</ept> button at the top of the page."
    },
    {
      "pos": [
        7553,
        7620
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Select directory partitions<ept id=\"p1\">**</ept> list, select the new domain."
    },
    {
      "pos": [
        7625,
        7670
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog, click OK."
    },
    {
      "content": "Make sure the same Connector is still selected.",
      "pos": [
        7672,
        7719
      ]
    },
    {
      "content": "The run profiles for the Connector must now be configured.",
      "pos": [
        7720,
        7778
      ]
    },
    {
      "content": "Full Import",
      "pos": [
        7783,
        7794
      ]
    },
    {
      "content": "Full Synchronization",
      "pos": [
        7797,
        7817
      ]
    },
    {
      "content": "Delta Import",
      "pos": [
        7820,
        7832
      ]
    },
    {
      "content": "Delta Synchronization",
      "pos": [
        7835,
        7856
      ]
    },
    {
      "content": "Export",
      "pos": [
        7859,
        7865
      ]
    },
    {
      "pos": [
        7872,
        7980
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Configure Run Profiles for<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Configure Run Profiles<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu."
    },
    {
      "pos": [
        7986,
        8070
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connector run profiles<ept id=\"p1\">**</ept> list, select the run profile you want to configure"
    },
    {
      "pos": [
        8076,
        8141
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Configure Run Profile<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>New Step<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        8147,
        8248
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Configure Step<ept id=\"p1\">**</ept> page, in the step type list, select the step type, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        8254,
        8392
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Connector Configuration<ept id=\"p1\">**</ept> page, in the <bpt id=\"p2\">**</bpt>Partition<ept id=\"p2\">**</ept> list, select the name of the partition you have added to your domain filter."
    },
    {
      "pos": [
        8398,
        8462
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Configure Run Profile<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        8468,
        8533
      ],
      "content": "To close the <bpt id=\"p1\">**</bpt>Configure Run Profiles<ept id=\"p1\">**</ept> for dialog, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Repeat these steps for all run profiles.",
      "pos": [
        8539,
        8579
      ]
    },
    {
      "content": "Steps if you have removed a domain",
      "pos": [
        8583,
        8617
      ]
    },
    {
      "pos": [
        8624,
        8761
      ],
      "content": "Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the <bpt id=\"p1\">**</bpt>ADSyncAdmins<ept id=\"p1\">**</ept> security group."
    },
    {
      "pos": [
        8766,
        8869
      ],
      "content": "On <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, tap or click <bpt id=\"p2\">**</bpt>Synchronization Service<ept id=\"p2\">**</ept> to open the <bpt id=\"p3\">**</bpt>Synchronization Service Manager<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        8874,
        8946
      ],
      "content": "To open the connectors view, click <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Tools<ept id=\"p2\">**</ept> menu."
    },
    {
      "pos": [
        8951,
        9057
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> list, select the connector that has <bpt id=\"p2\">**</bpt>Active Directory Domain Service<ept id=\"p2\">**</ept> as <bpt id=\"p3\">**</bpt>Type<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        9062,
        9142
      ],
      "content": "To open the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu."
    },
    {
      "pos": [
        9147,
        9188
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Configure Directory Partitions<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9193,
        9245
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Refresh<ept id=\"p1\">**</ept> button at the top of the page."
    },
    {
      "content": "To close the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog, click OK.",
      "pos": [
        9250,
        9295
      ]
    },
    {
      "content": "A message will pop-up saying a domain was removed and that configuration will be cleaned up.",
      "pos": [
        9296,
        9388
      ]
    },
    {
      "content": "Configure organizational-unit–based filtering",
      "pos": [
        9393,
        9438
      ]
    },
    {
      "content": "To configure organizational-unit–based filtering, perform the following steps:",
      "pos": [
        9442,
        9520
      ]
    },
    {
      "pos": [
        9527,
        9664
      ],
      "content": "Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the <bpt id=\"p1\">**</bpt>ADSyncAdmins<ept id=\"p1\">**</ept> security group."
    },
    {
      "content": "On <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, tap or click <bpt id=\"p2\">**</bpt>Synchronization Service<ept id=\"p2\">**</ept> to open the <bpt id=\"p3\">**</bpt>Synchronization Service Manager<ept id=\"p3\">**</ept>.",
      "pos": [
        9669,
        9772
      ]
    },
    {
      "pos": [
        9781,
        9882
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Synchronization Service Manager<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Connectors<ept id=\"p2\">**</ept>, and then double-click <bpt id=\"p3\">**</bpt>SourceAD<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        9887,
        10000
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Configure Directory Partitions<ept id=\"p1\">**</ept>, select the domain you want to configure, and then click <bpt id=\"p2\">**</bpt>Containers<ept id=\"p2\">**</ept>."
    },
    {
      "content": "When prompted, enter your domain credentials for the on-premises Active Directory forest.",
      "pos": [
        10005,
        10094
      ]
    },
    {
      "content": "&gt; <ph id=\"ph1\">[AZURE.NOTE]</ph>When presented with the credentials dialog box, the account used to import and export to AD DS will be displayed.",
      "pos": [
        10099,
        10226
      ]
    },
    {
      "content": "If you do not know the password to the account you can enter another account to use.",
      "pos": [
        10227,
        10311
      ]
    },
    {
      "content": "The account you use must have read permissions to the domain currently being configured.",
      "pos": [
        10312,
        10400
      ]
    },
    {
      "pos": [
        10405,
        10536
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Select Containers<ept id=\"p1\">**</ept> dialog box, clear the OUs that you don’t want to sync with the cloud directory, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        10541,
        10590
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>SourceAD Properties<ept id=\"p2\">**</ept> page."
    },
    {
      "content": "Run a full import and a delta sync by completing the following steps:",
      "pos": [
        10595,
        10664
      ]
    },
    {
      "content": "8.1.",
      "pos": [
        10671,
        10675
      ]
    },
    {
      "content": "In the connectors list, select <bpt id=\"p1\">**</bpt>SourceAD<ept id=\"p1\">**</ept>",
      "pos": [
        10676,
        10719
      ]
    },
    {
      "content": "8.2.",
      "pos": [
        10726,
        10730
      ]
    },
    {
      "content": "To open the <bpt id=\"p1\">**</bpt>Run Connector<ept id=\"p1\">**</ept> dialog, select <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept> from the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu.",
      "pos": [
        10731,
        10810
      ]
    },
    {
      "content": "8.3.",
      "pos": [
        10817,
        10821
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Run profiles<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>Full Import<ept id=\"p2\">**</ept>, and then wait for the run profile to complete.",
      "pos": [
        10822,
        10922
      ]
    },
    {
      "content": "8.4.",
      "pos": [
        10929,
        10933
      ]
    },
    {
      "content": "To open the <bpt id=\"p1\">**</bpt>Run Connector<ept id=\"p1\">**</ept> dialog, select <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept> from the <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> menu.",
      "pos": [
        10934,
        11013
      ]
    },
    {
      "content": "8.5.",
      "pos": [
        11020,
        11024
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Run profiles<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>Delta Synchronization<ept id=\"p2\">**</ept>, and then wait for the run profile to complete.",
      "pos": [
        11025,
        11135
      ]
    },
    {
      "content": "Configure attribute based filtering",
      "pos": [
        11143,
        11178
      ]
    },
    {
      "content": "There are several ways to configure filtering based on attributes.",
      "pos": [
        11180,
        11246
      ]
    },
    {
      "content": "Configuration on inbound from AD is recommended since these configuration settings will be kept even after an upgrade to a newer version.",
      "pos": [
        11247,
        11384
      ]
    },
    {
      "content": "Configuration on outbound to AAD is supported, but these settings will not be kept after an upgrade to a newer version and should only be used when it is required to look at the combined object in the metaverse to determine filtering.",
      "pos": [
        11385,
        11619
      ]
    },
    {
      "content": "Inbound filtering",
      "pos": [
        11625,
        11642
      ]
    },
    {
      "content": "Inbound based filtering is leveraging the default configuration where objects going to AAD must have the metaverse attribute cloudFiltered not set to a value and the metaverse attribute sourceObjectType set to either “User” or “Contact”.",
      "pos": [
        11644,
        11881
      ]
    },
    {
      "content": "The attribute cloudFiltered should be set to True when the object should not be synchronized to Azure AD and kept empty in other cases.",
      "pos": [
        11883,
        12018
      ]
    },
    {
      "content": "This method is used when we can look at an object and say that we do not want to synchronize an object (negative filtering).",
      "pos": [
        12019,
        12143
      ]
    },
    {
      "content": "In the following example, we will filter out all users where extensionAttribute15 has the value NoSync:",
      "pos": [
        12145,
        12248
      ]
    },
    {
      "content": "Log on to the computer that is running Azure AD Connect Sync by using an account that is a member of the ADSyncAdmins security group.",
      "pos": [
        12253,
        12386
      ]
    },
    {
      "pos": [
        12390,
        12456
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>Synchronization Rules Editor<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Start Menu<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        12460,
        12521
      ],
      "content": "Make sure <bpt id=\"p1\">**</bpt>Inbound<ept id=\"p1\">**</ept> is selected and click <bpt id=\"p2\">**</bpt>Add New Rule<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Give the rule a descriptive name, such as \"<bpt id=\"p1\">*</bpt>In from AD – User DoNotSyncFilter<ept id=\"p1\">*</ept>\", select the correct forest, <bpt id=\"p2\">**</bpt>User<ept id=\"p2\">**</ept> as the <bpt id=\"p3\">**</bpt>CS object type<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>Person<ept id=\"p4\">**</ept> as the <bpt id=\"p5\">**</bpt>MV object type<ept id=\"p5\">**</ept>.",
      "pos": [
        12525,
        12710
      ]
    },
    {
      "content": "As <bpt id=\"p1\">**</bpt>Link Type<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>Join<ept id=\"p2\">**</ept> and in precedence type a value currently not used by another Synchronization Rule (e.g.: 50), and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>.",
      "pos": [
        12711,
        12863
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Scoping filter<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Add Group<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Add Clause<ept id=\"p3\">**</ept> and in attribute select <bpt id=\"p4\">**</bpt>ExtensionAttribute15<ept id=\"p4\">**</ept>.",
      "pos": [
        12867,
        12981
      ]
    },
    {
      "content": "Make sure the Operator is set to <bpt id=\"p1\">**</bpt>EQUAL<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>type<ept id=\"p2\">**</ept> in the value NoSync in the Value box.",
      "pos": [
        12982,
        13075
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        13076,
        13091
      ]
    },
    {
      "pos": [
        13095,
        13151
      ],
      "content": "Leave the <bpt id=\"p1\">**</bpt>Join<ept id=\"p1\">**</ept> rules empty, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Add Transformation<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>FlowType<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Constant<ept id=\"p3\">**</ept>, select the Target Attribute cloudFiltered and in the Source text box, type in True.",
      "pos": [
        13155,
        13309
      ]
    },
    {
      "content": "Click Add to save the rule.",
      "pos": [
        13310,
        13337
      ]
    },
    {
      "pos": [
        13341,
        13484
      ],
      "content": "Perform a full sync: on the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> tab, right-click <bpt id=\"p2\">**</bpt>SourceAD<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Run<ept id=\"p3\">**</ept>, click <bpt id=\"p4\">**</bpt>Full Synchronization<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>."
    },
    {
      "content": "The attribute <bpt id=\"p1\">**</bpt>sourceObjectType<ept id=\"p1\">**</ept> will provision an <bpt id=\"p2\">**</bpt>User<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Contact<ept id=\"p3\">**</ept> to Azure AD if this attribute has the value <bpt id=\"p4\">**</bpt>User<ept id=\"p4\">**</ept> or <bpt id=\"p5\">**</bpt>Contact<ept id=\"p5\">**</ept> respectively.",
      "pos": [
        13487,
        13645
      ]
    },
    {
      "content": "By creating a Synchronization Rule with a higher precedence than those out of box, you can override the default behavior.",
      "pos": [
        13646,
        13767
      ]
    },
    {
      "content": "This method also gives you an opportunity to express both positive and negative rules.",
      "pos": [
        13768,
        13854
      ]
    },
    {
      "pos": [
        13856,
        13969
      ],
      "content": "In the following example, you will only synchronize users when the department attribute is “<bpt id=\"p1\">*</bpt>Sales<ept id=\"p1\">*</ept>” or is empty:"
    },
    {
      "content": "Log on to the computer that is running Azure AD Connect Sync by using an account that is a member of the ADSyncAdmins security group.",
      "pos": [
        13974,
        14107
      ]
    },
    {
      "pos": [
        14111,
        14177
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>Synchronization Rules Editor<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Start Menu<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        14181,
        14248
      ],
      "content": "Make sure <bpt id=\"p1\">**</bpt>Inbound<ept id=\"p1\">**</ept> is selected, and then click <bpt id=\"p2\">**</bpt>Add New Rule<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Give the rule a descriptive name (e.g.: \"<bpt id=\"p1\">*</bpt>In from AD – User DoNotSyncFilter<ept id=\"p1\">*</ept>\"), select the correct forest, <bpt id=\"p2\">**</bpt>User<ept id=\"p2\">**</ept> as the <bpt id=\"p3\">**</bpt>CS object type<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>Person<ept id=\"p4\">**</ept> as the <bpt id=\"p5\">**</bpt>MV object type<ept id=\"p5\">**</ept>.",
      "pos": [
        14252,
        14436
      ]
    },
    {
      "content": "As <bpt id=\"p1\">**</bpt>Link Type<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>Join<ept id=\"p2\">**</ept> and in <bpt id=\"p3\">**</bpt>precedence type<ept id=\"p3\">**</ept>, a value currently not used by another Synchronization Rule (e.g.: 60).",
      "pos": [
        14437,
        14569
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        14570,
        14585
      ]
    },
    {
      "pos": [
        14589,
        14668
      ],
      "content": "Leave the <bpt id=\"p1\">**</bpt>scoping filter<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>join rules<ept id=\"p2\">**</ept> empty and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept> twice."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Add Transformation<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>FlowType<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Expression<ept id=\"p3\">**</ept> and select the <bpt id=\"p4\">**</bpt>Target Attribute<ept id=\"p4\">**</ept> to <bpt id=\"p5\">**</bpt>sourceObjectType<ept id=\"p5\">**</ept>.",
      "pos": [
        14672,
        14804
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Source<ept id=\"p1\">**</ept>, type in the following expression:",
      "pos": [
        14805,
        14857
      ]
    },
    {
      "content": "Click Add to save the rule.",
      "pos": [
        14948,
        14975
      ]
    },
    {
      "content": "Perform a full sync: on the <bpt id=\"p1\">**</bpt>Connectors<ept id=\"p1\">**</ept> tab, right-click <bpt id=\"p2\">**</bpt>SourceAD<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Run<ept id=\"p3\">**</ept>, click <bpt id=\"p4\">**</bpt>Full Synchronization<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>.",
      "pos": [
        14979,
        15122
      ]
    },
    {
      "content": "Here is a result how this would look like:",
      "pos": [
        15123,
        15165
      ]
    },
    {
      "pos": [
        15173,
        15310
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Note that we are using a mix of cloudFiltered and sourceObjectType to determine which objects we want to synchronize to AAD."
    },
    {
      "content": "With the use of expressions, you have very powerful filtering options.",
      "pos": [
        15312,
        15382
      ]
    },
    {
      "content": "In the expression above, note that we provided the literal NULL when department is not present and when the department was Sales.",
      "pos": [
        15383,
        15512
      ]
    },
    {
      "content": "This indicates that this attribute did not contribute a value and the out-of-box rules will be evaluated.",
      "pos": [
        15513,
        15618
      ]
    },
    {
      "content": "We want this so they can determine if it is a <bpt id=\"p1\">**</bpt>User<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Contact<ept id=\"p2\">**</ept> we should create in Azure AD.",
      "pos": [
        15619,
        15718
      ]
    },
    {
      "content": "Outbound based filtering",
      "pos": [
        15724,
        15748
      ]
    },
    {
      "content": "In some cases it is necessary to do the filtering only after the objects have joined in the metaverse.",
      "pos": [
        15750,
        15852
      ]
    },
    {
      "content": "It could for example be required to look at the mail attribute from the resource forest and the userPrincipalName attribute from the account forest to determine if an object should be synchronizedx.",
      "pos": [
        15853,
        16051
      ]
    },
    {
      "content": "In these cases we will create the filtering on the outbound rule.",
      "pos": [
        16052,
        16117
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> This method requires a change to the out-of-box Synchronization Rules.",
      "pos": [
        16121,
        16204
      ]
    },
    {
      "content": "Changing the scope of a Synchronization Rule is supported, but the change might not be preserved after upgrading to a newer version of Azure AD Connect.",
      "pos": [
        16205,
        16357
      ]
    },
    {
      "content": "If you use outbound based filtering, make a note of the changes to make and after an upgrade ensure the filtering is still there and reapply if required.",
      "pos": [
        16358,
        16511
      ]
    },
    {
      "content": "In this example, we will change the filtering so only users where both mail and userPrincipalName ends with @contoso.com will be synchronized:",
      "pos": [
        16514,
        16656
      ]
    },
    {
      "content": "Log on to the computer that is running Azure AD Connect Sync by using an account that is a member of the ADSyncAdmins security group.",
      "pos": [
        16661,
        16794
      ]
    },
    {
      "content": "Open Synchronization Rules Editor by finding it in the Start Menu.",
      "pos": [
        16798,
        16864
      ]
    },
    {
      "content": "Under Rule Types click on Outbound.",
      "pos": [
        16868,
        16903
      ]
    },
    {
      "content": "Find the rule named Out to AAD – User Join.",
      "pos": [
        16907,
        16950
      ]
    },
    {
      "content": "Click Edit.",
      "pos": [
        16951,
        16962
      ]
    },
    {
      "content": "Click Scoping filter on the left hand navigation.",
      "pos": [
        16966,
        17015
      ]
    },
    {
      "content": "Click Add clause and in Attribute select mail, in Operator select ENDSWITH, and in Value type @contoso.com.",
      "pos": [
        17016,
        17123
      ]
    },
    {
      "content": "Click Add clause and in Attribiute select userPrincipalName, in Operator select ENDSWITH, and in Value type @contoso.com.",
      "pos": [
        17124,
        17245
      ]
    },
    {
      "content": "Click Save.",
      "pos": [
        17249,
        17260
      ]
    },
    {
      "content": "Perform a full sync: on the Connectors tab, right-click SourceAD, click Run, click Full Synchronization, and then click OK.",
      "pos": [
        17264,
        17387
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        17393,
        17403
      ]
    },
    {
      "pos": [
        17404,
        17506
      ],
      "content": "Learn more about the <bpt id=\"p1\">[</bpt>Azure AD Connect sync<ept id=\"p1\">](active-directory-aadconnectsync-whatis.md)</ept> configuration."
    },
    {
      "pos": [
        17508,
        17627
      ],
      "content": "Learn more about <bpt id=\"p1\">[</bpt>Integrating your on-premises identities with Azure Active Directory<ept id=\"p1\">](active-directory-aadconnect.md)</ept>."
    }
  ],
  "content": "<properties\n    pageTitle=\"Azure AD Connect sync: Configure filtering | Microsoft Azure\"\n    description=\"Explains how to configure filtering in Azure AD Connect sync.\"\n    services=\"active-directory\"\n    documentationCenter=\"\"\n    authors=\"markusvi\"\n    manager=\"stevenpo\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"active-directory\"\n    ms.workload=\"identity\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"10/13/2015\"\n    ms.author=\"markusvi;andkjell\"/>\n\n\n# Azure AD Connect sync: Configure Filtering\n\nIn Azure AD Connect sync, you can enable filtering at any time. If you have already run the default configurations of directory synchronization and then configured the filtering, the objects that are filtered out are no longer synchronized to Azure AD. As a result of this, any objects in Azure AD that were previously synchronized but were then filtered are deleted in Azure AD. If objects were inadvertently deleted because of a filtering error, you can re-create the objects in Azure AD by removing your filtering configurations, and then synchronize your directories again.\n\n> [AZURE.IMPORTANT]Microsoft does not support modification or operation of the Azure AD Connect sync outside of those actions formally documented. Any of these actions may result in an inconsistent or unsupported state of Azure AD Connect sync and as a result, Microsoft cannot provide technical support for such deployments.\n\nWith the exception of outbound attribute-based filtering, the configurations will be retained when you install or upgrade to a newer version of Azure AD Connect. It is always a best practice to verify that the configuration was not inadvertently changed after an upgrade to a newer version before running the first synchronization cycle.\n\n\n## Filtering Options\n\n> [AZURE.NOTE]In this topic, Source AD is used as name for your Active Directory Domain Service Connector. If you have multiple forests, you will have one Connector per forest and the configuration must be repeated for each forest.\n\nThe following three filtering configuration types can be applied to the Directory Synchronization tool:\n\n- [**Domain-based**](#configure-domain-based filtering): You can use this filtering type to manage the properties of the SourceAD Connector in Azure AD Connect sync. This type enables you to select which domains are allowed to synchronize to Azure AD.\n\n- [**Configure organizational-unit–based filtering**](#configure-organizational-unit–based filtering): You can use this filtering type to manage the properties of the SourceAD Connector in Azure AD Connect sync. This filtering type enables you to select which OUs are allowed to synchronize to Azure AD.\n\n- [**Attribute–based**](#configure-attribute-based-filtering): You can use this filtering method to specify attribute-based filters. This enables you to control which objects should be synchronized to the cloud.\n\n> [AZURE.NOTE]If you make a change to filter configuration and you use password synchronization then you need to trigger a full sync of all passwords after you have completed the configuration. For steps on how to trigger a password full sync see [Trigger a full sync of all passwords](active-directory-aadconnectsync-implement-password-synchronization.md#trigger-a-full-sync-of-all-passwords)\n\n## Configure domain-based filtering\n\nThis section provides you with the steps you need to perform to configure your domain filter.\n\nIf you have added or removed domains in your forest after you have installed Azure AD Connect you will also have to update the filtering configuration.\n\n\n### Changing the filter for existing domains\n\n> [AZURE.NOTE] If you have modified your domain filter, you also need to update your run profiles.\n\n\n**To set the domain filter, perform the following steps:**\n\n1. Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.\n\n2. On **Start**, tap or click **Synchronization Service** to open the **Synchronization Service Manager**.\n\n3. To open the connectors view, click **Connectors** in the **Tools** menu.\n\n4. In the **Connectors** list, select the connector that has **Active Directory Domain Service** as **Type**.\n\n5. To open the **Properties** dialog, click **Properties** in the **Actions** menu.\n\n6. Click **Configure Directory Partitions**.\n\n7. In the **Select directory partitions** list, verify that only the partitions you want to synchronize are selected. <br> To remove a domain from the synchronization process, clear the domain’s check box.\n\n8. To close the **Properties** dialog, click **OK**.\n\n\nIf you have updated your domain filter, you also need to update the following run profiles:\n\n- Full Import\n- Full Synchronization\n- Delta Import\n- Delta Synchronization\n- Export\n\n\nIf you have **removed** a partition from the directory partitions list, you need to make sure that all run profile steps that are referencing this partition are also removed.\n\n**To remove a step from a run profile, perform the following steps:**\n\n1. In the **Connectors** list, select the connector that has **Active Directory Domain Service** as **Type**.\n\n2. To open the **Configure Run Profiles for** dialog, click **Configure Run Profiles** in the **Actions** menu.\n\n3. In the **Connector run profiles** list, select the run profile you want to configure\n\n4. For each step in the step details list, perform the following steps:\n\n     4.1. If necessary, click the step to expand the step details.\n\n     4.2. If the **Value** of the **Partition** attribute is a GUID, click Delete Step.\n\n5. To close the **Configure Run Profiles for** dialog, click **OK**.\n\nIf you have **added** a partition to the directory partitions list, you need to make sure that a run profile step for that partition is available on each of the run profiles in the list above.\n\n**To add a step to a run profile, perform the following steps:**\n\n1. In the **Connectors** list, select the connector that has **Active Directory Domain Service** as **Type**.\n\n2. To open the **Configure Run Profiles for** dialog, click **Configure Run Profiles** in the **Actions** menu.\n\n3. In the **Connector run profiles** list, select the run profile you want to configure\n\n4. To open the **Configure Run Profile** dialog, click **New Step**.\n\n5. On the **Configure Step** page, in the step type list, select the step type, and then click **Next**.\n\n6. On the **Connector Configuration** page, in the **Partition** list, select the name of the partition you have added to your domain filter.\n\n7. To close the **Configure Run Profile** dialog, click **Finish**.\n\n8. To close the **Configure Run Profiles** for dialog, click **OK**.\n\n### Changing the filter for new or removed domains\nIf you have added a new domain to the forest or removed a domain from the forest, the domain filtering configuration must be updated.\n\n**Steps if you have added a domain**\n\n1. Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.\n\n2. On **Start**, tap or click **Synchronization Service** to open the **Synchronization Service Manager**.\n\n3. To open the connectors view, click **Connectors** in the **Tools** menu.\n\n4. In the **Connectors** list, select the connector that has **Active Directory Domain Service** as **Type**.\n\n5. To open the **Properties** dialog, click **Properties** in the **Actions** menu.\n\n6. Click **Configure Directory Partitions**.\n\n7. Click the **Refresh** button at the top of the page.\n\n8. In the **Select directory partitions** list, select the new domain.\n\n9. To close the **Properties** dialog, click OK.\n\nMake sure the same Connector is still selected. The run profiles for the Connector must now be configured.\n\n\n- Full Import\n- Full Synchronization\n- Delta Import\n- Delta Synchronization\n- Export\n\n\n10. To open the **Configure Run Profiles for** dialog, click **Configure Run Profiles** in the **Actions** menu.\n\n11. In the **Connector run profiles** list, select the run profile you want to configure\n\n12. To open the **Configure Run Profile** dialog, click **New Step**.\n\n13. On the **Configure Step** page, in the step type list, select the step type, and then click **Next**.\n\n14. On the **Connector Configuration** page, in the **Partition** list, select the name of the partition you have added to your domain filter.\n\n15. To close the **Configure Run Profile** dialog, click **Finish**.\n\n16. To close the **Configure Run Profiles** for dialog, click **OK**.\n\n17. Repeat these steps for all run profiles.\n\n**Steps if you have removed a domain**\n\n1. Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.\n\n2. On **Start**, tap or click **Synchronization Service** to open the **Synchronization Service Manager**.\n\n3. To open the connectors view, click **Connectors** in the **Tools** menu.\n\n4. In the **Connectors** list, select the connector that has **Active Directory Domain Service** as **Type**.\n\n5. To open the **Properties** dialog, click **Properties** in the **Actions** menu.\n\n6. Click **Configure Directory Partitions**.\n\n7. Click the **Refresh** button at the top of the page.\n\n8. To close the **Properties** dialog, click OK. A message will pop-up saying a domain was removed and that configuration will be cleaned up.\n\n## Configure organizational-unit–based filtering\n\n**To configure organizational-unit–based filtering, perform the following steps:**\n\n1. Log on to the computer that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.\n\n2. On **Start**, tap or click **Synchronization Service** to open the **Synchronization Service Manager**.<br>\n\n3. In the **Synchronization Service Manager**, click **Connectors**, and then double-click **SourceAD**.\n\n4. Click **Configure Directory Partitions**, select the domain you want to configure, and then click **Containers**.\n\n5. When prompted, enter your domain credentials for the on-premises Active Directory forest.<br> > [AZURE.NOTE]When presented with the credentials dialog box, the account used to import and export to AD DS will be displayed. If you do not know the password to the account you can enter another account to use. The account you use must have read permissions to the domain currently being configured.\n\n6. In the **Select Containers** dialog box, clear the OUs that you don’t want to sync with the cloud directory, and then click **OK**.\n\n7. Click **OK** on the **SourceAD Properties** page.\n\n8. Run a full import and a delta sync by completing the following steps:\n\n     8.1. In the connectors list, select **SourceAD**\n\n     8.2. To open the **Run Connector** dialog, select **Run** from the **Actions** menu.\n\n     8.3. In the **Run profiles** list, select **Full Import**, and then wait for the run profile to complete.\n\n     8.4. To open the **Run Connector** dialog, select **Run** from the **Actions** menu.\n\n     8.5. In the **Run profiles** list, select **Delta Synchronization**, and then wait for the run profile to complete.\n\n\n\n\n## Configure attribute based filtering\n\nThere are several ways to configure filtering based on attributes. Configuration on inbound from AD is recommended since these configuration settings will be kept even after an upgrade to a newer version. Configuration on outbound to AAD is supported, but these settings will not be kept after an upgrade to a newer version and should only be used when it is required to look at the combined object in the metaverse to determine filtering.\n\n### Inbound filtering\n\nInbound based filtering is leveraging the default configuration where objects going to AAD must have the metaverse attribute cloudFiltered not set to a value and the metaverse attribute sourceObjectType set to either “User” or “Contact”.\n\nThe attribute cloudFiltered should be set to True when the object should not be synchronized to Azure AD and kept empty in other cases. This method is used when we can look at an object and say that we do not want to synchronize an object (negative filtering).\n\nIn the following example, we will filter out all users where extensionAttribute15 has the value NoSync:\n\n1. Log on to the computer that is running Azure AD Connect Sync by using an account that is a member of the ADSyncAdmins security group.\n2. Open the **Synchronization Rules Editor** from the **Start Menu**.\n3. Make sure **Inbound** is selected and click **Add New Rule**.\n4. Give the rule a descriptive name, such as \"*In from AD – User DoNotSyncFilter*\", select the correct forest, **User** as the **CS object type**, and **Person** as the **MV object type**. As **Link Type**, select **Join** and in precedence type a value currently not used by another Synchronization Rule (e.g.: 50), and then click **Next**.\n5. In **Scoping filter**, click **Add Group**, click **Add Clause** and in attribute select **ExtensionAttribute15**. Make sure the Operator is set to **EQUAL** and **type** in the value NoSync in the Value box. Click **Next**.\n6. Leave the **Join** rules empty, and then click **Next**.\n7. Click **Add Transformation**, select the **FlowType** to **Constant**, select the Target Attribute cloudFiltered and in the Source text box, type in True. Click Add to save the rule.\n8. Perform a full sync: on the **Connectors** tab, right-click **SourceAD**, click **Run**, click **Full Synchronization**, and then click **OK**.\n\n\nThe attribute **sourceObjectType** will provision an **User** or **Contact** to Azure AD if this attribute has the value **User** or **Contact** respectively. By creating a Synchronization Rule with a higher precedence than those out of box, you can override the default behavior. This method also gives you an opportunity to express both positive and negative rules.\n\nIn the following example, you will only synchronize users when the department attribute is “*Sales*” or is empty:\n\n1. Log on to the computer that is running Azure AD Connect Sync by using an account that is a member of the ADSyncAdmins security group.\n2. Open the **Synchronization Rules Editor** from the **Start Menu**.\n3. Make sure **Inbound** is selected, and then click **Add New Rule**.\n4. Give the rule a descriptive name (e.g.: \"*In from AD – User DoNotSyncFilter*\"), select the correct forest, **User** as the **CS object type**, and **Person** as the **MV object type**. As **Link Type**, select **Join** and in **precedence type**, a value currently not used by another Synchronization Rule (e.g.: 60). Click **Next**.\n5. Leave the **scoping filter** and **join rules** empty and click **Next** twice.\n6. Click **Add Transformation**, select the **FlowType** to **Expression** and select the **Target Attribute** to **sourceObjectType**. In the **Source**, type in the following expression:<br>`IIF(IsNullOrEmpty([department]),NULL,IIF([department]<>”Sales”,”DoNotSync”,NULL))`\n7. Click Add to save the rule.\n8. Perform a full sync: on the **Connectors** tab, right-click **SourceAD**, click **Run**, click **Full Synchronization**, and then click **OK**. Here is a result how this would look like:<br>\n\n> [AZURE.NOTE] Note that we are using a mix of cloudFiltered and sourceObjectType to determine which objects we want to synchronize to AAD.\n\nWith the use of expressions, you have very powerful filtering options. In the expression above, note that we provided the literal NULL when department is not present and when the department was Sales. This indicates that this attribute did not contribute a value and the out-of-box rules will be evaluated. We want this so they can determine if it is a **User** or **Contact** we should create in Azure AD.\n\n\n## Outbound based filtering\n\nIn some cases it is necessary to do the filtering only after the objects have joined in the metaverse. It could for example be required to look at the mail attribute from the resource forest and the userPrincipalName attribute from the account forest to determine if an object should be synchronizedx. In these cases we will create the filtering on the outbound rule.\n\n> [AZURE.NOTE] This method requires a change to the out-of-box Synchronization Rules. Changing the scope of a Synchronization Rule is supported, but the change might not be preserved after upgrading to a newer version of Azure AD Connect. If you use outbound based filtering, make a note of the changes to make and after an upgrade ensure the filtering is still there and reapply if required.\n\n\nIn this example, we will change the filtering so only users where both mail and userPrincipalName ends with @contoso.com will be synchronized:\n\n1. Log on to the computer that is running Azure AD Connect Sync by using an account that is a member of the ADSyncAdmins security group.\n2. Open Synchronization Rules Editor by finding it in the Start Menu.\n3. Under Rule Types click on Outbound.\n4. Find the rule named Out to AAD – User Join. Click Edit.\n5. Click Scoping filter on the left hand navigation. Click Add clause and in Attribute select mail, in Operator select ENDSWITH, and in Value type @contoso.com. Click Add clause and in Attribiute select userPrincipalName, in Operator select ENDSWITH, and in Value type @contoso.com.\n6. Click Save.\n7. Perform a full sync: on the Connectors tab, right-click SourceAD, click Run, click Full Synchronization, and then click OK.\n\n\n## Next steps\nLearn more about the [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.\n\nLearn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).\n\n\n"
}