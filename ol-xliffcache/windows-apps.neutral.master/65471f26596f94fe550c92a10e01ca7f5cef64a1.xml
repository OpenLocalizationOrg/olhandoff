{"nodes":[{"content":"Access sensors and devices from a background task","pos":[28,77]},{"content":"DeviceUseTrigger lets your Universal Windows app access sensors and peripheral devices in the background, even when your foreground app is suspended.","pos":[91,240]},{"content":"Access sensors and devices from a background task","pos":[297,346]},{"content":"Updated for UWP apps on Windows 10.","pos":[352,387]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[388,480]},{"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> lets your Universal Windows app access sensors and peripheral devices in the background, even when your foreground app is suspended.","pos":[486,699]},{"content":"For example, depending on where your app is running, it could use a background task to synchronize data with devices or monitor sensors.","pos":[700,836]},{"content":"To help preserve battery life and ensure the appropriate user consent, the use of <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> is subject to policies that are described in this topic.","pos":[837,1056]},{"content":"To access sensors or peripheral devices in the background, create a background task that uses the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>.","pos":[1058,1237]},{"content":"For an example that shows how this is done on a PC, see the <bpt id=\"p1\">[</bpt>Custom USB device sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=301975 )</ept>.","pos":[1238,1375]},{"content":"For an example on a phone, see the <bpt id=\"p1\">[</bpt>Background Sensors sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=393307)</ept>.","pos":[1376,1488]},{"content":"Device background task overview","pos":[1493,1524]},{"content":"When your app is no longer visible to the user, Windows will suspend or terminate your app to reclaim memory and CPU resources.","pos":[1527,1654]},{"content":"This allows other apps to run in the foreground and reduces battery consumption.","pos":[1655,1735]},{"content":"When this happens, without the help of a background task, any ongoing data events will be lost.","pos":[1736,1831]},{"content":"Windows provides the background task trigger, <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>, to let your app perform long running sync and monitoring operations on devices and sensors safely in the background, even if your app is suspended.","pos":[1832,2107]},{"content":"For more info about app lifecycle, see <bpt id=\"p1\">[</bpt>Launching, resuming, and background tasks<ept id=\"p1\">](index.md)</ept>.","pos":[2108,2201]},{"content":"For more about background tasks, see <bpt id=\"p1\">[</bpt>Support your app with background tasks<ept id=\"p1\">](support-your-app-with-background-tasks.md)</ept>.","pos":[2202,2323]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  In a Universal Windows app, syncing a device in the background requires that your user has approved background syncing by your app.","pos":[2325,2466]},{"content":"The device must also be connected to or paired with the PC, with active I/O, and is allowed a maximum of 10 minutes of background activity.","pos":[2467,2606]},{"content":"More detail on policy enforcement is described later in this topic.","pos":[2607,2674]},{"content":"Limitation: critical device operations","pos":[2680,2718]},{"content":"Some critical device operations, such as long running firmware updates, cannot be performed with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>.","pos":[2720,2902]},{"content":"Such operations can be performed only on the PC, and only by a privileged app that uses the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceServicingTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297315)</ept>.","pos":[2903,3082]},{"content":"A <bpt id=\"p1\">*</bpt>privileged app<ept id=\"p1\">*</ept> is an app that the device's manufacturer has authorized to perform those operations.","pos":[3083,3186]},{"content":"Device metadata is used to specify which app, if any, has been designated as the privileged app for a device.","pos":[3187,3296]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Device sync and update for Windows Store device apps<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=306619)</ept>.","pos":[3297,3420]},{"content":"Protocols/APIs supported in a DeviceUseTrigger background task","pos":[3425,3487]},{"content":"Background tasks that use <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> let your app communicate over many protocols/APIs, most of which aren't supported by system-triggered background tasks.","pos":[3490,3716]},{"content":"The following are supported on a Universal Windows app.","pos":[3717,3772]},{"content":"Protocol","pos":[3776,3784]},{"content":"DeviceUseTrigger in a Universal Windows app","pos":[3795,3838]},{"content":"USB","pos":[4204,4207]},{"content":"this protocol is supported.","pos":[4225,4252]},{"content":"HID","pos":[4418,4421]},{"content":"this protocol is supported.","pos":[4439,4466]},{"content":"Bluetooth RFCOMM","pos":[4632,4648]},{"content":"this protocol is supported.","pos":[4653,4680]},{"content":"Bluetooth GATT","pos":[4846,4860]},{"content":"this protocol is supported.","pos":[4867,4894]},{"content":"MTP","pos":[5060,5063]},{"content":"this protocol is supported.","pos":[5081,5108]},{"content":"Network wired","pos":[5274,5287]},{"content":"this protocol is supported.","pos":[5295,5322]},{"content":"Network Wi-Fi","pos":[5488,5501]},{"content":"this protocol is supported.","pos":[5509,5536]},{"content":"IDeviceIOControl","pos":[5702,5718]},{"content":"deviceservicingtrigger supports ideviceiocontrol","pos":[5723,5771]},{"content":"Sensors API","pos":[5916,5927]},{"pos":[5937,6125],"content":"deviceservicingtrigger supports universal sensors apis<ph id=\"ph1\">](images/ap-tools.png)</ph> (limited to sensors in the <bpt id=\"p1\">[</bpt>universal device family<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn894631)</ept>)"},{"content":"Registering background tasks in the app package manifest","pos":[6135,6191]},{"content":"Your app will perform sync and update operations in code that runs as part of a background task.","pos":[6194,6290]},{"content":"This code is embedded in a Windows Runtime class that implements <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IBackgroundTask<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224794)</ept> (or in a dedicated JavaScript page for JavaScript apps).","pos":[6291,6492]},{"content":"To use a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task, your app must declare it in the app manifest file of a foreground app, like it does for system-triggered background tasks.","pos":[6493,6722]},{"pos":[6724,6939],"content":"In this example of an app package manifest file, <bpt id=\"p1\">**</bpt>DeviceLibrary.SyncContent<ept id=\"p1\">**</ept> is the entry point for a background task that uses the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>DeviceUseTrigger<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>."},{"content":"Introduction to using DeviceUseTrigger","pos":[7167,7205]},{"content":"To use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>, follow these basic steps.","pos":[7208,7326]},{"content":"For more info about background tasks, see <bpt id=\"p1\">[</bpt>Support your app with background tasks<ept id=\"p1\">](support-your-app-with-background-tasks.md)</ept>.","pos":[7327,7453]},{"content":"Your app registers its background task in the app manifest and embeds the background task code in a Windows Runtime class that implements IBackgroundTask or in a dedicated JavaScript page for JavaScript apps.","pos":[7459,7667]},{"pos":[7672,7876],"content":"When your app starts, it will create and configure a trigger object of type <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>, and store the trigger instance for future use."},{"content":"Your app checks whether the background task has been previously registered and, if not, registers it against the trigger.","pos":[7881,8002]},{"content":"Note that your app isn't allowed to set conditions on the task associated with this trigger.","pos":[8003,8095]},{"pos":[8100,8311],"content":"When your app needs to trigger the background task, it must first call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestAccessAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700485)</ept> to check if the app is able to request a background task."},{"pos":[8316,8497],"content":"If the app can request the background task, it calls the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297341)</ept> activation method on the device trigger object."},{"content":"Your background task isn’t throttled like other system background tasks (there's no CPU time quota) but will run with reduced priority to keep foreground apps responsive.","pos":[8502,8672]},{"content":"Windows will then validate, based on the trigger type, that the necessary policies have been met, including requesting user consent for the operation before starting the background task.","pos":[8677,8863]},{"content":"Windows monitors system conditions and task runtime and, if necessary, cancels the task if the required conditions are no longer met.","pos":[8868,9001]},{"content":"When the background tasks reports progress or completion, your app will receive these events through progress and completed events on the registered task.","pos":[9006,9160]},{"content":"Important","pos":[9164,9173]},{"content":"Consider these important points when using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept>:","pos":[9178,9306]},{"pos":[9312,9521],"content":"The ability to programmatically trigger background tasks that use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> was first introduced in Windows 8.1 and Windows Phone 8.1."},{"content":"Certain policies are enforced by Windows to ensure user consent when updating peripheral devices on the PC.","pos":[9527,9634]},{"content":"Additional polices are enforced to preserve user battery life when syncing and updating peripheral devices.","pos":[9640,9747]},{"content":"Background tasks that use <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> might be canceled by Windows when certain policy requirements are no longer met, including a maximum amount of background time (wall clock time).","pos":[9753,10005]},{"content":"It's important to consider these policy requirements when using these background tasks to interact with your peripheral device.","pos":[10006,10133]},{"content":"<bpt id=\"p1\">**</bpt>Tip<ept id=\"p1\">**</ept>  To see how these background tasks work, download a sample.","pos":[10138,10205]},{"content":"For an example that shows how this is done on a PC, see the <bpt id=\"p1\">[</bpt>Custom USB device sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=301975 )</ept>.","pos":[10206,10343]},{"content":"For an example on a phone, see the <bpt id=\"p1\">[</bpt>Background Sensors sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=393307)</ept>.","pos":[10344,10456]},{"content":"Frequency and foreground restrictions","pos":[10464,10501]},{"content":"There is no restriction on the frequency with which your app can initiate operations, but your app can run only one <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task operation at a time (this does not affect other types of background tasks), and can initiate a background task only while your app is in the foreground.","pos":[10504,10869]},{"content":"When your app isn't in the foreground, it is unable to initiate a background task with <bpt id=\"p1\">**</bpt>DeviceUseTrigger<ept id=\"p1\">**</ept>.","pos":[10870,10978]},{"content":"Your app can't initiate a second <bpt id=\"p1\">**</bpt>DeviceUseTrigger<ept id=\"p1\">**</ept> background task before the first background task has completed.","pos":[10979,11096]},{"content":"Device restrictions","pos":[11101,11120]},{"content":"While each app is limited to registering and running only one <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task, the device (on which your app is running) may allow multiple apps to register and run <bpt id=\"p3\">**</bpt>DeviceUseTrigger<ept id=\"p3\">**</ept> background tasks.","pos":[11123,11407]},{"content":"Depending on the device, there may be a limit on the total number of <bpt id=\"p1\">**</bpt>DeviceUseTrigger<ept id=\"p1\">**</ept> background tasks from all apps.","pos":[11408,11529]},{"content":"This helps preserve battery on resource-constrained devices.","pos":[11530,11590]},{"content":"See the following table for more details.","pos":[11591,11632]},{"pos":[11634,11909],"content":"From a single <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task, your app can access an unlimited number of peripheral devices or sensors - limited only by the supported APIs and protocols that were listed in the previous table."},{"content":"Background task policies","pos":[11914,11938]},{"content":"Windows enforces policies when your app uses a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task.","pos":[11941,12085]},{"content":"If these policies aren't met, the background task might be canceled.","pos":[12086,12154]},{"content":"It's important to consider these policy requirements when using this type of background task to interact with devices or sensors.","pos":[12155,12284]},{"content":"Task initiation policies","pos":[12290,12314]},{"content":"This table indicates which task initiation policies apply to a Universal Windows app.","pos":[12316,12401]},{"content":"Policy","pos":[12405,12411]},{"content":"DeviceUseTrigger in a Universal Windows app","pos":[12414,12457]},{"content":"Your app is in the foreground when triggering the background task.","pos":[12814,12880]},{"content":"policy applies","pos":[12885,12899]},{"content":"The device is attached to the system (or in range for a wireless device).","pos":[12926,12999]},{"content":"policy applies","pos":[13004,13018]},{"content":"The device is accessible to the app using the supported device peripheral APIs (the Windows Runtime APIs for USB, HID, Bluetooth, Sensors, and so on).","pos":[13045,13195]},{"content":"If your app can't access the device or sensor, access to the background task is denied.","pos":[13196,13283]},{"content":"policy applies","pos":[13288,13302]},{"content":"Background task entry point provided by the app is registered in the app package manifest.","pos":[13329,13419]},{"content":"policy applies","pos":[13424,13438]},{"pos":[13465,13586],"content":"Only one <bpt id=\"p1\">[</bpt>DeviceUseTrigger<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task is running per app."},{"content":"policy applies","pos":[13591,13605]},{"pos":[13632,13818],"content":"The maximum number of <bpt id=\"p1\">[</bpt>DeviceUseTrigger<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background tasks has not yet been reached on the device (on which your app is running)."},{"content":"desktop device family: An unlimited number of tasks can be registered and run in parallel.","pos":[13821,13911]},{"content":"mobile device family: 1 task on a 512 MB device; otherwise, 2 tasks can be registered and run in parallel.","pos":[13927,14033]},{"pos":[14038,14263],"content":"The maximum number of peripheral devices or sensors that your app can access from a single <bpt id=\"p1\">[</bpt>DeviceUseTrigger<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task, when using the supported APIs/protocols."},{"content":"unlimited","pos":[14266,14275]},{"content":"Your background task consumes 400ms of CPU time (assuming a 1GHz CPU) every minute when the screen is locked, or every 5 minutes when the screen is not locked.","pos":[14280,14439]},{"content":"Failure to meet this policy can result in cancellation of your task.","pos":[14440,14508]},{"content":"policy applies","pos":[14513,14527]},{"content":"Runtime policy checks","pos":[14559,14580]},{"content":"Windows enforces the following runtime policy requirements while your task is running in the background.","pos":[14582,14686]},{"content":"If any of the runtime requirements stops being true, Windows will cancel your device background task.","pos":[14687,14788]},{"content":"This table indicates which runtime policies apply to a Universal Windows app.","pos":[14790,14867]},{"content":"Policy check","pos":[14871,14883]},{"content":"DeviceUseTrigger in a Universal Windows app","pos":[14886,14929]},{"content":"The device is attached to the system (or in range for a wireless device).","pos":[15139,15212]},{"content":"policy check applies","pos":[15217,15237]},{"content":"Task is performing regular I/O to the device (1 I/O every 5 seconds).","pos":[15264,15333]},{"content":"policy check applies","pos":[15338,15358]},{"content":"App has not canceled the task.","pos":[15385,15415]},{"content":"policy check applies","pos":[15420,15440]},{"content":"Wall-clock time limit – the total amount of time your app’s task can run in the background.","pos":[15467,15558]},{"content":"desktop device family: 10 minutes.","pos":[15561,15595]},{"content":"mobile device family: No time limit.","pos":[15611,15647]},{"content":"To conserve resources, no more than 1 or 2 tasks can execute at once.","pos":[15648,15717]},{"content":"App has not exited.","pos":[15722,15741]},{"content":"policy check applies","pos":[15746,15766]},{"content":"Best practices","pos":[15798,15812]},{"pos":[15815,15968],"content":"The following are best practices for apps that use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background tasks."},{"content":"Programming a background task","pos":[15974,16003]},{"content":"Using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task from your app ensures that any sync or monitoring operations started from your foreground app continue to run in the background if your users switch apps and your foreground app is suspended by Windows.","pos":[16005,16314]},{"content":"We recommend that you follow this overall model for registering, triggering, and unregistering your background tasks:","pos":[16315,16432]},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>RequestAccessAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh700485)</ept> to check if the app is able to request a background task.","pos":[16438,16583]},{"content":"This must be done before registering a background task.","pos":[16584,16639]},{"content":"Register the background task before requesting the trigger.","pos":[16645,16704]},{"content":"Connect progress and completion event handlers to your trigger.","pos":[16710,16773]},{"content":"When your app returns from suspension, Windows will provide your app with any queued progress or completion events that can be used to determine the status of your background tasks.","pos":[16774,16955]},{"pos":[16961,17208],"content":"Close any open device or sensor objects when you trigger your <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task so that those devices or sensors are free to be opened and used by your background task."},{"content":"Register the trigger.","pos":[17214,17235]},{"content":"Carefully consider the battery impact of accessing a device or senor from a background task.","pos":[17241,17333]},{"content":"For example, having the report interval of a sensor run too frequently could cause the task to run so often that it quickly drains a phone's battery.","pos":[17334,17483]},{"content":"When your background task completes, unregister it.","pos":[17489,17540]},{"content":"Register for cancellation events from your background task class.","pos":[17546,17611]},{"content":"Registering for cancellation events will allow your background task code to cleanly stop your running background task when canceled by Windows or your foreground app.","pos":[17612,17778]},{"content":"On app exit (not suspension), unregister and cancel any running tasks if your app no longer needs them.","pos":[17784,17887]},{"content":"On resource-constrained systems, such as low-memory phones, this will allow other apps to use a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DeviceUseTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task.","pos":[17888,18081]},{"content":"When your app exits, unregister and cancel any running tasks.","pos":[18091,18152]},{"content":"When your app exits, your background tasks will be canceled and any existing event handlers will be disconnected from your existing background tasks.","pos":[18162,18311]},{"content":"This prevents you from determining the state of your background tasks.","pos":[18312,18382]},{"content":"Unregistering and canceling the background task will allow your cancellation code to cleanly stop your background tasks.","pos":[18383,18503]},{"content":"Cancelling a background task","pos":[18509,18537]},{"content":"To cancel a task running in the background from your foreground app, use the Unregister method on the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BackgroundTaskRegistration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224786)</ept> object you use in your app to register the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>DeviceUseTrigger<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn297337)</ept> background task.","pos":[18539,18872]},{"content":"Unregistering your background task by using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Unregister<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br229869)</ept> method on <bpt id=\"p3\">**</bpt>BackgroundTaskRegistration<ept id=\"p3\">**</ept> will cause the background task infrastructure to cancel your background task.","pos":[18873,19114]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Unregister<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br229869)</ept> method additionally takes a Boolean true or false value to indicate if currently running instances of your background task should be canceled without allowing them to finish.","pos":[19116,19369]},{"content":"For more info, see the API reference for <bpt id=\"p1\">**</bpt>Unregister<ept id=\"p1\">**</ept>.","pos":[19370,19426]},{"content":"In addition to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Unregister<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br229869)</ept>, your app will also need to call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BackgroundTaskDeferral.Complete<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700504)</ept>.","pos":[19428,19647]},{"content":"This informs the system that the asynchronous operation associated with a background task has finished.","pos":[19648,19751]}],"content":"---\nauthor: dbirtolo\ntitle: Access sensors and devices from a background task\ndescription: DeviceUseTrigger lets your Universal Windows app access sensors and peripheral devices in the background, even when your foreground app is suspended.\nms.assetid: B540200D-9FF2-49AF-A224-50877705156B\n---\n\n# Access sensors and devices from a background task\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n[**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) lets your Universal Windows app access sensors and peripheral devices in the background, even when your foreground app is suspended. For example, depending on where your app is running, it could use a background task to synchronize data with devices or monitor sensors. To help preserve battery life and ensure the appropriate user consent, the use of [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) is subject to policies that are described in this topic.\n\nTo access sensors or peripheral devices in the background, create a background task that uses the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337). For an example that shows how this is done on a PC, see the [Custom USB device sample](http://go.microsoft.com/fwlink/p/?LinkId=301975 ). For an example on a phone, see the [Background Sensors sample](http://go.microsoft.com/fwlink/p/?LinkId=393307).\n\n## Device background task overview\n\n\nWhen your app is no longer visible to the user, Windows will suspend or terminate your app to reclaim memory and CPU resources. This allows other apps to run in the foreground and reduces battery consumption. When this happens, without the help of a background task, any ongoing data events will be lost. Windows provides the background task trigger, [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337), to let your app perform long running sync and monitoring operations on devices and sensors safely in the background, even if your app is suspended. For more info about app lifecycle, see [Launching, resuming, and background tasks](index.md). For more about background tasks, see [Support your app with background tasks](support-your-app-with-background-tasks.md).\n\n**Note**  In a Universal Windows app, syncing a device in the background requires that your user has approved background syncing by your app. The device must also be connected to or paired with the PC, with active I/O, and is allowed a maximum of 10 minutes of background activity. More detail on policy enforcement is described later in this topic.\n\n### Limitation: critical device operations\n\nSome critical device operations, such as long running firmware updates, cannot be performed with the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337). Such operations can be performed only on the PC, and only by a privileged app that uses the [**DeviceServicingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297315). A *privileged app* is an app that the device's manufacturer has authorized to perform those operations. Device metadata is used to specify which app, if any, has been designated as the privileged app for a device. For more info, see [Device sync and update for Windows Store device apps](http://go.microsoft.com/fwlink/p/?LinkId=306619).\n\n## Protocols/APIs supported in a DeviceUseTrigger background task\n\n\nBackground tasks that use [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) let your app communicate over many protocols/APIs, most of which aren't supported by system-triggered background tasks. The following are supported on a Universal Windows app.\n\n| Protocol         | DeviceUseTrigger in a Universal Windows app                                                                                                                                                    |\n|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| USB              | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| HID              | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| Bluetooth RFCOMM | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| Bluetooth GATT   | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| MTP              | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| Network wired    | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| Network Wi-Fi    | ![this protocol is supported.](images/ap-tools.png)                                                                                                                                            |\n| IDeviceIOControl | ![deviceservicingtrigger supports ideviceiocontrol](images/ap-tools.png)                                                                                                                       |\n| Sensors API      | ![deviceservicingtrigger supports universal sensors apis](images/ap-tools.png) (limited to sensors in the [universal device family](https://msdn.microsoft.com/library/windows/apps/dn894631)) |\n\n \n\n## Registering background tasks in the app package manifest\n\n\nYour app will perform sync and update operations in code that runs as part of a background task. This code is embedded in a Windows Runtime class that implements [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794) (or in a dedicated JavaScript page for JavaScript apps). To use a [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task, your app must declare it in the app manifest file of a foreground app, like it does for system-triggered background tasks.\n\nIn this example of an app package manifest file, **DeviceLibrary.SyncContent** is the entry point for a background task that uses the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337).\n\n```xml\n<Extensions>\n  <Extension Category=\"windows.backgroundTasks\" EntryPoint=\"DeviceLibrary.SyncContent\">\n    <BackgroundTasks>\n      <m2:Task Type=\"deviceUse\" /> \n    </BackgroundTasks>\n  </Extension>\n</Extensions>\n```\n\n## Introduction to using DeviceUseTrigger\n\n\nTo use the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337), follow these basic steps. For more info about background tasks, see [Support your app with background tasks](support-your-app-with-background-tasks.md).\n\n1.  Your app registers its background task in the app manifest and embeds the background task code in a Windows Runtime class that implements IBackgroundTask or in a dedicated JavaScript page for JavaScript apps.\n2.  When your app starts, it will create and configure a trigger object of type [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337), and store the trigger instance for future use.\n3.  Your app checks whether the background task has been previously registered and, if not, registers it against the trigger. Note that your app isn't allowed to set conditions on the task associated with this trigger.\n4.  When your app needs to trigger the background task, it must first call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) to check if the app is able to request a background task.\n5.  If the app can request the background task, it calls the [**RequestAsync**](https://msdn.microsoft.com/library/windows/apps/dn297341) activation method on the device trigger object.\n6.  Your background task isn’t throttled like other system background tasks (there's no CPU time quota) but will run with reduced priority to keep foreground apps responsive.\n7.  Windows will then validate, based on the trigger type, that the necessary policies have been met, including requesting user consent for the operation before starting the background task.\n8.  Windows monitors system conditions and task runtime and, if necessary, cancels the task if the required conditions are no longer met.\n9.  When the background tasks reports progress or completion, your app will receive these events through progress and completed events on the registered task.\n\n**Important**  \nConsider these important points when using the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337):\n\n-   The ability to programmatically trigger background tasks that use the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) was first introduced in Windows 8.1 and Windows Phone 8.1.\n\n-   Certain policies are enforced by Windows to ensure user consent when updating peripheral devices on the PC.\n\n-   Additional polices are enforced to preserve user battery life when syncing and updating peripheral devices.\n\n-   Background tasks that use [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) might be canceled by Windows when certain policy requirements are no longer met, including a maximum amount of background time (wall clock time). It's important to consider these policy requirements when using these background tasks to interact with your peripheral device.\n\n \n\n**Tip**  To see how these background tasks work, download a sample. For an example that shows how this is done on a PC, see the [Custom USB device sample](http://go.microsoft.com/fwlink/p/?LinkId=301975 ). For an example on a phone, see the [Background Sensors sample](http://go.microsoft.com/fwlink/p/?LinkId=393307).\n\n \n\n## Frequency and foreground restrictions\n\n\nThere is no restriction on the frequency with which your app can initiate operations, but your app can run only one [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task operation at a time (this does not affect other types of background tasks), and can initiate a background task only while your app is in the foreground. When your app isn't in the foreground, it is unable to initiate a background task with **DeviceUseTrigger**. Your app can't initiate a second **DeviceUseTrigger** background task before the first background task has completed.\n\n## Device restrictions\n\n\nWhile each app is limited to registering and running only one [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task, the device (on which your app is running) may allow multiple apps to register and run **DeviceUseTrigger** background tasks. Depending on the device, there may be a limit on the total number of **DeviceUseTrigger** background tasks from all apps. This helps preserve battery on resource-constrained devices. See the following table for more details.\n\nFrom a single [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task, your app can access an unlimited number of peripheral devices or sensors - limited only by the supported APIs and protocols that were listed in the previous table.\n\n## Background task policies\n\n\nWindows enforces policies when your app uses a [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task. If these policies aren't met, the background task might be canceled. It's important to consider these policy requirements when using this type of background task to interact with devices or sensors.\n\n### Task initiation policies\n\nThis table indicates which task initiation policies apply to a Universal Windows app.\n\n| Policy | DeviceUseTrigger in a Universal Windows app |\n|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n| Your app is in the foreground when triggering the background task. | ![policy applies](images/ap-tools.png) |\n| The device is attached to the system (or in range for a wireless device). | ![policy applies](images/ap-tools.png) |\n| The device is accessible to the app using the supported device peripheral APIs (the Windows Runtime APIs for USB, HID, Bluetooth, Sensors, and so on). If your app can't access the device or sensor, access to the background task is denied. | ![policy applies](images/ap-tools.png) |\n| Background task entry point provided by the app is registered in the app package manifest. | ![policy applies](images/ap-tools.png) |\n| Only one [DeviceUseTrigger](https://msdn.microsoft.com/library/windows/apps/dn297337) background task is running per app. | ![policy applies](images/ap-tools.png) |\n| The maximum number of [DeviceUseTrigger](https://msdn.microsoft.com/library/windows/apps/dn297337) background tasks has not yet been reached on the device (on which your app is running). | desktop device family: An unlimited number of tasks can be registered and run in parallel. |\n|  |  |\n|  | mobile device family: 1 task on a 512 MB device; otherwise, 2 tasks can be registered and run in parallel. |\n| The maximum number of peripheral devices or sensors that your app can access from a single [DeviceUseTrigger](https://msdn.microsoft.com/library/windows/apps/dn297337) background task, when using the supported APIs/protocols. | unlimited |\n| Your background task consumes 400ms of CPU time (assuming a 1GHz CPU) every minute when the screen is locked, or every 5 minutes when the screen is not locked. Failure to meet this policy can result in cancellation of your task. | ![policy applies](images/ap-tools.png) |\n \n\n### Runtime policy checks\n\nWindows enforces the following runtime policy requirements while your task is running in the background. If any of the runtime requirements stops being true, Windows will cancel your device background task.\n\nThis table indicates which runtime policies apply to a Universal Windows app.\n\n| Policy check | DeviceUseTrigger in a Universal Windows app |\n|---------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n| The device is attached to the system (or in range for a wireless device). | ![policy check applies](images/ap-tools.png) |\n| Task is performing regular I/O to the device (1 I/O every 5 seconds). | ![policy check applies](images/ap-tools.png) |\n| App has not canceled the task. | ![policy check applies](images/ap-tools.png) |\n| Wall-clock time limit – the total amount of time your app’s task can run in the background. | desktop device family: 10 minutes. |\n|  |  |\n|  | mobile device family: No time limit. To conserve resources, no more than 1 or 2 tasks can execute at once. |\n| App has not exited. | ![policy check applies](images/ap-tools.png) |\n\n \n\n## Best practices\n\n\nThe following are best practices for apps that use the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background tasks.\n\n### Programming a background task\n\nUsing the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task from your app ensures that any sync or monitoring operations started from your foreground app continue to run in the background if your users switch apps and your foreground app is suspended by Windows. We recommend that you follow this overall model for registering, triggering, and unregistering your background tasks:\n\n1.  Call [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) to check if the app is able to request a background task. This must be done before registering a background task.\n\n2.  Register the background task before requesting the trigger.\n\n3.  Connect progress and completion event handlers to your trigger. When your app returns from suspension, Windows will provide your app with any queued progress or completion events that can be used to determine the status of your background tasks.\n\n4.  Close any open device or sensor objects when you trigger your [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task so that those devices or sensors are free to be opened and used by your background task.\n\n5.  Register the trigger.\n\n6.  Carefully consider the battery impact of accessing a device or senor from a background task. For example, having the report interval of a sensor run too frequently could cause the task to run so often that it quickly drains a phone's battery.\n\n7.  When your background task completes, unregister it.\n\n8.  Register for cancellation events from your background task class. Registering for cancellation events will allow your background task code to cleanly stop your running background task when canceled by Windows or your foreground app.\n\n9.  On app exit (not suspension), unregister and cancel any running tasks if your app no longer needs them. On resource-constrained systems, such as low-memory phones, this will allow other apps to use a [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task.\n\n    -   When your app exits, unregister and cancel any running tasks.\n\n    -   When your app exits, your background tasks will be canceled and any existing event handlers will be disconnected from your existing background tasks. This prevents you from determining the state of your background tasks. Unregistering and canceling the background task will allow your cancellation code to cleanly stop your background tasks.\n\n### Cancelling a background task\n\nTo cancel a task running in the background from your foreground app, use the Unregister method on the [**BackgroundTaskRegistration**](https://msdn.microsoft.com/library/windows/apps/br224786) object you use in your app to register the [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337) background task. Unregistering your background task by using the [**Unregister**](https://msdn.microsoft.com/library/windows/apps/br229869) method on **BackgroundTaskRegistration** will cause the background task infrastructure to cancel your background task.\n\nThe [**Unregister**](https://msdn.microsoft.com/library/windows/apps/br229869) method additionally takes a Boolean true or false value to indicate if currently running instances of your background task should be canceled without allowing them to finish. For more info, see the API reference for **Unregister**.\n\nIn addition to [**Unregister**](https://msdn.microsoft.com/library/windows/apps/br229869), your app will also need to call [**BackgroundTaskDeferral.Complete**](https://msdn.microsoft.com/library/windows/apps/hh700504). This informs the system that the asynchronous operation associated with a background task has finished.\n\n \n\n \n\n\n\n"}