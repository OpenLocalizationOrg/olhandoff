{"nodes":[{"content":"Passing arrays to a Windows Runtime Component","pos":[29,74]},{"content":"In the Windows Universal Platform (UWP), parameters are either for input or for output, never both.","pos":[88,187]},{"content":"This means that the contents of an array that is passed to a method, as well as the array itself, are either for input or for output.","pos":[188,321]},{"content":"Passing arrays to a Windows Runtime Component","pos":[378,423]},{"content":"Updated for UWP apps on Windows 10.","pos":[429,464]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[465,557]},{"content":"In the Windows Universal Platform (UWP), parameters are either for input or for output, never both.","pos":[563,662]},{"content":"This means that the contents of an array that is passed to a method, as well as the array itself, are either for input or for output.","pos":[663,796]},{"content":"If the contents of the array are for input, the method reads from the array but doesn't write to it.","pos":[797,897]},{"content":"If the contents of the array are for output, the method writes to the array but doesn't read from it.","pos":[898,999]},{"content":"This presents a problem for array parameters, because arrays in the .NET Framework are reference types, and the contents of an array are mutable even when the array reference is passed by value (<bpt id=\"p1\">**</bpt>ByVal<ept id=\"p1\">**</ept> in Visual Basic).","pos":[1000,1222]},{"content":"The <bpt id=\"p1\">[</bpt>Windows Runtime Metadata Export Tool (Winmdexp.exe)<ept id=\"p1\">](https://msdn.microsoft.com/library/hh925576.aspx)</ept> requires you to specify the intended usage of the array if it is not clear from context, by applying the ReadOnlyArrayAttribute attribute or the WriteOnlyArrayAttribute attribute to the parameter.","pos":[1223,1527]},{"content":"Array usage is determined as follows:","pos":[1528,1565]},{"content":"For the return value or for an out parameter (a <bpt id=\"p1\">**</bpt>ByRef<ept id=\"p1\">**</ept> parameter with the <bpt id=\"p2\">[</bpt>OutAttribute<ept id=\"p2\">](https://msdn.microsoft.com/library/system.runtime.interopservices.outattribute.aspx)</ept> attribute in Visual Basic) the array is always for output only.","pos":[1571,1811]},{"content":"Do not apply the ReadOnlyArrayAttribute attribute.","pos":[1812,1862]},{"content":"The WriteOnlyArrayAttribute attribute is allowed on output parameters, but it's redundant.","pos":[1863,1953]},{"content":"<bpt id=\"p1\">**</bpt>Caution<ept id=\"p1\">**</ept>  The Visual Basic compiler does not enforce output-only rules.","pos":[1961,2035]},{"content":"You should never read from an output parameter; it may contain <bpt id=\"p1\">**</bpt>Nothing<ept id=\"p1\">**</ept>.","pos":[2036,2111]},{"content":"Always assign a new array.","pos":[2112,2138]},{"content":"Parameters that have the <bpt id=\"p1\">**</bpt>ref<ept id=\"p1\">**</ept> modifier (<bpt id=\"p2\">**</bpt>ByRef<ept id=\"p2\">**</ept> in Visual Basic) are not allowed.","pos":[2145,2231]},{"content":"Winmdexp.exe generates an error.","pos":[2232,2264]},{"content":"For a parameter that is passed by value, you must specify whether the array contents are for input or output by applying either the <bpt id=\"p1\">[</bpt>ReadOnlyArrayAttribute<ept id=\"p1\">](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.readonlyarrayattribute.aspx)</ept> attribute or the <bpt id=\"p2\">[</bpt>WriteOnlyArrayAttribute<ept id=\"p2\">](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.writeonlyarrayattribute.aspx)</ept> attribute.","pos":[2269,2700]},{"content":"Specifying both attributes is an error.","pos":[2701,2740]},{"content":"If a method must accept an array for input, modify the array contents, and return the array to the caller, use a read-only parameter for the input and a write-only parameter (or the return value) for the output.","pos":[2742,2953]},{"content":"The following code shows one way to implement this pattern:","pos":[2954,3013]},{"content":"[!div class=\"tabbedCodeSnippets\"]","pos":[3017,3050]},{"content":"We recommend that you make a copy of the input array immediately, and manipulate the copy.","pos":[3455,3545]},{"content":"This helps ensure that the method behaves the same whether or not your component is called by .NET Framework code.","pos":[3546,3660]},{"content":"Using components from managed and unmanaged code","pos":[3665,3713]},{"content":"Parameters that have the ReadOnlyArrayAttribute attribute or the WriteOnlyArrayAttribute attribute behave differently depending on whether the caller is written in native code or managed code.","pos":[3716,3908]},{"content":"If the caller is native code (JavaScript or Visual C++ component extensions), the array contents are treated as follows:","pos":[3909,4029]},{"content":"ReadOnlyArrayAttribute: The array is copied when the call crosses the application binary interface (ABI) boundary.","pos":[4035,4149]},{"content":"Elements are converted if necessary.","pos":[4150,4186]},{"content":"Therefore, any accidental changes the method makes to an input-only array are not visible to the caller.","pos":[4187,4291]},{"content":"WriteOnlyArrayAttribute: The called method can't make any assumptions about the contents of the original array.","pos":[4296,4407]},{"content":"For example, the array the method receives might not be initialized, or might contain default values.","pos":[4408,4509]},{"content":"The method is expected to set the values of all the elements in the array.","pos":[4510,4584]},{"content":"If the caller is managed code, the original array is available to the called method, as it would be in any method call in the .NET Framework.","pos":[4586,4727]},{"content":"Array contents are mutable in .NET Framework code, so any changes the method makes to the array are visible to the caller.","pos":[4728,4850]},{"content":"This is important to remember because it affects unit tests written for a Windows Runtime Component.","pos":[4851,4951]},{"content":"If the tests are written in managed code, the contents of an array will appear to be mutable during testing.","pos":[4952,5060]},{"content":"Related topics","pos":[5065,5079]},{"content":"ReadOnlyArrayAttribute","pos":[5084,5106]},{"content":"WriteOnlyArrayAttribute","pos":[5221,5244]},{"content":"Creating Windows Runtime Components in C# and Visual Basic","pos":[5360,5418]}],"content":"---\nauthor: msatranjr\ntitle: Passing arrays to a Windows Runtime Component\ndescription: In the Windows Universal Platform (UWP), parameters are either for input or for output, never both. This means that the contents of an array that is passed to a method, as well as the array itself, are either for input or for output.\nms.assetid: 8DE695AC-CEF2-438C-8F94-FB783EE18EB9\n---\n\n# Passing arrays to a Windows Runtime Component\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nIn the Windows Universal Platform (UWP), parameters are either for input or for output, never both. This means that the contents of an array that is passed to a method, as well as the array itself, are either for input or for output. If the contents of the array are for input, the method reads from the array but doesn't write to it. If the contents of the array are for output, the method writes to the array but doesn't read from it. This presents a problem for array parameters, because arrays in the .NET Framework are reference types, and the contents of an array are mutable even when the array reference is passed by value (**ByVal** in Visual Basic). The [Windows Runtime Metadata Export Tool (Winmdexp.exe)](https://msdn.microsoft.com/library/hh925576.aspx) requires you to specify the intended usage of the array if it is not clear from context, by applying the ReadOnlyArrayAttribute attribute or the WriteOnlyArrayAttribute attribute to the parameter. Array usage is determined as follows:\n\n-   For the return value or for an out parameter (a **ByRef** parameter with the [OutAttribute](https://msdn.microsoft.com/library/system.runtime.interopservices.outattribute.aspx) attribute in Visual Basic) the array is always for output only. Do not apply the ReadOnlyArrayAttribute attribute. The WriteOnlyArrayAttribute attribute is allowed on output parameters, but it's redundant.\n\n    > **Caution**  The Visual Basic compiler does not enforce output-only rules. You should never read from an output parameter; it may contain **Nothing**. Always assign a new array.\n \n-   Parameters that have the **ref** modifier (**ByRef** in Visual Basic) are not allowed. Winmdexp.exe generates an error.\n-   For a parameter that is passed by value, you must specify whether the array contents are for input or output by applying either the [ReadOnlyArrayAttribute](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.readonlyarrayattribute.aspx) attribute or the [WriteOnlyArrayAttribute](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.writeonlyarrayattribute.aspx) attribute. Specifying both attributes is an error.\n\nIf a method must accept an array for input, modify the array contents, and return the array to the caller, use a read-only parameter for the input and a write-only parameter (or the return value) for the output. The following code shows one way to implement this pattern:\n\n> [!div class=\"tabbedCodeSnippets\"]\n> ```csharp\n> public int[] ChangeArray([ReadOnlyArray()] int[] input)\n> {\n>     int[] output = input.Clone();\n>     // Manipulate the copy.\n>     //   ...\n>     return output;\n> }\n> ```\n> ```vb\n> Public Function ChangeArray(<ReadOnlyArray> input() As Integer) As Integer()\n>     Dim output() As Integer = input.Clone()\n>     ' Manipulate the copy.\n>     '   ...\n>     Return output\n> End Function\n> ```\n\nWe recommend that you make a copy of the input array immediately, and manipulate the copy. This helps ensure that the method behaves the same whether or not your component is called by .NET Framework code.\n\n## Using components from managed and unmanaged code\n\n\nParameters that have the ReadOnlyArrayAttribute attribute or the WriteOnlyArrayAttribute attribute behave differently depending on whether the caller is written in native code or managed code. If the caller is native code (JavaScript or Visual C++ component extensions), the array contents are treated as follows:\n\n-   ReadOnlyArrayAttribute: The array is copied when the call crosses the application binary interface (ABI) boundary. Elements are converted if necessary. Therefore, any accidental changes the method makes to an input-only array are not visible to the caller.\n-   WriteOnlyArrayAttribute: The called method can't make any assumptions about the contents of the original array. For example, the array the method receives might not be initialized, or might contain default values. The method is expected to set the values of all the elements in the array.\n\nIf the caller is managed code, the original array is available to the called method, as it would be in any method call in the .NET Framework. Array contents are mutable in .NET Framework code, so any changes the method makes to the array are visible to the caller. This is important to remember because it affects unit tests written for a Windows Runtime Component. If the tests are written in managed code, the contents of an array will appear to be mutable during testing.\n\n## Related topics\n\n* [ReadOnlyArrayAttribute](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.readonlyarrayattribute.aspx)\n* [WriteOnlyArrayAttribute](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.writeonlyarrayattribute.aspx)\n* [Creating Windows Runtime Components in C# and Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md)\n"}