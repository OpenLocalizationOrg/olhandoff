{"nodes":[{"content":"The core text APIs in the Windows.UI.Text.Core namespace enable a Universal Windows Platform (UWP) app to receive text input from any text service supported on Windows devices.","pos":[47,223]},{"content":"Custom text input overview","pos":[231,257]},{"content":"Custom text input","pos":[360,377]},{"content":"The core text APIs in the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.UI.Text.Core<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958238)</ept> namespace enable a Universal Windows Platform (UWP) app to receive text input from any text service supported on Windows devices.","pos":[379,619]},{"content":"The APIs are similar to the <bpt id=\"p1\">[</bpt>Text Services Framework<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/ms629032)</ept> APIs in that the app is not required to have detailed knowledge of the text services.","pos":[620,820]},{"content":"This enables the app to receive text in any language and from any input type, like keyboard, speech, or pen.","pos":[821,929]},{"content":"Important APIs","pos":[934,948]},{"content":"Windows.UI.Text.Core","pos":[959,979]},{"content":"CoreTextEditContext","pos":[1048,1067]},{"pos":[1260,1283],"content":"Why use core text APIs?"},{"content":"For many apps, the XAML or HTML text box controls are sufficient for text input and editing.","pos":[1286,1378]},{"content":"However, if your app handles complex text scenarios, like a word processing app, you might need the flexibility of a custom text edit control.","pos":[1379,1521]},{"content":"You could use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreWindow<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br208225)</ept> keyboard APIs to create your text edit control, but these don't provide a way to receive composition-based text input, which is required to support East Asian languages.","pos":[1522,1784]},{"content":"Instead, use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.UI.Text.Core<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958238)</ept> APIs when you need to create a custom text edit control.","pos":[1786,1944]},{"content":"These APIs are designed to give you a lot of flexibility in processing text input, in any language, and let you provide the text experience best suited to your app.","pos":[1945,2109]},{"content":"Text input and edit controls built with the core text APIs can receive text input from all existing text input methods on Windows devices, from <bpt id=\"p1\">[</bpt>Text Services Framework<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/ms629032)</ept> based Input Method Editors (IMEs) and handwriting on PCs to the WordFlow keyboard (which provides auto-correction, prediction, and dictation) on mobile devices.","pos":[2110,2501]},{"pos":[2599,2611],"content":"Architecture"},{"content":"The following is a simple representation of the text input system.","pos":[2614,2680]},{"content":"\"Application\" represents a UWP app hosting a custom edit control built using the core text APIs.","pos":[2686,2782]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Windows.UI.Text.Core<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958238)</ept> APIs facilitate the communication with text services through Windows.","pos":[2787,2945]},{"content":"Communication between the text edit control and the text services is handled primarily through a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextEditContext<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958158)</ept> object that provides the methods and events to facilitate the communication.","pos":[2946,3203]},{"content":"core text architecture diagram","pos":[3207,3237]},{"pos":[3409,3434],"content":"Text ranges and selection"},{"content":"Edit controls provide space for text entry and users expect to edit text anywhere in this space.","pos":[3437,3533]},{"content":"Here, we explain the text positioning system used by the core text APIs and how ranges and selections are represented in this system.","pos":[3534,3667]},{"pos":[3808,3834],"content":"Application caret position"},{"content":"Text ranges used with the core text APIs are expressed in terms of caret positions.","pos":[3836,3919]},{"content":"An \"Application Caret Position (ACP)\" is a zero-based number that indicates the count of characters from the start of the text stream immediately before the caret, as shown here.","pos":[3920,4098]},{"content":"example text stream diagram","pos":[4102,4129]},{"pos":[4297,4322],"content":"Text ranges and selection"},{"pos":[4324,4488],"content":"Text ranges and selections are represented by the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextRange<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958201)</ept> structure which contains two fields:"},{"content":"Field","pos":[4492,4497]},{"content":"Data type","pos":[4517,4526]},{"content":"Description","pos":[4593,4604]},{"content":"StartCaretPosition","pos":[4866,4884]},{"pos":[4889,4912],"content":"<bpt id=\"p1\">**</bpt>Number<ept id=\"p1\">**</ept> <ph id=\"ph1\">\\[</ph>JavaScript"},{"pos":[4917,4940],"content":"<bpt id=\"p1\">**</bpt>System.Int32<ept id=\"p1\">**</ept> <ph id=\"ph1\">\\[</ph>.NET"},{"pos":[4945,4960],"content":"<bpt id=\"p1\">**</bpt>int32<ept id=\"p1\">**</ept> <ph id=\"ph1\">\\[</ph>C++"},{"content":"The start position of a range is the ACP immediately before the first character.","pos":[4965,5045]},{"content":"EndCaretPosition","pos":[5052,5068]},{"pos":[5075,5098],"content":"<bpt id=\"p1\">**</bpt>Number<ept id=\"p1\">**</ept> <ph id=\"ph1\">\\[</ph>JavaScript"},{"pos":[5103,5126],"content":"<bpt id=\"p1\">**</bpt>System.Int32<ept id=\"p1\">**</ept> <ph id=\"ph1\">\\[</ph>.NET"},{"pos":[5131,5146],"content":"<bpt id=\"p1\">**</bpt>int32<ept id=\"p1\">**</ept> <ph id=\"ph1\">\\[</ph>C++"},{"content":"The end position of a range is the ACP immediately after the last character.","pos":[5151,5227]},{"content":"For example, in the text range shown previously, the range <ph id=\"ph1\">\\[</ph>0, 5<ph id=\"ph2\">\\]</ph> specifies the word \"Hello\".","pos":[5238,5333]},{"content":"<bpt id=\"p1\">**</bpt>StartCaretPosition<ept id=\"p1\">**</ept> must always be less than or equal to the <bpt id=\"p2\">**</bpt>EndCaretPosition<ept id=\"p2\">**</ept>.","pos":[5334,5419]},{"content":"The range <ph id=\"ph1\">\\[</ph>5, 0<ph id=\"ph2\">\\]</ph> is invalid.","pos":[5420,5450]},{"pos":[5558,5573],"content":"Insertion point"},{"pos":[5575,5743],"content":"The current caret position, frequently referred to as the insertion point, is represented by setting the <bpt id=\"p1\">**</bpt>StartCaretPosition<ept id=\"p1\">**</ept> to be equal to the <bpt id=\"p2\">**</bpt>EndCaretPosition<ept id=\"p2\">**</ept>."},{"pos":[5875,5898],"content":"Noncontiguous selection"},{"content":"Some edit controls support noncontiguous selections.","pos":[5900,5952]},{"content":"For example, Microsoft Office apps support multiple arbitrary selections, and many source code editors support column selection.","pos":[5953,6081]},{"content":"However, the core text APIs do not support noncontiguous selections.","pos":[6082,6150]},{"content":"Edit controls must report only a single contiguous selection, most often the active sub-range of the noncontiguous selections.","pos":[6151,6277]},{"content":"For example, consider this text stream:","pos":[6279,6318]},{"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-2.png)</ph> There are two selections: <ph id=\"ph2\">\\[</ph>0, 1<ph id=\"ph3\">\\]</ph> and <ph id=\"ph4\">\\[</ph>6, 11<ph id=\"ph5\">\\]</ph>.","pos":[6322,6430]},{"content":"The edit control must report only one of them; either <ph id=\"ph1\">\\[</ph>0, 1<ph id=\"ph2\">\\]</ph> or <ph id=\"ph3\">\\[</ph>6, 11<ph id=\"ph4\">\\]</ph>.","pos":[6431,6507]},{"pos":[6620,6637],"content":"Working with text"},{"pos":[6640,7068],"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextEditContext<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958158)</ept> class enables text flow between Windows and edit controls through the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>TextUpdating<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> event, the <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>TextRequested<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/dn958175)</ept> event, and the <bpt id=\"p7\">[</bpt><bpt id=\"p8\">**</bpt>NotifyTextChanged<ept id=\"p8\">**</ept><ept id=\"p7\">](https://msdn.microsoft.com/library/windows/apps/dn958172)</ept> method."},{"pos":[7070,7289],"content":"Your edit control receives text through <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextUpdating<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> events that are generated when users interact with text input methods like keyboards, speech, or IMEs."},{"pos":[7291,7501],"content":"When you change text in your edit control, for example, by pasting text into the control, you need to notify Windows by calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>NotifyTextChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958172)</ept>."},{"content":"If the text service requires the new text, then a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextRequested<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958175)</ept> event is raised.","pos":[7503,7647]},{"content":"You must provide the new text in the <bpt id=\"p1\">**</bpt>TextRequested<ept id=\"p1\">**</ept> event handler.","pos":[7648,7717]},{"pos":[7846,7868],"content":"Accepting text updates"},{"content":"Your edit control should typically accept text update requests because they represent the text the user wants to enter.","pos":[7870,7989]},{"content":"In the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextUpdating<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> event handler, these actions are expected of your edit control:","pos":[7990,8137]},{"pos":[8143,8400],"content":"Insert the text specified in <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextTextUpdatingEventArgs.Text<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958236)</ept> in the position specified in <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreTextTextUpdatingEventArgs.Range<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958234)</ept>."},{"pos":[8405,8557],"content":"Place selection at the position specified in <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextTextUpdatingEventArgs.NewSelection<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958233)</ept>."},{"pos":[8562,8822],"content":"Notify the system that the update succeeded by setting <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextTextUpdatingEventArgs.Result<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958235)</ept> to <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreTextTextUpdatingResult.Succeeded<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958237)</ept>."},{"content":"For example, this is the state of an edit control before the user types \"d\".","pos":[8824,8900]},{"content":"The insertion point is at <ph id=\"ph1\">\\[</ph>10, 10<ph id=\"ph2\">\\]</ph>.","pos":[8901,8938]},{"pos":[8942,9239],"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-3.png)</ph> When the user types \"d\", a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextUpdating<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> event is raised with the following <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreTextTextUpdatingEventArgs<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958229)</ept> data:"},{"pos":[9245,9325],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Range<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958234)</ept><ph id=\"ph1\"> = \\[</ph>10, 10"},{"pos":[9332,9406],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Text<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958236)</ept> = \"d\""},{"pos":[9411,9498],"content":"<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>NewSelection<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958233)</ept><ph id=\"ph1\"> = \\[</ph>11, 11"},{"content":"In your edit control, apply the specified changes and set <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Result<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958235)</ept> to <bpt id=\"p3\">**</bpt>Succeeded<ept id=\"p3\">**</ept>.","pos":[9502,9648]},{"content":"Here's the state of the control after the changes are applied.","pos":[9649,9711]},{"content":"example text stream diagram","pos":[9715,9742]},{"pos":[9901,9923],"content":"Rejecting text updates"},{"content":"Sometimes, you cannot apply text updates because the requested range is in an area of the edit control that should not be changed.","pos":[9925,10055]},{"content":"In this case, you should not apply any changes.","pos":[10056,10103]},{"content":"Instead, notify the system that the update failed by setting <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CoreTextTextUpdatingEventArgs.Result<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958235)</ept> to <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreTextTextUpdatingResult.Failed<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958237)</ept>.","pos":[10104,10367]},{"content":"For example, consider an edit control that accepts only an e-mail address.","pos":[10369,10443]},{"content":"Spaces should be rejected because e-mail addresses cannot contain spaces, so when <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextUpdating<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> events are raised for the space key, you should simply set <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Result<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958235)</ept> to <bpt id=\"p5\">**</bpt>Failed<ept id=\"p5\">**</ept> in your edit control.","pos":[10444,10768]},{"pos":[10897,10919],"content":"Notifying text changes"},{"content":"Sometimes, your edit control makes changes to text such as when text is pasted or auto-corrected.","pos":[10921,11018]},{"content":"In these cases, you must notify the text services of these changes by calling the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>NotifyTextChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958172)</ept> method.","pos":[11019,11190]},{"content":"For example, this is the state of an edit control before the user pastes \"World\".","pos":[11192,11273]},{"content":"The insertion point is at <ph id=\"ph1\">\\[</ph>6, 6<ph id=\"ph2\">\\]</ph>.","pos":[11274,11309]},{"pos":[11313,11460],"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-5.png)</ph> The user performs the paste action and the edit control ends up with the following text:"},{"pos":[11464,11661],"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-4.png)</ph> When this happens, you should call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>NotifyTextChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958172)</ept> with these arguments:"},{"pos":[11667,11691],"content":"<bpt id=\"p1\">*</bpt>modifiedRange<ept id=\"p1\">*</ept><ph id=\"ph1\"> = \\[</ph>6, 6"},{"pos":[11698,11713],"content":"<bpt id=\"p1\">*</bpt>newLength<ept id=\"p1\">*</ept> = 5"},{"pos":[11718,11743],"content":"<bpt id=\"p1\">*</bpt>newSelection<ept id=\"p1\">*</ept><ph id=\"ph1\"> = \\[</ph>11, 11"},{"pos":[11747,11933],"content":"One or more <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextRequested<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958175)</ept> events will follow, which you handle to update the text that the text services are working with."},{"pos":[12065,12088],"content":"Overriding text updates"},{"content":"In your edit control, you might want to override a text update to provide auto-correction features.","pos":[12090,12189]},{"content":"For example, consider an edit control that provides a correction feature that formalizes contractions.","pos":[12191,12293]},{"content":"This is the state of the edit control before the user types the space key to trigger the correction.","pos":[12294,12394]},{"content":"The insertion point is at <ph id=\"ph1\">\\[</ph>3, 3<ph id=\"ph2\">\\]</ph>.","pos":[12395,12430]},{"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-6.png)</ph> The user presses the space key and a corresponding <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextUpdating<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> event is raised.","pos":[12434,12637]},{"content":"The edit control accepts the text update.","pos":[12638,12679]},{"content":"This is the state of the edit control for a brief moment before the correction is completed.","pos":[12680,12772]},{"content":"The insertion point is at <ph id=\"ph1\">\\[</ph>4, 4<ph id=\"ph2\">\\]</ph>.","pos":[12773,12808]},{"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-7.png)</ph> Outside of the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextUpdating<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958176)</ept> event handler, the edit control makes the following correction.","pos":[12812,13026]},{"content":"This is the state of the edit control after the correction is complete.","pos":[13027,13098]},{"content":"The insertion point is at <ph id=\"ph1\">\\[</ph>5, 5<ph id=\"ph2\">\\]</ph>.","pos":[13099,13134]},{"pos":[13138,13335],"content":"example text stream diagram<ph id=\"ph1\">](images/coretext/stream-8.png)</ph> When this happens, you should call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>NotifyTextChanged<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958172)</ept> with these arguments:"},{"pos":[13341,13365],"content":"<bpt id=\"p1\">*</bpt>modifiedRange<ept id=\"p1\">*</ept><ph id=\"ph1\"> = \\[</ph>1, 2"},{"pos":[13372,13387],"content":"<bpt id=\"p1\">*</bpt>newLength<ept id=\"p1\">*</ept> = 2"},{"pos":[13392,13415],"content":"<bpt id=\"p1\">*</bpt>newSelection<ept id=\"p1\">*</ept><ph id=\"ph1\"> = \\[</ph>5, 5"},{"pos":[13419,13605],"content":"One or more <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextRequested<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958175)</ept> events will follow, which you handle to update the text that the text services are working with."},{"pos":[13740,13764],"content":"Providing requested text"},{"content":"It's important for text services to have the correct text to provide features like auto-correction or prediction, especially for text that already existed in the edit control, from loading a document, for example, or text that is inserted by the edit control as explained in previous sections.","pos":[13766,14059]},{"content":"Therefore, whenever a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>TextRequested<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958175)</ept> event is raised, you must provide the text currently in your edit control for the specified range.","pos":[14060,14258]},{"content":"There will be times the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Range<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn958227)</ept> in <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CoreTextTextRequest<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn958221)</ept> specifies a range that your edit control cannot accommodate as-is.","pos":[14260,14507]},{"content":"For example, the <bpt id=\"p1\">**</bpt>Range<ept id=\"p1\">**</ept> is larger than the size of the edit control at the time of the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>TextRequested<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn958175)</ept> event, or the end of the <bpt id=\"p4\">**</bpt>Range<ept id=\"p4\">**</ept> is out of bounds.","pos":[14508,14728]},{"content":"In these cases, you should return whatever range makes sense, which is typically a subset of the requested range.","pos":[14729,14842]},{"pos":[14880,14896],"content":"Related articles"},{"content":"Archive samples","pos":[14901,14916]},{"content":"XAML text editing sample","pos":[14922,14946]}],"content":"---\nauthor: Karl-Bridge-Microsoft\nDescription: The core text APIs in the Windows.UI.Text.Core namespace enable a Universal Windows Platform (UWP) app to receive text input from any text service supported on Windows devices.\ntitle: Custom text input overview\nms.assetid: 58F5F7AC-6A4B-45FC-8C2A-942730FD7B74\nlabel: Custom text input\ntemplate: detail.hbs\n---\n\n# Custom text input\n\nThe core text APIs in the [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) namespace enable a Universal Windows Platform (UWP) app to receive text input from any text service supported on Windows devices. The APIs are similar to the [Text Services Framework](https://msdn.microsoft.com/library/windows/desktop/ms629032) APIs in that the app is not required to have detailed knowledge of the text services. This enables the app to receive text in any language and from any input type, like keyboard, speech, or pen.\n\n\n**Important APIs**\n\n-   [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238)\n-   [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158)\n\n\n## <span id=\"Why_use_core_text_APIs_\"></span><span id=\"why_use_core_text_apis_\"></span><span id=\"WHY_USE_CORE_TEXT_APIS_\"></span>Why use core text APIs?\n\n\nFor many apps, the XAML or HTML text box controls are sufficient for text input and editing. However, if your app handles complex text scenarios, like a word processing app, you might need the flexibility of a custom text edit control. You could use the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) keyboard APIs to create your text edit control, but these don't provide a way to receive composition-based text input, which is required to support East Asian languages.\n\nInstead, use the [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) APIs when you need to create a custom text edit control. These APIs are designed to give you a lot of flexibility in processing text input, in any language, and let you provide the text experience best suited to your app. Text input and edit controls built with the core text APIs can receive text input from all existing text input methods on Windows devices, from [Text Services Framework](https://msdn.microsoft.com/library/windows/desktop/ms629032) based Input Method Editors (IMEs) and handwriting on PCs to the WordFlow keyboard (which provides auto-correction, prediction, and dictation) on mobile devices.\n\n## <span id=\"Architecture\"></span><span id=\"architecture\"></span><span id=\"ARCHITECTURE\"></span>Architecture\n\n\nThe following is a simple representation of the text input system.\n\n-   \"Application\" represents a UWP app hosting a custom edit control built using the core text APIs.\n-   The [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) APIs facilitate the communication with text services through Windows. Communication between the text edit control and the text services is handled primarily through a [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158) object that provides the methods and events to facilitate the communication.\n\n![core text architecture diagram](images/coretext/architecture.png)\n\n## <span id=\"Text_ranges_and_selection\"></span><span id=\"text_ranges_and_selection\"></span><span id=\"TEXT_RANGES_AND_SELECTION\"></span>Text ranges and selection\n\n\nEdit controls provide space for text entry and users expect to edit text anywhere in this space. Here, we explain the text positioning system used by the core text APIs and how ranges and selections are represented in this system.\n\n### <span id=\"Application_caret_position\"></span><span id=\"application_caret_position\"></span><span id=\"APPLICATION_CARET_POSITION\"></span>Application caret position\n\nText ranges used with the core text APIs are expressed in terms of caret positions. An \"Application Caret Position (ACP)\" is a zero-based number that indicates the count of characters from the start of the text stream immediately before the caret, as shown here.\n\n![example text stream diagram](images/coretext/stream-1.png)\n### <span id=\"Text_ranges_and_selection\"></span><span id=\"text_ranges_and_selection\"></span><span id=\"TEXT_RANGES_AND_SELECTION\"></span>Text ranges and selection\n\nText ranges and selections are represented by the [**CoreTextRange**](https://msdn.microsoft.com/library/windows/apps/dn958201) structure which contains two fields:\n\n| Field                  | Data type                                                                 | Description                                                                      |\n|------------------------|---------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n| **StartCaretPosition** | **Number** \\[JavaScript\\] | **System.Int32** \\[.NET\\] | **int32** \\[C++\\] | The start position of a range is the ACP immediately before the first character. |\n| **EndCaretPosition**   | **Number** \\[JavaScript\\] | **System.Int32** \\[.NET\\] | **int32** \\[C++\\] | The end position of a range is the ACP immediately after the last character.     |\n\n \n\nFor example, in the text range shown previously, the range \\[0, 5\\] specifies the word \"Hello\". **StartCaretPosition** must always be less than or equal to the **EndCaretPosition**. The range \\[5, 0\\] is invalid.\n\n### <span id=\"Insertion_point\"></span><span id=\"insertion_point\"></span><span id=\"INSERTION_POINT\"></span>Insertion point\n\nThe current caret position, frequently referred to as the insertion point, is represented by setting the **StartCaretPosition** to be equal to the **EndCaretPosition**.\n\n### <span id=\"Noncontiguous_selection\"></span><span id=\"noncontiguous_selection\"></span><span id=\"NONCONTIGUOUS_SELECTION\"></span>Noncontiguous selection\n\nSome edit controls support noncontiguous selections. For example, Microsoft Office apps support multiple arbitrary selections, and many source code editors support column selection. However, the core text APIs do not support noncontiguous selections. Edit controls must report only a single contiguous selection, most often the active sub-range of the noncontiguous selections.\n\nFor example, consider this text stream:\n\n![example text stream diagram](images/coretext/stream-2.png)\nThere are two selections: \\[0, 1\\] and \\[6, 11\\]. The edit control must report only one of them; either \\[0, 1\\] or \\[6, 11\\].\n\n## <span id=\"Working_with_text\"></span><span id=\"working_with_text\"></span><span id=\"WORKING_WITH_TEXT\"></span>Working with text\n\n\nThe [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158) class enables text flow between Windows and edit controls through the [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event, the [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event, and the [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) method.\n\nYour edit control receives text through [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) events that are generated when users interact with text input methods like keyboards, speech, or IMEs.\n\nWhen you change text in your edit control, for example, by pasting text into the control, you need to notify Windows by calling [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172).\n\nIf the text service requires the new text, then a [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event is raised. You must provide the new text in the **TextRequested** event handler.\n\n### <span id=\"Accepting_text_updates\"></span><span id=\"accepting_text_updates\"></span><span id=\"ACCEPTING_TEXT_UPDATES\"></span>Accepting text updates\n\nYour edit control should typically accept text update requests because they represent the text the user wants to enter. In the [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event handler, these actions are expected of your edit control:\n\n1.  Insert the text specified in [**CoreTextTextUpdatingEventArgs.Text**](https://msdn.microsoft.com/library/windows/apps/dn958236) in the position specified in [**CoreTextTextUpdatingEventArgs.Range**](https://msdn.microsoft.com/library/windows/apps/dn958234).\n2.  Place selection at the position specified in [**CoreTextTextUpdatingEventArgs.NewSelection**](https://msdn.microsoft.com/library/windows/apps/dn958233).\n3.  Notify the system that the update succeeded by setting [**CoreTextTextUpdatingEventArgs.Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to [**CoreTextTextUpdatingResult.Succeeded**](https://msdn.microsoft.com/library/windows/apps/dn958237).\n\nFor example, this is the state of an edit control before the user types \"d\". The insertion point is at \\[10, 10\\].\n\n![example text stream diagram](images/coretext/stream-3.png)\nWhen the user types \"d\", a [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event is raised with the following [**CoreTextTextUpdatingEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn958229) data:\n\n-   [**Range**](https://msdn.microsoft.com/library/windows/apps/dn958234) = \\[10, 10\\]\n-   [**Text**](https://msdn.microsoft.com/library/windows/apps/dn958236) = \"d\"\n-   [**NewSelection**](https://msdn.microsoft.com/library/windows/apps/dn958233) = \\[11, 11\\]\n\nIn your edit control, apply the specified changes and set [**Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to **Succeeded**. Here's the state of the control after the changes are applied.\n\n![example text stream diagram](images/coretext/stream-4.png)\n### <span id=\"Rejecting_text_updates\"></span><span id=\"rejecting_text_updates\"></span><span id=\"REJECTING_TEXT_UPDATES\"></span>Rejecting text updates\n\nSometimes, you cannot apply text updates because the requested range is in an area of the edit control that should not be changed. In this case, you should not apply any changes. Instead, notify the system that the update failed by setting [**CoreTextTextUpdatingEventArgs.Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to [**CoreTextTextUpdatingResult.Failed**](https://msdn.microsoft.com/library/windows/apps/dn958237).\n\nFor example, consider an edit control that accepts only an e-mail address. Spaces should be rejected because e-mail addresses cannot contain spaces, so when [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) events are raised for the space key, you should simply set [**Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to **Failed** in your edit control.\n\n### <span id=\"Notifying_text_changes\"></span><span id=\"notifying_text_changes\"></span><span id=\"NOTIFYING_TEXT_CHANGES\"></span>Notifying text changes\n\nSometimes, your edit control makes changes to text such as when text is pasted or auto-corrected. In these cases, you must notify the text services of these changes by calling the [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) method.\n\nFor example, this is the state of an edit control before the user pastes \"World\". The insertion point is at \\[6, 6\\].\n\n![example text stream diagram](images/coretext/stream-5.png)\nThe user performs the paste action and the edit control ends up with the following text:\n\n![example text stream diagram](images/coretext/stream-4.png)\nWhen this happens, you should call [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) with these arguments:\n\n-   *modifiedRange* = \\[6, 6\\]\n-   *newLength* = 5\n-   *newSelection* = \\[11, 11\\]\n\nOne or more [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) events will follow, which you handle to update the text that the text services are working with.\n\n### <span id=\"Overriding_text_updates\"></span><span id=\"overriding_text_updates\"></span><span id=\"OVERRIDING_TEXT_UPDATES\"></span>Overriding text updates\n\nIn your edit control, you might want to override a text update to provide auto-correction features.\n\nFor example, consider an edit control that provides a correction feature that formalizes contractions. This is the state of the edit control before the user types the space key to trigger the correction. The insertion point is at \\[3, 3\\].\n\n![example text stream diagram](images/coretext/stream-6.png)\nThe user presses the space key and a corresponding [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event is raised. The edit control accepts the text update. This is the state of the edit control for a brief moment before the correction is completed. The insertion point is at \\[4, 4\\].\n\n![example text stream diagram](images/coretext/stream-7.png)\nOutside of the [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event handler, the edit control makes the following correction. This is the state of the edit control after the correction is complete. The insertion point is at \\[5, 5\\].\n\n![example text stream diagram](images/coretext/stream-8.png)\nWhen this happens, you should call [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) with these arguments:\n\n-   *modifiedRange* = \\[1, 2\\]\n-   *newLength* = 2\n-   *newSelection* = \\[5, 5\\]\n\nOne or more [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) events will follow, which you handle to update the text that the text services are working with.\n\n### <span id=\"Providing_requested_text\"></span><span id=\"providing_requested_text\"></span><span id=\"PROVIDING_REQUESTED_TEXT\"></span>Providing requested text\n\nIt's important for text services to have the correct text to provide features like auto-correction or prediction, especially for text that already existed in the edit control, from loading a document, for example, or text that is inserted by the edit control as explained in previous sections. Therefore, whenever a [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event is raised, you must provide the text currently in your edit control for the specified range.\n\nThere will be times the [**Range**](https://msdn.microsoft.com/library/windows/apps/dn958227) in [**CoreTextTextRequest**](https://msdn.microsoft.com/library/windows/apps/dn958221) specifies a range that your edit control cannot accommodate as-is. For example, the **Range** is larger than the size of the edit control at the time of the [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event, or the end of the **Range** is out of bounds. In these cases, you should return whatever range makes sense, which is typically a subset of the requested range.\n\n## <span id=\"related_topics\"></span>Related articles\n\n\n**Archive samples**\n* [XAML text editing sample](http://go.microsoft.com/fwlink/p/?LinkID=251417)\n \n\n \n\n\n\n\n"}