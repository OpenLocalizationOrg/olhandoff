{"nodes":[{"content":"Credential locker","pos":[11,28]},{"content":"This article describes how Universal Windows Platform (UWP) apps can use the Credential Locker to securely store and retrieve user credentials, and roam them between devices with the user's Microsoft account.","pos":[42,250]},{"content":"Credential locker","pos":[323,340]},{"content":"Updated for UWP apps on Windows 10.","pos":[346,381]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[382,474]},{"content":"This article describes how Universal Windows Platform (UWP) apps can use the Credential Locker to securely store and retrieve user credentials, and roam them between devices with the user's Microsoft account.","pos":[480,688]},{"content":"For example, you have an app that connects to a service to access protected resources such as media files, or social networking.","pos":[690,818]},{"content":"Your service requires login information for each user.","pos":[819,873]},{"content":"You’ve built UI into your app that gets the username and password for the user, which is then used to log the user into the service.","pos":[874,1006]},{"content":"Using the Credential Locker API, you can store the username and password for your user and easily retrieve them and log the user in automatically the next time they open your app, regardless of what device they're on.","pos":[1007,1224]},{"content":"Credential locker works a little differently for domain accounts.","pos":[1226,1291]},{"content":"If there are credentials stored with your Microsoft account, and you associate that account with a domain account (such as the account that you use at work), your credentials will roam to that domain account.","pos":[1292,1500]},{"content":"However, any new credentials added when signed on with the domain account won’t roam.","pos":[1501,1586]},{"content":"This ensures that private credentials for the domain aren’t exposed outside of the domain.","pos":[1587,1677]},{"content":"Storing user credentials","pos":[1682,1706]},{"pos":[1713,1964],"content":"Obtain a reference to the Credential Locker using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227081)</ept> object from the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Windows.Security.Credentials<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br227089)</ept> namespace."},{"pos":[1969,2287],"content":"Create a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordCredential<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227061)</ept> object that contains an identifier for your app, the username and the password, and pass that to the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>PasswordVault.Add<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh701231)</ept> method to add the credential to the locker."},{"content":"Retrieving user credentials","pos":[2464,2491]},{"pos":[2494,2697],"content":"You have several options for retrieving user credentials from the Credential Locker after you have a reference to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227081)</ept> object."},{"pos":[2703,2895],"content":"You can retrieve all the credentials the user has supplied for your app in the locker with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault.RetrieveAll<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227088)</ept> method."},{"pos":[2901,3121],"content":"If you know the username for the stored credentials, you can retrieve all the credentials for that username with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault.FindAllByUserName<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227084)</ept> method."},{"pos":[3127,3357],"content":"If you know the resource name for the stored credentials, you can retrieve all the credentials for that resource name with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault.FindAllByResource<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227083)</ept> method."},{"pos":[3363,3583],"content":"Finally, if you know both the username and the resource name for a credential, you can retrieve just that credential with the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault.Retrieve<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227087)</ept> method."},{"content":"Let’s look at an example where we have stored the resource name globally in an app and we log the user on automatically if we find a credential for them.","pos":[3585,3738]},{"content":"If we find multiple credentials for the same user, we ask the user to select a default credential to use when logging on.","pos":[3739,3860]},{"content":"Deleting user credentials","pos":[5364,5389]},{"content":"Deleting user credentials in the Credential Locker is also a quick, two-step process.","pos":[5392,5477]},{"pos":[5483,5734],"content":"Obtain a reference to the Credential Locker using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227081)</ept> object from the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>Windows.Security.Credentials<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br227089)</ept> namespace."},{"pos":[5740,5878],"content":"Pass the credential you want to delete to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>PasswordVault.Remove<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701242)</ept> method."},{"content":"Best practices","pos":[6058,6072]},{"content":"Only use the credential locker for passwords and not for larger data blobs.","pos":[6075,6150]},{"content":"Save passwords in the credential locker only if the following criteria are met:","pos":[6152,6231]},{"content":"The user has successfully signed in.","pos":[6237,6273]},{"content":"The user has opted to save passwords.","pos":[6278,6315]},{"content":"Never store credentials in plain-text using app data or roaming settings.","pos":[6317,6390]}],"content":"---\ntitle: Credential locker\ndescription: This article describes how Universal Windows Platform (UWP) apps can use the Credential Locker to securely store and retrieve user credentials, and roam them between devices with the user's Microsoft account.\nms.assetid: 7BCC443D-9E8A-417C-B275-3105F5DED863\nauthor: awkoren\n---\n\n# Credential locker\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nThis article describes how Universal Windows Platform (UWP) apps can use the Credential Locker to securely store and retrieve user credentials, and roam them between devices with the user's Microsoft account.\n\nFor example, you have an app that connects to a service to access protected resources such as media files, or social networking. Your service requires login information for each user. You’ve built UI into your app that gets the username and password for the user, which is then used to log the user into the service. Using the Credential Locker API, you can store the username and password for your user and easily retrieve them and log the user in automatically the next time they open your app, regardless of what device they're on.\n\nCredential locker works a little differently for domain accounts. If there are credentials stored with your Microsoft account, and you associate that account with a domain account (such as the account that you use at work), your credentials will roam to that domain account. However, any new credentials added when signed on with the domain account won’t roam. This ensures that private credentials for the domain aren’t exposed outside of the domain.\n\n## Storing user credentials\n\n\n1.  Obtain a reference to the Credential Locker using the [**PasswordVault**](https://msdn.microsoft.com/library/windows/apps/br227081) object from the [**Windows.Security.Credentials**](https://msdn.microsoft.com/library/windows/apps/br227089) namespace.\n2.  Create a [**PasswordCredential**](https://msdn.microsoft.com/library/windows/apps/br227061) object that contains an identifier for your app, the username and the password, and pass that to the [**PasswordVault.Add**](https://msdn.microsoft.com/library/windows/apps/hh701231) method to add the credential to the locker.\n\n```cs\nvar vault = new Windows.Security.Credentials.PasswordVault();\nvault.Add(new Windows.Security.Credentials.PasswordCredential(\n    \"My App\", username, password));\n```\n\n## Retrieving user credentials\n\n\nYou have several options for retrieving user credentials from the Credential Locker after you have a reference to the [**PasswordVault**](https://msdn.microsoft.com/library/windows/apps/br227081) object.\n\n-   You can retrieve all the credentials the user has supplied for your app in the locker with the [**PasswordVault.RetrieveAll**](https://msdn.microsoft.com/library/windows/apps/br227088) method.\n\n-   If you know the username for the stored credentials, you can retrieve all the credentials for that username with the [**PasswordVault.FindAllByUserName**](https://msdn.microsoft.com/library/windows/apps/br227084) method.\n\n-   If you know the resource name for the stored credentials, you can retrieve all the credentials for that resource name with the [**PasswordVault.FindAllByResource**](https://msdn.microsoft.com/library/windows/apps/br227083) method.\n\n-   Finally, if you know both the username and the resource name for a credential, you can retrieve just that credential with the [**PasswordVault.Retrieve**](https://msdn.microsoft.com/library/windows/apps/br227087) method.\n\nLet’s look at an example where we have stored the resource name globally in an app and we log the user on automatically if we find a credential for them. If we find multiple credentials for the same user, we ask the user to select a default credential to use when logging on.\n\n```cs\nprivate string resourceName = \"My App\";\nprivate string defaultUserName;\n\nprivate void Login()\n{\n    var loginCredential = GetCredentialFromLocker();\n\n    if (loginCredential != null)\n    {\n        // There is a credential stored in the locker.\n        // Populate the Password property of the credential\n        // for automatic login.\n        loginCredential.RetrievePassword();\n    }\n    else\n    {\n        // There is no credential stored in the locker.\n        // Display UI to get user credentials.\n        loginCredential = GetLoginCredentialUI();\n    }\n\n    // Log the user in.\n    ServerLogin(loginCredential.UserName, loginCredential.Password);\n}\n\n\nprivate Windows.Security.Credentials.PasswordCredential GetCredentialFromLocker()\n{\n    Windows.Security.Credentials.PasswordCredential credential = null;\n\n    var vault = new Windows.Security.Credentials.PasswordVault();\n    var credentialList = vault.FindAllByResource(resourceName);\n    if (credentialList.Count > 0)\n    {\n        if (credentialList.Count == 1)\n        {\n            credential = credentialList[0];\n        }\n        else\n        {\n            // When there are multiple usernames,\n            // retrieve the default username. If one doesn't\n            // exist, then display UI to have the user select\n            // a default username.\n\n            defaultUserName = GetDefaultUserNameUI();\n\n            credential = vault.Retrieve(resourceName, defaultUserName);\n        }\n    }\n\n    return credential;\n}\n```\n\n## Deleting user credentials\n\n\nDeleting user credentials in the Credential Locker is also a quick, two-step process.\n\n1.  Obtain a reference to the Credential Locker using the [**PasswordVault**](https://msdn.microsoft.com/library/windows/apps/br227081) object from the [**Windows.Security.Credentials**](https://msdn.microsoft.com/library/windows/apps/br227089) namespace.\n\n2.  Pass the credential you want to delete to the [**PasswordVault.Remove**](https://msdn.microsoft.com/library/windows/apps/hh701242) method.\n\n```cs\nvar vault = new Windows.Security.Credentials.PasswordVault();\nvault.Remove(new Windows.Security.Credentials.PasswordCredential(\n    \"My App\", username, password));\n```\n\n## Best practices\n\n\nOnly use the credential locker for passwords and not for larger data blobs.\n\nSave passwords in the credential locker only if the following criteria are met:\n\n-   The user has successfully signed in.\n-   The user has opted to save passwords.\n\nNever store credentials in plain-text using app data or roaming settings."}