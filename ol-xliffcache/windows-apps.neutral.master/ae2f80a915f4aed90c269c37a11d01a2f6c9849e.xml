{"nodes":[{"content":"Automate launching Windows 10 Universal Windows Platform (UWP) apps","pos":[11,78]},{"content":"Developers can use protocol activation and launch activation to automate launching their UWP apps or games for automated testing.","pos":[92,221]},{"content":"Automate launching Windows 10 UWP apps","pos":[245,283]},{"content":"Introduction","pos":[288,300]},{"content":"Developers have several options for achieving automated launching of Universal Windows Platform (UWP) apps.","pos":[302,409]},{"content":"In this paper we will explore methods of launching an app by using protocol activation and launch activation.","pos":[410,519]},{"pos":[521,610],"content":"<bpt id=\"p1\">*</bpt>Protocol activation<ept id=\"p1\">*</ept> allows an app to register itself as a handler for a given protocol."},{"pos":[613,704],"content":"<bpt id=\"p1\">*</bpt>Launch activation<ept id=\"p1\">*</ept> is the normal launching of an app, such as launching from the app tile."},{"content":"With each activation method, you have the option of using the command line or a launcher application.","pos":[706,807]},{"content":"For all activation methods, if the app is currently running, the activation will bring the app to the foreground (which reactivates it) and provide the new activation arguments.","pos":[808,985]},{"content":"This allows flexibility to use activation commands to provide new messages to the app.","pos":[986,1072]},{"content":"It is important to note that the project needs to be compiled and deployed for the activation method to run the newly updated app.","pos":[1073,1203]},{"content":"Protocol activation","pos":[1209,1228]},{"content":"Follow these steps to set up protocol activation for apps:","pos":[1230,1288]},{"pos":[1294,1350],"content":"Open the <bpt id=\"p1\">**</bpt>Package.appxmanifest<ept id=\"p1\">**</ept> file in Visual Studio."},{"pos":[1354,1386],"content":"Select the <bpt id=\"p1\">**</bpt>Declarations<ept id=\"p1\">**</ept> tab."},{"pos":[1390,1483],"content":"Under the <bpt id=\"p1\">**</bpt>Available Declarations<ept id=\"p1\">**</ept> drop-down, select <bpt id=\"p2\">**</bpt>Protocol<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."},{"pos":[1487,1570],"content":"Under <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>, in the <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept> field, enter a unique name to launch the app."},{"content":"Protocol activation","pos":[1579,1598]},{"content":"Save the file and deploy the project.","pos":[1636,1673]},{"content":"After the project has been deployed, the protocol activation should be set.","pos":[1678,1753]},{"content":"Go to <bpt id=\"p1\">**</bpt>Control Panel\\All Control Panel Items\\Default Programs<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Associate a file type or protocol with a specific program<ept id=\"p2\">**</ept>.","pos":[1758,1896]},{"content":"Scroll to the <bpt id=\"p1\">**</bpt>Protocols<ept id=\"p1\">**</ept> section to see if the protocol is listed.","pos":[1897,1966]},{"content":"Now that protocol activation is set up, you have two options (the command line or launcher application) for activating the app by using the protocol.","pos":[1969,2118]},{"content":"Command line","pos":[2125,2137]},{"content":"The app can be protocol-activated by using the command line with the command start followed by the protocol name set previously, a colon (“:”), and any parameters.","pos":[2139,2302]},{"content":"The parameters can be any arbitrary string; however, to take advantage of the Uniform Resource Identifier (URI) capabilities, it is advisable to follow the standard URI format:","pos":[2303,2479]},{"content":"The Uri object has methods of parsing a URI string in this format.","pos":[2564,2630]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Uri class (MSDN)<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/windows/apps/windows.foundation.uri.aspx)</ept>.","pos":[2631,2759]},{"content":"Examples:","pos":[2762,2771]},{"content":"Protocol command-line activation supports Unicode characters up to a 2038-character limit on the raw URI.","pos":[2912,3017]},{"content":"Launcher application","pos":[3024,3044]},{"content":"For launching, create a separate application that supports the WinRT API.","pos":[3046,3119]},{"content":"The C++ code for launching with protocol activation in a launcher program is shown in the following sample, where <bpt id=\"p1\">**</bpt>PackageURI<ept id=\"p1\">**</ept> is the URI for the application with any arguments; for example <ph id=\"ph1\">`myapplication:`</ph> or <ph id=\"ph2\">`myapplication:protocol activation arguments`</ph>.","pos":[3120,3378]},{"content":"Protocol activation with the launcher application has the same limitations for arguments as protocol activation with the command-line.","pos":[4598,4732]},{"content":"Both support Unicode characters up to a 2038-character limit on the raw URI.","pos":[4733,4809]},{"content":"Launch activation","pos":[4815,4832]},{"content":"You can also launch the app by using launch activation.","pos":[4834,4889]},{"content":"No setup is required, but the Application User Model ID (AUMID) of the UWP app is needed.","pos":[4890,4979]},{"content":"The AUMID is the package family name followed by an exclamation point and the application ID.","pos":[4980,5073]},{"content":"The best way to obtain the package family name is to complete these steps:","pos":[5076,5150]},{"pos":[5155,5194],"content":"Open the <bpt id=\"p1\">**</bpt>Package.appxmanifest<ept id=\"p1\">**</ept> file."},{"pos":[5198,5251],"content":"On the <bpt id=\"p1\">**</bpt>Packaging<ept id=\"p1\">**</ept> tab, enter the <bpt id=\"p2\">**</bpt>Package name<ept id=\"p2\">**</ept>."},{"content":"Launch activation","pos":[5259,5276]},{"pos":[5314,5451],"content":"If the <bpt id=\"p1\">**</bpt>Package family name<ept id=\"p1\">**</ept> is not listed, open PowerShell and run <ph id=\"ph1\">`&gt;get-appxpackage MyPackageName`</ph> to find the <bpt id=\"p2\">**</bpt>PackageFamilyName<ept id=\"p2\">**</ept>."},{"pos":[5453,5578],"content":"The application ID can be found in the <bpt id=\"p1\">**</bpt>Package.appxmanifest<ept id=\"p1\">**</ept> file (opened in XML view) under the <ph id=\"ph1\">`&lt;Applications&gt;`</ph> element."},{"content":"Command-line","pos":[5584,5596]},{"content":"A tool for performing a launch activation of a UWP app is installed with the Windows 10 SDK.","pos":[5598,5690]},{"content":"It can be run from the command line, and it takes the AUMID of the app to be launched as an argument.","pos":[5691,5792]},{"content":"It would look something like this:","pos":[5920,5954]},{"content":"This option does not support command-line arguments.","pos":[6110,6162]},{"content":"Launcher application","pos":[6169,6189]},{"content":"You can create a separate application that supports using COM to use for launching.","pos":[6191,6274]},{"content":"The following example shows C++ code for launching with launch activation in a launcher program.","pos":[6275,6371]},{"content":"With this code, you can create an <bpt id=\"p1\">**</bpt>ApplicationActivationManager<ept id=\"p1\">**</ept> object and call <bpt id=\"p2\">**</bpt>ActivateApplication<ept id=\"p2\">**</ept> passing in the AUMID found previously and any arguments.","pos":[6372,6535]},{"content":"For more information about the other parameters, see <bpt id=\"p1\">[</bpt>IApplicationActivationManager::ActivateApplication method (MSDN)<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/windows/desktop/hh706903(v=vs.85).aspx)</ept>.","pos":[6536,6737]},{"content":"It is worth noting that this method does support arguments being passed in, unlike the previous method for launching (that is, using the command line).","pos":[7928,8079]},{"content":"Accepting arguments","pos":[8084,8103]},{"content":"To accept arguments passed in on activation of the UWP app, you must add some code to the app.","pos":[8105,8199]},{"content":"To determine if protocol activation or launch activation occurred, override the <bpt id=\"p1\">**</bpt>OnActivated<ept id=\"p1\">**</ept> event and check the argument type, and then get the raw string or Uri object’s pre-parsed values.","pos":[8200,8393]},{"content":"This example shows how to get the raw string.","pos":[8396,8441]},{"content":"Summary","pos":[9084,9091]},{"content":"In summary, you can use various methods to launch the UWP app.","pos":[9092,9154]},{"content":"Depending on the requirements and use cases, different methods may be better suited than others.","pos":[9155,9251]}],"content":"---\ntitle: Automate launching Windows 10 Universal Windows Platform (UWP) apps\ndescription: Developers can use protocol activation and launch activation to automate launching their UWP apps or games for automated testing.\nauthor: listurm\n---\n\n# Automate launching Windows 10 UWP apps\n\n## Introduction\n\nDevelopers have several options for achieving automated launching of Universal Windows Platform (UWP) apps. In this paper we will explore methods of launching an app by using protocol activation and launch activation.\n\n*Protocol activation* allows an app to register itself as a handler for a given protocol. \n\n*Launch activation* is the normal launching of an app, such as launching from the app tile.\n\nWith each activation method, you have the option of using the command line or a launcher application. For all activation methods, if the app is currently running, the activation will bring the app to the foreground (which reactivates it) and provide the new activation arguments. This allows flexibility to use activation commands to provide new messages to the app. It is important to note that the project needs to be compiled and deployed for the activation method to run the newly updated app. \n\n## Protocol activation\n\nFollow these steps to set up protocol activation for apps: \n\n1. Open the **Package.appxmanifest** file in Visual Studio.\n2. Select the **Declarations** tab.\n3. Under the **Available Declarations** drop-down, select **Protocol**, and then select **Add**.\n4. Under **Properties**, in the **Name** field, enter a unique name to launch the app. \n\n    ![Protocol activation](images/automate-uwp-apps-1.png)\n\n5. Save the file and deploy the project. \n6. After the project has been deployed, the protocol activation should be set. \n7. Go to **Control Panel\\All Control Panel Items\\Default Programs** and select **Associate a file type or protocol with a specific program**. Scroll to the **Protocols** section to see if the protocol is listed. \n\nNow that protocol activation is set up, you have two options (the command line or launcher application) for activating the app by using the protocol. \n\n### Command line\n\nThe app can be protocol-activated by using the command line with the command start followed by the protocol name set previously, a colon (“:”), and any parameters. The parameters can be any arbitrary string; however, to take advantage of the Uniform Resource Identifier (URI) capabilities, it is advisable to follow the standard URI format: \n\n  ```\n  scheme://username:password@host:port/path.extension?query#fragment\n  ```\n\nThe Uri object has methods of parsing a URI string in this format. For more information, see [Uri class (MSDN)](https://msdn.microsoft.com/en-us/library/windows/apps/windows.foundation.uri.aspx). \n\nExamples:\n\n  ```\n  >start bingnews:\n  >start myapplication:protocol-parameter\n  >start myapplication://single-player/level3?godmode=1&ammo=200\n  ```\n\nProtocol command-line activation supports Unicode characters up to a 2038-character limit on the raw URI. \n\n### Launcher application\n\nFor launching, create a separate application that supports the WinRT API. The C++ code for launching with protocol activation in a launcher program is shown in the following sample, where **PackageURI** is the URI for the application with any arguments; for example `myapplication:` or `myapplication:protocol activation arguments`.\n\n```\nbool ProtocolLaunchURI(Platform::String^ URI)\n{\n       IAsyncOperation<bool>^ protocolLaunchAsyncOp;\n       try\n       {\n              protocolLaunchAsyncOp = Windows::System::Launcher::LaunchUriAsync(ref new \nUri(URI));\n       }\n       catch (Platform::Exception^ e)\n       {\n              Platform::String^ dbgStr = \"ProtocolLaunchURI Exception Thrown: \" \n+ e->ToString() + \"\\n\";\n              OutputDebugString(dbgStr->Data());\n              return false;\n       }\n\n       concurrency::create_task(protocolLaunchAsyncOp).wait();\n\n       if (protocolLaunchAsyncOp->Status == AsyncStatus::Completed)\n       {\n              bool LaunchResult = protocolLaunchAsyncOp->GetResults();\n              Platform::String^ dbgStr = \"ProtocolLaunchURI \" + URI \n+ \" completed. Launch result \" + LaunchResult + \"\\n\";\n              OutputDebugString(dbgStr->Data());\n              return LaunchResult;\n       }\n       else\n       {\n              Platform::String^ dbgStr = \"ProtocolLaunchURI \" + URI + \" failed. Status:\" \n+ protocolLaunchAsyncOp->Status.ToString() + \" ErrorCode:\" \n+ protocolLaunchAsyncOp->ErrorCode.ToString() + \"\\n\";\n              OutputDebugString(dbgStr->Data());\n              return false;\n       }\n}\n```\nProtocol activation with the launcher application has the same limitations for arguments as protocol activation with the command-line. Both support Unicode characters up to a 2038-character limit on the raw URI. \n\n## Launch activation\n\nYou can also launch the app by using launch activation. No setup is required, but the Application User Model ID (AUMID) of the UWP app is needed. The AUMID is the package family name followed by an exclamation point and the application ID. \n\nThe best way to obtain the package family name is to complete these steps:\n\n1. Open the **Package.appxmanifest** file.\n2. On the **Packaging** tab, enter the **Package name**.\n\n    ![Launch activation](images/automate-uwp-apps-2.png)\n\n3. If the **Package family name** is not listed, open PowerShell and run `>get-appxpackage MyPackageName` to find the **PackageFamilyName**.\n\nThe application ID can be found in the **Package.appxmanifest** file (opened in XML view) under the `<Applications>` element.\n\n### Command-line\n\nA tool for performing a launch activation of a UWP app is installed with the Windows 10 SDK. It can be run from the command line, and it takes the AUMID of the app to be launched as an argument.\n\n```\nC:\\Program Files (x86)\\Windows Kits\\10\\App Certification Kit\\microsoft.windows.softwarelogo.appxlauncher.exe <AUMID>\n```\n\nIt would look something like this:\n\n```\n\"C:\\Program Files (x86)\\Windows Kits\\10\\App Certification Kit\\microsoft.windows.softwarelogo.appxlauncher.exe\" MyPackageName_ph1m9x8skttmg!AppId\n```\n\nThis option does not support command-line arguments. \n\n### Launcher application\n\nYou can create a separate application that supports using COM to use for launching. The following example shows C++ code for launching with launch activation in a launcher program. With this code, you can create an **ApplicationActivationManager** object and call **ActivateApplication** passing in the AUMID found previously and any arguments. For more information about the other parameters, see [IApplicationActivationManager::ActivateApplication method (MSDN)](https://msdn.microsoft.com/en-us/library/windows/desktop/hh706903(v=vs.85).aspx).\n\n```\n#include <ShObjIdl.h>\n#include <atlbase.h>\n\nHRESULT LaunchApp(LPCWSTR AUMID)\n{\n     HRESULT hr = CoInitializeEx(nullptr, COINIT_APARTMENTTHREADED);\n     if (FAILED(hr))\n     {\n            wprintf(L\"LaunchApp %s: Failed to init COM. hr = 0x%08lx \\n\", AUMID, hr);\n     }\n     {\n            CComPtr<IApplicationActivationManager> AppActivationMgr = nullptr;\n            if (SUCCEEDED(hr))\n            {\n                   hr = CoCreateInstance(CLSID_ApplicationActivationManager, nullptr,  \nCLSCTX_LOCAL_SERVER, IID_PPV_ARGS(&AppActivationMgr));\n                   if (FAILED(hr))\n                   {\n                         wprintf(L\"LaunchApp %s: Failed to create Application Activation \nManager. hr = 0x%08lx \\n\", AUMID, hr);\n                   }\n            }\n            if (SUCCEEDED(hr))\n            {\n                   DWORD pid = 0;\n                   hr = AppActivationMgr->ActivateApplication(AUMID, nullptr, AO_NONE, \n&pid);\n                   if (FAILED(hr))\n                   {\n                         wprintf(L\"LaunchApp %s: Failed to Activate App. hr = 0x%08lx \n\\n\", AUMID, hr);\n                   }\n            }\n     }\n     CoUninitialize();\n     return hr;\n}\n```\n\nIt is worth noting that this method does support arguments being passed in, unlike the previous method for launching (that is, using the command line).\n\n## Accepting arguments\n\nTo accept arguments passed in on activation of the UWP app, you must add some code to the app. To determine if protocol activation or launch activation occurred, override the **OnActivated** event and check the argument type, and then get the raw string or Uri object’s pre-parsed values. \n\nThis example shows how to get the raw string.\n\n```\nvoid OnActivated(IActivatedEventArgs^ args)\n{\n        // Check for launch activation\n        if (args->Kind == ActivationKind::Launch)\n        {\n            auto launchArgs = static_cast<LaunchActivatedEventArgs^>(args); \nPlatform::String^ argval = launchArgs->Arguments;\n            // Manipulate arguments …\n        }\n\n        // Check for protocol activation\n        if (args->Kind == ActivationKind::Protocol)\n        {\n            auto protocolArgs = static_cast< ProtocolActivatedEventArgs^>(args);\n            Platform::String^ argval = protocolArgs->Uri->ToString();\n            // Manipulate arguments …\n        }\n    }\n```\n\n## Summary\nIn summary, you can use various methods to launch the UWP app. Depending on the requirements and use cases, different methods may be better suited than others. \n"}