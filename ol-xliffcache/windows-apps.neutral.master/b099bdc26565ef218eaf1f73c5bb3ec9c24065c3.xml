{"nodes":[{"content":"Use this method in the Windows Store collection API to report a consumable product as fulfilled for a given customer.","pos":[86,203]},{"content":"Before a user can repurchase a consumable product, your app or service must report the consumable product as fulfilled for that user.","pos":[204,337]},{"content":"Report consumable products as fulfilled","pos":[345,384]},{"content":"Report consumable products as fulfilled","pos":[392,431]},{"content":"Updated for UWP apps on Windows 10.","pos":[437,472]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[473,565]},{"content":"Use this method in the Windows Store collection API to report a consumable product as fulfilled for a given customer.","pos":[570,687]},{"content":"Before a user can repurchase a consumable product, your app or service must report the consumable product as fulfilled for that user.","pos":[688,821]},{"content":"There are two ways you can use this method to report a consumable product as fulfilled:","pos":[823,910]},{"content":"Provide the item ID of the consumable (as returned in the <bpt id=\"p1\">**</bpt>itemId<ept id=\"p1\">**</ept> parameter of a <bpt id=\"p2\">[</bpt>query for products<ept id=\"p2\">](query-for-products.md)</ept>), and a unique tracking ID that you provide.","pos":[916,1088]},{"content":"If the same tracking ID is used for multiple tries, the same result will be returned even if the item is already consumed.","pos":[1089,1211]},{"content":"If you aren't certain if a consume request was successful, your service should resubmit consume requests with the same tracking ID.","pos":[1212,1343]},{"content":"The tracking ID will always be tied to that consume request and can be resubmitted indefinitely.","pos":[1344,1440]},{"pos":[1445,1720],"content":"Provide the product ID (as returned in the <bpt id=\"p1\">**</bpt>productId<ept id=\"p1\">**</ept> parameter of a <bpt id=\"p2\">[</bpt>query for products<ept id=\"p2\">](query-for-products.md)</ept>) and a transaction ID that is obtained from one of the sources listed in the description for the <bpt id=\"p3\">**</bpt>transactionId<ept id=\"p3\">**</ept> parameter in the request body section below."},{"content":"Prerequisites","pos":[1725,1738]},{"content":"To use this method, you will need:","pos":[1741,1775]},{"pos":[1781,1878],"content":"An Azure AD access token that was created with the <ph id=\"ph1\">`https://onestore.microsoft.com`</ph> audience URI."},{"pos":[1883,2075],"content":"A Windows Store ID key that was generated by calling the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>GetCustomerCollectionsIdAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt608674)</ept> method from client-side code in your app."},{"pos":[2077,2187],"content":"For more information, see <bpt id=\"p1\">[</bpt>View and grant products from a service<ept id=\"p1\">](view-and-grant-products-from-a-service.md)</ept>."},{"content":"Request","pos":[2192,2199]},{"content":"Request syntax","pos":[2206,2220]},{"content":"Method","pos":[2224,2230]},{"content":"Request URI","pos":[2233,2244]},{"content":"POST","pos":[2374,2378]},{"content":"Request header","pos":[2462,2476]},{"content":"Header","pos":[2480,2486]},{"content":"Type","pos":[2497,2501]},{"content":"Description","pos":[2506,2517]},{"content":"Authorization","pos":[2744,2757]},{"content":"string","pos":[2761,2767]},{"content":"Required.","pos":[2770,2779]},{"content":"The Azure AD access token in the form <bpt id=\"p1\">**</bpt>Bearer<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;lt;</ph><bpt id=\"p2\">*</bpt>token<ept id=\"p2\">*</ept><ph id=\"ph2\">&amp;gt;</ph>.","pos":[2780,2845]},{"content":"Host","pos":[2876,2880]},{"content":"string","pos":[2893,2899]},{"pos":[2902,2960],"content":"Must be set to the value <bpt id=\"p1\">**</bpt>collections.mp.microsoft.com<ept id=\"p1\">**</ept>."},{"content":"Content-Length","pos":[3008,3022]},{"content":"number","pos":[3025,3031]},{"content":"The length of the request body.","pos":[3034,3065]},{"content":"Content-Type","pos":[3140,3152]},{"content":"string","pos":[3157,3163]},{"content":"Specifies the request and response type.","pos":[3166,3206]},{"content":"Currently, the only supported value is <bpt id=\"p1\">**</bpt>application/json<ept id=\"p1\">**</ept>.","pos":[3207,3267]},{"content":"Request body","pos":[3283,3295]},{"content":"Parameter","pos":[3299,3308]},{"content":"Type","pos":[3315,3319]},{"content":"Description","pos":[3330,3341]},{"content":"Required","pos":[3352,3360]},{"content":"beneficiary","pos":[3431,3442]},{"content":"UserIdentity","pos":[3447,3459]},{"content":"The user for which this item is being consumed.","pos":[3462,3509]},{"content":"Yes","pos":[3768,3771]},{"content":"itemId","pos":[3781,3787]},{"content":"String","pos":[3797,3803]},{"content":"The itemId value returned by a <bpt id=\"p1\">[</bpt>query for products<ept id=\"p1\">](query-for-products.md)</ept>.","pos":[3812,3887]},{"content":"Use this parameter with trackingId","pos":[3888,3922]},{"content":"No","pos":[4118,4120]},{"content":"trackingId","pos":[4131,4141]},{"content":"Guid","pos":[4147,4151]},{"content":"A unique tracking ID provided by developer.","pos":[4162,4205]},{"content":"Use this parameter with itemId.","pos":[4206,4237]},{"content":"No","pos":[4468,4470]},{"content":"productId","pos":[4481,4490]},{"content":"String","pos":[4497,4503]},{"content":"The productId value returned by a <bpt id=\"p1\">[</bpt>query for products<ept id=\"p1\">](query-for-products.md)</ept>.","pos":[4512,4590]},{"content":"Use this parameter with transactionId","pos":[4591,4628]},{"content":"No","pos":[4818,4820]},{"content":"transactionId","pos":[4831,4844]},{"content":"Guid","pos":[4847,4851]},{"content":"A transaction ID value that is obtained from one of the following sources:","pos":[4862,4936]},{"content":"No","pos":[5168,5170]},{"pos":[5212,5390],"content":"* The <bpt id=\"p1\">[</bpt>TransactionID<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263396)</ept> property of the <bpt id=\"p2\">[</bpt>PurchaseResults<ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn263392)</ept> class."},{"pos":[5437,5742],"content":"* The app or product receipt that is returned by <bpt id=\"p1\">[</bpt>RequestProductPurchaseAsync<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263381)</ept>, <bpt id=\"p2\">[</bpt>RequestAppPurchaseAsync<ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh967813)</ept>, or <bpt id=\"p3\">[</bpt>GetAppReceiptAsync<ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh967811)</ept>."},{"pos":[5789,5877],"content":"* The transactionId parameter returned by a <bpt id=\"p1\">[</bpt>query for products<ept id=\"p1\">](query-for-products.md)</ept>."},{"content":"Use this parameter with productId.","pos":[5932,5966]},{"content":"The UserIdentity object contains the following parameters.","pos":[5989,6047]},{"content":"Parameter","pos":[6051,6060]},{"content":"Type","pos":[6074,6078]},{"content":"Description","pos":[6083,6094]},{"content":"Required","pos":[6225,6233]},{"content":"identityType","pos":[6425,6437]},{"content":"string","pos":[6448,6454]},{"pos":[6457,6490],"content":"Specify the string value <bpt id=\"p1\">**</bpt>b2b<ept id=\"p1\">**</ept>."},{"content":"Yes","pos":[6599,6602]},{"content":"identityValue","pos":[6612,6625]},{"content":"string","pos":[6635,6641]},{"content":"String value of the Windows Store ID key.","pos":[6644,6685]},{"content":"Yes","pos":[6786,6789]},{"content":"localTicketReference","pos":[6799,6819]},{"content":"string","pos":[6822,6828]},{"content":"Requested identifier for the returned response.","pos":[6831,6878]},{"content":"We recommend that you use the same value as the <bpt id=\"p1\">*</bpt>userId<ept id=\"p1\">*</ept> claim in the Windows Store ID key.","pos":[6879,6970]},{"content":"Yes","pos":[6973,6976]},{"content":"Request examples","pos":[6997,7013]},{"pos":[7015,7068],"content":"The following example uses <bpt id=\"p1\">*</bpt>itemId<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>trackingId<ept id=\"p2\">*</ept>."},{"pos":[7553,7612],"content":"The following example uses <bpt id=\"p1\">*</bpt>productId<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>transactionId<ept id=\"p2\">*</ept>."},{"content":"Response","pos":[8091,8099]},{"content":"No content will be returned if the consumption was executed successfully.","pos":[8102,8175]},{"content":"Response example","pos":[8181,8197]},{"content":"Error codes","pos":[8435,8446]},{"content":"Code","pos":[8451,8455]},{"content":"Error","pos":[8458,8463]},{"content":"Inner error code","pos":[8473,8489]},{"content":"Description","pos":[8502,8513]},{"content":"401","pos":[8925,8928]},{"content":"Unauthorized","pos":[8932,8944]},{"content":"AuthenticationTokenInvalid","pos":[8947,8973]},{"content":"The Azure AD access token is invalid.","pos":[8976,9013]},{"content":"In some cases the details of the ServiceError will contain more information, such as when the token is expired or the <bpt id=\"p1\">*</bpt>appid<ept id=\"p1\">*</ept> claim is missing.","pos":[9014,9157]},{"content":"401","pos":[9162,9165]},{"content":"Unauthorized","pos":[9169,9181]},{"content":"PartnerAadTicketRequired","pos":[9184,9208]},{"content":"An Azure AD access token was not passed to the service in the authorization header.","pos":[9213,9296]},{"content":"401","pos":[9399,9402]},{"content":"Unauthorized","pos":[9406,9418]},{"content":"InconsistentClientId","pos":[9421,9441]},{"pos":[9450,9611],"content":"The <bpt id=\"p1\">*</bpt>clientId<ept id=\"p1\">*</ept> claim in the Windows Store ID key in the request body and the <bpt id=\"p2\">*</bpt>appid<ept id=\"p2\">*</ept> claim in the Azure AD access token in the authorization header do not match."},{"content":"Related topics","pos":[9646,9660]},{"content":"View and grant products from a service","pos":[9665,9703]},{"content":"Query for products","pos":[9751,9769]},{"content":"Grant free products","pos":[9797,9816]},{"content":"Renew a Windows Store ID key","pos":[9845,9873]}],"content":"---\nauthor: mcleanbyron\nms.assetid: E9BEB2D2-155F-45F6-95F8-6B36C3E81649\ndescription: Use this method in the Windows Store collection API to report a consumable product as fulfilled for a given customer. Before a user can repurchase a consumable product, your app or service must report the consumable product as fulfilled for that user.\ntitle: Report consumable products as fulfilled\n---\n\n# Report consumable products as fulfilled\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\nUse this method in the Windows Store collection API to report a consumable product as fulfilled for a given customer. Before a user can repurchase a consumable product, your app or service must report the consumable product as fulfilled for that user.\n\nThere are two ways you can use this method to report a consumable product as fulfilled:\n\n-   Provide the item ID of the consumable (as returned in the **itemId** parameter of a [query for products](query-for-products.md)), and a unique tracking ID that you provide. If the same tracking ID is used for multiple tries, the same result will be returned even if the item is already consumed. If you aren't certain if a consume request was successful, your service should resubmit consume requests with the same tracking ID. The tracking ID will always be tied to that consume request and can be resubmitted indefinitely.\n-   Provide the product ID (as returned in the **productId** parameter of a [query for products](query-for-products.md)) and a transaction ID that is obtained from one of the sources listed in the description for the **transactionId** parameter in the request body section below.\n\n## Prerequisites\n\n\nTo use this method, you will need:\n\n-   An Azure AD access token that was created with the `https://onestore.microsoft.com` audience URI.\n-   A Windows Store ID key that was generated by calling the [**GetCustomerCollectionsIdAsync**](https://msdn.microsoft.com/library/windows/apps/mt608674) method from client-side code in your app.\n\nFor more information, see [View and grant products from a service](view-and-grant-products-from-a-service.md).\n\n## Request\n\n\n### Request syntax\n\n| Method | Request URI                                                   |\n|--------|---------------------------------------------------------------|\n| POST   | `https://collections.mp.microsoft.com/v6.0/collections/consume` |\n\n<br/> \n\n### Request header\n\n| Header         | Type   | Description                                                                                           |\n|----------------|--------|-------------------------------------------------------------------------------------------------------|\n| Authorization  | string | Required. The Azure AD access token in the form **Bearer** &lt;*token*&gt;.                           |\n| Host           | string | Must be set to the value **collections.mp.microsoft.com**.                                            |\n| Content-Length | number | The length of the request body.                                                                       |\n| Content-Type   | string | Specifies the request and response type. Currently, the only supported value is **application/json**. |\n\n<br/> \n\n### Request body\n\n| Parameter     | Type         | Description         | Required |\n|---------------|--------------|---------------------|----------|\n| beneficiary   | UserIdentity | The user for which this item is being consumed.                                                                                                                                                                                                                                                                 | Yes      |\n| itemId        | String       | The itemId value returned by a [query for products](query-for-products.md). Use this parameter with trackingId                                                                                                                                                                                                  | No       |\n| trackingId    | Guid         | A unique tracking ID provided by developer. Use this parameter with itemId.                                                                                                                                                                                                                                     | No       |\n| productId     | String       | The productId value returned by a [query for products](query-for-products.md). Use this parameter with transactionId                                                                                                                                                                                            | No       |\n| transactionId | Guid         | A transaction ID value that is obtained from one of the following sources:                                                                                                                                                                                                                                      | No       |\n|               |              | * The [TransactionID](https://msdn.microsoft.com/library/windows/apps/dn263396) property of the [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392) class.   |        |\n|               |              | * The app or product receipt that is returned by [RequestProductPurchaseAsync](https://msdn.microsoft.com/library/windows/apps/dn263381), [RequestAppPurchaseAsync](https://msdn.microsoft.com/library/windows/apps/hh967813), or [GetAppReceiptAsync](https://msdn.microsoft.com/library/windows/apps/hh967811).   |        |\n|               |              | * The transactionId parameter returned by a [query for products](query-for-products.md).   |        |        \n|               |              | Use this parameter with productId.   |        |\n \n<br/>\n\nThe UserIdentity object contains the following parameters.\n\n| Parameter            | Type   | Description                                                                                                                                 | Required |\n|----------------------|--------|---------------------------------------------------------------------------------------------------------------------------------------------|----------|\n| identityType         | string | Specify the string value **b2b**.                                                                                                           | Yes      |\n| identityValue        | string | String value of the Windows Store ID key.                                                                                                   | Yes      |\n| localTicketReference | string | Requested identifier for the returned response. We recommend that you use the same value as the *userId* claim in the Windows Store ID key. | Yes      |\n\n<br/> \n\n### Request examples\n\nThe following example uses *itemId* and *trackingId*.\n\n```syntax\nPOST https://collections.mp.microsoft.com/v6.0/collections/consume HTTP/1.1\nAuthorization: Bearer eyJ0eXAiOiJKV1…..\nHost: collections.mp.microsoft.com\nContent-Length: 2050\nContent-Type: application/json\n\n{\n    \"beneficiary\": {\n        \"localTicketReference\": \"testreference\",\n        \"identityValue\": \"eyJ0eXAiOi…..\",\n        \"identityType\": \"b2b\"\n    },\n    \"itemId\": \"44c26106-4979-457b-af34-609ae97a084f\",\n    \"trackingId\": \"44db79ca-e31d-49e9-8896-fa5c7f892b40\"\n}\n```\n\nThe following example uses *productId* and *transactionId*.\n\n```syntax\nPOST https://collections.mp.microsoft.com/v6.0/collections/consume HTTP/1.1\nAuthorization: Bearer eyJ0eXAiOiJKV1……\nContent-Length: 1880\nContent-Type: application/json\nHost: collections.md.mp.microsoft.com\n\n{\n    \"beneficiary\" : {\n        \"localTicketReference\" : \"testReference\",\n        \"identityValue\" : \"eyJ0eXAiOiJ…..\",\n        \"identitytype\" : \"b2b\"\n    },\n    \"productId\" : \"9NBLGGH5WVP6\",\n    \"transactionId\" : \"08a14c7c-1892-49fc-9135-190ca4f10490\"\n}\n```\n\n## Response\n\n\nNo content will be returned if the consumption was executed successfully.\n\n### Response example\n\n```syntax\nHTTP/1.1 204 No Content\nContent-Length: 0\nMS-CorrelationId: 386f733d-bc66-4bf9-9b6f-a1ad417f97f0\nMS-RequestId: e488cd0a-9fb6-4c2c-bb77-e5100d3c15b1\nMS-CV: 5.1\nMS-ServerId: 030011326\nDate: Tue, 22 Sep 2015 20:40:55 GMT\n```\n\n## Error codes\n\n\n| Code | Error        | Inner error code           | Description                                                                                                                                                                           |\n|------|--------------|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| 401  | Unauthorized | AuthenticationTokenInvalid | The Azure AD access token is invalid. In some cases the details of the ServiceError will contain more information, such as when the token is expired or the *appid* claim is missing. |\n| 401  | Unauthorized | PartnerAadTicketRequired   | An Azure AD access token was not passed to the service in the authorization header.                                                                                                   |\n| 401  | Unauthorized | InconsistentClientId       | The *clientId* claim in the Windows Store ID key in the request body and the *appid* claim in the Azure AD access token in the authorization header do not match.                     |\n\n<br/> \n\n## Related topics\n\n* [View and grant products from a service](view-and-grant-products-from-a-service.md)\n* [Query for products](query-for-products.md)\n* [Grant free products](grant-free-products.md)\n* [Renew a Windows Store ID key](renew-a-windows-store-id-key.md)\n \n\n \n"}