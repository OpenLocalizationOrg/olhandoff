{"nodes":[{"content":"Monitor background task progress and completion","pos":[29,76]},{"content":"Learn how your app can recognize progress and completion reported by a background task.","pos":[90,177]},{"content":"Monitor background task progress and completion","pos":[234,281]},{"content":"Updated for UWP apps on Windows 10.","pos":[287,322]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[323,415]},{"content":"Important APIs","pos":[423,437]},{"content":"BackgroundTaskRegistration","pos":[448,474]},{"content":"BackgroundTaskProgressEventHandler","pos":[543,577]},{"content":"BackgroundTaskCompletedEventHandler","pos":[646,681]},{"content":"Learn how your app can recognize progress and completion reported by a background task.","pos":[744,831]},{"content":"Background tasks are decoupled from the app, and they run separately, but background task progress and completion can be monitored by app code.","pos":[832,975]},{"content":"To make this happen, the app subscribes to events from the background task(s) it has registered with the system.","pos":[976,1088]},{"content":"This topic assumes that you have an app that registers background tasks.","pos":[1094,1166]},{"content":"To get started quickly building a background task, see <bpt id=\"p1\">[</bpt>Create and register a background task<ept id=\"p1\">](create-and-register-a-background-task.md)</ept>.","pos":[1167,1304]},{"content":"For more in-depth information on conditions and triggers, see <bpt id=\"p1\">[</bpt>Support your app with background tasks<ept id=\"p1\">](support-your-app-with-background-tasks.md)</ept>.","pos":[1305,1451]},{"content":"Create an event handler to handle completed background tasks","pos":[1456,1516]},{"content":"Create an event handler function to handle completed background tasks.","pos":[1523,1593]},{"content":"This code needs to follow a specific footprint, which takes in an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IBackgroundTaskRegistration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224803)</ept> object and a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BackgroundTaskCompletedEventArgs<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br224778)</ept> object.","pos":[1594,1869]},{"content":"Use the following footprint for the OnCompleted background task event handler method:","pos":[1875,1960]},{"content":"[!div class=\"tabbedCodeSnippets\"]","pos":[1965,1998]},{"content":"Add code to the event handler that deals with the background task completion.","pos":[2398,2475]},{"pos":[2481,2587],"content":"For example, the <bpt id=\"p1\">[</bpt>background task sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=618666)</ept> updates the UI."},{"pos":[2595,3010],"content":"[!div class=\"tabbedCodeSnippets\"] <ph id=\"ph1\">    ```cs\n    private void OnCompleted(IBackgroundTaskRegistration task, BackgroundTaskCompletedEventArgs args)\n    {\n        UpdateUI();\n    }\n    ```\n    ```cpp\n    auto completed = [this](BackgroundTaskRegistration^ task, BackgroundTaskCompletedEventArgs^ args)\n    {    \n        UpdateUI();\n    };\n    ```</ph>","leadings":["","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > "]},{"content":"Create an event handler function to handle background task progress","pos":[3015,3082]},{"content":"Create an event handler function to handle completed background tasks.","pos":[3089,3159]},{"content":"This code needs to follow a specific footprint, which takes in an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IBackgroundTaskRegistration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224803)</ept> object and a <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>BackgroundTaskProgressEventArgs<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br224782)</ept> object:","pos":[3160,3434]},{"content":"Use the following footprint for the OnProgress background task event handler method:","pos":[3440,3524]},{"pos":[3532,4035],"content":"[!div class=\"tabbedCodeSnippets\"] <ph id=\"ph1\">    ```cs\n    private void OnProgress(IBackgroundTaskRegistration task, BackgroundTaskProgressEventArgs args)\n    {\n        // TODO: Add code that deals with background task progress.\n    }\n    ```\n    ```cpp\n    auto progress = [this](BackgroundTaskRegistration^ task, BackgroundTaskProgressEventArgs^ args)\n    {\n        // TODO: Add code that deals with background task progress.\n    };\n    ```</ph>","leadings":["","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > "]},{"content":"Add code to the event handler that deals with the background task completion.","pos":[4041,4118]},{"pos":[4124,4290],"content":"For example, the <bpt id=\"p1\">[</bpt>background task sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=618666)</ept> updates the UI with the progress status passed in via the <bpt id=\"p2\">*</bpt>args<ept id=\"p2\">*</ept> parameter:"},{"pos":[4298,4606],"content":"[!div class=\"tabbedCodeSnippets\"]     ```cs     private void OnProgress(IBackgroundTaskRegistration task, BackgroundTaskProgressEventArgs args)     {         var progress = \"Progress: \" + args.Progress + \"%\";         BackgroundTaskSample.SampleBackgroundTaskProgress = progress;","leadings":["","    > ","    > ","    > ","    > ","    > "]},{"content":"Register the event handler functions with new and existing background tasks.","pos":[5007,5083]},{"content":"When the app registers a background task for the first time, it should register to receive progress and completion updates for it, in case the task runs while the app is still active in the foreground.","pos":[5090,5291]},{"pos":[5297,5459],"content":"For example, the <bpt id=\"p1\">[</bpt>background task sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=618666)</ept> calls the following function on each background task that it registers:"},{"pos":[5467,6276],"content":"[!div class=\"tabbedCodeSnippets\"] <ph id=\"ph1\">    ```cs\n    private void AttachProgressAndCompletedHandlers(IBackgroundTaskRegistration task)\n    {\n        task.Progress += new BackgroundTaskProgressEventHandler(OnProgress);\n        task.Completed += new BackgroundTaskCompletedEventHandler(OnCompleted);\n    }\n    ```\n</ph>    ```cpp     void SampleBackgroundTask::AttachProgressAndCompletedHandlers(IBackgroundTaskRegistration^ task)     {         auto progress = <bpt id=\"p1\">[</bpt>this<ept id=\"p1\">](BackgroundTaskRegistration^ task, BackgroundTaskProgressEventArgs^ args)</ept><ph id=\"ph2\">\n</ph>        {             auto progress = \"Progress: \" + args-&gt;Progress + \"%\";             BackgroundTaskSample::SampleBackgroundTaskProgress = progress;             UpdateUI();         };","leadings":["","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > "]},{"content":"When the app launches, or navigates to a new page where background task status is relevant, it should get a list of background tasks currently registered and associate them with the progress and completion event handler functions.","pos":[6691,6921]},{"content":"The list of background tasks currently registered by the application is kept in the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>BackgroundTaskRegistration<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br224786)</ept>.<bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>AllTasks<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/br224787)</ept> property.","pos":[6922,7179]},{"pos":[7185,7376],"content":"For example, the <bpt id=\"p1\">[</bpt>background task sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=618666)</ept> uses the following code to attach event handlers when the SampleBackgroundTask page is navigated to:"},{"pos":[7384,7942],"content":"[!div class=\"tabbedCodeSnippets\"]     ```cs     protected override void OnNavigatedTo(NavigationEventArgs e)     {         foreach (var task in BackgroundTaskRegistration.AllTasks)         {             if (task.Value.Name == BackgroundTaskSample.SampleBackgroundTaskName)             {                 AttachProgressAndCompletedHandlers(task.Value);                 BackgroundTaskSample.UpdateBackgroundTaskStatus(BackgroundTaskSample.SampleBackgroundTaskName, true);             }         }","leadings":["","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > ","    > "]},{"content":"Related topics","pos":[8955,8969]},{"content":"Create and register a background task","pos":[8981,9018]},{"content":"Declare background tasks in the application manifest","pos":[9065,9117]},{"content":"Handle a cancelled background task","pos":[9179,9213]},{"content":"Register a background task","pos":[9257,9283]},{"content":"Respond to system events with background tasks","pos":[9319,9365]},{"content":"Set conditions for running a background task","pos":[9421,9465]},{"content":"Update a live tile from a background task","pos":[9519,9560]},{"content":"Use a maintenance trigger","pos":[9611,9636]},{"content":"Run a background task on a timer","pos":[9671,9703]},{"content":"Guidelines for background tasks","pos":[9746,9777]},{"content":"Debug a background task","pos":[9825,9848]},{"content":"How to trigger suspend, resume, and background events in Windows Store apps (when debugging)","pos":[9881,9973]}],"content":"---\nauthor: TylerMSFT\ntitle: Monitor background task progress and completion\ndescription: Learn how your app can recognize progress and completion reported by a background task.\nms.assetid: 17544FD7-A336-4254-97DC-2BF8994FF9B2\n---\n\n# Monitor background task progress and completion\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n**Important APIs**\n\n-   [**BackgroundTaskRegistration**](https://msdn.microsoft.com/library/windows/apps/br224786)\n-   [**BackgroundTaskProgressEventHandler**](https://msdn.microsoft.com/library/windows/apps/br224785)\n-   [**BackgroundTaskCompletedEventHandler**](https://msdn.microsoft.com/library/windows/apps/br224781)\n\nLearn how your app can recognize progress and completion reported by a background task. Background tasks are decoupled from the app, and they run separately, but background task progress and completion can be monitored by app code. To make this happen, the app subscribes to events from the background task(s) it has registered with the system.\n\n-   This topic assumes that you have an app that registers background tasks. To get started quickly building a background task, see [Create and register a background task](create-and-register-a-background-task.md). For more in-depth information on conditions and triggers, see [Support your app with background tasks](support-your-app-with-background-tasks.md).\n\n## Create an event handler to handle completed background tasks\n\n\n1.  Create an event handler function to handle completed background tasks. This code needs to follow a specific footprint, which takes in an [**IBackgroundTaskRegistration**](https://msdn.microsoft.com/library/windows/apps/br224803) object and a [**BackgroundTaskCompletedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br224778) object.\n\n    Use the following footprint for the OnCompleted background task event handler method:\n\n>  [!div class=\"tabbedCodeSnippets\"]\n>  ```cs\n>  private void OnCompleted(IBackgroundTaskRegistration task, BackgroundTaskCompletedEventArgs args)\n>  {\n>      // TODO: Add code that deals with background task completion.\n>  }\n>  ```\n>  ```cpp\n>  auto completed = [this](BackgroundTaskRegistration^ task, BackgroundTaskCompletedEventArgs^ args)\n>  {\n>      // TODO: Add code that deals with background task completion.\n>  };\n>  ```\n\n2.  Add code to the event handler that deals with the background task completion.\n\n    For example, the [background task sample](http://go.microsoft.com/fwlink/p/?LinkId=618666) updates the UI.\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    >     ```cs\n    >     private void OnCompleted(IBackgroundTaskRegistration task, BackgroundTaskCompletedEventArgs args)\n    >     {\n    >         UpdateUI();\n    >     }\n    >     ```\n    >     ```cpp\n    >     auto completed = [this](BackgroundTaskRegistration^ task, BackgroundTaskCompletedEventArgs^ args)\n    >     {    \n    >         UpdateUI();\n    >     };\n    >     ```\n\n## Create an event handler function to handle background task progress\n\n\n1.  Create an event handler function to handle completed background tasks. This code needs to follow a specific footprint, which takes in an [**IBackgroundTaskRegistration**](https://msdn.microsoft.com/library/windows/apps/br224803) object and a [**BackgroundTaskProgressEventArgs**](https://msdn.microsoft.com/library/windows/apps/br224782) object:\n\n    Use the following footprint for the OnProgress background task event handler method:\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    >     ```cs\n    >     private void OnProgress(IBackgroundTaskRegistration task, BackgroundTaskProgressEventArgs args)\n    >     {\n    >         // TODO: Add code that deals with background task progress.\n    >     }\n    >     ```\n    >     ```cpp\n    >     auto progress = [this](BackgroundTaskRegistration^ task, BackgroundTaskProgressEventArgs^ args)\n    >     {\n    >         // TODO: Add code that deals with background task progress.\n    >     };\n    >     ```\n\n2.  Add code to the event handler that deals with the background task completion.\n\n    For example, the [background task sample](http://go.microsoft.com/fwlink/p/?LinkId=618666) updates the UI with the progress status passed in via the *args* parameter:\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    >     ```cs\n    >     private void OnProgress(IBackgroundTaskRegistration task, BackgroundTaskProgressEventArgs args)\n    >     {\n    >         var progress = \"Progress: \" + args.Progress + \"%\";\n    >         BackgroundTaskSample.SampleBackgroundTaskProgress = progress;\n    >\n    >         UpdateUI();\n    >     }\n    >     ```\n    >     ```cpp\n    >     auto progress = [this](BackgroundTaskRegistration^ task, BackgroundTaskProgressEventArgs^ args)\n    >     {\n    >         auto progress = \"Progress: \" + args->Progress + \"%\";\n    >         BackgroundTaskSample::SampleBackgroundTaskProgress = progress;\n    >\n    >         UpdateUI();\n    >     };\n    >     ```\n\n## Register the event handler functions with new and existing background tasks.\n\n\n1.  When the app registers a background task for the first time, it should register to receive progress and completion updates for it, in case the task runs while the app is still active in the foreground.\n\n    For example, the [background task sample](http://go.microsoft.com/fwlink/p/?LinkId=618666) calls the following function on each background task that it registers:\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    >     ```cs\n    >     private void AttachProgressAndCompletedHandlers(IBackgroundTaskRegistration task)\n    >     {\n    >         task.Progress += new BackgroundTaskProgressEventHandler(OnProgress);\n    >         task.Completed += new BackgroundTaskCompletedEventHandler(OnCompleted);\n    >     }\n    >     ```\n    >     ```cpp\n    >     void SampleBackgroundTask::AttachProgressAndCompletedHandlers(IBackgroundTaskRegistration^ task)\n    >     {\n    >         auto progress = [this](BackgroundTaskRegistration^ task, BackgroundTaskProgressEventArgs^ args)\n    >         {\n    >             auto progress = \"Progress: \" + args->Progress + \"%\";\n    >             BackgroundTaskSample::SampleBackgroundTaskProgress = progress;\n    >             UpdateUI();\n    >         };\n    >\n    >         task->Progress += ref new BackgroundTaskProgressEventHandler(progress);\n    >         \n    >\n    >         auto completed = [this](BackgroundTaskRegistration^ task, BackgroundTaskCompletedEventArgs^ args)\n    >         {\n    >             UpdateUI();\n    >         };\n    >\n    >         task->Completed += ref new BackgroundTaskCompletedEventHandler(completed);\n    >     }\n    >     ```\n\n2.  When the app launches, or navigates to a new page where background task status is relevant, it should get a list of background tasks currently registered and associate them with the progress and completion event handler functions. The list of background tasks currently registered by the application is kept in the [**BackgroundTaskRegistration**](https://msdn.microsoft.com/library/windows/apps/br224786).[**AllTasks**](https://msdn.microsoft.com/library/windows/apps/br224787) property.\n\n    For example, the [background task sample](http://go.microsoft.com/fwlink/p/?LinkId=618666) uses the following code to attach event handlers when the SampleBackgroundTask page is navigated to:\n\n    > [!div class=\"tabbedCodeSnippets\"]\n    >     ```cs\n    >     protected override void OnNavigatedTo(NavigationEventArgs e)\n    >     {\n    >         foreach (var task in BackgroundTaskRegistration.AllTasks)\n    >         {\n    >             if (task.Value.Name == BackgroundTaskSample.SampleBackgroundTaskName)\n    >             {\n    >                 AttachProgressAndCompletedHandlers(task.Value);\n    >                 BackgroundTaskSample.UpdateBackgroundTaskStatus(BackgroundTaskSample.SampleBackgroundTaskName, true);\n    >             }\n    >         }\n    >\n    >         UpdateUI();\n    >     }\n    >     ```\n    >     ```cpp\n    >     void SampleBackgroundTask::OnNavigatedTo(NavigationEventArgs^ e)\n    >     {\n    >         // A pointer back to the main page.  This is needed if you want to call methods in MainPage such\n    >         // as NotifyUser()\n    >         rootPage = MainPage::Current;\n    >\n    >         //\n    >         // Attach progress and completed handlers to any existing tasks.\n    >         //\n    >         auto iter = BackgroundTaskRegistration::AllTasks->First();\n    >         auto hascur = iter->HasCurrent;\n    >         while (hascur)\n    >         {\n    >             auto cur = iter->Current->Value;\n    >\n    >             if (cur->Name == SampleBackgroundTaskName)\n    >             {\n    >                 AttachProgressAndCompletedHandlers(cur);\n    >                 break;\n    >             }\n    >\n    >             hascur = iter->MoveNext();\n    >         }\n    >\n    >         UpdateUI();\n    >     }\n    >     ```\n\n## Related topics\n\n\n****\n\n* [Create and register a background task](create-and-register-a-background-task.md)\n* [Declare background tasks in the application manifest](declare-background-tasks-in-the-application-manifest.md)\n* [Handle a cancelled background task](handle-a-cancelled-background-task.md)\n* [Register a background task](register-a-background-task.md)\n* [Respond to system events with background tasks](respond-to-system-events-with-background-tasks.md)\n* [Set conditions for running a background task](set-conditions-for-running-a-background-task.md)\n* [Update a live tile from a background task](update-a-live-tile-from-a-background-task.md)\n* [Use a maintenance trigger](use-a-maintenance-trigger.md)\n* [Run a background task on a timer](run-a-background-task-on-a-timer-.md)\n* [Guidelines for background tasks](guidelines-for-background-tasks.md)\n\n****\n\n* [Debug a background task](debug-a-background-task.md)\n* [How to trigger suspend, resume, and background events in Windows Store apps (when debugging)](http://go.microsoft.com/fwlink/p/?linkid=254345)\n\n \n\n \n"}