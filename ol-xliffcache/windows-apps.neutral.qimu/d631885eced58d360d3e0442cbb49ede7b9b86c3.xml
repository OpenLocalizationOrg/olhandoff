{"nodes":[{"content":"Follow these best practices for geofencing in your app.","pos":[39,94]},{"content":"Guidelines for geofencing apps","pos":[102,132]},{"content":"Guidelines for geofencing apps","pos":[189,219]},{"content":"Updated for UWP apps on Windows 10.","pos":[225,260]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[261,353]},{"content":"Important APIs","pos":[361,375]},{"content":"Geofence class (XAML)","pos":[386,407]},{"content":"Geolocator class (XAML)","pos":[476,499]},{"pos":[562,681],"content":"Follow these best practices for <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>geofencing<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263744)</ept> in your app."},{"content":"Recommendations","pos":[686,701]},{"pos":[708,895],"content":"If your app will need internet access when a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Geofence<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263587)</ept> event occurs, check for internet access before creating the geofence."},{"content":"If the app doesn't currently have internet access, you can prompt the user to connect to the internet before you set up the geofence.","pos":[904,1037]},{"content":"If internet access isn't possible, avoid consuming the power required for the geofencing location checks.","pos":[1046,1151]},{"content":"Ensure the relevance of geofencing notifications by checking the time stamp and current location when a geofence event indicates changes to an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Entered<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263660)</ept> or <bpt id=\"p3\">**</bpt>Exited<ept id=\"p3\">**</ept> state.","pos":[1156,1391]},{"content":"See <bpt id=\"p1\">[</bpt>Checking the time stamp and current location<ept id=\"p1\">](#timestamp)</ept> below for more information.","pos":[1392,1482]},{"content":"Create exceptions to manage cases when a device can't access location info, and notify the user if necessary.","pos":[1487,1596]},{"content":"Location info may be unavailable because permissions are turned off, the device doesn't contain a GPS radio, the GPS signal is blocked, or the Wi-Fi signal isn't strong enough.","pos":[1597,1773]},{"content":"In general, it isn't necessary to listen for geofence events in the foreground and background at the same time.","pos":[1778,1889]},{"content":"However, if your app needs to listen for geofence events in both the foreground and background:","pos":[1890,1985]},{"pos":[1995,2124],"content":"Call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ReadReports<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263633)</ept> method to find out if an event has occurred."},{"content":"Unregister your foreground event listener when your app isn't visible to the user and re-register when it becomes visible again.","pos":[2133,2261]},{"pos":[2267,2386],"content":"See <bpt id=\"p1\">[</bpt>Background and foreground listeners<ept id=\"p1\">](#background-and-foreground-listeners)</ept> for code examples and more information."},{"content":"Don't use more than 1000 geofences per app.","pos":[2392,2435]},{"content":"The system actually supports thousands of geofences per app, you can maintain good app performance to help reduce the app's memory usage by using no more than 1000.","pos":[2436,2600]},{"content":"Don't create a geofence with a radius smaller than 50 meters.","pos":[2605,2666]},{"content":"If your app needs to use a geofence with a small radius, advise users to use your app on a device with a GPS radio to ensure the best performance.","pos":[2667,2813]},{"content":"Additional usage guidance","pos":[2818,2843]},{"content":"Checking the time stamp and current location","pos":[2849,2893]},{"content":"When an event indicates a change to an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Entered<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263660)</ept> or <bpt id=\"p3\">**</bpt>Exited<ept id=\"p3\">**</ept> state, check both the time stamp of the event and your current location.","pos":[2895,3092]},{"content":"Various factors, such as the system not having enough resources to launch a background task, the user not noticing the notification, or the device being in standby (on Windows), may affect when the event is actually processed by the user.","pos":[3093,3331]},{"content":"For example, the following sequence may occur:","pos":[3332,3378]},{"content":"Your app creates a geofence and monitors the geofence for enter and exit events.","pos":[3384,3464]},{"content":"The user moves the device inside of the geofence, causing an enter event to be triggered.","pos":[3469,3558]},{"content":"Your app sends a notification to the user that they are now inside the geofence.","pos":[3563,3643]},{"content":"The user was busy and does not notice the notification until 10 minutes later.","pos":[3648,3726]},{"content":"During that 10 minute delay, the user has moved back outside of the geofence.","pos":[3731,3808]},{"content":"From the timestamp, you can tell that the action occurred in the past.","pos":[3810,3880]},{"content":"From the current location, you can see that the user is now back outside of the geofence.","pos":[3881,3970]},{"content":"Depending on the functionality of your app, you may want to filter out this event.","pos":[3971,4053]},{"content":"Background and foreground listeners","pos":[4059,4094]},{"content":"In general, your app doesn't need to listen for <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Geofence<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263587)</ept> events both in the foreground and in a background task at the same time.","pos":[4096,4289]},{"content":"The cleanest method for handling a case where you might need both is to let the background task handle the notifications.","pos":[4290,4411]},{"content":"If you do set up both foreground and background geofence listeners, there is no guarantee which will be triggered first and so you must always call the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ReadReports<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263633)</ept> method to find out if an event has occurred.","pos":[4412,4684]},{"content":"If you have set up both foreground and background geofence listeners, you should unregister your foreground event listener whenever your app is not visible to the user and re-register your app when it becomes visible again.","pos":[4686,4909]},{"content":"Here's some example code that registers for the visibility event.","pos":[4910,4975]},{"content":"When the visibility changes, you can then enable or disable the foreground event handlers as shown here.","pos":[5349,5453]},{"content":"Sizing your geofences","pos":[7411,7432]},{"content":"While GPS can provide the most accurate location info, geofencing can also use Wi-Fi or other location sensors to determine the user's current position.","pos":[7434,7586]},{"content":"But using these other methods can affect the size of the geofences you can create.","pos":[7587,7669]},{"content":"If the accuracy level is low, creating small geofences won't be useful.","pos":[7670,7741]},{"content":"In general, it is recommended that you do not create a geofence with a radius smaller than 50 meters.","pos":[7742,7843]},{"content":"Also, geofence background tasks only run periodically on Windows; if you use a small geofence, there's a possibility that you could miss an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Enter<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn263660)</ept> or <bpt id=\"p3\">**</bpt>Exit<ept id=\"p3\">**</ept> event entirely.","pos":[7844,8081]},{"content":"If your app needs to use a geofence with a small radius, advise users to use your app on a device with a GPS radio to ensure the best performance.","pos":[8083,8229]},{"content":"Related topics","pos":[8234,8248]},{"content":"Set up a geofence","pos":[8254,8271]},{"content":"Get current location","pos":[8334,8354]},{"content":"UWP location sample (geolocation)","pos":[8515,8548]}],"content":"---\nauthor: PatrickFarley\nDescription: Follow these best practices for geofencing in your app.\ntitle: Guidelines for geofencing apps\nms.assetid: F817FA55-325F-4302-81BE-37E6C7ADC281\n---\n\n# Guidelines for geofencing apps\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n**Important APIs**\n\n-   [**Geofence class (XAML)**](https://msdn.microsoft.com/library/windows/apps/dn263587)\n-   [**Geolocator class (XAML)**](https://msdn.microsoft.com/library/windows/apps/br225534)\n\nFollow these best practices for [**geofencing**](https://msdn.microsoft.com/library/windows/apps/dn263744) in your app.\n\n## Recommendations\n\n\n-   If your app will need internet access when a [**Geofence**](https://msdn.microsoft.com/library/windows/apps/dn263587) event occurs, check for internet access before creating the geofence.\n    -   If the app doesn't currently have internet access, you can prompt the user to connect to the internet before you set up the geofence.\n    -   If internet access isn't possible, avoid consuming the power required for the geofencing location checks.\n-   Ensure the relevance of geofencing notifications by checking the time stamp and current location when a geofence event indicates changes to an [**Entered**](https://msdn.microsoft.com/library/windows/apps/dn263660) or **Exited** state. See [Checking the time stamp and current location](#timestamp) below for more information.\n-   Create exceptions to manage cases when a device can't access location info, and notify the user if necessary. Location info may be unavailable because permissions are turned off, the device doesn't contain a GPS radio, the GPS signal is blocked, or the Wi-Fi signal isn't strong enough.\n-   In general, it isn't necessary to listen for geofence events in the foreground and background at the same time. However, if your app needs to listen for geofence events in both the foreground and background:\n\n    -   Call the [**ReadReports**](https://msdn.microsoft.com/library/windows/apps/dn263633) method to find out if an event has occurred.\n    -   Unregister your foreground event listener when your app isn't visible to the user and re-register when it becomes visible again.\n\n    See [Background and foreground listeners](#background-and-foreground-listeners) for code examples and more information.\n\n-   Don't use more than 1000 geofences per app. The system actually supports thousands of geofences per app, you can maintain good app performance to help reduce the app's memory usage by using no more than 1000.\n-   Don't create a geofence with a radius smaller than 50 meters. If your app needs to use a geofence with a small radius, advise users to use your app on a device with a GPS radio to ensure the best performance.\n\n## Additional usage guidance\n\n### Checking the time stamp and current location\n\nWhen an event indicates a change to an [**Entered**](https://msdn.microsoft.com/library/windows/apps/dn263660) or **Exited** state, check both the time stamp of the event and your current location. Various factors, such as the system not having enough resources to launch a background task, the user not noticing the notification, or the device being in standby (on Windows), may affect when the event is actually processed by the user. For example, the following sequence may occur:\n\n-   Your app creates a geofence and monitors the geofence for enter and exit events.\n-   The user moves the device inside of the geofence, causing an enter event to be triggered.\n-   Your app sends a notification to the user that they are now inside the geofence.\n-   The user was busy and does not notice the notification until 10 minutes later.\n-   During that 10 minute delay, the user has moved back outside of the geofence.\n\nFrom the timestamp, you can tell that the action occurred in the past. From the current location, you can see that the user is now back outside of the geofence. Depending on the functionality of your app, you may want to filter out this event.\n\n### Background and foreground listeners\n\nIn general, your app doesn't need to listen for [**Geofence**](https://msdn.microsoft.com/library/windows/apps/dn263587) events both in the foreground and in a background task at the same time. The cleanest method for handling a case where you might need both is to let the background task handle the notifications. If you do set up both foreground and background geofence listeners, there is no guarantee which will be triggered first and so you must always call the [**ReadReports**](https://msdn.microsoft.com/library/windows/apps/dn263633) method to find out if an event has occurred.\n\nIf you have set up both foreground and background geofence listeners, you should unregister your foreground event listener whenever your app is not visible to the user and re-register your app when it becomes visible again. Here's some example code that registers for the visibility event.\n\n```csharp\n    Windows.UI.Core.CoreWindow coreWindow;    \n    \n    // This needs to be set before InitializeComponent sets up event registration for app visibility\n    coreWindow = CoreWindow.GetForCurrentThread(); \n    coreWindow.VisibilityChanged += OnVisibilityChanged;\n```\n\n```javascript\n document.addEventListener(\"visibilitychange\", onVisibilityChanged, false);\n```\n\nWhen the visibility changes, you can then enable or disable the foreground event handlers as shown here.\n\n```csharp\nprivate void OnVisibilityChanged(CoreWindow sender, VisibilityChangedEventArgs args)\n{\n    // NOTE: After the app is no longer visible on the screen and before the app is suspended\n    // you might want your app to use toast notification for any geofence activity.\n    // By registering for VisibiltyChanged the app is notified when the app is no longer visible in the foreground.\n\n    if (args.Visible)\n    {\n        // register for foreground events\n        GeofenceMonitor.Current.GeofenceStateChanged += OnGeofenceStateChanged;\n        GeofenceMonitor.Current.StatusChanged += OnGeofenceStatusChanged;\n    }\n    else\n    {\n        // unregister foreground events (let background capture events)\n        GeofenceMonitor.Current.GeofenceStateChanged -= OnGeofenceStateChanged;\n        GeofenceMonitor.Current.StatusChanged -= OnGeofenceStatusChanged;\n    }\n}\n```\n\n```javascript\nfunction onVisibilityChanged() {\n    // NOTE: After the app is no longer visible on the screen and before the app is suspended\n    // you might want your app to use toast notification for any geofence activity.\n    // By registering for VisibiltyChanged the app is notified when the app is no longer visible in the foreground.\n\n    if (document.msVisibilityState === \"visible\") {\n        // register for foreground events\n        Windows.Devices.Geolocation.Geofencing.GeofenceMonitor.current.addEventListener(\"geofencestatechanged\", onGeofenceStateChanged);\n        Windows.Devices.Geolocation.Geofencing.GeofenceMonitor.current.addEventListener(\"statuschanged\", onGeofenceStatusChanged);\n    } else {\n        // unregister foreground events (let background capture events)\n        Windows.Devices.Geolocation.Geofencing.GeofenceMonitor.current.removeEventListener(\"geofencestatechanged\", onGeofenceStateChanged);\n        Windows.Devices.Geolocation.Geofencing.GeofenceMonitor.current.removeEventListener(\"statuschanged\", onGeofenceStatusChanged);\n    }\n}\n```\n\n### Sizing your geofences\n\nWhile GPS can provide the most accurate location info, geofencing can also use Wi-Fi or other location sensors to determine the user's current position. But using these other methods can affect the size of the geofences you can create. If the accuracy level is low, creating small geofences won't be useful. In general, it is recommended that you do not create a geofence with a radius smaller than 50 meters. Also, geofence background tasks only run periodically on Windows; if you use a small geofence, there's a possibility that you could miss an [**Enter**](https://msdn.microsoft.com/library/windows/apps/dn263660) or **Exit** event entirely.\n\nIf your app needs to use a geofence with a small radius, advise users to use your app on a device with a GPS radio to ensure the best performance.\n\n## Related topics\n\n\n* [Set up a geofence](https://msdn.microsoft.com/library/windows/apps/mt219702)\n* [Get current location](https://msdn.microsoft.com/library/windows/apps/mt219698)\n<!--* [Design guidelines for privacy-aware apps](guidelines-for-enabling-sensitive-devices.md)-->\n* [UWP location sample (geolocation)](http://go.microsoft.com/fwlink/p/?linkid=533278)\n \n\n \n\n\n\n\n"}