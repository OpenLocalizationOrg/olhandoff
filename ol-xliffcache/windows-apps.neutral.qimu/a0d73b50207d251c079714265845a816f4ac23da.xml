{"nodes":[{"content":"After you install the Microsoft Store Engagement and Monetization SDK, follow the instructions in this topic to use the ad mediator control in your app.","pos":[86,238]},{"content":"Add and use the ad mediator control","pos":[246,281]},{"content":"Add and use the ad mediator control","pos":[289,324]},{"content":"Updated for UWP apps on Windows 10.","pos":[330,365]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[366,458]},{"content":"After you <bpt id=\"p1\">[</bpt>install the Microsoft Store Engagement and Monetization SDK<ept id=\"p1\">](http://aka.ms/store-em-sdk)</ept>, follow the instructions in this topic to use the ad mediator control in your app.","pos":[464,646]},{"content":"For a list of the ad networks and project types currently supported by ad mediation, see <bpt id=\"p1\">[</bpt>Select and manage your ad networks<ept id=\"p1\">](select-and-manage-your-ad-networks.md)</ept>.","pos":[647,812]},{"content":"Add the ad mediator control to your project","pos":[817,860]},{"content":"To add an instance of the ad mediator control to your project:","pos":[863,925]},{"content":"In Visual Studio, open your project.","pos":[931,967]},{"pos":[972,1218],"content":"If you're adding ad mediation to an app which is already monetizing with any of the <bpt id=\"p1\">[</bpt>ad networks<ept id=\"p1\">](select-and-manage-your-ad-networks.md)</ept> supported by ad mediation, remove the existing ad implementation and all of its references before proceeding."},{"pos":[1223,1362],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, locate the page in your app where you want to show ads and then double-click the page to open it in the designer."},{"content":"From the <bpt id=\"p1\">**</bpt>Toolbox<ept id=\"p1\">**</ept>, drag a new <bpt id=\"p2\">**</bpt>AdMediatorControl<ept id=\"p2\">**</ept> into the designer (be sure to drag the control into the designer, not into your XAML code).","pos":[1367,1513]},{"content":"Position the control in the location where you'd like your ads to display.","pos":[1514,1588]},{"content":"You can add multiple controls if you want to display ads in more than one area of your app.","pos":[1589,1680]},{"pos":[1686,1762],"content":"The <bpt id=\"p1\">**</bpt>AdMediatorControl<ept id=\"p1\">**</ept> is located in the following <bpt id=\"p2\">**</bpt>Toolbox<ept id=\"p2\">**</ept> locations:"},{"pos":[1772,1892],"content":"In a Universal Windows Platform (UWP) project, use the <bpt id=\"p1\">**</bpt>AdMediatorControl<ept id=\"p1\">**</ept> under the <bpt id=\"p2\">**</bpt>AdMediator Universal<ept id=\"p2\">**</ept> section."},{"pos":[1901,2046],"content":"In a Windows 8.1 or Windows Phone 8.1 project using C# or Visual Basic with XAML, use the <bpt id=\"p1\">**</bpt>AdMediatorControl<ept id=\"p1\">**</ept> under the <bpt id=\"p2\">**</bpt>AdMediator<ept id=\"p2\">**</ept> section."},{"pos":[2055,2174],"content":"In a Windows Phone Silverlight project, use the <bpt id=\"p1\">**</bpt>AdMediatorControl<ept id=\"p1\">**</ept> under the <bpt id=\"p2\">**</bpt>All Windows Phone Controls<ept id=\"p2\">**</ept> section."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  When you drag the <bpt id=\"p2\">**</bpt>AdMediatorControl<ept id=\"p2\">**</ept> control to the designer for the first time in a UWP, Windows 8.1, or Windows Phone 8.1 project using C# or Visual Basic with XAML, Visual Studio adds the required ad mediator assembly reference to your project, but the control isn't added to the designer yet.","pos":[2182,2491]},{"content":"To add the control, click OK in the message displayed by Visual Studio, wait several seconds for the designer to refresh, and then drag the control back to the designer again.","pos":[2492,2667]},{"content":"If you still can't successfully add the control to the designer, make sure your project targets the applicable processor architecture for your app (for example, <bpt id=\"p1\">**</bpt>x86<ept id=\"p1\">**</ept>) rather than <bpt id=\"p2\">**</bpt>Any CPU<ept id=\"p2\">**</ept>.","pos":[2668,2862]},{"content":"The control cannot be added to the designer if the project targets <bpt id=\"p1\">**</bpt>Any CPU<ept id=\"p1\">**</ept> for the build platform.","pos":[2863,2965]},{"content":"Visual Studio adds an ad mediator assembly reference to your project and inserts XAML for the ad mediator control into the current page, including a unique ID and a name for the control.","pos":[2971,3157]},{"content":"The assembly reference and the XAML varies depending on your target platform.","pos":[3158,3235]},{"content":"For example, for a Universal Windows Platform (UWP) app the assembly name is <bpt id=\"p1\">**</bpt>Microsoft.AdMediator.Universal<ept id=\"p1\">**</ept>, and the generated XAML is similar to the following example.","pos":[3236,3408]},{"content":"The <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> element helps you to identify the specific control in your app when you configure your ad mediation.","pos":[3855,3968]},{"content":"You can change this to whatever you’d like, but be sure not to change or duplicate the <bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept> element.","pos":[3969,4071]},{"content":"This <bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept> must be unique for each control within your app.","pos":[4072,4132]},{"content":"Adjust the size and position of the control as necessary.","pos":[4138,4195]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Adjust size and position<ept id=\"p1\">](#adjust-size-and-position)</ept>.","pos":[4196,4276]},{"content":"Configure ad networks","pos":[4281,4302]},{"content":"After you’ve added all the controls you’d like, you’re ready to configure the ad networks through Connected Services.","pos":[4304,4421]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  If you add an additional AdMediatorControl later, you’ll need to configure it through Connected Services again.","pos":[4425,4551]},{"content":"Otherwise, the new control will not be able to use ad mediation.","pos":[4552,4616]},{"content":"To configure the ad networks:","pos":[4618,4647]},{"content":"Right-click the name of the project in Solution Explorer, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Connected Service…<ept id=\"p2\">**</ept>","pos":[4653,4763]},{"content":"to launch the <bpt id=\"p1\">**</bpt>Add Connected Service<ept id=\"p1\">**</ept> window (Visual Studio 2015) or <bpt id=\"p2\">**</bpt>Services Manager<ept id=\"p2\">**</ept> window (Visual Studio 2013).","pos":[4764,4884]},{"content":"If you are using Visual Studio 2015, click <bpt id=\"p1\">**</bpt>Ad Mediator<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Configure<ept id=\"p2\">**</ept> to open the <bpt id=\"p3\">**</bpt>Ad Mediator<ept id=\"p3\">**</ept> window.","pos":[4889,5012]},{"content":"If you are using Visual Studio 2013, simply click <bpt id=\"p1\">**</bpt>Ad Mediator<ept id=\"p1\">**</ept> in the left pane of the <bpt id=\"p2\">**</bpt>Services Manager<ept id=\"p2\">**</ept>.","pos":[5013,5124]},{"content":"The AdMediator.config file is added to your project.","pos":[5130,5182]},{"content":"This file is where initial ad network configuration settings are saved locally in your project.","pos":[5183,5278]},{"pos":[5284,5505],"content":"In the <bpt id=\"p1\">**</bpt>Ad Mediator<ept id=\"p1\">**</ept> (Visual Studio 2015) or <bpt id=\"p2\">**</bpt>Services Manager<ept id=\"p2\">**</ept> (Visual Studio 2013) window, click <bpt id=\"p3\">**</bpt>Select ad networks<ept id=\"p3\">**</ept>, select the ad networks you want to use, and click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept> in the <bpt id=\"p5\">**</bpt>Select ad networks<ept id=\"p5\">**</ept> window."},{"content":"<bpt id=\"p1\">**</bpt>Tip<ept id=\"p1\">**</ept>  It’s a good idea to add all the networks that you have accounts with, even if you don’t plan to use all of them in your app right away.","pos":[5513,5657]},{"content":"After the app is published, you'll be able configure how often each network is used in Dev Center (or start to use a network you hadn't before) without having to make code changes and resubmit the app.","pos":[5658,5859]},{"content":"Visual Studio fetches the required assemblies for the selected ad networks and adds those assembly references to your project.","pos":[5865,5991]},{"content":"After this process is complete, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Fetching Status<ept id=\"p2\">**</ept> dialog box.","pos":[5992,6075]},{"content":"In the <bpt id=\"p1\">**</bpt>Ad Mediator<ept id=\"p1\">**</ept> (Visual Studio 2015) or <bpt id=\"p2\">**</bpt>Services Manager<ept id=\"p2\">**</ept> (Visual Studio 2013) window, optionally select each network and click <bpt id=\"p3\">**</bpt>Configure<ept id=\"p3\">**</ept> to enter the configuration information for each network to use while testing the app.","pos":[6081,6318]},{"content":"This information is saved to the AdMediator.config file in your project.","pos":[6319,6391]},{"content":"You'll be able to modify this information when you configure ad network behavior on the Windows Dev Center dashboard.","pos":[6392,6509]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Submitting your app and configuring ad mediation<ept id=\"p1\">](submit-your-app-and-configure-ad-mediation.md)</ept>.","pos":[6510,6634]},{"pos":[6641,6918],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  If you do not enter configuration information during this step, ad mediation will automatically use test configuration values when you run your app on your development computer (for UWP and Windows 8.1 XAML apps) or on the emulator or device (for Windows Phone apps)."},{"content":"In the <bpt id=\"p1\">**</bpt>Ad Mediator<ept id=\"p1\">**</ept> (Visual Studio 2015) or <bpt id=\"p2\">**</bpt>Services Manager<ept id=\"p2\">**</ept> (Visual Studio 2013) window, confirm that each ad network you have selected shows <bpt id=\"p3\">**</bpt>Fetched<ept id=\"p3\">**</ept>.","pos":[6924,7086]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to submit the changes to your project.","pos":[7087,7138]},{"pos":[7142,7374],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   If you later upgrade to a newer version of the Microsoft Store Engagement and Monetization SDK, you’ll need to launch <bpt id=\"p2\">**</bpt>Connected Services<ept id=\"p2\">**</ept> again to ensure any automatically fetched ad network DLLs are correctly updated."},{"content":"Declare required capabilities","pos":[7380,7409]},{"content":"Each ad network may require certain app capabilities.","pos":[7411,7464]},{"content":"These are shown by each provider in the <bpt id=\"p1\">**</bpt>Ad Mediator<ept id=\"p1\">**</ept> (for Visual Studio 2015) or <bpt id=\"p2\">**</bpt>Services Manager<ept id=\"p2\">**</ept> (for Visual Studio 2013) window.","pos":[7465,7602]},{"content":"Be sure to declare all of the required capabilities in your app's manifest so that the ads are properly displayed.","pos":[7603,7717]},{"content":"The following screenshot shows the required capabilities for several ad networks in a Windows 8.1 or Windows Phone 8.1 XAML app.","pos":[7719,7847]},{"content":"services manager showing all references fetched","pos":[7851,7898]},{"content":"The following screenshot shows the required capabilities for several ad networks in a Windows Phone 8.1 Silverlight app.","pos":[7922,8042]},{"content":"services manager showing all references fetched","pos":[8046,8093]},{"content":"Fetch ad network DLLs manually","pos":[8120,8150]},{"content":"In some cases, you may see that certain DLLs were not fetched.","pos":[8152,8214]},{"content":"In this case, you'll need to add them manually.","pos":[8215,8262]},{"content":"For links to download individual assemblies, see <bpt id=\"p1\">[</bpt>Selecting and managing your ad networks<ept id=\"p1\">](select-and-manage-your-ad-networks.md)</ept>.","pos":[8263,8393]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  When adding DLLs manually, you may get an error message saying \"A reference to a higher version or incompatible assembly cannot be added to the project.\"","pos":[8397,8560]},{"content":"To resolve this error, right-click the DLL in Explorer and then select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","pos":[8561,8647]},{"content":"In the Security section, click <bpt id=\"p1\">**</bpt>Unblock<ept id=\"p1\">**</ept>.","pos":[8648,8691]},{"content":"unblock button for resolving error message","pos":[8695,8737]},{"content":"Adjust size and position","pos":[8763,8787]},{"content":"You can configure the size and position of the ad mediator control in the designer or in your XAML code.","pos":[8789,8893]},{"content":"Make sure that this size will be large enough to fit all the ads you'll be displaying from your ad networks.","pos":[8894,9002]},{"content":"Some ad networks may not serve an ad if they detect that the canvas size isn't large enough for the ad to display in full.","pos":[9003,9125]},{"content":"If any of your ad units will be larger than the default size, you can adjust the canvas size to accommodate your largest ad.","pos":[9126,9250]},{"content":"When you drag the control to the designer, the default control sizes are:","pos":[9252,9325]},{"content":"UWP and Windows 8.1 XAML: 300 width x 250 height.","pos":[9331,9380]},{"content":"Windows Phone 8.1 XAML: 400 width x 67 height.","pos":[9385,9431]},{"content":"Windows Phone 8 and Windows Phone 8.1 Silverlight: 480 width x 80 height.","pos":[9436,9509]},{"pos":[9511,9620],"content":"You can override the default ad sizes using the <bpt id=\"p1\">**</bpt>Width<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Height<ept id=\"p2\">**</ept> optional parameters, as shown below."},{"content":"You can also specify how each control is positioned to accommodate a variety of sizes and placements depending on your app's needs.","pos":[9795,9926]},{"content":"For some ad networks, you can use optional parameters to make adjustments.","pos":[9927,10001]},{"content":"For example, to align ads from Microsoft advertising to the bottom left:","pos":[10002,10074]},{"content":"Supported ad sizes for Microsoft advertising","pos":[10349,10393]},{"content":"Microsoft advertising only supports ads in the following standard sizes recommended by the Interactive Advertising Bureau (IAB) for apps running on the following platforms.","pos":[10395,10567]},{"content":"Windows 10 and Windows 8.1:","pos":[10573,10600]},{"content":"160 x 600","pos":[10609,10618]},{"content":"300 x 250","pos":[10627,10636]},{"content":"300 x 600","pos":[10645,10654]},{"content":"728 x 90","pos":[10663,10671]},{"content":"Windows 10 Mobile, Windows Phone 8.1 and Windows Phone 8:","pos":[10676,10733]},{"content":"300 x 50","pos":[10742,10750]},{"content":"320 x 50","pos":[10759,10767]},{"content":"480 x 80 (This size is supported for Windows Phone Silverlight only)","pos":[10776,10844]},{"content":"640 x 100","pos":[10853,10862]},{"content":"You might want to specify an ad mediator control size that doesn't match one of the ad sizes supported by Microsoft advertising (for example, you might want to do this if a different size is a better fit for your app's UI, or if you are also targeting other ad networks that support other ad sizes).","pos":[10864,11163]},{"content":"To do this, specify the exact control size you want in the designer or in your XAML code, and then assign the <bpt id=\"p1\">**</bpt>Width<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Height<ept id=\"p2\">**</ept> optional parameters for Microsoft advertising to the closest supported size that will fit within the bounds of the control.","pos":[11164,11422]},{"content":"The control will display to the exact size you specify in the designer, but Microsoft advertising will serve ads that match the size you specify using the <bpt id=\"p1\">**</bpt>Width<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Height<ept id=\"p2\">**</ept> optional parameters.","pos":[11423,11623]},{"content":"For example, if you have a UWP app and you want your ad mediator control to display at 300 x 300, set the control to 300 x 300 in the designer or in your XAML code.","pos":[11625,11789]},{"content":"Then, assign the <bpt id=\"p1\">**</bpt>Width<ept id=\"p1\">**</ept> optional parameter to 300 and the <bpt id=\"p2\">**</bpt>Height<ept id=\"p2\">**</ept> optional parameter to 250 for Microsoft advertising, as shown in the following code.","pos":[11790,11946]},{"pos":[12150,12378],"content":"To verify that your size settings are compatible with Microsoft Advertising, <bpt id=\"p1\">[</bpt>test your ad mediation implementation<ept id=\"p1\">](test-your-ad-mediation-implementation.md)</ept> and make sure that test ads from Microsoft Advertising are displayed."},{"content":"Pause, resume, and disable ad mediation","pos":[12383,12422]},{"content":"If you’d like to pause ad mediation for any given amount of time during the app runtime, use the AdMediatorControl.Pause() method.","pos":[12424,12554]},{"content":"Note that when you do this, the most recent ad will continue showing until you resume mediation by calling the AdMediatorControl.Resume() method.","pos":[12555,12700]},{"content":"To disable the ad mediator completely, use the AdMediatorControl.Disable() method.","pos":[12702,12784]},{"content":"This will remove any ads that are showing, and it will minimize the memory footprint of the mediator.","pos":[12785,12886]},{"content":"You can call AdMediatorControl.Resume() to resume mediation, but note that startup time will be slower than usual after ad mediation has been disabled.","pos":[12887,13038]},{"content":"Set timeouts","pos":[13043,13055]},{"content":"You can specify the number of seconds (from 2-60) for which ad mediation should wait after requesting an ad from that ad network before abandoning that request and making a request to another network instead.","pos":[13057,13265]},{"content":"By default, the timeout for all ad networks is 15 seconds.","pos":[13266,13324]},{"content":"The code below shows how to specify a timeout duration for Microsoft Advertising.","pos":[13326,13407]},{"content":"You can modify the durations and networks as needed.","pos":[13408,13460]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  You can alternatively set the timeout value in the <bpt id=\"p2\">**</bpt>Monetize with ads<ept id=\"p2\">**</ept> page on the Dev Center dashboard.","pos":[13574,13690]},{"content":"If you set the timeout in code and in the dashboard, that value you set in code overrides the dashboard value.","pos":[13691,13801]},{"content":"Event handling","pos":[13806,13820]},{"content":"Adding code to log events and capture ad mediation errors can help with troubleshooting.","pos":[13822,13910]},{"content":"The code sample below adds event handlers for specific events from a control.","pos":[13911,13988]},{"content":"Handle unhandled exceptions from ad networks","pos":[15243,15287]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  As part of our testing, we've identified a number of unhandled exceptions from specific ad networks that must be handled within the app to avoid app crashes related to these exceptions.","pos":[15291,15486]},{"content":"We highly recommend that you copy and paste the code sample below to your App.xaml.cs file.","pos":[15487,15578]},{"content":"Code to use for a UWP, Windows 8.1 or a Windows Phone app using C# and XAML","pos":[15580,15655]},{"content":"Code to use for a Windows Phone Silverlight app","pos":[16395,16442]},{"content":"Related topics","pos":[18128,18142]},{"content":"Select and manage your ad networks","pos":[18147,18181]},{"content":"Test your ad mediation implementation","pos":[18225,18262]},{"content":"Submit your app and configure ad mediation","pos":[18309,18351]},{"content":"Troubleshoot ad mediation","pos":[18403,18428]}],"content":"---\nauthor: mcleanbyron\nms.assetid: 3C03FDD8-FA61-4E7B-BDCA-3C29DFEA20E4\ndescription: After you install the Microsoft Store Engagement and Monetization SDK, follow the instructions in this topic to use the ad mediator control in your app.\ntitle: Add and use the ad mediator control\n---\n\n# Add and use the ad mediator control\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\nAfter you [install the Microsoft Store Engagement and Monetization SDK](http://aka.ms/store-em-sdk), follow the instructions in this topic to use the ad mediator control in your app. For a list of the ad networks and project types currently supported by ad mediation, see [Select and manage your ad networks](select-and-manage-your-ad-networks.md).\n\n## Add the ad mediator control to your project\n\n\nTo add an instance of the ad mediator control to your project:\n\n1.  In Visual Studio, open your project.\n2.  If you're adding ad mediation to an app which is already monetizing with any of the [ad networks](select-and-manage-your-ad-networks.md) supported by ad mediation, remove the existing ad implementation and all of its references before proceeding.\n3.  In **Solution Explorer**, locate the page in your app where you want to show ads and then double-click the page to open it in the designer.\n4.  From the **Toolbox**, drag a new **AdMediatorControl** into the designer (be sure to drag the control into the designer, not into your XAML code). Position the control in the location where you'd like your ads to display. You can add multiple controls if you want to display ads in more than one area of your app.\n\n    The **AdMediatorControl** is located in the following **Toolbox** locations:\n\n    -   In a Universal Windows Platform (UWP) project, use the **AdMediatorControl** under the **AdMediator Universal** section.\n    -   In a Windows 8.1 or Windows Phone 8.1 project using C# or Visual Basic with XAML, use the **AdMediatorControl** under the **AdMediator** section.\n    -   In a Windows Phone Silverlight project, use the **AdMediatorControl** under the **All Windows Phone Controls** section.\n\n    > **Note**  When you drag the **AdMediatorControl** control to the designer for the first time in a UWP, Windows 8.1, or Windows Phone 8.1 project using C# or Visual Basic with XAML, Visual Studio adds the required ad mediator assembly reference to your project, but the control isn't added to the designer yet. To add the control, click OK in the message displayed by Visual Studio, wait several seconds for the designer to refresh, and then drag the control back to the designer again. If you still can't successfully add the control to the designer, make sure your project targets the applicable processor architecture for your app (for example, **x86**) rather than **Any CPU**. The control cannot be added to the designer if the project targets **Any CPU** for the build platform.\n\n5.  Visual Studio adds an ad mediator assembly reference to your project and inserts XAML for the ad mediator control into the current page, including a unique ID and a name for the control. The assembly reference and the XAML varies depending on your target platform. For example, for a Universal Windows Platform (UWP) app the assembly name is **Microsoft.AdMediator.Universal**, and the generated XAML is similar to the following example.\n\n    ```xml\n    // Code that gets added to the XAML page header\n    xmlns:Universal=\"using:Microsoft.AdMediator.Universal\"\n\n    // Code that gets added for the ad mediator control\n    <Universal:AdMediatorControl x:Name=\"AdMediator_3D4884\"\n      Grid.ColumnSpan=\"2\" HorizontalAlignment=\"Left\" Height=\"250\"\n      Id=\"AdMediator-Id-D1FDFDA7-EABB-474C-940C-ECA7FBCFF143\" Margin=\"121,175,0,0\"\n      VerticalAlignment=\"Top\" Width=\"300\"/>\n    ```\n\n    The **Name** element helps you to identify the specific control in your app when you configure your ad mediation. You can change this to whatever you’d like, but be sure not to change or duplicate the **Id** element. This **Id** must be unique for each control within your app.\n\n6.  Adjust the size and position of the control as necessary. For more information, see [Adjust size and position](#adjust-size-and-position).\n\n## Configure ad networks\n\nAfter you’ve added all the controls you’d like, you’re ready to configure the ad networks through Connected Services.\n\n> **Important**  If you add an additional AdMediatorControl later, you’ll need to configure it through Connected Services again. Otherwise, the new control will not be able to use ad mediation.\n\nTo configure the ad networks:\n\n1.  Right-click the name of the project in Solution Explorer, click **Add**, and then click **Connected Service…** to launch the **Add Connected Service** window (Visual Studio 2015) or **Services Manager** window (Visual Studio 2013).\n2.  If you are using Visual Studio 2015, click **Ad Mediator** and then click **Configure** to open the **Ad Mediator** window. If you are using Visual Studio 2013, simply click **Ad Mediator** in the left pane of the **Services Manager**.\n\n    The AdMediator.config file is added to your project. This file is where initial ad network configuration settings are saved locally in your project.\n\n3.  In the **Ad Mediator** (Visual Studio 2015) or **Services Manager** (Visual Studio 2013) window, click **Select ad networks**, select the ad networks you want to use, and click **OK** in the **Select ad networks** window.\n\n    > **Tip**  It’s a good idea to add all the networks that you have accounts with, even if you don’t plan to use all of them in your app right away. After the app is published, you'll be able configure how often each network is used in Dev Center (or start to use a network you hadn't before) without having to make code changes and resubmit the app.\n\n    Visual Studio fetches the required assemblies for the selected ad networks and adds those assembly references to your project. After this process is complete, click **OK** in the **Fetching Status** dialog box.\n\n4.  In the **Ad Mediator** (Visual Studio 2015) or **Services Manager** (Visual Studio 2013) window, optionally select each network and click **Configure** to enter the configuration information for each network to use while testing the app. This information is saved to the AdMediator.config file in your project. You'll be able to modify this information when you configure ad network behavior on the Windows Dev Center dashboard. For more information, see [Submitting your app and configuring ad mediation](submit-your-app-and-configure-ad-mediation.md).\n    > **Note**  If you do not enter configuration information during this step, ad mediation will automatically use test configuration values when you run your app on your development computer (for UWP and Windows 8.1 XAML apps) or on the emulator or device (for Windows Phone apps).\n\n5.  In the **Ad Mediator** (Visual Studio 2015) or **Services Manager** (Visual Studio 2013) window, confirm that each ad network you have selected shows **Fetched**. Click **OK** to submit the changes to your project.\n\n> **Note**   If you later upgrade to a newer version of the Microsoft Store Engagement and Monetization SDK, you’ll need to launch **Connected Services** again to ensure any automatically fetched ad network DLLs are correctly updated.\n\n### Declare required capabilities\n\nEach ad network may require certain app capabilities. These are shown by each provider in the **Ad Mediator** (for Visual Studio 2015) or **Services Manager** (for Visual Studio 2013) window. Be sure to declare all of the required capabilities in your app's manifest so that the ads are properly displayed.\n\nThe following screenshot shows the required capabilities for several ad networks in a Windows 8.1 or Windows Phone 8.1 XAML app.\n\n![services manager showing all references fetched](images/ad-med-8.jpg)\n\nThe following screenshot shows the required capabilities for several ad networks in a Windows Phone 8.1 Silverlight app.\n\n![services manager showing all references fetched](images/ad-med-6.jpg)\n### Fetch ad network DLLs manually\n\nIn some cases, you may see that certain DLLs were not fetched. In this case, you'll need to add them manually. For links to download individual assemblies, see [Selecting and managing your ad networks](select-and-manage-your-ad-networks.md).\n\n> **Note**  When adding DLLs manually, you may get an error message saying \"A reference to a higher version or incompatible assembly cannot be added to the project.\" To resolve this error, right-click the DLL in Explorer and then select **Properties**. In the Security section, click **Unblock**.\n\n![unblock button for resolving error message](images/ad-med-4.png)\n## Adjust size and position\n\nYou can configure the size and position of the ad mediator control in the designer or in your XAML code. Make sure that this size will be large enough to fit all the ads you'll be displaying from your ad networks. Some ad networks may not serve an ad if they detect that the canvas size isn't large enough for the ad to display in full. If any of your ad units will be larger than the default size, you can adjust the canvas size to accommodate your largest ad.\n\nWhen you drag the control to the designer, the default control sizes are:\n\n-   UWP and Windows 8.1 XAML: 300 width x 250 height.\n-   Windows Phone 8.1 XAML: 400 width x 67 height.\n-   Windows Phone 8 and Windows Phone 8.1 Silverlight: 480 width x 80 height.\n\nYou can override the default ad sizes using the **Width** and **Height** optional parameters, as shown below.\n\n```CSharp\nmyAdMediatorControl.AdSdkOptionalParameters[AdSdkNames.Smaato][\"Width\"] = 400;\nmyAdMediatorControl.AdSdkOptionalParameters[AdSdkNames.Smaato][\"Height\"] = 80;\n```\n\nYou can also specify how each control is positioned to accommodate a variety of sizes and placements depending on your app's needs. For some ad networks, you can use optional parameters to make adjustments. For example, to align ads from Microsoft advertising to the bottom left:\n\n```CSharp\nmyAdMediatorControl.AdSdkOptionalParameters[AdSdkNames.MicrosoftAdvertising][\"HorizontalAlignment\"] = HorizontalAlignment.Left;\nmyAdMediatorControl.AdSdkOptionalParameters[AdSdkNames.MicrosoftAdvertising][\"VerticalAlignment\"] = VerticalAlignment.Bottom;\n```\n\n### Supported ad sizes for Microsoft advertising\n\nMicrosoft advertising only supports ads in the following standard sizes recommended by the Interactive Advertising Bureau (IAB) for apps running on the following platforms.\n\n-   Windows 10 and Windows 8.1:\n    -   160 x 600\n    -   300 x 250\n    -   300 x 600\n    -   728 x 90\n-   Windows 10 Mobile, Windows Phone 8.1 and Windows Phone 8:\n    -   300 x 50\n    -   320 x 50\n    -   480 x 80 (This size is supported for Windows Phone Silverlight only)\n    -   640 x 100\n\nYou might want to specify an ad mediator control size that doesn't match one of the ad sizes supported by Microsoft advertising (for example, you might want to do this if a different size is a better fit for your app's UI, or if you are also targeting other ad networks that support other ad sizes). To do this, specify the exact control size you want in the designer or in your XAML code, and then assign the **Width** and **Height** optional parameters for Microsoft advertising to the closest supported size that will fit within the bounds of the control. The control will display to the exact size you specify in the designer, but Microsoft advertising will serve ads that match the size you specify using the **Width** and **Height** optional parameters.\n\nFor example, if you have a UWP app and you want your ad mediator control to display at 300 x 300, set the control to 300 x 300 in the designer or in your XAML code. Then, assign the **Width** optional parameter to 300 and the **Height** optional parameter to 250 for Microsoft advertising, as shown in the following code.\n\n```CSharp\nmyAdMediatorControl.AdSdkOptionalParameters[AdSdkNames.MicrosoftAdvertising][\"Width\"] = 300;\nmyAdMediatorControl.AdSdkOptionalParameters[AdSdkNames.MicrosoftAdvertising][\"Height\"] = 250;\n```\n\nTo verify that your size settings are compatible with Microsoft Advertising, [test your ad mediation implementation](test-your-ad-mediation-implementation.md) and make sure that test ads from Microsoft Advertising are displayed.\n\n## Pause, resume, and disable ad mediation\n\nIf you’d like to pause ad mediation for any given amount of time during the app runtime, use the AdMediatorControl.Pause() method. Note that when you do this, the most recent ad will continue showing until you resume mediation by calling the AdMediatorControl.Resume() method.\n\nTo disable the ad mediator completely, use the AdMediatorControl.Disable() method. This will remove any ads that are showing, and it will minimize the memory footprint of the mediator. You can call AdMediatorControl.Resume() to resume mediation, but note that startup time will be slower than usual after ad mediation has been disabled.\n\n## Set timeouts\n\nYou can specify the number of seconds (from 2-60) for which ad mediation should wait after requesting an ad from that ad network before abandoning that request and making a request to another network instead. By default, the timeout for all ad networks is 15 seconds.\n\nThe code below shows how to specify a timeout duration for Microsoft Advertising. You can modify the durations and networks as needed.\n\n```CSharp\nmyAdMediatorControl.AdSdkTimeouts[AdSdkNames.MicrosoftAdvertising] = TimeSpan.FromSeconds(10);\n```\n\n> **Note**  You can alternatively set the timeout value in the **Monetize with ads** page on the Dev Center dashboard. If you set the timeout in code and in the dashboard, that value you set in code overrides the dashboard value.\n\n## Event handling\n\nAdding code to log events and capture ad mediation errors can help with troubleshooting. The code sample below adds event handlers for specific events from a control.\n\n```CSharp\n// add this during initialization of your app\n\n    AdMediator_Bottom.AdSdkError += AdMediator_Bottom_AdError;\n    AdMediator_Bottom.AdMediatorFilled += AdMediator_Bottom_AdFilled;\n    AdMediator_Bottom.AdMediatorError += AdMediator_Bottom_AdMediatorError;\n    AdMediator_Bottom.AdSdkEvent += AdMediator_Bottom_AdSdkEvent;\n\n// and then add these functions\n\nvoid AdMediator_Bottom_AdSdkEvent(object sender, Microsoft.AdMediator.Core.Events.AdSdkEventArgs e)\n{\n    Debug.WriteLine(\"AdSdk event {0} by {1}\", e.EventName, e.Name);}\n\nvoid AdMediator_Bottom_AdMediatorError(object sender, Microsoft.AdMediator.Core.Events.AdMediatorFailedEventArgs e)\n{\n    Debug.WriteLine(\"AdMediatorError:\" + e.Error + \" \" + e.ErrorCode );\n    // if (e.ErrorCode == AdMediatorErrorCode.NoAdAvailable)\n    // AdMediator will not show an ad for this mediation cycle\n}\n\nvoid AdMediator_Bottom_AdFilled(object sender, Microsoft.AdMediator.Core.Events.AdSdkEventArgs e)\n{\n    Debug.WriteLine(\"AdFilled:\" + e.Name);\n}\n\nvoid AdMediator_Bottom_AdError(object sender, Microsoft.AdMediator.Core.Events.AdFailedEventArgs e)\n{\n    Debug.WriteLine(\"AdSdkError by {0} ErrorCode: {1} ErrorDescription: {2} Error: {3}\", e.Name, e.ErrorCode, e.ErrorDescription, e.Error);\n}\n```\n\n## Handle unhandled exceptions from ad networks\n\n> **Note**  As part of our testing, we've identified a number of unhandled exceptions from specific ad networks that must be handled within the app to avoid app crashes related to these exceptions. We highly recommend that you copy and paste the code sample below to your App.xaml.cs file.\n\nCode to use for a UWP, Windows 8.1 or a Windows Phone app using C# and XAML\n\n```CSharp\n// In App.xaml.cs file, register with the UnhandledException event handler.\nUnhandledException += App_UnhandledException;\n\nvoid App_UnhandledException(object sender, UnhandledExceptionEventArgs e)\n   {\n      if (e != null)\n      {\n         Exception exception = e.Exception;\n         if (exception is NullReferenceException && exception.ToString().ToUpper().Contains(\"SOMA\"))\n         {\n            Debug.WriteLine(\"Handled Smaato null reference exception {0}\", exception);\n            e.Handled = true;\n            return;\n         }\n      }\n// APP SPECIFIC HANDLING HERE\n\n   if (Debugger.IsAttached)\n      {\n         // An unhandled exception has occurred; break into the debugger\n         Debugger.Break();\n      }\n   }\n```\n\nCode to use for a Windows Phone Silverlight app\n\n```CSharp\n// In App.xaml.cs file, register with the UnhandledException event handler.\nUnhandledException += Application_UnhandledException;\n\n// Code to execute on unhandled exceptions\nprivate void Application_UnhandledException(object sender, ApplicationUnhandledExceptionEventArgs e)\n{\n    if (e != null)\n   {\n       Exception exception = e.ExceptionObject;\n       if ((exception is XmlException || exception is NullReferenceException) && exception.ToString().ToUpper().Contains(\"INNERACTIVE\"))\n       {\n           Debug.WriteLine(\"Handled Inneractive exception {0}\", exception);\n           e.Handled = true;\n           return;\n       }\n       else if (exception is NullReferenceException && exception.ToString().ToUpper().Contains(\"SOMA\"))\n       {\n           Debug.WriteLine(\"Handled Smaato null reference exception {0}\", exception);\n           e.Handled = true;\n           return;\n       }\n       else if ((exception is System.IO.IOException || exception is NullReferenceException) && exception.ToString().ToUpper().Contains(\"GOOGLE\"))\n      {\n          Debug.WriteLine(\"Handled Google exception {0}\", exception);\n          e.Handled = true;\n          return;\n       }\n       else if ((exception is NullReferenceException || exception is XamlParseException) && exception.ToString().ToUpper().Contains(\"MICROSOFT.ADVERTISING\"))\n       {\n           Debug.WriteLine(\"Handled Microsoft.Advertising exception {0}\", exception);\n           e.Handled = true;\n           return;\n       }\n\n   }\n// APP SPECIFIC HANDLING HERE\n\nif (Debugger.IsAttached)\n   {\n       // An unhandled exception has occurred; break into the debugger\n       Debugger.Break();\n   }\n   //e.Handled = true;\n}\n```\n\n## Related topics\n\n* [Select and manage your ad networks](select-and-manage-your-ad-networks.md)\n* [Test your ad mediation implementation](test-your-ad-mediation-implementation.md)\n* [Submit your app and configure ad mediation](submit-your-app-and-configure-ad-mediation.md)\n* [Troubleshoot ad mediation](troubleshoot-ad-mediation.md)\n \n\n \n"}