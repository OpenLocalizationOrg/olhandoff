{"nodes":[{"content":"author: mcleanbyron Description: Whether your app is free or not, you can sell content, other apps, or new app functionality (such as unlocking the next level of a game) from right within the app.","pos":[4,200]},{"content":"Here we show you how to enable these products in your app.","pos":[201,259]},{"content":"title: Enable in-app product purchases ms.assetid: D158E9EB-1907-4173-9889-66507957BD6B keywords: in-app offer keywords: in-app purchase keywords: in-app product keywords: how to support in-app keywords: in-app purchase code sample keywords: in-app offer code sample","pos":[260,526]},{"content":"Enable in-app product purchases","pos":[534,565]},{"content":"Updated for UWP apps on Windows 10.","pos":[570,605]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[606,698]},{"content":"Whether your app is free or not, you can sell content, other apps, or new app functionality (such as unlocking the next level of a game) from right within the app.","pos":[703,866]},{"content":"Here we show you how to enable these products in your app.","pos":[867,925]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  In-app products cannot be offered from a trial version of an app.","pos":[929,1004]},{"content":"Customers using a trial version of your app can only buy an in-app product if they purchase a full version of your app.","pos":[1005,1124]},{"content":"Prerequisites","pos":[1129,1142]},{"content":"A Windows app in which to add features for customers to buy.","pos":[1148,1208]},{"content":"When you code and test new in-app products for the first time, you must use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CurrentAppSimulator<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh779766)</ept> object instead of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CurrentApp<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh779765)</ept> object.","pos":[1213,1481]},{"content":"This way you can verify your license logic using simulated calls to the license server instead of calling the live server.","pos":[1482,1604]},{"content":"To do this, you need to customize the file named \"WindowsStoreProxy.xml\" in %userprofile%<ph id=\"ph1\">\\\\</ph>AppData<ph id=\"ph2\">\\\\</ph>local<ph id=\"ph3\">\\\\</ph>packages<ph id=\"ph4\">\\\\&amp;lt;</ph>package name<ph id=\"ph5\">&amp;gt;\\\\</ph>LocalState<ph id=\"ph6\">\\\\</ph>Microsoft<ph id=\"ph7\">\\\\</ph>Windows Store<ph id=\"ph8\">\\\\</ph>ApiData.","pos":[1605,1790]},{"content":"The Microsoft Visual Studio simulator creates this file when you run your app for the first timeâ€”or you can also load a custom one at runtime.","pos":[1791,1933]},{"content":"For more info, see <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CurrentAppSimulator<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh779766)</ept>.","pos":[1934,2037]},{"content":"This topic also references code examples provided in the <bpt id=\"p1\">[</bpt>Store sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkID=627610)</ept>.","pos":[2042,2163]},{"content":"This sample is a great way to get hands-on experience with the different monetization options provided for Universal Windows Platform (UWP) apps.","pos":[2164,2309]},{"content":"Step 1: Initialize the license info for your app","pos":[2314,2362]},{"pos":[2364,2729],"content":"When your app is initializing, get the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>LicenseInformation<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br225157)</ept> object for your app by initializing the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CurrentApp<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh779765)</ept> or <bpt id=\"p5\">[</bpt><bpt id=\"p6\">**</bpt>CurrentAppSimulator<ept id=\"p6\">**</ept><ept id=\"p5\">](https://msdn.microsoft.com/library/windows/apps/hh779766)</ept> to enable purchases of an in-app product."},{"content":"Step 2: Add the in-app offers to your app","pos":[3127,3168]},{"content":"For each feature that you want to make available through an in-app product, create an offer and add it to your app.","pos":[3170,3285]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  You must add all the in-app products that you want to present to your customers to your app before you submit it to the Store.","pos":[3289,3430]},{"content":"If you want to add new in-app products later, you must update your app and re-submit a new version.","pos":[3431,3530]},{"content":"Create an in-app offer token","pos":[3538,3566]},{"content":"You identify each in-app product in your app by a token.","pos":[3574,3630]},{"content":"This token is a string that you define and use in your app and in the Store to identify a specific in-app product.","pos":[3631,3745]},{"content":"Give it a unique (to your app) and meaningful name so that you can quickly identify the correct feature it represents while you are coding.","pos":[3746,3885]},{"content":"Here are some examples of names:","pos":[3886,3918]},{"content":"\"SpaceMissionLevel4\"","pos":[3928,3948]},{"content":"\"ContosoCloudSave\"","pos":[3962,3980]},{"content":"\"RainbowThemePack\"","pos":[3994,4012]},{"content":"Code the feature in a conditional block","pos":[4020,4059]},{"content":"You must put the code for each feature that is associated with an in-app product in a conditional block that tests to see if the customer has a license to use that feature.","pos":[4067,4239]},{"content":"Here's an example that shows how you can code a product feature named <bpt id=\"p1\">**</bpt>featureName<ept id=\"p1\">**</ept> in a license-specific conditional block.","pos":[4245,4371]},{"content":"The string, <bpt id=\"p1\">**</bpt>featureName<ept id=\"p1\">**</ept>, is the token that uniquely identifies this product within the app and is also used to identify it in the Store.","pos":[4372,4512]},{"content":"Add the purchase UI for this feature","pos":[4749,4785]},{"content":"Your app must also provide a way for your customers to purchase the product or feature offered by the in-app product.","pos":[4793,4910]},{"content":"They can't purchase them through the Store in the same way they purchased the full app.","pos":[4911,4998]},{"content":"Here's how to test to see if your customer already owns an in-app product and, if they don't, displays the purchase dialog so they can buy it.","pos":[5004,5146]},{"content":"Replace the comment \"show the purchase dialog\" with your custom code for the purchase dialog (such as a page with a friendly \"Buy this app!\"","pos":[5147,5287]},{"content":"button).","pos":[5288,5296]},{"content":"Step 3: Change the test code to the final calls","pos":[6055,6102]},{"content":"This is an easy step: change every reference to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CurrentAppSimulator<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh779766)</ept> to <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>CurrentApp<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh779765)</ept> in your app's code.","pos":[6104,6333]},{"content":"You don't need to provide the WindowsStoreProxy.xml file any longer, so remove it from your app's path (although you may want to save it for reference when you configure the in-app offer in the next step).","pos":[6334,6539]},{"content":"Step 4: Configure the in-app product offer in the Store","pos":[6544,6599]},{"content":"In the Dev Center dashboard, define the product ID, type, price, and other properties for your in-app product.","pos":[6601,6711]},{"content":"Make sure that you configure it identically to the configuration you set in WindowsStoreProxy.xml when testing.","pos":[6712,6823]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>IAP submissions<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt148551)</ept>.","pos":[6824,6926]},{"content":"Remarks","pos":[6931,6938]},{"pos":[6940,7218],"content":"If you're interested in providing your customers with consumable in-app product options (items that can be purchased, used up, and then purchased again if desired), move on to the <bpt id=\"p1\">[</bpt>Enable consumable in-app product purchases<ept id=\"p1\">](enable-consumable-in-app-product-purchases.md)</ept> topic."},{"pos":[7220,7399],"content":"If you need to use receipts to verify that user made an in-app purchase, be sure to review <bpt id=\"p1\">[</bpt>Use receipts to verify product purchases<ept id=\"p1\">](use-receipts-to-verify-product-purchases.md)</ept>."},{"content":"Related topics","pos":[7404,7418]},{"content":"Enable consumable in-app product purchases","pos":[7424,7466]},{"content":"Manage a large catalog of in-app products","pos":[7518,7559]},{"content":"Use receipts to verify product purchases","pos":[7610,7650]},{"content":"Store sample (demonstrates trials and in-app purchases)","pos":[7700,7755]}],"content":"---\nauthor: mcleanbyron\nDescription: Whether your app is free or not, you can sell content, other apps, or new app functionality (such as unlocking the next level of a game) from right within the app. Here we show you how to enable these products in your app.\ntitle: Enable in-app product purchases\nms.assetid: D158E9EB-1907-4173-9889-66507957BD6B\nkeywords: in-app offer\nkeywords: in-app purchase\nkeywords: in-app product\nkeywords: how to support in-app\nkeywords: in-app purchase code sample\nkeywords: in-app offer code sample\n---\n\n# Enable in-app product purchases\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\nWhether your app is free or not, you can sell content, other apps, or new app functionality (such as unlocking the next level of a game) from right within the app. Here we show you how to enable these products in your app.\n\n> **Note**  In-app products cannot be offered from a trial version of an app. Customers using a trial version of your app can only buy an in-app product if they purchase a full version of your app.\n\n## Prerequisites\n\n-   A Windows app in which to add features for customers to buy.\n-   When you code and test new in-app products for the first time, you must use the [**CurrentAppSimulator**](https://msdn.microsoft.com/library/windows/apps/hh779766) object instead of the [**CurrentApp**](https://msdn.microsoft.com/library/windows/apps/hh779765) object. This way you can verify your license logic using simulated calls to the license server instead of calling the live server. To do this, you need to customize the file named \"WindowsStoreProxy.xml\" in %userprofile%\\\\AppData\\\\local\\\\packages\\\\&lt;package name&gt;\\\\LocalState\\\\Microsoft\\\\Windows Store\\\\ApiData. The Microsoft Visual Studio simulator creates this file when you run your app for the first timeâ€”or you can also load a custom one at runtime. For more info, see [**CurrentAppSimulator**](https://msdn.microsoft.com/library/windows/apps/hh779766).\n-   This topic also references code examples provided in the [Store sample](http://go.microsoft.com/fwlink/p/?LinkID=627610). This sample is a great way to get hands-on experience with the different monetization options provided for Universal Windows Platform (UWP) apps.\n\n## Step 1: Initialize the license info for your app\n\nWhen your app is initializing, get the [**LicenseInformation**](https://msdn.microsoft.com/library/windows/apps/br225157) object for your app by initializing the [**CurrentApp**](https://msdn.microsoft.com/library/windows/apps/hh779765) or [**CurrentAppSimulator**](https://msdn.microsoft.com/library/windows/apps/hh779766) to enable purchases of an in-app product.\n\n```CSharp\nvoid AppInit()\n{\n    // some app initialization functions \n\n    // Get the license info\n    // The next line is commented out for testing.\n    // licenseInformation = CurrentApp.LicenseInformation;\n\n    // The next line is commented out for production/release.       \n    licenseInformation = CurrentAppSimulator.LicenseInformation;\n\n    // other app initialization functions\n}\n```\n\n## Step 2: Add the in-app offers to your app\n\nFor each feature that you want to make available through an in-app product, create an offer and add it to your app.\n\n> **Important**  You must add all the in-app products that you want to present to your customers to your app before you submit it to the Store. If you want to add new in-app products later, you must update your app and re-submit a new version.\n\n1.  **Create an in-app offer token**\n\n    You identify each in-app product in your app by a token. This token is a string that you define and use in your app and in the Store to identify a specific in-app product. Give it a unique (to your app) and meaningful name so that you can quickly identify the correct feature it represents while you are coding. Here are some examples of names:\n\n    -   \"SpaceMissionLevel4\"\n    \n    -   \"ContosoCloudSave\"\n    \n    -   \"RainbowThemePack\"\n\n2.  **Code the feature in a conditional block**\n\n    You must put the code for each feature that is associated with an in-app product in a conditional block that tests to see if the customer has a license to use that feature.\n\n    Here's an example that shows how you can code a product feature named **featureName** in a license-specific conditional block. The string, **featureName**, is the token that uniquely identifies this product within the app and is also used to identify it in the Store.\n\n    ```    CSharp\n    if (licenseInformation.ProductLicenses[\"featureName\"].IsActive) \n    {\n        // the customer can access this feature\n    } \n    else\n    {\n        // the customer can' t access this feature\n    }\n    ```\n\n3.  **Add the purchase UI for this feature**\n\n    Your app must also provide a way for your customers to purchase the product or feature offered by the in-app product. They can't purchase them through the Store in the same way they purchased the full app.\n\n    Here's how to test to see if your customer already owns an in-app product and, if they don't, displays the purchase dialog so they can buy it. Replace the comment \"show the purchase dialog\" with your custom code for the purchase dialog (such as a page with a friendly \"Buy this app!\" button).\n\n    ```    CSharp\n    void BuyFeature1() \n    {\n        if (!licenseInformation.ProductLicenses[\"featureName\"].IsActive)\n        {\n            try\n            {\n                // The customer doesn't own this feature, so \n                // show the purchase dialog.\n                await CurrentAppSimulator.RequestProductPurchaseAsync(\"featureName\", false);\n        \n                //Check the license state to determine if the in-app purchase was successful.\n            }\n            catch (Exception)\n            {\n                // The in-app purchase was not completed because \n                // an error occurred.\n            }\n        } \n        else\n        {\n            // The customer already owns this feature.\n        }\n    }\n    ```\n\n## Step 3: Change the test code to the final calls\n\nThis is an easy step: change every reference to [**CurrentAppSimulator**](https://msdn.microsoft.com/library/windows/apps/hh779766) to [**CurrentApp**](https://msdn.microsoft.com/library/windows/apps/hh779765) in your app's code. You don't need to provide the WindowsStoreProxy.xml file any longer, so remove it from your app's path (although you may want to save it for reference when you configure the in-app offer in the next step).\n\n## Step 4: Configure the in-app product offer in the Store\n\nIn the Dev Center dashboard, define the product ID, type, price, and other properties for your in-app product. Make sure that you configure it identically to the configuration you set in WindowsStoreProxy.xml when testing. For more information, see [IAP submissions](https://msdn.microsoft.com/library/windows/apps/mt148551).\n\n## Remarks\n\nIf you're interested in providing your customers with consumable in-app product options (items that can be purchased, used up, and then purchased again if desired), move on to the [Enable consumable in-app product purchases](enable-consumable-in-app-product-purchases.md) topic.\n\nIf you need to use receipts to verify that user made an in-app purchase, be sure to review [Use receipts to verify product purchases](use-receipts-to-verify-product-purchases.md).\n\n## Related topics\n\n\n* [Enable consumable in-app product purchases](enable-consumable-in-app-product-purchases.md)\n* [Manage a large catalog of in-app products](manage-a-large-catalog-of-in-app-products.md)\n* [Use receipts to verify product purchases](use-receipts-to-verify-product-purchases.md)\n* [Store sample (demonstrates trials and in-app purchases)](http://go.microsoft.com/fwlink/p/?LinkID=627610)\n\n\n\n\n"}