{"nodes":[{"content":"Debug a background task","pos":[29,52]},{"content":"Learn how to debug a background task, including background task activation and debug tracing in the Windows event log.","pos":[66,184]},{"content":"Debug a background task","pos":[241,264]},{"content":"Updated for UWP apps on Windows 10.","pos":[270,305]},{"content":"For Windows 8.x articles, see the <bpt id=\"p1\">[</bpt>archive<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>","pos":[306,398]},{"content":"Important APIs","pos":[406,420]},{"content":"Windows.ApplicationModel.Background","pos":[429,464]},{"content":"Learn how to debug a background task, including background task activation and debug tracing in the Windows event log.","pos":[525,643]},{"content":"This topic assumes that you already have an existing app with a background task to debug.","pos":[645,734]},{"content":"Make sure the background task project is set up correctly","pos":[739,796]},{"content":"In C# and C++, make sure the main project references the background task project.","pos":[803,884]},{"content":"If this reference is not in place, the background task won't be included in the app package.","pos":[885,977]},{"pos":[982,1089],"content":"In C# and C++, make sure the <bpt id=\"p1\">**</bpt>Output type<ept id=\"p1\">**</ept> of the background task project is \"Windows Runtime Component\"."},{"content":"The background class and must be declared in the entry point attribute in the package manifest.","pos":[1094,1189]},{"content":"Trigger background tasks manually to debug background task code","pos":[1194,1257]},{"content":"Background tasks can be triggered manually through Microsoft Visual Studio.","pos":[1260,1335]},{"content":"Then you can step through the code and debug it.","pos":[1336,1384]},{"pos":[1390,1589],"content":"In C#, put a breakpoint in the Run method of the background class, and/or write debugging output by using <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>System.Diagnostics<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/xaml/hh441592.aspx)</ept>."},{"pos":[1595,1789],"content":"In C++, put a breakpoint in the Run function of the background class, and/or write debugging output by using <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>OutputDebugString<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/desktop/aa363362)</ept>."},{"content":"Run your application in the debugger and then trigger the background task using the suspend drop down menu in the <bpt id=\"p1\">**</bpt>Lifecycle Events<ept id=\"p1\">**</ept> toolbar.","pos":[1795,1938]},{"content":"This drop down shows the names of the background tasks that can be activated by Visual Studio.","pos":[1939,2033]},{"content":"For this to work, the background task must already be registered and it must still be waiting for the trigger.","pos":[2039,2149]},{"content":"For example, if a background task was registered with a one-shot TimeTrigger and that trigger has already fired, launching the task through Visual Studio will have no effect.","pos":[2150,2324]},{"pos":[2330,2786],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Background tasks using the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>ControlChannelTrigger<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/hh701032)</ept> or <bpt id=\"p4\">[</bpt><bpt id=\"p5\">**</bpt>PushNotificationTrigger<ept id=\"p5\">**</ept><ept id=\"p4\">](https://msdn.microsoft.com/library/windows/apps/hh700543)</ept>, and background tasks using a <bpt id=\"p6\">[</bpt><bpt id=\"p7\">**</bpt>SystemTrigger<ept id=\"p7\">**</ept><ept id=\"p6\">](https://msdn.microsoft.com/library/windows/apps/br224838)</ept> with the <bpt id=\"p8\">[</bpt><bpt id=\"p9\">**</bpt>SmsReceived<ept id=\"p9\">**</ept><ept id=\"p8\">](https://msdn.microsoft.com/library/windows/apps/br224839)</ept> trigger type, cannot be activated in this manner."},{"content":"debugging background tasks","pos":[2799,2825]},{"content":"When the background task activates, the debugger will attach to it and display debug output in VS.","pos":[2865,2963]},{"content":"Debug background task activation","pos":[2968,3000]},{"content":"Background task activation depends on three things matching up correctly.","pos":[3003,3076]},{"content":"This procedure shows how to check and make sure that these all match up.","pos":[3077,3149]},{"content":"The name and namespace of the background task class","pos":[3155,3206]},{"content":"The entry point attribute specified in the package manifest","pos":[3211,3270]},{"content":"The entry point specified by your app when registering the background task","pos":[3275,3349]},{"content":"Use Visual Studio to note the entry point of the background task:","pos":[3355,3420]},{"content":"In C# and C++, note the name and namespace of the background task class specified in the background task project.","pos":[3430,3543]},{"content":"Use the manifest designer to check that the background task is correctly declared in the package manifest:","pos":[3549,3655]},{"content":"In C# and C++, the entry point attribute must match the background task namespace followed by the class name.","pos":[3665,3774]},{"content":"For example: RuntimeComponent1.MyBackgroundTask.","pos":[3775,3823]},{"content":"All the trigger type(s) used with the task must also be specified.","pos":[3832,3898]},{"pos":[3907,4146],"content":"The executable MUST NOT be specified unless you are using the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ControlChannelTrigger<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/hh701032)</ept> or <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>PushNotificationTrigger<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/hh700543)</ept>."},{"content":"Windows only.","pos":[4152,4165]},{"content":"To see the entry point used by Windows to activate the background task, enable debug tracing and use the Windows event log.","pos":[4166,4289]},{"content":"If you follow this procedure and the event log shows the wrong entry point or trigger for the background task, your app is not registering the background task correctly.","pos":[4295,4464]},{"content":"For help with this task see <bpt id=\"p1\">[</bpt>Register a background task<ept id=\"p1\">](register-a-background-task.md)</ept>.","pos":[4465,4553]},{"content":"Open event viewer by going to the Start screen and searching for eventvwr.exe.","pos":[4563,4641]},{"pos":[4650,4787],"content":"Go to <bpt id=\"p1\">**</bpt>Application and Services Logs<ept id=\"p1\">**</ept><ph id=\"ph1\"> -&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Microsoft<ept id=\"p2\">**</ept><ph id=\"ph2\"> -&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Windows<ept id=\"p3\">**</ept><ph id=\"ph3\"> -&amp;gt;</ph> <bpt id=\"p4\">**</bpt>BackgroundTaskInfrastructure<ept id=\"p4\">**</ept> in the event viewer."},{"pos":[4796,4905],"content":"In the actions pane, select <bpt id=\"p1\">**</bpt>View<ept id=\"p1\">**</ept><ph id=\"ph1\"> -&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Show Analytic and Debug Logs<ept id=\"p2\">**</ept> to enable the diagnostic logging."},{"pos":[4914,4969],"content":"Select the <bpt id=\"p1\">**</bpt>Diagnostic log<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Enable Log<ept id=\"p2\">**</ept>."},{"content":"Now try using your app to register and activate the background task again.","pos":[4978,5052]},{"content":"View the diagnostic logs for detailed error information.","pos":[5061,5117]},{"content":"This will include the entry point registered for the background task.","pos":[5118,5187]},{"content":"event viewer for background tasks debug information","pos":[5191,5242]},{"content":"Background tasks and Visual Studio package deployment","pos":[5273,5326]},{"content":"If an app that uses background tasks is deployed using Visual Studio, and the version (major and/or minor) specified in Manifest Designer is then updated, subsequently re-deploying the app with Visual Studio may cause the app’s background tasks to stall.","pos":[5329,5583]},{"content":"This can be remedied as follows:","pos":[5584,5616]},{"content":"Use Windows PowerShell to deploy the updated app (instead of Visual Studio) by running the script generated alongside the package.","pos":[5622,5752]},{"content":"If you already deployed the app using Visual Studio and its background tasks are now stalled, reboot or log off/log in to get the app’s background tasks working again.","pos":[5757,5924]},{"content":"You can select the \"Always re-install my package\" debugging option to avoid this in C# projects.","pos":[5929,6025]},{"content":"Wait until the app is ready for final deployment to increment the package version (don’t change it while debugging).","pos":[6030,6146]},{"content":"Remarks","pos":[6151,6158]},{"content":"Make sure your app checks for existing background task registrations before registering the background task again.","pos":[6165,6279]},{"content":"Multiple registrations of the same background task can cause unexpected results by running the background task more than once each time it is triggered.","pos":[6280,6432]},{"content":"On Windows, if the background task requires lock screen access make sure to put the app on the lock screen before trying to debug the background task.","pos":[6437,6587]},{"content":"For info on specifying manifest options for lock screen-capable apps, see <bpt id=\"p1\">[</bpt>Declare background tasks in the application manifest<ept id=\"p1\">](declare-background-tasks-in-the-application-manifest.md)</ept>.","pos":[6588,6774]},{"content":"Background task registration parameters are validated at the time of registration.","pos":[6779,6861]},{"content":"An error is returned if any of the registration parameters are invalid.","pos":[6862,6933]},{"content":"Ensure that your app gracefully handles scenarios where background task registration fails - if instead your app depends on having a valid registration object after attempting to register a task, it may crash.","pos":[6934,7143]},{"pos":[7145,7348],"content":"For more info on using VS to debug a background task see <bpt id=\"p1\">[</bpt>How to trigger suspend, resume, and background events in Windows Store apps<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/xaml/hh974425.aspx)</ept>."},{"content":"Related topics","pos":[7353,7367]},{"content":"Create and register a background task","pos":[7372,7409]},{"content":"Register a background task","pos":[7456,7482]},{"content":"Declare background tasks in the application manifest","pos":[7518,7570]},{"content":"Guidelines for background tasks","pos":[7632,7663]},{"content":"How to trigger suspend, resume, and background events in Windows Store apps","pos":[7704,7779]},{"content":"Analyzing the code quality of Windows Windows Store apps with Visual Studio code analysis","pos":[7852,7941]}],"content":"---\nauthor: TylerMSFT\ntitle: Debug a background task\ndescription: Learn how to debug a background task, including background task activation and debug tracing in the Windows event log.\nms.assetid: 24E5AC88-1FD3-46ED-9811-C7E102E01E9C\n---\n\n# Debug a background task\n\n\n\\[ Updated for UWP apps on Windows 10. For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \\]\n\n\n**Important APIs**\n\n-   [Windows.ApplicationModel.Background](https://msdn.microsoft.com/library/windows/apps/br224847)\n\nLearn how to debug a background task, including background task activation and debug tracing in the Windows event log.\n\nThis topic assumes that you already have an existing app with a background task to debug.\n\n## Make sure the background task project is set up correctly\n\n\n-   In C# and C++, make sure the main project references the background task project. If this reference is not in place, the background task won't be included in the app package.\n-   In C# and C++, make sure the **Output type** of the background task project is \"Windows Runtime Component\".\n-   The background class and must be declared in the entry point attribute in the package manifest.\n\n## Trigger background tasks manually to debug background task code\n\n\nBackground tasks can be triggered manually through Microsoft Visual Studio. Then you can step through the code and debug it.\n\n1.  In C#, put a breakpoint in the Run method of the background class, and/or write debugging output by using [**System.Diagnostics**](https://msdn.microsoft.com/library/windows/apps/xaml/hh441592.aspx).\n\n    In C++, put a breakpoint in the Run function of the background class, and/or write debugging output by using [**OutputDebugString**](https://msdn.microsoft.com/library/windows/desktop/aa363362).\n\n2.  Run your application in the debugger and then trigger the background task using the suspend drop down menu in the **Lifecycle Events** toolbar. This drop down shows the names of the background tasks that can be activated by Visual Studio.\n\n    For this to work, the background task must already be registered and it must still be waiting for the trigger. For example, if a background task was registered with a one-shot TimeTrigger and that trigger has already fired, launching the task through Visual Studio will have no effect.\n\n    **Note**  Background tasks using the [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032) or [**PushNotificationTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700543), and background tasks using a [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/br224838) with the [**SmsReceived**](https://msdn.microsoft.com/library/windows/apps/br224839) trigger type, cannot be activated in this manner.     \n\n    ![debugging background tasks](images/debugging-activation.png)\n\n3.  When the background task activates, the debugger will attach to it and display debug output in VS.\n\n## Debug background task activation\n\n\nBackground task activation depends on three things matching up correctly. This procedure shows how to check and make sure that these all match up.\n\n-   The name and namespace of the background task class\n-   The entry point attribute specified in the package manifest\n-   The entry point specified by your app when registering the background task\n\n1.  Use Visual Studio to note the entry point of the background task:\n\n    -   In C# and C++, note the name and namespace of the background task class specified in the background task project.\n\n2.  Use the manifest designer to check that the background task is correctly declared in the package manifest:\n\n    -   In C# and C++, the entry point attribute must match the background task namespace followed by the class name. For example: RuntimeComponent1.MyBackgroundTask.\n    -   All the trigger type(s) used with the task must also be specified.\n    -   The executable MUST NOT be specified unless you are using the [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032) or [**PushNotificationTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700543).\n\n3.  Windows only. To see the entry point used by Windows to activate the background task, enable debug tracing and use the Windows event log.\n\n    If you follow this procedure and the event log shows the wrong entry point or trigger for the background task, your app is not registering the background task correctly. For help with this task see [Register a background task](register-a-background-task.md).\n\n    1.  Open event viewer by going to the Start screen and searching for eventvwr.exe.\n    2.  Go to **Application and Services Logs** -&gt; **Microsoft** -&gt; **Windows** -&gt; **BackgroundTaskInfrastructure** in the event viewer.\n    3.  In the actions pane, select **View** -&gt; **Show Analytic and Debug Logs** to enable the diagnostic logging.\n    4.  Select the **Diagnostic log** and click **Enable Log**.\n    5.  Now try using your app to register and activate the background task again.\n    6.  View the diagnostic logs for detailed error information. This will include the entry point registered for the background task.\n\n![event viewer for background tasks debug information](images/event-viewer.png)\n\n## Background tasks and Visual Studio package deployment\n\n\nIf an app that uses background tasks is deployed using Visual Studio, and the version (major and/or minor) specified in Manifest Designer is then updated, subsequently re-deploying the app with Visual Studio may cause the app’s background tasks to stall. This can be remedied as follows:\n\n-   Use Windows PowerShell to deploy the updated app (instead of Visual Studio) by running the script generated alongside the package.\n-   If you already deployed the app using Visual Studio and its background tasks are now stalled, reboot or log off/log in to get the app’s background tasks working again.\n-   You can select the \"Always re-install my package\" debugging option to avoid this in C# projects.\n-   Wait until the app is ready for final deployment to increment the package version (don’t change it while debugging).\n\n## Remarks\n\n\n-   Make sure your app checks for existing background task registrations before registering the background task again. Multiple registrations of the same background task can cause unexpected results by running the background task more than once each time it is triggered.\n-   On Windows, if the background task requires lock screen access make sure to put the app on the lock screen before trying to debug the background task. For info on specifying manifest options for lock screen-capable apps, see [Declare background tasks in the application manifest](declare-background-tasks-in-the-application-manifest.md).\n-   Background task registration parameters are validated at the time of registration. An error is returned if any of the registration parameters are invalid. Ensure that your app gracefully handles scenarios where background task registration fails - if instead your app depends on having a valid registration object after attempting to register a task, it may crash.\n\nFor more info on using VS to debug a background task see [How to trigger suspend, resume, and background events in Windows Store apps](https://msdn.microsoft.com/library/windows/apps/xaml/hh974425.aspx).\n\n## Related topics\n\n* [Create and register a background task](create-and-register-a-background-task.md)\n* [Register a background task](register-a-background-task.md)\n* [Declare background tasks in the application manifest](declare-background-tasks-in-the-application-manifest.md)\n* [Guidelines for background tasks](guidelines-for-background-tasks.md)\n* [How to trigger suspend, resume, and background events in Windows Store apps](https://msdn.microsoft.com/library/windows/apps/xaml/hh974425.aspx)\n* [Analyzing the code quality of Windows Windows Store apps with Visual Studio code analysis](https://msdn.microsoft.com/library/windows/apps/xaml/hh441471.aspx)\n\n \n\n \n"}