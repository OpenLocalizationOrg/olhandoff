{"nodes":[{"content":"This topic shows examples of the coding tasks needed to achieve some of the most common file-related enterprise data protection (EDP) scenarios.","pos":[36,180]},{"content":"Use enterprise data protection (EDP) to protect files","pos":[338,391]},{"content":"Use enterprise data protection (EDP) to protect files","pos":[400,453]},{"pos":[455,575],"content":"<bpt id=\"p1\">__</bpt>Note<ept id=\"p1\">__</ept> Enterprise data protection (EDP) policy cannot be applied on Windows 10, Version 1511 (build 10586) or earlier."},{"content":"This topic shows examples of the coding tasks needed to achieve some of the most common file-related enterprise data protection (EDP) scenarios.","pos":[577,721]},{"content":"For the full developer picture of how EDP relates to files, streams, the clipboard, networking, background tasks, and data protection under lock, see <bpt id=\"p1\">[</bpt>enterprise data protection (EDP)<ept id=\"p1\">](../enterprise/edp-hub.md)</ept>.","pos":[722,933]},{"pos":[935,1113],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  The <bpt id=\"p2\">[</bpt>enterprise data protection (EDP) sample<ept id=\"p2\">](http://go.microsoft.com/fwlink/p/?LinkId=620031&amp;clcid=0x409)</ept> covers many of the same scenarios demonstrated in this topic."},{"content":"Prerequisites","pos":[1118,1131]},{"content":"Get set up for EDP","pos":[1139,1157]},{"pos":[1165,1255],"content":"See <bpt id=\"p1\">[</bpt>Set up your computer for EDP<ept id=\"p1\">](../enterprise/edp-hub.md#set-up-your-computer-for-EDP)</ept>."},{"content":"Commit to building an enterprise-enlightened app","pos":[1263,1311]},{"content":"An app that autonomously ensures that enterprise data stays under the managing enterprise’s control is known as an enterprise-enlightened app.","pos":[1319,1461]},{"content":"An enlightened app is more powerful, smart, flexible, and trusted than an unenlightened one.","pos":[1462,1554]},{"content":"Your app announces to the system that it is enlightened by declaring the restricted <bpt id=\"p1\">**</bpt>enterpriseDataPolicy<ept id=\"p1\">**</ept> capability.","pos":[1555,1675]},{"content":"There's more to being enlightened than setting a capability, though.","pos":[1676,1744]},{"content":"To learn more, see <bpt id=\"p1\">[</bpt>Enterprise-enlightened apps<ept id=\"p1\">](../enterprise/edp-hub.md#enterprise-enlightened-apps)</ept>.","pos":[1745,1848]},{"content":"Understand async programming for Universal Windows Platform (UWP) apps","pos":[1856,1926]},{"content":"To learn about how to write asynchronous apps in C<ph id=\"ph1\">\\#</ph> or Visual Basic, see <bpt id=\"p1\">[</bpt>Call asynchronous APIs in C<ph id=\"ph2\">\\#</ph> or Visual Basic<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187337)</ept>.","pos":[1934,2114]},{"content":"To learn about how to write asynchronous apps in C++, see <bpt id=\"p1\">[</bpt>Asynchronous programming in C++<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187334)</ept>.","pos":[2115,2265]},{"content":"Your local folder path, and viewing protected files in File Explorer","pos":[2270,2338]},{"content":"You can create an app to host the code examples in this topic to try them out.","pos":[2341,2419]},{"content":"The code examples write files to your app's local folder, and the exact location of that folder on disk is unique to your app.","pos":[2420,2546]},{"content":"To determine the location of your app's local folder, you can add the following code.","pos":[2547,2632]},{"content":"Once you have the path, you'll be able to use File Explorer to easily find the files that your app creates.","pos":[2892,2999]},{"content":"That way, you'll be able to confirm that they're protected, and that they're protected to the correct identity.","pos":[3000,3111]},{"content":"In File Explorer, <bpt id=\"p1\">**</bpt>Change folder and search options<ept id=\"p1\">**</ept> and on the <bpt id=\"p2\">**</bpt>View<ept id=\"p2\">**</ept> tab, check <bpt id=\"p3\">**</bpt>Show encrypted files in color<ept id=\"p3\">**</ept>.","pos":[3113,3233]},{"content":"Also, use File Explorer's <bpt id=\"p1\">**</bpt>View<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Add columns<ept id=\"p2\">**</ept> command to add the <bpt id=\"p3\">**</bpt>Encrypted to<ept id=\"p3\">**</ept> column so that you can see the enterprise identity that you're protecting your files to.","pos":[3234,3414]},{"content":"Protect enterprise data in a new file (for an interactive app)","pos":[3419,3481]},{"content":"There are many ways enterprise data might enter your app, including from certain network endpoints, from files, from the clipboard, or from the share contract.","pos":[3484,3643]},{"content":"Your app might create new enterprise data, too.","pos":[3644,3691]},{"content":"Whatever the means by which your enlightened app comes by enterprise data, your app will need to be careful to protect the data to the managed enterprise identity when it persists the data to a new file.","pos":[3692,3895]},{"content":"The basic steps are to use a regular storage API to create the file, use an EDP API to protect the file to the enterprise identity, and then (again, using regular storage APIs) to write to the file.","pos":[3897,4095]},{"content":"Be careful to protect the file before you write to it (as shown in the example below).","pos":[4096,4182]},{"content":"You use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionManager.ProtectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705157)</ept> method to protect the file.","pos":[4183,4321]},{"content":"And, as always, it only makes sense to protect to an identity if that identity is managed.","pos":[4322,4412]},{"content":"For more info about why that's the case, and how your app can determine the identity of the enterprise it's running in, see <bpt id=\"p1\">[</bpt>Confirming an identity is managed<ept id=\"p1\">](../enterprise/edp-hub.md#confirming_an_identity_is_managed)</ept>.","pos":[4413,4633]},{"content":"Protect enterprise data in a new file (for a background task)","pos":[5633,5694]},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionManager.ProtectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705157)</ept> API that we used in the previous section is only appropriate for interactive apps.","pos":[5697,5882]},{"content":"For a background task, your code can execute while under the lock screen.","pos":[5883,5956]},{"content":"And the organization may be administering a secure \"data protection under lock\" (DPL) policy, where encryption keys required to access protected resources are temporarily removed from device memory when the device is locked.","pos":[5957,6181]},{"content":"This prevents data leaks if the device is lost.","pos":[6182,6229]},{"content":"The feature also removes keys associated with protected files when their handles are closed.","pos":[6230,6322]},{"content":"It is, however, possible to create new protected files during the lock window (the time between the device being locked and unlocked) and access them while keeping the file handle open.","pos":[6323,6508]},{"content":"<bpt id=\"p1\">**</bpt>StorageFolder.CreateFileAsync<ept id=\"p1\">**</ept> closes the handle when the file is created, so this algorithm can't be used.","pos":[6509,6619]},{"pos":[6625,6683],"content":"Create a new file using <bpt id=\"p1\">**</bpt>StorageFolder.CreateFileAsync<ept id=\"p1\">**</ept>."},{"pos":[6688,6741],"content":"Encrypt using <bpt id=\"p1\">**</bpt>FileProtectionManager.ProtectAsync<ept id=\"p1\">**</ept>."},{"content":"Open the file and write to it.","pos":[6746,6776]},{"content":"Since Step 1 involves closing the file handle (and even if Step 1 didn’t close the handle, Step 2 would), Step 3 is not possible because encryption keys to access that file are no longer available.","pos":[6778,6975]},{"content":"To address this scenario, you can use <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionManager.CreateProtectedAndOpenAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705153)</ept> to create a protected file and return an <bpt id=\"p3\">**</bpt>IRandomAccessStream<ept id=\"p3\">**</ept> to it.","pos":[6977,7200]},{"content":"This allows apps to make multiple writes to a file while keeping the file handle open.","pos":[7201,7287]},{"content":"The example code demonstrates a simplistic mail app writing out a new file when new mail is received.","pos":[7289,7390]},{"content":"Mail apps must sync email when the device is locked.","pos":[7391,7443]},{"content":"When this app receives new mail, it creates a new file using <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>CreateProtectedAndOpenAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705153)</ept>, retrieves an output stream, and writes the mail body to it.","pos":[7444,7657]},{"content":"Protect a folder whose purpose is to contain enterprise data","pos":[9114,9174]},{"content":"If you want every item inside a folder to be protected, then you can do that, too.","pos":[9177,9259]},{"content":"You can use <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionManager.ProtectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705157)</ept> to protect an empty folder.","pos":[9260,9398]},{"content":"Then, any file or folder subsequently created inside the folder will also be protected.","pos":[9399,9486]},{"content":"You can protect an existing folder, or you can create a new folder to protect (the example below creates a new folder).","pos":[9487,9606]},{"content":"But, in either case, for protection to succeed, the folder must be empty at the time.","pos":[9607,9692]},{"content":"If it isn't, then <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionInfo.Status<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705150)</ept> will contain a value of <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>FileProtectionStatus.NotProtectable<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn279147)</ept>.","pos":[9693,9925]},{"content":"Copy protection from one file to another","pos":[10636,10676]},{"content":"In this scenario, a file already exists that you know is protected to the appropriate enterprise identity.","pos":[10679,10785]},{"content":"You can replicate that protection onto another file very conveniently.","pos":[10786,10856]},{"content":"You don't even need to know what the identity is: you only need to know that it's the right one.","pos":[10857,10953]},{"content":"To make a simple copy of a protected file, you can call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>StorageFile.CopyAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br227190)</ept>.","pos":[10955,11097]},{"content":"The resulting copy of the file will have the same protection as the original.","pos":[11098,11175]},{"pos":[11177,11614],"content":"To protect an existing unprotected file before writing enterprise data to it, an alternative to calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionManager.ProtectAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705157)</ept> (which we saw in an earlier scenario, and to which you need to pass a managed identity) is to call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>FileProtectionManager.CopyProtectionAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn705152)</ept> as shown in the code example."},{"content":"Handle being denied access to a file you protected","pos":[12164,12214]},{"content":"In this scenario, your app attempts to access a file—which your app previously protected—and is denied access.","pos":[12217,12327]},{"content":"You'll need to check the status of the file to see what went wrong.","pos":[12328,12395]},{"content":"In this code example, the app calls the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>FileProtectionManager.GetProtectionInfoAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705154)</ept> API to query the status and determine whether the reason is because access to the file has now been revoked as a result of remote management.","pos":[12396,12686]},{"content":"Enable UI-policy enforcement based on a file’s protected identity","pos":[13214,13279]},{"content":"When your app is about to display the contents of a protected file (such as a PDF) on its UI, it must enable UI-policy enforcement based on the identity the file is protected to.","pos":[13282,13460]},{"content":"You should query the protection information of the file and enable the system's UI-policy enforcement from the retrieved identity.","pos":[13461,13591]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps.","pos":[14240,14338]},{"content":"If you’re developing for Windows 8.x or Windows Phone 8.x, see the <bpt id=\"p1\">[</bpt>archived documentation<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>.","pos":[14339,14480]},{"content":"Related topics","pos":[14488,14502]},{"content":"enterprise data protection (EDP) sample","pos":[14506,14545]},{"content":"Windows.Security.EnterpriseData namespace","pos":[14612,14653]}],"content":"---\nauthor: TylerMSFT\nDescription: 'This topic shows examples of the coding tasks needed to achieve some of the most common file-related enterprise data protection (EDP) scenarios.'\nMS-HAID: 'dev\\_files.protect\\_your\\_enterprise\\_data\\_with\\_edp'\nMSHAttr: 'PreferredLib:/library/windows/apps'\nSearch.Product: eADQiWindows 10XVcnh\ntitle: 'Use enterprise data protection (EDP) to protect files'\n---\n\n# Use enterprise data protection (EDP) to protect files\n\n__Note__ Enterprise data protection (EDP) policy cannot be applied on Windows 10, Version 1511 (build 10586) or earlier.\n\nThis topic shows examples of the coding tasks needed to achieve some of the most common file-related enterprise data protection (EDP) scenarios. For the full developer picture of how EDP relates to files, streams, the clipboard, networking, background tasks, and data protection under lock, see [enterprise data protection (EDP)](../enterprise/edp-hub.md).\n\n**Note**  The [enterprise data protection (EDP) sample](http://go.microsoft.com/fwlink/p/?LinkId=620031&clcid=0x409) covers many of the same scenarios demonstrated in this topic.\n\n## Prerequisites\n\n-   **Get set up for EDP**\n\n    See [Set up your computer for EDP](../enterprise/edp-hub.md#set-up-your-computer-for-EDP).\n\n-   **Commit to building an enterprise-enlightened app**\n\n    An app that autonomously ensures that enterprise data stays under the managing enterprise’s control is known as an enterprise-enlightened app. An enlightened app is more powerful, smart, flexible, and trusted than an unenlightened one. Your app announces to the system that it is enlightened by declaring the restricted **enterpriseDataPolicy** capability. There's more to being enlightened than setting a capability, though. To learn more, see [Enterprise-enlightened apps](../enterprise/edp-hub.md#enterprise-enlightened-apps).\n\n-   **Understand async programming for Universal Windows Platform (UWP) apps**\n\n    To learn about how to write asynchronous apps in C\\# or Visual Basic, see [Call asynchronous APIs in C\\# or Visual Basic](https://msdn.microsoft.com/library/windows/apps/mt187337). To learn about how to write asynchronous apps in C++, see [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334).\n\n## Your local folder path, and viewing protected files in File Explorer\n\n\nYou can create an app to host the code examples in this topic to try them out. The code examples write files to your app's local folder, and the exact location of that folder on disk is unique to your app. To determine the location of your app's local folder, you can add the following code.\n\n```CSharp\n// Put a breakpoint on the line after the line of code below. Use the value of localFolderPath\n// in File Explorer to find the output file that the later code examples create.\nstring localFolderPath = ApplicationData.Current.LocalFolder.Path;\n```\n\nOnce you have the path, you'll be able to use File Explorer to easily find the files that your app creates. That way, you'll be able to confirm that they're protected, and that they're protected to the correct identity.\n\nIn File Explorer, **Change folder and search options** and on the **View** tab, check **Show encrypted files in color**. Also, use File Explorer's **View** &gt; **Add columns** command to add the **Encrypted to** column so that you can see the enterprise identity that you're protecting your files to.\n\n## Protect enterprise data in a new file (for an interactive app)\n\n\nThere are many ways enterprise data might enter your app, including from certain network endpoints, from files, from the clipboard, or from the share contract. Your app might create new enterprise data, too. Whatever the means by which your enlightened app comes by enterprise data, your app will need to be careful to protect the data to the managed enterprise identity when it persists the data to a new file.\n\nThe basic steps are to use a regular storage API to create the file, use an EDP API to protect the file to the enterprise identity, and then (again, using regular storage APIs) to write to the file. Be careful to protect the file before you write to it (as shown in the example below). You use the [**FileProtectionManager.ProtectAsync**](https://msdn.microsoft.com/library/windows/apps/dn705157) method to protect the file. And, as always, it only makes sense to protect to an identity if that identity is managed. For more info about why that's the case, and how your app can determine the identity of the enterprise it's running in, see [Confirming an identity is managed](../enterprise/edp-hub.md#confirming_an_identity_is_managed).\n\n```CSharp\nusing Windows.Security.EnterpriseData;\nusing Windows.Storage;\n\n...\n\nprivate async void SaveEnterpriseDataToFile(string enterpriseData, string identity)\n{\n    // You should only protect to an identity that is managed.\n    if (!ProtectionPolicyManager.IsIdentityManaged(identity)) return false;\n\n    StorageFolder storageFolder = ApplicationData.Current.LocalFolder;\n    StorageFile storageFile = storageFolder.CreateFileAsync(\"sample.txt\",\n        CreationCollisionOption.ReplaceExisting);\n\n    // It's important to protect a file *before* writing enterprise data to it.\n    FileProtectionInfo fileProtectionInfo =\n        await FileProtectionManager.ProtectAsync(storageFile, identity);\n\n    // If the file is now protected, to the intended identity, then we can write to it.\n    if (fileProtectionInfo.Identity == identity &&\n        fileProtectionInfo.Status == FileProtectionStatus.Protected)\n        await Windows.Storage.FileIO.WriteTextAsync(storageFile, enterpriseData);\n}\n```\n\n## Protect enterprise data in a new file (for a background task)\n\n\nThe [**FileProtectionManager.ProtectAsync**](https://msdn.microsoft.com/library/windows/apps/dn705157) API that we used in the previous section is only appropriate for interactive apps. For a background task, your code can execute while under the lock screen. And the organization may be administering a secure \"data protection under lock\" (DPL) policy, where encryption keys required to access protected resources are temporarily removed from device memory when the device is locked. This prevents data leaks if the device is lost. The feature also removes keys associated with protected files when their handles are closed. It is, however, possible to create new protected files during the lock window (the time between the device being locked and unlocked) and access them while keeping the file handle open. **StorageFolder.CreateFileAsync** closes the handle when the file is created, so this algorithm can't be used.\n\n1.  Create a new file using **StorageFolder.CreateFileAsync**.\n2.  Encrypt using **FileProtectionManager.ProtectAsync**.\n3.  Open the file and write to it.\n\nSince Step 1 involves closing the file handle (and even if Step 1 didn’t close the handle, Step 2 would), Step 3 is not possible because encryption keys to access that file are no longer available.\n\nTo address this scenario, you can use [**FileProtectionManager.CreateProtectedAndOpenAsync**](https://msdn.microsoft.com/library/windows/apps/dn705153) to create a protected file and return an **IRandomAccessStream** to it. This allows apps to make multiple writes to a file while keeping the file handle open.\n\nThe example code demonstrates a simplistic mail app writing out a new file when new mail is received. Mail apps must sync email when the device is locked. When this app receives new mail, it creates a new file using [**CreateProtectedAndOpenAsync**](https://msdn.microsoft.com/library/windows/apps/dn705153), retrieves an output stream, and writes the mail body to it.\n\n```CSharp\nusing Windows.Security.EnterpriseData;\nusing Windows.Storage;\nusing Windows.Storage.Streams;\n\n...\n\nprivate async void SaveEnterpriseDataToFile(string enterpriseData, string identity)\n{\n    // You should only protect to an identity that is managed.\n    if (!ProtectionPolicyManager.IsIdentityManaged(identity)) return false;\n\n    StorageFolder storageFolder = ApplicationData.Current.LocalFolder;\n\n    ProtectedFileCreateResult protectedFileCreateResult =\n        await FileProtectionManager.CreateProtectedAndOpenAsync(storageFolder,\n            \"sample.txt\", identity, CreationCollisionOption.ReplaceExisting);\n\n    // It's important to successfully protect a file *before* writing enterprise data to it.\n    if (protectedFileCreateResult.ProtectionInfo.Identity == identity &&\n        protectedFileCreateResult.ProtectionInfo.Status == FileProtectionStatus.Protected)\n    {\n        using (IOutputStream outputStream =\n            protectedFileCreateResult.Stream.GetOutputStreamAt(0))\n        {\n            using (DataWriter writer = new DataWriter(outputStream))\n            {\n                writer.WriteString(enterpriseData);\n                await writer.StoreAsync();\n                await writer.FlushAsync();\n            }\n        }\n    }\n    else if (protectedFileCreateResult.ProtectionInfo.Status == FileProtectionStatus.AccessSuspended)\n    {\n        // Perform any special processing for the access suspended case.\n    }\n}\n```\n\n## Protect a folder whose purpose is to contain enterprise data\n\n\nIf you want every item inside a folder to be protected, then you can do that, too. You can use [**FileProtectionManager.ProtectAsync**](https://msdn.microsoft.com/library/windows/apps/dn705157) to protect an empty folder. Then, any file or folder subsequently created inside the folder will also be protected. You can protect an existing folder, or you can create a new folder to protect (the example below creates a new folder). But, in either case, for protection to succeed, the folder must be empty at the time. If it isn't, then [**FileProtectionInfo.Status**](https://msdn.microsoft.com/library/windows/apps/dn705150) will contain a value of [**FileProtectionStatus.NotProtectable**](https://msdn.microsoft.com/library/windows/apps/dn279147).\n\n```CSharp\nusing Windows.Security.EnterpriseData;\nusing Windows.Storage;\n\n...\n\nprivate async void CreateANewFolderAndProtectItAsync(string folderName, string identity)\n{\n    if (!ProtectionPolicyManager.IsIdentityManaged(identity)) return false;\n\n    StorageFolder storageFolder = ApplicationData.Current.LocalFolder;\n    StorageFolder newStorageFolder =\n        await storageFolder.CreateFolderAsync(folderName);\n\n    FileProtectionInfo fileProtectionInfo =\n        await FileProtectionManager.ProtectAsync(newStorageFolder, identity);\n\n    if (fileProtectionInfo.Identity != identity ||\n        fileProtectionInfo.Status != FileProtectionStatus.Protected)\n    {\n        // Protection failed.\n    }\n}\n```\n\n## Copy protection from one file to another\n\n\nIn this scenario, a file already exists that you know is protected to the appropriate enterprise identity. You can replicate that protection onto another file very conveniently. You don't even need to know what the identity is: you only need to know that it's the right one.\n\nTo make a simple copy of a protected file, you can call [**StorageFile.CopyAsync**](https://msdn.microsoft.com/library/windows/apps/br227190). The resulting copy of the file will have the same protection as the original.\n\nTo protect an existing unprotected file before writing enterprise data to it, an alternative to calling [**FileProtectionManager.ProtectAsync**](https://msdn.microsoft.com/library/windows/apps/dn705157) (which we saw in an earlier scenario, and to which you need to pass a managed identity) is to call [**FileProtectionManager.CopyProtectionAsync**](https://msdn.microsoft.com/library/windows/apps/dn705152) as shown in the code example.\n\n```CSharp\nusing Windows.Security.EnterpriseData;\nusing Windows.Storage;\n\n...\n\nprivate async void CopyProtectionFromOneFileToAnother\n    (StorageFile sourceStorageFile, StorageFile targetStorageFile)\n{\n    bool copyResult = await\n        FileProtectionManager.CopyProtectionAsync(sourceStorageFile, targetStorageFile);\n\n    if (!copyResult)\n    {\n        // Copying failed. To diagnose, you could check the file's status.\n        // (call FileProtectionManager.GetProtectionInfoAsync and\n        // check FileProtectionInfo.Status).\n    }\n}\n```\n\n## Handle being denied access to a file you protected\n\n\nIn this scenario, your app attempts to access a file—which your app previously protected—and is denied access. You'll need to check the status of the file to see what went wrong. In this code example, the app calls the [**FileProtectionManager.GetProtectionInfoAsync**](https://msdn.microsoft.com/library/windows/apps/dn705154) API to query the status and determine whether the reason is because access to the file has now been revoked as a result of remote management.\n\n```CSharp\nusing Windows.Security.EnterpriseData;\nusing Windows.Storage;\n\n...\n\nprivate async System.Threading.Tasks.Task<bool> IsFileProtectionStatusRevoked\n    (StorageFile storageFile)\n{\n    FileProtectionInfo fileProtectionInfo =\n        await FileProtectionManager.GetProtectionInfoAsync(storageFile);\n\n    if (fileProtectionInfo.Status == FileProtectionStatus.Revoked)\n    {\n        // Inform the user that their data has been revoked.\n    }\n    return fileProtectionInfo.Status == FileProtectionStatus.Revoked;\n}\n```\n\n## Enable UI-policy enforcement based on a file’s protected identity\n\n\nWhen your app is about to display the contents of a protected file (such as a PDF) on its UI, it must enable UI-policy enforcement based on the identity the file is protected to. You should query the protection information of the file and enable the system's UI-policy enforcement from the retrieved identity.\n\n```CSharp\nusing Windows.Security.EnterpriseData;\nusing Windows.Storage;\n\n...\n\nprivate async void EnableUIPolicyFromFile(StorageFile storageFile)\n{\n    FileProtectionInfo fileProtectionInfo = \n        await FileProtectionManager.GetProtectionInfoAsync(storageFile);\n\n    if (fileProtectionInfo.Status != FileProtectionStatus.Protected)\n    {\n        // No policy enforcement required, unless the file is inaccessible\n        // (Revoked, ProtectedToOtherIdentity) in which case that should\n        // be handled in an app-specific way.\n        return;\n    }\n\n    ProtectionPolicyManager.TryApplyProcessUIPolicy(fileProtectionInfo.Identity);\n}\n```\n\n**Note**  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps. If you’re developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132).\n\n \n\n## Related topics\n\n\n[enterprise data protection (EDP) sample](http://go.microsoft.com/fwlink/p/?LinkId=620031&clcid=0x409)\n\n[**Windows.Security.EnterpriseData namespace**](https://msdn.microsoft.com/library/windows/apps/dn279153)\n\n \n\n \n\n\n\n"}