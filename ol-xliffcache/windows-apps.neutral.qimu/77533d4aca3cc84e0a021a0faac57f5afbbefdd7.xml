{"nodes":[{"content":"This topic shows examples of the coding tasks needed to achieve some of the most common data-transfer-related enterprise data protection (EDP) scenarios.","pos":[34,187]},{"content":"Use EDP to protect enterprise data transferred between apps","pos":[376,435]},{"content":"Use EDP to protect enterprise data transferred between apps","pos":[443,502]},{"pos":[504,624],"content":"<bpt id=\"p1\">__</bpt>Note<ept id=\"p1\">__</ept> Enterprise data protection (EDP) policy cannot be applied on Windows 10, Version 1511 (build 10586) or earlier."},{"content":"This topic shows examples of the coding tasks needed to achieve some of the most common data-transfer-related enterprise data protection (EDP) scenarios.","pos":[626,779]},{"content":"For the full developer picture of how EDP relates to files, streams, the clipboard, networking, background tasks, and data protection under lock, see <bpt id=\"p1\">[</bpt>enterprise data protection (EDP)<ept id=\"p1\">](../enterprise/edp-hub.md)</ept>.","pos":[780,991]},{"pos":[993,1171],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  The <bpt id=\"p2\">[</bpt>enterprise data protection (EDP) sample<ept id=\"p2\">](http://go.microsoft.com/fwlink/p/?LinkId=620031&amp;clcid=0x409)</ept> covers many of the same scenarios demonstrated in this topic."},{"content":"Prerequisites","pos":[1176,1189]},{"content":"Get set up for EDP","pos":[1198,1216]},{"pos":[1224,1314],"content":"See <bpt id=\"p1\">[</bpt>Set up your computer for EDP<ept id=\"p1\">](../enterprise/edp-hub.md#set-up-your-computer-for-EDP)</ept>."},{"content":"Commit to building an enterprise-enlightened app","pos":[1322,1370]},{"content":"An app that autonomously ensures that enterprise data stays under the managing enterprise’s control is known as an enterprise-enlightened app.","pos":[1378,1520]},{"content":"An enlightened app is more powerful, smart, flexible, and trusted than an unenlightened one.","pos":[1521,1613]},{"content":"Your app announces to the system that it is enlightened by declaring the restricted <bpt id=\"p1\">**</bpt>enterpriseDataPolicy<ept id=\"p1\">**</ept> capability.","pos":[1614,1734]},{"content":"There's more to being enlightened than setting a capability, though.","pos":[1735,1803]},{"content":"To learn more, see <bpt id=\"p1\">[</bpt>Enterprise-enlightened apps<ept id=\"p1\">](../enterprise/edp-hub.md#enterprise-enlightened-apps)</ept>.","pos":[1804,1907]},{"content":"Understand async programming for Universal Windows Platform (UWP) apps","pos":[1915,1985]},{"content":"To learn about how to write asynchronous apps in C<ph id=\"ph1\">\\#</ph> or Visual Basic, see <bpt id=\"p1\">[</bpt>Call asynchronous APIs in C<ph id=\"ph2\">\\#</ph> or Visual Basic<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187337)</ept>.","pos":[1993,2173]},{"content":"To learn about how to write asynchronous apps in C++, see <bpt id=\"p1\">[</bpt>Asynchronous programming in C++<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/mt187334)</ept>.","pos":[2174,2324]},{"content":"Simple clipboard source","pos":[2329,2352]},{"content":"In this scenario, your app is a notepad-type app that handles both personal and enterprise files.","pos":[2355,2452]},{"content":"Here, your app needn’t change its copy-paste logic at all; it just has to call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ProtectionPolicyManager.TryApplyProcessUIPolicy<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705791)</ept> whenever the user opens and displays content from an enterprise document.","pos":[2453,2717]},{"content":"Once the content is displayed in your app's UI, the user might then copy it to paste into a different app, which is why setting UI policy is important.","pos":[2718,2869]},{"content":"That way, the operating system can apply the currently-set policy to a paste operation involving protected data.","pos":[2870,2982]},{"content":"Similarly, it's important to clear UI policy as soon as it's no longer needed so that the user is once again free to copy-paste personal data.","pos":[2983,3125]},{"content":"<bpt id=\"p1\">**</bpt>TryApplyProcessUIPolicy<ept id=\"p1\">**</ept> returns false if its identity argument is not being managed by an enterprise policy.","pos":[3126,3238]},{"content":"Simple clipboard target","pos":[4375,4398]},{"content":"In this scenario, your app is an email app that handles both personal and corporate accounts.","pos":[4401,4494]},{"content":"The user tries to paste data into an email reply using their personal account.","pos":[4495,4573]},{"content":"In this case, before your app retrieves the contents, it has to just make a call to <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataPackage.RequestAccessAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn706636)</ept>.","pos":[4574,4753]},{"content":"If we already have access, then that method returns at once.","pos":[4754,4814]},{"content":"But, if we don't have access, then the method causes a dialog to be shown which request consent from the user and \"unlocks\" the data package if consent is granted.","pos":[4815,4978]},{"content":"This is to give the user the chance to cancel a paste operation made by mistake.","pos":[4979,5059]},{"content":"Clipboard target is a neutral, empty document","pos":[5884,5929]},{"content":"In this scenario, your app is a word-processing app.","pos":[5932,5984]},{"content":"After creating a new document, as long as the document remains empty, your app treats the document as neutral—neither enterprise nor personal.","pos":[5985,6127]},{"content":"Your user then pastes enterprise data into this neutral-context document.","pos":[6128,6201]},{"content":"Since the document is in a neutral context, we could actually just switch the document into an enterprise context and avoid calling <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataPackage.RequestAccessAsync<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn706636)</ept> altogether (since showing the dialog isn't necessary in that case).","pos":[6202,6496]},{"content":"So, if the data is protected, then we just switch to an enterprise context and paste the data.","pos":[6497,6591]},{"content":"Clipboard source with explicit enterprise identity","pos":[8335,8385]},{"content":"In this scenario, your app is a word-processing app.","pos":[8388,8440]},{"content":"It uses a background thread to commit copy operations by the user.","pos":[8441,8507]},{"content":"The user copies some data from an enterprise file, and immediately switches to a personal file, at which point the app's global context becomes personal.","pos":[8508,8661]},{"content":"At this point—because the global state has changed and should not be used—the app’s background thread must explicitly tell the clipboard that the incoming data is enterprise.","pos":[8662,8836]},{"content":"This is done by setting the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataPackagePropertySet.EnterpriseId<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn913861)</ept> property.","pos":[8837,8974]},{"content":"Tag specific window with enterprise identity","pos":[9328,9372]},{"content":"In this scenario, your app is a word-processing app that handles multiple documents in different windows, some of which are enterprise and others that are personal.","pos":[9375,9539]},{"content":"The app wants to ensure that any data being pasted into a personal document’s window is correctly vetted (that is, denied or consented if it’s enterprise data) and that any outgoing data from an enterprise document’s window is correctly marked.","pos":[9540,9784]},{"content":"You do this by setting the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ProtectionPolicyManager.Identity<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705785)</ept> property.","pos":[9785,9918]},{"content":"Tag outgoing drag object with enterprise identity","pos":[10117,10166]},{"content":"Your app has a personal window open with some draggable enterprise content.","pos":[10169,10244]},{"content":"The user begins to drag some of this content, and your app needs to ensure that the content is marked as enterprise.","pos":[10245,10361]},{"content":"This scenario doesn’t involve any new APIs.","pos":[10362,10405]},{"content":"For this scenario, your app will set the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataPackagePropertySet.EnterpriseId<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn913861)</ept> property (see <bpt id=\"p3\">[</bpt>Clipboard source with explicit enterprise identity scenario<ept id=\"p3\">](#clipboard_source_explicit_id)</ept> above).","pos":[10406,10661]},{"content":"Queries received drag object for its enterprise identity","pos":[10666,10722]},{"content":"Your app has a new and empty document open, which is assumed to be neutral as long as it's empty, and the user drag-drops some content into the document.","pos":[10725,10878]},{"content":"The app must now determine the enterprise identity of the object in order to change the state of the document accordingly.","pos":[10879,11001]},{"content":"For this scenario, your app will get the <bpt id=\"p1\">**</bpt>EnterpriseId<ept id=\"p1\">**</ept> property from the data package by reading <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>DataPackagePropertySet.EnterpriseId<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/apps/dn913861)</ept> (see <bpt id=\"p4\">[</bpt>Clipboard source with explicit enterprise identity scenario<ept id=\"p4\">](#clipboard_source_explicit_id)</ept> above).","pos":[11002,11307]},{"content":"Your app as a Share contract source","pos":[11312,11347]},{"pos":[11350,11574],"content":"When you support the Share contract in your app, to set up a share source, set the enterprise identity context in the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>DataPackage<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/br205873)</ept> as shown in this code example."},{"pos":[11576,11939],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  This code example depends on you having already set the identity on the protection policy manager object for your current view (see <bpt id=\"p2\">[</bpt>Tag specific window with enterprise identity<ept id=\"p2\">](#tag_window_with_id)</ept>); otherwise, the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ProtectionPolicyManager.Identity<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn705785)</ept> property will contain the empty string."},{"content":"Your app as a Share contract target","pos":[12828,12863]},{"content":"This code example continues our policy that as long as the file we're working with is empty.","pos":[12866,12958]},{"content":"Then, we're free to switch contexts as appropriate for incoming data, and avoid popping consent UI where possible.","pos":[12959,13073]},{"content":"So, when your app receives data as a Share contract target, it should call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ProtectionPolicyManager.TryApplyProcessUIPolicy<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705791)</ept> if there is no existing content; otherwise, it should call <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>DataPackage.RequestAccessAsync<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn706636)</ept>.","pos":[13074,13415]},{"content":"The code example shows how.","pos":[13416,13443]},{"content":"Query copy-paste policy passively","pos":[15477,15510]},{"content":"In this scenario, your app enables paste UI only when data is on the clipboard.","pos":[15513,15592]},{"content":"For this feature, you can use the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>ProtectionPolicyManager.CheckAccess<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/apps/dn705783)</ept> method, which allows a passive check of policy.","pos":[15593,15774]},{"pos":[15776,16139],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  This code example depends on you having already set the identity on the protection policy manager object for your current view (see <bpt id=\"p2\">[</bpt>Tag specific window with enterprise identity<ept id=\"p2\">](#tag_window_with_id)</ept>); otherwise, the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ProtectionPolicyManager.Identity<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn705785)</ept> property will contain the empty string."},{"content":"Request access for copy-paste operation","pos":[17030,17069]},{"content":"This scenario shows how to check access for a paste operation.","pos":[17072,17134]},{"pos":[17136,17499],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  This code example depends on you having already set the identity on the protection policy manager object for your current view (see <bpt id=\"p2\">[</bpt>Tag specific window with enterprise identity<ept id=\"p2\">](#tag_window_with_id)</ept>); otherwise, the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt>ProtectionPolicyManager.Identity<ept id=\"p4\">**</ept><ept id=\"p3\">](https://msdn.microsoft.com/library/windows/apps/dn705785)</ept> property will contain the empty string."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps.","pos":[18750,18848]},{"content":"If you’re developing for Windows 8.x or Windows Phone 8.x, see the <bpt id=\"p1\">[</bpt>archived documentation<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=619132)</ept>.","pos":[18849,18990]},{"content":"Related topics","pos":[18997,19011]},{"content":"enterprise data protection (EDP) sample","pos":[19015,19054]},{"content":"Windows.Security.EnterpriseData namespace","pos":[19121,19162]}],"content":"---\nauthor: awkoren\nDescription: 'This topic shows examples of the coding tasks needed to achieve some of the most common data-transfer-related enterprise data protection (EDP) scenarios.'\nMS-HAID: 'dev\\_app\\_to\\_app.use\\_edp\\_to\\_protect\\_enterprise\\_data\\_transferred\\_between\\_apps'\nMSHAttr: 'PreferredLib:/library/windows/apps'\nSearch.Product: eADQiWindows 10XVcnh\ntitle: Use EDP to protect enterprise data transferred between apps\n---\n\n# Use EDP to protect enterprise data transferred between apps\n\n__Note__ Enterprise data protection (EDP) policy cannot be applied on Windows 10, Version 1511 (build 10586) or earlier.\n\nThis topic shows examples of the coding tasks needed to achieve some of the most common data-transfer-related enterprise data protection (EDP) scenarios. For the full developer picture of how EDP relates to files, streams, the clipboard, networking, background tasks, and data protection under lock, see [enterprise data protection (EDP)](../enterprise/edp-hub.md).\n\n**Note**  The [enterprise data protection (EDP) sample](http://go.microsoft.com/fwlink/p/?LinkId=620031&clcid=0x409) covers many of the same scenarios demonstrated in this topic.\n\n## Prerequisites\n\n\n-   **Get set up for EDP**\n\n    See [Set up your computer for EDP](../enterprise/edp-hub.md#set-up-your-computer-for-EDP).\n\n-   **Commit to building an enterprise-enlightened app**\n\n    An app that autonomously ensures that enterprise data stays under the managing enterprise’s control is known as an enterprise-enlightened app. An enlightened app is more powerful, smart, flexible, and trusted than an unenlightened one. Your app announces to the system that it is enlightened by declaring the restricted **enterpriseDataPolicy** capability. There's more to being enlightened than setting a capability, though. To learn more, see [Enterprise-enlightened apps](../enterprise/edp-hub.md#enterprise-enlightened-apps).\n\n-   **Understand async programming for Universal Windows Platform (UWP) apps**\n\n    To learn about how to write asynchronous apps in C\\# or Visual Basic, see [Call asynchronous APIs in C\\# or Visual Basic](https://msdn.microsoft.com/library/windows/apps/mt187337). To learn about how to write asynchronous apps in C++, see [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334).\n\n## Simple clipboard source\n\n\nIn this scenario, your app is a notepad-type app that handles both personal and enterprise files. Here, your app needn’t change its copy-paste logic at all; it just has to call [**ProtectionPolicyManager.TryApplyProcessUIPolicy**](https://msdn.microsoft.com/library/windows/apps/dn705791) whenever the user opens and displays content from an enterprise document. Once the content is displayed in your app's UI, the user might then copy it to paste into a different app, which is why setting UI policy is important. That way, the operating system can apply the currently-set policy to a paste operation involving protected data. Similarly, it's important to clear UI policy as soon as it's no longer needed so that the user is once again free to copy-paste personal data. **TryApplyProcessUIPolicy** returns false if its identity argument is not being managed by an enterprise policy.\n\n```CSharp\nusing Windows.Security.EnterpriseData;\n\n...\n\nprivate void OnFileLoaded(FileProtectionInfo fileProtectionInfo, string contentsOfFile)\n{\n    if (fileProtectionInfo.Status == FileProtectionStatus.Protected)\n    {\n        bool isIdentityManaged = ProtectionPolicyManager.TryApplyProcessUIPolicy\n            (fileProtectionInfo.Identity);\n        if (isIdentityManaged)\n        {\n            // UI policy is now in effect for the file's identity.\n        }\n        else\n        {\n            // Enterprise policy is not in effect, because the file's identity\n            // is not managed. In this case, we have a file protected to an\n            // unmanaged identity, which is not a valid situation.\n            // We still have to call ClearProcessUIPolicy if we want to clear the policy.\n            ProtectionPolicyManager.ClearProcessUIPolicy();\n        }\n    }\n    else\n    {\n        // In case we applied the policy for the previous file, now we need to clear it.\n        ProtectionPolicyManager.ClearProcessUIPolicy();\n    }\n    // Code goes here to display \"contentsOfFile\" in your UI. Ready for copy-paste...\n}\n```\n\n## Simple clipboard target\n\n\nIn this scenario, your app is an email app that handles both personal and corporate accounts. The user tries to paste data into an email reply using their personal account. In this case, before your app retrieves the contents, it has to just make a call to [**DataPackage.RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/dn706636). If we already have access, then that method returns at once. But, if we don't have access, then the method causes a dialog to be shown which request consent from the user and \"unlocks\" the data package if consent is granted. This is to give the user the chance to cancel a paste operation made by mistake.\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\n\n...\n\nprivate async void OnPasteSimple()\n{\n    DataPackageView dataPackageView = Clipboard.GetContent();\n    if (dataPackageView.Contains(StandardDataFormats.Text))\n    {\n        // In case we don't already have acccess, request consent from the user\n        // for us to access the clipboard data.\n        await dataPackageView.RequestAccessAsync();\n\n        try\n        {\n            string contentsOfClipboard = await dataPackageView.GetTextAsync();\n            // Code goes here to insert the text into the email...\n        }\n        catch (Exception)\n        {\n            // Code goes here to handle the exception retrieving text from the clipboard.\n        }\n    }\n    else\n    {\n        // The value on the clipboard is not in the text format.\n    }\n}\n```\n\n## Clipboard target is a neutral, empty document\n\n\nIn this scenario, your app is a word-processing app. After creating a new document, as long as the document remains empty, your app treats the document as neutral—neither enterprise nor personal. Your user then pastes enterprise data into this neutral-context document. Since the document is in a neutral context, we could actually just switch the document into an enterprise context and avoid calling [**DataPackage.RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/dn706636) altogether (since showing the dialog isn't necessary in that case). So, if the data is protected, then we just switch to an enterprise context and paste the data.\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\n\n...\n\nprivate async void OnPasteWithApplyPolicy()\n{\n    DataPackageView dataPackageView = Clipboard.GetContent();\n    if (dataPackageView.Contains(StandardDataFormats.Text))\n    {\n        // If the data has no enterprise identity, then we already have access.\n        if (!string.IsNullOrEmpty(dataPackageView.Properties.EnterpriseId))\n        {\n            ProtectionPolicyEvaluationResult policyResult =\n                await dataPackageView.RequestAccessAsync(dataPackageView.Properties.EnterpriseId);\n            if (this.isNewEmptyDocument &&\n                policyResult == ProtectionPolicyEvaluationResult.Allowed)\n            {\n                // If this is a new and empty document, and we're allowed to access\n                // the data, then we can avoid popping the consent dialog.\n                bool isIdentityManaged = ProtectionPolicyManager.TryApplyProcessUIPolicy(dataPackageView.Properties.EnterpriseId);\n                // You can use \"isIdentityManaged\", but it's not necessary.\n            }\n            else\n            {\n                // In this case, we can't optimize the workflow, so we just\n                // request consent from the user in this case.\n                await dataPackageView.RequestAccessAsync();\n            }\n        }\n\n        try\n        {\n            string contentsOfClipboard = await dataPackageView.GetTextAsync();\n            // Code goes here to insert the text into the email...\n        }\n        catch (Exception)\n        {\n            // Code goes here to handle the exception retrieving text from the clipboard.\n        }\n    }\n    else\n    {\n        // The value on the clipboard is not in the text format.\n    }\n}\n```\n\n## Clipboard source with explicit enterprise identity\n\n\nIn this scenario, your app is a word-processing app. It uses a background thread to commit copy operations by the user. The user copies some data from an enterprise file, and immediately switches to a personal file, at which point the app's global context becomes personal. At this point—because the global state has changed and should not be used—the app’s background thread must explicitly tell the clipboard that the incoming data is enterprise. This is done by setting the [**DataPackagePropertySet.EnterpriseId**](https://msdn.microsoft.com/library/windows/apps/dn913861) property.\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\n\n...\n\nprivate void CopyToClipboard(string stringToCopy, string identity)\n{\n    // Copy the string to the clipboard.\n    var dataPackage = new DataPackage();\n    dataPackage.SetText(stringToCopy);\n    dataPackage.Properties.EnterpriseId = identity;\n    Clipboard.SetContent(dataPackage);\n}\n```\n\n## Tag specific window with enterprise identity\n\n\nIn this scenario, your app is a word-processing app that handles multiple documents in different windows, some of which are enterprise and others that are personal. The app wants to ensure that any data being pasted into a personal document’s window is correctly vetted (that is, denied or consented if it’s enterprise data) and that any outgoing data from an enterprise document’s window is correctly marked. You do this by setting the [**ProtectionPolicyManager.Identity**](https://msdn.microsoft.com/library/windows/apps/dn705785) property.\n\n```CSharp\nusing Windows.Security.EnterpriseData;\n\n...\n\nprivate void TagCurrentViewWithEnterpriseId(string identity)\n{\n    ProtectionPolicyManager.GetForCurrentView().Identity = identity;\n}\n```\n\n## Tag outgoing drag object with enterprise identity\n\n\nYour app has a personal window open with some draggable enterprise content. The user begins to drag some of this content, and your app needs to ensure that the content is marked as enterprise. This scenario doesn’t involve any new APIs. For this scenario, your app will set the [**DataPackagePropertySet.EnterpriseId**](https://msdn.microsoft.com/library/windows/apps/dn913861) property (see [Clipboard source with explicit enterprise identity scenario](#clipboard_source_explicit_id) above).\n\n## Queries received drag object for its enterprise identity\n\n\nYour app has a new and empty document open, which is assumed to be neutral as long as it's empty, and the user drag-drops some content into the document. The app must now determine the enterprise identity of the object in order to change the state of the document accordingly. For this scenario, your app will get the **EnterpriseId** property from the data package by reading [**DataPackagePropertySet.EnterpriseId**](https://msdn.microsoft.com/library/windows/apps/dn913861) (see [Clipboard source with explicit enterprise identity scenario](#clipboard_source_explicit_id) above).\n\n## Your app as a Share contract source\n\n\nWhen you support the Share contract in your app, to set up a share source, set the enterprise identity context in the [**DataPackage**](https://msdn.microsoft.com/library/windows/apps/br205873) as shown in this code example.\n\n**Note**  This code example depends on you having already set the identity on the protection policy manager object for your current view (see [Tag specific window with enterprise identity](#tag_window_with_id)); otherwise, the [**ProtectionPolicyManager.Identity**](https://msdn.microsoft.com/library/windows/apps/dn705785) property will contain the empty string.\n\n\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\nusing Windows.Security.EnterpriseData;\n\n...\n\nprivate void OnShareSourceOperation(object sender, RoutedEventArgs e)\n{\n    // Register the current page as a share source (or you could do this earlier in your app).\n    DataTransferManager.GetForCurrentView().DataRequested += OnDataRequested;\n    DataTransferManager.ShowShareUI();\n}\n\nprivate void OnDataRequested(DataTransferManager sender, DataRequestedEventArgs args)\n{\n    if (!string.IsNullOrEmpty(this.shareSourceContent))\n    {\n        var protectionPolicyManager = ProtectionPolicyManager.GetForCurrentView();\n        DataPackage requestData = args.Request.Data;\n        requestData.Properties.Title = this.shareSourceTitle;\n        requestData.Properties.EnterpriseId = protectionPolicyManager.Identity;\n        requestData.SetText(this.shareSourceContent);\n    }\n}\n```\n\n## Your app as a Share contract target\n\n\nThis code example continues our policy that as long as the file we're working with is empty. Then, we're free to switch contexts as appropriate for incoming data, and avoid popping consent UI where possible. So, when your app receives data as a Share contract target, it should call [**ProtectionPolicyManager.TryApplyProcessUIPolicy**](https://msdn.microsoft.com/library/windows/apps/dn705791) if there is no existing content; otherwise, it should call [**DataPackage.RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/dn706636). The code example shows how.\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\nusing Windows.ApplicationModel.DataTransfer.ShareTarget;\n\n...\n\nstring identity = \"microsoft.com\";\n\nprotected override async void OnShareTargetActivated(ShareTargetActivatedEventArgs args)\n{\n    ShareOperation shareOperation = args.ShareOperation;\n    if (shareOperation.Data.Contains(StandardDataFormats.Text))\n    {\n        // If the data has no enterprise identity, then we already have access.\n        if (!string.IsNullOrEmpty(shareOperation.Data.Properties.EnterpriseId))\n        {\n            ProtectionPolicyEvaluationResult protectionPolicyEvaluationResult =\n                await ProtectionPolicyManager.RequestAccessAsync\n                    (shareOperation.Data.Properties.EnterpriseId, identity);\n            if (this.isNewEmptyDocument && protectionPolicyEvaluationResult ==\n                ProtectionPolicyEvaluationResult.Allowed)\n            {\n                // If this is a new and empty document, and we're allowed to access\n                // the data, then we can avoid popping the consent dialog.\n                bool isIdentityManaged = ProtectionPolicyManager.TryApplyProcessUIPolicy\n                    (shareOperation.Data.Properties.EnterpriseId);\n                // You can use \"isIdentityManaged\", but it';s not necessary.\n            }\n            else\n            {\n                // In this case, we can't optimize the workflow, so we just\n                // request consent from the user in this case.\n                protectionPolicyEvaluationResult = await shareOperation.Data.RequestAccessAsync();\n            }\n        }\n\n        try\n        {\n            // Get the text from the share operation...\n            App.shareTargetContent = await shareOperation.Data.GetTextAsync();\n        }\n        catch (Exception)\n        {\n            // Code goes here to handle the exception retrieving text from the share operation.\n        }\n    }\n    else\n    {\n        // The value in the share operation is not in the text format.\n    }\n}\n```\n\n## Query copy-paste policy passively\n\n\nIn this scenario, your app enables paste UI only when data is on the clipboard. For this feature, you can use the [**ProtectionPolicyManager.CheckAccess**](https://msdn.microsoft.com/library/windows/apps/dn705783) method, which allows a passive check of policy.\n\n**Note**  This code example depends on you having already set the identity on the protection policy manager object for your current view (see [Tag specific window with enterprise identity](#tag_window_with_id)); otherwise, the [**ProtectionPolicyManager.Identity**](https://msdn.microsoft.com/library/windows/apps/dn705785) property will contain the empty string.\n\n\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\nusing Windows.Security.EnterpriseData;\n\n...\n\nprivate bool IsClipboardPeekAllowedAsync()\n{\n    ProtectionPolicyEvaluationResult protectionPolicyEvaluationResult = ProtectionPolicyEvaluationResult.Blocked;\n    DataPackageView dataPackageView = Clipboard.GetContent();\n    if (dataPackageView.Contains(StandardDataFormats.Text))\n    {\n        protectionPolicyEvaluationResult =\n            ProtectionPolicyManager.CheckAccess(dataPackageView.Properties.EnterpriseId,\n                ProtectionPolicyManager.GetForCurrentView().Identity);\n    }\n\n    // Since this is a convenience feature to allow a peek of clipboard content,\n    // if state is Blocked or ConsentRequired, do not show peek if this helper\n    // method returns false.\n    return (protectionPolicyEvaluationResult == ProtectionPolicyEvaluationResult.Allowed);\n}\n```\n\n## Request access for copy-paste operation\n\n\nThis scenario shows how to check access for a paste operation.\n\n**Note**  This code example depends on you having already set the identity on the protection policy manager object for your current view (see [Tag specific window with enterprise identity](#tag_window_with_id)); otherwise, the [**ProtectionPolicyManager.Identity**](https://msdn.microsoft.com/library/windows/apps/dn705785) property will contain the empty string.\n\n\n\n```CSharp\nusing Windows.ApplicationModel.DataTransfer;\nusing Windows.Security.EnterpriseData;\n\n...\n\nprivate async void OnPasteWithRequestAccess()\n{\n    DataPackageView dataPackageView = Clipboard.GetContent();\n    if (dataPackageView.Contains(StandardDataFormats.Text))\n    {\n        ProtectionPolicyEvaluationResult protectionPolicyEvaluationResult =\n            ProtectionPolicyManager.CheckAccess(dataPackageView.Properties.EnterpriseId,\n                ProtectionPolicyManager.GetForCurrentView().Identity);\n\n        if (protectionPolicyEvaluationResult == ProtectionPolicyEvaluationResult.Allowed)\n        {\n            try\n            {\n                string contentsOfClipboard = await dataPackageView.GetTextAsync();\n                // Code goes here to insert the text into the app...\n                this.fileContentsTextBox.Text = contentsOfClipboard;\n            }\n            catch (Exception)\n            {\n                // Code goes here to handle the exception retrieving text from the clipboard.\n            }\n        }\n        else\n        {\n            // Paste from the enterprise context is not allowed by policy.\n        }\n    }\n    else\n    {\n        // The value on the clipboard is not in the text format.\n    }\n}\n```\n\n**Note**  This article is for Windows 10 developers writing Universal Windows Platform (UWP) apps. If you’re developing for Windows 8.x or Windows Phone 8.x, see the [archived documentation](http://go.microsoft.com/fwlink/p/?linkid=619132).\n\n\n\n## Related topics\n\n\n[enterprise data protection (EDP) sample](http://go.microsoft.com/fwlink/p/?LinkId=620031&clcid=0x409)\n\n[**Windows.Security.EnterpriseData namespace**](https://msdn.microsoft.com/library/windows/apps/dn279153)\n\n\n\n\n\n"}